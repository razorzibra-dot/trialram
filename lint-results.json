[{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\.eslintrc-custom-rules.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\.eslintrc.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\auditService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\authService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\contractService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\customerService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\dashboardService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\fileService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\notificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\salesService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\ticketService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\MARK_FOR_DELETE\\legacy_services_real\\userService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\postcss.config.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\scripts\\generate-seed-sql.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\scripts\\migrate-page-ui.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\scripts\\seed-auth-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\scripts\\seed-database.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2260,2263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2260,2263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { execSync } from 'child_process';\r\nimport { readFileSync } from 'fs';\r\nimport { resolve } from 'path';\r\nimport * as path from 'path';\r\nimport dotenv from 'dotenv';\r\n\r\n// Load environment variables from .env file\r\ndotenv.config({ path: path.resolve(process.cwd(), '.env') });\r\n\r\nasync function seedDatabase() {\r\n  try {\r\n    console.log('üìö Reading seed.sql file...');\r\n    \r\n    // Read the seed SQL file\r\n    const seedPath = resolve('supabase/seed.sql');\r\n    const seedSQL = readFileSync(seedPath, 'utf-8');\r\n\r\n    // Get database URL from environment\r\n    const supabaseUrl = process.env.VITE_SUPABASE_URL;\r\n\r\n    if (!supabaseUrl) {\r\n      console.error('‚ùå Missing VITE_SUPABASE_URL in .env');\r\n      process.exit(1);\r\n    }\r\n\r\n    // Parse local Supabase connection info\r\n    const urlObj = new URL(supabaseUrl);\r\n    const isLocal = urlObj.hostname === '127.0.0.1' || urlObj.hostname === 'localhost';\r\n\r\n    if (!isLocal) {\r\n      console.error('‚ùå This script only works with local Supabase for safety');\r\n      process.exit(1);\r\n    }\r\n\r\n    // For local Supabase, use default postgres credentials with superuser access\r\n    // Supabase local runs on port 54322 (not standard 5432)\r\n    // This is required for DISABLE TRIGGER ALL and other admin operations\r\n    const pgConnectionString = 'postgresql://postgres:postgres@127.0.0.1:54322/postgres';\r\n\r\n    console.log('üîÑ Connecting to Supabase local database...');\r\n    console.log('üìù Executing seed.sql (preserving auth users)...\\n');\r\n\r\n    try {\r\n      // Execute SQL file using psql\r\n      // The postgres user has superuser privileges needed for trigger manipulation\r\n      const result = execSync(`psql \"${pgConnectionString}\" -f \"${seedPath}\" 2>&1`, {\r\n        encoding: 'utf-8',\r\n        maxBuffer: 10 * 1024 * 1024, // 10MB buffer\r\n      });\r\n\r\n      // Filter out notice messages but show actual output\r\n      const output = result\r\n        .split('\\n')\r\n        .filter(line => !line.includes('NOTICE:') && line.trim())\r\n        .join('\\n');\r\n\r\n      if (output) {\r\n        console.log(output);\r\n      }\r\n\r\n      console.log('\\n‚úÖ Database seeded successfully!');\r\n      console.log('üíæ All data has been populated while preserving auth users.\\n');\r\n      \r\n    } catch (psqlError: any) {\r\n      if (psqlError.status === 127) {\r\n        console.error('‚ùå psql command not found. Please install PostgreSQL client tools.');\r\n        console.error('\\n   Installation instructions:');\r\n        console.error('   - Windows: https://www.postgresql.org/download/windows/');\r\n        console.error('   - macOS: brew install postgresql');\r\n        console.error('   - Linux: sudo apt-get install postgresql-client\\n');\r\n        process.exit(1);\r\n      }\r\n\r\n      const errorOutput = psqlError.stdout || psqlError.stderr || psqlError.message;\r\n      \r\n      // Check if it's a permission error\r\n      if (errorOutput.includes('permission denied') || errorOutput.includes('FATAL')) {\r\n        console.error('‚ùå Database connection or permission error:');\r\n        console.error(errorOutput);\r\n        console.error('\\nüîß Troubleshooting:');\r\n        console.error('   1. Make sure Supabase is running: supabase start');\r\n        console.error('   2. Verify .env has correct VITE_SUPABASE_URL');\r\n        console.error('   3. Check if port 5432 is accessible\\n');\r\n        process.exit(1);\r\n      }\r\n\r\n      // Show the error but note that auth data is still preserved\r\n      console.error('‚ö†Ô∏è  Database seeding encountered issues:');\r\n      console.error(errorOutput);\r\n      console.log('\\nüíæ Auth users are still preserved. Check errors above.\\n');\r\n      process.exit(1);\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('‚ùå Error:', error);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nseedDatabase();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\scripts\\sync-auth-to-sql.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\scripts\\validate-code.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\buffer-polyfill.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\auth\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\auth\\SessionExpiryWarningModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\auth\\SessionTimeoutWarning.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleAutoLogout'. Either include it or remove the dependency array.","line":63,"column":6,"nodeType":"ArrayExpression","endLine":63,"endColumn":75,"suggestions":[{"desc":"Update the dependencies array to be: [isAuthenticated, warningThreshold, autoLogoutThreshold, sessionInfo, handleAutoLogout]","fix":{"range":[2101,2170],"text":"[isAuthenticated, warningThreshold, autoLogoutThreshold, sessionInfo, handleAutoLogout]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Clock, RefreshCw, LogOut } from 'lucide-react';\r\nimport { authService } from '@/services';\r\nimport { uiNotificationService } from '@/services/uiNotificationService';\r\n\r\ninterface SessionTimeoutWarningProps {\r\n  warningThreshold?: number; // Show warning when X seconds left (default: 300 = 5 minutes)\r\n  autoLogoutThreshold?: number; // Auto logout when X seconds left (default: 60 = 1 minute)\r\n}\r\n\r\nconst SessionTimeoutWarning: React.FC<SessionTimeoutWarningProps> = ({\r\n  warningThreshold = 300, // 5 minutes\r\n  autoLogoutThreshold = 60 // 1 minute\r\n}) => {\r\n  const { sessionInfo, logout, isAuthenticated } = useAuth();\r\n  const [showWarning, setShowWarning] = useState(false);\r\n  const [timeLeft, setTimeLeft] = useState(0);\r\n  const [isExtending, setIsExtending] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!isAuthenticated) {\r\n      setShowWarning(false);\r\n      return;\r\n    }\r\n\r\n    const checkSession = () => {\r\n      const session = sessionInfo();\r\n      const timeUntilExpiry = session?.timeUntilExpiry || 0;\r\n      \r\n      setTimeLeft(timeUntilExpiry);\r\n\r\n      // Show warning if time is below threshold\r\n      if (timeUntilExpiry > 0 && timeUntilExpiry <= warningThreshold && timeUntilExpiry > autoLogoutThreshold) {\r\n        setShowWarning(true);\r\n      } else if (timeUntilExpiry <= autoLogoutThreshold && timeUntilExpiry > 0) {\r\n        // Auto logout\r\n        handleAutoLogout();\r\n      } else {\r\n        setShowWarning(false);\r\n      }\r\n    };\r\n\r\n    // Check immediately\r\n    checkSession();\r\n\r\n    // Check every 10 seconds\r\n    const interval = setInterval(checkSession, 10000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isAuthenticated, warningThreshold, autoLogoutThreshold, sessionInfo]);\r\n\r\n  const handleAutoLogout = async () => {\r\n    setShowWarning(false);\r\n    \r\n    uiNotificationService.errorNotify(\r\n      'Session Expired',\r\n      'You have been automatically logged out due to inactivity.'\r\n    );\r\n\r\n    await logout();\r\n  };\r\n\r\n  const handleExtendSession = async () => {\r\n    setIsExtending(true);\r\n    \r\n    try {\r\n      // Attempt to refresh the token\r\n      await authService.refreshToken();\r\n      \r\n      uiNotificationService.successNotify(\r\n        'Session Extended',\r\n        'Your session has been successfully extended.'\r\n      );\r\n      \r\n      setShowWarning(false);\r\n    } catch (error) {\r\n      console.error('Failed to extend session:', error);\r\n      \r\n      uiNotificationService.errorNotify(\r\n        'Session Extension Failed',\r\n        'Unable to extend your session. Please log in again.'\r\n      );\r\n      \r\n      await logout();\r\n    } finally {\r\n      setIsExtending(false);\r\n    }\r\n  };\r\n\r\n  const handleLogoutNow = async () => {\r\n    setShowWarning(false);\r\n    await logout();\r\n  };\r\n\r\n  const formatTime = (seconds: number): string => {\r\n    const minutes = Math.floor(seconds / 60);\r\n    const remainingSeconds = seconds % 60;\r\n    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  const progressValue = ((warningThreshold - timeLeft) / warningThreshold) * 100;\r\n\r\n  if (!showWarning || !isAuthenticated) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <AlertDialog open={showWarning} onOpenChange={() => {}}>\r\n      <AlertDialogContent className=\"max-w-md\">\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle className=\"flex items-center gap-2\">\r\n            <Clock className=\"h-5 w-5 text-orange-500\" />\r\n            Session Timeout Warning\r\n          </AlertDialogTitle>\r\n          <AlertDialogDescription className=\"space-y-4\">\r\n            <p>\r\n              Your session will expire in <strong>{formatTime(timeLeft)}</strong> due to inactivity.\r\n            </p>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span>Time remaining</span>\r\n                <span className=\"font-mono\">{formatTime(timeLeft)}</span>\r\n              </div>\r\n              <Progress \r\n                value={progressValue} \r\n                className=\"h-2\"\r\n                // Change color based on urgency\r\n                style={{\r\n                  '--progress-background': timeLeft < 120 ? '#ef4444' : timeLeft < 180 ? '#f59e0b' : '#3b82f6'\r\n                } as React.CSSProperties}\r\n              />\r\n            </div>\r\n\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Would you like to extend your session or log out now?\r\n            </p>\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        \r\n        <AlertDialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n          <AlertDialogCancel \r\n            onClick={handleLogoutNow}\r\n            className=\"w-full sm:w-auto\"\r\n          >\r\n            <LogOut className=\"mr-2 h-4 w-4\" />\r\n            Log Out Now\r\n          </AlertDialogCancel>\r\n          \r\n          <AlertDialogAction \r\n            onClick={handleExtendSession}\r\n            disabled={isExtending}\r\n            className=\"w-full sm:w-auto\"\r\n          >\r\n            {isExtending ? (\r\n              <>\r\n                <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                Extending...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <RefreshCw className=\"mr-2 h-4 w-4\" />\r\n                Extend Session\r\n              </>\r\n            )}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n  );\r\n};\r\n\r\nexport default SessionTimeoutWarning;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\common\\DataTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\common\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\common\\PageHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\common\\StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\common\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\complaints\\ComplaintDetailModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\complaints\\ComplaintFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\configuration\\ConfigurationFormModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'generateFormFields'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [setting, isOpen, generateFormFields]","fix":{"range":[3317,3334],"text":"[setting, isOpen, generateFormFields]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '../ui/dialog';\r\nimport { Button } from '../ui/button';\r\nimport { Input } from '../ui/input';\r\nimport { Label } from '../ui/label';\r\nimport { Textarea } from '../ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../ui/select';\r\nimport { Switch } from '../ui/switch';\r\nimport { Badge } from '../ui/badge';\r\nimport { Alert, AlertDescription } from '../ui/alert';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card';\r\nimport { Separator } from '../ui/separator';\r\nimport { AlertTriangle, Save, X, Info } from 'lucide-react';\r\nimport { ConfigurationSetting, ValidationSchema, configurationService } from '../../services/configurationService';\r\nimport { notificationService } from '@/services/uiNotificationService';\r\n\r\ninterface ConfigurationFormModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  setting?: ConfigurationSetting | null;\r\n  mode: 'super_admin' | 'tenant';\r\n  onSave: () => void;\r\n}\r\n\r\ninterface FormField {\r\n  key: string;\r\n  label: string;\r\n  type: 'text' | 'number' | 'boolean' | 'select' | 'textarea' | 'json' | 'array';\r\n  value: unknown;\r\n  required?: boolean;\r\n  options?: string[];\r\n  description?: string;\r\n  validation?: ValidationSchema;\r\n}\r\n\r\nconst ConfigurationFormModal: React.FC<ConfigurationFormModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  setting,\r\n  mode,\r\n  onSave\r\n}) => {\r\n  const [formData, setFormData] = useState<Partial<ConfigurationSetting>>({\r\n    category: '',\r\n    setting_key: '',\r\n    setting_value: {},\r\n    description: '',\r\n    validation_schema: null,\r\n    is_active: true\r\n  });\r\n\r\n  const [formFields, setFormFields] = useState<FormField[]>([]);\r\n  const [validationErrors, setValidationErrors] = useState<Record<string, string[]>>({});\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [activeTab, setActiveTab] = useState('basic');\r\n\r\n  const categories = mode === 'super_admin' \r\n    ? configurationService.getSuperAdminCategories()\r\n    : configurationService.getTenantCategories();\r\n\r\n  const categoryLabels: Record<string, string> = {\r\n    // Super Admin Categories\r\n    tenant_defaults: 'Tenant Onboarding Defaults',\r\n    global_email: 'Global Email/Notification Config',\r\n    system_policies: 'System Policy Controls',\r\n    pdf_templates: 'PDF & Document Templates',\r\n    license_usage: 'License & Usage Policy',\r\n    // Tenant Categories\r\n    complaint_rules: 'Complaint Management Rules',\r\n    job_work_config: 'Job Work Configuration',\r\n    notification_preferences: 'Notification Preferences',\r\n    product_defaults: 'Product & Service Defaults'\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (setting) {\r\n      setFormData({\r\n        ...setting,\r\n        setting_value: setting.setting_value || {}\r\n      });\r\n      generateFormFields(setting.setting_value, setting.validation_schema);\r\n    } else {\r\n      setFormData({\r\n        category: '',\r\n        setting_key: '',\r\n        setting_value: {},\r\n        description: '',\r\n        validation_schema: null,\r\n        is_active: true\r\n      });\r\n      setFormFields([]);\r\n    }\r\n    setValidationErrors({});\r\n  }, [setting, isOpen]);\r\n\r\n  const generateFormFields = (value: unknown, schema: ValidationSchema | null) => {\r\n    if (!value || typeof value !== 'object') return;\r\n\r\n    const fields: FormField[] = [];\r\n    \r\n    Object.entries(value).forEach(([key, val]) => {\r\n      const fieldSchema = schema?.properties?.[key];\r\n      \r\n      fields.push({\r\n        key,\r\n        label: key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase()),\r\n        type: inferFieldType(val, fieldSchema),\r\n        value: val,\r\n        required: fieldSchema?.required || false,\r\n        options: fieldSchema?.enum,\r\n        description: fieldSchema?.description,\r\n        validation: fieldSchema\r\n      });\r\n    });\r\n\r\n    setFormFields(fields);\r\n  };\r\n\r\n  const inferFieldType = (value: unknown, schema?: ValidationSchema): FormField['type'] => {\r\n    if (schema?.type) {\r\n      switch (schema.type) {\r\n        case 'boolean': return 'boolean';\r\n        case 'number': return 'number';\r\n        case 'array': return 'array';\r\n        case 'object': return 'json';\r\n        default: \r\n          if (schema.enum) return 'select';\r\n          return typeof value === 'string' && value.length > 100 ? 'textarea' : 'text';\r\n      }\r\n    }\r\n\r\n    if (typeof value === 'boolean') return 'boolean';\r\n    if (typeof value === 'number') return 'number';\r\n    if (Array.isArray(value)) return 'array';\r\n    if (typeof value === 'object') return 'json';\r\n    if (typeof value === 'string' && value.length > 100) return 'textarea';\r\n    \r\n    return 'text';\r\n  };\r\n\r\n  const handleFieldChange = (fieldKey: string, newValue: unknown) => {\r\n    const updatedFields = formFields.map(field => \r\n      field.key === fieldKey ? { ...field, value: newValue } : field\r\n    );\r\n    setFormFields(updatedFields);\r\n\r\n    // Update form data\r\n    const newSettingValue = { ...formData.setting_value };\r\n    newSettingValue[fieldKey] = newValue;\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      setting_value: newSettingValue\r\n    }));\r\n\r\n    // Clear validation errors for this field\r\n    if (validationErrors[fieldKey]) {\r\n      setValidationErrors(prev => {\r\n        const newErrors = { ...prev };\r\n        delete newErrors[fieldKey];\r\n        return newErrors;\r\n      });\r\n    }\r\n  };\r\n\r\n  const addNewField = () => {\r\n    const newField: FormField = {\r\n      key: `new_field_${Date.now()}`,\r\n      label: 'New Field',\r\n      type: 'text',\r\n      value: '',\r\n      required: false\r\n    };\r\n    \r\n    setFormFields(prev => [...prev, newField]);\r\n  };\r\n\r\n  const removeField = (fieldKey: string) => {\r\n    setFormFields(prev => prev.filter(field => field.key !== fieldKey));\r\n    \r\n    const newSettingValue = { ...formData.setting_value };\r\n    delete newSettingValue[fieldKey];\r\n    \r\n    setFormData(prev => ({\r\n      ...prev,\r\n      setting_value: newSettingValue\r\n    }));\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    const errors: Record<string, string[]> = {};\r\n\r\n    // Validate basic fields\r\n    if (!formData.category) {\r\n      errors.category = ['Category is required'];\r\n    }\r\n    if (!formData.setting_key) {\r\n      errors.setting_key = ['Setting key is required'];\r\n    }\r\n\r\n    // Validate form fields\r\n    formFields.forEach(field => {\r\n      if (field.validation) {\r\n        const validation = configurationService.validateSetting(field.value, field.validation);\r\n        if (!validation.valid) {\r\n          errors[field.key] = validation.errors;\r\n        }\r\n      }\r\n    });\r\n\r\n    setValidationErrors(errors);\r\n    return Object.keys(errors).length === 0;\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!validateForm()) {\r\n      toast({\r\n        title: \"Validation Error\",\r\n        description: \"Please fix the validation errors before saving.\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const settingData = {\r\n        ...formData,\r\n        setting_value: formFields.reduce((acc, field) => {\r\n          acc[field.key] = field.value;\r\n          return acc;\r\n        }, {} as Record<string, unknown>)\r\n      };\r\n\r\n      if (setting?.id) {\r\n        // Update existing setting\r\n        if (mode === 'super_admin') {\r\n          await configurationService.updateSuperAdminSetting(setting.id, settingData);\r\n        } else {\r\n          await configurationService.updateTenantSetting(setting.id, settingData);\r\n        }\r\n        \r\n        toast({\r\n          title: \"Setting Updated\",\r\n          description: \"Configuration setting has been updated successfully.\"\r\n        });\r\n      } else {\r\n        // Create new setting\r\n        if (mode === 'super_admin') {\r\n          await configurationService.createSuperAdminSetting(settingData);\r\n        } else {\r\n          await configurationService.createTenantSetting(settingData);\r\n        }\r\n        \r\n        toast({\r\n          title: \"Setting Created\",\r\n          description: \"Configuration setting has been created successfully.\"\r\n        });\r\n      }\r\n\r\n      onSave();\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error saving configuration:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: error instanceof Error ? error.message : \"Failed to save configuration setting.\",\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const renderField = (field: FormField) => {\r\n    const hasError = validationErrors[field.key];\r\n\r\n    switch (field.type) {\r\n      case 'boolean':\r\n        return (\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Switch\r\n              checked={field.value}\r\n              onCheckedChange={(checked) => handleFieldChange(field.key, checked)}\r\n            />\r\n            <Label>{field.label}</Label>\r\n          </div>\r\n        );\r\n\r\n      case 'number':\r\n        return (\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={field.key}>\r\n              {field.label}\r\n              {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n            </Label>\r\n            <Input\r\n              id={field.key}\r\n              type=\"number\"\r\n              value={field.value}\r\n              onChange={(e) => handleFieldChange(field.key, parseFloat(e.target.value) || 0)}\r\n              className={hasError ? 'border-red-500' : ''}\r\n            />\r\n            {field.description && (\r\n              <p className=\"text-sm text-muted-foreground\">{field.description}</p>\r\n            )}\r\n          </div>\r\n        );\r\n\r\n      case 'select':\r\n        return (\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={field.key}>\r\n              {field.label}\r\n              {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n            </Label>\r\n            <Select value={field.value} onValueChange={(value) => handleFieldChange(field.key, value)}>\r\n              <SelectTrigger className={hasError ? 'border-red-500' : ''}>\r\n                <SelectValue placeholder={`Select ${field.label}`} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {field.options?.map((option) => (\r\n                  <SelectItem key={option} value={option}>\r\n                    {option}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n            {field.description && (\r\n              <p className=\"text-sm text-muted-foreground\">{field.description}</p>\r\n            )}\r\n          </div>\r\n        );\r\n\r\n      case 'textarea':\r\n        return (\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={field.key}>\r\n              {field.label}\r\n              {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n            </Label>\r\n            <Textarea\r\n              id={field.key}\r\n              value={field.value}\r\n              onChange={(e) => handleFieldChange(field.key, e.target.value)}\r\n              className={hasError ? 'border-red-500' : ''}\r\n              rows={4}\r\n            />\r\n            {field.description && (\r\n              <p className=\"text-sm text-muted-foreground\">{field.description}</p>\r\n            )}\r\n          </div>\r\n        );\r\n\r\n      case 'array':\r\n        return (\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={field.key}>\r\n              {field.label}\r\n              {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n            </Label>\r\n            <Textarea\r\n              id={field.key}\r\n              value={Array.isArray(field.value) ? field.value.join('\\r\\n') : ''}\r\n              onChange={(e) => handleFieldChange(field.key, e.target.value.split('\\r\\n').filter(Boolean))}\r\n              className={hasError ? 'border-red-500' : ''}\r\n              placeholder=\"Enter one item per line\"\r\n              rows={4}\r\n            />\r\n            {field.description && (\r\n              <p className=\"text-sm text-muted-foreground\">{field.description}</p>\r\n            )}\r\n          </div>\r\n        );\r\n\r\n      case 'json':\r\n        return (\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={field.key}>\r\n              {field.label}\r\n              {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n            </Label>\r\n            <Textarea\r\n              id={field.key}\r\n              value={typeof field.value === 'object' ? JSON.stringify(field.value, null, 2) : field.value}\r\n              onChange={(e) => {\r\n                try {\r\n                  const parsed = JSON.parse(e.target.value);\r\n                  handleFieldChange(field.key, parsed);\r\n                } catch {\r\n                  // Keep the raw value for editing\r\n                  handleFieldChange(field.key, e.target.value);\r\n                }\r\n              }}\r\n              className={hasError ? 'border-red-500' : ''}\r\n              placeholder=\"Enter valid JSON\"\r\n              rows={6}\r\n            />\r\n            {field.description && (\r\n              <p className=\"text-sm text-muted-foreground\">{field.description}</p>\r\n            )}\r\n          </div>\r\n        );\r\n\r\n      default:\r\n        return (\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor={field.key}>\r\n              {field.label}\r\n              {field.required && <span className=\"text-red-500 ml-1\">*</span>}\r\n            </Label>\r\n            <Input\r\n              id={field.key}\r\n              value={field.value}\r\n              onChange={(e) => handleFieldChange(field.key, e.target.value)}\r\n              className={hasError ? 'border-red-500' : ''}\r\n            />\r\n            {field.description && (\r\n              <p className=\"text-sm text-muted-foreground\">{field.description}</p>\r\n            )}\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>\r\n            {setting ? 'Edit' : 'Create'} {mode === 'super_admin' ? 'Super Admin' : 'Tenant'} Configuration\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-3\">\r\n            <TabsTrigger value=\"basic\">Basic Info</TabsTrigger>\r\n            <TabsTrigger value=\"settings\">Settings</TabsTrigger>\r\n            <TabsTrigger value=\"validation\">Validation</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"basic\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Basic Information</CardTitle>\r\n                <CardDescription>\r\n                  Configure the basic properties of this setting\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"category\">\r\n                      Category <span className=\"text-red-500\">*</span>\r\n                    </Label>\r\n                    <Select \r\n                      value={formData.category} \r\n                      onValueChange={(value) => setFormData(prev => ({ ...prev, category: value }))}\r\n                    >\r\n                      <SelectTrigger className={validationErrors.category ? 'border-red-500' : ''}>\r\n                        <SelectValue placeholder=\"Select category\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {categories.map((category) => (\r\n                          <SelectItem key={category} value={category}>\r\n                            {categoryLabels[category] || category}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                    {validationErrors.category && (\r\n                      <p className=\"text-sm text-red-500\">{validationErrors.category[0]}</p>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"setting_key\">\r\n                      Setting Key <span className=\"text-red-500\">*</span>\r\n                    </Label>\r\n                    <Input\r\n                      id=\"setting_key\"\r\n                      value={formData.setting_key}\r\n                      onChange={(e) => setFormData(prev => ({ ...prev, setting_key: e.target.value }))}\r\n                      placeholder=\"e.g., auto_assignment_rules\"\r\n                      className={validationErrors.setting_key ? 'border-red-500' : ''}\r\n                    />\r\n                    {validationErrors.setting_key && (\r\n                      <p className=\"text-sm text-red-500\">{validationErrors.setting_key[0]}</p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"description\">Description</Label>\r\n                  <Textarea\r\n                    id=\"description\"\r\n                    value={formData.description || ''}\r\n                    onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\r\n                    placeholder=\"Describe what this setting controls...\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Switch\r\n                    checked={formData.is_active}\r\n                    onCheckedChange={(checked) => setFormData(prev => ({ ...prev, is_active: checked }))}\r\n                  />\r\n                  <Label>Active</Label>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"settings\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center justify-between\">\r\n                  Setting Values\r\n                  <Button onClick={addNewField} variant=\"outline\" size=\"sm\">\r\n                    Add Field\r\n                  </Button>\r\n                </CardTitle>\r\n                <CardDescription>\r\n                  Configure the actual setting values and their properties\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {formFields.length === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    <Info className=\"h-8 w-8 mx-auto mb-2\" />\r\n                    <p>No fields configured yet. Click \"Add Field\" to start.</p>\r\n                  </div>\r\n                ) : (\r\n                  formFields.map((field, index) => (\r\n                    <div key={field.key} className=\"border rounded-lg p-4 space-y-4\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <Badge variant=\"outline\">{field.type}</Badge>\r\n                        <Button\r\n                          onClick={() => removeField(field.key)}\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                        >\r\n                          <X className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                      \r\n                      {renderField(field)}\r\n                      \r\n                      {validationErrors[field.key] && (\r\n                        <Alert variant=\"destructive\">\r\n                          <AlertTriangle className=\"h-4 w-4\" />\r\n                          <AlertDescription>\r\n                            {validationErrors[field.key].join(', ')}\r\n                          </AlertDescription>\r\n                        </Alert>\r\n                      )}\r\n                    </div>\r\n                  ))\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"validation\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Validation Schema</CardTitle>\r\n                <CardDescription>\r\n                  Define validation rules for this setting (optional)\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <Textarea\r\n                  value={formData.validation_schema ? JSON.stringify(formData.validation_schema, null, 2) : ''}\r\n                  onChange={(e) => {\r\n                    try {\r\n                      const parsed = e.target.value ? JSON.parse(e.target.value) : null;\r\n                      setFormData(prev => ({ ...prev, validation_schema: parsed }));\r\n                    } catch {\r\n                      // Keep the raw value for editing\r\n                    }\r\n                  }}\r\n                  placeholder=\"Enter JSON schema for validation...\"\r\n                  rows={10}\r\n                />\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        </Tabs>\r\n\r\n        <Separator />\r\n\r\n        <DialogFooter>\r\n          <Button onClick={onClose} variant=\"outline\" disabled={isLoading}>\r\n            Cancel\r\n          </Button>\r\n          <Button onClick={handleSave} disabled={isLoading}>\r\n            {isLoading ? (\r\n              <>\r\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\r\n                Saving...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Save className=\"h-4 w-4 mr-2\" />\r\n                {setting ? 'Update' : 'Create'} Setting\r\n              </>\r\n            )}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ConfigurationFormModal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\configuration\\ConfigurationTest.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\configuration\\SuperAdminSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterSettings'. Either include it or remove the dependency array.","line":88,"column":6,"nodeType":"ArrayExpression","endLine":88,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [settings, selectedCategory, searchTerm, filterSettings]","fix":{"range":[3287,3327],"text":"[settings, selectedCategory, searchTerm, filterSettings]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card';\r\nimport { Button } from '../ui/button';\r\nimport { Input } from '../ui/input';\r\nimport { Badge } from '../ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '../ui/table';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '../ui/dialog';\r\nimport { Alert, AlertDescription } from '../ui/alert';\r\nimport { Separator } from '../ui/separator';\r\nimport { \r\n  Settings, \r\n  Plus, \r\n  Edit, \r\n  Trash2, \r\n  Search, \r\n  Filter, \r\n  History, \r\n  Shield, \r\n  Globe, \r\n  FileText, \r\n  Users, \r\n  Key,\r\n  Eye,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  Clock\r\n} from 'lucide-react';\r\nimport { ConfigurationSetting, ConfigurationAudit, configurationService } from '../../services/configurationService';\r\nimport ConfigurationFormModal from './ConfigurationFormModal';\r\nimport { notificationService } from '@/services/uiNotificationService';\r\nimport { formatDistanceToNow } from 'date-fns';\r\n\r\nconst SuperAdminSettings: React.FC = () => {\r\n  const [settings, setSettings] = useState<ConfigurationSetting[]>([]);\r\n  const [filteredSettings, setFilteredSettings] = useState<ConfigurationSetting[]>([]);\r\n  const [auditLogs, setAuditLogs] = useState<ConfigurationAudit[]>([]);\r\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [isFormModalOpen, setIsFormModalOpen] = useState(false);\r\n  const [selectedSetting, setSelectedSetting] = useState<ConfigurationSetting | null>(null);\r\n  const [isAuditModalOpen, setIsAuditModalOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState('tenant_defaults');\r\n\r\n  const categories = configurationService.getSuperAdminCategories();\r\n  \r\n  const categoryConfig = {\r\n    tenant_defaults: {\r\n      title: 'Tenant Onboarding Defaults',\r\n      description: 'Default roles, permissions, modules, and notification rules for new tenants',\r\n      icon: Users,\r\n      color: 'bg-blue-500'\r\n    },\r\n    global_email: {\r\n      title: 'Global Email/Notification Configuration',\r\n      description: 'SMTP settings, push notification config, WhatsApp templates, and branding defaults',\r\n      icon: Globe,\r\n      color: 'bg-green-500'\r\n    },\r\n    system_policies: {\r\n      title: 'System Policy Controls',\r\n      description: 'Password policies, session timeouts, MFA settings, and security configurations',\r\n      icon: Shield,\r\n      color: 'bg-red-500'\r\n    },\r\n    pdf_templates: {\r\n      title: 'PDF & Document Templates',\r\n      description: 'Global templates for Service Agreements, Invoices, Job Sheets with tokenized variables',\r\n      icon: FileText,\r\n      color: 'bg-purple-500'\r\n    },\r\n    license_usage: {\r\n      title: 'License & Usage Policy',\r\n      description: 'Tenant license types, user limits, module restrictions, and expiry policies',\r\n      icon: Key,\r\n      color: 'bg-orange-500'\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadSettings();\r\n    loadAuditLogs();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    filterSettings();\r\n  }, [settings, selectedCategory, searchTerm]);\r\n\r\n  const loadSettings = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await configurationService.getSuperAdminSettings();\r\n      setSettings(data);\r\n    } catch (error) {\r\n      console.error('Error loading settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load configuration settings.\",\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadAuditLogs = async () => {\r\n    try {\r\n      const logs = await configurationService.getSuperAdminAuditLogs();\r\n      setAuditLogs(logs);\r\n    } catch (error) {\r\n      console.error('Error loading audit logs:', error);\r\n    }\r\n  };\r\n\r\n  const filterSettings = () => {\r\n    let filtered = settings;\r\n\r\n    if (selectedCategory !== 'all') {\r\n      filtered = filtered.filter(setting => setting.category === selectedCategory);\r\n    }\r\n\r\n    if (searchTerm) {\r\n      filtered = filtered.filter(setting =>\r\n        setting.setting_key.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        setting.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n      );\r\n    }\r\n\r\n    setFilteredSettings(filtered);\r\n  };\r\n\r\n  const handleCreateSetting = () => {\r\n    setSelectedSetting(null);\r\n    setIsFormModalOpen(true);\r\n  };\r\n\r\n  const handleEditSetting = (setting: ConfigurationSetting) => {\r\n    setSelectedSetting(setting);\r\n    setIsFormModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteSetting = async (setting: ConfigurationSetting) => {\r\n    if (!setting.id) return;\r\n\r\n    if (!confirm(`Are you sure you want to delete the setting \"${setting.setting_key}\"?`)) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await configurationService.deleteSuperAdminSetting(setting.id);\r\n      toast({\r\n        title: \"Setting Deleted\",\r\n        description: \"Configuration setting has been deleted successfully.\"\r\n      });\r\n      loadSettings();\r\n      loadAuditLogs();\r\n    } catch (error) {\r\n      console.error('Error deleting setting:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete configuration setting.\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleFormSave = () => {\r\n    loadSettings();\r\n    loadAuditLogs();\r\n  };\r\n\r\n  const renderCategoryOverview = () => {\r\n    const categoryStats = categories.map(category => {\r\n      const categorySettings = settings.filter(s => s.category === category);\r\n      const activeSettings = categorySettings.filter(s => s.is_active);\r\n      \r\n      return {\r\n        category,\r\n        total: categorySettings.length,\r\n        active: activeSettings.length,\r\n        config: categoryConfig[category as keyof typeof categoryConfig]\r\n      };\r\n    });\r\n\r\n    return (\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6\">\r\n        {categoryStats.map(({ category, total, active, config }) => {\r\n          const IconComponent = config.icon;\r\n          \r\n          return (\r\n            <Card \r\n              key={category} \r\n              className={`cursor-pointer transition-all hover:shadow-md ${\r\n                activeTab === category ? 'ring-2 ring-primary' : ''\r\n              }`}\r\n              onClick={() => setActiveTab(category)}\r\n            >\r\n              <CardHeader className=\"pb-3\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className={`p-2 rounded-lg ${config.color} text-white`}>\r\n                    <IconComponent className=\"h-5 w-5\" />\r\n                  </div>\r\n                  <div>\r\n                    <CardTitle className=\"text-sm font-medium\">{config.title}</CardTitle>\r\n                    <CardDescription className=\"text-xs\">{config.description}</CardDescription>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"pt-0\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex space-x-4\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-2xl font-bold text-primary\">{total}</div>\r\n                      <div className=\"text-xs text-muted-foreground\">Total</div>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-2xl font-bold text-green-600\">{active}</div>\r\n                      <div className=\"text-xs text-muted-foreground\">Active</div>\r\n                    </div>\r\n                  </div>\r\n                  <Badge variant={total > 0 ? \"default\" : \"secondary\"}>\r\n                    {total > 0 ? 'Configured' : 'Empty'}\r\n                  </Badge>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderSettingsTable = () => {\r\n    const categorySettings = settings.filter(s => s.category === activeTab);\r\n\r\n    return (\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle className=\"flex items-center space-x-2\">\r\n                <Settings className=\"h-5 w-5\" />\r\n                <span>{categoryConfig[activeTab as keyof typeof categoryConfig]?.title}</span>\r\n              </CardTitle>\r\n              <CardDescription>\r\n                {categoryConfig[activeTab as keyof typeof categoryConfig]?.description}\r\n              </CardDescription>\r\n            </div>\r\n            <div className=\"flex space-x-2\">\r\n              <Button onClick={handleCreateSetting} size=\"sm\">\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Add Setting\r\n              </Button>\r\n              <Button onClick={() => setIsAuditModalOpen(true)} variant=\"outline\" size=\"sm\">\r\n                <History className=\"h-4 w-4 mr-2\" />\r\n                Audit Log\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center space-x-4 mb-4\">\r\n            <div className=\"relative flex-1\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\r\n              <Input\r\n                placeholder=\"Search settings...\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"pl-10\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {isLoading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\r\n            </div>\r\n          ) : categorySettings.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              <Settings className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n              <h3 className=\"text-lg font-medium mb-2\">No Settings Configured</h3>\r\n              <p className=\"mb-4\">Get started by creating your first configuration setting for this category.</p>\r\n              <Button onClick={handleCreateSetting}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Create First Setting\r\n              </Button>\r\n            </div>\r\n          ) : (\r\n            <Table>\r\n              <TableHeader>\r\n                <TableRow>\r\n                  <TableHead>Setting Key</TableHead>\r\n                  <TableHead>Description</TableHead>\r\n                  <TableHead>Status</TableHead>\r\n                  <TableHead>Last Modified</TableHead>\r\n                  <TableHead>Actions</TableHead>\r\n                </TableRow>\r\n              </TableHeader>\r\n              <TableBody>\r\n                {categorySettings.map((setting) => (\r\n                  <TableRow key={setting.id}>\r\n                    <TableCell>\r\n                      <div className=\"font-medium\">{setting.setting_key}</div>\r\n                      <div className=\"text-sm text-muted-foreground\">\r\n                        {Object.keys(setting.setting_value || {}).length} properties\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"max-w-xs truncate\">\r\n                        {setting.description || 'No description'}\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <Badge variant={setting.is_active ? \"default\" : \"secondary\"}>\r\n                        {setting.is_active ? (\r\n                          <>\r\n                            <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                            Active\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <AlertTriangle className=\"h-3 w-3 mr-1\" />\r\n                            Inactive\r\n                          </>\r\n                        )}\r\n                      </Badge>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"text-sm\">\r\n                        {setting.updated_at ? formatDistanceToNow(new Date(setting.updated_at), { addSuffix: true }) : 'Never'}\r\n                      </div>\r\n                      <div className=\"text-xs text-muted-foreground\">\r\n                        by {setting.last_modified_by}\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"flex space-x-2\">\r\n                        <Button\r\n                          onClick={() => handleEditSetting(setting)}\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                        >\r\n                          <Edit className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <Button\r\n                          onClick={() => handleDeleteSetting(setting)}\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"text-red-600 hover:text-red-700\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </TableCell>\r\n                  </TableRow>\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  const renderAuditModal = () => (\r\n    <Dialog open={isAuditModalOpen} onOpenChange={setIsAuditModalOpen}>\r\n      <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center space-x-2\">\r\n            <History className=\"h-5 w-5\" />\r\n            <span>Super Admin Settings Audit Log</span>\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {auditLogs.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              <Clock className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n              <p>No audit logs available</p>\r\n            </div>\r\n          ) : (\r\n            <Table>\r\n              <TableHeader>\r\n                <TableRow>\r\n                  <TableHead>Action</TableHead>\r\n                  <TableHead>User</TableHead>\r\n                  <TableHead>Setting</TableHead>\r\n                  <TableHead>Changes</TableHead>\r\n                  <TableHead>Timestamp</TableHead>\r\n                </TableRow>\r\n              </TableHeader>\r\n              <TableBody>\r\n                {auditLogs.map((log) => (\r\n                  <TableRow key={log.id}>\r\n                    <TableCell>\r\n                      <Badge variant={\r\n                        log.action === 'CREATE' ? 'default' :\r\n                        log.action === 'UPDATE' ? 'secondary' :\r\n                        log.action === 'DELETE' ? 'destructive' : 'outline'\r\n                      }>\r\n                        {log.action}\r\n                      </Badge>\r\n                    </TableCell>\r\n                    <TableCell>{log.user_id}</TableCell>\r\n                    <TableCell>{log.setting_id}</TableCell>\r\n                    <TableCell>\r\n                      <div className=\"text-sm\">\r\n                        {log.change_reason || 'No reason provided'}\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"text-sm\">\r\n                        {log.created_at ? formatDistanceToNow(new Date(log.created_at), { addSuffix: true }) : 'Unknown'}\r\n                      </div>\r\n                    </TableCell>\r\n                  </TableRow>\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          )}\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-8 max-w-7xl mx-auto\">\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n        <div className=\"space-y-1\">\r\n          <h1 className=\"text-2xl font-semibold text-neutral-900 flex items-center gap-2\">\r\n            <div className=\"h-8 w-8 rounded-lg bg-accent-500 flex items-center justify-center\">\r\n              <Settings className=\"h-5 w-5 text-white\" />\r\n            </div>\r\n            Super Admin Configuration\r\n          </h1>\r\n          <p className=\"text-neutral-600\">\r\n            Manage global platform settings, tenant defaults, and system-wide policies\r\n          </p>\r\n        </div>\r\n        <div className=\"flex space-x-2\">\r\n          <Button onClick={() => setIsAuditModalOpen(true)} variant=\"outline\">\r\n            <History className=\"h-4 w-4 mr-2\" />\r\n            View Audit Log\r\n          </Button>\r\n          <Button onClick={handleCreateSetting} className=\"bg-accent-500 hover:bg-accent-600\">\r\n            <Plus className=\"h-4 w-4 mr-2\" />\r\n            New Setting\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <Alert>\r\n        <Shield className=\"h-4 w-4\" />\r\n        <AlertDescription>\r\n          <strong>Security Notice:</strong> These settings affect all tenants and the entire platform. \r\n          Changes are logged and require Super Admin privileges. Always test in a staging environment first.\r\n        </AlertDescription>\r\n      </Alert>\r\n\r\n      {renderCategoryOverview()}\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n        <TabsList className=\"grid w-full grid-cols-5\">\r\n          {categories.map((category) => (\r\n            <TabsTrigger key={category} value={category} className=\"text-xs\">\r\n              {categoryConfig[category as keyof typeof categoryConfig]?.title.split(' ')[0]}\r\n            </TabsTrigger>\r\n          ))}\r\n        </TabsList>\r\n\r\n        {categories.map((category) => (\r\n          <TabsContent key={category} value={category}>\r\n            {renderSettingsTable()}\r\n          </TabsContent>\r\n        ))}\r\n      </Tabs>\r\n\r\n      <ConfigurationFormModal\r\n        isOpen={isFormModalOpen}\r\n        onClose={() => setIsFormModalOpen(false)}\r\n        setting={selectedSetting}\r\n        mode=\"super_admin\"\r\n        onSave={handleFormSave}\r\n      />\r\n\r\n      {renderAuditModal()}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SuperAdminSettings;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\configuration\\TenantAdminSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterSettings'. Either include it or remove the dependency array.","line":89,"column":6,"nodeType":"ArrayExpression","endLine":89,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [settings, selectedCategory, searchTerm, filterSettings]","fix":{"range":[3316,3356],"text":"[settings, selectedCategory, searchTerm, filterSettings]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card';\r\nimport { Button } from '../ui/button';\r\nimport { Input } from '../ui/input';\r\nimport { Badge } from '../ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '../ui/table';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '../ui/dialog';\r\nimport { Alert, AlertDescription } from '../ui/alert';\r\nimport { Separator } from '../ui/separator';\r\nimport { \r\n  Settings, \r\n  Plus, \r\n  Edit, \r\n  Trash2, \r\n  Search, \r\n  History, \r\n  MessageSquare, \r\n  Wrench, \r\n  Bell, \r\n  FileText, \r\n  Package,\r\n  Eye,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  Clock,\r\n  Building,\r\n  Info\r\n} from 'lucide-react';\r\nimport { ConfigurationSetting, ConfigurationAudit, configurationService } from '../../services/configurationService';\r\nimport ConfigurationFormModal from './ConfigurationFormModal';\r\nimport { notificationService } from '@/services/uiNotificationService';\r\nimport { formatDistanceToNow } from 'date-fns';\r\n\r\nconst TenantAdminSettings: React.FC = () => {\r\n  const [settings, setSettings] = useState<ConfigurationSetting[]>([]);\r\n  const [filteredSettings, setFilteredSettings] = useState<ConfigurationSetting[]>([]);\r\n  const [auditLogs, setAuditLogs] = useState<ConfigurationAudit[]>([]);\r\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [isFormModalOpen, setIsFormModalOpen] = useState(false);\r\n  const [selectedSetting, setSelectedSetting] = useState<ConfigurationSetting | null>(null);\r\n  const [isAuditModalOpen, setIsAuditModalOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState('complaint_rules');\r\n\r\n  const categories = configurationService.getTenantCategories();\r\n  \r\n  const categoryConfig = {\r\n    complaint_rules: {\r\n      title: 'Complaint Management Rules',\r\n      description: 'Auto-assignment logic, SLA thresholds, escalation settings, and complaint types',\r\n      icon: MessageSquare,\r\n      color: 'bg-blue-500'\r\n    },\r\n    job_work_config: {\r\n      title: 'Job Work Configuration',\r\n      description: 'Pricing rules, auto-generate job ref ID format, categories, and workflow settings',\r\n      icon: Wrench,\r\n      color: 'bg-green-500'\r\n    },\r\n    notification_preferences: {\r\n      title: 'Notification Preferences',\r\n      description: 'WhatsApp reminders, service contract expiry notifications, and channel preferences',\r\n      icon: Bell,\r\n      color: 'bg-yellow-500'\r\n    },\r\n    pdf_templates: {\r\n      title: 'PDF Templates (Tenant-Scoped)',\r\n      description: 'Custom branding on contracts, tenant-specific templates, and legal disclaimers',\r\n      icon: FileText,\r\n      color: 'bg-purple-500'\r\n    },\r\n    product_defaults: {\r\n      title: 'Product & Service Defaults',\r\n      description: 'Default warranty periods, service charges, and product categorization templates',\r\n      icon: Package,\r\n      color: 'bg-orange-500'\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadSettings();\r\n    loadAuditLogs();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    filterSettings();\r\n  }, [settings, selectedCategory, searchTerm]);\r\n\r\n  const loadSettings = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await configurationService.getTenantSettings();\r\n      setSettings(data);\r\n    } catch (error) {\r\n      console.error('Error loading settings:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load configuration settings.\",\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadAuditLogs = async () => {\r\n    try {\r\n      const logs = await configurationService.getTenantAuditLogs();\r\n      setAuditLogs(logs);\r\n    } catch (error) {\r\n      console.error('Error loading audit logs:', error);\r\n    }\r\n  };\r\n\r\n  const filterSettings = () => {\r\n    let filtered = settings;\r\n\r\n    if (selectedCategory !== 'all') {\r\n      filtered = filtered.filter(setting => setting.category === selectedCategory);\r\n    }\r\n\r\n    if (searchTerm) {\r\n      filtered = filtered.filter(setting =>\r\n        setting.setting_key.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        setting.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n      );\r\n    }\r\n\r\n    setFilteredSettings(filtered);\r\n  };\r\n\r\n  const handleCreateSetting = () => {\r\n    setSelectedSetting(null);\r\n    setIsFormModalOpen(true);\r\n  };\r\n\r\n  const handleEditSetting = (setting: ConfigurationSetting) => {\r\n    setSelectedSetting(setting);\r\n    setIsFormModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteSetting = async (setting: ConfigurationSetting) => {\r\n    if (!setting.id) return;\r\n\r\n    if (!confirm(`Are you sure you want to delete the setting \"${setting.setting_key}\"?`)) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await configurationService.deleteTenantSetting(setting.id);\r\n      toast({\r\n        title: \"Setting Deleted\",\r\n        description: \"Configuration setting has been deleted successfully.\"\r\n      });\r\n      loadSettings();\r\n      loadAuditLogs();\r\n    } catch (error) {\r\n      console.error('Error deleting setting:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete configuration setting.\",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleFormSave = () => {\r\n    loadSettings();\r\n    loadAuditLogs();\r\n  };\r\n\r\n  const renderCategoryOverview = () => {\r\n    const categoryStats = categories.map(category => {\r\n      const categorySettings = settings.filter(s => s.category === category);\r\n      const activeSettings = categorySettings.filter(s => s.is_active);\r\n      \r\n      return {\r\n        category,\r\n        total: categorySettings.length,\r\n        active: activeSettings.length,\r\n        config: categoryConfig[category as keyof typeof categoryConfig]\r\n      };\r\n    });\r\n\r\n    return (\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6\">\r\n        {categoryStats.map(({ category, total, active, config }) => {\r\n          const IconComponent = config.icon;\r\n          \r\n          return (\r\n            <Card \r\n              key={category} \r\n              className={`cursor-pointer transition-all hover:shadow-md ${\r\n                activeTab === category ? 'ring-2 ring-primary' : ''\r\n              }`}\r\n              onClick={() => setActiveTab(category)}\r\n            >\r\n              <CardHeader className=\"pb-3\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className={`p-2 rounded-lg ${config.color} text-white`}>\r\n                    <IconComponent className=\"h-5 w-5\" />\r\n                  </div>\r\n                  <div>\r\n                    <CardTitle className=\"text-sm font-medium\">{config.title}</CardTitle>\r\n                    <CardDescription className=\"text-xs\">{config.description}</CardDescription>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"pt-0\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex space-x-4\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-2xl font-bold text-primary\">{total}</div>\r\n                      <div className=\"text-xs text-muted-foreground\">Total</div>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-2xl font-bold text-green-600\">{active}</div>\r\n                      <div className=\"text-xs text-muted-foreground\">Active</div>\r\n                    </div>\r\n                  </div>\r\n                  <Badge variant={total > 0 ? \"default\" : \"secondary\"}>\r\n                    {total > 0 ? 'Configured' : 'Empty'}\r\n                  </Badge>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderQuickActions = () => {\r\n    const quickActionTemplates = [\r\n      {\r\n        category: 'complaint_rules',\r\n        key: 'auto_assignment',\r\n        title: 'Setup Auto-Assignment',\r\n        description: 'Configure automatic complaint assignment rules',\r\n        icon: MessageSquare\r\n      },\r\n      {\r\n        category: 'notification_preferences',\r\n        key: 'whatsapp_reminders',\r\n        title: 'WhatsApp Reminders',\r\n        description: 'Setup service contract expiry reminders',\r\n        icon: Bell\r\n      },\r\n      {\r\n        category: 'job_work_config',\r\n        key: 'pricing_rules',\r\n        title: 'Job Pricing Rules',\r\n        description: 'Configure default pricing and categories',\r\n        icon: Wrench\r\n      }\r\n    ];\r\n\r\n    return (\r\n      <Card className=\"mb-6\">\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center space-x-2\">\r\n            <Settings className=\"h-5 w-5\" />\r\n            <span>Quick Setup</span>\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Get started quickly with these common configuration templates\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            {quickActionTemplates.map((template) => {\r\n              const IconComponent = template.icon;\r\n              const existingSetting = settings.find(s => \r\n                s.category === template.category && s.setting_key === template.key\r\n              );\r\n              \r\n              return (\r\n                <Card key={`${template.category}-${template.key}`} className=\"cursor-pointer hover:shadow-md transition-all\">\r\n                  <CardContent className=\"p-4\">\r\n                    <div className=\"flex items-start space-x-3\">\r\n                      <div className=\"p-2 rounded-lg bg-primary/10 text-primary\">\r\n                        <IconComponent className=\"h-4 w-4\" />\r\n                      </div>\r\n                      <div className=\"flex-1\">\r\n                        <h4 className=\"font-medium text-sm\">{template.title}</h4>\r\n                        <p className=\"text-xs text-muted-foreground mb-3\">{template.description}</p>\r\n                        <Button \r\n                          size=\"sm\" \r\n                          variant={existingSetting ? \"outline\" : \"default\"}\r\n                          onClick={() => {\r\n                            if (existingSetting) {\r\n                              handleEditSetting(existingSetting);\r\n                            } else {\r\n                              // Create with template\r\n                              setSelectedSetting({\r\n                                category: template.category,\r\n                                setting_key: template.key,\r\n                                setting_value: {},\r\n                                description: template.description,\r\n                                is_active: true,\r\n                                last_modified_by: 'current_user'\r\n                              } as ConfigurationSetting);\r\n                              setIsFormModalOpen(true);\r\n                            }\r\n                          }}\r\n                        >\r\n                          {existingSetting ? 'Edit' : 'Setup'}\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  const renderSettingsTable = () => {\r\n    const categorySettings = settings.filter(s => s.category === activeTab);\r\n\r\n    return (\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle className=\"flex items-center space-x-2\">\r\n                <Settings className=\"h-5 w-5\" />\r\n                <span>{categoryConfig[activeTab as keyof typeof categoryConfig]?.title}</span>\r\n              </CardTitle>\r\n              <CardDescription>\r\n                {categoryConfig[activeTab as keyof typeof categoryConfig]?.description}\r\n              </CardDescription>\r\n            </div>\r\n            <div className=\"flex space-x-2\">\r\n              <Button onClick={handleCreateSetting} size=\"sm\">\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Add Setting\r\n              </Button>\r\n              <Button onClick={() => setIsAuditModalOpen(true)} variant=\"outline\" size=\"sm\">\r\n                <History className=\"h-4 w-4 mr-2\" />\r\n                Audit Log\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center space-x-4 mb-4\">\r\n            <div className=\"relative flex-1\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\r\n              <Input\r\n                placeholder=\"Search settings...\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"pl-10\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {isLoading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\" />\r\n            </div>\r\n          ) : categorySettings.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              <Settings className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n              <h3 className=\"text-lg font-medium mb-2\">No Settings Configured</h3>\r\n              <p className=\"mb-4\">Configure your first setting for this category to customize your tenant's behavior.</p>\r\n              <Button onClick={handleCreateSetting}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Create First Setting\r\n              </Button>\r\n            </div>\r\n          ) : (\r\n            <Table>\r\n              <TableHeader>\r\n                <TableRow>\r\n                  <TableHead>Setting Key</TableHead>\r\n                  <TableHead>Description</TableHead>\r\n                  <TableHead>Status</TableHead>\r\n                  <TableHead>Last Modified</TableHead>\r\n                  <TableHead>Actions</TableHead>\r\n                </TableRow>\r\n              </TableHeader>\r\n              <TableBody>\r\n                {categorySettings.map((setting) => (\r\n                  <TableRow key={setting.id}>\r\n                    <TableCell>\r\n                      <div className=\"font-medium\">{setting.setting_key}</div>\r\n                      <div className=\"text-sm text-muted-foreground\">\r\n                        {Object.keys(setting.setting_value || {}).length} properties\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"max-w-xs truncate\">\r\n                        {setting.description || 'No description'}\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <Badge variant={setting.is_active ? \"default\" : \"secondary\"}>\r\n                        {setting.is_active ? (\r\n                          <>\r\n                            <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                            Active\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <AlertTriangle className=\"h-3 w-3 mr-1\" />\r\n                            Inactive\r\n                          </>\r\n                        )}\r\n                      </Badge>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"text-sm\">\r\n                        {setting.updated_at ? formatDistanceToNow(new Date(setting.updated_at), { addSuffix: true }) : 'Never'}\r\n                      </div>\r\n                      <div className=\"text-xs text-muted-foreground\">\r\n                        by {setting.last_modified_by}\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"flex space-x-2\">\r\n                        <Button\r\n                          onClick={() => handleEditSetting(setting)}\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                        >\r\n                          <Edit className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <Button\r\n                          onClick={() => handleDeleteSetting(setting)}\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"text-red-600 hover:text-red-700\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </TableCell>\r\n                  </TableRow>\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  const renderAuditModal = () => (\r\n    <Dialog open={isAuditModalOpen} onOpenChange={setIsAuditModalOpen}>\r\n      <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center space-x-2\">\r\n            <History className=\"h-5 w-5\" />\r\n            <span>Tenant Settings Audit Log</span>\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {auditLogs.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              <Clock className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n              <p>No audit logs available</p>\r\n            </div>\r\n          ) : (\r\n            <Table>\r\n              <TableHeader>\r\n                <TableRow>\r\n                  <TableHead>Action</TableHead>\r\n                  <TableHead>User</TableHead>\r\n                  <TableHead>Setting</TableHead>\r\n                  <TableHead>Changes</TableHead>\r\n                  <TableHead>Timestamp</TableHead>\r\n                </TableRow>\r\n              </TableHeader>\r\n              <TableBody>\r\n                {auditLogs.map((log) => (\r\n                  <TableRow key={log.id}>\r\n                    <TableCell>\r\n                      <Badge variant={\r\n                        log.action === 'CREATE' ? 'default' :\r\n                        log.action === 'UPDATE' ? 'secondary' :\r\n                        log.action === 'DELETE' ? 'destructive' : 'outline'\r\n                      }>\r\n                        {log.action}\r\n                      </Badge>\r\n                    </TableCell>\r\n                    <TableCell>{log.user_id}</TableCell>\r\n                    <TableCell>{log.setting_id}</TableCell>\r\n                    <TableCell>\r\n                      <div className=\"text-sm\">\r\n                        {log.change_reason || 'No reason provided'}\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"text-sm\">\r\n                        {log.created_at ? formatDistanceToNow(new Date(log.created_at), { addSuffix: true }) : 'Unknown'}\r\n                      </div>\r\n                    </TableCell>\r\n                  </TableRow>\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          )}\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight\">Tenant Configuration</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Manage tenant-specific settings, operational rules, and preferences\r\n          </p>\r\n        </div>\r\n        <div className=\"flex space-x-2\">\r\n          <Button onClick={() => setIsAuditModalOpen(true)} variant=\"outline\">\r\n            <History className=\"h-4 w-4 mr-2\" />\r\n            View Audit Log\r\n          </Button>\r\n          <Button onClick={handleCreateSetting}>\r\n            <Plus className=\"h-4 w-4 mr-2\" />\r\n            New Setting\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <Alert>\r\n        <Building className=\"h-4 w-4\" />\r\n        <AlertDescription>\r\n          <strong>Tenant Scope:</strong> These settings only affect your tenant and its users. \r\n          Changes are logged and require Tenant Admin privileges. Settings sync in real-time across your organization.\r\n        </AlertDescription>\r\n      </Alert>\r\n\r\n      {renderQuickActions()}\r\n      {renderCategoryOverview()}\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n        <TabsList className=\"grid w-full grid-cols-5\">\r\n          {categories.map((category) => (\r\n            <TabsTrigger key={category} value={category} className=\"text-xs\">\r\n              {categoryConfig[category as keyof typeof categoryConfig]?.title.split(' ')[0]}\r\n            </TabsTrigger>\r\n          ))}\r\n        </TabsList>\r\n\r\n        {categories.map((category) => (\r\n          <TabsContent key={category} value={category}>\r\n            {renderSettingsTable()}\r\n          </TabsContent>\r\n        ))}\r\n      </Tabs>\r\n\r\n      <ConfigurationFormModal\r\n        isOpen={isFormModalOpen}\r\n        onClose={() => setIsFormModalOpen(false)}\r\n        setting={selectedSetting}\r\n        mode=\"tenant\"\r\n        onSave={handleFormSave}\r\n      />\r\n\r\n      {renderAuditModal()}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TenantAdminSettings;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractAnalytics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractApprovalWorkflow.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadApprovalRecords' and 'loadApprovalWorkflow'. Either include them or remove the dependency array.","line":78,"column":6,"nodeType":"ArrayExpression","endLine":78,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, loadApprovalRecords, loadApprovalWorkflow]","fix":{"range":[2503,2516],"text":"[contract.id, loadApprovalRecords, loadApprovalWorkflow]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Contract, ApprovalRecord } from '@/types/contracts';\nimport { contractService } from '@/services';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { toast } from 'sonner';\nimport {\n  GitBranch,\n  CheckCircle,\n  XCircle,\n  Clock,\n  User,\n  MessageSquare,\n  Send,\n  Eye,\n  AlertTriangle,\n  Calendar,\n  ArrowRight,\n  Plus,\n  Edit\n} from 'lucide-react';\n\ninterface ApprovalStep {\n  id: string;\n  stepNumber: number;\n  title: string;\n  description: string;\n  approverRole: string;\n  approverName?: string;\n  approverId?: string;\n  status: 'pending' | 'approved' | 'rejected' | 'skipped';\n  isRequired: boolean;\n  approvedAt?: string;\n  rejectedAt?: string;\n  comments?: string;\n  canApprove?: boolean;\n}\n\ninterface ContractApprovalWorkflowProps {\n  contract: Contract;\n  onApprovalUpdate?: () => void;\n}\n\nconst ContractApprovalWorkflow: React.FC<ContractApprovalWorkflowProps> = ({\n  contract,\n  onApprovalUpdate\n}) => {\n  const { user, hasPermission } = useAuth();\n  const [approvalSteps, setApprovalSteps] = useState<ApprovalStep[]>([]);\n  const [approvalRecords, setApprovalRecords] = useState<ApprovalRecord[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showApprovalModal, setShowApprovalModal] = useState(false);\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const [selectedStep, setSelectedStep] = useState<ApprovalStep | null>(null);\n  const [approvalForm, setApprovalForm] = useState({\n    comments: '',\n    conditions: ''\n  });\n  const [rejectionForm, setRejectionForm] = useState({\n    reason: '',\n    comments: '',\n    suggestions: ''\n  });\n\n  useEffect(() => {\n    loadApprovalWorkflow();\n    loadApprovalRecords();\n  }, [contract.id]);\n\n  const loadApprovalWorkflow = async () => {\n    try {\n      setLoading(true);\n      const data = await contractService.getApprovalWorkflow(contract.id);\n      setApprovalSteps(data);\n    } catch (error) {\n      toast.error('Failed to load approval workflow');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadApprovalRecords = async () => {\n    try {\n      const data = await contractService.getApprovalRecords(contract.id);\n      setApprovalRecords(data);\n    } catch (error) {\n      console.error('Failed to load approval records:', error);\n    }\n  };\n\n  const handleApprove = async () => {\n    if (!selectedStep) return;\n\n    try {\n      await contractService.approveContractStep(contract.id, selectedStep.id, {\n        comments: approvalForm.comments,\n        conditions: approvalForm.conditions\n      });\n      toast.success('Contract step approved successfully');\n      setShowApprovalModal(false);\n      setApprovalForm({ comments: '', conditions: '' });\n      loadApprovalWorkflow();\n      loadApprovalRecords();\n      onApprovalUpdate?.();\n    } catch (error) {\n      toast.error('Failed to approve contract step');\n    }\n  };\n\n  const handleReject = async () => {\n    if (!selectedStep) return;\n\n    try {\n      await contractService.rejectContractStep(contract.id, selectedStep.id, {\n        reason: rejectionForm.reason,\n        comments: rejectionForm.comments,\n        suggestions: rejectionForm.suggestions\n      });\n      toast.success('Contract step rejected');\n      setShowRejectModal(false);\n      setRejectionForm({ reason: '', comments: '', suggestions: '' });\n      loadApprovalWorkflow();\n      loadApprovalRecords();\n      onApprovalUpdate?.();\n    } catch (error) {\n      toast.error('Failed to reject contract step');\n    }\n  };\n\n  const handleRequestApproval = async () => {\n    try {\n      await contractService.requestContractApproval(contract.id);\n      toast.success('Approval request sent successfully');\n      loadApprovalWorkflow();\n      onApprovalUpdate?.();\n    } catch (error) {\n      toast.error('Failed to request approval');\n    }\n  };\n\n  const openApprovalModal = (step: ApprovalStep) => {\n    setSelectedStep(step);\n    setShowApprovalModal(true);\n  };\n\n  const openRejectModal = (step: ApprovalStep) => {\n    setSelectedStep(step);\n    setShowRejectModal(true);\n  };\n\n  const getStepIcon = (status: string) => {\n    switch (status) {\n      case 'approved':\n        return <CheckCircle className=\"h-5 w-5 text-green-600\" />;\n      case 'rejected':\n        return <XCircle className=\"h-5 w-5 text-red-600\" />;\n      case 'pending':\n        return <Clock className=\"h-5 w-5 text-yellow-600\" />;\n      case 'skipped':\n        return <ArrowRight className=\"h-5 w-5 text-gray-400\" />;\n      default:\n        return <Clock className=\"h-5 w-5 text-gray-400\" />;\n    }\n  };\n\n  const getStepBadge = (status: string) => {\n    const variants = {\n      approved: 'default',\n      rejected: 'destructive',\n      pending: 'secondary',\n      skipped: 'outline'\n    } as const;\n\n    return (\n      <Badge variant={variants[status as keyof typeof variants] || 'outline'}>\n        {status.toUpperCase()}\n      </Badge>\n    );\n  };\n\n  const getApprovalProgress = () => {\n    const totalSteps = approvalSteps.filter(step => step.isRequired).length;\n    const approvedSteps = approvalSteps.filter(step => step.status === 'approved' && step.isRequired).length;\n    return totalSteps > 0 ? (approvedSteps / totalSteps) * 100 : 0;\n  };\n\n  const getCurrentStep = () => {\n    return approvalSteps.find(step => step.status === 'pending' && step.isRequired);\n  };\n\n  const canRequestApproval = hasPermission('manage_contracts') && contract.approval_stage === 'draft';\n  const canManageWorkflow = hasPermission('manage_approval_workflows');\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <GitBranch className=\"h-5 w-5\" />\n            Approval Workflow\n          </CardTitle>\n          <CardDescription>\n            Track and manage the contract approval process\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Approval Progress */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h4 className=\"font-medium\">Approval Progress</h4>\n              <Badge variant={contract.approval_stage === 'approved' ? 'default' : 'secondary'}>\n                {contract.approval_stage?.toUpperCase() || 'DRAFT'}\n              </Badge>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span>Progress</span>\n                <span>\n                  {approvalSteps.filter(s => s.status === 'approved' && s.isRequired).length} of{' '}\n                  {approvalSteps.filter(s => s.isRequired).length} steps completed\n                </span>\n              </div>\n              <Progress value={getApprovalProgress()} className=\"h-2\" />\n            </div>\n          </div>\n\n          {/* Current Step Alert */}\n          {getCurrentStep() && (\n            <Alert>\n              <Clock className=\"h-4 w-4\" />\n              <AlertDescription>\n                <div className=\"flex items-center justify-between\">\n                  <span>\n                    Waiting for approval from <strong>{getCurrentStep()?.approverRole}</strong>\n                  </span>\n                  {getCurrentStep()?.canApprove && (\n                    <div className=\"flex gap-2\">\n                      <Button size=\"sm\" onClick={() => openApprovalModal(getCurrentStep()!)}>\n                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n                        Approve\n                      </Button>\n                      <Button size=\"sm\" variant=\"outline\" onClick={() => openRejectModal(getCurrentStep()!)}>\n                        <XCircle className=\"h-4 w-4 mr-2\" />\n                        Reject\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-2\">\n            {canRequestApproval && (\n              <Button onClick={handleRequestApproval}>\n                <Send className=\"h-4 w-4 mr-2\" />\n                Request Approval\n              </Button>\n            )}\n          </div>\n\n          {/* Approval Steps */}\n          {loading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : approvalSteps.length === 0 ? (\n            <Alert>\n              <GitBranch className=\"h-4 w-4\" />\n              <AlertDescription>\n                No approval workflow has been configured for this contract.\n              </AlertDescription>\n            </Alert>\n          ) : (\n            <div className=\"space-y-4\">\n              <h4 className=\"font-medium\">Approval Steps</h4>\n              <div className=\"space-y-3\">\n                {approvalSteps.map((step, index) => (\n                  <Card key={step.id} className={`p-4 ${step.status === 'pending' ? 'border-yellow-200 bg-yellow-50' : ''}`}>\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-start gap-3\">\n                        <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-muted\">\n                          {step.stepNumber}\n                        </div>\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <h5 className=\"font-medium\">{step.title}</h5>\n                            {step.isRequired && (\n                              <Badge variant=\"outline\" className=\"text-xs\">Required</Badge>\n                            )}\n                          </div>\n                          <p className=\"text-sm text-muted-foreground\">{step.description}</p>\n                          <div className=\"flex items-center gap-2 text-sm\">\n                            <User className=\"h-4 w-4\" />\n                            <span>{step.approverRole}</span>\n                            {step.approverName && (\n                              <span className=\"text-muted-foreground\">({step.approverName})</span>\n                            )}\n                          </div>\n                          {step.comments && (\n                            <div className=\"flex items-start gap-2 text-sm\">\n                              <MessageSquare className=\"h-4 w-4 mt-0.5\" />\n                              <span className=\"text-muted-foreground\">{step.comments}</span>\n                            </div>\n                          )}\n                          {(step.approvedAt || step.rejectedAt) && (\n                            <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                              <Calendar className=\"h-3 w-3\" />\n                              <span>\n                                {step.status === 'approved' ? 'Approved' : 'Rejected'} on{' '}\n                                {new Date(step.approvedAt || step.rejectedAt!).toLocaleDateString()}\n                              </span>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {getStepIcon(step.status)}\n                        {getStepBadge(step.status)}\n                        {step.canApprove && step.status === 'pending' && (\n                          <div className=\"flex gap-1 ml-2\">\n                            <Button size=\"sm\" onClick={() => openApprovalModal(step)}>\n                              <CheckCircle className=\"h-4 w-4\" />\n                            </Button>\n                            <Button size=\"sm\" variant=\"outline\" onClick={() => openRejectModal(step)}>\n                              <XCircle className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Approval History */}\n          {approvalRecords.length > 0 && (\n            <div className=\"space-y-4\">\n              <h4 className=\"font-medium\">Approval History</h4>\n              <div className=\"space-y-2\">\n                {approvalRecords.slice(0, 5).map((record) => (\n                  <div key={record.id} className=\"flex items-center gap-3 p-3 border rounded\">\n                    <Avatar className=\"h-8 w-8\">\n                      <AvatarImage src={record.approverAvatar} />\n                      <AvatarFallback>\n                        {record.approverName.split(' ').map(n => n[0]).join('')}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-medium\">{record.approverName}</span>\n                        <Badge variant={record.decision === 'approved' ? 'default' : 'destructive'}>\n                          {record.decision.toUpperCase()}\n                        </Badge>\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {record.comments || `${record.decision === 'approved' ? 'Approved' : 'Rejected'} the contract`}\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      {new Date(record.timestamp).toLocaleDateString()}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Approval Modal */}\n      <Dialog open={showApprovalModal} onOpenChange={setShowApprovalModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Approve Contract Step</DialogTitle>\n            <DialogDescription>\n              Approve \"{selectedStep?.title}\" for this contract.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"comments\">Comments</Label>\n              <Textarea\n                id=\"comments\"\n                value={approvalForm.comments}\n                onChange={(e) => setApprovalForm(prev => ({ ...prev, comments: e.target.value }))}\n                placeholder=\"Add comments about your approval\"\n                rows={3}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"conditions\">Conditions (Optional)</Label>\n              <Textarea\n                id=\"conditions\"\n                value={approvalForm.conditions}\n                onChange={(e) => setApprovalForm(prev => ({ ...prev, conditions: e.target.value }))}\n                placeholder=\"Any conditions or requirements for this approval\"\n                rows={2}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowApprovalModal(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleApprove}>\n              <CheckCircle className=\"h-4 w-4 mr-2\" />\n              Approve\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Rejection Modal */}\n      <Dialog open={showRejectModal} onOpenChange={setShowRejectModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Reject Contract Step</DialogTitle>\n            <DialogDescription>\n              Reject \"{selectedStep?.title}\" and provide feedback.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reason\">Reason for Rejection</Label>\n              <Select value={rejectionForm.reason} onValueChange={(value) => setRejectionForm(prev => ({ ...prev, reason: value }))}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select a reason\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"incomplete_information\">Incomplete Information</SelectItem>\n                  <SelectItem value=\"legal_concerns\">Legal Concerns</SelectItem>\n                  <SelectItem value=\"financial_terms\">Financial Terms</SelectItem>\n                  <SelectItem value=\"compliance_issues\">Compliance Issues</SelectItem>\n                  <SelectItem value=\"other\">Other</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"rejectionComments\">Comments</Label>\n              <Textarea\n                id=\"rejectionComments\"\n                value={rejectionForm.comments}\n                onChange={(e) => setRejectionForm(prev => ({ ...prev, comments: e.target.value }))}\n                placeholder=\"Explain why you're rejecting this step\"\n                rows={3}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"suggestions\">Suggestions for Improvement</Label>\n              <Textarea\n                id=\"suggestions\"\n                value={rejectionForm.suggestions}\n                onChange={(e) => setRejectionForm(prev => ({ ...prev, suggestions: e.target.value }))}\n                placeholder=\"Provide suggestions for addressing the issues\"\n                rows={2}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowRejectModal(false)}>\n              Cancel\n            </Button>\n            <Button variant=\"destructive\" onClick={handleReject} disabled={!rejectionForm.reason}>\n              <XCircle className=\"h-4 w-4 mr-2\" />\n              Reject\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default ContractApprovalWorkflow;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractAttachmentManager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAttachments'. Either include it or remove the dependency array.","line":82,"column":6,"nodeType":"ArrayExpression","endLine":82,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, loadAttachments]","fix":{"range":[2950,2963],"text":"[contract.id, loadAttachments]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { Contract } from '@/types/contracts';\r\nimport { contractService } from '@/services';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\r\nimport { toast } from 'sonner';\r\nimport {\r\n  Paperclip,\r\n  Upload,\r\n  Download,\r\n  Eye,\r\n  Trash2,\r\n  MoreHorizontal,\r\n  FileText,\r\n  Image,\r\n  File,\r\n  Calendar,\r\n  User,\r\n  AlertCircle,\r\n  CheckCircle,\r\n  Plus,\r\n  Search\r\n} from 'lucide-react';\r\n\r\ninterface ContractAttachment {\r\n  id: string;\r\n  fileName: string;\r\n  originalName: string;\r\n  fileSize: number;\r\n  fileType: string;\r\n  category: 'contract_document' | 'supporting_document' | 'amendment' | 'signature' | 'other';\r\n  description?: string;\r\n  uploadedBy: string;\r\n  uploadedByName: string;\r\n  uploadedAt: string;\r\n  downloadUrl: string;\r\n  previewUrl?: string;\r\n  isPublic: boolean;\r\n  version?: number;\r\n}\r\n\r\ninterface ContractAttachmentManagerProps {\r\n  contract: Contract;\r\n  onAttachmentUpdate?: () => void;\r\n}\r\n\r\nconst ContractAttachmentManager: React.FC<ContractAttachmentManagerProps> = ({\r\n  contract,\r\n  onAttachmentUpdate\r\n}) => {\r\n  const { user, hasPermission } = useAuth();\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [attachments, setAttachments] = useState<ContractAttachment[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [showUploadModal, setShowUploadModal] = useState(false);\r\n  const [showPreviewModal, setShowPreviewModal] = useState(false);\r\n  const [selectedAttachment, setSelectedAttachment] = useState<ContractAttachment | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [categoryFilter, setCategoryFilter] = useState('');\r\n  const [uploadForm, setUploadForm] = useState({\r\n    files: [] as File[],\r\n    category: 'supporting_document' as const,\r\n    description: '',\r\n    isPublic: false\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadAttachments();\r\n  }, [contract.id]);\r\n\r\n  const loadAttachments = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await contractService.getContractAttachments(contract.id);\r\n      setAttachments(data);\r\n    } catch (error) {\r\n      toast.error('Failed to load attachments');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = Array.from(event.target.files || []);\r\n    if (files.length > 0) {\r\n      setUploadForm(prev => ({ ...prev, files }));\r\n      setShowUploadModal(true);\r\n    }\r\n  };\r\n\r\n  const handleUpload = async () => {\r\n    if (uploadForm.files.length === 0) return;\r\n\r\n    try {\r\n      setUploading(true);\r\n      setUploadProgress(0);\r\n\r\n      // Simulate upload progress\r\n      const progressInterval = setInterval(() => {\r\n        setUploadProgress(prev => {\r\n          if (prev >= 90) {\r\n            clearInterval(progressInterval);\r\n            return prev;\r\n          }\r\n          return prev + 10;\r\n        });\r\n      }, 200);\r\n\r\n      await contractService.uploadContractAttachment(contract.id, {\r\n        files: uploadForm.files,\r\n        category: uploadForm.category,\r\n        description: uploadForm.description,\r\n        isPublic: uploadForm.isPublic\r\n      });\r\n\r\n      clearInterval(progressInterval);\r\n      setUploadProgress(100);\r\n      \r\n      toast.success(`${uploadForm.files.length} file(s) uploaded successfully`);\r\n      setShowUploadModal(false);\r\n      setUploadForm({ files: [], category: 'supporting_document', description: '', isPublic: false });\r\n      loadAttachments();\r\n      onAttachmentUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to upload files');\r\n    } finally {\r\n      setUploading(false);\r\n      setUploadProgress(0);\r\n    }\r\n  };\r\n\r\n  const handleDownload = (attachment: ContractAttachment) => {\r\n    window.open(attachment.downloadUrl, '_blank');\r\n  };\r\n\r\n  const handlePreview = (attachment: ContractAttachment) => {\r\n    if (attachment.previewUrl) {\r\n      setSelectedAttachment(attachment);\r\n      setShowPreviewModal(true);\r\n    } else {\r\n      toast.error('Preview not available for this file type');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (attachment: ContractAttachment) => {\r\n    if (!confirm(`Are you sure you want to delete \"${attachment.originalName}\"?`)) return;\r\n\r\n    try {\r\n      await contractService.deleteContractAttachment(attachment.id);\r\n      toast.success('Attachment deleted successfully');\r\n      loadAttachments();\r\n      onAttachmentUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to delete attachment');\r\n    }\r\n  };\r\n\r\n  const getFileIcon = (fileType: string) => {\r\n    if (fileType.startsWith('image/')) {\r\n      return <Image className=\"h-4 w-4 text-blue-600\" />;\r\n    } else if (fileType.includes('pdf')) {\r\n      return <FileText className=\"h-4 w-4 text-red-600\" />;\r\n    } else {\r\n      return <File className=\"h-4 w-4 text-gray-600\" />;\r\n    }\r\n  };\r\n\r\n  const getCategoryBadge = (category: string) => {\r\n    const colors = {\r\n      contract_document: 'bg-blue-100 text-blue-800',\r\n      supporting_document: 'bg-green-100 text-green-800',\r\n      amendment: 'bg-yellow-100 text-yellow-800',\r\n      signature: 'bg-purple-100 text-purple-800',\r\n      other: 'bg-gray-100 text-gray-800'\r\n    };\r\n\r\n    return (\r\n      <Badge className={colors[category as keyof typeof colors] || 'bg-gray-100 text-gray-800'}>\r\n        {category.replace('_', ' ').toUpperCase()}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n  };\r\n\r\n  const filteredAttachments = attachments.filter(attachment => {\r\n    const matchesSearch = attachment.originalName.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                         attachment.description?.toLowerCase().includes(searchTerm.toLowerCase());\r\n    const matchesCategory = !categoryFilter || attachment.category === categoryFilter;\r\n    return matchesSearch && matchesCategory;\r\n  });\r\n\r\n  const canUploadAttachments = hasPermission('manage_contracts');\r\n  const canDeleteAttachments = hasPermission('manage_contracts');\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Paperclip className=\"h-5 w-5\" />\r\n            Contract Attachments\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Manage documents and files related to this contract\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          {/* Upload and Filters */}\r\n          <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\r\n            <div className=\"flex gap-2\">\r\n              {canUploadAttachments && (\r\n                <>\r\n                  <Button onClick={() => fileInputRef.current?.click()}>\r\n                    <Upload className=\"h-4 w-4 mr-2\" />\r\n                    Upload Files\r\n                  </Button>\r\n                  <input\r\n                    ref={fileInputRef}\r\n                    type=\"file\"\r\n                    multiple\r\n                    className=\"hidden\"\r\n                    onChange={handleFileSelect}\r\n                    accept=\".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif\"\r\n                  />\r\n                </>\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"flex gap-2 w-full sm:w-auto\">\r\n              <div className=\"relative flex-1 sm:w-64\">\r\n                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Search attachments...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"pl-8\"\r\n                />\r\n              </div>\r\n              <Select value={categoryFilter} onValueChange={setCategoryFilter}>\r\n                <SelectTrigger className=\"w-48\">\r\n                  <SelectValue placeholder=\"All categories\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"\">All categories</SelectItem>\r\n                  <SelectItem value=\"contract_document\">Contract Document</SelectItem>\r\n                  <SelectItem value=\"supporting_document\">Supporting Document</SelectItem>\r\n                  <SelectItem value=\"amendment\">Amendment</SelectItem>\r\n                  <SelectItem value=\"signature\">Signature</SelectItem>\r\n                  <SelectItem value=\"other\">Other</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Attachments Summary */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-blue-600\">{attachments.length}</div>\r\n                <div className=\"text-sm text-muted-foreground\">Total Files</div>\r\n              </div>\r\n            </Card>\r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-green-600\">\r\n                  {attachments.filter(a => a.category === 'contract_document').length}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Contract Docs</div>\r\n              </div>\r\n            </Card>\r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-purple-600\">\r\n                  {attachments.filter(a => a.category === 'signature').length}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Signatures</div>\r\n              </div>\r\n            </Card>\r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-orange-600\">\r\n                  {formatFileSize(attachments.reduce((total, a) => total + a.fileSize, 0))}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Total Size</div>\r\n              </div>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Attachments Table */}\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n            </div>\r\n          ) : filteredAttachments.length === 0 ? (\r\n            <Alert>\r\n              <Paperclip className=\"h-4 w-4\" />\r\n              <AlertDescription>\r\n                {attachments.length === 0 \r\n                  ? 'No attachments have been uploaded for this contract yet.'\r\n                  : 'No attachments match your current filters.'\r\n                }\r\n              </AlertDescription>\r\n            </Alert>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    <TableHead>File</TableHead>\r\n                    <TableHead>Category</TableHead>\r\n                    <TableHead>Size</TableHead>\r\n                    <TableHead>Uploaded By</TableHead>\r\n                    <TableHead>Upload Date</TableHead>\r\n                    <TableHead>Actions</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {filteredAttachments.map((attachment) => (\r\n                    <TableRow key={attachment.id}>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-3\">\r\n                          {getFileIcon(attachment.fileType)}\r\n                          <div>\r\n                            <div className=\"font-medium\">{attachment.originalName}</div>\r\n                            {attachment.description && (\r\n                              <div className=\"text-sm text-muted-foreground\">\r\n                                {attachment.description}\r\n                              </div>\r\n                            )}\r\n                            {attachment.version && (\r\n                              <Badge variant=\"outline\" className=\"text-xs mt-1\">\r\n                                v{attachment.version}\r\n                              </Badge>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {getCategoryBadge(attachment.category)}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"text-sm\">{formatFileSize(attachment.fileSize)}</div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <User className=\"h-4 w-4\" />\r\n                          <span className=\"text-sm\">{attachment.uploadedByName}</span>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Calendar className=\"h-4 w-4\" />\r\n                          <span className=\"text-sm\">\r\n                            {new Date(attachment.uploadedAt).toLocaleDateString()}\r\n                          </span>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <DropdownMenu>\r\n                          <DropdownMenuTrigger asChild>\r\n                            <Button variant=\"ghost\" size=\"sm\">\r\n                              <MoreHorizontal className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          </DropdownMenuTrigger>\r\n                          <DropdownMenuContent align=\"end\">\r\n                            <DropdownMenuItem onClick={() => handleDownload(attachment)}>\r\n                              <Download className=\"h-4 w-4 mr-2\" />\r\n                              Download\r\n                            </DropdownMenuItem>\r\n                            {attachment.previewUrl && (\r\n                              <DropdownMenuItem onClick={() => handlePreview(attachment)}>\r\n                                <Eye className=\"h-4 w-4 mr-2\" />\r\n                                Preview\r\n                              </DropdownMenuItem>\r\n                            )}\r\n                            {canDeleteAttachments && (\r\n                              <DropdownMenuItem \r\n                                onClick={() => handleDelete(attachment)}\r\n                                className=\"text-destructive\"\r\n                              >\r\n                                <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                                Delete\r\n                              </DropdownMenuItem>\r\n                            )}\r\n                          </DropdownMenuContent>\r\n                        </DropdownMenu>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Upload Modal */}\r\n      <Dialog open={showUploadModal} onOpenChange={setShowUploadModal}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Upload Attachments</DialogTitle>\r\n            <DialogDescription>\r\n              Upload files related to this contract\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            {/* Selected Files */}\r\n            <div className=\"space-y-2\">\r\n              <Label>Selected Files</Label>\r\n              <div className=\"border rounded p-3 max-h-32 overflow-y-auto\">\r\n                {uploadForm.files.length === 0 ? (\r\n                  <div className=\"text-sm text-muted-foreground\">No files selected</div>\r\n                ) : (\r\n                  <div className=\"space-y-1\">\r\n                    {uploadForm.files.map((file, index) => (\r\n                      <div key={index} className=\"flex items-center gap-2 text-sm\">\r\n                        {getFileIcon(file.type)}\r\n                        <span>{file.name}</span>\r\n                        <span className=\"text-muted-foreground\">({formatFileSize(file.size)})</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"category\">Category</Label>\r\n                <Select value={uploadForm.category} onValueChange={(value: string) => setUploadForm(prev => ({ ...prev, category: value }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"contract_document\">Contract Document</SelectItem>\r\n                    <SelectItem value=\"supporting_document\">Supporting Document</SelectItem>\r\n                    <SelectItem value=\"amendment\">Amendment</SelectItem>\r\n                    <SelectItem value=\"signature\">Signature</SelectItem>\r\n                    <SelectItem value=\"other\">Other</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Label>Visibility</Label>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"isPublic\"\r\n                    checked={uploadForm.isPublic}\r\n                    onChange={(e) => setUploadForm(prev => ({ ...prev, isPublic: e.target.checked }))}\r\n                  />\r\n                  <Label htmlFor=\"isPublic\" className=\"text-sm\">Make files public</Label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"description\">Description (Optional)</Label>\r\n              <Textarea\r\n                id=\"description\"\r\n                value={uploadForm.description}\r\n                onChange={(e) => setUploadForm(prev => ({ ...prev, description: e.target.value }))}\r\n                placeholder=\"Add a description for these files\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n\r\n            {uploading && (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"text-sm\">Uploading files...</span>\r\n                </div>\r\n                <Progress value={uploadProgress} className=\"h-2\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowUploadModal(false)} disabled={uploading}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleUpload} disabled={uploadForm.files.length === 0 || uploading}>\r\n              <Upload className=\"h-4 w-4 mr-2\" />\r\n              Upload Files\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Preview Modal */}\r\n      <Dialog open={showPreviewModal} onOpenChange={setShowPreviewModal}>\r\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>File Preview</DialogTitle>\r\n            <DialogDescription>\r\n              {selectedAttachment?.originalName}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"py-4\">\r\n            {selectedAttachment?.previewUrl && (\r\n              <div className=\"border rounded p-4 bg-white\">\r\n                {selectedAttachment.fileType.startsWith('image/') ? (\r\n                  <img \r\n                    src={selectedAttachment.previewUrl} \r\n                    alt={selectedAttachment.originalName}\r\n                    className=\"max-w-full h-auto\"\r\n                  />\r\n                ) : (\r\n                  <iframe\r\n                    src={selectedAttachment.previewUrl}\r\n                    className=\"w-full h-96\"\r\n                    title={selectedAttachment.originalName}\r\n                  />\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContractAttachmentManager;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractAuditTrail.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAuditTrail'. Either include it or remove the dependency array.","line":72,"column":6,"nodeType":"ArrayExpression","endLine":72,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, filters, loadAuditTrail]","fix":{"range":[2204,2226],"text":"[contract.id, filters, loadAuditTrail]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Contract } from '@/types/contracts';\r\nimport { contractService } from '@/services';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { toast } from 'sonner';\r\nimport {\r\n  History,\r\n  User,\r\n  Calendar,\r\n  Eye,\r\n  Download,\r\n  Filter,\r\n  Search,\r\n  FileText,\r\n  Edit,\r\n  Trash2,\r\n  Plus,\r\n  CheckCircle,\r\n  XCircle,\r\n  Clock,\r\n  AlertCircle\r\n} from 'lucide-react';\r\n\r\ninterface AuditEntry {\r\n  id: string;\r\n  action: string;\r\n  actionType: 'create' | 'update' | 'delete' | 'view' | 'sign' | 'approve' | 'reject';\r\n  description: string;\r\n  userId: string;\r\n  userName: string;\r\n  userRole: string;\r\n  timestamp: string;\r\n  ipAddress?: string;\r\n  userAgent?: string;\r\n  changes?: {\r\n    field: string;\r\n    oldValue: unknown;\r\n    newValue: unknown;\r\n  }[];\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\ninterface ContractAuditTrailProps {\r\n  contract: Contract;\r\n}\r\n\r\nconst ContractAuditTrail: React.FC<ContractAuditTrailProps> = ({ contract }) => {\r\n  const { hasPermission } = useAuth();\r\n  const [auditEntries, setAuditEntries] = useState<AuditEntry[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedEntry, setSelectedEntry] = useState<AuditEntry | null>(null);\r\n  const [showDetailsModal, setShowDetailsModal] = useState(false);\r\n  const [filters, setFilters] = useState({\r\n    actionType: '',\r\n    userId: '',\r\n    dateFrom: '',\r\n    dateTo: '',\r\n    searchTerm: ''\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadAuditTrail();\r\n  }, [contract.id, filters]);\r\n\r\n  const loadAuditTrail = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await contractService.getAuditTrail(contract.id, filters);\r\n      setAuditEntries(data);\r\n    } catch (error) {\r\n      toast.error('Failed to load audit trail');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleExportAuditTrail = async () => {\r\n    try {\r\n      const exportData = await contractService.exportAuditTrail(contract.id, filters);\r\n      // Create and download CSV file\r\n      const blob = new Blob([exportData], { type: 'text/csv' });\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `contract-${contract.contract_number}-audit-trail.csv`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n      document.body.removeChild(a);\r\n      toast.success('Audit trail exported successfully');\r\n    } catch (error) {\r\n      toast.error('Failed to export audit trail');\r\n    }\r\n  };\r\n\r\n  const handleViewDetails = (entry: AuditEntry) => {\r\n    setSelectedEntry(entry);\r\n    setShowDetailsModal(true);\r\n  };\r\n\r\n  const getActionIcon = (actionType: string) => {\r\n    switch (actionType) {\r\n      case 'create':\r\n        return <Plus className=\"h-4 w-4 text-green-600\" />;\r\n      case 'update':\r\n        return <Edit className=\"h-4 w-4 text-blue-600\" />;\r\n      case 'delete':\r\n        return <Trash2 className=\"h-4 w-4 text-red-600\" />;\r\n      case 'view':\r\n        return <Eye className=\"h-4 w-4 text-gray-600\" />;\r\n      case 'sign':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case 'approve':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case 'reject':\r\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\r\n      default:\r\n        return <AlertCircle className=\"h-4 w-4 text-gray-600\" />;\r\n    }\r\n  };\r\n\r\n  const getActionBadge = (actionType: string) => {\r\n    const variants = {\r\n      create: 'default',\r\n      update: 'secondary',\r\n      delete: 'destructive',\r\n      view: 'outline',\r\n      sign: 'default',\r\n      approve: 'default',\r\n      reject: 'destructive'\r\n    } as const;\r\n\r\n    return (\r\n      <Badge variant={variants[actionType as keyof typeof variants] || 'outline'}>\r\n        {actionType.toUpperCase()}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const formatTimestamp = (timestamp: string) => {\r\n    const date = new Date(timestamp);\r\n    return {\r\n      date: date.toLocaleDateString(),\r\n      time: date.toLocaleTimeString()\r\n    };\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    setFilters({\r\n      actionType: '',\r\n      userId: '',\r\n      dateFrom: '',\r\n      dateTo: '',\r\n      searchTerm: ''\r\n    });\r\n  };\r\n\r\n  const canViewAuditTrail = hasPermission('view_audit_logs');\r\n  const canExportAuditTrail = hasPermission('export_data');\r\n\r\n  if (!canViewAuditTrail) {\r\n    return (\r\n      <Alert>\r\n        <AlertCircle className=\"h-4 w-4\" />\r\n        <AlertDescription>\r\n          You don't have permission to view the audit trail for this contract.\r\n        </AlertDescription>\r\n      </Alert>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <History className=\"h-5 w-5\" />\r\n            Contract Audit Trail\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Complete history of all actions performed on this contract\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          {/* Filters */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"actionType\">Action Type</Label>\r\n              <Select value={filters.actionType} onValueChange={(value) => setFilters(prev => ({ ...prev, actionType: value }))}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"All actions\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"\">All actions</SelectItem>\r\n                  <SelectItem value=\"create\">Create</SelectItem>\r\n                  <SelectItem value=\"update\">Update</SelectItem>\r\n                  <SelectItem value=\"delete\">Delete</SelectItem>\r\n                  <SelectItem value=\"view\">View</SelectItem>\r\n                  <SelectItem value=\"sign\">Sign</SelectItem>\r\n                  <SelectItem value=\"approve\">Approve</SelectItem>\r\n                  <SelectItem value=\"reject\">Reject</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"dateFrom\">From Date</Label>\r\n              <Input\r\n                id=\"dateFrom\"\r\n                type=\"date\"\r\n                value={filters.dateFrom}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, dateFrom: e.target.value }))}\r\n              />\r\n            </div>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"dateTo\">To Date</Label>\r\n              <Input\r\n                id=\"dateTo\"\r\n                type=\"date\"\r\n                value={filters.dateTo}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, dateTo: e.target.value }))}\r\n              />\r\n            </div>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"searchTerm\">Search</Label>\r\n              <Input\r\n                id=\"searchTerm\"\r\n                placeholder=\"Search actions...\"\r\n                value={filters.searchTerm}\r\n                onChange={(e) => setFilters(prev => ({ ...prev, searchTerm: e.target.value }))}\r\n              />\r\n            </div>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <Label>&nbsp;</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Button variant=\"outline\" size=\"sm\" onClick={clearFilters}>\r\n                  <Filter className=\"h-4 w-4 mr-2\" />\r\n                  Clear\r\n                </Button>\r\n                {canExportAuditTrail && (\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleExportAuditTrail}>\r\n                    <Download className=\"h-4 w-4 mr-2\" />\r\n                    Export\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Audit Trail Table */}\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n            </div>\r\n          ) : auditEntries.length === 0 ? (\r\n            <Alert>\r\n              <History className=\"h-4 w-4\" />\r\n              <AlertDescription>\r\n                No audit entries found for the selected filters.\r\n              </AlertDescription>\r\n            </Alert>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    <TableHead>Action</TableHead>\r\n                    <TableHead>Description</TableHead>\r\n                    <TableHead>User</TableHead>\r\n                    <TableHead>Date & Time</TableHead>\r\n                    <TableHead>IP Address</TableHead>\r\n                    <TableHead>Actions</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {auditEntries.map((entry) => {\r\n                    const timestamp = formatTimestamp(entry.timestamp);\r\n                    return (\r\n                      <TableRow key={entry.id}>\r\n                        <TableCell>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            {getActionIcon(entry.actionType)}\r\n                            {getActionBadge(entry.actionType)}\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"max-w-xs\">\r\n                            <div className=\"font-medium\">{entry.action}</div>\r\n                            <div className=\"text-sm text-muted-foreground truncate\">\r\n                              {entry.description}\r\n                            </div>\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <User className=\"h-4 w-4\" />\r\n                            <div>\r\n                              <div className=\"font-medium\">{entry.userName}</div>\r\n                              <div className=\"text-sm text-muted-foreground\">{entry.userRole}</div>\r\n                            </div>\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Calendar className=\"h-4 w-4\" />\r\n                            <div>\r\n                              <div className=\"font-medium\">{timestamp.date}</div>\r\n                              <div className=\"text-sm text-muted-foreground\">{timestamp.time}</div>\r\n                            </div>\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"text-sm font-mono\">\r\n                            {entry.ipAddress || 'N/A'}\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleViewDetails(entry)}\r\n                          >\r\n                            <Eye className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    );\r\n                  })}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          )}\r\n\r\n          {/* Summary Stats */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t\">\r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-blue-600\">\r\n                  {auditEntries.filter(e => e.actionType === 'view').length}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Views</div>\r\n              </div>\r\n            </Card>\r\n            \r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-green-600\">\r\n                  {auditEntries.filter(e => e.actionType === 'update').length}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Updates</div>\r\n              </div>\r\n            </Card>\r\n            \r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-purple-600\">\r\n                  {auditEntries.filter(e => e.actionType === 'sign').length}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Signatures</div>\r\n              </div>\r\n            </Card>\r\n            \r\n            <Card className=\"p-3\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-orange-600\">\r\n                  {new Set(auditEntries.map(e => e.userId)).size}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Unique Users</div>\r\n              </div>\r\n            </Card>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Audit Entry Details Modal */}\r\n      <Dialog open={showDetailsModal} onOpenChange={setShowDetailsModal}>\r\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>Audit Entry Details</DialogTitle>\r\n            <DialogDescription>\r\n              Detailed information about this audit entry\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {selectedEntry && (\r\n            <div className=\"space-y-4 py-4\">\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Action</Label>\r\n                  <div className=\"flex items-center gap-2 mt-1\">\r\n                    {getActionIcon(selectedEntry.actionType)}\r\n                    {getActionBadge(selectedEntry.actionType)}\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Timestamp</Label>\r\n                  <div className=\"mt-1\">\r\n                    {new Date(selectedEntry.timestamp).toLocaleString()}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <Label className=\"text-sm font-medium\">Description</Label>\r\n                <div className=\"mt-1 p-2 bg-muted rounded\">\r\n                  {selectedEntry.description}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">User</Label>\r\n                  <div className=\"mt-1\">\r\n                    <div className=\"font-medium\">{selectedEntry.userName}</div>\r\n                    <div className=\"text-sm text-muted-foreground\">{selectedEntry.userRole}</div>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">IP Address</Label>\r\n                  <div className=\"mt-1 font-mono text-sm\">\r\n                    {selectedEntry.ipAddress || 'N/A'}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              {selectedEntry.changes && selectedEntry.changes.length > 0 && (\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Changes Made</Label>\r\n                  <div className=\"mt-1 space-y-2\">\r\n                    {selectedEntry.changes.map((change, index) => (\r\n                      <div key={index} className=\"p-2 border rounded\">\r\n                        <div className=\"font-medium text-sm\">{change.field}</div>\r\n                        <div className=\"grid grid-cols-2 gap-2 mt-1 text-xs\">\r\n                          <div>\r\n                            <span className=\"text-muted-foreground\">From:</span>\r\n                            <div className=\"p-1 bg-red-50 rounded\">{change.oldValue || 'Empty'}</div>\r\n                          </div>\r\n                          <div>\r\n                            <span className=\"text-muted-foreground\">To:</span>\r\n                            <div className=\"p-1 bg-green-50 rounded\">{change.newValue || 'Empty'}</div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {selectedEntry.userAgent && (\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">User Agent</Label>\r\n                  <div className=\"mt-1 p-2 bg-muted rounded text-xs font-mono\">\r\n                    {selectedEntry.userAgent}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {selectedEntry.metadata && Object.keys(selectedEntry.metadata).length > 0 && (\r\n                <div>\r\n                  <Label className=\"text-sm font-medium\">Additional Metadata</Label>\r\n                  <div className=\"mt-1 p-2 bg-muted rounded\">\r\n                    <pre className=\"text-xs\">\r\n                      {JSON.stringify(selectedEntry.metadata, null, 2)}\r\n                    </pre>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContractAuditTrail;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractComplianceTracker.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadComplianceItems'. Either include it or remove the dependency array.","line":79,"column":6,"nodeType":"ArrayExpression","endLine":79,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, loadComplianceItems]","fix":{"range":[2745,2758],"text":"[contract.id, loadComplianceItems]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Contract } from '@/types/contracts';\r\nimport { contractService } from '@/services';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\r\nimport { toast } from 'sonner';\r\nimport {\r\n  Shield,\r\n  Plus,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  XCircle,\r\n  Clock,\r\n  Eye,\r\n  Edit,\r\n  MoreHorizontal,\r\n  FileText,\r\n  Calendar,\r\n  User\r\n} from 'lucide-react';\r\n\r\ninterface ComplianceItem {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  category: 'legal' | 'regulatory' | 'internal' | 'security' | 'financial';\r\n  status: 'compliant' | 'non_compliant' | 'pending_review' | 'in_progress';\r\n  priority: 'low' | 'medium' | 'high' | 'critical';\r\n  dueDate?: string;\r\n  assignedTo?: string;\r\n  assignedToName?: string;\r\n  evidence?: string;\r\n  notes?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  createdBy: string;\r\n  createdByName: string;\r\n}\r\n\r\ninterface ContractComplianceTrackerProps {\r\n  contract: Contract;\r\n  onComplianceUpdate?: () => void;\r\n}\r\n\r\nconst ContractComplianceTracker: React.FC<ContractComplianceTrackerProps> = ({\r\n  contract,\r\n  onComplianceUpdate\r\n}) => {\r\n  const { user, hasPermission } = useAuth();\r\n  const [complianceItems, setComplianceItems] = useState<ComplianceItem[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n  const [selectedItem, setSelectedItem] = useState<ComplianceItem | null>(null);\r\n  const [formData, setFormData] = useState({\r\n    title: '',\r\n    description: '',\r\n    category: 'legal' as const,\r\n    priority: 'medium' as const,\r\n    dueDate: '',\r\n    assignedTo: '',\r\n    evidence: '',\r\n    notes: ''\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadComplianceItems();\r\n  }, [contract.id]);\r\n\r\n  const loadComplianceItems = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await contractService.getComplianceItems(contract.id);\r\n      setComplianceItems(data);\r\n    } catch (error) {\r\n      toast.error('Failed to load compliance items');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCreateItem = async () => {\r\n    try {\r\n      const itemData = {\r\n        ...formData,\r\n        contractId: contract.id,\r\n        status: 'pending_review' as const\r\n      };\r\n\r\n      await contractService.createComplianceItem(itemData);\r\n      toast.success('Compliance item created successfully');\r\n      setShowCreateModal(false);\r\n      resetForm();\r\n      loadComplianceItems();\r\n      onComplianceUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to create compliance item');\r\n    }\r\n  };\r\n\r\n  const handleUpdateItem = async () => {\r\n    if (!selectedItem) return;\r\n\r\n    try {\r\n      await contractService.updateComplianceItem(selectedItem.id, formData);\r\n      toast.success('Compliance item updated successfully');\r\n      setShowEditModal(false);\r\n      resetForm();\r\n      loadComplianceItems();\r\n      onComplianceUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to update compliance item');\r\n    }\r\n  };\r\n\r\n  const handleUpdateStatus = async (item: ComplianceItem, status: ComplianceItem['status']) => {\r\n    try {\r\n      await contractService.updateComplianceItem(item.id, { status });\r\n      toast.success('Compliance status updated');\r\n      loadComplianceItems();\r\n      onComplianceUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to update compliance status');\r\n    }\r\n  };\r\n\r\n  const handleDeleteItem = async (item: ComplianceItem) => {\r\n    if (!confirm('Are you sure you want to delete this compliance item?')) return;\r\n\r\n    try {\r\n      await contractService.deleteComplianceItem(item.id);\r\n      toast.success('Compliance item deleted');\r\n      loadComplianceItems();\r\n      onComplianceUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to delete compliance item');\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      title: '',\r\n      description: '',\r\n      category: 'legal',\r\n      priority: 'medium',\r\n      dueDate: '',\r\n      assignedTo: '',\r\n      evidence: '',\r\n      notes: ''\r\n    });\r\n    setSelectedItem(null);\r\n  };\r\n\r\n  const openEditModal = (item: ComplianceItem) => {\r\n    setSelectedItem(item);\r\n    setFormData({\r\n      title: item.title,\r\n      description: item.description,\r\n      category: item.category,\r\n      priority: item.priority,\r\n      dueDate: item.dueDate || '',\r\n      assignedTo: item.assignedTo || '',\r\n      evidence: item.evidence || '',\r\n      notes: item.notes || ''\r\n    });\r\n    setShowEditModal(true);\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'compliant':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n      case 'non_compliant':\r\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\r\n      case 'in_progress':\r\n        return <Clock className=\"h-4 w-4 text-blue-600\" />;\r\n      case 'pending_review':\r\n        return <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />;\r\n      default:\r\n        return <AlertTriangle className=\"h-4 w-4 text-gray-600\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const variants = {\r\n      compliant: 'default',\r\n      non_compliant: 'destructive',\r\n      in_progress: 'secondary',\r\n      pending_review: 'outline'\r\n    } as const;\r\n\r\n    return (\r\n      <Badge variant={variants[status as keyof typeof variants] || 'outline'}>\r\n        {status.replace('_', ' ').toUpperCase()}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const getPriorityBadge = (priority: string) => {\r\n    const variants = {\r\n      critical: 'destructive',\r\n      high: 'destructive',\r\n      medium: 'secondary',\r\n      low: 'outline'\r\n    } as const;\r\n\r\n    return (\r\n      <Badge variant={variants[priority as keyof typeof variants] || 'outline'}>\r\n        {priority.toUpperCase()}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const getCategoryBadge = (category: string) => {\r\n    const colors = {\r\n      legal: 'bg-blue-100 text-blue-800',\r\n      regulatory: 'bg-purple-100 text-purple-800',\r\n      internal: 'bg-green-100 text-green-800',\r\n      security: 'bg-red-100 text-red-800',\r\n      financial: 'bg-yellow-100 text-yellow-800'\r\n    };\r\n\r\n    return (\r\n      <Badge className={colors[category as keyof typeof colors] || 'bg-gray-100 text-gray-800'}>\r\n        {category.toUpperCase()}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const getComplianceScore = () => {\r\n    if (complianceItems.length === 0) return 0;\r\n    const compliant = complianceItems.filter(item => item.status === 'compliant').length;\r\n    return Math.round((compliant / complianceItems.length) * 100);\r\n  };\r\n\r\n  const getOverdueItems = () => {\r\n    return complianceItems.filter(item => \r\n      item.dueDate && \r\n      new Date(item.dueDate) < new Date() && \r\n      item.status !== 'compliant'\r\n    );\r\n  };\r\n\r\n  const canManageCompliance = hasPermission('manage_contracts');\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Shield className=\"h-5 w-5\" />\r\n            Compliance Tracking\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Monitor and manage compliance requirements for this contract\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          {/* Compliance Overview */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <Card className=\"p-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-muted-foreground\">Compliance Score</p>\r\n                  <p className=\"text-2xl font-bold\">{getComplianceScore()}%</p>\r\n                </div>\r\n                <Shield className=\"h-8 w-8 text-green-600\" />\r\n              </div>\r\n              <Progress value={getComplianceScore()} className=\"mt-2\" />\r\n            </Card>\r\n            \r\n            <Card className=\"p-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-muted-foreground\">Total Items</p>\r\n                  <p className=\"text-2xl font-bold\">{complianceItems.length}</p>\r\n                </div>\r\n                <FileText className=\"h-8 w-8 text-blue-600\" />\r\n              </div>\r\n            </Card>\r\n            \r\n            <Card className=\"p-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-muted-foreground\">Overdue</p>\r\n                  <p className=\"text-2xl font-bold text-red-600\">{getOverdueItems().length}</p>\r\n                </div>\r\n                <AlertTriangle className=\"h-8 w-8 text-red-600\" />\r\n              </div>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Overdue Alert */}\r\n          {getOverdueItems().length > 0 && (\r\n            <Alert>\r\n              <AlertTriangle className=\"h-4 w-4\" />\r\n              <AlertDescription>\r\n                You have {getOverdueItems().length} overdue compliance item(s) that require immediate attention.\r\n              </AlertDescription>\r\n            </Alert>\r\n          )}\r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"flex gap-2\">\r\n            {canManageCompliance && (\r\n              <Button onClick={() => setShowCreateModal(true)}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Add Compliance Item\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Compliance Items Table */}\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n            </div>\r\n          ) : complianceItems.length === 0 ? (\r\n            <Alert>\r\n              <Shield className=\"h-4 w-4\" />\r\n              <AlertDescription>\r\n                No compliance items have been added for this contract yet.\r\n              </AlertDescription>\r\n            </Alert>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    <TableHead>Item</TableHead>\r\n                    <TableHead>Category</TableHead>\r\n                    <TableHead>Priority</TableHead>\r\n                    <TableHead>Status</TableHead>\r\n                    <TableHead>Due Date</TableHead>\r\n                    <TableHead>Assigned To</TableHead>\r\n                    <TableHead>Actions</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {complianceItems.map((item) => (\r\n                    <TableRow key={item.id}>\r\n                      <TableCell>\r\n                        <div className=\"space-y-1\">\r\n                          <div className=\"font-medium\">{item.title}</div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            {item.description}\r\n                          </div>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {getCategoryBadge(item.category)}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {getPriorityBadge(item.priority)}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {getStatusIcon(item.status)}\r\n                          {getStatusBadge(item.status)}\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {item.dueDate ? (\r\n                          <div className={`flex items-center gap-2 ${\r\n                            new Date(item.dueDate) < new Date() && item.status !== 'compliant' \r\n                              ? 'text-red-600' \r\n                              : ''\r\n                          }`}>\r\n                            <Calendar className=\"h-4 w-4\" />\r\n                            {new Date(item.dueDate).toLocaleDateString()}\r\n                          </div>\r\n                        ) : (\r\n                          <span className=\"text-muted-foreground\">No due date</span>\r\n                        )}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {item.assignedToName ? (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <User className=\"h-4 w-4\" />\r\n                            {item.assignedToName}\r\n                          </div>\r\n                        ) : (\r\n                          <span className=\"text-muted-foreground\">Unassigned</span>\r\n                        )}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <DropdownMenu>\r\n                          <DropdownMenuTrigger asChild>\r\n                            <Button variant=\"ghost\" size=\"sm\">\r\n                              <MoreHorizontal className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          </DropdownMenuTrigger>\r\n                          <DropdownMenuContent align=\"end\">\r\n                            {canManageCompliance && (\r\n                              <>\r\n                                <DropdownMenuItem onClick={() => openEditModal(item)}>\r\n                                  <Edit className=\"h-4 w-4 mr-2\" />\r\n                                  Edit\r\n                                </DropdownMenuItem>\r\n                                <DropdownMenuItem onClick={() => handleUpdateStatus(item, 'compliant')}>\r\n                                  <CheckCircle className=\"h-4 w-4 mr-2\" />\r\n                                  Mark Compliant\r\n                                </DropdownMenuItem>\r\n                                <DropdownMenuItem onClick={() => handleUpdateStatus(item, 'non_compliant')}>\r\n                                  <XCircle className=\"h-4 w-4 mr-2\" />\r\n                                  Mark Non-Compliant\r\n                                </DropdownMenuItem>\r\n                                <DropdownMenuItem onClick={() => handleUpdateStatus(item, 'in_progress')}>\r\n                                  <Clock className=\"h-4 w-4 mr-2\" />\r\n                                  Mark In Progress\r\n                                </DropdownMenuItem>\r\n                                <DropdownMenuItem \r\n                                  onClick={() => handleDeleteItem(item)}\r\n                                  className=\"text-destructive\"\r\n                                >\r\n                                  <XCircle className=\"h-4 w-4 mr-2\" />\r\n                                  Delete\r\n                                </DropdownMenuItem>\r\n                              </>\r\n                            )}\r\n                          </DropdownMenuContent>\r\n                        </DropdownMenu>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Create Compliance Item Modal */}\r\n      <Dialog open={showCreateModal} onOpenChange={setShowCreateModal}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Add Compliance Item</DialogTitle>\r\n            <DialogDescription>\r\n              Add a new compliance requirement for this contract.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"title\">Title</Label>\r\n                <Input\r\n                  id=\"title\"\r\n                  value={formData.title}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}\r\n                  placeholder=\"Enter compliance item title\"\r\n                />\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"category\">Category</Label>\r\n                <Select value={formData.category} onValueChange={(value: string) => setFormData(prev => ({ ...prev, category: value as 'legal' | 'regulatory' | 'internal' | 'security' | 'financial' }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"legal\">Legal</SelectItem>\r\n                    <SelectItem value=\"regulatory\">Regulatory</SelectItem>\r\n                    <SelectItem value=\"internal\">Internal</SelectItem>\r\n                    <SelectItem value=\"security\">Security</SelectItem>\r\n                    <SelectItem value=\"financial\">Financial</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"description\">Description</Label>\r\n              <Textarea\r\n                id=\"description\"\r\n                value={formData.description}\r\n                onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\r\n                placeholder=\"Describe the compliance requirement\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"priority\">Priority</Label>\r\n                <Select value={formData.priority} onValueChange={(value: string) => setFormData(prev => ({ ...prev, priority: value as 'low' | 'medium' | 'high' | 'critical' }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"low\">Low</SelectItem>\r\n                    <SelectItem value=\"medium\">Medium</SelectItem>\r\n                    <SelectItem value=\"high\">High</SelectItem>\r\n                    <SelectItem value=\"critical\">Critical</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"dueDate\">Due Date</Label>\r\n                <Input\r\n                  id=\"dueDate\"\r\n                  type=\"date\"\r\n                  value={formData.dueDate}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, dueDate: e.target.value }))}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"notes\">Notes</Label>\r\n              <Textarea\r\n                id=\"notes\"\r\n                value={formData.notes}\r\n                onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\r\n                placeholder=\"Additional notes or requirements\"\r\n                rows={2}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowCreateModal(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleCreateItem} disabled={!formData.title.trim()}>\r\n              Add Item\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Edit Compliance Item Modal */}\r\n      <Dialog open={showEditModal} onOpenChange={setShowEditModal}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Edit Compliance Item</DialogTitle>\r\n            <DialogDescription>\r\n              Update the compliance requirement details.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"edit-title\">Title</Label>\r\n                <Input\r\n                  id=\"edit-title\"\r\n                  value={formData.title}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}\r\n                  placeholder=\"Enter compliance item title\"\r\n                />\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"edit-category\">Category</Label>\r\n                <Select value={formData.category} onValueChange={(value: string) => setFormData(prev => ({ ...prev, category: value as 'legal' | 'regulatory' | 'internal' | 'security' | 'financial' }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"legal\">Legal</SelectItem>\r\n                    <SelectItem value=\"regulatory\">Regulatory</SelectItem>\r\n                    <SelectItem value=\"internal\">Internal</SelectItem>\r\n                    <SelectItem value=\"security\">Security</SelectItem>\r\n                    <SelectItem value=\"financial\">Financial</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit-description\">Description</Label>\r\n              <Textarea\r\n                id=\"edit-description\"\r\n                value={formData.description}\r\n                onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\r\n                placeholder=\"Describe the compliance requirement\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"edit-priority\">Priority</Label>\r\n                <Select value={formData.priority} onValueChange={(value: string) => setFormData(prev => ({ ...prev, priority: value as 'low' | 'medium' | 'high' | 'critical' }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"low\">Low</SelectItem>\r\n                    <SelectItem value=\"medium\">Medium</SelectItem>\r\n                    <SelectItem value=\"high\">High</SelectItem>\r\n                    <SelectItem value=\"critical\">Critical</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"edit-dueDate\">Due Date</Label>\r\n                <Input\r\n                  id=\"edit-dueDate\"\r\n                  type=\"date\"\r\n                  value={formData.dueDate}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, dueDate: e.target.value }))}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit-evidence\">Evidence/Documentation</Label>\r\n              <Textarea\r\n                id=\"edit-evidence\"\r\n                value={formData.evidence}\r\n                onChange={(e) => setFormData(prev => ({ ...prev, evidence: e.target.value }))}\r\n                placeholder=\"Evidence or documentation of compliance\"\r\n                rows={2}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"edit-notes\">Notes</Label>\r\n              <Textarea\r\n                id=\"edit-notes\"\r\n                value={formData.notes}\r\n                onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\r\n                placeholder=\"Additional notes or requirements\"\r\n                rows={2}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowEditModal(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleUpdateItem} disabled={!formData.title.trim()}>\r\n              Update Item\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContractComplianceTracker;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractDocumentGenerator.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadExistingDocument' and 'loadTemplates'. Either include them or remove the dependency array.","line":49,"column":6,"nodeType":"ArrayExpression","endLine":49,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, loadExistingDocument, loadTemplates]","fix":{"range":[1981,1994],"text":"[contract.id, loadExistingDocument, loadTemplates]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'initializeVariables'. Either include it or remove the dependency array.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [initializeVariables, selectedTemplate]","fix":{"range":[2086,2104],"text":"[initializeVariables, selectedTemplate]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Contract, ContractTemplate } from '@/types/contracts';\nimport { contractService } from '@/services';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { toast } from 'sonner';\nimport {\n  FileText,\n  Download,\n  Eye,\n  RefreshCw,\n  Settings,\n  AlertCircle,\n  CheckCircle,\n  Loader2\n} from 'lucide-react';\n\ninterface ContractDocumentGeneratorProps {\n  contract: Contract;\n  onDocumentGenerated?: (documentUrl: string) => void;\n}\n\nconst ContractDocumentGenerator: React.FC<ContractDocumentGeneratorProps> = ({\n  contract,\n  onDocumentGenerated\n}) => {\n  const { hasPermission } = useAuth();\n  const [templates, setTemplates] = useState<ContractTemplate[]>([]);\n  const [selectedTemplate, setSelectedTemplate] = useState<ContractTemplate | null>(null);\n  const [generating, setGenerating] = useState(false);\n  const [generationProgress, setGenerationProgress] = useState(0);\n  const [showPreview, setShowPreview] = useState(false);\n  const [previewContent, setPreviewContent] = useState('');\n  const [documentUrl, setDocumentUrl] = useState<string | null>(null);\n  const [variables, setVariables] = useState<Record<string, string>>({});\n  const [showVariablesModal, setShowVariablesModal] = useState(false);\n\n  useEffect(() => {\n    loadTemplates();\n    loadExistingDocument();\n  }, [contract.id]);\n\n  useEffect(() => {\n    if (selectedTemplate) {\n      initializeVariables();\n    }\n  }, [selectedTemplate]);\n\n  const loadTemplates = async () => {\n    try {\n      const data = await contractService.getTemplates();\n      const filteredTemplates = data.filter(t => \n        t.isActive && (t.type === contract.type || t.type === 'custom')\n      );\n      setTemplates(filteredTemplates);\n      \n      // Auto-select default template\n      const defaultTemplate = filteredTemplates.find(t => t.isDefault);\n      if (defaultTemplate) {\n        setSelectedTemplate(defaultTemplate);\n      }\n    } catch (error) {\n      toast.error('Failed to load templates');\n    }\n  };\n\n  const loadExistingDocument = async () => {\n    try {\n      const existingDoc = await contractService.getContractDocument(contract.id);\n      if (existingDoc) {\n        setDocumentUrl(existingDoc.url);\n      }\n    } catch (error) {\n      // No existing document, which is fine\n    }\n  };\n\n  const initializeVariables = () => {\n    if (!selectedTemplate) return;\n\n    const initialVariables: Record<string, string> = {};\n    \n    // Pre-populate with contract data\n    selectedTemplate.variables.forEach(variable => {\n      switch (variable) {\n        case 'contract_number':\n          initialVariables[variable] = contract.contract_number || '';\n          break;\n        case 'contract_title':\n          initialVariables[variable] = contract.title || '';\n          break;\n        case 'customer_name':\n          initialVariables[variable] = contract.customer_name || '';\n          break;\n        case 'contract_value':\n          initialVariables[variable] = contract.value?.toString() || '';\n          break;\n        case 'currency':\n          initialVariables[variable] = contract.currency || 'USD';\n          break;\n        case 'start_date':\n          initialVariables[variable] = contract.start_date || '';\n          break;\n        case 'end_date':\n          initialVariables[variable] = contract.end_date || '';\n          break;\n        case 'payment_terms':\n          initialVariables[variable] = contract.payment_terms || '';\n          break;\n        case 'delivery_terms':\n          initialVariables[variable] = contract.delivery_terms || '';\n          break;\n        case 'current_date':\n          initialVariables[variable] = new Date().toLocaleDateString();\n          break;\n        default:\n          initialVariables[variable] = '';\n      }\n    });\n\n    setVariables(initialVariables);\n  };\n\n  const handleGeneratePreview = async () => {\n    if (!selectedTemplate) {\n      toast.error('Please select a template first');\n      return;\n    }\n\n    try {\n      const preview = await contractService.generateContractPreview(\n        selectedTemplate.id,\n        variables\n      );\n      setPreviewContent(preview);\n      setShowPreview(true);\n    } catch (error) {\n      toast.error('Failed to generate preview');\n    }\n  };\n\n  const handleGenerateDocument = async () => {\n    if (!selectedTemplate) {\n      toast.error('Please select a template first');\n      return;\n    }\n\n    try {\n      setGenerating(true);\n      setGenerationProgress(0);\n\n      // Simulate progress\n      const progressInterval = setInterval(() => {\n        setGenerationProgress(prev => {\n          if (prev >= 90) {\n            clearInterval(progressInterval);\n            return prev;\n          }\n          return prev + 10;\n        });\n      }, 200);\n\n      const documentUrl = await contractService.generateContractDocument(\n        contract.id,\n        selectedTemplate.id,\n        variables\n      );\n\n      clearInterval(progressInterval);\n      setGenerationProgress(100);\n      setDocumentUrl(documentUrl);\n      \n      toast.success('Contract document generated successfully');\n      onDocumentGenerated?.(documentUrl);\n    } catch (error) {\n      toast.error('Failed to generate contract document');\n    } finally {\n      setGenerating(false);\n      setGenerationProgress(0);\n    }\n  };\n\n  const handleDownloadDocument = () => {\n    if (documentUrl) {\n      window.open(documentUrl, '_blank');\n    }\n  };\n\n  const handleVariableChange = (variable: string, value: string) => {\n    setVariables(prev => ({\n      ...prev,\n      [variable]: value\n    }));\n  };\n\n  const areVariablesComplete = () => {\n    if (!selectedTemplate) return false;\n    return selectedTemplate.variables.every(variable => \n      variables[variable] && variables[variable].trim() !== ''\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"h-5 w-5\" />\n            Document Generation\n          </CardTitle>\n          <CardDescription>\n            Generate contract documents from templates\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Template Selection */}\n          <div className=\"space-y-2\">\n            <Label>Contract Template</Label>\n            <Select \n              value={selectedTemplate?.id || ''} \n              onValueChange={(value) => {\n                const template = templates.find(t => t.id === value);\n                setSelectedTemplate(template || null);\n              }}\n            >\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select a template\" />\n              </SelectTrigger>\n              <SelectContent>\n                {templates.map((template) => (\n                  <SelectItem key={template.id} value={template.id}>\n                    <div className=\"flex items-center gap-2\">\n                      {template.name}\n                      {template.isDefault && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">Default</Badge>\n                      )}\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Template Info */}\n          {selectedTemplate && (\n            <Alert>\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                <div className=\"space-y-1\">\n                  <div><strong>Template:</strong> {selectedTemplate.name}</div>\n                  <div><strong>Type:</strong> {selectedTemplate.type}</div>\n                  <div><strong>Variables:</strong> {selectedTemplate.variables.length} required</div>\n                </div>\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {/* Variables Configuration */}\n          {selectedTemplate && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h4 className=\"font-medium\">Template Variables</h4>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setShowVariablesModal(true)}\n                >\n                  <Settings className=\"h-4 w-4 mr-2\" />\n                  Configure All\n                </Button>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                {selectedTemplate.variables.slice(0, 6).map((variable) => (\n                  <div key={variable} className=\"space-y-1\">\n                    <Label className=\"text-xs\">{variable.replace(/_/g, ' ').toUpperCase()}</Label>\n                    <Input\n                      value={variables[variable] || ''}\n                      onChange={(e) => handleVariableChange(variable, e.target.value)}\n                      placeholder={`Enter ${variable.replace(/_/g, ' ')}`}\n                      className=\"text-sm\"\n                    />\n                  </div>\n                ))}\n              </div>\n              \n              {selectedTemplate.variables.length > 6 && (\n                <div className=\"text-sm text-muted-foreground\">\n                  +{selectedTemplate.variables.length - 6} more variables. Click \"Configure All\" to set them.\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Generation Progress */}\n          {generating && (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-2\">\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                <span className=\"text-sm\">Generating document...</span>\n              </div>\n              <Progress value={generationProgress} className=\"h-2\" />\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-2\">\n            <Button\n              onClick={handleGeneratePreview}\n              variant=\"outline\"\n              disabled={!selectedTemplate || generating}\n            >\n              <Eye className=\"h-4 w-4 mr-2\" />\n              Preview\n            </Button>\n            <Button\n              onClick={handleGenerateDocument}\n              disabled={!selectedTemplate || !areVariablesComplete() || generating}\n            >\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Generate Document\n            </Button>\n            {documentUrl && (\n              <Button\n                onClick={handleDownloadDocument}\n                variant=\"outline\"\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Download\n              </Button>\n            )}\n          </div>\n\n          {/* Existing Document */}\n          {documentUrl && (\n            <Alert>\n              <CheckCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                <div className=\"flex items-center justify-between\">\n                  <span>Contract document has been generated and is ready for download.</span>\n                  <Button size=\"sm\" variant=\"outline\" onClick={handleDownloadDocument}>\n                    <Download className=\"h-4 w-4 mr-2\" />\n                    Download\n                  </Button>\n                </div>\n              </AlertDescription>\n            </Alert>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Variables Configuration Modal */}\n      <Dialog open={showVariablesModal} onOpenChange={setShowVariablesModal}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Configure Template Variables</DialogTitle>\n            <DialogDescription>\n              Set values for all template variables to generate the contract document.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            {selectedTemplate?.variables.map((variable) => (\n              <div key={variable} className=\"space-y-2\">\n                <Label htmlFor={variable}>\n                  {variable.replace(/_/g, ' ').toUpperCase()}\n                </Label>\n                <Input\n                  id={variable}\n                  value={variables[variable] || ''}\n                  onChange={(e) => handleVariableChange(variable, e.target.value)}\n                  placeholder={`Enter ${variable.replace(/_/g, ' ')}`}\n                />\n              </div>\n            ))}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowVariablesModal(false)}>\n              Close\n            </Button>\n            <Button onClick={() => setShowVariablesModal(false)}>\n              Save Variables\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Preview Modal */}\n      <Dialog open={showPreview} onOpenChange={setShowPreview}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Contract Preview</DialogTitle>\n            <DialogDescription>\n              Preview of the generated contract document\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <div \n              className=\"prose max-w-none p-6 border rounded-lg bg-white\"\n              dangerouslySetInnerHTML={{ __html: previewContent }}\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowPreview(false)}>\n              Close\n            </Button>\n            <Button onClick={handleGenerateDocument} disabled={!areVariablesComplete()}>\n              Generate Final Document\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default ContractDocumentGenerator;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractRenewalManager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadRenewalReminders'. Either include it or remove the dependency array.","line":67,"column":6,"nodeType":"ArrayExpression","endLine":67,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, loadRenewalReminders]","fix":{"range":[2450,2463],"text":"[contract.id, loadRenewalReminders]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Contract, RenewalReminder } from '@/types/contracts';\r\nimport { contractService } from '@/services';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { toast } from 'sonner';\r\nimport {\r\n  RefreshCw,\r\n  Calendar,\r\n  Bell,\r\n  Clock,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  Plus,\r\n  Edit,\r\n  Trash2,\r\n  Send,\r\n  Settings\r\n} from 'lucide-react';\r\n\r\ninterface ContractRenewalManagerProps {\r\n  contract: Contract;\r\n  onRenewalUpdate?: () => void;\r\n}\r\n\r\nconst ContractRenewalManager: React.FC<ContractRenewalManagerProps> = ({\r\n  contract,\r\n  onRenewalUpdate\r\n}) => {\r\n  const { user, hasPermission } = useAuth();\r\n  const [renewalData, setRenewalData] = useState({\r\n    autoRenew: contract.autoRenew || false,\r\n    renewalPeriodMonths: contract.renewal_period_months || 12,\r\n    renewalTerms: contract.renewalTerms || '',\r\n    nextRenewalDate: contract.next_renewal_date || '',\r\n    reminderDays: contract.reminderDays || [30, 7, 1]\r\n  });\r\n  const [reminders, setReminders] = useState<RenewalReminder[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showRenewalModal, setShowRenewalModal] = useState(false);\r\n  const [showReminderModal, setShowReminderModal] = useState(false);\r\n  const [renewalForm, setRenewalForm] = useState({\r\n    newEndDate: '',\r\n    newValue: contract.value,\r\n    terms: '',\r\n    notes: ''\r\n  });\r\n  const [reminderForm, setReminderForm] = useState({\r\n    daysBeforeExpiry: 30,\r\n    message: '',\r\n    recipients: [] as string[]\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadRenewalReminders();\r\n  }, [contract.id]);\r\n\r\n  const loadRenewalReminders = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await contractService.getRenewalReminders(contract.id);\r\n      setReminders(data);\r\n    } catch (error) {\r\n      console.error('Failed to load renewal reminders:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUpdateRenewalSettings = async () => {\r\n    try {\r\n      await contractService.updateContract(contract.id, {\r\n        autoRenew: renewalData.autoRenew,\r\n        renewal_period_months: renewalData.renewalPeriodMonths,\r\n        renewalTerms: renewalData.renewalTerms,\r\n        next_renewal_date: renewalData.nextRenewalDate,\r\n        reminderDays: renewalData.reminderDays\r\n      });\r\n      toast.success('Renewal settings updated successfully');\r\n      onRenewalUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to update renewal settings');\r\n    }\r\n  };\r\n\r\n  const handleRenewContract = async () => {\r\n    try {\r\n      await contractService.renewContract(contract.id, {\r\n        newEndDate: renewalForm.newEndDate,\r\n        newValue: renewalForm.newValue,\r\n        terms: renewalForm.terms,\r\n        notes: renewalForm.notes\r\n      });\r\n      toast.success('Contract renewed successfully');\r\n      setShowRenewalModal(false);\r\n      setRenewalForm({ newEndDate: '', newValue: contract.value, terms: '', notes: '' });\r\n      onRenewalUpdate?.();\r\n    } catch (error) {\r\n      toast.error('Failed to renew contract');\r\n    }\r\n  };\r\n\r\n  const handleCreateReminder = async () => {\r\n    try {\r\n      await contractService.createRenewalReminder(contract.id, {\r\n        daysBeforeExpiry: reminderForm.daysBeforeExpiry,\r\n        message: reminderForm.message,\r\n        recipients: reminderForm.recipients\r\n      });\r\n      toast.success('Renewal reminder created successfully');\r\n      setShowReminderModal(false);\r\n      setReminderForm({ daysBeforeExpiry: 30, message: '', recipients: [] });\r\n      loadRenewalReminders();\r\n    } catch (error) {\r\n      toast.error('Failed to create renewal reminder');\r\n    }\r\n  };\r\n\r\n  const handleDeleteReminder = async (reminderId: string) => {\r\n    if (!confirm('Are you sure you want to delete this reminder?')) return;\r\n\r\n    try {\r\n      await contractService.deleteRenewalReminder(reminderId);\r\n      toast.success('Reminder deleted successfully');\r\n      loadRenewalReminders();\r\n    } catch (error) {\r\n      toast.error('Failed to delete reminder');\r\n    }\r\n  };\r\n\r\n  const getDaysUntilExpiry = () => {\r\n    const endDate = new Date(contract.end_date);\r\n    const today = new Date();\r\n    const diffTime = endDate.getTime() - today.getTime();\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n    return diffDays;\r\n  };\r\n\r\n  const getRenewalStatus = () => {\r\n    const daysUntilExpiry = getDaysUntilExpiry();\r\n    \r\n    if (daysUntilExpiry < 0) {\r\n      return { status: 'expired', color: 'destructive', message: 'Contract has expired' };\r\n    } else if (daysUntilExpiry <= 30) {\r\n      return { status: 'urgent', color: 'destructive', message: 'Renewal required soon' };\r\n    } else if (daysUntilExpiry <= 90) {\r\n      return { status: 'upcoming', color: 'secondary', message: 'Renewal approaching' };\r\n    } else {\r\n      return { status: 'active', color: 'default', message: 'Contract active' };\r\n    }\r\n  };\r\n\r\n  const calculateNextRenewalDate = () => {\r\n    if (!renewalData.renewalPeriodMonths) return '';\r\n    \r\n    const currentEndDate = new Date(contract.end_date);\r\n    const nextRenewalDate = new Date(currentEndDate);\r\n    nextRenewalDate.setMonth(nextRenewalDate.getMonth() + renewalData.renewalPeriodMonths);\r\n    \r\n    return nextRenewalDate.toISOString().split('T')[0];\r\n  };\r\n\r\n  const canManageRenewal = hasPermission('manage_contracts');\r\n  const renewalStatus = getRenewalStatus();\r\n  const daysUntilExpiry = getDaysUntilExpiry();\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <RefreshCw className=\"h-5 w-5\" />\r\n            Contract Renewal Management\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Manage contract renewal settings and reminders\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          {/* Renewal Status Overview */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <Card className=\"p-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-muted-foreground\">Days Until Expiry</p>\r\n                  <p className={`text-2xl font-bold ${daysUntilExpiry <= 30 ? 'text-red-600' : 'text-green-600'}`}>\r\n                    {daysUntilExpiry > 0 ? daysUntilExpiry : 'Expired'}\r\n                  </p>\r\n                </div>\r\n                <Calendar className=\"h-8 w-8 text-blue-600\" />\r\n              </div>\r\n            </Card>\r\n            \r\n            <Card className=\"p-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-muted-foreground\">Auto Renewal</p>\r\n                  <p className=\"text-2xl font-bold\">\r\n                    {renewalData.autoRenew ? 'Enabled' : 'Disabled'}\r\n                  </p>\r\n                </div>\r\n                <RefreshCw className={`h-8 w-8 ${renewalData.autoRenew ? 'text-green-600' : 'text-gray-400'}`} />\r\n              </div>\r\n            </Card>\r\n            \r\n            <Card className=\"p-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-muted-foreground\">Active Reminders</p>\r\n                  <p className=\"text-2xl font-bold\">{reminders.length}</p>\r\n                </div>\r\n                <Bell className=\"h-8 w-8 text-yellow-600\" />\r\n              </div>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Renewal Status Alert */}\r\n          <Alert>\r\n            <AlertTriangle className=\"h-4 w-4\" />\r\n            <AlertDescription>\r\n              <div className=\"flex items-center justify-between\">\r\n                <span>\r\n                  <Badge variant={renewalStatus.color as 'default' | 'secondary' | 'destructive' | 'outline'} className=\"mr-2\">\r\n                    {renewalStatus.status.toUpperCase()}\r\n                  </Badge>\r\n                  {renewalStatus.message}\r\n                </span>\r\n                {canManageRenewal && daysUntilExpiry <= 90 && (\r\n                  <Button size=\"sm\" onClick={() => setShowRenewalModal(true)}>\r\n                    <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                    Renew Now\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            </AlertDescription>\r\n          </Alert>\r\n\r\n          {/* Renewal Settings */}\r\n          <div className=\"space-y-4\">\r\n            <h4 className=\"font-medium\">Renewal Settings</h4>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label>Auto Renewal</Label>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Switch\r\n                    checked={renewalData.autoRenew}\r\n                    onCheckedChange={(checked) => setRenewalData(prev => ({ ...prev, autoRenew: checked }))}\r\n                    disabled={!canManageRenewal}\r\n                  />\r\n                  <span className=\"text-sm text-muted-foreground\">\r\n                    {renewalData.autoRenew ? 'Enabled' : 'Disabled'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"renewalPeriod\">Renewal Period (Months)</Label>\r\n                <Input\r\n                  id=\"renewalPeriod\"\r\n                  type=\"number\"\r\n                  value={renewalData.renewalPeriodMonths}\r\n                  onChange={(e) => setRenewalData(prev => ({ ...prev, renewalPeriodMonths: parseInt(e.target.value) || 12 }))}\r\n                  disabled={!canManageRenewal}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"renewalTerms\">Renewal Terms</Label>\r\n              <Textarea\r\n                id=\"renewalTerms\"\r\n                value={renewalData.renewalTerms}\r\n                onChange={(e) => setRenewalData(prev => ({ ...prev, renewalTerms: e.target.value }))}\r\n                placeholder=\"Enter renewal terms and conditions\"\r\n                rows={3}\r\n                disabled={!canManageRenewal}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"nextRenewalDate\">Next Renewal Date</Label>\r\n              <Input\r\n                id=\"nextRenewalDate\"\r\n                type=\"date\"\r\n                value={renewalData.nextRenewalDate || calculateNextRenewalDate()}\r\n                onChange={(e) => setRenewalData(prev => ({ ...prev, nextRenewalDate: e.target.value }))}\r\n                disabled={!canManageRenewal}\r\n              />\r\n            </div>\r\n\r\n            {canManageRenewal && (\r\n              <Button onClick={handleUpdateRenewalSettings}>\r\n                <Settings className=\"h-4 w-4 mr-2\" />\r\n                Update Settings\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Renewal Reminders */}\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h4 className=\"font-medium\">Renewal Reminders</h4>\r\n              {canManageRenewal && (\r\n                <Button size=\"sm\" onClick={() => setShowReminderModal(true)}>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Add Reminder\r\n                </Button>\r\n              )}\r\n            </div>\r\n\r\n            {loading ? (\r\n              <div className=\"flex items-center justify-center py-4\">\r\n                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\r\n              </div>\r\n            ) : reminders.length === 0 ? (\r\n              <Alert>\r\n                <Bell className=\"h-4 w-4\" />\r\n                <AlertDescription>\r\n                  No renewal reminders have been set up for this contract.\r\n                </AlertDescription>\r\n              </Alert>\r\n            ) : (\r\n              <div className=\"overflow-x-auto\">\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>Days Before Expiry</TableHead>\r\n                      <TableHead>Message</TableHead>\r\n                      <TableHead>Recipients</TableHead>\r\n                      <TableHead>Status</TableHead>\r\n                      <TableHead>Actions</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {reminders.map((reminder) => (\r\n                      <TableRow key={reminder.id}>\r\n                        <TableCell>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Clock className=\"h-4 w-4\" />\r\n                            {reminder.daysBeforeExpiry} days\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"max-w-xs truncate\">\r\n                            {reminder.message || 'Default renewal reminder'}\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"text-sm\">\r\n                            {reminder.recipients?.length || 0} recipients\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Badge variant={reminder.sent ? 'default' : 'secondary'}>\r\n                            {reminder.sent ? 'Sent' : 'Pending'}\r\n                          </Badge>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {canManageRenewal && (\r\n                            <div className=\"flex gap-1\">\r\n                              <Button\r\n                                size=\"sm\"\r\n                                variant=\"outline\"\r\n                                onClick={() => handleDeleteReminder(reminder.id)}\r\n                              >\r\n                                <Trash2 className=\"h-3 w-3\" />\r\n                              </Button>\r\n                            </div>\r\n                          )}\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Renew Contract Modal */}\r\n      <Dialog open={showRenewalModal} onOpenChange={setShowRenewalModal}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Renew Contract</DialogTitle>\r\n            <DialogDescription>\r\n              Create a renewal for this contract with updated terms.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"newEndDate\">New End Date</Label>\r\n                <Input\r\n                  id=\"newEndDate\"\r\n                  type=\"date\"\r\n                  value={renewalForm.newEndDate}\r\n                  onChange={(e) => setRenewalForm(prev => ({ ...prev, newEndDate: e.target.value }))}\r\n                />\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"newValue\">New Contract Value</Label>\r\n                <Input\r\n                  id=\"newValue\"\r\n                  type=\"number\"\r\n                  value={renewalForm.newValue}\r\n                  onChange={(e) => setRenewalForm(prev => ({ ...prev, newValue: parseFloat(e.target.value) || 0 }))}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"terms\">Updated Terms</Label>\r\n              <Textarea\r\n                id=\"terms\"\r\n                value={renewalForm.terms}\r\n                onChange={(e) => setRenewalForm(prev => ({ ...prev, terms: e.target.value }))}\r\n                placeholder=\"Enter any updated terms for the renewal\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"notes\">Renewal Notes</Label>\r\n              <Textarea\r\n                id=\"notes\"\r\n                value={renewalForm.notes}\r\n                onChange={(e) => setRenewalForm(prev => ({ ...prev, notes: e.target.value }))}\r\n                placeholder=\"Add notes about this renewal\"\r\n                rows={2}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowRenewalModal(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleRenewContract} disabled={!renewalForm.newEndDate}>\r\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n              Renew Contract\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Add Reminder Modal */}\r\n      <Dialog open={showReminderModal} onOpenChange={setShowReminderModal}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Add Renewal Reminder</DialogTitle>\r\n            <DialogDescription>\r\n              Set up a reminder to be sent before the contract expires.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"daysBeforeExpiry\">Days Before Expiry</Label>\r\n              <Input\r\n                id=\"daysBeforeExpiry\"\r\n                type=\"number\"\r\n                value={reminderForm.daysBeforeExpiry}\r\n                onChange={(e) => setReminderForm(prev => ({ ...prev, daysBeforeExpiry: parseInt(e.target.value) || 30 }))}\r\n                placeholder=\"30\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"message\">Custom Message (Optional)</Label>\r\n              <Textarea\r\n                id=\"message\"\r\n                value={reminderForm.message}\r\n                onChange={(e) => setReminderForm(prev => ({ ...prev, message: e.target.value }))}\r\n                placeholder=\"Enter a custom reminder message\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowReminderModal(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleCreateReminder}>\r\n              <Bell className=\"h-4 w-4 mr-2\" />\r\n              Create Reminder\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContractRenewalManager;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractTemplateManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\ContractVersioning.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadVersions'. Either include it or remove the dependency array.","line":68,"column":6,"nodeType":"ArrayExpression","endLine":68,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, loadVersions]","fix":{"range":[2190,2203],"text":"[contract.id, loadVersions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Contract } from '@/types/contracts';\nimport { contractService } from '@/services';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { toast } from 'sonner';\nimport {\n  GitBranch,\n  Plus,\n  Eye,\n  Download,\n  MoreHorizontal,\n  History,\n  FileText,\n  AlertCircle,\n  CheckCircle,\n  Clock,\n  User,\n  Calendar\n} from 'lucide-react';\n\ninterface ContractVersion {\n  id: string;\n  version: number;\n  title: string;\n  description?: string;\n  changes: string;\n  createdBy: string;\n  createdByName: string;\n  createdAt: string;\n  status: 'draft' | 'active' | 'archived';\n  documentUrl?: string;\n  isCurrentVersion: boolean;\n}\n\ninterface ContractVersioningProps {\n  contract: Contract;\n  onVersionChange?: (version: ContractVersion) => void;\n}\n\nconst ContractVersioning: React.FC<ContractVersioningProps> = ({\n  contract,\n  onVersionChange\n}) => {\n  const { user, hasPermission } = useAuth();\n  const [versions, setVersions] = useState<ContractVersion[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showCompareModal, setShowCompareModal] = useState(false);\n  const [selectedVersions, setSelectedVersions] = useState<ContractVersion[]>([]);\n  const [versionForm, setVersionForm] = useState({\n    title: '',\n    description: '',\n    changes: ''\n  });\n\n  useEffect(() => {\n    loadVersions();\n  }, [contract.id]);\n\n  const loadVersions = async () => {\n    try {\n      setLoading(true);\n      const data = await contractService.getContractVersions(contract.id);\n      setVersions(data);\n    } catch (error) {\n      toast.error('Failed to load contract versions');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateVersion = async () => {\n    try {\n      const versionData = {\n        contractId: contract.id,\n        title: versionForm.title,\n        description: versionForm.description,\n        changes: versionForm.changes\n      };\n\n      await contractService.createContractVersion(versionData);\n      toast.success('New contract version created successfully');\n      setShowCreateModal(false);\n      setVersionForm({ title: '', description: '', changes: '' });\n      loadVersions();\n    } catch (error) {\n      toast.error('Failed to create contract version');\n    }\n  };\n\n  const handleActivateVersion = async (version: ContractVersion) => {\n    if (!confirm(`Are you sure you want to activate version ${version.version}? This will make it the current active version.`)) {\n      return;\n    }\n\n    try {\n      await contractService.activateContractVersion(contract.id, version.id);\n      toast.success(`Version ${version.version} activated successfully`);\n      loadVersions();\n      onVersionChange?.(version);\n    } catch (error) {\n      toast.error('Failed to activate version');\n    }\n  };\n\n  const handleArchiveVersion = async (version: ContractVersion) => {\n    if (!confirm(`Are you sure you want to archive version ${version.version}?`)) {\n      return;\n    }\n\n    try {\n      await contractService.archiveContractVersion(version.id);\n      toast.success(`Version ${version.version} archived successfully`);\n      loadVersions();\n    } catch (error) {\n      toast.error('Failed to archive version');\n    }\n  };\n\n  const handleDownloadVersion = (version: ContractVersion) => {\n    if (version.documentUrl) {\n      window.open(version.documentUrl, '_blank');\n    } else {\n      toast.error('Document not available for this version');\n    }\n  };\n\n  const handleCompareVersions = () => {\n    if (selectedVersions.length !== 2) {\n      toast.error('Please select exactly 2 versions to compare');\n      return;\n    }\n    setShowCompareModal(true);\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'active':\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n      case 'draft':\n        return <Clock className=\"h-4 w-4 text-yellow-600\" />;\n      case 'archived':\n        return <FileText className=\"h-4 w-4 text-gray-600\" />;\n      default:\n        return <AlertCircle className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getStatusBadge = (status: string, isCurrentVersion: boolean) => {\n    if (isCurrentVersion) {\n      return <Badge variant=\"default\">Current</Badge>;\n    }\n\n    const variants = {\n      active: 'default',\n      draft: 'secondary',\n      archived: 'outline'\n    } as const;\n\n    return (\n      <Badge variant={variants[status as keyof typeof variants] || 'outline'}>\n        {status.charAt(0).toUpperCase() + status.slice(1)}\n      </Badge>\n    );\n  };\n\n  const canCreateVersion = hasPermission('manage_contracts');\n  const canActivateVersion = hasPermission('manage_contracts');\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <GitBranch className=\"h-5 w-5\" />\n            Contract Versions\n          </CardTitle>\n          <CardDescription>\n            Manage different versions of this contract\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Action Buttons */}\n          <div className=\"flex gap-2\">\n            {canCreateVersion && (\n              <Button onClick={() => setShowCreateModal(true)}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Version\n              </Button>\n            )}\n            <Button\n              variant=\"outline\"\n              onClick={handleCompareVersions}\n              disabled={selectedVersions.length !== 2}\n            >\n              <History className=\"h-4 w-4 mr-2\" />\n              Compare Versions\n            </Button>\n          </div>\n\n          {/* Versions Table */}\n          {loading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : versions.length === 0 ? (\n            <Alert>\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                No versions found for this contract. Create the first version to get started.\n              </AlertDescription>\n            </Alert>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-12\">\n                      <input\n                        type=\"checkbox\"\n                        onChange={(e) => {\n                          if (e.target.checked) {\n                            setSelectedVersions(versions.slice(0, 2));\n                          } else {\n                            setSelectedVersions([]);\n                          }\n                        }}\n                      />\n                    </TableHead>\n                    <TableHead>Version</TableHead>\n                    <TableHead>Title</TableHead>\n                    <TableHead>Created By</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {versions.map((version) => (\n                    <TableRow key={version.id}>\n                      <TableCell>\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedVersions.some(v => v.id === version.id)}\n                          onChange={(e) => {\n                            if (e.target.checked) {\n                              if (selectedVersions.length < 2) {\n                                setSelectedVersions(prev => [...prev, version]);\n                              }\n                            } else {\n                              setSelectedVersions(prev => prev.filter(v => v.id !== version.id));\n                            }\n                          }}\n                        />\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          {getStatusIcon(version.status)}\n                          <span className=\"font-medium\">v{version.version}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          <div className=\"font-medium\">{version.title}</div>\n                          {version.description && (\n                            <div className=\"text-sm text-muted-foreground\">\n                              {version.description}\n                            </div>\n                          )}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <User className=\"h-4 w-4\" />\n                          {version.createdByName}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4\" />\n                          {new Date(version.createdAt).toLocaleDateString()}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        {getStatusBadge(version.status, version.isCurrentVersion)}\n                      </TableCell>\n                      <TableCell>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\">\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => handleDownloadVersion(version)}>\n                              <Download className=\"h-4 w-4 mr-2\" />\n                              Download\n                            </DropdownMenuItem>\n                            {canActivateVersion && version.status !== 'active' && !version.isCurrentVersion && (\n                              <DropdownMenuItem onClick={() => handleActivateVersion(version)}>\n                                <CheckCircle className=\"h-4 w-4 mr-2\" />\n                                Activate\n                              </DropdownMenuItem>\n                            )}\n                            {canActivateVersion && version.status === 'active' && !version.isCurrentVersion && (\n                              <DropdownMenuItem onClick={() => handleArchiveVersion(version)}>\n                                <FileText className=\"h-4 w-4 mr-2\" />\n                                Archive\n                              </DropdownMenuItem>\n                            )}\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n\n          {/* Version Changes */}\n          {versions.length > 0 && (\n            <div className=\"space-y-4\">\n              <h4 className=\"font-medium\">Recent Changes</h4>\n              <div className=\"space-y-2\">\n                {versions.slice(0, 3).map((version) => (\n                  <Card key={version.id} className=\"p-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium\">v{version.version}</span>\n                          {version.isCurrentVersion && (\n                            <Badge variant=\"default\" className=\"text-xs\">Current</Badge>\n                          )}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {version.changes || 'No changes documented'}\n                        </div>\n                        <div className=\"text-xs text-muted-foreground\">\n                          by {version.createdByName} on {new Date(version.createdAt).toLocaleDateString()}\n                        </div>\n                      </div>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Create Version Modal */}\n      <Dialog open={showCreateModal} onOpenChange={setShowCreateModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create New Version</DialogTitle>\n            <DialogDescription>\n              Create a new version of this contract with your changes.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"title\">Version Title</Label>\n              <Input\n                id=\"title\"\n                value={versionForm.title}\n                onChange={(e) => setVersionForm(prev => ({ ...prev, title: e.target.value }))}\n                placeholder=\"Enter version title\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Description (Optional)</Label>\n              <Input\n                id=\"description\"\n                value={versionForm.description}\n                onChange={(e) => setVersionForm(prev => ({ ...prev, description: e.target.value }))}\n                placeholder=\"Brief description of this version\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"changes\">Changes Made</Label>\n              <Textarea\n                id=\"changes\"\n                value={versionForm.changes}\n                onChange={(e) => setVersionForm(prev => ({ ...prev, changes: e.target.value }))}\n                placeholder=\"Describe the changes made in this version\"\n                rows={4}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowCreateModal(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleCreateVersion} disabled={!versionForm.title.trim()}>\n              Create Version\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Compare Versions Modal */}\n      <Dialog open={showCompareModal} onOpenChange={setShowCompareModal}>\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Compare Versions</DialogTitle>\n            <DialogDescription>\n              Comparing version {selectedVersions[0]?.version} with version {selectedVersions[1]?.version}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            {selectedVersions.length === 2 && (\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <h4 className=\"font-medium mb-2\">Version {selectedVersions[0].version}</h4>\n                  <Card className=\"p-4\">\n                    <div className=\"space-y-2\">\n                      <div><strong>Title:</strong> {selectedVersions[0].title}</div>\n                      <div><strong>Created:</strong> {new Date(selectedVersions[0].createdAt).toLocaleDateString()}</div>\n                      <div><strong>Changes:</strong> {selectedVersions[0].changes || 'No changes documented'}</div>\n                    </div>\n                  </Card>\n                </div>\n                <div>\n                  <h4 className=\"font-medium mb-2\">Version {selectedVersions[1].version}</h4>\n                  <Card className=\"p-4\">\n                    <div className=\"space-y-2\">\n                      <div><strong>Title:</strong> {selectedVersions[1].title}</div>\n                      <div><strong>Created:</strong> {new Date(selectedVersions[1].createdAt).toLocaleDateString()}</div>\n                      <div><strong>Changes:</strong> {selectedVersions[1].changes || 'No changes documented'}</div>\n                    </div>\n                  </Card>\n                </div>\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowCompareModal(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default ContractVersioning;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\contracts\\DigitalSignatureWorkflow.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSignatures'. Either include it or remove the dependency array.","line":57,"column":6,"nodeType":"ArrayExpression","endLine":57,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [contract.id, loadSignatures]","fix":{"range":[1862,1875],"text":"[contract.id, loadSignatures]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Contract, DigitalSignature, ContractParty } from '@/types/contracts';\nimport { contractService } from '@/services';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { toast } from 'sonner';\nimport {\n  PenTool,\n  Send,\n  CheckCircle,\n  XCircle,\n  Clock,\n  Mail,\n  User,\n  AlertCircle,\n  RefreshCw,\n  Download,\n  Eye\n} from 'lucide-react';\n\ninterface DigitalSignatureWorkflowProps {\n  contract: Contract;\n  onSignatureUpdate?: () => void;\n}\n\nconst DigitalSignatureWorkflow: React.FC<DigitalSignatureWorkflowProps> = ({\n  contract,\n  onSignatureUpdate\n}) => {\n  const { user, hasPermission } = useAuth();\n  const [signatures, setSignatures] = useState<DigitalSignature[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [showRequestModal, setShowRequestModal] = useState(false);\n  const [showSignModal, setShowSignModal] = useState(false);\n  const [selectedParty, setSelectedParty] = useState<ContractParty | null>(null);\n  const [requestForm, setRequestForm] = useState({\n    signerEmail: '',\n    signerName: '',\n    message: '',\n    deadline: ''\n  });\n  const [signatureData, setSignatureData] = useState({\n    signature: '',\n    comments: ''\n  });\n\n  useEffect(() => {\n    loadSignatures();\n  }, [contract.id]);\n\n  const loadSignatures = async () => {\n    try {\n      setLoading(true);\n      const data = await contractService.getSignatures(contract.id);\n      setSignatures(data);\n    } catch (error) {\n      console.error('Failed to load signatures:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRequestSignature = async () => {\n    try {\n      await contractService.requestSignature(contract.id, requestForm.signerEmail);\n      toast.success('Signature request sent successfully');\n      setShowRequestModal(false);\n      setRequestForm({ signerEmail: '', signerName: '', message: '', deadline: '' });\n      loadSignatures();\n      onSignatureUpdate?.();\n    } catch (error) {\n      toast.error('Failed to send signature request');\n    }\n  };\n\n  const handleSign = async () => {\n    try {\n      await contractService.signContract(contract.id, {\n        signature: signatureData.signature,\n        comments: signatureData.comments\n      });\n      toast.success('Contract signed successfully');\n      setShowSignModal(false);\n      setSignatureData({ signature: '', comments: '' });\n      loadSignatures();\n      onSignatureUpdate?.();\n    } catch (error) {\n      toast.error('Failed to sign contract');\n    }\n  };\n\n  const handleResendRequest = async (signature: DigitalSignature) => {\n    try {\n      await contractService.resendSignatureRequest(signature.id);\n      toast.success('Signature request resent');\n      loadSignatures();\n    } catch (error) {\n      toast.error('Failed to resend signature request');\n    }\n  };\n\n  const handleCancelRequest = async (signature: DigitalSignature) => {\n    if (!confirm('Are you sure you want to cancel this signature request?')) return;\n\n    try {\n      await contractService.cancelSignatureRequest(signature.id);\n      toast.success('Signature request cancelled');\n      loadSignatures();\n      onSignatureUpdate?.();\n    } catch (error) {\n      toast.error('Failed to cancel signature request');\n    }\n  };\n\n  const getSignatureProgress = () => {\n    if (signatures.length === 0) return 0;\n    const completed = signatures.filter(s => s.status === 'completed').length;\n    return (completed / signatures.length) * 100;\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'completed':\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n      case 'pending':\n        return <Clock className=\"h-4 w-4 text-yellow-600\" />;\n      case 'declined':\n        return <XCircle className=\"h-4 w-4 text-red-600\" />;\n      default:\n        return <AlertCircle className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants = {\n      completed: 'default',\n      pending: 'secondary',\n      declined: 'destructive'\n    } as const;\n\n    return (\n      <Badge variant={variants[status as keyof typeof variants] || 'outline'}>\n        {status.charAt(0).toUpperCase() + status.slice(1)}\n      </Badge>\n    );\n  };\n\n  const canRequestSignature = hasPermission('manage_contracts') && contract.status === 'active';\n  const canSign = contract.parties.some(p => p.email === user?.email && p.signature_required);\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <PenTool className=\"h-5 w-5\" />\n            Digital Signatures\n          </CardTitle>\n          <CardDescription>\n            Manage digital signatures for this contract\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Signature Progress */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span>Signature Progress</span>\n              <span>{signatures.filter(s => s.status === 'completed').length} of {signatures.length} completed</span>\n            </div>\n            <Progress value={getSignatureProgress()} className=\"h-2\" />\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-2\">\n            {canRequestSignature && (\n              <Button onClick={() => setShowRequestModal(true)}>\n                <Send className=\"h-4 w-4 mr-2\" />\n                Request Signature\n              </Button>\n            )}\n            {canSign && (\n              <Button variant=\"outline\" onClick={() => setShowSignModal(true)}>\n                <PenTool className=\"h-4 w-4 mr-2\" />\n                Sign Contract\n              </Button>\n            )}\n            <Button variant=\"outline\" onClick={loadSignatures}>\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Refresh\n            </Button>\n          </div>\n\n          {/* Signatures List */}\n          {loading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : signatures.length === 0 ? (\n            <Alert>\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                No signature requests have been sent for this contract yet.\n              </AlertDescription>\n            </Alert>\n          ) : (\n            <div className=\"space-y-4\">\n              {signatures.map((signature) => (\n                <Card key={signature.id} className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      {getStatusIcon(signature.status)}\n                      <div>\n                        <div className=\"font-medium\">{signature.signerName}</div>\n                        <div className=\"text-sm text-muted-foreground\">{signature.signerEmail}</div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {getStatusBadge(signature.status)}\n                      {signature.status === 'pending' && canRequestSignature && (\n                        <div className=\"flex gap-1\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleResendRequest(signature)}\n                          >\n                            <Mail className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleCancelRequest(signature)}\n                          >\n                            <XCircle className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      )}\n                      {signature.status === 'completed' && signature.signatureUrl && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => window.open(signature.signatureUrl, '_blank')}\n                        >\n                          <Eye className=\"h-3 w-3\" />\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                  {signature.status === 'completed' && (\n                    <div className=\"mt-2 text-xs text-muted-foreground\">\n                      Signed on {new Date(signature.timestamp).toLocaleDateString()} at {new Date(signature.timestamp).toLocaleTimeString()}\n                    </div>\n                  )}\n                  {signature.verificationCode && (\n                    <div className=\"mt-2 text-xs\">\n                      <span className=\"font-medium\">Verification Code:</span> {signature.verificationCode}\n                    </div>\n                  )}\n                </Card>\n              ))}\n            </div>\n          )}\n\n          {/* Contract Parties */}\n          <div className=\"space-y-2\">\n            <h4 className=\"font-medium\">Required Signers</h4>\n            <div className=\"space-y-2\">\n              {contract.parties.filter(p => p.signature_required).map((party) => {\n                const signature = signatures.find(s => s.signerEmail === party.email);\n                return (\n                  <div key={party.id} className=\"flex items-center justify-between p-2 border rounded\">\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"h-4 w-4\" />\n                      <div>\n                        <div className=\"font-medium\">{party.name}</div>\n                        <div className=\"text-sm text-muted-foreground\">{party.email}</div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {signature ? (\n                        getStatusBadge(signature.status)\n                      ) : (\n                        <Badge variant=\"outline\">Not Requested</Badge>\n                      )}\n                      {!signature && canRequestSignature && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => {\n                            setSelectedParty(party);\n                            setRequestForm(prev => ({\n                              ...prev,\n                              signerEmail: party.email,\n                              signerName: party.name\n                            }));\n                            setShowRequestModal(true);\n                          }}\n                        >\n                          <Send className=\"h-3 w-3 mr-1\" />\n                          Request\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Request Signature Modal */}\n      <Dialog open={showRequestModal} onOpenChange={setShowRequestModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Request Digital Signature</DialogTitle>\n            <DialogDescription>\n              Send a signature request to a party for this contract.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"signerName\">Signer Name</Label>\n              <Input\n                id=\"signerName\"\n                value={requestForm.signerName}\n                onChange={(e) => setRequestForm(prev => ({ ...prev, signerName: e.target.value }))}\n                placeholder=\"Enter signer's full name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"signerEmail\">Signer Email</Label>\n              <Input\n                id=\"signerEmail\"\n                type=\"email\"\n                value={requestForm.signerEmail}\n                onChange={(e) => setRequestForm(prev => ({ ...prev, signerEmail: e.target.value }))}\n                placeholder=\"Enter signer's email address\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"deadline\">Deadline (Optional)</Label>\n              <Input\n                id=\"deadline\"\n                type=\"date\"\n                value={requestForm.deadline}\n                onChange={(e) => setRequestForm(prev => ({ ...prev, deadline: e.target.value }))}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"message\">Custom Message (Optional)</Label>\n              <Textarea\n                id=\"message\"\n                value={requestForm.message}\n                onChange={(e) => setRequestForm(prev => ({ ...prev, message: e.target.value }))}\n                placeholder=\"Add a custom message for the signer\"\n                rows={3}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowRequestModal(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleRequestSignature}>\n              Send Request\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Sign Contract Modal */}\n      <Dialog open={showSignModal} onOpenChange={setShowSignModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Sign Contract</DialogTitle>\n            <DialogDescription>\n              Provide your digital signature for this contract.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"signature\">Digital Signature</Label>\n              <Input\n                id=\"signature\"\n                value={signatureData.signature}\n                onChange={(e) => setSignatureData(prev => ({ ...prev, signature: e.target.value }))}\n                placeholder=\"Type your full name as your digital signature\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"comments\">Comments (Optional)</Label>\n              <Textarea\n                id=\"comments\"\n                value={signatureData.comments}\n                onChange={(e) => setSignatureData(prev => ({ ...prev, comments: e.target.value }))}\n                placeholder=\"Add any comments about your signature\"\n                rows={3}\n              />\n            </div>\n            <Alert>\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                By signing this contract, you agree to all terms and conditions specified in the document.\n                This action is legally binding and cannot be undone.\n              </AlertDescription>\n            </Alert>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowSignModal(false)}>\n              Cancel\n            </Button>\n            <Button onClick={handleSign} disabled={!signatureData.signature.trim()}>\n              <PenTool className=\"h-4 w-4 mr-2\" />\n              Sign Contract\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n\nexport default DigitalSignatureWorkflow;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\errors\\DataTabErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\errors\\ErrorBoundaryLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\errors\\RootBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\example\\DidYouKnow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\example\\TextRotate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\example\\TextShimmer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\layout\\DashboardLayout.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'sidebarScrollRestoration'. Either include it or remove the dependency array.","line":176,"column":6,"nodeType":"ArrayExpression","endLine":176,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [location.pathname, sidebarScrollRestoration]","fix":{"range":[6313,6332],"text":"[location.pathname, sidebarScrollRestoration]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'pageScrollRestoration'. Either include it or remove the dependency array.","line":185,"column":6,"nodeType":"ArrayExpression","endLine":185,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [location.pathname, pageScrollRestoration]","fix":{"range":[6565,6584],"text":"[location.pathname, pageScrollRestoration]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'pageScrollRestoration' and 'sidebarScrollRestoration'. Either include them or remove the dependency array.","line":193,"column":6,"nodeType":"ArrayExpression","endLine":193,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [pageScrollRestoration, sidebarScrollRestoration]","fix":{"range":[6803,6805],"text":"[pageScrollRestoration, sidebarScrollRestoration]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { Outlet, useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { usePortal } from '../../contexts/PortalContext';\r\nimport { useSidebarScroll, usePageScroll } from '../../contexts/ScrollStateContext';\r\nimport { useScrollRestoration } from '../../hooks/useScrollRestoration';\r\nimport { Button } from '../ui/button';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '../ui/avatar';\r\nimport { Badge } from '../ui/badge';\r\nimport { Sheet, SheetContent, SheetTrigger } from '../ui/sheet';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator, DropdownMenuTrigger } from '../ui/dropdown-menu';\r\nimport { Input } from '../ui/input';\r\nimport { Separator } from '../ui/separator';\r\nimport { \r\n  Menu, \r\n  Search, \r\n  Bell, \r\n  Settings, \r\n  LogOut, \r\n  User, \r\n  Shield,\r\n  LayoutDashboard,\r\n  Users,\r\n  ShoppingCart,\r\n  Package,\r\n  FileText,\r\n  MessageSquare,\r\n  Wrench,\r\n  Building,\r\n  Database,\r\n  Activity,\r\n  ChevronRight,\r\n  Home,\r\n  Sparkles\r\n} from 'lucide-react';\r\nimport { cn } from '../../lib/utils';\r\n\r\nconst DashboardLayout = () => {\r\n  const { user, logout, hasRole, hasPermission } = useAuth();\r\n  const { currentPortal, switchPortal } = usePortal();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  // Scroll state management\r\n  const sidebarRef = useRef<HTMLDivElement>(null);\r\n  const pageContentRef = useRef<HTMLDivElement>(null);\r\n  const {\r\n    saveSidebarScrollPosition,\r\n    restoreSidebarScrollPosition,\r\n    getSidebarScrollRef\r\n  } = useSidebarScroll();\r\n  const {\r\n    savePageScrollPosition,\r\n    restorePageScrollPosition,\r\n    getPageScrollRef\r\n  } = usePageScroll();\r\n\r\n  // Set up scroll restoration for sidebar\r\n  const sidebarScrollRestoration = useScrollRestoration(\r\n    sidebarRef,\r\n    saveSidebarScrollPosition,\r\n    restoreSidebarScrollPosition,\r\n    {\r\n      smooth: true,\r\n      delay: 150,\r\n      threshold: 5,\r\n      debounceMs: 200\r\n    }\r\n  );\r\n\r\n  // Set up scroll restoration for page content\r\n  const pageScrollRestoration = useScrollRestoration(\r\n    pageContentRef,\r\n    savePageScrollPosition,\r\n    restorePageScrollPosition,\r\n    {\r\n      smooth: true,\r\n      delay: 100,\r\n      threshold: 10,\r\n      debounceMs: 150\r\n    }\r\n  );\r\n\r\n  // Navigation items grouped by sections\r\n  const navigationSections = [\r\n    {\r\n      title: \"Core\",\r\n      items: [\r\n        { name: 'Dashboard', href: '/tenant/dashboard', icon: LayoutDashboard, permission: 'read' },\r\n        { name: 'Customers', href: '/tenant/customers', icon: Users, permission: 'read' },\r\n        { name: 'Sales', href: '/tenant/sales', icon: ShoppingCart, permission: 'read' },\r\n      ]\r\n    },\r\n    {\r\n      title: \"Operations\",\r\n      items: [\r\n        { name: 'Product Sales', href: '/tenant/product-sales', icon: Package, permission: 'manage_sales' },\r\n        { name: 'Contracts', href: '/tenant/contracts', icon: FileText, permission: 'manage_contracts' },\r\n        { name: 'Service Contracts', href: '/tenant/service-contracts', icon: Shield, permission: 'manage_contracts' },\r\n        { name: 'Tickets', href: '/tenant/tickets', icon: MessageSquare, permission: 'read' },\r\n        { name: 'Complaints', href: '/tenant/complaints', icon: MessageSquare, permission: 'read' },\r\n        { name: 'Job Works', href: '/tenant/job-works', icon: Wrench, permission: 'read' },\r\n      ]\r\n    }\r\n  ];\r\n\r\n  // Admin-only sections (Super admin has access to all)\r\n  if (hasRole('admin') || hasRole('super_admin')) {\r\n    navigationSections.push({\r\n      title: \"Administration\",\r\n      items: [\r\n        { name: 'User Management', href: '/tenant/users/list', icon: Users, permission: 'manage_users' },\r\n        { name: 'Role Management', href: '/tenant/users/roles', icon: Shield, permission: 'manage_roles' },\r\n        { name: 'Permission Matrix', href: '/tenant/users/permissions', icon: Settings, permission: 'manage_roles' },\r\n        { name: 'PDF Templates', href: '/tenant/configuration/pdf-templates', icon: FileText, permission: 'manage_users' },\r\n        { name: 'Company Master', href: '/tenant/masters/companies', icon: Building, permission: 'manage_companies' },\r\n        { name: 'Product Master', href: '/tenant/masters/products', icon: Package, permission: 'manage_products' },\r\n        { name: 'Audit Logs', href: '/tenant/logs', icon: Activity, permission: 'manage_users' },\r\n      ]\r\n    });\r\n  }\r\n\r\n  // Settings section (Super admin has access to all)\r\n  if (hasPermission('manage_users') || hasRole('super_admin')) {\r\n    navigationSections.push({\r\n      title: \"Settings\",\r\n      items: [\r\n        { name: 'Configuration', href: '/tenant/configuration/tenant', icon: Settings, permission: 'manage_users' },\r\n        { name: 'Notifications', href: '/tenant/notifications', icon: Bell, permission: 'read' },\r\n      ]\r\n    });\r\n  }\r\n\r\n\r\n\r\n  // Generate breadcrumbs\r\n  const generateBreadcrumbs = () => {\r\n    const pathSegments = location.pathname.split('/').filter(Boolean);\r\n    const breadcrumbs = [{ name: 'Home', href: '/tenant/dashboard' }];\r\n    \r\n    let currentPath = '';\r\n    pathSegments.forEach((segment, index) => {\r\n      if (segment !== 'tenant') {\r\n        currentPath += `/${segment}`;\r\n        const name = segment.charAt(0).toUpperCase() + segment.slice(1).replace('-', ' ');\r\n        breadcrumbs.push({\r\n          name,\r\n          href: index === pathSegments.length - 1 ? undefined : `/tenant${currentPath}`\r\n        });\r\n      }\r\n    });\r\n    \r\n    return breadcrumbs;\r\n  };\r\n\r\n  const breadcrumbs = generateBreadcrumbs();\r\n\r\n  const handleLogout = () => {\r\n    // Save scroll positions before logout\r\n    sidebarScrollRestoration.saveCurrentPosition();\r\n    pageScrollRestoration.saveCurrentPosition();\r\n\r\n    logout();\r\n    navigate('/login');\r\n  };\r\n\r\n  // Restore sidebar scroll position on mount and route changes\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      sidebarScrollRestoration.restoreScrollPosition();\r\n    }, 200); // Delay to ensure sidebar content is rendered\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [location.pathname]);\r\n\r\n  // Restore page scroll position when route changes\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      pageScrollRestoration.restoreScrollPosition();\r\n    }, 100);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [location.pathname]);\r\n\r\n  // Save scroll positions when component unmounts\r\n  useEffect(() => {\r\n    return () => {\r\n      sidebarScrollRestoration.saveCurrentPosition();\r\n      pageScrollRestoration.saveCurrentPosition();\r\n    };\r\n  }, []);\r\n\r\n  const handleNavigation = (href: string) => {\r\n    // Save current scroll positions before navigation\r\n    sidebarScrollRestoration.saveCurrentPosition();\r\n    pageScrollRestoration.saveCurrentPosition();\r\n\r\n    navigate(href);\r\n    setIsMobileMenuOpen(false);\r\n  };\r\n\r\n  const isActiveRoute = (href: string) => {\r\n    return location.pathname === href;\r\n  };\r\n\r\n  const SidebarContent = () => (\r\n    <div className=\"flex h-full flex-col bg-white border-r border-neutral-200\">\r\n      {/* Logo Section */}\r\n      <div className=\"flex h-16 items-center px-6 border-b border-neutral-200\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <div className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-accent-500 shadow-sm\">\r\n            <Database className=\"h-5 w-5 text-white\" />\r\n          </div>\r\n          <div className=\"flex flex-col\">\r\n            <span className=\"text-lg font-semibold text-neutral-900 tracking-tight\">CRM Pro</span>\r\n            <span className=\"text-xs text-neutral-500 font-medium\">Enterprise</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Navigation */}\r\n      <nav ref={sidebarRef} className=\"flex-1 space-y-1 p-4 overflow-y-auto\">\r\n        {navigationSections.map((section) => (\r\n          <div key={section.title} className=\"space-y-2\">\r\n            <h3 className=\"text-xs font-semibold text-neutral-500 uppercase tracking-wider px-3 py-2\">\r\n              {section.title}\r\n            </h3>\r\n            <div className=\"space-y-1\">\r\n              {section.items\r\n                .filter(item => hasPermission(item.permission) || hasRole('super_admin'))\r\n                .map((item) => {\r\n                  const Icon = item.icon;\r\n                  const isActive = isActiveRoute(item.href);\r\n                  return (\r\n                    <button\r\n                      key={item.name}\r\n                      onClick={() => handleNavigation(item.href)}\r\n                      className={cn(\r\n                        \"w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium rounded-md transition-all duration-200 group focus-ring\",\r\n                        isActive\r\n                          ? \"bg-accent-50 text-accent-700 border-r-2 border-accent-500\"\r\n                          : \"text-neutral-700 hover:text-neutral-900 hover:bg-neutral-50\"\r\n                      )}\r\n                      aria-current={isActive ? \"page\" : undefined}\r\n                      aria-label={`Navigate to ${item.name}`}\r\n                    >\r\n                      <Icon\r\n                        className={cn(\r\n                          \"h-5 w-5 transition-colors duration-200 flex-shrink-0\",\r\n                          isActive ? \"text-accent-500\" : \"text-neutral-400 group-hover:text-neutral-500\"\r\n                        )}\r\n                        aria-hidden=\"true\"\r\n                      />\r\n                      <span className=\"flex-1 text-left\">{item.name}</span>\r\n                    </button>\r\n                  );\r\n                })}\r\n            </div>\r\n            {section !== navigationSections[navigationSections.length - 1] && (\r\n              <Separator className=\"bg-neutral-200 my-4\" />\r\n            )}\r\n          </div>\r\n        ))}\r\n      </nav>\r\n\r\n      {/* User Section */}\r\n      <div className=\"border-t border-neutral-200 p-4\">\r\n        <div className=\"flex items-center space-x-3 p-3 rounded-lg hover:bg-neutral-50 transition-all duration-200\">\r\n          <Avatar className=\"h-10 w-10\">\r\n            <AvatarImage src={user?.avatar} />\r\n            <AvatarFallback className=\"bg-accent-500 text-white font-semibold\">\r\n              {user?.name?.charAt(0) || 'U'}\r\n            </AvatarFallback>\r\n          </Avatar>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <p className=\"text-sm font-semibold text-neutral-900 truncate\">{user?.name}</p>\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Badge variant=\"secondary\" className=\"text-xs\">\r\n                {user?.role}\r\n              </Badge>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {/* Skip Link for Accessibility */}\r\n      <a\r\n        href=\"#main-content\"\r\n        className=\"skip-link\"\r\n        onFocus={(e) => e.target.classList.add('not-sr-only')}\r\n        onBlur={(e) => e.target.classList.remove('not-sr-only')}\r\n      >\r\n        Skip to main content\r\n      </a>\r\n\r\n      <div className=\"h-screen flex bg-neutral-50\">\r\n        {/* Desktop Sidebar */}\r\n        <aside\r\n          className=\"hidden lg:flex lg:w-64 lg:flex-col\"\r\n          aria-label=\"Main navigation\"\r\n          role=\"navigation\"\r\n        >\r\n          <SidebarContent />\r\n        </aside>\r\n\r\n        {/* Mobile Sidebar */}\r\n        <Sheet open={isMobileMenuOpen} onOpenChange={setIsMobileMenuOpen}>\r\n          <SheetContent\r\n            side=\"left\"\r\n            className=\"p-0 w-64\"\r\n            aria-label=\"Mobile navigation\"\r\n          >\r\n            <SidebarContent />\r\n          </SheetContent>\r\n        </Sheet>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n        {/* Header */}\r\n        <header className=\"bg-white border-b border-neutral-200 shadow-sm\">\r\n          <div className=\"flex h-14 sm:h-16 items-center justify-between px-3 sm:px-4 lg:px-6\">\r\n            {/* Left Section */}\r\n            <div className=\"flex items-center space-x-2 sm:space-x-4 flex-1 min-w-0\">\r\n              <Sheet>\r\n                <SheetTrigger asChild>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"lg:hidden p-2\"\r\n                    onClick={() => setIsMobileMenuOpen(true)}\r\n                    aria-label=\"Open navigation menu\"\r\n                    aria-expanded={isMobileMenuOpen}\r\n                    aria-controls=\"mobile-navigation\"\r\n                  >\r\n                    <Menu className=\"h-5 w-5\" />\r\n                  </Button>\r\n                </SheetTrigger>\r\n              </Sheet>\r\n\r\n              {/* Breadcrumbs */}\r\n              <nav className=\"hidden sm:flex items-center space-x-1 sm:space-x-2 text-sm min-w-0 flex-1\">\r\n                {breadcrumbs.map((crumb, index) => (\r\n                  <React.Fragment key={crumb.name}>\r\n                    {index > 0 && <ChevronRight className=\"h-3 w-3 sm:h-4 sm:w-4 text-neutral-400 flex-shrink-0\" />}\r\n                    {crumb.href ? (\r\n                      <button\r\n                        onClick={() => navigate(crumb.href!)}\r\n                        className=\"font-medium text-neutral-600 hover:text-neutral-900 transition-colors px-1 sm:px-2 py-1 rounded-md hover:bg-neutral-100 truncate\"\r\n                      >\r\n                        {crumb.name}\r\n                      </button>\r\n                    ) : (\r\n                      <span className=\"font-semibold text-neutral-900 px-1 sm:px-2 py-1 rounded-md bg-neutral-100 truncate\">\r\n                        {crumb.name}\r\n                      </span>\r\n                    )}\r\n                  </React.Fragment>\r\n                ))}\r\n              </nav>\r\n\r\n              {/* Mobile Page Title */}\r\n              <div className=\"sm:hidden flex-1 min-w-0\">\r\n                <h1 className=\"text-lg font-semibold text-neutral-900 truncate\">\r\n                  {breadcrumbs[breadcrumbs.length - 1]?.name || 'Dashboard'}\r\n                </h1>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Center Section - Search */}\r\n            <div className=\"hidden md:flex flex-1 max-w-md mx-4\">\r\n              <div className=\"relative w-full\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-neutral-400\" />\r\n                <Input\r\n                  type=\"text\"\r\n                  placeholder=\"Search customers, contracts, tickets...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"pl-10 w-full\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Right Section */}\r\n            <div className=\"flex items-center space-x-1 sm:space-x-3\">\r\n              {/* Mobile Search Button */}\r\n              <Button variant=\"ghost\" size=\"sm\" className=\"md:hidden p-2\">\r\n                <Search className=\"h-5 w-5\" />\r\n              </Button>\r\n\r\n              {/* Notifications */}\r\n              <Button variant=\"ghost\" size=\"sm\" className=\"relative p-2\">\r\n                <Bell className=\"h-5 w-5\" />\r\n                <Badge className=\"absolute -top-1 -right-1 h-4 w-4 sm:h-5 sm:w-5 p-0 text-xs\" variant=\"destructive\">\r\n                  3\r\n                </Badge>\r\n              </Button>\r\n\r\n              {/* Portal Switcher for Super Admin */}\r\n              {hasRole('super_admin') && (\r\n                <DropdownMenu>\r\n                  <DropdownMenuTrigger asChild>\r\n                    <Button variant=\"outline\" size=\"sm\" className=\"border-accent-300 text-accent-600 hover:bg-accent-50\">\r\n                      <Shield className=\"h-4 w-4 mr-2\" />\r\n                      {currentPortal === 'super-admin' ? 'Super Admin' : 'Tenant'}\r\n                    </Button>\r\n                  </DropdownMenuTrigger>\r\n                  <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n                    <DropdownMenuLabel>Switch Portal</DropdownMenuLabel>\r\n                    <DropdownMenuSeparator />\r\n                    <DropdownMenuItem onClick={() => switchPortal('tenant')}>\r\n                      <Building className=\"mr-2 h-4 w-4\" />\r\n                      Tenant Portal\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuItem onClick={() => switchPortal('super-admin')}>\r\n                      <Shield className=\"mr-2 h-4 w-4\" />\r\n                      Super Admin Portal\r\n                    </DropdownMenuItem>\r\n                  </DropdownMenuContent>\r\n                </DropdownMenu>\r\n              )}\r\n\r\n              {/* User Menu */}\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"ghost\" className=\"relative h-10 w-10 rounded-full\">\r\n                    <Avatar className=\"h-10 w-10\">\r\n                      <AvatarImage src={user?.avatar} />\r\n                      <AvatarFallback className=\"bg-accent-500 text-white font-semibold\">\r\n                        {user?.name?.charAt(0) || 'U'}\r\n                      </AvatarFallback>\r\n                    </Avatar>\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent className=\"w-56\" align=\"end\">\r\n                  <DropdownMenuLabel className=\"font-normal\">\r\n                    <div className=\"flex flex-col space-y-1\">\r\n                      <p className=\"text-sm font-medium leading-none text-neutral-900\">{user?.name}</p>\r\n                      <p className=\"text-xs leading-none text-neutral-500\">{user?.email}</p>\r\n                      <Badge variant=\"secondary\" className=\"w-fit text-xs mt-1\">\r\n                        {user?.role}\r\n                      </Badge>\r\n                    </div>\r\n                  </DropdownMenuLabel>\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem onClick={() => navigate('/tenant/profile')}>\r\n                    <User className=\"mr-2 h-4 w-4\" />\r\n                    Profile\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem onClick={() => navigate('/tenant/settings')}>\r\n                    <Settings className=\"mr-2 h-4 w-4\" />\r\n                    Settings\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem onClick={handleLogout} className=\"text-error-600\">\r\n                    <LogOut className=\"mr-2 h-4 w-4\" />\r\n                    Log out\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            </div>\r\n          </div>\r\n        </header>\r\n\r\n        {/* Main Content Area */}\r\n        <main\r\n          id=\"main-content\"\r\n          ref={pageContentRef}\r\n          className=\"flex-1 overflow-auto bg-neutral-50\"\r\n          role=\"main\"\r\n          aria-label=\"Main content\"\r\n          tabIndex={-1}\r\n        >\r\n          <div className=\"h-full\">\r\n            <Outlet />\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DashboardLayout;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\layout\\EnterpriseLayout.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'location.pathname'. Either exclude it or remove the dependency array.","line":182,"column":6,"nodeType":"ArrayExpression","endLine":182,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [user]","fix":{"range":[5345,5370],"text":"[user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Enterprise Layout Component\r\n * Salesforce-inspired professional layout with sidebar navigation\r\n * Consistent across all pages (Admin, Super Admin, Regular Users)\r\n * \r\n * Features:\r\n * - Permission-based navigation filtering\r\n * - Role-based access control\r\n * - Dynamic section visibility (only shows when children are visible)\r\n * - Full RBAC integration with AuthContext\r\n * - Responsive design with collapsed sidebar\r\n * \r\n * @see src/config/navigationPermissions.ts for navigation configuration\r\n * @see src/utils/navigationFilter.ts for filtering logic\r\n */\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport { Layout, Menu, Avatar, Dropdown, Badge, Button, Breadcrumb, Space, Divider } from 'antd';\r\nimport type { MenuProps } from 'antd';\r\nimport {\r\n  DashboardOutlined,\r\n  UserOutlined,\r\n  TeamOutlined,\r\n  FileTextOutlined,\r\n  SettingOutlined,\r\n  BellOutlined,\r\n  MenuFoldOutlined,\r\n  MenuUnfoldOutlined,\r\n  LogoutOutlined,\r\n  ProfileOutlined,\r\n  SafetyOutlined,\r\n  AppstoreOutlined,\r\n  ShoppingCartOutlined,\r\n  CustomerServiceOutlined,\r\n  BarChartOutlined,\r\n  ToolOutlined,\r\n  DatabaseOutlined,\r\n  HomeOutlined,\r\n} from '@ant-design/icons';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { navigationConfig } from '@/config/navigationPermissions';\r\nimport {\r\n  filterNavigationItems,\r\n  createNavigationFilterContext,\r\n  getPermissionAwareBreadcrumbs,\r\n} from '@/utils/navigationFilter';\r\nimport type { FilteredNavigationItem } from '@/utils/navigationFilter';\r\n\r\nconst { Header, Sider, Content } = Layout;\r\n\r\ninterface EnterpriseLayoutProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const EnterpriseLayout: React.FC<EnterpriseLayoutProps> = ({ children }) => {\r\n  const [collapsed, setCollapsed] = useState(false);\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { user, logout, hasRole, hasPermission } = useAuth();\r\n\r\n  /**\r\n   * Get user permissions based on role\r\n   * Maps role to their permissions for navigation purposes\r\n   * This determines which menu items are visible\r\n   * \r\n   * Note: In production, this should fetch from the actual permission system\r\n   */\r\n  const getUserPermissions = (role: string): string[] => {\r\n    // Map roles to their permissions for navigation purposes\r\n    // This determines which menu items are visible\r\n    const rolePermissionMap: Record<string, string[]> = {\r\n      super_admin: [\r\n        'read',\r\n        'write',\r\n        'delete',\r\n        'manage_customers',\r\n        'manage_sales',\r\n        'manage_tickets',\r\n        'manage_complaints',\r\n        'manage_contracts',\r\n        'manage_service_contracts',\r\n        'manage_products',\r\n        'manage_product_sales',\r\n        'manage_job_works',\r\n        'manage_users',\r\n        'manage_roles',\r\n        'view_analytics',\r\n        'manage_settings',\r\n        'manage_companies',\r\n        'platform_admin',\r\n        'super_admin',\r\n        'manage_tenants',\r\n        'system_monitoring',\r\n      ],\r\n      admin: [\r\n        'read',\r\n        'write',\r\n        'delete',\r\n        'manage_customers',\r\n        'manage_sales',\r\n        'manage_tickets',\r\n        'manage_complaints',\r\n        'manage_contracts',\r\n        'manage_service_contracts',\r\n        'manage_products',\r\n        'manage_product_sales',\r\n        'manage_job_works',\r\n        'manage_users',\r\n        'manage_roles',\r\n        'view_analytics',\r\n        'manage_settings',\r\n        'manage_companies',\r\n      ],\r\n      manager: [\r\n        'read',\r\n        'write',\r\n        'manage_customers',\r\n        'manage_sales',\r\n        'manage_tickets',\r\n        'manage_complaints',\r\n        'manage_contracts',\r\n        'manage_service_contracts',\r\n        'manage_products',\r\n        'manage_product_sales',\r\n        'view_analytics',\r\n      ],\r\n      engineer: [\r\n        'read',\r\n        'write',\r\n        'manage_products',\r\n        'manage_product_sales',\r\n        'manage_job_works',\r\n        'manage_tickets',\r\n      ],\r\n      agent: ['read', 'write', 'manage_customers', 'manage_tickets', 'manage_complaints'],\r\n      customer: ['read'],\r\n    };\r\n\r\n    return rolePermissionMap[role] || ['read'];\r\n  };\r\n\r\n  /**\r\n   * Get permission-filtered navigation items\r\n   * \r\n   * Memoized computation to avoid recalculating on every render.\r\n   * Filters navigation items based on user permissions and roles.\r\n   * Only includes items the user has access to.\r\n   */\r\n  const filteredNavItems = useMemo(() => {\r\n    if (!user) return [];\r\n\r\n    // Get user permissions from role mapping\r\n    const userPermissions = getUserPermissions(user.role);\r\n\r\n    const filterContext = createNavigationFilterContext(user.role, userPermissions);\r\n    return filterNavigationItems(navigationConfig, filterContext);\r\n  }, [user]);\r\n\r\n  /**\r\n   * Get permission-aware breadcrumbs\r\n   */\r\n  const breadcrumbItems = useMemo(() => {\r\n    if (!user) return [];\r\n\r\n    const userPermissions = getUserPermissions(user.role);\r\n    const filterContext = createNavigationFilterContext(user.role, userPermissions);\r\n\r\n    const breadcrumbs = [\r\n      {\r\n        title: (\r\n          <span>\r\n            <HomeOutlined style={{ marginRight: 4 }} />\r\n            Home\r\n          </span>\r\n        ),\r\n        href: '/',\r\n      },\r\n    ];\r\n\r\n    return breadcrumbs;\r\n  }, [user, location.pathname]);\r\n\r\n  /**\r\n   * Convert filtered navigation config to Ant Design menu items\r\n   */\r\n  const getMenuItems = (): MenuProps['items'] => {\r\n    const iconMap: Record<string, React.ReactNode> = {\r\n      '/tenant/dashboard': <DashboardOutlined />,\r\n      '/tenant/customers': <TeamOutlined />,\r\n      '/tenant/sales': <ShoppingCartOutlined />,\r\n      '/tenant/product-sales': <ShoppingCartOutlined />,\r\n      '/tenant/contracts': <FileTextOutlined />,\r\n      '/tenant/service-contracts': <FileTextOutlined />,\r\n      '/tenant/tickets': <CustomerServiceOutlined />,\r\n      '/tenant/complaints': <CustomerServiceOutlined />,\r\n      '/tenant/job-works': <ToolOutlined />,\r\n      '/tenant/masters': <DatabaseOutlined />,\r\n      '/tenant/users': <UserOutlined />,\r\n      '/tenant/configuration': <SettingOutlined />,\r\n      '/tenant/notifications': <BellOutlined />,\r\n      '/tenant/logs': <FileTextOutlined />,\r\n      '/super-admin': <SafetyOutlined />,\r\n    };\r\n\r\n    const convertToMenuItems = (items: FilteredNavigationItem[]): MenuProps['items'] => {\r\n      return items.map((item) => {\r\n        // Section items become groups\r\n        if (item.isSection) {\r\n          return {\r\n            type: 'group',\r\n            key: item.key,\r\n            label: item.label,\r\n          };\r\n        }\r\n\r\n        // Items with children become submenus\r\n        if (item.filteredChildren && item.filteredChildren.length > 0) {\r\n          return {\r\n            key: item.key,\r\n            icon: iconMap[item.key] || <AppstoreOutlined />,\r\n            label: item.label,\r\n            children: convertToMenuItems(item.filteredChildren),\r\n          };\r\n        }\r\n\r\n        // Regular items\r\n        return {\r\n          key: item.key,\r\n          icon: iconMap[item.key] || <AppstoreOutlined />,\r\n          label: item.label,\r\n          onClick: () => navigate(item.key),\r\n        };\r\n      });\r\n    };\r\n\r\n    return convertToMenuItems(filteredNavItems);\r\n  };\r\n\r\n  // User dropdown menu\r\n  const userMenuItems: MenuProps['items'] = [\r\n    {\r\n      key: 'profile',\r\n      icon: <ProfileOutlined />,\r\n      label: 'My Profile',\r\n      onClick: () => navigate('/profile'),\r\n    },\r\n    {\r\n      key: 'settings',\r\n      icon: <SettingOutlined />,\r\n      label: 'Settings',\r\n      onClick: () => navigate('/settings'),\r\n    },\r\n    { type: 'divider' },\r\n    {\r\n      key: 'logout',\r\n      icon: <LogoutOutlined />,\r\n      label: 'Logout',\r\n      onClick: logout,\r\n      danger: true,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Layout style={{ minHeight: '100vh' }}>\r\n      {/* Sidebar */}\r\n      <Sider\r\n        trigger={null}\r\n        collapsible\r\n        collapsed={collapsed}\r\n        width={260}\r\n        style={{\r\n          overflow: 'auto',\r\n          height: '100vh',\r\n          position: 'fixed',\r\n          left: 0,\r\n          top: 0,\r\n          bottom: 0,\r\n          background: '#FFFFFF',\r\n          borderRight: '1px solid #E5E7EB',\r\n          boxShadow: '2px 0 8px rgba(0, 0, 0, 0.05)',\r\n        }}\r\n      >\r\n        {/* Logo */}\r\n        <div\r\n          style={{\r\n            height: 64,\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: collapsed ? 'center' : 'flex-start',\r\n            padding: collapsed ? '0' : '0 24px',\r\n            borderBottom: '1px solid #E5E7EB',\r\n            background: '#FFFFFF',\r\n          }}\r\n        >\r\n          {collapsed ? (\r\n            <AppstoreOutlined style={{ fontSize: 24, color: '#1B7CED' }} />\r\n          ) : (\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n              <AppstoreOutlined style={{ fontSize: 28, color: '#1B7CED' }} />\r\n              <span\r\n                style={{\r\n                  fontSize: 18,\r\n                  fontWeight: 700,\r\n                  color: '#111827',\r\n                  letterSpacing: '-0.02em',\r\n                }}\r\n              >\r\n                CRM Portal\r\n              </span>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Navigation Menu */}\r\n        <Menu\r\n          mode=\"inline\"\r\n          selectedKeys={[location.pathname]}\r\n          defaultOpenKeys={['/sales', '/contracts', '/users', '/configuration', '/super-admin']}\r\n          items={getMenuItems()}\r\n          style={{\r\n            border: 'none',\r\n            marginTop: 8,\r\n          }}\r\n        />\r\n      </Sider>\r\n\r\n      {/* Main Layout */}\r\n      <Layout style={{ marginLeft: collapsed ? 80 : 260, transition: 'margin-left 0.2s' }}>\r\n        {/* Header */}\r\n        <Header\r\n          style={{\r\n            padding: '0 24px',\r\n            background: '#FFFFFF',\r\n            borderBottom: '1px solid #E5E7EB',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            position: 'sticky',\r\n            top: 0,\r\n            zIndex: 999,\r\n            boxShadow: '0 1px 4px rgba(0, 0, 0, 0.05)',\r\n          }}\r\n        >\r\n          {/* Left Section */}\r\n          <Space size=\"middle\">\r\n            <Button\r\n              type=\"text\"\r\n              icon={collapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}\r\n              onClick={() => setCollapsed(!collapsed)}\r\n              style={{\r\n                fontSize: 18,\r\n                width: 40,\r\n                height: 40,\r\n              }}\r\n            />\r\n            <Divider type=\"vertical\" style={{ height: 32 }} />\r\n            <Breadcrumb items={breadcrumbItems} />\r\n          </Space>\r\n\r\n          {/* Right Section */}\r\n          <Space size=\"middle\">\r\n            {/* Notifications */}\r\n            <Badge count={5} size=\"small\">\r\n              <Button\r\n                type=\"text\"\r\n                icon={<BellOutlined style={{ fontSize: 18 }} />}\r\n                onClick={() => navigate('/notifications')}\r\n                style={{\r\n                  width: 40,\r\n                  height: 40,\r\n                }}\r\n              />\r\n            </Badge>\r\n\r\n            <Divider type=\"vertical\" style={{ height: 32 }} />\r\n\r\n            {/* User Profile */}\r\n            <Dropdown menu={{ items: userMenuItems }} placement=\"bottomRight\" arrow>\r\n              <Space style={{ cursor: 'pointer' }}>\r\n                <Avatar\r\n                  size={36}\r\n                  icon={<UserOutlined />}\r\n                  style={{ backgroundColor: '#1B7CED' }}\r\n                >\r\n                  {user?.name?.charAt(0).toUpperCase()}\r\n                </Avatar>\r\n                {!collapsed && (\r\n                  <div style={{ lineHeight: 1.3 }}>\r\n                    <div style={{ fontSize: 14, fontWeight: 500, color: '#111827' }}>\r\n                      {user?.name || 'User'}\r\n                    </div>\r\n                    <div style={{ fontSize: 12, color: '#6B7280' }}>\r\n                      {user?.role?.replace('_', ' ').toUpperCase() || 'User'}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </Space>\r\n            </Dropdown>\r\n          </Space>\r\n        </Header>\r\n\r\n        {/* Content */}\r\n        <Content\r\n          style={{\r\n            margin: 0,\r\n            padding: 0,\r\n            background: '#F9FAFB',\r\n            minHeight: 'calc(100vh - 64px)',\r\n          }}\r\n        >\r\n          {children}\r\n        </Content>\r\n      </Layout>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default EnterpriseLayout;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\layout\\RootLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\layout\\SuperAdminLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\masters\\CompanyFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\masters\\MasterDataSelect.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadInitialOptions'. Either include it or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadInitialOptions]","fix":{"range":[1767,1769],"text":"[loadInitialOptions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Check, ChevronsUpDown, Plus, Loader2 } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n} from '@/components/ui/command';\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from '@/components/ui/popover';\r\nimport { Badge } from '@/components/ui/badge';\r\n\r\ninterface MasterDataOption {\r\n  value: string;\r\n  label: string;\r\n  description?: string;\r\n  [key: string]: string | undefined;\r\n}\r\n\r\ninterface MasterDataSelectProps {\r\n  value?: string;\r\n  onValueChange: (value: string) => void;\r\n  placeholder?: string;\r\n  searchPlaceholder?: string;\r\n  emptyMessage?: string;\r\n  loadOptions: (search?: string) => Promise<MasterDataOption[]>;\r\n  onAddNew?: () => void;\r\n  addNewLabel?: string;\r\n  disabled?: boolean;\r\n  className?: string;\r\n  showDescription?: boolean;\r\n  allowClear?: boolean;\r\n}\r\n\r\nconst MasterDataSelect: React.FC<MasterDataSelectProps> = ({\r\n  value,\r\n  onValueChange,\r\n  placeholder = 'Select option...',\r\n  searchPlaceholder = 'Search...',\r\n  emptyMessage = 'No options found.',\r\n  loadOptions,\r\n  onAddNew,\r\n  addNewLabel = 'Add New',\r\n  disabled = false,\r\n  className,\r\n  showDescription = false,\r\n  allowClear = true\r\n}) => {\r\n  const [open, setOpen] = useState(false);\r\n  const [options, setOptions] = useState<MasterDataOption[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchValue, setSearchValue] = useState('');\r\n  const [selectedOption, setSelectedOption] = useState<MasterDataOption | null>(null);\r\n\r\n  // Load initial options\r\n  useEffect(() => {\r\n    loadInitialOptions();\r\n  }, []);\r\n\r\n  // Update selected option when value changes\r\n  useEffect(() => {\r\n    if (value && options.length > 0) {\r\n      const option = options.find(opt => opt.value === value);\r\n      setSelectedOption(option || null);\r\n    } else {\r\n      setSelectedOption(null);\r\n    }\r\n  }, [value, options]);\r\n\r\n  const loadInitialOptions = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const data = await loadOptions();\r\n      setOptions(data);\r\n    } catch (error) {\r\n      console.error('Failed to load options:', error);\r\n      setOptions([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSearch = async (search: string) => {\r\n    setSearchValue(search);\r\n    if (search.length === 0) {\r\n      loadInitialOptions();\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const data = await loadOptions(search);\r\n      setOptions(data);\r\n    } catch (error) {\r\n      console.error('Failed to search options:', error);\r\n      setOptions([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSelect = (selectedValue: string) => {\r\n    if (selectedValue === value) {\r\n      if (allowClear) {\r\n        onValueChange('');\r\n        setSelectedOption(null);\r\n      }\r\n    } else {\r\n      onValueChange(selectedValue);\r\n      const option = options.find(opt => opt.value === selectedValue);\r\n      setSelectedOption(option || null);\r\n    }\r\n    setOpen(false);\r\n  };\r\n\r\n  const handleAddNew = () => {\r\n    if (onAddNew) {\r\n      onAddNew();\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const handleClear = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    onValueChange('');\r\n    setSelectedOption(null);\r\n  };\r\n\r\n  return (\r\n    <Popover open={open} onOpenChange={setOpen}>\r\n      <PopoverTrigger asChild>\r\n        <Button\r\n          variant=\"outline\"\r\n          role=\"combobox\"\r\n          aria-expanded={open}\r\n          className={cn(\r\n            'w-full justify-between',\r\n            !selectedOption && 'text-muted-foreground',\r\n            className\r\n          )}\r\n          disabled={disabled}\r\n        >\r\n          <div className=\"flex items-center gap-2 flex-1 min-w-0\">\r\n            {selectedOption ? (\r\n              <>\r\n                <span className=\"truncate\">{selectedOption.label}</span>\r\n                {showDescription && selectedOption.description && (\r\n                  <Badge variant=\"secondary\" className=\"text-xs\">\r\n                    {selectedOption.description}\r\n                  </Badge>\r\n                )}\r\n              </>\r\n            ) : (\r\n              placeholder\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-1\">\r\n            {selectedOption && allowClear && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"h-4 w-4 p-0 hover:bg-destructive hover:text-destructive-foreground\"\r\n                onClick={handleClear}\r\n              >\r\n                √ó\r\n              </Button>\r\n            )}\r\n            <ChevronsUpDown className=\"h-4 w-4 shrink-0 opacity-50\" />\r\n          </div>\r\n        </Button>\r\n      </PopoverTrigger>\r\n      <PopoverContent className=\"w-full p-0\" align=\"start\">\r\n        <Command>\r\n          <CommandInput\r\n            placeholder={searchPlaceholder}\r\n            value={searchValue}\r\n            onValueChange={handleSearch}\r\n          />\r\n          <CommandList>\r\n            {loading ? (\r\n              <div className=\"flex items-center justify-center py-6\">\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                <span className=\"ml-2 text-sm text-muted-foreground\">Loading...</span>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <CommandEmpty>{emptyMessage}</CommandEmpty>\r\n                <CommandGroup>\r\n                  {options.map((option) => (\r\n                    <CommandItem\r\n                      key={option.value}\r\n                      value={option.value}\r\n                      onSelect={handleSelect}\r\n                      className=\"flex items-center justify-between\"\r\n                    >\r\n                      <div className=\"flex items-center gap-2 flex-1 min-w-0\">\r\n                        <Check\r\n                          className={cn(\r\n                            'h-4 w-4',\r\n                            value === option.value ? 'opacity-100' : 'opacity-0'\r\n                          )}\r\n                        />\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"truncate\">{option.label}</div>\r\n                          {showDescription && option.description && (\r\n                            <div className=\"text-xs text-muted-foreground truncate\">\r\n                              {option.description}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </CommandItem>\r\n                  ))}\r\n                </CommandGroup>\r\n                {onAddNew && (\r\n                  <>\r\n                    <div className=\"border-t\" />\r\n                    <CommandGroup>\r\n                      <CommandItem onSelect={handleAddNew} className=\"text-primary\">\r\n                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                        {addNewLabel}\r\n                      </CommandItem>\r\n                    </CommandGroup>\r\n                  </>\r\n                )}\r\n              </>\r\n            )}\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default MasterDataSelect;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\masters\\ProductFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\notifications\\NotificationDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\notifications\\NotificationQueue.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadQueueItems'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [filterStatus, filterChannel, loadQueueItems]","fix":{"range":[1960,1989],"text":"[filterStatus, filterChannel, loadQueueItems]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { \r\n  Clock, \r\n  CheckCircle, \r\n  XCircle, \r\n  AlertCircle, \r\n  Play, \r\n  Pause, \r\n  RotateCcw,\r\n  Send,\r\n  Search,\r\n  Filter,\r\n  Eye,\r\n  MessageSquare,\r\n  Smartphone,\r\n  Calendar\r\n} from 'lucide-react';\r\nimport { notificationService } from '@/services';\r\nimport { NotificationQueue as NotificationQueueType, NotificationTemplate } from '@/types/notifications';\r\n\r\ninterface NotificationQueueProps {\r\n  className?: string;\r\n}\r\n\r\nexport function NotificationQueue({ className }: NotificationQueueProps) {\r\n  const [queueItems, setQueueItems] = useState<NotificationQueueType[]>([]);\r\n  const [templates, setTemplates] = useState<NotificationTemplate[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterStatus, setFilterStatus] = useState<string>('all');\r\n  const [filterChannel, setFilterChannel] = useState<string>('all');\r\n  const [selectedItem, setSelectedItem] = useState<NotificationQueueType | null>(null);\r\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\r\n  const [isDetailDialogOpen, setIsDetailDialogOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadQueueItems();\r\n    \r\n    // Refresh every 10 seconds\r\n    const interval = setInterval(loadQueueItems, 10000);\r\n    return () => clearInterval(interval);\r\n  }, [filterStatus, filterChannel]);\r\n\r\n  const loadQueueItems = async () => {\r\n    try {\r\n      const items = await notificationService.getNotificationQueue();\r\n      const filtered = items.filter(item => (filterStatus === 'all' || item.status === filterStatus) && (filterChannel === 'all' || item.channel === filterChannel));\r\n      filtered.sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\r\n      setQueueItems(filtered);\r\n    } catch (error) {\r\n      console.error('Failed to load queue items:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCreateNotification = async (data: { templateId: string; recipientId: string; channel: string; variables: string; priority: string; scheduledAt?: string }) => {\r\n    try {\r\n      await notificationService.queueNotification({\r\n        templateId: data.templateId,\r\n        recipientId: data.recipientId,\r\n        channel: data.channel,\r\n        variables: JSON.parse(data.variables || '{}'),\r\n        priority: data.priority,\r\n        scheduledAt: data.scheduledAt || undefined\r\n      });\r\n      \r\n      await loadQueueItems();\r\n      setIsCreateDialogOpen(false);\r\n    } catch (error) {\r\n      console.error('Failed to create notification:', error);\r\n    }\r\n  };\r\n\r\n  const handleRetryNotification = async (queueId: string) => {\r\n    try {\r\n      await notificationService.retryQueueItem(queueId);\r\n      await loadQueueItems();\r\n    } catch (error) {\r\n      console.error('Failed to retry notification:', error);\r\n    }\r\n  };\r\n\r\n  const handleCancelNotification = async (queueId: string) => {\r\n    try {\r\n      await notificationService.cancelQueueItem(queueId);\r\n      await loadQueueItems();\r\n    } catch (error) {\r\n      console.error('Failed to cancel notification:', error);\r\n    }\r\n  };\r\n\r\n  const handleProcessQueue = async () => {\r\n    try {\r\n      await notificationService.processQueue();\r\n      await loadQueueItems();\r\n    } catch (error) {\r\n      console.error('Failed to process queue:', error);\r\n    }\r\n  };\r\n\r\n  const filteredItems = queueItems.filter(item => {\r\n    const matchesSearch = item.recipient_id.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                         item.template_id.toLowerCase().includes(searchTerm.toLowerCase());\r\n    return matchesSearch;\r\n  });\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'pending':\r\n        return <Badge variant=\"outline\" className=\"border-yellow-500 text-yellow-600\"><Clock className=\"h-3 w-3 mr-1\" />Pending</Badge>;\r\n      case 'processing':\r\n        return <Badge variant=\"outline\" className=\"border-blue-500 text-blue-600\"><Play className=\"h-3 w-3 mr-1\" />Processing</Badge>;\r\n      case 'sent':\r\n        return <Badge variant=\"default\" className=\"bg-green-600\"><CheckCircle className=\"h-3 w-3 mr-1\" />Sent</Badge>;\r\n      case 'delivered':\r\n        return <Badge variant=\"default\" className=\"bg-green-700\"><CheckCircle className=\"h-3 w-3 mr-1\" />Delivered</Badge>;\r\n      case 'failed':\r\n        return <Badge variant=\"destructive\"><XCircle className=\"h-3 w-3 mr-1\" />Failed</Badge>;\r\n      case 'cancelled':\r\n        return <Badge variant=\"secondary\"><Pause className=\"h-3 w-3 mr-1\" />Cancelled</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n  const getPriorityBadge = (priority: string) => {\r\n    switch (priority) {\r\n      case 'urgent':\r\n        return <Badge variant=\"destructive\">Urgent</Badge>;\r\n      case 'high':\r\n        return <Badge variant=\"default\" className=\"bg-orange-600\">High</Badge>;\r\n      case 'normal':\r\n        return <Badge variant=\"outline\">Normal</Badge>;\r\n      case 'low':\r\n        return <Badge variant=\"secondary\">Low</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{priority}</Badge>;\r\n    }\r\n  };\r\n\r\n  const getChannelIcon = (channel: string) => {\r\n    switch (channel) {\r\n      case 'whatsapp':\r\n        return <MessageSquare className=\"h-4 w-4 text-green-600\" />;\r\n      case 'push':\r\n        return <Smartphone className=\"h-4 w-4 text-blue-600\" />;\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`space-y-6 ${className}`}>\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight\">Notification Queue</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Monitor and manage queued notifications\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Button onClick={handleProcessQueue} variant=\"outline\">\r\n            <Send className=\"h-4 w-4 mr-2\" />\r\n            Process Queue\r\n          </Button>\r\n          <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\r\n            <DialogTrigger asChild>\r\n              <Button>\r\n                <Send className=\"h-4 w-4 mr-2\" />\r\n                Send Notification\r\n              </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"max-w-2xl\">\r\n              <DialogHeader>\r\n                <DialogTitle>Send New Notification</DialogTitle>\r\n                <DialogDescription>\r\n                  Queue a new notification to be sent\r\n                </DialogDescription>\r\n              </DialogHeader>\r\n              <CreateNotificationForm \r\n                templates={templates}\r\n                onSubmit={handleCreateNotification}\r\n              />\r\n            </DialogContent>\r\n          </Dialog>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"flex flex-col sm:flex-row gap-4\">\r\n        <div className=\"flex-1\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n            <Input\r\n              placeholder=\"Search by recipient or template...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"pl-10\"\r\n            />\r\n          </div>\r\n        </div>\r\n        <Select value={filterStatus} onValueChange={setFilterStatus}>\r\n          <SelectTrigger className=\"w-[180px]\">\r\n            <SelectValue placeholder=\"Filter by status\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">All Status</SelectItem>\r\n            <SelectItem value=\"pending\">Pending</SelectItem>\r\n            <SelectItem value=\"processing\">Processing</SelectItem>\r\n            <SelectItem value=\"sent\">Sent</SelectItem>\r\n            <SelectItem value=\"delivered\">Delivered</SelectItem>\r\n            <SelectItem value=\"failed\">Failed</SelectItem>\r\n            <SelectItem value=\"cancelled\">Cancelled</SelectItem>\r\n          </SelectContent>\r\n        </Select>\r\n        <Select value={filterChannel} onValueChange={setFilterChannel}>\r\n          <SelectTrigger className=\"w-[180px]\">\r\n            <SelectValue placeholder=\"Filter by channel\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">All Channels</SelectItem>\r\n            <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\r\n            <SelectItem value=\"push\">Push</SelectItem>\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      {/* Queue Items */}\r\n      {loading ? (\r\n        <div className=\"space-y-4\">\r\n          {[...Array(5)].map((_, i) => (\r\n            <Card key={i} className=\"animate-pulse\">\r\n              <CardContent className=\"p-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"space-y-2 flex-1\">\r\n                    <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\r\n                    <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\r\n                  </div>\r\n                  <div className=\"h-6 bg-gray-200 rounded w-20\"></div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {filteredItems.map((item) => (\r\n            <Card key={item.id} className=\"hover:shadow-md transition-shadow\">\r\n              <CardContent className=\"p-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex-1 space-y-2\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      {getChannelIcon(item.channel)}\r\n                      <span className=\"font-medium\">Recipient: {item.recipient_id}</span>\r\n                      <span className=\"text-muted-foreground\">‚Ä¢</span>\r\n                      <span className=\"text-sm text-muted-foreground\">Template: {item.template_id}</span>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\r\n                      <span>Created: {new Date(item.created_at).toLocaleString()}</span>\r\n                      {item.scheduled_at && (\r\n                        <>\r\n                          <span>‚Ä¢</span>\r\n                          <span>Scheduled: {new Date(item.scheduled_at).toLocaleString()}</span>\r\n                        </>\r\n                      )}\r\n                      {item.retry_count > 0 && (\r\n                        <>\r\n                          <span>‚Ä¢</span>\r\n                          <span>Retries: {item.retry_count}/{item.max_retries}</span>\r\n                        </>\r\n                      )}\r\n                    </div>\r\n\r\n                    {item.error_message && (\r\n                      <div className=\"text-sm text-red-600 bg-red-50 p-2 rounded\">\r\n                        Error: {item.error_message}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {getPriorityBadge(item.priority)}\r\n                    {getStatusBadge(item.status)}\r\n                    \r\n                    <div className=\"flex gap-1\">\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"outline\"\r\n                        onClick={() => {\r\n                          setSelectedItem(item);\r\n                          setIsDetailDialogOpen(true);\r\n                        }}\r\n                      >\r\n                        <Eye className=\"h-3 w-3\" />\r\n                      </Button>\r\n                      \r\n                      {item.status === 'failed' && (\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          onClick={() => handleRetryNotification(item.id)}\r\n                        >\r\n                          <RotateCcw className=\"h-3 w-3\" />\r\n                        </Button>\r\n                      )}\r\n                      \r\n                      {['pending', 'processing'].includes(item.status) && (\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          onClick={() => handleCancelNotification(item.id)}\r\n                          className=\"text-red-600 hover:text-red-700\"\r\n                        >\r\n                          <Pause className=\"h-3 w-3\" />\r\n                        </Button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {filteredItems.length === 0 && !loading && (\r\n        <Card>\r\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\r\n            <Clock className=\"h-12 w-12 text-muted-foreground mb-4\" />\r\n            <h3 className=\"text-lg font-semibold mb-2\">No notifications in queue</h3>\r\n            <p className=\"text-muted-foreground text-center mb-4\">\r\n              {searchTerm || filterStatus !== 'all' || filterChannel !== 'all'\r\n                ? 'No notifications match your current filters.'\r\n                : 'The notification queue is empty.'}\r\n            </p>\r\n            <Button onClick={() => setIsCreateDialogOpen(true)}>\r\n              <Send className=\"h-4 w-4 mr-2\" />\r\n              Send Notification\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Detail Dialog */}\r\n      <Dialog open={isDetailDialogOpen} onOpenChange={setIsDetailDialogOpen}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Notification Details</DialogTitle>\r\n            <DialogDescription>\r\n              View detailed information about this notification\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {selectedItem && (\r\n            <NotificationDetail item={selectedItem} />\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Create Notification Form Component\r\nfunction CreateNotificationForm({ \r\n  templates, \r\n  onSubmit \r\n}: { \r\n  templates: NotificationTemplate[];\r\n  onSubmit: (data: { templateId: string; recipientId: string; channel: string; variables: string; priority: string; scheduledAt?: string }) => void;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    templateId: '',\r\n    recipientId: '',\r\n    channel: 'both',\r\n    priority: 'normal',\r\n    variables: '{}',\r\n    scheduledAt: ''\r\n  });\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    onSubmit(formData);\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label htmlFor=\"templateId\">Template</Label>\r\n          <Select value={formData.templateId} onValueChange={(value) => setFormData({ ...formData, templateId: value })}>\r\n            <SelectTrigger>\r\n              <SelectValue placeholder=\"Select template\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {templates.map((template) => (\r\n                <SelectItem key={template.id} value={template.id}>\r\n                  {template.name}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          <Label htmlFor=\"recipientId\">Recipient ID</Label>\r\n          <Input\r\n            id=\"recipientId\"\r\n            value={formData.recipientId}\r\n            onChange={(e) => setFormData({ ...formData, recipientId: e.target.value })}\r\n            placeholder=\"User ID or email\"\r\n            required\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label htmlFor=\"channel\">Channel</Label>\r\n          <Select value={formData.channel} onValueChange={(value) => setFormData({ ...formData, channel: value })}>\r\n            <SelectTrigger>\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\r\n              <SelectItem value=\"push\">Push Notification</SelectItem>\r\n              <SelectItem value=\"both\">Both</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          <Label htmlFor=\"priority\">Priority</Label>\r\n          <Select value={formData.priority} onValueChange={(value) => setFormData({ ...formData, priority: value })}>\r\n            <SelectTrigger>\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"low\">Low</SelectItem>\r\n              <SelectItem value=\"normal\">Normal</SelectItem>\r\n              <SelectItem value=\"high\">High</SelectItem>\r\n              <SelectItem value=\"urgent\">Urgent</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <Label htmlFor=\"variables\">Template Variables (JSON)</Label>\r\n        <Textarea\r\n          id=\"variables\"\r\n          value={formData.variables}\r\n          onChange={(e) => setFormData({ ...formData, variables: e.target.value })}\r\n          placeholder='{\"customerName\": \"John Doe\", \"amount\": \"100\"}'\r\n          rows={3}\r\n        />\r\n      </div>\r\n\r\n      <div>\r\n        <Label htmlFor=\"scheduledAt\">Schedule For (Optional)</Label>\r\n        <Input\r\n          id=\"scheduledAt\"\r\n          type=\"datetime-local\"\r\n          value={formData.scheduledAt}\r\n          onChange={(e) => setFormData({ ...formData, scheduledAt: e.target.value })}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex justify-end gap-2 pt-4\">\r\n        <Button type=\"submit\">\r\n          Send Notification\r\n        </Button>\r\n      </div>\r\n    </form>\r\n  );\r\n}\r\n\r\n// Notification Detail Component\r\nfunction NotificationDetail({ item }: { item: NotificationQueueType }) {\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Status</Label>\r\n          <div className=\"mt-1\">\r\n            {item.status === 'pending' && <Badge variant=\"outline\" className=\"border-yellow-500 text-yellow-600\">Pending</Badge>}\r\n            {item.status === 'processing' && <Badge variant=\"outline\" className=\"border-blue-500 text-blue-600\">Processing</Badge>}\r\n            {item.status === 'sent' && <Badge variant=\"default\" className=\"bg-green-600\">Sent</Badge>}\r\n            {item.status === 'delivered' && <Badge variant=\"default\" className=\"bg-green-700\">Delivered</Badge>}\r\n            {item.status === 'failed' && <Badge variant=\"destructive\">Failed</Badge>}\r\n            {item.status === 'cancelled' && <Badge variant=\"secondary\">Cancelled</Badge>}\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Channel</Label>\r\n          <div className=\"mt-1 flex items-center gap-2\">\r\n            {item.channel === 'whatsapp' && <MessageSquare className=\"h-4 w-4 text-green-600\" />}\r\n            {item.channel === 'push' && <Smartphone className=\"h-4 w-4 text-blue-600\" />}\r\n            <span className=\"capitalize\">{item.channel}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Priority</Label>\r\n          <div className=\"mt-1\">\r\n            {item.priority === 'urgent' && <Badge variant=\"destructive\">Urgent</Badge>}\r\n            {item.priority === 'high' && <Badge variant=\"default\" className=\"bg-orange-600\">High</Badge>}\r\n            {item.priority === 'normal' && <Badge variant=\"outline\">Normal</Badge>}\r\n            {item.priority === 'low' && <Badge variant=\"secondary\">Low</Badge>}\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Retry Count</Label>\r\n          <div className=\"mt-1\">\r\n            <span>{item.retry_count} / {item.max_retries}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <Label className=\"text-sm font-medium\">Recipient ID</Label>\r\n        <div className=\"mt-1 font-mono text-sm bg-gray-100 p-2 rounded\">\r\n          {item.recipient_id}\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <Label className=\"text-sm font-medium\">Template ID</Label>\r\n        <div className=\"mt-1 font-mono text-sm bg-gray-100 p-2 rounded\">\r\n          {item.template_id}\r\n        </div>\r\n      </div>\r\n\r\n      {item.external_id && (\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">External ID</Label>\r\n          <div className=\"mt-1 font-mono text-sm bg-gray-100 p-2 rounded\">\r\n            {item.external_id}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div>\r\n        <Label className=\"text-sm font-medium\">Template Variables</Label>\r\n        <div className=\"mt-1 font-mono text-sm bg-gray-100 p-2 rounded max-h-32 overflow-auto\">\r\n          {JSON.stringify(item.template_variables, null, 2)}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Created At</Label>\r\n          <div className=\"mt-1 text-sm\">\r\n            {new Date(item.created_at).toLocaleString()}\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Updated At</Label>\r\n          <div className=\"mt-1 text-sm\">\r\n            {new Date(item.updated_at).toLocaleString()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {item.scheduled_at && (\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Scheduled At</Label>\r\n          <div className=\"mt-1 text-sm\">\r\n            {new Date(item.scheduled_at).toLocaleString()}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {item.sent_at && (\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Sent At</Label>\r\n          <div className=\"mt-1 text-sm\">\r\n            {new Date(item.sent_at).toLocaleString()}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {item.delivered_at && (\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Delivered At</Label>\r\n          <div className=\"mt-1 text-sm\">\r\n            {new Date(item.delivered_at).toLocaleString()}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {item.failed_at && (\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Failed At</Label>\r\n          <div className=\"mt-1 text-sm\">\r\n            {new Date(item.failed_at).toLocaleString()}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {item.error_message && (\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Error Message</Label>\r\n          <div className=\"mt-1 text-sm text-red-600 bg-red-50 p-2 rounded\">\r\n            {item.error_message}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\notifications\\TemplateManager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTemplates'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [filterChannel, filterStatus, loadTemplates]","fix":{"range":[1811,1840],"text":"[filterChannel, filterStatus, loadTemplates]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPreview'. Either include it or remove the dependency array.","line":503,"column":6,"nodeType":"ArrayExpression","endLine":503,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [template, sampleVariables, loadPreview]","fix":{"range":[18840,18867],"text":"[template, sampleVariables, loadPreview]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { \r\n  Plus, \r\n  Edit, \r\n  Trash2, \r\n  Copy, \r\n  Eye, \r\n  MessageSquare, \r\n  Smartphone, \r\n  Search,\r\n  Filter,\r\n  MoreHorizontal\r\n} from 'lucide-react';\r\nimport { templateService } from '@/services/templateService';\r\nimport { NotificationTemplate } from '@/types/notifications';\r\n\r\ninterface TemplateManagerProps {\r\n  className?: string;\r\n}\r\n\r\nexport function TemplateManager({ className }: TemplateManagerProps) {\r\n  const [templates, setTemplates] = useState<NotificationTemplate[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterChannel, setFilterChannel] = useState<string>('all');\r\n  const [filterStatus, setFilterStatus] = useState<string>('all');\r\n  const [selectedTemplate, setSelectedTemplate] = useState<NotificationTemplate | null>(null);\r\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\r\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\r\n  const [isPreviewDialogOpen, setIsPreviewDialogOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadTemplates();\r\n  }, [filterChannel, filterStatus]);\r\n\r\n  const loadTemplates = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const filters: Record<string, string> = {};\r\n      \r\n      if (filterChannel !== 'all') {\r\n        filters.channel = filterChannel;\r\n      }\r\n      if (filterStatus !== 'all') {\r\n        filters.status = filterStatus;\r\n      }\r\n\r\n      const result = await templateService.listTemplates(filters);\r\n      setTemplates(result.templates);\r\n    } catch (error) {\r\n      console.error('Failed to load templates:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCreateTemplate = async (templateData: Partial<NotificationTemplate>) => {\r\n    try {\r\n      await templateService.createTemplate(templateData);\r\n      await loadTemplates();\r\n      setIsCreateDialogOpen(false);\r\n    } catch (error) {\r\n      console.error('Failed to create template:', error);\r\n    }\r\n  };\r\n\r\n  const handleUpdateTemplate = async (templateId: string, updates: Partial<NotificationTemplate>) => {\r\n    try {\r\n      await templateService.updateTemplate(templateId, updates);\r\n      await loadTemplates();\r\n      setIsEditDialogOpen(false);\r\n      setSelectedTemplate(null);\r\n    } catch (error) {\r\n      console.error('Failed to update template:', error);\r\n    }\r\n  };\r\n\r\n  const handleDeleteTemplate = async (templateId: string) => {\r\n    if (!confirm('Are you sure you want to delete this template?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await templateService.deleteTemplate(templateId);\r\n      await loadTemplates();\r\n    } catch (error) {\r\n      console.error('Failed to delete template:', error);\r\n    }\r\n  };\r\n\r\n  const handleDuplicateTemplate = async (template: NotificationTemplate) => {\r\n    try {\r\n      const newName = `${template.name} (Copy)`;\r\n      await templateService.duplicateTemplate(template.id, newName);\r\n      await loadTemplates();\r\n    } catch (error) {\r\n      console.error('Failed to duplicate template:', error);\r\n    }\r\n  };\r\n\r\n  const filteredTemplates = templates.filter(template => {\r\n    const matchesSearch = template.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                         template.message_body.toLowerCase().includes(searchTerm.toLowerCase());\r\n    return matchesSearch;\r\n  });\r\n\r\n  const getChannelIcon = (channel: string) => {\r\n    switch (channel) {\r\n      case 'whatsapp':\r\n        return <MessageSquare className=\"h-4 w-4 text-green-600\" />;\r\n      case 'push':\r\n        return <Smartphone className=\"h-4 w-4 text-blue-600\" />;\r\n      case 'both':\r\n        return (\r\n          <div className=\"flex gap-1\">\r\n            <MessageSquare className=\"h-3 w-3 text-green-600\" />\r\n            <Smartphone className=\"h-3 w-3 text-blue-600\" />\r\n          </div>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'active':\r\n        return <Badge variant=\"default\" className=\"bg-green-600\">Active</Badge>;\r\n      case 'inactive':\r\n        return <Badge variant=\"secondary\">Inactive</Badge>;\r\n      case 'draft':\r\n        return <Badge variant=\"outline\">Draft</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`space-y-6 ${className}`}>\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight\">Template Manager</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Create and manage notification templates\r\n          </p>\r\n        </div>\r\n        <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\r\n          <DialogTrigger asChild>\r\n            <Button>\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Create Template\r\n            </Button>\r\n          </DialogTrigger>\r\n          <DialogContent className=\"max-w-2xl\">\r\n            <DialogHeader>\r\n              <DialogTitle>Create New Template</DialogTitle>\r\n              <DialogDescription>\r\n                Create a new notification template for WhatsApp or Push notifications\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <TemplateForm onSubmit={handleCreateTemplate} />\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"flex flex-col sm:flex-row gap-4\">\r\n        <div className=\"flex-1\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n            <Input\r\n              placeholder=\"Search templates...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"pl-10\"\r\n            />\r\n          </div>\r\n        </div>\r\n        <Select value={filterChannel} onValueChange={setFilterChannel}>\r\n          <SelectTrigger className=\"w-[180px]\">\r\n            <SelectValue placeholder=\"Filter by channel\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">All Channels</SelectItem>\r\n            <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\r\n            <SelectItem value=\"push\">Push</SelectItem>\r\n            <SelectItem value=\"both\">Both</SelectItem>\r\n          </SelectContent>\r\n        </Select>\r\n        <Select value={filterStatus} onValueChange={setFilterStatus}>\r\n          <SelectTrigger className=\"w-[180px]\">\r\n            <SelectValue placeholder=\"Filter by status\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">All Status</SelectItem>\r\n            <SelectItem value=\"active\">Active</SelectItem>\r\n            <SelectItem value=\"inactive\">Inactive</SelectItem>\r\n            <SelectItem value=\"draft\">Draft</SelectItem>\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      {/* Templates Grid */}\r\n      {loading ? (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {[...Array(6)].map((_, i) => (\r\n            <Card key={i} className=\"animate-pulse\">\r\n              <CardHeader>\r\n                <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\r\n                <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"h-3 bg-gray-200 rounded\"></div>\r\n                  <div className=\"h-3 bg-gray-200 rounded w-5/6\"></div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {filteredTemplates.map((template) => (\r\n            <Card key={template.id} className=\"hover:shadow-md transition-shadow\">\r\n              <CardHeader className=\"pb-3\">\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex-1\">\r\n                    <CardTitle className=\"text-lg\">{template.name}</CardTitle>\r\n                    <CardDescription className=\"flex items-center gap-2 mt-1\">\r\n                      {getChannelIcon(template.channel)}\r\n                      <span className=\"capitalize\">{template.channel}</span>\r\n                      <span>‚Ä¢</span>\r\n                      <span>v{template.f_version}</span>\r\n                    </CardDescription>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-1\">\r\n                    {getStatusBadge(template.status)}\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"pt-0\">\r\n                <div className=\"space-y-3\">\r\n                  <p className=\"text-sm text-muted-foreground line-clamp-2\">\r\n                    {template.message_body}\r\n                  </p>\r\n                  \r\n                  {template.variables && template.variables.length > 0 && (\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {template.variables.slice(0, 3).map((variable) => (\r\n                        <Badge key={variable} variant=\"outline\" className=\"text-xs\">\r\n                          {variable}\r\n                        </Badge>\r\n                      ))}\r\n                      {template.variables.length > 3 && (\r\n                        <Badge variant=\"outline\" className=\"text-xs\">\r\n                          +{template.variables.length - 3} more\r\n                        </Badge>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"flex items-center justify-between pt-2\">\r\n                    <div className=\"flex gap-1\">\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"outline\"\r\n                        onClick={() => {\r\n                          setSelectedTemplate(template);\r\n                          setIsPreviewDialogOpen(true);\r\n                        }}\r\n                      >\r\n                        <Eye className=\"h-3 w-3\" />\r\n                      </Button>\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"outline\"\r\n                        onClick={() => {\r\n                          setSelectedTemplate(template);\r\n                          setIsEditDialogOpen(true);\r\n                        }}\r\n                      >\r\n                        <Edit className=\"h-3 w-3\" />\r\n                      </Button>\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"outline\"\r\n                        onClick={() => handleDuplicateTemplate(template)}\r\n                      >\r\n                        <Copy className=\"h-3 w-3\" />\r\n                      </Button>\r\n                    </div>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={() => handleDeleteTemplate(template.id)}\r\n                      className=\"text-red-600 hover:text-red-700\"\r\n                    >\r\n                      <Trash2 className=\"h-3 w-3\" />\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {filteredTemplates.length === 0 && !loading && (\r\n        <Card>\r\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\r\n            <MessageSquare className=\"h-12 w-12 text-muted-foreground mb-4\" />\r\n            <h3 className=\"text-lg font-semibold mb-2\">No templates found</h3>\r\n            <p className=\"text-muted-foreground text-center mb-4\">\r\n              {searchTerm || filterChannel !== 'all' || filterStatus !== 'all'\r\n                ? 'No templates match your current filters.'\r\n                : 'Get started by creating your first notification template.'}\r\n            </p>\r\n            <Button onClick={() => setIsCreateDialogOpen(true)}>\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Create Template\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Edit Dialog */}\r\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Edit Template</DialogTitle>\r\n            <DialogDescription>\r\n              Update the template details and content\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {selectedTemplate && (\r\n            <TemplateForm\r\n              template={selectedTemplate}\r\n              onSubmit={(data) => handleUpdateTemplate(selectedTemplate.id, data)}\r\n            />\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Preview Dialog */}\r\n      <Dialog open={isPreviewDialogOpen} onOpenChange={setIsPreviewDialogOpen}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Template Preview</DialogTitle>\r\n            <DialogDescription>\r\n              Preview how this template will appear to recipients\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {selectedTemplate && (\r\n            <TemplatePreview template={selectedTemplate} />\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Template Form Component\r\nfunction TemplateForm({ \r\n  template, \r\n  onSubmit \r\n}: { \r\n  template?: NotificationTemplate; \r\n  onSubmit: (data: Partial<NotificationTemplate>) => void;\r\n}) {\r\n  const [formData, setFormData] = useState({\r\n    name: template?.name || '',\r\n    channel: template?.channel || 'both',\r\n    language: template?.language || 'en',\r\n    title: template?.title || '',\r\n    message_body: template?.message_body || '',\r\n    whatsapp_template_id: template?.whatsapp_template_id || '',\r\n    status: template?.status || 'draft'\r\n  });\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    onSubmit(formData);\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label htmlFor=\"name\">Template Name</Label>\r\n          <Input\r\n            id=\"name\"\r\n            value={formData.name}\r\n            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n            required\r\n          />\r\n        </div>\r\n        <div>\r\n          <Label htmlFor=\"channel\">Channel</Label>\r\n          <Select value={formData.channel} onValueChange={(value) => setFormData({ ...formData, channel: value })}>\r\n            <SelectTrigger>\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\r\n              <SelectItem value=\"push\">Push Notification</SelectItem>\r\n              <SelectItem value=\"both\">Both</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label htmlFor=\"language\">Language</Label>\r\n          <Input\r\n            id=\"language\"\r\n            value={formData.language}\r\n            onChange={(e) => setFormData({ ...formData, language: e.target.value })}\r\n            placeholder=\"en\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <Label htmlFor=\"status\">Status</Label>\r\n          <Select value={formData.status} onValueChange={(value) => setFormData({ ...formData, status: value })}>\r\n            <SelectTrigger>\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"draft\">Draft</SelectItem>\r\n              <SelectItem value=\"active\">Active</SelectItem>\r\n              <SelectItem value=\"inactive\">Inactive</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <Label htmlFor=\"title\">Title (for Push Notifications)</Label>\r\n        <Input\r\n          id=\"title\"\r\n          value={formData.title}\r\n          onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n          placeholder=\"Notification title\"\r\n        />\r\n      </div>\r\n\r\n      <div>\r\n        <Label htmlFor=\"message_body\">Message Body</Label>\r\n        <Textarea\r\n          id=\"message_body\"\r\n          value={formData.message_body}\r\n          onChange={(e) => setFormData({ ...formData, message_body: e.target.value })}\r\n          placeholder=\"Your message here. Use {{variable}} for dynamic content.\"\r\n          rows={4}\r\n          required\r\n        />\r\n        <p className=\"text-xs text-muted-foreground mt-1\">\r\n          Use double curly braces for variables: {{customerName}}, {{amount}}, etc.\r\n        </p>\r\n      </div>\r\n\r\n      {(formData.channel === 'whatsapp' || formData.channel === 'both') && (\r\n        <div>\r\n          <Label htmlFor=\"whatsapp_template_id\">WhatsApp Template ID</Label>\r\n          <Input\r\n            id=\"whatsapp_template_id\"\r\n            value={formData.whatsapp_template_id}\r\n            onChange={(e) => setFormData({ ...formData, whatsapp_template_id: e.target.value })}\r\n            placeholder=\"hello_world\"\r\n          />\r\n          <p className=\"text-xs text-muted-foreground mt-1\">\r\n            The approved template ID from WhatsApp Business Manager\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex justify-end gap-2 pt-4\">\r\n        <Button type=\"submit\">\r\n          {template ? 'Update Template' : 'Create Template'}\r\n        </Button>\r\n      </div>\r\n    </form>\r\n  );\r\n}\r\n\r\n// Template Preview Component\r\nfunction TemplatePreview({ template }: { template: NotificationTemplate }) {\r\n  const [previewData, setPreviewData] = useState<unknown>(null);\r\n  const [sampleVariables, setSampleVariables] = useState<Record<string, string>>({});\r\n\r\n  useEffect(() => {\r\n    loadPreview();\r\n  }, [template, sampleVariables]);\r\n\r\n  const loadPreview = async () => {\r\n    try {\r\n      const preview = await templateService.previewTemplate(template.id, sampleVariables);\r\n      setPreviewData(preview);\r\n    } catch (error) {\r\n      console.error('Failed to load preview:', error);\r\n    }\r\n  };\r\n\r\n  const handleVariableChange = (variable: string, value: string) => {\r\n    setSampleVariables(prev => ({\r\n      ...prev,\r\n      [variable]: value\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Variable Inputs */}\r\n      {template.variables && template.variables.length > 0 && (\r\n        <div>\r\n          <Label className=\"text-sm font-medium\">Sample Variables</Label>\r\n          <div className=\"grid grid-cols-2 gap-2 mt-2\">\r\n            {template.variables.map((variable) => (\r\n              <div key={variable}>\r\n                <Label htmlFor={variable} className=\"text-xs\">{variable}</Label>\r\n                <Input\r\n                  id={variable}\r\n                  size=\"sm\"\r\n                  value={sampleVariables[variable] || ''}\r\n                  onChange={(e) => handleVariableChange(variable, e.target.value)}\r\n                  placeholder={`Sample ${variable}`}\r\n                />\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Preview */}\r\n      <div className=\"space-y-4\">\r\n        {(template.channel === 'push' || template.channel === 'both') && (\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Smartphone className=\"h-4 w-4 text-blue-600\" />\r\n                Push Notification Preview\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"bg-gray-100 rounded-lg p-4 max-w-sm\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <div className=\"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center\">\r\n                    <Bell className=\"h-3 w-3 text-white\" />\r\n                  </div>\r\n                  <span className=\"text-sm font-medium\">Your App</span>\r\n                  <span className=\"text-xs text-gray-500 ml-auto\">now</span>\r\n                </div>\r\n                <div className=\"text-sm font-medium mb-1\">\r\n                  {previewData?.title || template.title || 'Notification'}\r\n                </div>\r\n                <div className=\"text-sm text-gray-600\">\r\n                  {previewData?.message || template.message_body}\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {(template.channel === 'whatsapp' || template.channel === 'both') && (\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <MessageSquare className=\"h-4 w-4 text-green-600\" />\r\n                WhatsApp Preview\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"bg-green-50 rounded-lg p-4 max-w-sm\">\r\n                <div className=\"bg-white rounded-lg p-3 shadow-sm\">\r\n                  <div className=\"text-sm\">\r\n                    {previewData?.message || template.message_body}\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-500 mt-2 text-right\">\r\n                    ‚úì‚úì Delivered\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n      </div>\r\n\r\n      {previewData?.missingVariables && previewData.missingVariables.length > 0 && (\r\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3\">\r\n          <div className=\"text-sm text-yellow-800\">\r\n            <strong>Missing variables:</strong> {previewData.missingVariables.join(', ')}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\pdf\\PDFPreviewModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'generatePreview'. Either include it or remove the dependency array.","line":26,"column":6,"nodeType":"ArrayExpression","endLine":26,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [template, isOpen, generatePreview]","fix":{"range":[783,801],"text":"[template, isOpen, generatePreview]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { X, Download, FileText } from 'lucide-react';\r\nimport { Button } from '../ui/button';\r\nimport { PDFTemplate } from '../../types/pdfTemplates';\r\nimport { pdfTemplateService } from '../../services/pdfTemplateService';\r\nimport { uiNotificationService } from '../../services/uiNotificationService';\r\n\r\ninterface PDFPreviewModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  template: PDFTemplate | null;\r\n}\r\n\r\nexport const PDFPreviewModal: React.FC<PDFPreviewModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  template\r\n}) => {\r\n  const [previewHtml, setPreviewHtml] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (template && isOpen) {\r\n      generatePreview();\r\n    }\r\n  }, [template, isOpen]);\r\n\r\n  const generatePreview = () => {\r\n    if (!template) return;\r\n\r\n    const previewData = pdfTemplateService.getPreviewData();\r\n    let html = template.htmlContent;\r\n    \r\n    // Replace placeholders with preview data\r\n    Object.entries(previewData).forEach(([key, value]) => {\r\n      const placeholder = `{{${key}}}`;\r\n      html = html.replace(new RegExp(placeholder, 'g'), value);\r\n    });\r\n    \r\n    setPreviewHtml(html);\r\n  };\r\n\r\n  const handleGeneratePDF = async () => {\r\n    if (!template) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const previewData = pdfTemplateService.getPreviewData();\r\n      const response = await pdfTemplateService.generatePDF({\r\n        templateId: template.id,\r\n        data: previewData,\r\n        fileName: `preview_${template.name.toLowerCase().replace(/\\s+/g, '_')}.pdf`\r\n      });\r\n      \r\n      uiNotificationService.successNotify('Success', 'PDF generated successfully');\r\n      \r\n      // In a real implementation, this would trigger a download\r\n      console.log('Generated PDF:', response);\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify('Error', 'Failed to generate PDF');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen || !template) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-hidden\">\r\n        <div className=\"flex items-center justify-between p-6 border-b\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <FileText className=\"h-5 w-5 text-blue-600\" />\r\n            <div>\r\n              <h2 className=\"text-xl font-semibold\">{template.name}</h2>\r\n              <p className=\"text-sm text-gray-600\">Template Preview</p>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={handleGeneratePDF}\r\n              disabled={loading}\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              <Download className=\"h-4 w-4\" />\r\n              {loading ? 'Generating...' : 'Generate PDF'}\r\n            </Button>\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\r\n              <X className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-6 overflow-auto max-h-[calc(90vh-120px)]\">\r\n          <div className=\"bg-gray-100 p-4 rounded-lg mb-4\">\r\n            <h3 className=\"font-medium mb-2\">Preview with Sample Data:</h3>\r\n            <div className=\"text-sm text-gray-600 grid grid-cols-2 gap-2\">\r\n              <div>Customer: John Doe</div>\r\n              <div>Company: ABC Corporation</div>\r\n              <div>Date: 2024-12-31</div>\r\n              <div>Amount: $1,500.00</div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div \r\n            className=\"border rounded-lg p-6 bg-white shadow-sm\"\r\n            dangerouslySetInnerHTML={{ __html: previewHtml }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\pdf\\PDFTemplateFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\portal\\PortalSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\product-sales\\ProductSaleDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\product-sales\\ProductSaleForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\providers\\AntdConfigProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\providers\\AppProviders.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\service-contracts\\ServiceContractFormModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\syslogs\\AuditLogFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\syslogs\\LogExportDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\syslogs\\SystemHealthDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\accessible-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\accessible-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\accessible-table.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":375,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":375,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Button } from \"./button\"\r\nimport { Checkbox } from \"./checkbox\"\r\nimport { ChevronUp, ChevronDown, ChevronsUpDown } from \"lucide-react\"\r\nimport { announceUtils, keyboardUtils } from \"@/utils/accessibility\"\r\n\r\ninterface AccessibleTableProps {\r\n  children: React.ReactNode\r\n  className?: string\r\n  caption?: string\r\n  summary?: string\r\n  \"aria-label\"?: string\r\n  \"aria-labelledby\"?: string\r\n}\r\n\r\ninterface TableHeaderProps {\r\n  children: React.ReactNode\r\n  className?: string\r\n  sortable?: boolean\r\n  sortDirection?: \"asc\" | \"desc\" | \"none\"\r\n  onSort?: () => void\r\n  scope?: \"col\" | \"row\"\r\n}\r\n\r\ninterface TableCellProps {\r\n  children: React.ReactNode\r\n  className?: string\r\n  scope?: \"col\" | \"row\" | \"colgroup\" | \"rowgroup\"\r\n  headers?: string\r\n  role?: string\r\n}\r\n\r\ninterface TableRowProps {\r\n  children: React.ReactNode\r\n  className?: string\r\n  selected?: boolean\r\n  onSelect?: (selected: boolean) => void\r\n  selectable?: boolean\r\n  rowIndex?: number\r\n}\r\n\r\ninterface SelectionState {\r\n  selectedRows: Set<number>\r\n  selectAll: boolean\r\n  indeterminate: boolean\r\n}\r\n\r\n// Main accessible table component\r\nconst AccessibleTable = React.forwardRef<HTMLTableElement, AccessibleTableProps>(\r\n  ({ className, children, caption, summary, ...props }, ref) => {\r\n    const tableId = React.useId()\r\n    \r\n    return (\r\n      <div className=\"relative w-full overflow-auto\">\r\n        <table\r\n          ref={ref}\r\n          id={tableId}\r\n          className={cn(\"w-full caption-bottom text-sm\", className)}\r\n          role=\"table\"\r\n          {...props}\r\n        >\r\n          {caption && (\r\n            <caption className=\"mt-4 text-sm text-neutral-500 text-left font-medium\">\r\n              {caption}\r\n            </caption>\r\n          )}\r\n          {summary && (\r\n            <caption className=\"sr-only\">\r\n              {summary}\r\n            </caption>\r\n          )}\r\n          {children}\r\n        </table>\r\n      </div>\r\n    )\r\n  }\r\n)\r\nAccessibleTable.displayName = \"AccessibleTable\"\r\n\r\n// Accessible table header with sorting\r\nconst AccessibleTableHeader = React.forwardRef<HTMLTableCellElement, TableHeaderProps>(\r\n  ({ \r\n    className, \r\n    children, \r\n    sortable = false, \r\n    sortDirection = \"none\", \r\n    onSort, \r\n    scope = \"col\",\r\n    ...props \r\n  }, ref) => {\r\n    const headerId = React.useId()\r\n    \r\n    const getSortIcon = () => {\r\n      if (!sortable) return null\r\n      \r\n      switch (sortDirection) {\r\n        case \"asc\":\r\n          return <ChevronUp className=\"ml-2 h-4 w-4\" aria-hidden=\"true\" />\r\n        case \"desc\":\r\n          return <ChevronDown className=\"ml-2 h-4 w-4\" aria-hidden=\"true\" />\r\n        default:\r\n          return <ChevronsUpDown className=\"ml-2 h-4 w-4\" aria-hidden=\"true\" />\r\n      }\r\n    }\r\n    \r\n    const getSortLabel = () => {\r\n      switch (sortDirection) {\r\n        case \"asc\":\r\n          return \"sorted ascending\"\r\n        case \"desc\":\r\n          return \"sorted descending\"\r\n        default:\r\n          return \"not sorted\"\r\n      }\r\n    }\r\n    \r\n    const handleSort = () => {\r\n      if (sortable && onSort) {\r\n        onSort()\r\n        // Announce sort change to screen readers\r\n        const direction = sortDirection === \"asc\" ? \"descending\" : \"ascending\"\r\n        announceUtils.announce(`Column sorted ${direction}`)\r\n      }\r\n    }\r\n    \r\n    if (sortable) {\r\n      return (\r\n        <th\r\n          ref={ref}\r\n          id={headerId}\r\n          scope={scope}\r\n          className={cn(\r\n            \"h-12 px-4 text-left align-middle font-medium text-neutral-500 [&:has([role=checkbox])]:pr-0\",\r\n            className\r\n          )}\r\n          {...props}\r\n        >\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            className=\"h-auto p-0 font-medium text-neutral-500 hover:text-neutral-900 focus-ring\"\r\n            onClick={handleSort}\r\n            aria-label={`Sort by ${children}, currently ${getSortLabel()}`}\r\n            aria-sort={sortDirection === \"none\" ? \"none\" : sortDirection}\r\n          >\r\n            <span className=\"flex items-center\">\r\n              {children}\r\n              {getSortIcon()}\r\n            </span>\r\n          </Button>\r\n        </th>\r\n      )\r\n    }\r\n    \r\n    return (\r\n      <th\r\n        ref={ref}\r\n        id={headerId}\r\n        scope={scope}\r\n        className={cn(\r\n          \"h-12 px-4 text-left align-middle font-medium text-neutral-500 [&:has([role=checkbox])]:pr-0\",\r\n          className\r\n        )}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </th>\r\n    )\r\n  }\r\n)\r\nAccessibleTableHeader.displayName = \"AccessibleTableHeader\"\r\n\r\n// Accessible table cell\r\nconst AccessibleTableCell = React.forwardRef<HTMLTableCellElement, TableCellProps>(\r\n  ({ className, children, scope, headers, role, ...props }, ref) => {\r\n    const cellId = React.useId()\r\n    \r\n    return (\r\n      <td\r\n        ref={ref}\r\n        id={cellId}\r\n        scope={scope}\r\n        headers={headers}\r\n        role={role}\r\n        className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </td>\r\n    )\r\n  }\r\n)\r\nAccessibleTableCell.displayName = \"AccessibleTableCell\"\r\n\r\n// Accessible table row with selection\r\nconst AccessibleTableRow = React.forwardRef<HTMLTableRowElement, TableRowProps>(\r\n  ({ \r\n    className, \r\n    children, \r\n    selected = false, \r\n    onSelect, \r\n    selectable = false,\r\n    rowIndex,\r\n    ...props \r\n  }, ref) => {\r\n    const rowId = React.useId()\r\n    \r\n    const handleSelect = (checked: boolean) => {\r\n      if (onSelect) {\r\n        onSelect(checked)\r\n        // Announce selection change\r\n        const action = checked ? \"selected\" : \"deselected\"\r\n        announceUtils.announce(`Row ${rowIndex !== undefined ? rowIndex + 1 : ''} ${action}`)\r\n      }\r\n    }\r\n    \r\n    return (\r\n      <tr\r\n        ref={ref}\r\n        id={rowId}\r\n        className={cn(\r\n          \"border-b transition-colors hover:bg-neutral-50/50 data-[state=selected]:bg-neutral-100\",\r\n          selected && \"bg-neutral-100\",\r\n          className\r\n        )}\r\n        aria-selected={selectable ? selected : undefined}\r\n        role={selectable ? \"row\" : undefined}\r\n        {...props}\r\n      >\r\n        {selectable && (\r\n          <AccessibleTableCell className=\"w-12\">\r\n            <Checkbox\r\n              checked={selected}\r\n              onCheckedChange={handleSelect}\r\n              aria-label={`Select row ${rowIndex !== undefined ? rowIndex + 1 : ''}`}\r\n            />\r\n          </AccessibleTableCell>\r\n        )}\r\n        {children}\r\n      </tr>\r\n    )\r\n  }\r\n)\r\nAccessibleTableRow.displayName = \"AccessibleTableRow\"\r\n\r\n// Table with bulk selection capabilities\r\ninterface BulkSelectTableProps<T = unknown> extends AccessibleTableProps {\r\n  data: T[]\r\n  onSelectionChange?: (selectedRows: number[]) => void\r\n  selectable?: boolean\r\n}\r\n\r\nconst BulkSelectTable = React.forwardRef<HTMLTableElement, BulkSelectTableProps>(\r\n  ({ \r\n    children, \r\n    data, \r\n    onSelectionChange, \r\n    selectable = false,\r\n    ...props \r\n  }: BulkSelectTableProps, ref) => {\r\n    const [selection, setSelection] = React.useState<SelectionState>({\r\n      selectedRows: new Set(),\r\n      selectAll: false,\r\n      indeterminate: false\r\n    })\r\n    \r\n    const updateSelection = React.useCallback((newSelection: SelectionState) => {\r\n      setSelection(newSelection)\r\n      if (onSelectionChange) {\r\n        onSelectionChange(Array.from(newSelection.selectedRows))\r\n      }\r\n    }, [onSelectionChange])\r\n    \r\n    const handleSelectAll = (checked: boolean) => {\r\n      if (checked) {\r\n        const allRows = new Set(data.map((_, index) => index))\r\n        updateSelection({\r\n          selectedRows: allRows,\r\n          selectAll: true,\r\n          indeterminate: false\r\n        })\r\n        announceUtils.announce(`All ${data.length} rows selected`)\r\n      } else {\r\n        updateSelection({\r\n          selectedRows: new Set(),\r\n          selectAll: false,\r\n          indeterminate: false\r\n        })\r\n        announceUtils.announce(\"All rows deselected\")\r\n      }\r\n    }\r\n    \r\n    const handleRowSelect = (rowIndex: number, checked: boolean) => {\r\n      const newSelectedRows = new Set(selection.selectedRows)\r\n      \r\n      if (checked) {\r\n        newSelectedRows.add(rowIndex)\r\n      } else {\r\n        newSelectedRows.delete(rowIndex)\r\n      }\r\n      \r\n      const selectAll = newSelectedRows.size === data.length\r\n      const indeterminate = newSelectedRows.size > 0 && newSelectedRows.size < data.length\r\n      \r\n      updateSelection({\r\n        selectedRows: newSelectedRows,\r\n        selectAll,\r\n        indeterminate\r\n      })\r\n    }\r\n    \r\n    // Provide selection context to children\r\n    const contextValue = {\r\n      selection,\r\n      handleSelectAll,\r\n      handleRowSelect,\r\n      selectable\r\n    }\r\n    \r\n    return (\r\n      <SelectionContext.Provider value={contextValue}>\r\n        <AccessibleTable ref={ref} {...props}>\r\n          {children}\r\n        </AccessibleTable>\r\n      </SelectionContext.Provider>\r\n    )\r\n  }\r\n)\r\nBulkSelectTable.displayName = \"BulkSelectTable\"\r\n\r\n// Selection context for sharing state\r\nconst SelectionContext = React.createContext<{\r\n  selection: SelectionState\r\n  handleSelectAll: (checked: boolean) => void\r\n  handleRowSelect: (rowIndex: number, checked: boolean) => void\r\n  selectable: boolean\r\n} | null>(null)\r\n\r\n// Hook to use selection context\r\nconst useTableSelection = () => {\r\n  const context = React.useContext(SelectionContext)\r\n  if (!context) {\r\n    throw new Error(\"useTableSelection must be used within a BulkSelectTable\")\r\n  }\r\n  return context\r\n}\r\n\r\n// Accessible table header with select all\r\nconst SelectAllHeader: React.FC<{ children?: React.ReactNode }> = ({ children }) => {\r\n  const { selection, handleSelectAll, selectable } = useTableSelection()\r\n  \r\n  if (!selectable) return null\r\n  \r\n  return (\r\n    <AccessibleTableHeader className=\"w-12\">\r\n      <Checkbox\r\n        checked={selection.selectAll}\r\n        indeterminate={selection.indeterminate}\r\n        onCheckedChange={handleSelectAll}\r\n        aria-label=\"Select all rows\"\r\n      />\r\n      {children}\r\n    </AccessibleTableHeader>\r\n  )\r\n}\r\n\r\nexport {\r\n  AccessibleTable,\r\n  AccessibleTableHeader,\r\n  AccessibleTableCell,\r\n  AccessibleTableRow,\r\n  BulkSelectTable,\r\n  SelectAllHeader,\r\n  useTableSelection,\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\accessible-toast.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'getPoliteness'. Either include it or remove the dependency array.","line":185,"column":6,"nodeType":"ArrayExpression","endLine":185,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [open, title, description, announceToScreenReader, getPoliteness]","fix":{"range":[6558,6608],"text":"[open, title, description, announceToScreenReader, getPoliteness]"}}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":277,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":277,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X, CheckCircle, AlertCircle, AlertTriangle, Info } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { announceUtils } from \"@/utils/accessibility\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-white text-neutral-900\",\n        destructive:\n          \"destructive group border-red-500 bg-red-50 text-red-900\",\n        success:\n          \"border-green-500 bg-green-50 text-green-900\",\n        warning:\n          \"border-yellow-500 bg-yellow-50 text-yellow-900\",\n        info:\n          \"border-blue-500 bg-blue-50 text-blue-900\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-neutral-500 opacity-0 transition-opacity hover:text-neutral-900 focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    aria-label=\"Close notification\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\n// Enhanced toast with accessibility features\ninterface AccessibleToastProps {\n  title: string\n  description?: string\n  variant?: \"default\" | \"destructive\" | \"success\" | \"warning\" | \"info\"\n  action?: {\n    label: string\n    onClick: () => void\n  }\n  duration?: number\n  onOpenChange?: (open: boolean) => void\n  announceToScreenReader?: boolean\n}\n\nconst AccessibleToast: React.FC<AccessibleToastProps> = ({\n  title,\n  description,\n  variant = \"default\",\n  action,\n  duration = 5000,\n  onOpenChange,\n  announceToScreenReader = true\n}) => {\n  const [open, setOpen] = React.useState(true)\n\n  const getIcon = () => {\n    switch (variant) {\n      case \"success\":\n        return <CheckCircle className=\"h-5 w-5 text-green-600\" aria-hidden=\"true\" />\n      case \"destructive\":\n        return <AlertCircle className=\"h-5 w-5 text-red-600\" aria-hidden=\"true\" />\n      case \"warning\":\n        return <AlertTriangle className=\"h-5 w-5 text-yellow-600\" aria-hidden=\"true\" />\n      case \"info\":\n        return <Info className=\"h-5 w-5 text-blue-600\" aria-hidden=\"true\" />\n      default:\n        return null\n    }\n  }\n\n  const getAriaRole = () => {\n    switch (variant) {\n      case \"destructive\":\n      case \"warning\":\n        return \"alert\"\n      default:\n        return \"status\"\n    }\n  }\n\n  const getPoliteness = () => {\n    switch (variant) {\n      case \"destructive\":\n      case \"warning\":\n        return \"assertive\" as const\n      default:\n        return \"polite\" as const\n    }\n  }\n\n  React.useEffect(() => {\n    if (open && announceToScreenReader) {\n      const message = description ? `${title}. ${description}` : title\n      announceUtils.announce(message, getPoliteness())\n    }\n  }, [open, title, description, announceToScreenReader])\n\n  const handleOpenChange = (newOpen: boolean) => {\n    setOpen(newOpen)\n    onOpenChange?.(newOpen)\n  }\n\n  return (\n    <Toast \n      variant={variant} \n      open={open} \n      onOpenChange={handleOpenChange}\n      duration={duration}\n      role={getAriaRole()}\n      aria-live={getPoliteness()}\n      aria-atomic=\"true\"\n    >\n      <div className=\"flex items-start space-x-3\">\n        {getIcon()}\n        <div className=\"flex-1 space-y-1\">\n          <ToastTitle>{title}</ToastTitle>\n          {description && (\n            <ToastDescription>{description}</ToastDescription>\n          )}\n        </div>\n      </div>\n      {action && (\n        <ToastAction \n          onClick={action.onClick}\n          aria-label={action.label}\n        >\n          {action.label}\n        </ToastAction>\n      )}\n      <ToastClose />\n    </Toast>\n  )\n}\n\n// Toast hook with accessibility features\ninterface ToastOptions {\n  title: string\n  description?: string\n  variant?: \"default\" | \"destructive\" | \"success\" | \"warning\" | \"info\"\n  action?: {\n    label: string\n    onClick: () => void\n  }\n  duration?: number\n  announceToScreenReader?: boolean\n}\n\nconst useAccessibleToast = () => {\n  const [toasts, setToasts] = React.useState<Array<ToastOptions & { id: string }>>([])\n\n  const toast = React.useCallback((options: ToastOptions) => {\n    const id = Math.random().toString(36).substr(2, 9)\n    setToasts(prev => [...prev, { ...options, id }])\n    \n    // Auto remove after duration\n    setTimeout(() => {\n      setToasts(prev => prev.filter(t => t.id !== id))\n    }, options.duration || 5000)\n  }, [])\n\n  const dismiss = React.useCallback((id: string) => {\n    setToasts(prev => prev.filter(t => t.id !== id))\n  }, [])\n\n  const dismissAll = React.useCallback(() => {\n    setToasts([])\n  }, [])\n\n  return {\n    toast,\n    dismiss,\n    dismissAll,\n    toasts\n  }\n}\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n  AccessibleToast,\n  useAccessibleToast,\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":137,"column":45,"nodeType":"Identifier","messageId":"namedExport","endLine":137,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-accent-500 text-white hover:bg-accent-600\",\r\n        secondary:\r\n          \"border-transparent bg-neutral-100 text-neutral-900 hover:bg-neutral-200\",\r\n        destructive:\r\n          \"border-transparent bg-error-500 text-white hover:bg-error-600\",\r\n        outline:\r\n          \"border-neutral-300 text-neutral-900 hover:bg-neutral-100\",\r\n        success:\r\n          \"border-transparent bg-success-500 text-white hover:bg-success-600\",\r\n        warning:\r\n          \"border-transparent bg-warning-500 text-white hover:bg-warning-600\",\r\n        info:\r\n          \"border-transparent bg-accent-100 text-accent-700 hover:bg-accent-200\",\r\n        glass:\r\n          \"border-white/30 bg-white/20 text-white backdrop-blur-sm hover:bg-white/30\",\r\n      },\r\n      size: {\r\n        default: \"px-2.5 py-0.5 text-xs\",\r\n        sm: \"px-2 py-0.5 text-xs\",\r\n        lg: \"px-3 py-1 text-sm\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, size, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant, size }), className)} {...props} />\r\n  )\r\n}\r\n\r\n// Status Badge Component\r\ninterface StatusBadgeProps extends Omit<BadgeProps, 'variant'> {\r\n  status: 'working' | 'done' | 'stuck' | 'pending' | 'active' | 'inactive' | 'draft' | 'published' | 'archived'\r\n}\r\n\r\nconst StatusBadge = React.forwardRef<HTMLDivElement, StatusBadgeProps>(\r\n  ({ status, className, ...props }, ref) => {\r\n    const getStatusVariant = (status: string) => {\r\n      switch (status.toLowerCase()) {\r\n        case 'working':\r\n        case 'active':\r\n        case 'published':\r\n          return 'success'\r\n        case 'done':\r\n          return 'default'\r\n        case 'stuck':\r\n        case 'inactive':\r\n        case 'archived':\r\n          return 'destructive'\r\n        case 'pending':\r\n        case 'draft':\r\n          return 'warning'\r\n        default:\r\n          return 'secondary'\r\n      }\r\n    }\r\n\r\n    const getStatusLabel = (status: string) => {\r\n      return status.charAt(0).toUpperCase() + status.slice(1)\r\n    }\r\n\r\n    return (\r\n      <Badge\r\n        ref={ref}\r\n        variant={getStatusVariant(status)}\r\n        className={cn(\"capitalize\", className)}\r\n        {...props}\r\n      >\r\n        {getStatusLabel(status)}\r\n      </Badge>\r\n    )\r\n  }\r\n)\r\nStatusBadge.displayName = \"StatusBadge\"\r\n\r\n// Priority Badge Component\r\ninterface PriorityBadgeProps extends Omit<BadgeProps, 'variant'> {\r\n  priority: 'low' | 'medium' | 'high' | 'critical' | 'urgent'\r\n}\r\n\r\nconst PriorityBadge = React.forwardRef<HTMLDivElement, PriorityBadgeProps>(\r\n  ({ priority, className, ...props }, ref) => {\r\n    const getPriorityVariant = (priority: string) => {\r\n      switch (priority.toLowerCase()) {\r\n        case 'low':\r\n          return 'info'\r\n        case 'medium':\r\n          return 'secondary'\r\n        case 'high':\r\n          return 'warning'\r\n        case 'critical':\r\n        case 'urgent':\r\n          return 'destructive'\r\n        default:\r\n          return 'secondary'\r\n      }\r\n    }\r\n\r\n    const getPriorityLabel = (priority: string) => {\r\n      return priority.charAt(0).toUpperCase() + priority.slice(1)\r\n    }\r\n\r\n    return (\r\n      <Badge\r\n        ref={ref}\r\n        variant={getPriorityVariant(priority)}\r\n        className={cn(\"capitalize\", className)}\r\n        {...props}\r\n      >\r\n        {getPriorityLabel(priority)}\r\n      </Badge>\r\n    )\r\n  }\r\n)\r\nPriorityBadge.displayName = \"PriorityBadge\"\r\n\r\nexport { Badge, StatusBadge, PriorityBadge, badgeVariants }","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":108,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":108,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 disabled:cursor-not-allowed [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 relative\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-accent-500 text-white shadow-sm hover:bg-accent-600 hover:shadow-md active:bg-accent-700 active:scale-[0.98]\",\r\n        destructive:\r\n          \"bg-error-500 text-white shadow-sm hover:bg-error-600 hover:shadow-md active:bg-error-700 active:scale-[0.98]\",\r\n        outline:\r\n          \"border border-neutral-300 bg-white text-neutral-900 shadow-sm hover:bg-neutral-50 hover:border-neutral-400 active:bg-neutral-100\",\r\n        secondary:\r\n          \"bg-neutral-100 text-neutral-900 shadow-sm hover:bg-neutral-200 active:bg-neutral-300 active:scale-[0.98]\",\r\n        ghost: \"text-neutral-700 hover:bg-neutral-100 hover:text-neutral-900 active:bg-neutral-200\",\r\n        link: \"text-accent-600 underline-offset-4 hover:underline hover:text-accent-700 active:text-accent-800\",\r\n        success: \"bg-success-500 text-white shadow-sm hover:bg-success-600 hover:shadow-md active:bg-success-700 active:scale-[0.98]\",\r\n        warning: \"bg-warning-500 text-white shadow-sm hover:bg-warning-600 hover:shadow-md active:bg-warning-700 active:scale-[0.98]\",\r\n        gradient: \"bg-gradient-to-r from-accent-500 to-accent-600 text-white shadow-sm hover:from-accent-600 hover:to-accent-700 hover:shadow-md active:scale-[0.98]\",\r\n        glass: \"bg-white/80 backdrop-blur-sm border border-white/20 text-neutral-900 shadow-lg hover:bg-white/90 hover:shadow-xl\",\r\n      },\r\n      size: {\r\n        default: \"h-10 px-4 py-2 sm:h-10 sm:px-4\",\r\n        sm: \"h-8 rounded-md px-3 text-xs sm:h-8 sm:px-3\",\r\n        lg: \"h-12 rounded-lg px-6 sm:px-8 text-base\",\r\n        icon: \"h-10 w-10 sm:h-10 sm:w-10\",\r\n        xs: \"h-7 rounded-sm px-2 text-xs\",\r\n        xl: \"h-14 rounded-lg px-8 sm:px-10 text-lg font-semibold\",\r\n        mobile: \"h-12 px-4 py-3 text-base min-h-[44px] touch-target\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean\r\n  loading?: boolean\r\n  loadingText?: string\r\n  ariaLabel?: string\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({\r\n    className,\r\n    variant,\r\n    size,\r\n    asChild = false,\r\n    loading = false,\r\n    loadingText = \"Loading...\",\r\n    ariaLabel,\r\n    children,\r\n    disabled,\r\n    ...props\r\n  }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\"\r\n    const isDisabled = disabled || loading\r\n\r\n    return (\r\n      <Comp\r\n        className={cn(buttonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        disabled={isDisabled}\r\n        aria-label={ariaLabel}\r\n        aria-disabled={isDisabled}\r\n        {...props}\r\n      >\r\n        {loading && (\r\n          <svg\r\n            className=\"animate-spin -ml-1 mr-2 h-4 w-4\"\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            fill=\"none\"\r\n            viewBox=\"0 0 24 24\"\r\n            aria-hidden=\"true\"\r\n          >\r\n            <circle\r\n              className=\"opacity-25\"\r\n              cx=\"12\"\r\n              cy=\"12\"\r\n              r=\"10\"\r\n              stroke=\"currentColor\"\r\n              strokeWidth=\"4\"\r\n            />\r\n            <path\r\n              className=\"opacity-75\"\r\n              fill=\"currentColor\"\r\n              d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n            />\r\n          </svg>\r\n        )}\r\n        {loading ? loadingText : children}\r\n        {loading && <span className=\"sr-only\">Loading</span>}\r\n      </Comp>\r\n    )\r\n  }\r\n)\r\nButton.displayName = \"Button\"\r\n\r\nexport { Button, buttonVariants }","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\enhanced-button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":239,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":239,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { Loader2, Sparkles } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\n\nconst enhancedButtonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 disabled:cursor-not-allowed [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 relative overflow-hidden group\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-accent-500 text-white shadow-lg hover:bg-accent-600 hover:shadow-xl active:bg-accent-700 active:scale-[0.98] hover:-translate-y-0.5\",\n        destructive: \"bg-error-500 text-white shadow-lg hover:bg-error-600 hover:shadow-xl active:bg-error-700 active:scale-[0.98] hover:-translate-y-0.5\",\n        outline: \"border-2 border-accent-200 bg-white text-accent-700 shadow-sm hover:bg-accent-50 hover:border-accent-300 hover:shadow-md active:scale-[0.98]\",\n        secondary: \"bg-neutral-100 text-neutral-900 shadow-sm hover:bg-neutral-200 hover:shadow-md active:scale-[0.98] hover:-translate-y-0.5\",\n        ghost: \"text-accent-700 hover:bg-accent-50 hover:text-accent-800 active:scale-[0.98]\",\n        link: \"text-accent-600 underline-offset-4 hover:underline hover:text-accent-700 active:scale-[0.98]\",\n        gradient: \"bg-gradient-to-r from-accent-500 to-indigo-600 text-white shadow-lg hover:from-accent-600 hover:to-indigo-700 hover:shadow-xl active:scale-[0.98] hover:-translate-y-0.5\",\n        glass: \"bg-white/80 backdrop-blur-sm border border-white/20 text-neutral-900 shadow-lg hover:bg-white/90 hover:shadow-xl active:scale-[0.98]\",\n        success: \"bg-success-500 text-white shadow-lg hover:bg-success-600 hover:shadow-xl active:bg-success-700 active:scale-[0.98] hover:-translate-y-0.5\",\n        warning: \"bg-warning-500 text-white shadow-lg hover:bg-warning-600 hover:shadow-xl active:bg-warning-700 active:scale-[0.98] hover:-translate-y-0.5\",\n        premium: \"bg-gradient-to-r from-purple-500 to-pink-600 text-white shadow-lg hover:from-purple-600 hover:to-pink-700 hover:shadow-xl active:scale-[0.98] hover:-translate-y-0.5\",\n        neon: \"bg-gradient-to-r from-cyan-500 to-blue-600 text-white shadow-lg shadow-cyan-500/25 hover:shadow-xl hover:shadow-cyan-500/40 active:scale-[0.98] hover:-translate-y-0.5\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2 sm:h-10 sm:px-4\",\n        sm: \"h-8 rounded-md px-3 text-xs sm:h-8 sm:px-3\",\n        lg: \"h-12 rounded-lg px-6 sm:px-8 text-base\",\n        icon: \"h-10 w-10 sm:h-10 sm:w-10\",\n        xs: \"h-7 rounded-sm px-2 text-xs\",\n        xl: \"h-14 rounded-xl px-8 sm:px-10 text-lg font-semibold\",\n        mobile: \"h-12 px-4 py-3 text-base min-h-[44px] touch-target\",\n      },\n      glow: {\n        none: \"\",\n        primary: \"hover:shadow-accent-500/25 hover:shadow-2xl\",\n        success: \"hover:shadow-success-500/25 hover:shadow-2xl\",\n        warning: \"hover:shadow-warning-500/25 hover:shadow-2xl\",\n        error: \"hover:shadow-error-500/25 hover:shadow-2xl\",\n        purple: \"hover:shadow-purple-500/25 hover:shadow-2xl\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n      glow: \"none\",\n    },\n  }\n)\n\nexport interface EnhancedButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof enhancedButtonVariants> {\n  asChild?: boolean\n  loading?: boolean\n  loadingText?: string\n  ariaLabel?: string\n  shimmer?: boolean\n  pulse?: boolean\n  bounce?: boolean\n  icon?: React.ReactNode\n  rightIcon?: React.ReactNode\n}\n\nconst EnhancedButton = React.forwardRef<HTMLButtonElement, EnhancedButtonProps>(\n  ({\n    className,\n    variant,\n    size,\n    glow,\n    asChild = false,\n    loading = false,\n    loadingText = \"Loading...\",\n    ariaLabel,\n    children,\n    disabled,\n    shimmer = false,\n    pulse = false,\n    bounce = false,\n    icon,\n    rightIcon,\n    ...props\n  }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    const isDisabled = disabled || loading\n\n    return (\n      <motion.div\n        whileHover={{ scale: bounce ? 1.05 : 1 }}\n        whileTap={{ scale: 0.95 }}\n        transition={{ type: \"spring\", stiffness: 400, damping: 17 }}\n      >\n        <Comp\n          className={cn(enhancedButtonVariants({ variant, size, glow, className }))}\n          ref={ref}\n          disabled={isDisabled}\n          aria-label={ariaLabel}\n          aria-disabled={isDisabled}\n          {...props}\n        >\n          {/* Shimmer Effect */}\n          {shimmer && (\n            <div className=\"absolute inset-0 -top-px overflow-hidden rounded-lg\">\n              <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 animate-shimmer\" />\n            </div>\n          )}\n\n          {/* Content */}\n          <AnimatePresence mode=\"wait\">\n            {loading ? (\n              <motion.div\n                key=\"loading\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"flex items-center gap-2\"\n              >\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                {loadingText}\n              </motion.div>\n            ) : (\n              <motion.div\n                key=\"content\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"flex items-center gap-2\"\n              >\n                {icon && <span className=\"flex-shrink-0\">{icon}</span>}\n                {children}\n                {rightIcon && <span className=\"flex-shrink-0\">{rightIcon}</span>}\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          {/* Pulse Effect */}\n          {pulse && !loading && (\n            <div className=\"absolute inset-0 rounded-lg animate-pulse bg-white/10\" />\n          )}\n        </Comp>\n      </motion.div>\n    )\n  }\n)\nEnhancedButton.displayName = \"EnhancedButton\"\n\n// Icon Button Component\ninterface IconButtonProps extends Omit<EnhancedButtonProps, 'children'> {\n  icon: React.ReactNode\n  tooltip?: string\n}\n\nconst IconButton = React.forwardRef<HTMLButtonElement, IconButtonProps>(\n  ({ icon, tooltip, className, ...props }, ref) => (\n    <EnhancedButton\n      ref={ref}\n      size=\"icon\"\n      className={cn(\"rounded-full\", className)}\n      aria-label={tooltip}\n      {...props}\n    >\n      {icon}\n    </EnhancedButton>\n  )\n)\nIconButton.displayName = \"IconButton\"\n\n// Floating Action Button\ninterface FloatingActionButtonProps extends EnhancedButtonProps {\n  position?: \"bottom-right\" | \"bottom-left\" | \"top-right\" | \"top-left\"\n}\n\nconst FloatingActionButton = React.forwardRef<HTMLButtonElement, FloatingActionButtonProps>(\n  ({ position = \"bottom-right\", className, children, ...props }, ref) => {\n    const positionClasses = {\n      \"bottom-right\": \"fixed bottom-6 right-6 z-50\",\n      \"bottom-left\": \"fixed bottom-6 left-6 z-50\",\n      \"top-right\": \"fixed top-6 right-6 z-50\",\n      \"top-left\": \"fixed top-6 left-6 z-50\",\n    }\n\n    return (\n      <motion.div\n        initial={{ scale: 0, opacity: 0 }}\n        animate={{ scale: 1, opacity: 1 }}\n        whileHover={{ scale: 1.1 }}\n        whileTap={{ scale: 0.9 }}\n        className={positionClasses[position]}\n      >\n        <EnhancedButton\n          ref={ref}\n          size=\"lg\"\n          variant=\"gradient\"\n          glow=\"primary\"\n          className={cn(\"rounded-full shadow-2xl\", className)}\n          {...props}\n        >\n          {children}\n        </EnhancedButton>\n      </motion.div>\n    )\n  }\n)\nFloatingActionButton.displayName = \"FloatingActionButton\"\n\n// Button Group Component\ninterface ButtonGroupProps {\n  children: React.ReactNode\n  className?: string\n  orientation?: \"horizontal\" | \"vertical\"\n  size?: \"sm\" | \"default\" | \"lg\"\n}\n\nconst ButtonGroup = React.forwardRef<HTMLDivElement, ButtonGroupProps>(\n  ({ children, className, orientation = \"horizontal\", size = \"default\", ...props }, ref) => (\n    <div\n      ref={ref}\n      className={cn(\n        \"inline-flex\",\n        orientation === \"horizontal\" ? \"flex-row\" : \"flex-col\",\n        \"[&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none [&>*:not(:first-child)]:rounded-l-none\",\n        orientation === \"vertical\" && \"[&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none [&>*:not(:first-child)]:rounded-t-none\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n)\nButtonGroup.displayName = \"ButtonGroup\"\n\nexport { \n  EnhancedButton, \n  IconButton, \n  FloatingActionButton, \n  ButtonGroup, \n  enhancedButtonVariants \n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\enhanced-card.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":263,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":263,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { motion } from \"framer-motion\"\nimport { cn } from \"@/lib/utils\"\n\nconst enhancedCardVariants = cva(\n  \"rounded-xl border text-card-foreground shadow-sm transition-all duration-300 group\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-white border-neutral-200 hover:shadow-lg hover:-translate-y-1\",\n        elevated: \"bg-white border-neutral-200 shadow-lg hover:shadow-xl hover:-translate-y-2\",\n        glass: \"bg-white/80 backdrop-blur-sm border-white/20 shadow-lg hover:bg-white/90 hover:shadow-xl\",\n        gradient: \"bg-gradient-to-br from-white to-neutral-50 border-neutral-200 hover:shadow-lg hover:-translate-y-1\",\n        outline: \"bg-transparent border-2 border-neutral-200 hover:border-accent-300 hover:bg-accent-50/50\",\n        ghost: \"bg-transparent border-transparent hover:bg-neutral-50 hover:border-neutral-200\",\n        premium: \"bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200 hover:shadow-lg hover:-translate-y-1\",\n        success: \"bg-gradient-to-br from-success-50 to-emerald-50 border-success-200 hover:shadow-lg hover:-translate-y-1\",\n        warning: \"bg-gradient-to-br from-warning-50 to-orange-50 border-warning-200 hover:shadow-lg hover:-translate-y-1\",\n        error: \"bg-gradient-to-br from-error-50 to-red-50 border-error-200 hover:shadow-lg hover:-translate-y-1\",\n        dark: \"bg-neutral-900 border-neutral-800 text-white hover:shadow-lg hover:-translate-y-1\",\n      },\n      size: {\n        sm: \"p-4\",\n        default: \"p-6\",\n        lg: \"p-8\",\n        xl: \"p-10\",\n      },\n      glow: {\n        none: \"\",\n        primary: \"hover:shadow-accent-500/20 hover:shadow-2xl\",\n        success: \"hover:shadow-success-500/20 hover:shadow-2xl\",\n        warning: \"hover:shadow-warning-500/20 hover:shadow-2xl\",\n        error: \"hover:shadow-error-500/20 hover:shadow-2xl\",\n        purple: \"hover:shadow-purple-500/20 hover:shadow-2xl\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n      glow: \"none\",\n    },\n  }\n)\n\nexport interface EnhancedCardProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof enhancedCardVariants> {\n  hover?: boolean\n  shimmer?: boolean\n  pulse?: boolean\n}\n\nconst EnhancedCard = React.forwardRef<HTMLDivElement, EnhancedCardProps>(\n  ({ className, variant, size, glow, hover = true, shimmer = false, pulse = false, children, ...props }, ref) => (\n    <motion.div\n      ref={ref}\n      className={cn(enhancedCardVariants({ variant, size, glow, className }))}\n      whileHover={hover ? { y: -4, scale: 1.02 } : undefined}\n      transition={{ type: \"spring\", stiffness: 300, damping: 20 }}\n      {...props}\n    >\n      {/* Shimmer Effect */}\n      {shimmer && (\n        <div className=\"absolute inset-0 -top-px overflow-hidden rounded-xl\">\n          <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 animate-shimmer\" />\n        </div>\n      )}\n      \n      {/* Pulse Effect */}\n      {pulse && (\n        <div className=\"absolute inset-0 rounded-xl animate-pulse bg-white/10\" />\n      )}\n      \n      {children}\n    </motion.div>\n  )\n)\nEnhancedCard.displayName = \"EnhancedCard\"\n\nconst EnhancedCardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 pb-4\", className)}\n    {...props}\n  />\n))\nEnhancedCardHeader.displayName = \"EnhancedCardHeader\"\n\nconst EnhancedCardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, children, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-xl font-semibold leading-none tracking-tight text-neutral-900 group-hover:text-accent-700 transition-colors\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </h3>\n))\nEnhancedCardTitle.displayName = \"EnhancedCardTitle\"\n\nconst EnhancedCardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-neutral-600 leading-relaxed\", className)}\n    {...props}\n  />\n))\nEnhancedCardDescription.displayName = \"EnhancedCardDescription\"\n\nconst EnhancedCardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"\", className)} {...props} />\n))\nEnhancedCardContent.displayName = \"EnhancedCardContent\"\n\nconst EnhancedCardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center pt-4 border-t border-neutral-100\", className)}\n    {...props}\n  />\n))\nEnhancedCardFooter.displayName = \"EnhancedCardFooter\"\n\n// Stats Card Component\ninterface StatsCardProps extends EnhancedCardProps {\n  title: string\n  value: string | number\n  change?: {\n    value: string | number\n    type: \"increase\" | \"decrease\" | \"neutral\"\n  }\n  icon?: React.ReactNode\n  description?: string\n}\n\nconst StatsCard = React.forwardRef<HTMLDivElement, StatsCardProps>(\n  ({ title, value, change, icon, description, className, ...props }, ref) => (\n    <EnhancedCard\n      ref={ref}\n      variant=\"elevated\"\n      glow=\"primary\"\n      className={cn(\"relative overflow-hidden\", className)}\n      {...props}\n    >\n      <EnhancedCardContent className=\"space-y-3\">\n        <div className=\"flex items-center justify-between\">\n          <p className=\"text-sm font-medium text-neutral-600\">{title}</p>\n          {icon && (\n            <div className=\"p-2 bg-accent-100 rounded-lg text-accent-600\">\n              {icon}\n            </div>\n          )}\n        </div>\n        \n        <div className=\"space-y-1\">\n          <p className=\"text-3xl font-bold text-neutral-900\">{value}</p>\n          {change && (\n            <div className=\"flex items-center gap-1\">\n              <span\n                className={cn(\n                  \"text-sm font-medium\",\n                  change.type === \"increase\" && \"text-success-600\",\n                  change.type === \"decrease\" && \"text-error-600\",\n                  change.type === \"neutral\" && \"text-neutral-600\"\n                )}\n              >\n                {change.type === \"increase\" && \"‚Üó\"}\n                {change.type === \"decrease\" && \"‚Üò\"}\n                {change.value}\n              </span>\n            </div>\n          )}\n          {description && (\n            <p className=\"text-xs text-neutral-500\">{description}</p>\n          )}\n        </div>\n      </EnhancedCardContent>\n    </EnhancedCard>\n  )\n)\nStatsCard.displayName = \"StatsCard\"\n\n// Feature Card Component\ninterface FeatureCardProps extends EnhancedCardProps {\n  title: string\n  description: string\n  icon?: React.ReactNode\n  badge?: string\n  action?: React.ReactNode\n}\n\nconst FeatureCard = React.forwardRef<HTMLDivElement, FeatureCardProps>(\n  ({ title, description, icon, badge, action, className, ...props }, ref) => (\n    <EnhancedCard\n      ref={ref}\n      variant=\"gradient\"\n      className={cn(\"relative\", className)}\n      {...props}\n    >\n      <EnhancedCardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center gap-3\">\n            {icon && (\n              <div className=\"p-3 bg-accent-100 rounded-xl text-accent-600\">\n                {icon}\n              </div>\n            )}\n            <div>\n              <EnhancedCardTitle className=\"text-lg\">{title}</EnhancedCardTitle>\n              {badge && (\n                <span className=\"inline-block px-2 py-1 mt-1 text-xs font-medium bg-accent-100 text-accent-700 rounded-full\">\n                  {badge}\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      </EnhancedCardHeader>\n      \n      <EnhancedCardContent>\n        <EnhancedCardDescription className=\"text-base leading-relaxed\">\n          {description}\n        </EnhancedCardDescription>\n      </EnhancedCardContent>\n      \n      {action && (\n        <EnhancedCardFooter>\n          {action}\n        </EnhancedCardFooter>\n      )}\n    </EnhancedCard>\n  )\n)\nFeatureCard.displayName = \"FeatureCard\"\n\nexport {\n  EnhancedCard,\n  EnhancedCardHeader,\n  EnhancedCardFooter,\n  EnhancedCardTitle,\n  EnhancedCardDescription,\n  EnhancedCardContent,\n  StatsCard,\n  FeatureCard,\n  enhancedCardVariants,\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\enhanced-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\enhanced-input.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":364,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":364,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\nimport { motion, AnimatePresence } from \"framer-motion\"\r\nimport { Eye, EyeOff, Search, X } from \"lucide-react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst enhancedInputVariants = cva(\r\n  \"flex w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-neutral-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"border-neutral-200 focus:border-accent-500 hover:border-neutral-300\",\r\n        filled: \"bg-neutral-50 border-neutral-200 focus:bg-white focus:border-accent-500 hover:bg-neutral-100\",\r\n        outline: \"border-2 border-neutral-200 focus:border-accent-500 hover:border-neutral-300\",\r\n        ghost: \"border-transparent bg-neutral-50 focus:bg-white focus:border-accent-500 hover:bg-neutral-100\",\r\n        success: \"border-success-300 focus:border-success-500 focus:ring-success-500\",\r\n        warning: \"border-warning-300 focus:border-warning-500 focus:ring-warning-500\",\r\n        error: \"border-error-300 focus:border-error-500 focus:ring-error-500\",\r\n      },\r\n      size: {\r\n        sm: \"h-8 px-2 text-xs\",\r\n        default: \"h-10 px-3\",\r\n        lg: \"h-12 px-4 text-base\",\r\n        xl: \"h-14 px-5 text-lg\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface EnhancedInputProps\r\n  extends React.InputHTMLAttributes<HTMLInputElement>,\r\n    VariantProps<typeof enhancedInputVariants> {\r\n  label?: string\r\n  helperText?: string\r\n  error?: string\r\n  leftIcon?: React.ReactNode\r\n  rightIcon?: React.ReactNode\r\n  floating?: boolean\r\n  clearable?: boolean\r\n  onClear?: () => void\r\n}\r\n\r\nconst EnhancedInput = React.forwardRef<HTMLInputElement, EnhancedInputProps>(\r\n  ({\r\n    className,\r\n    variant,\r\n    size,\r\n    type,\r\n    label,\r\n    helperText,\r\n    error,\r\n    leftIcon,\r\n    rightIcon,\r\n    floating = false,\r\n    clearable = false,\r\n    onClear,\r\n    value,\r\n    placeholder,\r\n    ...props\r\n  }, ref) => {\r\n    const [isFocused, setIsFocused] = React.useState(false)\r\n    const [hasValue, setHasValue] = React.useState(Boolean(value))\r\n\r\n    React.useEffect(() => {\r\n      setHasValue(Boolean(value))\r\n    }, [value])\r\n\r\n    const handleClear = () => {\r\n      if (onClear) {\r\n        onClear()\r\n      }\r\n    }\r\n\r\n    const inputVariant = error ? \"error\" : variant\r\n\r\n    return (\r\n      <div className=\"space-y-2\">\r\n        <div className=\"relative\">\r\n          {/* Floating Label */}\r\n          {floating && label && (\r\n            <motion.label\r\n              className={cn(\r\n                \"absolute left-3 text-sm text-neutral-500 pointer-events-none transition-all duration-200\",\r\n                (isFocused || hasValue) \r\n                  ? \"top-2 text-xs text-accent-600 bg-white px-1 -translate-y-1/2\" \r\n                  : \"top-1/2 -translate-y-1/2\"\r\n              )}\r\n              animate={{\r\n                y: (isFocused || hasValue) ? -20 : 0,\r\n                scale: (isFocused || hasValue) ? 0.85 : 1,\r\n              }}\r\n              transition={{ duration: 0.2 }}\r\n            >\r\n              {label}\r\n            </motion.label>\r\n          )}\r\n\r\n          {/* Static Label */}\r\n          {!floating && label && (\r\n            <label className=\"block text-sm font-medium text-neutral-700 mb-1\">\r\n              {label}\r\n            </label>\r\n          )}\r\n\r\n          <div className=\"relative\">\r\n            {/* Left Icon */}\r\n            {leftIcon && (\r\n              <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400\">\r\n                {leftIcon}\r\n              </div>\r\n            )}\r\n\r\n            <input\r\n              type={type}\r\n              className={cn(\r\n                enhancedInputVariants({ variant: inputVariant, size, className }),\r\n                leftIcon && \"pl-10\",\r\n                (rightIcon || clearable) && \"pr-10\"\r\n              )}\r\n              ref={ref}\r\n              value={value}\r\n              placeholder={floating ? \"\" : placeholder}\r\n              onFocus={(e) => {\r\n                setIsFocused(true)\r\n                props.onFocus?.(e)\r\n              }}\r\n              onBlur={(e) => {\r\n                setIsFocused(false)\r\n                props.onBlur?.(e)\r\n              }}\r\n              {...props}\r\n            />\r\n\r\n            {/* Right Icon or Clear Button */}\r\n            <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n              {clearable && hasValue && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleClear}\r\n                  className=\"text-neutral-400 hover:text-neutral-600 transition-colors\"\r\n                >\r\n                  <X className=\"h-4 w-4\" />\r\n                </button>\r\n              )}\r\n              {rightIcon && (\r\n                <div className=\"text-neutral-400\">\r\n                  {rightIcon}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Helper Text or Error */}\r\n        <AnimatePresence>\r\n          {(helperText || error) && (\r\n            <motion.p\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n              className={cn(\r\n                \"text-xs\",\r\n                error ? \"text-error-600\" : \"text-neutral-500\"\r\n              )}\r\n            >\r\n              {error || helperText}\r\n            </motion.p>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    )\r\n  }\r\n)\r\nEnhancedInput.displayName = \"EnhancedInput\"\r\n\r\n// Search Input Component\r\ninterface SearchInputProps extends Omit<EnhancedInputProps, 'leftIcon' | 'type'> {\r\n  onSearch?: (value: string) => void\r\n}\r\n\r\nconst SearchInput = React.forwardRef<HTMLInputElement, SearchInputProps>(\r\n  ({ onSearch, onChange, ...props }, ref) => {\r\n    const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      onChange?.(e)\r\n      onSearch?.(e.target.value)\r\n    }\r\n\r\n    return (\r\n      <EnhancedInput\r\n        ref={ref}\r\n        type=\"search\"\r\n        leftIcon={<Search className=\"h-4 w-4\" />}\r\n        placeholder=\"Search...\"\r\n        clearable\r\n        onChange={handleChange}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nSearchInput.displayName = \"SearchInput\"\r\n\r\n// Password Input Component\r\nconst PasswordInput = React.forwardRef<HTMLInputElement, Omit<EnhancedInputProps, 'type' | 'rightIcon'>>(\r\n  ({ ...props }, ref) => {\r\n    const [showPassword, setShowPassword] = React.useState(false)\r\n\r\n    return (\r\n      <EnhancedInput\r\n        ref={ref}\r\n        type={showPassword ? \"text\" : \"password\"}\r\n        rightIcon={\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setShowPassword(!showPassword)}\r\n            className=\"text-neutral-400 hover:text-neutral-600 transition-colors\"\r\n          >\r\n            {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n          </button>\r\n        }\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nPasswordInput.displayName = \"PasswordInput\"\r\n\r\n// Number Input Component\r\ninterface NumberInputProps extends Omit<EnhancedInputProps, 'type'> {\r\n  min?: number\r\n  max?: number\r\n  step?: number\r\n}\r\n\r\nconst NumberInput = React.forwardRef<HTMLInputElement, NumberInputProps>(\r\n  ({ min, max, step = 1, ...props }, ref) => (\r\n    <EnhancedInput\r\n      ref={ref}\r\n      type=\"number\"\r\n      min={min}\r\n      max={max}\r\n      step={step}\r\n      {...props}\r\n    />\r\n  )\r\n)\r\nNumberInput.displayName = \"NumberInput\"\r\n\r\n// Textarea Component\r\ninterface EnhancedTextareaProps\r\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement>,\r\n    VariantProps<typeof enhancedInputVariants> {\r\n  label?: string\r\n  helperText?: string\r\n  error?: string\r\n  floating?: boolean\r\n  resize?: boolean\r\n}\r\n\r\nconst EnhancedTextarea = React.forwardRef<HTMLTextAreaElement, EnhancedTextareaProps>(\r\n  ({\r\n    className,\r\n    variant,\r\n    label,\r\n    helperText,\r\n    error,\r\n    floating = false,\r\n    resize = true,\r\n    value,\r\n    placeholder,\r\n    ...props\r\n  }, ref) => {\r\n    const [isFocused, setIsFocused] = React.useState(false)\r\n    const [hasValue, setHasValue] = React.useState(Boolean(value))\r\n\r\n    React.useEffect(() => {\r\n      setHasValue(Boolean(value))\r\n    }, [value])\r\n\r\n    const textareaVariant = error ? \"error\" : variant\r\n\r\n    return (\r\n      <div className=\"space-y-2\">\r\n        <div className=\"relative\">\r\n          {/* Floating Label */}\r\n          {floating && label && (\r\n            <motion.label\r\n              className={cn(\r\n                \"absolute left-3 text-sm text-neutral-500 pointer-events-none transition-all duration-200\",\r\n                (isFocused || hasValue) \r\n                  ? \"top-2 text-xs text-accent-600 bg-white px-1\" \r\n                  : \"top-3\"\r\n              )}\r\n              animate={{\r\n                y: (isFocused || hasValue) ? -10 : 0,\r\n                scale: (isFocused || hasValue) ? 0.85 : 1,\r\n              }}\r\n              transition={{ duration: 0.2 }}\r\n            >\r\n              {label}\r\n            </motion.label>\r\n          )}\r\n\r\n          {/* Static Label */}\r\n          {!floating && label && (\r\n            <label className=\"block text-sm font-medium text-neutral-700 mb-1\">\r\n              {label}\r\n            </label>\r\n          )}\r\n\r\n          <textarea\r\n            className={cn(\r\n              enhancedInputVariants({ variant: textareaVariant, className }),\r\n              \"min-h-[80px] py-3\",\r\n              !resize && \"resize-none\"\r\n            )}\r\n            ref={ref}\r\n            value={value}\r\n            placeholder={floating ? \"\" : placeholder}\r\n            onFocus={(e) => {\r\n              setIsFocused(true)\r\n              props.onFocus?.(e)\r\n            }}\r\n            onBlur={(e) => {\r\n              setIsFocused(false)\r\n              props.onBlur?.(e)\r\n            }}\r\n            {...props}\r\n          />\r\n        </div>\r\n\r\n        {/* Helper Text or Error */}\r\n        <AnimatePresence>\r\n          {(helperText || error) && (\r\n            <motion.p\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n              className={cn(\r\n                \"text-xs\",\r\n                error ? \"text-error-600\" : \"text-neutral-500\"\r\n              )}\r\n            >\r\n              {error || helperText}\r\n            </motion.p>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    )\r\n  }\r\n)\r\nEnhancedTextarea.displayName = \"EnhancedTextarea\"\r\n\r\nexport {\r\n  EnhancedInput,\r\n  SearchInput,\r\n  PasswordInput,\r\n  NumberInput,\r\n  EnhancedTextarea,\r\n  enhancedInputVariants,\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\enhanced-modal.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":353,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":353,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X, Maximize2, Minimize2 } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"./button\"\nimport { EnhancedButton } from \"./enhanced-button\"\n\nconst enhancedModalVariants = cva(\n  \"fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 sm:rounded-lg\",\n  {\n    variants: {\n      size: {\n        sm: \"max-w-sm\",\n        default: \"max-w-lg\",\n        lg: \"max-w-2xl\",\n        xl: \"max-w-4xl\",\n        \"2xl\": \"max-w-6xl\",\n        full: \"max-w-[95vw] max-h-[95vh]\",\n      },\n      variant: {\n        default: \"border-neutral-200 bg-white shadow-xl\",\n        glass: \"border-white/20 bg-white/95 backdrop-blur-xl shadow-2xl\",\n        modern: \"border-neutral-200 bg-gradient-to-br from-white to-neutral-50 shadow-2xl\",\n        dark: \"border-neutral-800 bg-neutral-900 text-white shadow-2xl\",\n      },\n    },\n    defaultVariants: {\n      size: \"default\",\n      variant: \"default\",\n    },\n  }\n)\n\ninterface EnhancedModalProps\n  extends React.ComponentPropsWithoutRef<typeof DialogPrimitive.Root>,\n    VariantProps<typeof enhancedModalVariants> {\n  title?: string\n  description?: string\n  children?: React.ReactNode\n  trigger?: React.ReactNode\n  footer?: React.ReactNode\n  closable?: boolean\n  maximizable?: boolean\n  onClose?: () => void\n  className?: string\n}\n\nconst EnhancedModal: React.FC<EnhancedModalProps> = ({\n  title,\n  description,\n  children,\n  trigger,\n  footer,\n  size,\n  variant,\n  closable = true,\n  maximizable = false,\n  onClose,\n  className,\n  ...props\n}) => {\n  const [isMaximized, setIsMaximized] = React.useState(false)\n\n  const modalVariants = {\n    hidden: {\n      opacity: 0,\n      scale: 0.95,\n      y: 20,\n    },\n    visible: {\n      opacity: 1,\n      scale: 1,\n      y: 0,\n      transition: {\n        type: \"spring\",\n        stiffness: 300,\n        damping: 30,\n      },\n    },\n    exit: {\n      opacity: 0,\n      scale: 0.95,\n      y: 20,\n      transition: {\n        duration: 0.2,\n      },\n    },\n  }\n\n  const overlayVariants = {\n    hidden: { opacity: 0 },\n    visible: { opacity: 1 },\n    exit: { opacity: 0 },\n  }\n\n  return (\n    <DialogPrimitive.Root {...props}>\n      {trigger && (\n        <DialogPrimitive.Trigger asChild>\n          {trigger}\n        </DialogPrimitive.Trigger>\n      )}\n      \n      <AnimatePresence>\n        <DialogPrimitive.Portal>\n          <DialogPrimitive.Overlay asChild>\n            <motion.div\n              className=\"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm\"\n              variants={overlayVariants}\n              initial=\"hidden\"\n              animate=\"visible\"\n              exit=\"exit\"\n            />\n          </DialogPrimitive.Overlay>\n          \n          <DialogPrimitive.Content asChild>\n            <motion.div\n              className={cn(\n                enhancedModalVariants({ \n                  size: isMaximized ? \"full\" : size, \n                  variant, \n                  className \n                })\n              )}\n              variants={modalVariants}\n              initial=\"hidden\"\n              animate=\"visible\"\n              exit=\"exit\"\n            >\n              {/* Header */}\n              {(title || description || closable || maximizable) && (\n                <div className=\"flex items-start justify-between border-b border-neutral-200 pb-4\">\n                  <div className=\"flex-1\">\n                    {title && (\n                      <DialogPrimitive.Title className=\"text-lg font-semibold text-neutral-900\">\n                        {title}\n                      </DialogPrimitive.Title>\n                    )}\n                    {description && (\n                      <DialogPrimitive.Description className=\"text-sm text-neutral-600 mt-1\">\n                        {description}\n                      </DialogPrimitive.Description>\n                    )}\n                  </div>\n                  \n                  <div className=\"flex items-center gap-1 ml-4\">\n                    {maximizable && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8\"\n                        onClick={() => setIsMaximized(!isMaximized)}\n                      >\n                        {isMaximized ? (\n                          <Minimize2 className=\"h-4 w-4\" />\n                        ) : (\n                          <Maximize2 className=\"h-4 w-4\" />\n                        )}\n                      </Button>\n                    )}\n                    \n                    {closable && (\n                      <DialogPrimitive.Close asChild>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8\"\n                          onClick={onClose}\n                        >\n                          <X className=\"h-4 w-4\" />\n                          <span className=\"sr-only\">Close</span>\n                        </Button>\n                      </DialogPrimitive.Close>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {/* Content */}\n              <div className=\"flex-1 overflow-y-auto\">\n                {children}\n              </div>\n\n              {/* Footer */}\n              {footer && (\n                <div className=\"flex items-center justify-end gap-2 border-t border-neutral-200 pt-4\">\n                  {footer}\n                </div>\n              )}\n            </motion.div>\n          </DialogPrimitive.Content>\n        </DialogPrimitive.Portal>\n      </AnimatePresence>\n    </DialogPrimitive.Root>\n  )\n}\n\n// Confirmation Modal\ninterface ConfirmationModalProps {\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n  title: string\n  description: string\n  confirmText?: string\n  cancelText?: string\n  onConfirm: () => void\n  onCancel?: () => void\n  variant?: \"default\" | \"destructive\"\n  loading?: boolean\n}\n\nconst ConfirmationModal: React.FC<ConfirmationModalProps> = ({\n  open,\n  onOpenChange,\n  title,\n  description,\n  confirmText = \"Confirm\",\n  cancelText = \"Cancel\",\n  onConfirm,\n  onCancel,\n  variant = \"default\",\n  loading = false,\n}) => {\n  return (\n    <EnhancedModal\n      open={open}\n      onOpenChange={onOpenChange}\n      title={title}\n      description={description}\n      size=\"sm\"\n      footer={\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => {\n              onCancel?.()\n              onOpenChange?.(false)\n            }}\n            disabled={loading}\n          >\n            {cancelText}\n          </Button>\n          <EnhancedButton\n            variant={variant === \"destructive\" ? \"destructive\" : \"default\"}\n            onClick={onConfirm}\n            loading={loading}\n          >\n            {confirmText}\n          </EnhancedButton>\n        </div>\n      }\n    />\n  )\n}\n\n// Form Modal\ninterface FormModalProps {\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n  title: string\n  description?: string\n  children: React.ReactNode\n  submitText?: string\n  cancelText?: string\n  onSubmit?: () => void\n  onCancel?: () => void\n  loading?: boolean\n  size?: \"sm\" | \"default\" | \"lg\" | \"xl\" | \"2xl\"\n}\n\nconst FormModal: React.FC<FormModalProps> = ({\n  open,\n  onOpenChange,\n  title,\n  description,\n  children,\n  submitText = \"Save\",\n  cancelText = \"Cancel\",\n  onSubmit,\n  onCancel,\n  loading = false,\n  size = \"default\",\n}) => {\n  return (\n    <EnhancedModal\n      open={open}\n      onOpenChange={onOpenChange}\n      title={title}\n      description={description}\n      size={size}\n      variant=\"modern\"\n      maximizable\n      footer={\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => {\n              onCancel?.()\n              onOpenChange?.(false)\n            }}\n            disabled={loading}\n          >\n            {cancelText}\n          </Button>\n          <EnhancedButton\n            onClick={onSubmit}\n            loading={loading}\n            variant=\"gradient\"\n          >\n            {submitText}\n          </EnhancedButton>\n        </div>\n      }\n    >\n      {children}\n    </EnhancedModal>\n  )\n}\n\n// Quick Action Modal\ninterface QuickActionModalProps {\n  trigger: React.ReactNode\n  title: string\n  children: React.ReactNode\n  size?: \"sm\" | \"default\" | \"lg\"\n}\n\nconst QuickActionModal: React.FC<QuickActionModalProps> = ({\n  trigger,\n  title,\n  children,\n  size = \"sm\",\n}) => {\n  return (\n    <EnhancedModal\n      trigger={trigger}\n      title={title}\n      size={size}\n      variant=\"glass\"\n    >\n      {children}\n    </EnhancedModal>\n  )\n}\n\nexport {\n  EnhancedModal,\n  ConfirmationModal,\n  FormModal,\n  QuickActionModal,\n  enhancedModalVariants,\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\enhanced-sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":17,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":17,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { ChevronDown, ChevronRight, Menu, X } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"./button\"\n\ninterface SidebarContextType {\n  isCollapsed: boolean\n  setIsCollapsed: (collapsed: boolean) => void\n  isMobile: boolean\n  isOpen: boolean\n  setIsOpen: (open: boolean) => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextType | undefined>(undefined)\n\nexport const useSidebar = () => {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider\")\n  }\n  return context\n}\n\ninterface SidebarProviderProps {\n  children: React.ReactNode\n  defaultCollapsed?: boolean\n  defaultOpen?: boolean\n}\n\nexport const SidebarProvider: React.FC<SidebarProviderProps> = ({\n  children,\n  defaultCollapsed = false,\n  defaultOpen = false,\n}) => {\n  const [isCollapsed, setIsCollapsed] = React.useState(defaultCollapsed)\n  const [isOpen, setIsOpen] = React.useState(defaultOpen)\n  const [isMobile, setIsMobile] = React.useState(false)\n\n  React.useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < 1024)\n    }\n    \n    checkMobile()\n    window.addEventListener('resize', checkMobile)\n    return () => window.removeEventListener('resize', checkMobile)\n  }, [])\n\n  const value = {\n    isCollapsed,\n    setIsCollapsed,\n    isMobile,\n    isOpen,\n    setIsOpen,\n  }\n\n  return (\n    <SidebarContext.Provider value={value}>\n      {children}\n    </SidebarContext.Provider>\n  )\n}\n\ninterface EnhancedSidebarProps {\n  children: React.ReactNode\n  className?: string\n  logo?: React.ReactNode\n  footer?: React.ReactNode\n}\n\nexport const EnhancedSidebar: React.FC<EnhancedSidebarProps> = ({\n  children,\n  className,\n  logo,\n  footer,\n}) => {\n  const { isCollapsed, setIsCollapsed, isMobile, isOpen, setIsOpen } = useSidebar()\n\n  const sidebarVariants = {\n    expanded: {\n      width: isMobile ? \"100%\" : \"280px\",\n      transition: { type: \"spring\", stiffness: 300, damping: 30 }\n    },\n    collapsed: {\n      width: isMobile ? \"0px\" : \"80px\",\n      transition: { type: \"spring\", stiffness: 300, damping: 30 }\n    }\n  }\n\n  const contentVariants = {\n    expanded: {\n      opacity: 1,\n      x: 0,\n      transition: { delay: 0.1, duration: 0.2 }\n    },\n    collapsed: {\n      opacity: isCollapsed ? 0 : 1,\n      x: isCollapsed ? -20 : 0,\n      transition: { duration: 0.2 }\n    }\n  }\n\n  return (\n    <>\n      {/* Mobile Overlay */}\n      <AnimatePresence>\n        {isMobile && isOpen && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black/50 z-40 lg:hidden\"\n            onClick={() => setIsOpen(false)}\n          />\n        )}\n      </AnimatePresence>\n\n      {/* Sidebar */}\n      <motion.aside\n        variants={sidebarVariants}\n        animate={isMobile ? (isOpen ? \"expanded\" : \"collapsed\") : (isCollapsed ? \"collapsed\" : \"expanded\")}\n        className={cn(\n          \"fixed left-0 top-0 z-50 h-full bg-white border-r border-neutral-200 shadow-lg lg:relative lg:z-auto\",\n          \"flex flex-col overflow-hidden\",\n          className\n        )}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-neutral-200\">\n          <motion.div\n            variants={contentVariants}\n            animate={isCollapsed ? \"collapsed\" : \"expanded\"}\n            className=\"flex items-center gap-3\"\n          >\n            {logo}\n            {!isCollapsed && (\n              <motion.span\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"font-semibold text-lg text-neutral-900\"\n              >\n                CRM Portal\n              </motion.span>\n            )}\n          </motion.div>\n\n          {/* Toggle Button */}\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => {\n              if (isMobile) {\n                setIsOpen(!isOpen)\n              } else {\n                setIsCollapsed(!isCollapsed)\n              }\n            }}\n            className=\"h-8 w-8\"\n          >\n            {isMobile ? (\n              isOpen ? <X className=\"h-4 w-4\" /> : <Menu className=\"h-4 w-4\" />\n            ) : (\n              <Menu className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </div>\n\n        {/* Navigation Content */}\n        <div className=\"flex-1 overflow-y-auto p-4\">\n          <motion.div\n            variants={contentVariants}\n            animate={isCollapsed ? \"collapsed\" : \"expanded\"}\n          >\n            {children}\n          </motion.div>\n        </div>\n\n        {/* Footer */}\n        {footer && (\n          <div className=\"border-t border-neutral-200 p-4\">\n            <motion.div\n              variants={contentVariants}\n              animate={isCollapsed ? \"collapsed\" : \"expanded\"}\n            >\n              {footer}\n            </motion.div>\n          </div>\n        )}\n      </motion.aside>\n    </>\n  )\n}\n\ninterface SidebarSectionProps {\n  title?: string\n  children: React.ReactNode\n  collapsible?: boolean\n  defaultExpanded?: boolean\n}\n\nexport const SidebarSection: React.FC<SidebarSectionProps> = ({\n  title,\n  children,\n  collapsible = false,\n  defaultExpanded = true,\n}) => {\n  const [isExpanded, setIsExpanded] = React.useState(defaultExpanded)\n  const { isCollapsed } = useSidebar()\n\n  return (\n    <div className=\"space-y-2\">\n      {title && !isCollapsed && (\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-xs font-semibold text-neutral-500 uppercase tracking-wider px-2\">\n            {title}\n          </h3>\n          {collapsible && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setIsExpanded(!isExpanded)}\n              className=\"h-6 w-6\"\n            >\n              {isExpanded ? (\n                <ChevronDown className=\"h-3 w-3\" />\n              ) : (\n                <ChevronRight className=\"h-3 w-3\" />\n              )}\n            </Button>\n          )}\n        </div>\n      )}\n\n      <AnimatePresence>\n        {(!collapsible || isExpanded) && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"space-y-1\"\n          >\n            {children}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n\ninterface SidebarItemProps {\n  icon?: React.ReactNode\n  children: React.ReactNode\n  active?: boolean\n  onClick?: () => void\n  badge?: string | number\n  className?: string\n}\n\nexport const SidebarItem: React.FC<SidebarItemProps> = ({\n  icon,\n  children,\n  active = false,\n  onClick,\n  badge,\n  className,\n}) => {\n  const { isCollapsed } = useSidebar()\n\n  return (\n    <motion.button\n      whileHover={{ x: 2 }}\n      whileTap={{ scale: 0.98 }}\n      onClick={onClick}\n      className={cn(\n        \"w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-all duration-200\",\n        \"hover:bg-accent-50 hover:text-accent-700 focus:outline-none focus:ring-2 focus:ring-accent-500 focus:ring-offset-2\",\n        active\n          ? \"bg-accent-100 text-accent-700 shadow-sm\"\n          : \"text-neutral-700 hover:text-neutral-900\",\n        className\n      )}\n    >\n      {icon && (\n        <div className={cn(\"flex-shrink-0\", active ? \"text-accent-600\" : \"text-neutral-500\")}>\n          {icon}\n        </div>\n      )}\n\n      <AnimatePresence>\n        {!isCollapsed && (\n          <motion.div\n            initial={{ opacity: 0, x: -10 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -10 }}\n            transition={{ duration: 0.2 }}\n            className=\"flex-1 text-left truncate\"\n          >\n            {children}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {badge && !isCollapsed && (\n        <motion.span\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          className=\"flex-shrink-0 px-2 py-1 text-xs font-medium bg-accent-100 text-accent-700 rounded-full\"\n        >\n          {badge}\n        </motion.span>\n      )}\n    </motion.button>\n  )\n}\n\ninterface SidebarSubItemProps {\n  children: React.ReactNode\n  active?: boolean\n  onClick?: () => void\n  className?: string\n}\n\nexport const SidebarSubItem: React.FC<SidebarSubItemProps> = ({\n  children,\n  active = false,\n  onClick,\n  className,\n}) => {\n  const { isCollapsed } = useSidebar()\n\n  if (isCollapsed) return null\n\n  return (\n    <motion.button\n      whileHover={{ x: 4 }}\n      whileTap={{ scale: 0.98 }}\n      onClick={onClick}\n      className={cn(\n        \"w-full flex items-center gap-3 pl-9 pr-3 py-1.5 text-sm font-normal rounded-md transition-all duration-200\",\n        \"hover:bg-accent-50 hover:text-accent-700 focus:outline-none focus:ring-2 focus:ring-accent-500 focus:ring-offset-2\",\n        active\n          ? \"bg-accent-50 text-accent-700\"\n          : \"text-neutral-600 hover:text-neutral-800\",\n        className\n      )}\n    >\n      <div className=\"w-1 h-1 bg-current rounded-full opacity-50\" />\n      <span className=\"truncate\">{children}</span>\n    </motion.button>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\enhanced-tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":168,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":168,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport {\r\n  Controller,\r\n  ControllerProps,\r\n  FieldPath,\r\n  FieldValues,\r\n  FormProvider,\r\n  useFormContext,\r\n} from \"react-hook-form\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Label } from \"@/components/ui/label\"\r\n\r\nconst Form = FormProvider\r\n\r\ntype FormFieldContextValue<\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\r\n> = {\r\n  name: TName\r\n}\r\n\r\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\r\n  {} as FormFieldContextValue\r\n)\r\n\r\nconst FormField = <\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\r\n>({\r\n  ...props\r\n}: ControllerProps<TFieldValues, TName>) => {\r\n  return (\r\n    <FormFieldContext.Provider value={{ name: props.name }}>\r\n      <Controller {...props} />\r\n    </FormFieldContext.Provider>\r\n  )\r\n}\r\n\r\nconst useFormField = () => {\r\n  const fieldContext = React.useContext(FormFieldContext)\r\n  const itemContext = React.useContext(FormItemContext)\r\n  const { getFieldState, formState } = useFormContext()\r\n\r\n  const fieldState = getFieldState(fieldContext.name, formState)\r\n\r\n  if (!fieldContext) {\r\n    throw new Error(\"useFormField should be used within <FormField>\")\r\n  }\r\n\r\n  const { id } = itemContext\r\n\r\n  return {\r\n    id,\r\n    name: fieldContext.name,\r\n    formItemId: `${id}-form-item`,\r\n    formDescriptionId: `${id}-form-item-description`,\r\n    formMessageId: `${id}-form-item-message`,\r\n    ...fieldState,\r\n  }\r\n}\r\n\r\ntype FormItemContextValue = {\r\n  id: string\r\n}\r\n\r\nconst FormItemContext = React.createContext<FormItemContextValue>(\r\n  {} as FormItemContextValue\r\n)\r\n\r\nconst FormItem = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => {\r\n  const id = React.useId()\r\n\r\n  return (\r\n    <FormItemContext.Provider value={{ id }}>\r\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\r\n    </FormItemContext.Provider>\r\n  )\r\n})\r\nFormItem.displayName = \"FormItem\"\r\n\r\nconst FormLabel = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\r\n>(({ className, ...props }, ref) => {\r\n  const { error, formItemId } = useFormField()\r\n\r\n  return (\r\n    <Label\r\n      ref={ref}\r\n      className={cn(error && \"text-destructive\", className)}\r\n      htmlFor={formItemId}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormLabel.displayName = \"FormLabel\"\r\n\r\nconst FormControl = React.forwardRef<\r\n  React.ElementRef<typeof Slot>,\r\n  React.ComponentPropsWithoutRef<typeof Slot>\r\n>(({ ...props }, ref) => {\r\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\r\n\r\n  return (\r\n    <Slot\r\n      ref={ref}\r\n      id={formItemId}\r\n      aria-describedby={\r\n        !error\r\n          ? `${formDescriptionId}`\r\n          : `${formDescriptionId} ${formMessageId}`\r\n      }\r\n      aria-invalid={!!error}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormControl.displayName = \"FormControl\"\r\n\r\nconst FormDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => {\r\n  const { formDescriptionId } = useFormField()\r\n\r\n  return (\r\n    <p\r\n      ref={ref}\r\n      id={formDescriptionId}\r\n      className={cn(\"text-sm text-muted-foreground\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormDescription.displayName = \"FormDescription\"\r\n\r\nconst FormMessage = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, children, ...props }, ref) => {\r\n  const { error, formMessageId } = useFormField()\r\n  const body = error ? String(error?.message) : children\r\n\r\n  if (!body) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <p\r\n      ref={ref}\r\n      id={formMessageId}\r\n      className={cn(\"text-sm font-medium text-destructive\", className)}\r\n      {...props}\r\n    >\r\n      {body}\r\n    </p>\r\n  )\r\n})\r\nFormMessage.displayName = \"FormMessage\"\r\n\r\nexport {\r\n  useFormField,\r\n  Form,\r\n  FormItem,\r\n  FormLabel,\r\n  FormControl,\r\n  FormDescription,\r\n  FormMessage,\r\n  FormField,\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\label.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":44,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":44,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst labelVariants = cva(\r\n  \"text-sm font-semibold leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50 text-slate-800\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"text-slate-800\",\r\n        glass: \"text-white font-bold\",\r\n        muted: \"text-slate-600 font-medium\",\r\n        required: \"text-slate-800 after:content-['*'] after:text-red-500 after:ml-1\",\r\n        \"glass-required\": \"text-white font-bold after:content-['*'] after:text-red-300 after:ml-1\",\r\n      },\r\n      size: {\r\n        default: \"text-sm\",\r\n        sm: \"text-xs\",\r\n        lg: \"text-base font-bold\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nconst Label = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\r\n    VariantProps<typeof labelVariants>\r\n>(({ className, variant, size, ...props }, ref) => (\r\n  <LabelPrimitive.Root\r\n    ref={ref}\r\n    className={cn(labelVariants({ variant, size }), className)}\r\n    {...props}\r\n  />\r\n))\r\nLabel.displayName = LabelPrimitive.Root.displayName\r\n\r\nexport { Label, labelVariants }","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\mobile-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\mobile-nav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\monday-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\r\nimport { cva } from \"class-variance-authority\"\r\nimport { ChevronDown } from \"lucide-react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst NavigationMenu = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <NavigationMenuViewport />\r\n  </NavigationMenuPrimitive.Root>\r\n))\r\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\r\n\r\nconst NavigationMenuList = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\r\n\r\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\r\n\r\nconst navigationMenuTriggerStyle = cva(\r\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\r\n)\r\n\r\nconst NavigationMenuTrigger = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\r\n    {...props}\r\n  >\r\n    {children}{\" \"}\r\n    <ChevronDown\r\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\r\n      aria-hidden=\"true\"\r\n    />\r\n  </NavigationMenuPrimitive.Trigger>\r\n))\r\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\r\n\r\nconst NavigationMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\r\n\r\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\r\n\r\nconst NavigationMenuViewport = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\r\n>(({ className, ...props }, ref) => (\r\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\r\n    <NavigationMenuPrimitive.Viewport\r\n      className={cn(\r\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\r\n        className\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  </div>\r\n))\r\nNavigationMenuViewport.displayName =\r\n  NavigationMenuPrimitive.Viewport.displayName\r\n\r\nconst NavigationMenuIndicator = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Indicator\r\n    ref={ref}\r\n    className={cn(\r\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\r\n  </NavigationMenuPrimitive.Indicator>\r\n))\r\nNavigationMenuIndicator.displayName =\r\n  NavigationMenuPrimitive.Indicator.displayName\r\n\r\nexport {\r\n  navigationMenuTriggerStyle,\r\n  NavigationMenu,\r\n  NavigationMenuList,\r\n  NavigationMenuItem,\r\n  NavigationMenuContent,\r\n  NavigationMenuTrigger,\r\n  NavigationMenuLink,\r\n  NavigationMenuIndicator,\r\n  NavigationMenuViewport,\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\responsive-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":760,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":760,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { VariantProps, cva } from \"class-variance-authority\"\r\nimport { PanelLeft } from \"lucide-react\"\r\n\r\nimport { useIsMobile } from \"@/hooks/use-mobile\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Separator } from \"@/components/ui/separator\"\r\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\r\nimport { Skeleton } from \"@/components/ui/skeleton\"\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\"\r\n\r\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\r\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\r\nconst SIDEBAR_WIDTH = \"16rem\"\r\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\r\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\r\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\r\n\r\ntype SidebarContext = {\r\n  state: \"expanded\" | \"collapsed\"\r\n  open: boolean\r\n  setOpen: (open: boolean) => void\r\n  openMobile: boolean\r\n  setOpenMobile: (open: boolean) => void\r\n  isMobile: boolean\r\n  toggleSidebar: () => void\r\n}\r\n\r\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\r\n\r\nfunction useSidebar() {\r\n  const context = React.useContext(SidebarContext)\r\n  if (!context) {\r\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\r\n  }\r\n\r\n  return context\r\n}\r\n\r\nconst SidebarProvider = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    defaultOpen?: boolean\r\n    open?: boolean\r\n    onOpenChange?: (open: boolean) => void\r\n  }\r\n>(\r\n  (\r\n    {\r\n      defaultOpen = true,\r\n      open: openProp,\r\n      onOpenChange: setOpenProp,\r\n      className,\r\n      style,\r\n      children,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    const isMobile = useIsMobile()\r\n    const [openMobile, setOpenMobile] = React.useState(false)\r\n\r\n    // This is the internal state of the sidebar.\r\n    // We use openProp and setOpenProp for control from outside the component.\r\n    const [_open, _setOpen] = React.useState(defaultOpen)\r\n    const open = openProp ?? _open\r\n    const setOpen = React.useCallback(\r\n      (value: boolean | ((value: boolean) => boolean)) => {\r\n        const openState = typeof value === \"function\" ? value(open) : value\r\n        if (setOpenProp) {\r\n          setOpenProp(openState)\r\n        } else {\r\n          _setOpen(openState)\r\n        }\r\n\r\n        // This sets the cookie to keep the sidebar state.\r\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\r\n      },\r\n      [setOpenProp, open]\r\n    )\r\n\r\n    // Helper to toggle the sidebar.\r\n    const toggleSidebar = React.useCallback(() => {\r\n      return isMobile\r\n        ? setOpenMobile((open) => !open)\r\n        : setOpen((open) => !open)\r\n    }, [isMobile, setOpen, setOpenMobile])\r\n\r\n    // Adds a keyboard shortcut to toggle the sidebar.\r\n    React.useEffect(() => {\r\n      const handleKeyDown = (event: KeyboardEvent) => {\r\n        if (\r\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\r\n          (event.metaKey || event.ctrlKey)\r\n        ) {\r\n          event.preventDefault()\r\n          toggleSidebar()\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\"keydown\", handleKeyDown)\r\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\r\n    }, [toggleSidebar])\r\n\r\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\r\n    // This makes it easier to style the sidebar with Tailwind classes.\r\n    const state = open ? \"expanded\" : \"collapsed\"\r\n\r\n    const contextValue = React.useMemo<SidebarContext>(\r\n      () => ({\r\n        state,\r\n        open,\r\n        setOpen,\r\n        isMobile,\r\n        openMobile,\r\n        setOpenMobile,\r\n        toggleSidebar,\r\n      }),\r\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\r\n    )\r\n\r\n    return (\r\n      <SidebarContext.Provider value={contextValue}>\r\n        <TooltipProvider delayDuration={0}>\r\n          <div\r\n            style={\r\n              {\r\n                \"--sidebar-width\": SIDEBAR_WIDTH,\r\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\r\n                ...style,\r\n              } as React.CSSProperties\r\n            }\r\n            className={cn(\r\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\r\n              className\r\n            )}\r\n            ref={ref}\r\n            {...props}\r\n          >\r\n            {children}\r\n          </div>\r\n        </TooltipProvider>\r\n      </SidebarContext.Provider>\r\n    )\r\n  }\r\n)\r\nSidebarProvider.displayName = \"SidebarProvider\"\r\n\r\nconst Sidebar = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    side?: \"left\" | \"right\"\r\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\r\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\r\n  }\r\n>(\r\n  (\r\n    {\r\n      side = \"left\",\r\n      variant = \"sidebar\",\r\n      collapsible = \"offcanvas\",\r\n      className,\r\n      children,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\r\n\r\n    if (collapsible === \"none\") {\r\n      return (\r\n        <div\r\n          className={cn(\r\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\r\n            className\r\n          )}\r\n          ref={ref}\r\n          {...props}\r\n        >\r\n          {children}\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (isMobile) {\r\n      return (\r\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\r\n          <SheetContent\r\n            data-sidebar=\"sidebar\"\r\n            data-mobile=\"true\"\r\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\r\n            style={\r\n              {\r\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\r\n              } as React.CSSProperties\r\n            }\r\n            side={side}\r\n          >\r\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\r\n          </SheetContent>\r\n        </Sheet>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className=\"group peer hidden md:block text-sidebar-foreground\"\r\n        data-state={state}\r\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\r\n        data-variant={variant}\r\n        data-side={side}\r\n      >\r\n        {/* This is what handles the sidebar gap on desktop */}\r\n        <div\r\n          className={cn(\r\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\r\n            \"group-data-[collapsible=offcanvas]:w-0\",\r\n            \"group-data-[side=right]:rotate-180\",\r\n            variant === \"floating\" || variant === \"inset\"\r\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\r\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\r\n          )}\r\n        />\r\n        <div\r\n          className={cn(\r\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\r\n            side === \"left\"\r\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\r\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\r\n            // Adjust the padding for floating and inset variants.\r\n            variant === \"floating\" || variant === \"inset\"\r\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\r\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\r\n            className\r\n          )}\r\n          {...props}\r\n        >\r\n          <div\r\n            data-sidebar=\"sidebar\"\r\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\r\n          >\r\n            {children}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n)\r\nSidebar.displayName = \"Sidebar\"\r\n\r\nconst SidebarTrigger = React.forwardRef<\r\n  React.ElementRef<typeof Button>,\r\n  React.ComponentProps<typeof Button>\r\n>(({ className, onClick, ...props }, ref) => {\r\n  const { toggleSidebar } = useSidebar()\r\n\r\n  return (\r\n    <Button\r\n      ref={ref}\r\n      data-sidebar=\"trigger\"\r\n      variant=\"ghost\"\r\n      size=\"icon\"\r\n      className={cn(\"h-7 w-7\", className)}\r\n      onClick={(event) => {\r\n        onClick?.(event)\r\n        toggleSidebar()\r\n      }}\r\n      {...props}\r\n    >\r\n      <PanelLeft />\r\n      <span className=\"sr-only\">Toggle Sidebar</span>\r\n    </Button>\r\n  )\r\n})\r\nSidebarTrigger.displayName = \"SidebarTrigger\"\r\n\r\nconst SidebarRail = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\">\r\n>(({ className, ...props }, ref) => {\r\n  const { toggleSidebar } = useSidebar()\r\n\r\n  return (\r\n    <button\r\n      ref={ref}\r\n      data-sidebar=\"rail\"\r\n      aria-label=\"Toggle Sidebar\"\r\n      tabIndex={-1}\r\n      onClick={toggleSidebar}\r\n      title=\"Toggle Sidebar\"\r\n      className={cn(\r\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\r\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\r\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\r\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\r\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\r\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarRail.displayName = \"SidebarRail\"\r\n\r\nconst SidebarInset = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"main\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <main\r\n      ref={ref}\r\n      className={cn(\r\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\r\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarInset.displayName = \"SidebarInset\"\r\n\r\nconst SidebarInput = React.forwardRef<\r\n  React.ElementRef<typeof Input>,\r\n  React.ComponentProps<typeof Input>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <Input\r\n      ref={ref}\r\n      data-sidebar=\"input\"\r\n      className={cn(\r\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarInput.displayName = \"SidebarInput\"\r\n\r\nconst SidebarHeader = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"header\"\r\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarHeader.displayName = \"SidebarHeader\"\r\n\r\nconst SidebarFooter = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"footer\"\r\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarFooter.displayName = \"SidebarFooter\"\r\n\r\nconst SidebarSeparator = React.forwardRef<\r\n  React.ElementRef<typeof Separator>,\r\n  React.ComponentProps<typeof Separator>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <Separator\r\n      ref={ref}\r\n      data-sidebar=\"separator\"\r\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarSeparator.displayName = \"SidebarSeparator\"\r\n\r\nconst SidebarContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"content\"\r\n      className={cn(\r\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarContent.displayName = \"SidebarContent\"\r\n\r\nconst SidebarGroup = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"group\"\r\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroup.displayName = \"SidebarGroup\"\r\n\r\nconst SidebarGroupLabel = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\r\n>(({ className, asChild = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"div\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"group-label\"\r\n      className={cn(\r\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\r\n\r\nconst SidebarGroupAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\r\n>(({ className, asChild = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"group-action\"\r\n      className={cn(\r\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        // Increases the hit area of the button on mobile.\r\n        \"after:absolute after:-inset-2 after:md:hidden\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\r\n\r\nconst SidebarGroupContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    data-sidebar=\"group-content\"\r\n    className={cn(\"w-full text-sm\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\r\n\r\nconst SidebarMenu = React.forwardRef<\r\n  HTMLUListElement,\r\n  React.ComponentProps<\"ul\">\r\n>(({ className, ...props }, ref) => (\r\n  <ul\r\n    ref={ref}\r\n    data-sidebar=\"menu\"\r\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenu.displayName = \"SidebarMenu\"\r\n\r\nconst SidebarMenuItem = React.forwardRef<\r\n  HTMLLIElement,\r\n  React.ComponentProps<\"li\">\r\n>(({ className, ...props }, ref) => (\r\n  <li\r\n    ref={ref}\r\n    data-sidebar=\"menu-item\"\r\n    className={cn(\"group/menu-item relative\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\r\n\r\nconst sidebarMenuButtonVariants = cva(\r\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n        outline:\r\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\r\n      },\r\n      size: {\r\n        default: \"h-8 text-sm\",\r\n        sm: \"h-7 text-xs\",\r\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nconst SidebarMenuButton = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean\r\n    isActive?: boolean\r\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\r\n  } & VariantProps<typeof sidebarMenuButtonVariants>\r\n>(\r\n  (\r\n    {\r\n      asChild = false,\r\n      isActive = false,\r\n      variant = \"default\",\r\n      size = \"default\",\r\n      tooltip,\r\n      className,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    const Comp = asChild ? Slot : \"button\"\r\n    const { isMobile, state } = useSidebar()\r\n\r\n    const button = (\r\n      <Comp\r\n        ref={ref}\r\n        data-sidebar=\"menu-button\"\r\n        data-size={size}\r\n        data-active={isActive}\r\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\r\n        {...props}\r\n      />\r\n    )\r\n\r\n    if (!tooltip) {\r\n      return button\r\n    }\r\n\r\n    if (typeof tooltip === \"string\") {\r\n      tooltip = {\r\n        children: tooltip,\r\n      }\r\n    }\r\n\r\n    return (\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\r\n        <TooltipContent\r\n          side=\"right\"\r\n          align=\"center\"\r\n          hidden={state !== \"collapsed\" || isMobile}\r\n          {...tooltip}\r\n        />\r\n      </Tooltip>\r\n    )\r\n  }\r\n)\r\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\r\n\r\nconst SidebarMenuAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean\r\n    showOnHover?: boolean\r\n  }\r\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-action\"\r\n      className={cn(\r\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        // Increases the hit area of the button on mobile.\r\n        \"after:absolute after:-inset-2 after:md:hidden\",\r\n        \"peer-data-[size=sm]/menu-button:top-1\",\r\n        \"peer-data-[size=default]/menu-button:top-1.5\",\r\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        showOnHover &&\r\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\r\n\r\nconst SidebarMenuBadge = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    data-sidebar=\"menu-badge\"\r\n    className={cn(\r\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\r\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\r\n      \"peer-data-[size=sm]/menu-button:top-1\",\r\n      \"peer-data-[size=default]/menu-button:top-1.5\",\r\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n      \"group-data-[collapsible=icon]:hidden\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\r\n\r\nconst SidebarMenuSkeleton = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    showIcon?: boolean\r\n  }\r\n>(({ className, showIcon = false, ...props }, ref) => {\r\n  // Random width between 50 to 90%.\r\n  const width = React.useMemo(() => {\r\n    return `${Math.floor(Math.random() * 40) + 50}%`\r\n  }, [])\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"menu-skeleton\"\r\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\r\n      {...props}\r\n    >\r\n      {showIcon && (\r\n        <Skeleton\r\n          className=\"size-4 rounded-md\"\r\n          data-sidebar=\"menu-skeleton-icon\"\r\n        />\r\n      )}\r\n      <Skeleton\r\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\r\n        data-sidebar=\"menu-skeleton-text\"\r\n        style={\r\n          {\r\n            \"--skeleton-width\": width,\r\n          } as React.CSSProperties\r\n        }\r\n      />\r\n    </div>\r\n  )\r\n})\r\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\r\n\r\nconst SidebarMenuSub = React.forwardRef<\r\n  HTMLUListElement,\r\n  React.ComponentProps<\"ul\">\r\n>(({ className, ...props }, ref) => (\r\n  <ul\r\n    ref={ref}\r\n    data-sidebar=\"menu-sub\"\r\n    className={cn(\r\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\r\n      \"group-data-[collapsible=icon]:hidden\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\r\n\r\nconst SidebarMenuSubItem = React.forwardRef<\r\n  HTMLLIElement,\r\n  React.ComponentProps<\"li\">\r\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\r\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\r\n\r\nconst SidebarMenuSubButton = React.forwardRef<\r\n  HTMLAnchorElement,\r\n  React.ComponentProps<\"a\"> & {\r\n    asChild?: boolean\r\n    size?: \"sm\" | \"md\"\r\n    isActive?: boolean\r\n  }\r\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"a\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-sub-button\"\r\n      data-size={size}\r\n      data-active={isActive}\r\n      className={cn(\r\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\r\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\r\n        size === \"sm\" && \"text-xs\",\r\n        size === \"md\" && \"text-sm\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\r\n\r\nexport {\r\n  Sidebar,\r\n  SidebarContent,\r\n  SidebarFooter,\r\n  SidebarGroup,\r\n  SidebarGroupAction,\r\n  SidebarGroupContent,\r\n  SidebarGroupLabel,\r\n  SidebarHeader,\r\n  SidebarInput,\r\n  SidebarInset,\r\n  SidebarMenu,\r\n  SidebarMenuAction,\r\n  SidebarMenuBadge,\r\n  SidebarMenuButton,\r\n  SidebarMenuItem,\r\n  SidebarMenuSkeleton,\r\n  SidebarMenuSub,\r\n  SidebarMenuSubButton,\r\n  SidebarMenuSubItem,\r\n  SidebarProvider,\r\n  SidebarRail,\r\n  SidebarSeparator,\r\n  SidebarTrigger,\r\n  useSidebar,\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":29,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":29,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\"\r\nimport { Toaster as Sonner, toast } from \"sonner\"\r\n\r\ntype ToasterProps = React.ComponentProps<typeof Sonner>\r\n\r\nconst Toaster = ({ ...props }: ToasterProps) => {\r\n  const { theme = \"system\" } = useTheme()\r\n\r\n  return (\r\n    <Sonner\r\n      theme={theme as ToasterProps[\"theme\"]}\r\n      className=\"toaster group\"\r\n      toastOptions={{\r\n        classNames: {\r\n          toast:\r\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\r\n          description: \"group-[.toast]:text-muted-foreground\",\r\n          actionButton:\r\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\r\n          cancelButton:\r\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\r\n        },\r\n      }}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Toaster, toast }\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\theme-toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":43,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":43,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst toggleVariants = cva(\r\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-transparent\",\r\n        outline:\r\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\r\n      },\r\n      size: {\r\n        default: \"h-10 px-3\",\r\n        sm: \"h-9 px-2.5\",\r\n        lg: \"h-11 px-5\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nconst Toggle = React.forwardRef<\r\n  React.ElementRef<typeof TogglePrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\r\n    VariantProps<typeof toggleVariants>\r\n>(({ className, variant, size, ...props }, ref) => (\r\n  <TogglePrimitive.Root\r\n    ref={ref}\r\n    className={cn(toggleVariants({ variant, size, className }))}\r\n    {...props}\r\n  />\r\n))\r\n\r\nToggle.displayName = TogglePrimitive.Root.displayName\r\n\r\nexport { Toggle, toggleVariants }\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\components\\ui\\view-modes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\config\\apiConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\config\\backendConfig.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2093,2096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2093,2096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2292,2295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2292,2295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Backend Configuration Service\r\n * Centralized configuration for all three backends: Mock, Real API, and Supabase\r\n * \r\n * USAGE:\r\n * - Set VITE_API_MODE=mock|real|supabase in .env for global backend\r\n * - Override per-service with VITE_*_BACKEND=mock|real|supabase\r\n * - All services automatically switch based on configuration\r\n * \r\n * Example:\r\n *   VITE_API_MODE=supabase           # All services use Supabase\r\n *   VITE_CUSTOMER_BACKEND=mock       # Except customers use Mock\r\n *   VITE_SALES_BACKEND=real          # And sales use Real API\r\n */\r\n\r\nexport type BackendMode = 'mock' | 'real' | 'supabase';\r\nexport type ServiceBackend = BackendMode | 'auto';\r\n\r\nexport interface BackendConfig {\r\n  mode: BackendMode;\r\n  supabase?: {\r\n    url: string;\r\n    anonKey: string;\r\n    serviceKey?: string;\r\n    enableRealtime: boolean;\r\n    enableOffline: boolean;\r\n    syncInterval: number;\r\n    authMethod: 'jwt' | 'oauth' | 'magic_link';\r\n  };\r\n  realApi?: {\r\n    baseUrl: string;\r\n    environment: 'development' | 'staging' | 'production';\r\n    timeout: number;\r\n  };\r\n  featureFlags?: Record<string, ServiceBackend>;\r\n  cache?: {\r\n    enabled: boolean;\r\n    ttl: number;\r\n    deduplication: boolean;\r\n  };\r\n  monitoring?: {\r\n    enableLogging: boolean;\r\n    enableMetrics: boolean;\r\n    enableErrorTracking: boolean;\r\n    debugFactory: boolean;\r\n  };\r\n}\r\n\r\n/**\r\n * Global backend configuration\r\n * Loads from environment variables at startup\r\n */\r\nexport const backendConfig: BackendConfig = {\r\n  mode: (import.meta.env.VITE_API_MODE || 'mock') as BackendMode,\r\n\r\n  supabase: import.meta.env.VITE_SUPABASE_URL ? {\r\n    url: import.meta.env.VITE_SUPABASE_URL,\r\n    anonKey: import.meta.env.VITE_SUPABASE_ANON_KEY,\r\n    serviceKey: import.meta.env.VITE_SUPABASE_SERVICE_KEY,\r\n    enableRealtime: import.meta.env.VITE_SUPABASE_ENABLE_REALTIME === 'true',\r\n    enableOffline: import.meta.env.VITE_SUPABASE_ENABLE_OFFLINE === 'true',\r\n    syncInterval: parseInt(import.meta.env.VITE_SUPABASE_SYNC_INTERVAL || '5000'),\r\n    authMethod: (import.meta.env.VITE_SUPABASE_AUTH_METHOD || 'jwt') as any,\r\n  } : undefined,\r\n\r\n  realApi: {\r\n    baseUrl: import.meta.env.VITE_API_BASE_URL || 'http://localhost:5137/api/v1',\r\n    environment: (import.meta.env.VITE_API_ENVIRONMENT || 'development') as any,\r\n    timeout: parseInt(import.meta.env.VITE_API_TIMEOUT || '30000'),\r\n  },\r\n\r\n  featureFlags: {\r\n    customer: (import.meta.env.VITE_CUSTOMER_BACKEND || 'auto') as ServiceBackend,\r\n    sales: (import.meta.env.VITE_SALES_BACKEND || 'auto') as ServiceBackend,\r\n    ticket: (import.meta.env.VITE_TICKET_BACKEND || 'auto') as ServiceBackend,\r\n    contract: (import.meta.env.VITE_CONTRACT_BACKEND || 'auto') as ServiceBackend,\r\n    user: (import.meta.env.VITE_USER_BACKEND || 'auto') as ServiceBackend,\r\n    dashboard: (import.meta.env.VITE_DASHBOARD_BACKEND || 'auto') as ServiceBackend,\r\n    notification: (import.meta.env.VITE_NOTIFICATION_BACKEND || 'auto') as ServiceBackend,\r\n    file: (import.meta.env.VITE_FILE_BACKEND || 'auto') as ServiceBackend,\r\n    audit: (import.meta.env.VITE_AUDIT_BACKEND || 'auto') as ServiceBackend,\r\n  },\r\n\r\n  cache: {\r\n    enabled: import.meta.env.VITE_ENABLE_SERVICE_CACHE !== 'false',\r\n    ttl: parseInt(import.meta.env.VITE_CACHE_TTL || '300000'),\r\n    deduplication: import.meta.env.VITE_ENABLE_REQUEST_DEDUPLICATION !== 'false',\r\n  },\r\n\r\n  monitoring: {\r\n    enableLogging: import.meta.env.VITE_ENABLE_SERVICE_LOGGING !== 'false',\r\n    enableMetrics: import.meta.env.VITE_ENABLE_PERFORMANCE_METRICS !== 'false',\r\n    enableErrorTracking: import.meta.env.VITE_ENABLE_ERROR_TRACKING !== 'false',\r\n    debugFactory: import.meta.env.VITE_DEBUG_SERVICE_FACTORY === 'true',\r\n  },\r\n};\r\n\r\n/**\r\n * Get backend for specific service\r\n * Returns the appropriate backend mode for a given service\r\n */\r\nexport function getServiceBackend(serviceName: keyof typeof backendConfig.featureFlags): BackendMode {\r\n  const serviceBackend = backendConfig.featureFlags?.[serviceName];\r\n  return (serviceBackend === 'auto' ? backendConfig.mode : serviceBackend) as BackendMode;\r\n}\r\n\r\n/**\r\n * Validation & Helper Functions\r\n */\r\nexport function isSupabaseConfigured(): boolean {\r\n  return !!backendConfig.supabase?.url && !!backendConfig.supabase?.anonKey;\r\n}\r\n\r\nexport function isRealApiConfigured(): boolean {\r\n  return !!backendConfig.realApi?.baseUrl;\r\n}\r\n\r\nexport function getSupabaseConfig() {\r\n  if (!isSupabaseConfigured()) {\r\n    throw new Error(\r\n      '‚ùå Supabase not configured. Check VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in .env'\r\n    );\r\n  }\r\n  return backendConfig.supabase!;\r\n}\r\n\r\nexport function validateBackendConfig(): { valid: boolean; errors: string[] } {\r\n  const errors: string[] = [];\r\n\r\n  if (!backendConfig.mode) {\r\n    errors.push('‚ùå VITE_API_MODE not set');\r\n  }\r\n\r\n  if (backendConfig.mode === 'supabase' && !isSupabaseConfigured()) {\r\n    errors.push('‚ùå Supabase mode selected but credentials not configured');\r\n    errors.push('   Add VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY to .env');\r\n  }\r\n\r\n  if (backendConfig.mode === 'real' && !isRealApiConfigured()) {\r\n    errors.push('‚ùå Real API mode selected but VITE_API_BASE_URL not configured');\r\n  }\r\n\r\n  return {\r\n    valid: errors.length === 0,\r\n    errors,\r\n  };\r\n}\r\n\r\n/**\r\n * Print configuration for debugging\r\n */\r\nexport function printBackendConfig(): void {\r\n  if (typeof window !== 'undefined') {\r\n    const validation = validateBackendConfig();\r\n    const statusIcon = validation.valid ? '‚úÖ' : '‚ùå';\r\n\r\n    console.log(`\r\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\r\n‚ïë       MULTI-BACKEND CONFIGURATION                          ‚ïë\r\n‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£\r\n‚ïë  Status: ${statusIcon} ${backendConfig.mode.toUpperCase().padEnd(45)} ‚ïë\r\n‚ïë  Supabase Configured: ${isSupabaseConfigured() ? '‚úÖ' : '‚ùå'} ${' '.padEnd(40)} ‚ïë\r\n‚ïë  Real API Configured: ${isRealApiConfigured() ? '‚úÖ' : '‚ùå'} ${' '.padEnd(40)} ‚ïë\r\n‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£\r\n‚ïë  FEATURE FLAGS:                                            ‚ïë\r\n‚ïë  ‚Ä¢ Customer: ${getServiceBackend('customer').padEnd(52)} ‚ïë\r\n‚ïë  ‚Ä¢ Sales: ${getServiceBackend('sales').padEnd(54)} ‚ïë\r\n‚ïë  ‚Ä¢ Ticket: ${getServiceBackend('ticket').padEnd(53)} ‚ïë\r\n‚ïë  ‚Ä¢ Contract: ${getServiceBackend('contract').padEnd(51)} ‚ïë\r\n‚ïë  ‚Ä¢ File: ${getServiceBackend('file').padEnd(55)} ‚ïë\r\n‚ïë  ‚Ä¢ User: ${getServiceBackend('user').padEnd(54)} ‚ïë\r\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\r\n    `);\r\n\r\n    if (!validation.valid) {\r\n      console.warn('‚ö†Ô∏è  Configuration errors:');\r\n      validation.errors.forEach((error) => console.warn(error));\r\n    }\r\n  }\r\n}\r\n\r\n// Validate and print on startup\r\nif (typeof window !== 'undefined') {\r\n  const validation = validateBackendConfig();\r\n  if (!validation.valid) {\r\n    console.warn('[BackendConfig] Validation errors:', validation.errors);\r\n  } else {\r\n    console.log('[BackendConfig] ‚úÖ Configuration valid');\r\n  }\r\n  \r\n  // Only print detailed config in debug mode\r\n  if (backendConfig.monitoring?.debugFactory) {\r\n    printBackendConfig();\r\n  }\r\n}\r\n\r\nexport default backendConfig;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\config\\navigationPermissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\contexts\\AuthContext.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":32,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":32,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\contexts\\PortalContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":14,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":14,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\r\n\r\nexport type PortalType = 'tenant' | 'super-admin';\r\n\r\ninterface PortalContextType {\r\n  currentPortal: PortalType;\r\n  setPortal: (portal: PortalType) => void;\r\n  isSuperAdmin: boolean;\r\n  isTenant: boolean;\r\n}\r\n\r\nconst PortalContext = createContext<PortalContextType | undefined>(undefined);\r\n\r\nexport const usePortal = () => {\r\n  const context = useContext(PortalContext);\r\n  if (!context) {\r\n    throw new Error('usePortal must be used within a PortalProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface PortalProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const PortalProvider: React.FC<PortalProviderProps> = ({ children }) => {\r\n  const [currentPortal, setCurrentPortal] = useState<PortalType>('tenant');\r\n\r\n  useEffect(() => {\r\n    // Determine portal based on current URL\r\n    const path = window.location.pathname;\r\n    if (path.startsWith('/super-admin')) {\r\n      setCurrentPortal('super-admin');\r\n    } else {\r\n      setCurrentPortal('tenant');\r\n    }\r\n  }, []);\r\n\r\n  const setPortal = (portal: PortalType) => {\r\n    setCurrentPortal(portal);\r\n  };\r\n\r\n  const value: PortalContextType = {\r\n    currentPortal,\r\n    setPortal,\r\n    isSuperAdmin: currentPortal === 'super-admin',\r\n    isTenant: currentPortal === 'tenant',\r\n  };\r\n\r\n  return (\r\n    <PortalContext.Provider value={value}>\r\n      {children}\r\n    </PortalContext.Provider>\r\n  );\r\n};\r\n\r\nexport default PortalContext;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\contexts\\ScrollStateContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'autoSaveIntervals.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'autoSaveIntervals.current' to a variable inside the effect, and use that variable in the cleanup function.","line":217,"column":25,"nodeType":"Identifier","endLine":217,"endColumn":32},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":253,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":253,"endColumn":28},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":262,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":262,"endColumn":30},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":280,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":280,"endColumn":27},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":300,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":300,"endColumn":28},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":319,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":319,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useRef, useCallback, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\n\ninterface ScrollPosition {\n  x: number;\n  y: number;\n  timestamp: number;\n}\n\ninterface ScrollStateContextType {\n  // Sidebar scroll management\n  saveSidebarScrollPosition: (position: ScrollPosition) => void;\n  restoreSidebarScrollPosition: () => ScrollPosition | null;\n  getSidebarScrollRef: () => React.RefObject<HTMLElement>;\n  \n  // Page scroll management\n  savePageScrollPosition: (route: string, position: ScrollPosition) => void;\n  restorePageScrollPosition: (route: string) => ScrollPosition | null;\n  getPageScrollRef: () => React.RefObject<HTMLElement>;\n  \n  // Table scroll management\n  saveTableScrollPosition: (tableId: string, position: ScrollPosition) => void;\n  restoreTableScrollPosition: (tableId: string) => ScrollPosition | null;\n  \n  // Modal scroll management\n  saveModalScrollPosition: (modalId: string, position: ScrollPosition) => void;\n  restoreModalScrollPosition: (modalId: string) => ScrollPosition | null;\n  \n  // Auto-save scroll positions\n  enableAutoSave: (elementRef: React.RefObject<HTMLElement>, key: string) => void;\n  disableAutoSave: (key: string) => void;\n  \n  // Clear old scroll positions\n  clearOldScrollPositions: (maxAge?: number) => void;\n}\n\nconst ScrollStateContext = createContext<ScrollStateContextType | undefined>(undefined);\n\ninterface ScrollStateProviderProps {\n  children: React.ReactNode;\n  maxScrollHistoryAge?: number; // in milliseconds, default 30 minutes\n}\n\nexport const ScrollStateProvider: React.FC<ScrollStateProviderProps> = ({\n  children,\n  maxScrollHistoryAge = 30 * 60 * 1000 // 30 minutes\n}) => {\n  \n  // Refs for different scroll containers\n  const sidebarScrollRef = useRef<HTMLElement>(null);\n  const pageScrollRef = useRef<HTMLElement>(null);\n  \n  // Storage for scroll positions\n  const scrollPositions = useRef<Map<string, ScrollPosition>>(new Map());\n  const autoSaveIntervals = useRef<Map<string, NodeJS.Timeout>>(new Map());\n  \n  // Sidebar scroll management\n  const saveSidebarScrollPosition = useCallback((position: ScrollPosition) => {\n    scrollPositions.current.set('sidebar', position);\n    // Also save to sessionStorage for persistence across page reloads\n    sessionStorage.setItem('sidebar-scroll', JSON.stringify(position));\n  }, []);\n  \n  const restoreSidebarScrollPosition = useCallback((): ScrollPosition | null => {\n    // First try memory\n    let position = scrollPositions.current.get('sidebar');\n    \n    // If not in memory, try sessionStorage\n    if (!position) {\n      const stored = sessionStorage.getItem('sidebar-scroll');\n      if (stored) {\n        try {\n          position = JSON.parse(stored);\n        } catch (e) {\n          console.warn('Failed to parse stored sidebar scroll position:', e);\n        }\n      }\n    }\n    \n    return position || null;\n  }, []);\n  \n  const getSidebarScrollRef = useCallback(() => sidebarScrollRef, []);\n  \n  // Page scroll management\n  const savePageScrollPosition = useCallback((route: string, position: ScrollPosition) => {\n    const key = `page-${route}`;\n    scrollPositions.current.set(key, position);\n    sessionStorage.setItem(key, JSON.stringify(position));\n  }, []);\n  \n  const restorePageScrollPosition = useCallback((route: string): ScrollPosition | null => {\n    const key = `page-${route}`;\n    let position = scrollPositions.current.get(key);\n    \n    if (!position) {\n      const stored = sessionStorage.getItem(key);\n      if (stored) {\n        try {\n          position = JSON.parse(stored);\n        } catch (e) {\n          console.warn(`Failed to parse stored page scroll position for ${route}:`, e);\n        }\n      }\n    }\n    \n    return position || null;\n  }, []);\n  \n  const getPageScrollRef = useCallback(() => pageScrollRef, []);\n  \n  // Table scroll management\n  const saveTableScrollPosition = useCallback((tableId: string, position: ScrollPosition) => {\n    const key = `table-${tableId}`;\n    scrollPositions.current.set(key, position);\n    sessionStorage.setItem(key, JSON.stringify(position));\n  }, []);\n  \n  const restoreTableScrollPosition = useCallback((tableId: string): ScrollPosition | null => {\n    const key = `table-${tableId}`;\n    let position = scrollPositions.current.get(key);\n    \n    if (!position) {\n      const stored = sessionStorage.getItem(key);\n      if (stored) {\n        try {\n          position = JSON.parse(stored);\n        } catch (e) {\n          console.warn(`Failed to parse stored table scroll position for ${tableId}:`, e);\n        }\n      }\n    }\n    \n    return position || null;\n  }, []);\n  \n  // Modal scroll management\n  const saveModalScrollPosition = useCallback((modalId: string, position: ScrollPosition) => {\n    const key = `modal-${modalId}`;\n    scrollPositions.current.set(key, position);\n    // Don't persist modal scroll positions to sessionStorage as they're temporary\n  }, []);\n  \n  const restoreModalScrollPosition = useCallback((modalId: string): ScrollPosition | null => {\n    const key = `modal-${modalId}`;\n    return scrollPositions.current.get(key) || null;\n  }, []);\n  \n  // Auto-save functionality\n  const enableAutoSave = useCallback((elementRef: React.RefObject<HTMLElement>, key: string) => {\n    // Clear existing interval if any\n    const existingInterval = autoSaveIntervals.current.get(key);\n    if (existingInterval) {\n      clearInterval(existingInterval);\n    }\n    \n    // Set up new auto-save interval\n    const interval = setInterval(() => {\n      if (elementRef.current) {\n        const element = elementRef.current;\n        const position: ScrollPosition = {\n          x: element.scrollLeft,\n          y: element.scrollTop,\n          timestamp: Date.now()\n        };\n        \n        if (key.startsWith('sidebar')) {\n          saveSidebarScrollPosition(position);\n        } else if (key.startsWith('page-')) {\n          const route = key.replace('page-', '');\n          savePageScrollPosition(route, position);\n        } else if (key.startsWith('table-')) {\n          const tableId = key.replace('table-', '');\n          saveTableScrollPosition(tableId, position);\n        } else if (key.startsWith('modal-')) {\n          const modalId = key.replace('modal-', '');\n          saveModalScrollPosition(modalId, position);\n        }\n      }\n    }, 500); // Save every 500ms\n    \n    autoSaveIntervals.current.set(key, interval);\n  }, [saveSidebarScrollPosition, savePageScrollPosition, saveTableScrollPosition, saveModalScrollPosition]);\n  \n  const disableAutoSave = useCallback((key: string) => {\n    const interval = autoSaveIntervals.current.get(key);\n    if (interval) {\n      clearInterval(interval);\n      autoSaveIntervals.current.delete(key);\n    }\n  }, []);\n  \n  // Clear old scroll positions\n  const clearOldScrollPositions = useCallback((maxAge: number = maxScrollHistoryAge) => {\n    const now = Date.now();\n    const keysToDelete: string[] = [];\n    \n    scrollPositions.current.forEach((position, key) => {\n      if (now - position.timestamp > maxAge) {\n        keysToDelete.push(key);\n      }\n    });\n    \n    keysToDelete.forEach(key => {\n      scrollPositions.current.delete(key);\n      sessionStorage.removeItem(key);\n    });\n  }, [maxScrollHistoryAge]);\n  \n  // Note: Auto-save of page scroll position is now handled by individual page components\n  // using the usePageScroll hook to avoid Router context dependency issues\n  \n  // Cleanup intervals on unmount\n  useEffect(() => {\n    return () => {\n      autoSaveIntervals.current.forEach(interval => clearInterval(interval));\n      autoSaveIntervals.current.clear();\n    };\n  }, []);\n  \n  // Periodic cleanup of old scroll positions\n  useEffect(() => {\n    const cleanupInterval = setInterval(() => {\n      clearOldScrollPositions();\n    }, 5 * 60 * 1000); // Clean up every 5 minutes\n    \n    return () => clearInterval(cleanupInterval);\n  }, [clearOldScrollPositions]);\n  \n  const value: ScrollStateContextType = {\n    saveSidebarScrollPosition,\n    restoreSidebarScrollPosition,\n    getSidebarScrollRef,\n    savePageScrollPosition,\n    restorePageScrollPosition,\n    getPageScrollRef,\n    saveTableScrollPosition,\n    restoreTableScrollPosition,\n    saveModalScrollPosition,\n    restoreModalScrollPosition,\n    enableAutoSave,\n    disableAutoSave,\n    clearOldScrollPositions\n  };\n  \n  return (\n    <ScrollStateContext.Provider value={value}>\n      {children}\n    </ScrollStateContext.Provider>\n  );\n};\n\nexport const useScrollState = (): ScrollStateContextType => {\n  const context = useContext(ScrollStateContext);\n  if (context === undefined) {\n    throw new Error('useScrollState must be used within a ScrollStateProvider');\n  }\n  return context;\n};\n\n// Custom hooks for specific use cases\nexport const useSidebarScroll = () => {\n  const { \n    saveSidebarScrollPosition, \n    restoreSidebarScrollPosition, \n    getSidebarScrollRef,\n    enableAutoSave,\n    disableAutoSave\n  } = useScrollState();\n  \n  return {\n    saveSidebarScrollPosition,\n    restoreSidebarScrollPosition,\n    getSidebarScrollRef,\n    enableAutoSave: () => enableAutoSave(getSidebarScrollRef(), 'sidebar'),\n    disableAutoSave: () => disableAutoSave('sidebar')\n  };\n};\n\nexport const usePageScroll = (route?: string) => {\n  const location = useLocation();\n  const currentRoute = route || location.pathname;\n  const { \n    savePageScrollPosition, \n    restorePageScrollPosition, \n    getPageScrollRef,\n    enableAutoSave,\n    disableAutoSave\n  } = useScrollState();\n  \n  return {\n    savePageScrollPosition: (position: ScrollPosition) => savePageScrollPosition(currentRoute, position),\n    restorePageScrollPosition: () => restorePageScrollPosition(currentRoute),\n    getPageScrollRef,\n    enableAutoSave: () => enableAutoSave(getPageScrollRef(), `page-${currentRoute}`),\n    disableAutoSave: () => disableAutoSave(`page-${currentRoute}`)\n  };\n};\n\nexport const useTableScroll = (tableId: string) => {\n  const { \n    saveTableScrollPosition, \n    restoreTableScrollPosition,\n    enableAutoSave,\n    disableAutoSave\n  } = useScrollState();\n  \n  const tableRef = useRef<HTMLElement>(null);\n  \n  return {\n    tableRef,\n    saveTableScrollPosition: (position: ScrollPosition) => saveTableScrollPosition(tableId, position),\n    restoreTableScrollPosition: () => restoreTableScrollPosition(tableId),\n    enableAutoSave: () => enableAutoSave(tableRef, `table-${tableId}`),\n    disableAutoSave: () => disableAutoSave(`table-${tableId}`)\n  };\n};\n\nexport const useModalScroll = (modalId: string) => {\n  const { \n    saveModalScrollPosition, \n    restoreModalScrollPosition,\n    enableAutoSave,\n    disableAutoSave\n  } = useScrollState();\n  \n  const modalRef = useRef<HTMLElement>(null);\n  \n  return {\n    modalRef,\n    saveModalScrollPosition: (position: ScrollPosition) => saveModalScrollPosition(modalId, position),\n    restoreModalScrollPosition: () => restoreModalScrollPosition(modalId),\n    enableAutoSave: () => enableAutoSave(modalRef, `modal-${modalId}`),\n    disableAutoSave: () => disableAutoSave(`modal-${modalId}`)\n  };\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\contexts\\SuperAdminContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":52,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":52,"endColumn":27},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isSuperAdmin' and 'refreshAll'. Either include them or remove the dependency array.","line":323,"column":6,"nodeType":"ArrayExpression","endLine":323,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [isSuperAdmin, refreshAll, user]","fix":{"range":[9954,9960],"text":"[isSuperAdmin, refreshAll, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { \r\n  TenantConfig, \r\n  SuperAdminUser, \r\n  RoleRequest, \r\n  PlatformUsage, \r\n  SystemHealth, \r\n  AnalyticsData,\r\n  SuperAdminFilters \r\n} from '@/types/superAdmin';\r\nimport { superAdminService } from '@/services/superAdminService';\r\nimport { useAuth } from './AuthContext';\r\nimport { uiNotificationService } from '@/services/uiNotificationService';\r\n\r\ninterface SuperAdminContextType {\r\n  // State\r\n  tenants: TenantConfig[];\r\n  globalUsers: SuperAdminUser[];\r\n  roleRequests: RoleRequest[];\r\n  platformUsage: PlatformUsage | null;\r\n  systemHealth: SystemHealth | null;\r\n  analyticsData: AnalyticsData | null;\r\n  isLoading: boolean;\r\n  \r\n  // Tenant Management\r\n  loadTenants: (filters?: SuperAdminFilters['tenants']) => Promise<void>;\r\n  createTenant: (tenantData: Omit<TenantConfig, 'id' | 'created_at' | 'updated_at'>) => Promise<void>;\r\n  updateTenant: (id: string, updates: Partial<TenantConfig>) => Promise<void>;\r\n  deleteTenant: (id: string) => Promise<void>;\r\n  \r\n  // Global User Management\r\n  loadGlobalUsers: (filters?: SuperAdminFilters['users']) => Promise<void>;\r\n  updateGlobalUser: (id: string, updates: Partial<SuperAdminUser>) => Promise<void>;\r\n  \r\n  // Role Request Management\r\n  loadRoleRequests: (filters?: SuperAdminFilters['role_requests']) => Promise<void>;\r\n  approveRoleRequest: (id: string, comments?: string) => Promise<void>;\r\n  rejectRoleRequest: (id: string, comments?: string) => Promise<void>;\r\n  \r\n  // Analytics & Monitoring\r\n  loadPlatformUsage: () => Promise<void>;\r\n  loadSystemHealth: () => Promise<void>;\r\n  loadAnalyticsData: () => Promise<void>;\r\n  \r\n  // Utility\r\n  refreshAll: () => Promise<void>;\r\n  isSuperAdmin: () => boolean;\r\n}\r\n\r\nconst SuperAdminContext = createContext<SuperAdminContextType | undefined>(undefined);\r\n\r\nexport const useSuperAdmin = () => {\r\n  const context = useContext(SuperAdminContext);\r\n  if (context === undefined) {\r\n    throw new Error('useSuperAdmin must be used within a SuperAdminProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const SuperAdminProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const { user } = useAuth();\r\n  const [tenants, setTenants] = useState<TenantConfig[]>([]);\r\n  const [globalUsers, setGlobalUsers] = useState<SuperAdminUser[]>([]);\r\n  const [roleRequests, setRoleRequests] = useState<RoleRequest[]>([]);\r\n  const [platformUsage, setPlatformUsage] = useState<PlatformUsage | null>(null);\r\n  const [systemHealth, setSystemHealth] = useState<SystemHealth | null>(null);\r\n  const [analyticsData, setAnalyticsData] = useState<AnalyticsData | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const isSuperAdmin = (): boolean => {\r\n    if (!user) return false;\r\n    // Check for proper super_admin role\r\n    return user.role === 'super_admin';\r\n  };\r\n\r\n  // Tenant Management\r\n  const loadTenants = async (filters?: SuperAdminFilters['tenants']) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const data = await superAdminService.getTenants(filters);\r\n      setTenants(data);\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to load tenants'\r\n      );\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const createTenant = async (tenantData: Omit<TenantConfig, 'id' | 'created_at' | 'updated_at'>) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const newTenant = await superAdminService.createTenant(tenantData);\r\n      setTenants(prev => [...prev, newTenant]);\r\n      uiNotificationService.successNotify(\r\n        'Success',\r\n        'Tenant created successfully'\r\n      );\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to create tenant'\r\n      );\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateTenant = async (id: string, updates: Partial<TenantConfig>) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const updatedTenant = await superAdminService.updateTenant(id, updates);\r\n      setTenants(prev => prev.map(t => t.id === id ? updatedTenant : t));\r\n      uiNotificationService.successNotify(\r\n        'Success',\r\n        'Tenant updated successfully'\r\n      );\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to update tenant'\r\n      );\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const deleteTenant = async (id: string) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      await superAdminService.deleteTenant(id);\r\n      setTenants(prev => prev.filter(t => t.id !== id));\r\n      uiNotificationService.successNotify(\r\n        'Success',\r\n        'Tenant deleted successfully'\r\n      );\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to delete tenant'\r\n      );\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Global User Management\r\n  const loadGlobalUsers = async (filters?: SuperAdminFilters['users']) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const data = await superAdminService.getGlobalUsers(filters);\r\n      setGlobalUsers(data);\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to load users'\r\n      );\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateGlobalUser = async (id: string, updates: Partial<SuperAdminUser>) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const updatedUser = await superAdminService.updateGlobalUser(id, updates);\r\n      setGlobalUsers(prev => prev.map(u => u.id === id ? updatedUser : u));\r\n      uiNotificationService.successNotify(\r\n        'Success',\r\n        'User updated successfully'\r\n      );\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to update user'\r\n      );\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Role Request Management\r\n  const loadRoleRequests = async (filters?: SuperAdminFilters['role_requests']) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const data = await superAdminService.getRoleRequests(filters);\r\n      setRoleRequests(data);\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to load role requests'\r\n      );\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const approveRoleRequest = async (id: string, comments?: string) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const updatedRequest = await superAdminService.approveRoleRequest(id, comments);\r\n      setRoleRequests(prev => prev.map(r => r.id === id ? updatedRequest : r));\r\n      uiNotificationService.successNotify(\r\n        'Success',\r\n        'Role request approved successfully'\r\n      );\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to approve role request'\r\n      );\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const rejectRoleRequest = async (id: string, comments?: string) => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      const updatedRequest = await superAdminService.rejectRoleRequest(id, comments);\r\n      setRoleRequests(prev => prev.map(r => r.id === id ? updatedRequest : r));\r\n      uiNotificationService.successNotify(\r\n        'Success',\r\n        'Role request rejected'\r\n      );\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to reject role request'\r\n      );\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Analytics & Monitoring\r\n  const loadPlatformUsage = async () => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    try {\r\n      const data = await superAdminService.getPlatformUsage();\r\n      setPlatformUsage(data);\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to load platform usage'\r\n      );\r\n    }\r\n  };\r\n\r\n  const loadSystemHealth = async () => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    try {\r\n      const data = await superAdminService.getSystemHealth();\r\n      setSystemHealth(data);\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to load system health'\r\n      );\r\n    }\r\n  };\r\n\r\n  const loadAnalyticsData = async () => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    try {\r\n      const data = await superAdminService.getAnalyticsData();\r\n      setAnalyticsData(data);\r\n    } catch (error) {\r\n      uiNotificationService.errorNotify(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'Failed to load analytics data'\r\n      );\r\n    }\r\n  };\r\n\r\n  const refreshAll = async () => {\r\n    if (!isSuperAdmin()) return;\r\n    \r\n    await Promise.all([\r\n      loadTenants(),\r\n      loadGlobalUsers(),\r\n      loadRoleRequests(),\r\n      loadPlatformUsage(),\r\n      loadSystemHealth(),\r\n      loadAnalyticsData()\r\n    ]);\r\n  };\r\n\r\n  // Initialize data when user changes\r\n  useEffect(() => {\r\n    if (isSuperAdmin()) {\r\n      refreshAll();\r\n    }\r\n  }, [user]);\r\n\r\n  const value: SuperAdminContextType = {\r\n    // State\r\n    tenants,\r\n    globalUsers,\r\n    roleRequests,\r\n    platformUsage,\r\n    systemHealth,\r\n    analyticsData,\r\n    isLoading,\r\n    \r\n    // Tenant Management\r\n    loadTenants,\r\n    createTenant,\r\n    updateTenant,\r\n    deleteTenant,\r\n    \r\n    // Global User Management\r\n    loadGlobalUsers,\r\n    updateGlobalUser,\r\n    \r\n    // Role Request Management\r\n    loadRoleRequests,\r\n    approveRoleRequest,\r\n    rejectRoleRequest,\r\n    \r\n    // Analytics & Monitoring\r\n    loadPlatformUsage,\r\n    loadSystemHealth,\r\n    loadAnalyticsData,\r\n    \r\n    // Utility\r\n    refreshAll,\r\n    isSuperAdmin\r\n  };\r\n\r\n  return (\r\n    <SuperAdminContext.Provider value={value}>\r\n      {children}\r\n    </SuperAdminContext.Provider>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\contexts\\ThemeContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getActualTheme'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [getActualTheme, theme]","fix":{"range":[1345,1352],"text":"[getActualTheme, theme]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getActualTheme'. Either include it or remove the dependency array.","line":62,"column":6,"nodeType":"ArrayExpression","endLine":62,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [getActualTheme, theme]","fix":{"range":[1986,1993],"text":"[getActualTheme, theme]"}}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":77,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":77,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect } from 'react';\r\nimport { useLocalStorage } from '@/hooks/useLocalStorage';\r\n\r\ntype Theme = 'light' | 'dark' | 'system';\r\n\r\ninterface ThemeContextType {\r\n  theme: Theme;\r\n  setTheme: (theme: Theme) => void;\r\n  actualTheme: 'light' | 'dark';\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\ninterface ThemeProviderProps {\r\n  children: React.ReactNode;\r\n  defaultTheme?: Theme;\r\n}\r\n\r\nexport function ThemeProvider({ children, defaultTheme = 'system' }: ThemeProviderProps) {\r\n  const [theme, setTheme] = useLocalStorage<Theme>('theme', defaultTheme);\r\n\r\n  // Get the actual theme (resolve 'system' to 'light' or 'dark')\r\n  const getActualTheme = (): 'light' | 'dark' => {\r\n    if (theme === 'system') {\r\n      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n    }\r\n    return theme;\r\n  };\r\n\r\n  const [actualTheme, setActualTheme] = React.useState<'light' | 'dark'>(getActualTheme);\r\n\r\n  useEffect(() => {\r\n    const root = window.document.documentElement;\r\n    const newActualTheme = getActualTheme();\r\n    \r\n    setActualTheme(newActualTheme);\r\n    \r\n    // Remove previous theme classes\r\n    root.classList.remove('light', 'dark');\r\n    \r\n    // Add current theme class\r\n    root.classList.add(newActualTheme);\r\n  }, [theme]);\r\n\r\n  // Listen for system theme changes when theme is set to 'system'\r\n  useEffect(() => {\r\n    if (theme !== 'system') return;\r\n\r\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n    \r\n    const handleChange = () => {\r\n      const newActualTheme = getActualTheme();\r\n      setActualTheme(newActualTheme);\r\n      \r\n      const root = window.document.documentElement;\r\n      root.classList.remove('light', 'dark');\r\n      root.classList.add(newActualTheme);\r\n    };\r\n\r\n    mediaQuery.addEventListener('change', handleChange);\r\n    return () => mediaQuery.removeEventListener('change', handleChange);\r\n  }, [theme]);\r\n\r\n  const value: ThemeContextType = {\r\n    theme,\r\n    setTheme,\r\n    actualTheme,\r\n  };\r\n\r\n  return (\r\n    <ThemeContext.Provider value={value}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  const context = useContext(ThemeContext);\r\n  \r\n  if (context === undefined) {\r\n    throw new Error('useTheme must be used within a ThemeProvider');\r\n  }\r\n  \r\n  return context;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useEnhancedTableScroll.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useLocalStorage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useNotification.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2558,2561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2558,2561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useNotification Hook\r\n * \r\n * Provides a React hook interface for displaying notifications using Ant Design.\r\n * Replaces the legacy useToast hook with a cleaner, more flexible API.\r\n * \r\n * Usage:\r\n * const { success, error, warning, info, notify } = useNotification();\r\n * \r\n * // Quick messages (auto-dismiss after 3 seconds)\r\n * success('Operation completed');\r\n * error('Something went wrong');\r\n * warning('Please be careful');\r\n * info('Here is some information');\r\n * \r\n * // Persistent notification\r\n * notify({\r\n *   type: 'success',\r\n *   message: 'Title',\r\n *   description: 'Detailed description',\r\n *   duration: 0, // 0 = never auto-dismiss\r\n * });\r\n * \r\n * // Loading message\r\n * const hideLoading = notify.loading('Processing...');\r\n * // Later: hideLoading();\r\n */\r\n\r\nimport { useCallback } from 'react';\r\nimport { uiNotificationService, type NotificationType } from '@/services/uiNotificationService';\r\n\r\ninterface NotificationParams {\r\n  type: NotificationType;\r\n  message: string;\r\n  description?: string;\r\n  duration?: number;\r\n  placement?: 'topLeft' | 'topRight' | 'bottomLeft' | 'bottomRight';\r\n  onClose?: () => void;\r\n}\r\n\r\nexport const useNotification = () => {\r\n  /**\r\n   * Display a quick success message (auto-dismiss)\r\n   */\r\n  const success = useCallback((content: string, duration?: number) => {\r\n    return uiNotificationService.success(content, duration);\r\n  }, []);\r\n\r\n  /**\r\n   * Display a quick error message (auto-dismiss)\r\n   */\r\n  const error = useCallback((content: string, duration?: number) => {\r\n    return uiNotificationService.error(content, duration);\r\n  }, []);\r\n\r\n  /**\r\n   * Display a quick warning message (auto-dismiss)\r\n   */\r\n  const warning = useCallback((content: string, duration?: number) => {\r\n    return uiNotificationService.warning(content, duration);\r\n  }, []);\r\n\r\n  /**\r\n   * Display a quick info message (auto-dismiss)\r\n   */\r\n  const info = useCallback((content: string, duration?: number) => {\r\n    return uiNotificationService.info(content, duration);\r\n  }, []);\r\n\r\n  /**\r\n   * Display a loading message\r\n   */\r\n  const loading = useCallback((content: string) => {\r\n    return uiNotificationService.loading(content);\r\n  }, []);\r\n\r\n  /**\r\n   * Display a persistent notification with title and description\r\n   */\r\n  const notify = useCallback((params: NotificationParams) => {\r\n    uiNotificationService.notify({\r\n      type: params.type,\r\n      message: params.message,\r\n      description: params.description,\r\n      duration: params.duration,\r\n      placement: params.placement as any,\r\n      onClose: params.onClose,\r\n    });\r\n  }, []);\r\n\r\n  /**\r\n   * Display a success notification with title and description\r\n   */\r\n  const successNotify = useCallback(\r\n    (\r\n      message: string,\r\n      description?: string,\r\n      duration?: number,\r\n      onClose?: () => void\r\n    ) => {\r\n      uiNotificationService.successNotify(message, description, duration, onClose);\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Display an error notification with title and description\r\n   */\r\n  const errorNotify = useCallback(\r\n    (\r\n      message: string,\r\n      description?: string,\r\n      duration?: number,\r\n      onClose?: () => void\r\n    ) => {\r\n      uiNotificationService.errorNotify(message, description, duration, onClose);\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Display a warning notification with title and description\r\n   */\r\n  const warningNotify = useCallback(\r\n    (\r\n      message: string,\r\n      description?: string,\r\n      duration?: number,\r\n      onClose?: () => void\r\n    ) => {\r\n      uiNotificationService.warningNotify(message, description, duration, onClose);\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Display an info notification with title and description\r\n   */\r\n  const infoNotify = useCallback(\r\n    (\r\n      message: string,\r\n      description?: string,\r\n      duration?: number,\r\n      onClose?: () => void\r\n    ) => {\r\n      uiNotificationService.infoNotify(message, description, duration, onClose);\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Close all notifications and messages\r\n   */\r\n  const closeAll = useCallback(() => {\r\n    uiNotificationService.closeAll();\r\n  }, []);\r\n\r\n  return {\r\n    // Quick messages\r\n    success,\r\n    error,\r\n    warning,\r\n    info,\r\n    loading,\r\n    \r\n    // Persistent notifications\r\n    notify,\r\n    successNotify,\r\n    errorNotify,\r\n    warningNotify,\r\n    infoNotify,\r\n    \r\n    // Utilities\r\n    closeAll,\r\n  };\r\n};\r\n\r\nexport default useNotification;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\usePermissionBasedNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useScrollRestoration.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'elementRef'. Either include it or remove the dependency array.","line":127,"column":6,"nodeType":"ArrayExpression","endLine":127,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [elementRef, handleScroll]","fix":{"range":[3748,3762],"text":"[elementRef, handleScroll]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useCallback, useRef, useMemo } from 'react';\r\n\r\ninterface ScrollPosition {\r\n  x: number;\r\n  y: number;\r\n  timestamp: number;\r\n}\r\n\r\ninterface UseScrollRestorationOptions {\r\n  smooth?: boolean;\r\n  delay?: number;\r\n  threshold?: number; // Minimum scroll distance to trigger save\r\n  debounceMs?: number; // Debounce scroll events\r\n}\r\n\r\nexport const useScrollRestoration = (\r\n  elementRef: React.RefObject<HTMLElement>,\r\n  savePosition: (position: ScrollPosition) => void,\r\n  restorePosition: () => ScrollPosition | null,\r\n  options: UseScrollRestorationOptions = {}\r\n) => {\r\n  const {\r\n    smooth = true,\r\n    delay = 100,\r\n    threshold = 10,\r\n    debounceMs = 100\r\n  } = options;\r\n  \r\n  const lastScrollPosition = useRef<ScrollPosition>({ x: 0, y: 0, timestamp: 0 });\r\n  const scrollTimeout = useRef<NodeJS.Timeout>();\r\n  const isRestoring = useRef(false);\r\n  \r\n  // Smooth scroll to position\r\n  const scrollToPosition = useCallback((position: ScrollPosition) => {\r\n    if (!elementRef.current) return;\r\n    \r\n    isRestoring.current = true;\r\n    \r\n    if (smooth) {\r\n      elementRef.current.scrollTo({\r\n        left: position.x,\r\n        top: position.y,\r\n        behavior: 'smooth'\r\n      });\r\n      \r\n      // Reset restoring flag after animation\r\n      setTimeout(() => {\r\n        isRestoring.current = false;\r\n      }, 500);\r\n    } else {\r\n      elementRef.current.scrollLeft = position.x;\r\n      elementRef.current.scrollTop = position.y;\r\n      isRestoring.current = false;\r\n    }\r\n  }, [elementRef, smooth]);\r\n  \r\n  // Debounced scroll save\r\n  const debouncedSave = useCallback((position: ScrollPosition) => {\r\n    if (scrollTimeout.current) {\r\n      clearTimeout(scrollTimeout.current);\r\n    }\r\n    \r\n    scrollTimeout.current = setTimeout(() => {\r\n      // Only save if scroll distance is significant\r\n      const deltaX = Math.abs(position.x - lastScrollPosition.current.x);\r\n      const deltaY = Math.abs(position.y - lastScrollPosition.current.y);\r\n      \r\n      if (deltaX >= threshold || deltaY >= threshold) {\r\n        savePosition(position);\r\n        lastScrollPosition.current = position;\r\n      }\r\n    }, debounceMs);\r\n  }, [savePosition, threshold, debounceMs]);\r\n  \r\n  // Handle scroll events\r\n  const handleScroll = useCallback(() => {\r\n    if (!elementRef.current || isRestoring.current) return;\r\n    \r\n    const element = elementRef.current;\r\n    const position: ScrollPosition = {\r\n      x: element.scrollLeft,\r\n      y: element.scrollTop,\r\n      timestamp: Date.now()\r\n    };\r\n    \r\n    debouncedSave(position);\r\n  }, [elementRef, debouncedSave]);\r\n  \r\n  // Restore scroll position on mount\r\n  const restoreScrollPosition = useCallback(() => {\r\n    const position = restorePosition();\r\n    if (position && elementRef.current) {\r\n      // Delay restoration to ensure content is loaded\r\n      setTimeout(() => {\r\n        scrollToPosition(position);\r\n      }, delay);\r\n    }\r\n  }, [restorePosition, elementRef, scrollToPosition, delay]);\r\n  \r\n  // Save current position\r\n  const saveCurrentPosition = useCallback(() => {\r\n    if (!elementRef.current) return;\r\n    \r\n    const element = elementRef.current;\r\n    const position: ScrollPosition = {\r\n      x: element.scrollLeft,\r\n      y: element.scrollTop,\r\n      timestamp: Date.now()\r\n    };\r\n    \r\n    savePosition(position);\r\n  }, [elementRef, savePosition]);\r\n  \r\n  // Set up scroll listener\r\n  useEffect(() => {\r\n    const element = elementRef.current;\r\n    if (!element) return;\r\n    \r\n    element.addEventListener('scroll', handleScroll, { passive: true });\r\n    \r\n    return () => {\r\n      element.removeEventListener('scroll', handleScroll);\r\n      if (scrollTimeout.current) {\r\n        clearTimeout(scrollTimeout.current);\r\n      }\r\n    };\r\n  }, [handleScroll]);\r\n  \r\n  // Cleanup timeout on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (scrollTimeout.current) {\r\n        clearTimeout(scrollTimeout.current);\r\n      }\r\n    };\r\n  }, []);\r\n  \r\n  // Memoize the return object to prevent infinite loops in components\r\n  return useMemo(() => ({\r\n    restoreScrollPosition,\r\n    saveCurrentPosition,\r\n    scrollToPosition,\r\n    isRestoring: () => isRestoring.current\r\n  }), [restoreScrollPosition, saveCurrentPosition, scrollToPosition]);\r\n};\r\n\r\n// Hook for managing scroll restoration with intersection observer\r\nexport const useScrollRestorationWithVisibility = (\r\n  elementRef: React.RefObject<HTMLElement>,\r\n  savePosition: (position: ScrollPosition) => void,\r\n  restorePosition: () => ScrollPosition | null,\r\n  options: UseScrollRestorationOptions = {}\r\n) => {\r\n  const scrollRestoration = useScrollRestoration(elementRef, savePosition, restorePosition, options);\r\n  const isVisible = useRef(true);\r\n  \r\n  // Set up intersection observer to pause scroll saving when element is not visible\r\n  useEffect(() => {\r\n    const element = elementRef.current;\r\n    if (!element) return;\r\n    \r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          isVisible.current = entry.isIntersecting;\r\n        });\r\n      },\r\n      { threshold: 0.1 }\r\n    );\r\n    \r\n    observer.observe(element);\r\n    \r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, [elementRef]);\r\n  \r\n  // Enhanced save that checks visibility\r\n  const saveCurrentPosition = useCallback(() => {\r\n    if (isVisible.current) {\r\n      scrollRestoration.saveCurrentPosition();\r\n    }\r\n  }, [scrollRestoration]);\r\n  \r\n  // Memoize the return object to prevent infinite loops\r\n  return useMemo(() => ({\r\n    ...scrollRestoration,\r\n    saveCurrentPosition,\r\n    isVisible: () => isVisible.current\r\n  }), [scrollRestoration, saveCurrentPosition]);\r\n};\r\n\r\n// Hook for table scroll restoration with column/row awareness\r\nexport const useTableScrollRestoration = (\r\n  tableRef: React.RefObject<HTMLElement>,\r\n  savePosition: (position: ScrollPosition) => void,\r\n  restorePosition: () => ScrollPosition | null,\r\n  options: UseScrollRestorationOptions = {}\r\n) => {\r\n  const scrollRestoration = useScrollRestoration(tableRef, savePosition, restorePosition, {\r\n    ...options,\r\n    threshold: 5, // Lower threshold for tables\r\n    debounceMs: 50 // Faster response for tables\r\n  });\r\n  \r\n  // Enhanced restore that waits for table content\r\n  const restoreScrollPosition = useCallback(() => {\r\n    if (!tableRef.current) return;\r\n    \r\n    // Wait for table to be fully rendered\r\n    const checkTableReady = () => {\r\n      const table = tableRef.current;\r\n      if (!table) return;\r\n      \r\n      const rows = table.querySelectorAll('tr');\r\n      if (rows.length > 0) {\r\n        scrollRestoration.restoreScrollPosition();\r\n      } else {\r\n        // Retry after a short delay\r\n        setTimeout(checkTableReady, 50);\r\n      }\r\n    };\r\n    \r\n    checkTableReady();\r\n  }, [tableRef, scrollRestoration]);\r\n  \r\n  // Memoize the return object to prevent infinite loops\r\n  return useMemo(() => ({\r\n    ...scrollRestoration,\r\n    restoreScrollPosition\r\n  }), [scrollRestoration, restoreScrollPosition]);\r\n};\r\n\r\n// Hook for modal scroll restoration\r\nexport const useModalScrollRestoration = (\r\n  modalRef: React.RefObject<HTMLElement>,\r\n  modalId: string,\r\n  savePosition: (position: ScrollPosition) => void,\r\n  restorePosition: () => ScrollPosition | null,\r\n  isOpen: boolean\r\n) => {\r\n  const scrollRestoration = useScrollRestoration(modalRef, savePosition, restorePosition, {\r\n    smooth: false, // Instant scroll for modals\r\n    delay: 0,\r\n    threshold: 5,\r\n    debounceMs: 100\r\n  });\r\n  \r\n  // Restore position when modal opens\r\n  useEffect(() => {\r\n    if (isOpen && modalRef.current) {\r\n      // Small delay to ensure modal content is rendered\r\n      setTimeout(() => {\r\n        scrollRestoration.restoreScrollPosition();\r\n      }, 100);\r\n    }\r\n  }, [isOpen, modalRef, scrollRestoration]);\r\n  \r\n  // Save position when modal closes\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      scrollRestoration.saveCurrentPosition();\r\n    }\r\n  }, [isOpen, scrollRestoration]);\r\n  \r\n  // Return the memoized scrollRestoration object (already memoized by useScrollRestoration)\r\n  return scrollRestoration;\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1341,1344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1341,1344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useService Hook\r\n * Provides factory-routed service access for any service name\r\n * Supports multi-backend routing (mock vs Supabase)\r\n */\r\n\r\nimport {\r\n  customerService as factoryCustomerService,\r\n  productService as factoryProductService,\r\n  productSaleService as factoryProductSaleService,\r\n  jobWorkService as factoryJobWorkService,\r\n  companyService as factoryCompanyService,\r\n  notificationService as factoryNotificationService,\r\n  serviceContractService as factoryServiceContractService,\r\n  userService as factoryUserService,\r\n  rbacService as factoryRbacService,\r\n} from '@/services/serviceFactory';\r\n\r\ntype ServiceName =\r\n  | 'customerService'\r\n  | 'productService'\r\n  | 'productSaleService'\r\n  | 'jobWorkService'\r\n  | 'companyService'\r\n  | 'notificationService'\r\n  | 'serviceContractService'\r\n  | 'userService'\r\n  | 'rbacService';\r\n\r\n/**\r\n * Hook to get factory-routed services\r\n * Automatically routes to correct implementation based on VITE_API_MODE\r\n *\r\n * @param serviceName - Name of the service to retrieve\r\n * @returns The service instance (mock or Supabase based on environment)\r\n *\r\n * @example\r\n * const customerService = useService('customerService');\r\n * const customers = await customerService.getCustomers();\r\n */\r\nexport function useService(serviceName: ServiceName) {\r\n  const services: Record<ServiceName, any> = {\r\n    customerService: factoryCustomerService,\r\n    productService: factoryProductService,\r\n    productSaleService: factoryProductSaleService,\r\n    jobWorkService: factoryJobWorkService,\r\n    companyService: factoryCompanyService,\r\n    notificationService: factoryNotificationService,\r\n    serviceContractService: factoryServiceContractService,\r\n    userService: factoryUserService,\r\n    rbacService: factoryRbacService,\r\n  };\r\n\r\n  const service = services[serviceName];\r\n\r\n  if (!service) {\r\n    console.error(\r\n      `useService: Unknown service \"${serviceName}\". Available services: ${Object.keys(services).join(', ')}`\r\n    );\r\n    throw new Error(`Unknown service: ${serviceName}`);\r\n  }\r\n\r\n  return service;\r\n}\r\n\r\nexport type { ServiceName };","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useSessionManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useSupabaseContracts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useSupabaseCustomers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useSupabaseSales.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useSupabaseTickets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useTenantContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\hooks\\useToastCompat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\main-modular.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\ModuleRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\bootstrap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\components\\LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\components\\PageHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\components\\StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\hooks\\queryPatterns.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3195,3198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3195,3198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'states'. Either include it or remove the dependency array.","line":126,"column":6,"nodeType":"ArrayExpression","endLine":126,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [states]","fix":{"range":[3671,3673],"text":"[states]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'states'. Either include it or remove the dependency array.","line":130,"column":6,"nodeType":"ArrayExpression","endLine":130,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [states]","fix":{"range":[3774,3776],"text":"[states]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'states'. Either include it or remove the dependency array.","line":134,"column":6,"nodeType":"ArrayExpression","endLine":134,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [states]","fix":{"range":[3887,3889],"text":"[states]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * React Query Pattern Utilities\r\n * Standard patterns for consistent query hook implementation across all modules\r\n */\r\n\r\nimport { useCallback } from 'react';\r\nimport { QueryKey, UseQueryOptions, UseMutationOptions, MutationFunction } from '@tanstack/react-query';\r\n\r\n/**\r\n * Pattern 1: Standard Query Configuration\r\n * Use for simple data fetching without complex state management\r\n */\r\nexport const createQueryOptions = <TData>(\r\n  staleTime: number = 5 * 60 * 1000, // 5 minutes default\r\n  gcTime: number = 10 * 60 * 1000,   // 10 minutes default\r\n): Partial<UseQueryOptions<TData>> => ({\r\n  staleTime,\r\n  gcTime,\r\n  retry: 1,\r\n  retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),\r\n});\r\n\r\n/**\r\n * Pattern 2: Query Key Factory\r\n * Use to create consistent, hierarchical query keys\r\n * \r\n * Example:\r\n * const customerKeys = createQueryKeyFactory('customers');\r\n * queryKey: customerKeys.list(filters)\r\n */\r\nexport const createQueryKeyFactory = (feature: string) => ({\r\n  all: [feature] as const,\r\n  lists: () => [...[feature], 'list'] as const,\r\n  list: (filters: Record<string, unknown>) => [...[feature, 'list'], filters] as const,\r\n  details: () => [...[feature], 'detail'] as const,\r\n  detail: (id: string) => [...[feature, 'detail'], id] as const,\r\n  stats: () => [...[feature], 'stats'] as const,\r\n});\r\n\r\n/**\r\n * Pattern 3: Error Handler Wrapper\r\n * Standardize error handling across modules\r\n */\r\nexport const createErrorHandler = (\r\n  onError?: (error: Error) => void,\r\n  showNotification?: (message: string) => void\r\n) => {\r\n  return (error: unknown) => {\r\n    const errorMessage = error instanceof Error ? error.message : 'An error occurred';\r\n    console.error('Query error:', error);\r\n    \r\n    if (showNotification) {\r\n      showNotification(errorMessage);\r\n    }\r\n    \r\n    if (onError && error instanceof Error) {\r\n      onError(error);\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Pattern 4: Success Handler Wrapper\r\n * Standardize success handling across modules\r\n */\r\nexport const createSuccessHandler = <T>(\r\n  onSuccess?: (data: T) => void,\r\n  showNotification?: (message: string) => void\r\n) => {\r\n  return (data: T) => {\r\n    console.log('Query success:', data);\r\n    \r\n    if (showNotification) {\r\n      showNotification('Operation completed successfully');\r\n    }\r\n    \r\n    if (onSuccess) {\r\n      onSuccess(data);\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Pattern 5: Mutation Options Factory\r\n * Create consistent mutation configuration\r\n */\r\nexport const createMutationOptions = <TData, TError, TVariables>(\r\n  config: {\r\n    onSuccess?: (data: TData) => void;\r\n    onError?: (error: TError) => void;\r\n    successMessage?: string;\r\n    errorMessage?: string;\r\n    showNotifications?: boolean;\r\n  } = {}\r\n): UseMutationOptions<TData, TError, TVariables> => ({\r\n  retry: 1,\r\n  ...config,\r\n});\r\n\r\n/**\r\n * Pattern 6: Service Injection Pattern\r\n * Type-safe service injection in hooks\r\n * \r\n * Usage:\r\n * const service = injectService<MyService>('myService');\r\n */\r\nexport const injectService = <T>(serviceName: string): T => {\r\n  // This would be implemented by your dependency injection container\r\n  // For now, it's a type-safe wrapper\r\n  const container = (globalThis as any).__serviceContainer;\r\n  if (!container || !container[serviceName]) {\r\n    throw new Error(`Service ${serviceName} not found in container`);\r\n  }\r\n  return container[serviceName] as T;\r\n};\r\n\r\n/**\r\n * Pattern 7: Loading State Manager\r\n * Unified loading state handling\r\n */\r\nexport const useLoadingState = () => {\r\n  const states = new Map<string, boolean>();\r\n\r\n  const setLoading = useCallback((key: string, isLoading: boolean) => {\r\n    states.set(key, isLoading);\r\n  }, []);\r\n\r\n  const isLoading = useCallback((key: string) => {\r\n    return states.get(key) ?? false;\r\n  }, []);\r\n\r\n  const isAnyLoading = useCallback(() => {\r\n    return Array.from(states.values()).some((v) => v);\r\n  }, []);\r\n\r\n  return { setLoading, isLoading, isAnyLoading };\r\n};\r\n\r\n/**\r\n * Pattern 8: Pagination Helper\r\n * Standard pagination handling\r\n */\r\nexport interface PaginationState {\r\n  page: number;\r\n  pageSize: number;\r\n  total: number;\r\n  totalPages?: number;\r\n}\r\n\r\nexport const createPaginationHelper = (initial: PaginationState = { page: 1, pageSize: 50, total: 0 }) => {\r\n  const goToPage = (page: number) => ({\r\n    ...initial,\r\n    page,\r\n  });\r\n\r\n  const nextPage = () => ({\r\n    ...initial,\r\n    page: initial.page + 1,\r\n  });\r\n\r\n  const previousPage = () => ({\r\n    ...initial,\r\n    page: Math.max(1, initial.page - 1),\r\n  });\r\n\r\n  return {\r\n    goToPage,\r\n    nextPage,\r\n    previousPage,\r\n    canNext: () => initial.page < (initial.totalPages ?? Math.ceil(initial.total / initial.pageSize)),\r\n    canPrevious: () => initial.page > 1,\r\n  };\r\n};\r\n\r\n/**\r\n * Pattern 9: Filter Helper\r\n * Type-safe filter management\r\n */\r\nexport const createFilterHelper = <TFilters extends Record<string, unknown>>(initialFilters: TFilters) => {\r\n  const updateFilter = (key: keyof TFilters, value: unknown) => ({\r\n    ...initialFilters,\r\n    [key]: value,\r\n  });\r\n\r\n  const updateFilters = (updates: Partial<TFilters>) => ({\r\n    ...initialFilters,\r\n    ...updates,\r\n  });\r\n\r\n  const resetFilters = () => ({ ...initialFilters });\r\n\r\n  return {\r\n    updateFilter,\r\n    updateFilters,\r\n    resetFilters,\r\n    current: initialFilters,\r\n  };\r\n};\r\n\r\n/**\r\n * Pattern 10: Callback Deduplication (Used in Custom Wrapper)\r\n * Reference implementation for callback deduplication\r\n * \r\n * This pattern is automatically handled in /src/modules/core/hooks/useQuery.ts\r\n * Reference this when creating custom query wrappers\r\n */\r\nexport interface CallbackDeduplicationConfig {\r\n  /**\r\n   * Track if callback has fired for current data\r\n   */\r\n  callbackFiredRef: React.MutableRefObject<boolean>;\r\n  \r\n  /**\r\n   * Check if callback already fired\r\n   */\r\n  hasCallbackFired: () => boolean;\r\n  \r\n  /**\r\n   * Mark callback as fired\r\n   */\r\n  markCallbackFired: () => void;\r\n  \r\n  /**\r\n   * Reset for new query\r\n   */\r\n  resetCallback: () => void;\r\n}\r\n\r\nexport const createCallbackDeduplication = (): CallbackDeduplicationConfig => {\r\n  const callbackFiredRef = new Map<string, boolean>();\r\n\r\n  return {\r\n    callbackFiredRef: { current: false },\r\n    hasCallbackFired: () => callbackFiredRef.get('default') ?? false,\r\n    markCallbackFired: () => callbackFiredRef.set('default', true),\r\n    resetCallback: () => callbackFiredRef.set('default', false),\r\n  };\r\n};\r\n\r\n/**\r\n * Documentation: When to Use Each Pattern\r\n * \r\n * Pattern 1 (Query Options):\r\n * - When creating queries with standard stale/gc times\r\n * - Reduces configuration boilerplate\r\n * \r\n * Pattern 2 (Query Key Factory):\r\n * - Every module creating queries\r\n * - Ensures consistent key structure\r\n * \r\n * Pattern 3-4 (Error/Success Handlers):\r\n * - When you need custom error/success logic\r\n * - Avoid duplicating notification code\r\n * \r\n * Pattern 5 (Mutation Options):\r\n * - For all mutations\r\n * - Standardizes notification handling\r\n * \r\n * Pattern 6 (Service Injection):\r\n * - In all hooks using services\r\n * - Type-safe service access\r\n * \r\n * Pattern 7 (Loading State Manager):\r\n * - Complex forms with multiple loading states\r\n * - Track different operations simultaneously\r\n * \r\n * Pattern 8 (Pagination Helper):\r\n * - Any module with paginated lists\r\n * - Consistent pagination logic\r\n * \r\n * Pattern 9 (Filter Helper):\r\n * - Modules with complex filtering\r\n * - Type-safe filter updates\r\n * \r\n * Pattern 10 (Callback Deduplication):\r\n * - Reference only - handled automatically in core hook\r\n * - Use if creating custom query wrapper\r\n */\r\n\r\n/**\r\n * Complete Hook Implementation Example\r\n * \r\n * import { useQuery } from '@tanstack/react-query';\r\n * import { createQueryKeyFactory, createQueryOptions } from './queryPatterns';\r\n * \r\n * const customerKeys = createQueryKeyFactory('customers');\r\n * \r\n * export const useCustomers = (filters = {}) => {\r\n *   const service = useService<CustomerService>('customerService');\r\n *   \r\n *   return useQuery({\r\n *     queryKey: customerKeys.list(filters),\r\n *     queryFn: () => service.getCustomers(filters),\r\n *     ...createQueryOptions(),\r\n *   });\r\n * };\r\n */","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\hooks\\useQuery.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\hooks\\useService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\serviceContainer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\services\\BaseService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\services\\ServiceContainer.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1786,1789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1786,1789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1815,1818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1815,1818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2145,2148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2145,2148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2660,2663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2660,2663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3875,3878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3875,3878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4288,4291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4288,4291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4983,4986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4983,4986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5032,5035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5032,5035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5058,5061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5058,5061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6030,6033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6030,6033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6573,6576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6573,6576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9568,9571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9568,9571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Container - Dependency Injection Container\r\n * Manages service instances and their dependencies\r\n */\r\n\r\nexport interface ServiceConstructor<T = unknown> {\r\n  new (...args: unknown[]): T;\r\n}\r\n\r\nexport interface ServiceFactory<T = unknown> {\r\n  (): T;\r\n}\r\n\r\nexport type ServiceDefinition<T = unknown> = ServiceConstructor<T> | ServiceFactory<T>;\r\n\r\nexport class ServiceContainer {\r\n  private static instance: ServiceContainer;\r\n  private services = new Map<string, unknown>();\r\n  private singletons = new Map<string, unknown>();\r\n  private factories = new Map<string, ServiceDefinition>();\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): ServiceContainer {\r\n    if (!ServiceContainer.instance) {\r\n      ServiceContainer.instance = new ServiceContainer();\r\n    }\r\n    return ServiceContainer.instance;\r\n  }\r\n\r\n  /**\r\n   * Register a service with the container\r\n   */\r\n  register<T>(name: string, definition: ServiceDefinition<T>, singleton = true): void {\r\n    // Add validation and debugging\r\n    if (!definition) {\r\n      const error = `Cannot register service '${name}': definition is ${definition}`;\r\n      console.error(`[ServiceContainer] ${error}`);\r\n      throw new Error(error);\r\n    }\r\n    \r\n    const defType = typeof definition;\r\n    const hasProto = definition && typeof definition === 'function' ? definition.prototype : null;\r\n    const isConstructor = defType === 'function' && hasProto;\r\n    const isFactory = defType === 'function' && !hasProto;\r\n    \r\n    console.log(`[ServiceContainer.register] Registering '${name}'`, {\r\n      type: defType,\r\n      hasPrototype: !!hasProto,\r\n      protoType: hasProto ? hasProto.constructor?.name : 'N/A',\r\n      isConstructor,\r\n      isFactory,\r\n      isSingleton: singleton,\r\n      defName: (definition as any)?.name || (definition as any)?.constructor?.name || 'unknown',\r\n      toString: String(definition).substring(0, 150)\r\n    });\r\n    \r\n    if (!isConstructor && !isFactory) {\r\n      const error = `Cannot register service '${name}': definition must be a constructor or factory function. ` +\r\n        `Got type: ${defType}, constructor name: ${(definition as any)?.constructor?.name || 'unknown'}, ` +\r\n        `definition: ${String(definition).substring(0, 100)}`;\r\n      console.error(`[ServiceContainer] ${error}`);\r\n      throw new Error(error);\r\n    }\r\n    \r\n    this.factories.set(name, definition);\r\n    \r\n    // Verify what was actually stored\r\n    const stored = this.factories.get(name);\r\n    console.log(`[ServiceContainer.register] Verification - stored definition:`, {\r\n      isPresent: stored !== undefined,\r\n      type: typeof stored,\r\n      name: (stored as any)?.name || 'N/A',\r\n      sameAsInput: stored === definition,\r\n      storedProto: typeof stored === 'function' ? !!stored.prototype : 'N/A'\r\n    });\r\n    \r\n    if (singleton) {\r\n      this.singletons.set(name, null);\r\n    }\r\n    \r\n    console.log(`[ServiceContainer] ‚úì Registered service '${name}' as ${isConstructor ? 'constructor' : 'factory'}`);\r\n  }\r\n\r\n  /**\r\n   * Register a service instance\r\n   */\r\n  registerInstance<T>(name: string, instance: T): void {\r\n    this.services.set(name, instance);\r\n  }\r\n\r\n  /**\r\n   * Get a service instance\r\n   */\r\n  get<T>(name: string): T {\r\n    console.log(`[ServiceContainer.get] ‚ñ∂ Retrieving service '${name}'`, {\r\n      timestamp: new Date().toISOString(),\r\n      directInstanceExists: this.services.has(name),\r\n      singletonExists: this.singletons.has(name),\r\n      factoryExists: this.factories.has(name),\r\n      allRegisteredServices: Array.from(this.factories.keys())\r\n    });\r\n    \r\n    // Check if we have a direct instance\r\n    if (this.services.has(name)) {\r\n      const instance = this.services.get(name);\r\n      console.log(`[ServiceContainer.get] ‚úì Found direct instance for '${name}'`, {\r\n        type: typeof instance,\r\n        constructor: (instance as any)?.constructor?.name || 'unknown'\r\n      });\r\n      return instance as T;\r\n    }\r\n\r\n    // Check if it's a singleton and already created\r\n    if (this.singletons.has(name)) {\r\n      const existing = this.singletons.get(name);\r\n      if (existing) {\r\n        console.log(`[ServiceContainer.get] ‚úì Found existing singleton for '${name}'`, {\r\n          type: typeof existing,\r\n          constructor: (existing as any)?.constructor?.name || 'unknown'\r\n        });\r\n        return existing as T;\r\n      } else {\r\n        console.log(`[ServiceContainer.get] Singleton slot exists but is empty, will create new instance`);\r\n      }\r\n    }\r\n\r\n    // Create new instance\r\n    const factory = this.factories.get(name);\r\n    if (!factory) {\r\n      const error = `Service '${name}' not found in factories. Registered services: ${Array.from(this.factories.keys()).join(', ')}`;\r\n      console.error(`[ServiceContainer.get] ‚úó ${error}`);\r\n      throw new Error(error);\r\n    }\r\n\r\n    console.log(`[ServiceContainer.get] Factory retrieved for '${name}'`, {\r\n      type: typeof factory,\r\n      hasPrototype: !!(factory as any)?.prototype,\r\n      factoryName: (factory as any)?.name || (factory as any)?.constructor?.name || 'unknown',\r\n      toString: String(factory).substring(0, 150),\r\n      isFunction: typeof factory === 'function',\r\n      isCallable: typeof factory === 'function'\r\n    });\r\n\r\n    // Safety check: ensure factory is actually a function\r\n    if (typeof factory !== 'function') {\r\n      const msg = `CRITICAL: Service '${name}' has invalid definition in factories map! ` +\r\n        `Expected function but got ${typeof factory}. ` +\r\n        `Factory value: ${String(factory).substring(0, 150)}. ` +\r\n        `This indicates the service was registered with an incorrect definition.`;\r\n      console.error(`[ServiceContainer.get] ‚úó ${msg}`);\r\n      console.error(`[ServiceContainer.get] Factory map at retrieval time:`, {\r\n        name,\r\n        factories: Array.from(this.factories.entries()).map(([k, v]) => ({\r\n          key: k,\r\n          type: typeof v,\r\n          hasProto: typeof v === 'function' ? !!v.prototype : 'N/A',\r\n          name: (v as any)?.name || 'unknown'\r\n        }))\r\n      });\r\n      throw new Error(msg);\r\n    }\r\n\r\n    let instance: T;\r\n    if (typeof factory === 'function' && factory.prototype) {\r\n      // Constructor function\r\n      console.log(`[ServiceContainer.get] Instantiating '${name}' as constructor`);\r\n      try {\r\n        instance = new (factory as ServiceConstructor<T>)();\r\n        console.log(`[ServiceContainer.get] ‚úì Successfully instantiated '${name}' as constructor`, {\r\n          instanceType: typeof instance,\r\n          constructor: (instance as any)?.constructor?.name || 'unknown',\r\n          protoMethods: Object.getOwnPropertyNames(Object.getPrototypeOf(instance) || {})\r\n        });\r\n      } catch (error) {\r\n        const msg = `Failed to instantiate service '${name}' (constructor): ${error instanceof Error ? error.message : String(error)}`;\r\n        console.error(`[ServiceContainer.get] ‚úó ${msg}`);\r\n        throw new Error(msg);\r\n      }\r\n    } else if (typeof factory === 'function') {\r\n      // Factory function\r\n      console.log(`[ServiceContainer.get] Calling '${name}' as factory function`);\r\n      try {\r\n        instance = (factory as ServiceFactory<T>)();\r\n        console.log(`[ServiceContainer.get] ‚úì Successfully called '${name}' as factory function`);\r\n      } catch (error) {\r\n        const msg = `Failed to call factory for service '${name}': ${error instanceof Error ? error.message : String(error)}`;\r\n        console.error(`[ServiceContainer.get] ‚úó ${msg}`);\r\n        throw new Error(msg);\r\n      }\r\n    } else {\r\n      // This shouldn't happen given the safety check above, but just in case\r\n      const msg = `Service '${name}' has invalid definition: expected function but got ${typeof factory}. ` +\r\n        `Factory value: ${String(factory).substring(0, 100)}. ` +\r\n        `This suggests the service was registered incorrectly.`;\r\n      console.error(`[ServiceContainer.get] ‚úó ${msg}`);\r\n      throw new Error(msg);\r\n    }\r\n\r\n    // Store singleton\r\n    if (this.singletons.has(name)) {\r\n      this.singletons.set(name, instance);\r\n      console.log(`[ServiceContainer.get] Stored singleton instance for '${name}'`);\r\n    }\r\n\r\n    return instance;\r\n  }\r\n\r\n  /**\r\n   * Check if a service is registered\r\n   */\r\n  has(name: string): boolean {\r\n    return this.services.has(name) || this.factories.has(name);\r\n  }\r\n\r\n  /**\r\n   * Remove a service\r\n   */\r\n  remove(name: string): void {\r\n    this.services.delete(name);\r\n    this.singletons.delete(name);\r\n    this.factories.delete(name);\r\n  }\r\n\r\n  /**\r\n   * Clear all services\r\n   */\r\n  clear(): void {\r\n    this.services.clear();\r\n    this.singletons.clear();\r\n    this.factories.clear();\r\n  }\r\n\r\n  /**\r\n   * Get all registered service names\r\n   */\r\n  getRegisteredServices(): string[] {\r\n    const names = new Set<string>();\r\n    this.services.forEach((_, name) => names.add(name));\r\n    this.factories.forEach((_, name) => names.add(name));\r\n    return Array.from(names);\r\n  }\r\n\r\n  /**\r\n   * Register a service (compatibility method)\r\n   * Intelligently routes based on whether it's a constructor or instance\r\n   * - Constructor/function ‚Üí register() for on-demand instantiation\r\n   * - Object/instance ‚Üí registerInstance() for direct storage\r\n   */\r\n  registerService<T>(name: string, definition: T): void {\r\n    // Smart detection: Check if it's a constructor function\r\n    if (typeof definition === 'function' && definition.prototype) {\r\n      // It's a constructor - route to register for on-demand instantiation\r\n      this.register(name, definition as any);\r\n    } else if (typeof definition === 'object' && definition !== null) {\r\n      // It's an object/instance - route to registerInstance to store directly\r\n      this.registerInstance(name, definition);\r\n    } else {\r\n      // Unsupported type\r\n      throw new Error(\r\n        `Cannot register service '${name}': must be a constructor function or object instance. Got type: ${typeof definition}`\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unregister a service (compatibility method)\r\n   * Alias for remove for modules using unregisterService pattern\r\n   */\r\n  unregisterService(name: string): void {\r\n    this.remove(name);\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const serviceContainer = ServiceContainer.getInstance();\r\n\r\n// Decorator for service injection\r\nexport function Injectable(name: string) {\r\n  return function <T extends ServiceConstructor>(constructor: T) {\r\n    serviceContainer.register(name, constructor);\r\n    return constructor;\r\n  };\r\n}\r\n\r\n// Helper function for service injection\r\nexport function inject<T>(name: string): T {\r\n  console.log(`[inject] Called for '${name}'`);\r\n  try {\r\n    const result = serviceContainer.get<T>(name);\r\n    console.log(`[inject] ‚úì Successfully retrieved '${name}'`);\r\n    return result;\r\n  } catch (error) {\r\n    console.error(`[inject] ‚úó Failed to retrieve '${name}':`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Service registration helper\r\nexport function registerService<T>(\r\n  name: string,\r\n  definition: ServiceDefinition<T>,\r\n  singleton = true\r\n): void {\r\n  console.log(`[registerService] Called for '${name}' (singleton: ${singleton})`);\r\n  serviceContainer.register(name, definition, singleton);\r\n}\r\n\r\n// Service instance registration helper\r\nexport function registerServiceInstance<T>(name: string, instance: T): void {\r\n  serviceContainer.registerInstance(name, instance);\r\n}\r\n\r\n// Service unregistration helper\r\nexport function unregisterService(name: string): void {\r\n  serviceContainer.remove(name);\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\store\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\store\\slices\\authSlice.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\store\\slices\\notificationSlice.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\store\\slices\\uiSlice.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\core\\utils\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\audit-logs\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\audit-logs\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":12,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":12,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Audit Logs Routes\r\n */\r\nimport React, { lazy } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\n\r\n// Lazy load components\r\nconst LogsPage = lazy(() => import('./views/LogsPage'));\r\n\r\n// Route wrapper with error boundary\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      {children}\r\n    </React.Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const auditLogsRoutes: RouteObject[] = [\r\n  {\r\n    path: 'logs',\r\n    element: (\r\n      <RouteWrapper>\r\n        <LogsPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\audit-logs\\views\\LogsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1193,1196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1193,1196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'auditService'. Either include it or remove the dependency array.","line":85,"column":6,"nodeType":"ArrayExpression","endLine":85,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [searchTerm, actionFilter, resourceFilter, dateRange, auditService]","fix":{"range":[2562,2615],"text":"[searchTerm, actionFilter, resourceFilter, dateRange, auditService]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Logs Page - Enterprise Design\r\n * Audit log viewer with advanced filtering and export\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Table, \r\n  Button, \r\n  Input, \r\n  Select, \r\n  DatePicker, \r\n  Tag, \r\n  Space, \r\n  Modal,\r\n  Descriptions,\r\n  message,\r\n  Tooltip\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport { \r\n  SearchOutlined, \r\n  DownloadOutlined,\r\n  EyeOutlined,\r\n  ReloadOutlined,\r\n  FilterOutlined\r\n} from '@ant-design/icons';\r\nimport { \r\n  FileText,\r\n  Activity,\r\n  User,\r\n  AlertCircle\r\n} from 'lucide-react';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport dayjs, { Dayjs } from 'dayjs';\r\nimport type { AuditLog } from '@/services/auditService';\r\n\r\nconst { RangePicker } = DatePicker;\r\n\r\ninterface AuditLogFilters {\r\n  search?: string;\r\n  action?: string;\r\n  resource?: string;\r\n  dateFrom?: string;\r\n  dateTo?: string;\r\n}\r\n\r\nexport const LogsPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const auditService = useService<any>('auditService');\r\n  const [logs, setLogs] = useState<AuditLog[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [actionFilter, setActionFilter] = useState<string>('');\r\n  const [resourceFilter, setResourceFilter] = useState<string>('');\r\n  const [dateRange, setDateRange] = useState<[Dayjs | null, Dayjs | null]>([null, null]);\r\n  const [selectedLog, setSelectedLog] = useState<AuditLog | null>(null);\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n\r\n  const fetchLogs = useCallback(async (): Promise<void> => {\r\n    try {\r\n      setLoading(true);\r\n      const filters: AuditLogFilters = {};\r\n      \r\n      if (searchTerm) filters.search = searchTerm;\r\n      if (actionFilter) filters.action = actionFilter;\r\n      if (resourceFilter) filters.resource = resourceFilter;\r\n      if (dateRange[0]) filters.dateFrom = dateRange[0].toISOString();\r\n      if (dateRange[1]) filters.dateTo = dateRange[1].toISOString();\r\n\r\n      const data = await auditService.getAuditLogs(filters);\r\n      setLogs(data);\r\n    } catch (error: unknown) {\r\n      console.error('Failed to fetch logs:', error);\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to fetch audit logs';\r\n      message.error(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [searchTerm, actionFilter, resourceFilter, dateRange]);\r\n\r\n  useEffect(() => {\r\n    void fetchLogs();\r\n  }, [fetchLogs]);\r\n\r\n  const handleExport = async (format: 'csv' | 'json') => {\r\n    try {\r\n      const filters: AuditLogFilters = {};\r\n      if (searchTerm) filters.search = searchTerm;\r\n      if (actionFilter) filters.action = actionFilter;\r\n      if (resourceFilter) filters.resource = resourceFilter;\r\n      if (dateRange[0]) filters.dateFrom = dateRange[0].toISOString();\r\n      if (dateRange[1]) filters.dateTo = dateRange[1].toISOString();\r\n\r\n      const blob = await auditService.exportAuditLogs(filters, format);\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `audit_logs_${new Date().toISOString().split('T')[0]}.${format}`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n      message.success(`Logs exported as ${format.toUpperCase()}`);\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to export logs';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleViewDetails = (log: AuditLog) => {\r\n    setSelectedLog(log);\r\n    setShowDetailModal(true);\r\n  };\r\n\r\n  const getActionColor = (action: string) => {\r\n    switch (action.toUpperCase()) {\r\n      case 'CREATE':\r\n        return 'success';\r\n      case 'UPDATE':\r\n        return 'processing';\r\n      case 'DELETE':\r\n        return 'error';\r\n      case 'LOGIN':\r\n        return 'cyan';\r\n      case 'LOGOUT':\r\n        return 'default';\r\n      case 'EXPORT':\r\n        return 'warning';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  const getResourceColor = (resource: string) => {\r\n    const colors: Record<string, string> = {\r\n      customer: 'blue',\r\n      deal: 'green',\r\n      contract: 'purple',\r\n      ticket: 'orange',\r\n      user: 'magenta',\r\n      auth: 'cyan',\r\n      product: 'geekblue',\r\n      company: 'gold'\r\n    };\r\n    return colors[resource.toLowerCase()] || 'default';\r\n  };\r\n\r\n  const columns: ColumnsType<AuditLog> = [\r\n    {\r\n      title: 'Timestamp',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      width: 180,\r\n      render: (date) => new Date(date).toLocaleString(),\r\n      sorter: (a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime(),\r\n      defaultSortOrder: 'descend'\r\n    },\r\n    {\r\n      title: 'User',\r\n      dataIndex: ['user', 'name'],\r\n      key: 'user',\r\n      width: 150,\r\n      render: (_, record) => (\r\n        <Tooltip title={record.user.email}>\r\n          <Space>\r\n            <User size={14} />\r\n            {record.user.name}\r\n          </Space>\r\n        </Tooltip>\r\n      )\r\n    },\r\n    {\r\n      title: 'Action',\r\n      dataIndex: 'action',\r\n      key: 'action',\r\n      width: 100,\r\n      render: (action) => (\r\n        <Tag color={getActionColor(action)}>\r\n          {action.toUpperCase()}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Resource',\r\n      dataIndex: 'resource',\r\n      key: 'resource',\r\n      width: 120,\r\n      render: (resource) => (\r\n        <Tag color={getResourceColor(resource)}>\r\n          {resource.toUpperCase()}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Resource ID',\r\n      dataIndex: 'resourceId',\r\n      key: 'resourceId',\r\n      width: 120,\r\n      ellipsis: true\r\n    },\r\n    {\r\n      title: 'IP Address',\r\n      dataIndex: 'ipAddress',\r\n      key: 'ipAddress',\r\n      width: 130\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      width: 80,\r\n      fixed: 'right',\r\n      render: (_, record) => (\r\n        <Button\r\n          type=\"text\"\r\n          size=\"small\"\r\n          icon={<EyeOutlined />}\r\n          onClick={() => handleViewDetails(record)}\r\n        >\r\n          View\r\n        </Button>\r\n      )\r\n    }\r\n  ];\r\n\r\n  const stats = {\r\n    total: logs.length,\r\n    today: logs.filter(log => {\r\n      const logDate = new Date(log.createdAt);\r\n      const today = new Date();\r\n      return logDate.toDateString() === today.toDateString();\r\n    }).length,\r\n    creates: logs.filter(log => log.action === 'CREATE').length,\r\n    updates: logs.filter(log => log.action === 'UPDATE').length\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Audit Logs\"\r\n        description=\"View system audit logs and user activity\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/dashboard' },\r\n            { title: 'Audit Logs' }\r\n          ]\r\n        }}\r\n        extra={\r\n          <Space>\r\n            <Button \r\n              icon={<ReloadOutlined />} \r\n              onClick={fetchLogs}\r\n            >\r\n              Refresh\r\n            </Button>\r\n            <Button \r\n              icon={<DownloadOutlined />} \r\n              onClick={() => handleExport('csv')}\r\n              disabled={!hasPermission('export_logs')}\r\n            >\r\n              Export CSV\r\n            </Button>\r\n            <Button \r\n              icon={<DownloadOutlined />} \r\n              onClick={() => handleExport('json')}\r\n              disabled={!hasPermission('export_logs')}\r\n            >\r\n              Export JSON\r\n            </Button>\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Logs\"\r\n              value={stats.total}\r\n              description=\"All audit logs\"\r\n              icon={FileText}\r\n              color=\"primary\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Today's Activity\"\r\n              value={stats.today}\r\n              description=\"Logs from today\"\r\n              icon={Activity}\r\n              color=\"info\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Creates\"\r\n              value={stats.creates}\r\n              description=\"Create operations\"\r\n              icon={FileText}\r\n              color=\"success\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Updates\"\r\n              value={stats.updates}\r\n              description=\"Update operations\"\r\n              icon={AlertCircle}\r\n              color=\"warning\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Row gutter={[16, 16]}>\r\n            <Col xs={24} md={8}>\r\n              <Input\r\n                placeholder=\"Search logs...\"\r\n                prefix={<SearchOutlined />}\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                allowClear\r\n              />\r\n            </Col>\r\n            <Col xs={24} md={5}>\r\n              <Select\r\n                placeholder=\"Filter by action\"\r\n                value={actionFilter}\r\n                onChange={setActionFilter}\r\n                style={{ width: '100%' }}\r\n                allowClear\r\n              >\r\n                <Select.Option value=\"\">All Actions</Select.Option>\r\n                <Select.Option value=\"CREATE\">Create</Select.Option>\r\n                <Select.Option value=\"UPDATE\">Update</Select.Option>\r\n                <Select.Option value=\"DELETE\">Delete</Select.Option>\r\n                <Select.Option value=\"LOGIN\">Login</Select.Option>\r\n                <Select.Option value=\"LOGOUT\">Logout</Select.Option>\r\n                <Select.Option value=\"EXPORT\">Export</Select.Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} md={5}>\r\n              <Select\r\n                placeholder=\"Filter by resource\"\r\n                value={resourceFilter}\r\n                onChange={setResourceFilter}\r\n                style={{ width: '100%' }}\r\n                allowClear\r\n              >\r\n                <Select.Option value=\"\">All Resources</Select.Option>\r\n                <Select.Option value=\"customer\">Customer</Select.Option>\r\n                <Select.Option value=\"deal\">Deal</Select.Option>\r\n                <Select.Option value=\"contract\">Contract</Select.Option>\r\n                <Select.Option value=\"ticket\">Ticket</Select.Option>\r\n                <Select.Option value=\"user\">User</Select.Option>\r\n                <Select.Option value=\"auth\">Auth</Select.Option>\r\n                <Select.Option value=\"product\">Product</Select.Option>\r\n                <Select.Option value=\"company\">Company</Select.Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} md={6}>\r\n              <RangePicker\r\n                style={{ width: '100%' }}\r\n                value={dateRange}\r\n                onChange={(dates) => setDateRange(dates as [Dayjs | null, Dayjs | null])}\r\n                format=\"YYYY-MM-DD\"\r\n              />\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Logs Table */}\r\n        <Card>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={logs}\r\n            rowKey=\"id\"\r\n            loading={loading}\r\n            scroll={{ x: 1200 }}\r\n            pagination={{\r\n              pageSize: 20,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} logs`\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Detail Modal */}\r\n      <Modal\r\n        title=\"Audit Log Details\"\r\n        open={showDetailModal}\r\n        onCancel={() => {\r\n          setShowDetailModal(false);\r\n          setSelectedLog(null);\r\n        }}\r\n        footer={[\r\n          <Button key=\"close\" onClick={() => setShowDetailModal(false)}>\r\n            Close\r\n          </Button>\r\n        ]}\r\n        width={800}\r\n      >\r\n        {selectedLog && (\r\n          <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\r\n            <Descriptions bordered column={2}>\r\n              <Descriptions.Item label=\"Log ID\" span={2}>\r\n                {selectedLog.id}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Action\">\r\n                <Tag color={getActionColor(selectedLog.action)}>\r\n                  {selectedLog.action.toUpperCase()}\r\n                </Tag>\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Resource\">\r\n                <Tag color={getResourceColor(selectedLog.resource)}>\r\n                  {selectedLog.resource.toUpperCase()}\r\n                </Tag>\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Resource ID\" span={2}>\r\n                {selectedLog.resourceId}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"User\">\r\n                {selectedLog.user.name}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Email\">\r\n                {selectedLog.user.email}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"IP Address\">\r\n                {selectedLog.ipAddress}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Timestamp\">\r\n                {new Date(selectedLog.createdAt).toLocaleString()}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"User Agent\" span={2}>\r\n                <div style={{ wordBreak: 'break-all', fontSize: '12px' }}>\r\n                  {selectedLog.userAgent}\r\n                </div>\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n\r\n            {selectedLog.changes && (\r\n              <Card title=\"Changes\" size=\"small\">\r\n                <Row gutter={16}>\r\n                  <Col span={12}>\r\n                    <h4>Before:</h4>\r\n                    <pre style={{ \r\n                      background: '#f5f5f5', \r\n                      padding: 12, \r\n                      borderRadius: 4,\r\n                      fontSize: 12,\r\n                      maxHeight: 200,\r\n                      overflow: 'auto'\r\n                    }}>\r\n                      {JSON.stringify(selectedLog.changes.before, null, 2)}\r\n                    </pre>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <h4>After:</h4>\r\n                    <pre style={{ \r\n                      background: '#f5f5f5', \r\n                      padding: 12, \r\n                      borderRadius: 4,\r\n                      fontSize: 12,\r\n                      maxHeight: 200,\r\n                      overflow: 'auto'\r\n                    }}>\r\n                      {JSON.stringify(selectedLog.changes.after, null, 2)}\r\n                    </pre>\r\n                  </Col>\r\n                </Row>\r\n              </Card>\r\n            )}\r\n\r\n            {selectedLog.metadata && Object.keys(selectedLog.metadata).length > 0 && (\r\n              <Card title=\"Metadata\" size=\"small\">\r\n                <pre style={{ \r\n                  background: '#f5f5f5', \r\n                  padding: 12, \r\n                  borderRadius: 4,\r\n                  fontSize: 12,\r\n                  maxHeight: 200,\r\n                  overflow: 'auto'\r\n                }}>\r\n                  {JSON.stringify(selectedLog.metadata, null, 2)}\r\n                </pre>\r\n              </Card>\r\n            )}\r\n          </Space>\r\n        )}\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default LogsPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\auth\\routes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\auth\\views\\DemoAccountsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\auth\\views\\LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\auth\\views\\NotFoundPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\complaints\\components\\ComplaintsFormPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4960,4963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4960,4963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6409,6412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6409,6412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Complaints Form Panel - ENTERPRISE EDITION\r\n * Side drawer for creating/editing complaints with professional enterprise features\r\n * ‚úÖ Auto-generated complaint numbers (CMP-YYYYMM-0001 format)\r\n * ‚úÖ Professional SLA and resolution time tracking based on complaint type\r\n * ‚úÖ Advanced complaint categorization with intelligent engineer routing\r\n * ‚úÖ Enterprise-level form organization and validation\r\n * Features:\r\n *   - Auto-generated unique complaint numbers with tenant isolation\r\n *   - Professional SLA/priority cards with resolution time estimates\r\n *   - Advanced type-based categorization with department routing\r\n *   - Customer relationship display with linked alert\r\n *   - Intelligent status workflow management\r\n *   - Priority escalation tracking\r\n *   - Engineer assignment and availability management\r\n *   - Tag suggestions and management (specific to complaint types)\r\n *   - Due date/SLA deadline tracking with alerts\r\n *   - Detailed complaint notes and resolution documentation\r\n * RBAC Integration: Controls create/edit form permissions\r\n */\r\n\r\nimport React, { useEffect, useCallback, useState, useMemo } from 'react';\r\nimport {\r\n  Drawer,\r\n  Form,\r\n  Input,\r\n  Button,\r\n  Select,\r\n  DatePicker,\r\n  TimePicker,\r\n  Spin,\r\n  Space,\r\n  Divider,\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Tag,\r\n  Badge,\r\n  Alert,\r\n  Tooltip,\r\n  Statistic,\r\n  Empty,\r\n  message,\r\n} from 'antd';\r\nimport {\r\n  ClockCircleOutlined,\r\n  AlertOutlined,\r\n  CheckCircleOutlined,\r\n  UserOutlined,\r\n  BgColorsOutlined,\r\n  LockOutlined,\r\n  FileTextOutlined,\r\n  LinkOutlined,\r\n  ToolOutlined,\r\n  BugOutlined,\r\n  WarningOutlined,\r\n  ThunderboltOutlined,\r\n} from '@ant-design/icons';\r\nimport { Complaint } from '@/types/complaints';\r\nimport dayjs from 'dayjs';\r\n\r\ninterface ComplaintsFormPanelProps {\r\n  complaint: Complaint | null;\r\n  mode: 'create' | 'edit';\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\n// Enterprise status configuration with SLA definitions\r\nconst STATUSES = [\r\n  { label: 'New', value: 'new', color: 'warning', icon: 'üìå' },\r\n  { label: 'In Progress', value: 'in_progress', color: 'processing', icon: '‚è≥' },\r\n  { label: 'On Hold', value: 'on_hold', color: 'default', icon: '‚è∏' },\r\n  { label: 'Closed', value: 'closed', color: 'success', icon: '‚úì' },\r\n];\r\n\r\n// Priority levels with SLA time expectations (optimized for technical support)\r\nconst PRIORITIES = [\r\n  { \r\n    label: 'Low', \r\n    value: 'low', \r\n    color: 'default', \r\n    responseTime: '24 hours',\r\n    resolutionTime: '7 days',\r\n    icon: 'üìä'\r\n  },\r\n  { \r\n    label: 'Medium', \r\n    value: 'medium', \r\n    color: 'processing', \r\n    responseTime: '8 hours',\r\n    resolutionTime: '3 days',\r\n    icon: '‚ö†Ô∏è'\r\n  },\r\n  { \r\n    label: 'High', \r\n    value: 'high', \r\n    color: 'warning', \r\n    responseTime: '2 hours',\r\n    resolutionTime: '24 hours',\r\n    icon: 'üî¥'\r\n  },\r\n  { \r\n    label: 'Urgent', \r\n    value: 'urgent', \r\n    color: 'red', \r\n    responseTime: '30 minutes',\r\n    resolutionTime: '4 hours',\r\n    icon: 'üö®'\r\n  },\r\n];\r\n\r\n// Complaint type configuration with SLA and routing\r\nconst COMPLAINT_TYPES = [\r\n  { \r\n    label: 'Equipment Breakdown', \r\n    value: 'breakdown', \r\n    color: 'red',\r\n    department: 'Maintenance Team',\r\n    slaResponse: '1 hour',\r\n    slaResolution: '4 hours',\r\n    icon: <BugOutlined />\r\n  },\r\n  { \r\n    label: 'Preventive Maintenance', \r\n    value: 'preventive', \r\n    color: 'blue',\r\n    department: 'Service Team',\r\n    slaResponse: '8 hours',\r\n    slaResolution: '5 days',\r\n    icon: <ToolOutlined />\r\n  },\r\n  { \r\n    label: 'Software Update', \r\n    value: 'software_update', \r\n    color: 'cyan',\r\n    department: 'Software Team',\r\n    slaResponse: '4 hours',\r\n    slaResolution: '2 days',\r\n    icon: <FileTextOutlined />\r\n  },\r\n  { \r\n    label: 'Optimization Request', \r\n    value: 'optimize', \r\n    color: 'green',\r\n    department: 'Technical Team',\r\n    slaResponse: '24 hours',\r\n    slaResolution: '7 days',\r\n    icon: <CheckCircleOutlined />\r\n  },\r\n];\r\n\r\n// Suggested tags for quick categorization\r\nconst SUGGESTED_TAGS = [\r\n  'urgent_response_needed',\r\n  'customer_escalation',\r\n  'warranty_claim',\r\n  'requires_parts',\r\n  'requires_technician_visit',\r\n  'documentation_needed',\r\n  'customer_training',\r\n  'follow_up_required',\r\n  'critical_system',\r\n  'multiple_units',\r\n];\r\n\r\nexport const ComplaintsFormPanel: React.FC<ComplaintsFormPanelProps> = ({\r\n  complaint,\r\n  mode,\r\n  isOpen,\r\n  onClose,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [priority, setPriority] = useState<string>(complaint?.priority || 'medium');\r\n  const [complaintType, setComplaintType] = useState<string>(complaint?.type || 'breakdown');\r\n  const [tags, setTags] = useState<string[]>(complaint?.tags || []);\r\n  const [complaintNumber, setComplaintNumber] = useState<string>('');\r\n  const [customerAlert, setCustomerAlert] = useState<string>('');\r\n  const [formInstance, setFormInstance] = useState<any>(null);\r\n\r\n  // Initialize complaint number on mount\r\n  useEffect(() => {\r\n    if (mode === 'create' && isOpen) {\r\n      const now = new Date();\r\n      const year = now.getFullYear();\r\n      const month = String(now.getMonth() + 1).padStart(2, '0');\r\n      const random = String(Math.floor(Math.random() * 9999)).padStart(4, '0');\r\n      const newNumber = `CMP-${year}${month}-${random}`;\r\n      setComplaintNumber(newNumber);\r\n    } else if (complaint?.complaint_number) {\r\n      setComplaintNumber(complaint.complaint_number);\r\n    }\r\n  }, [mode, isOpen, complaint]);\r\n\r\n  // Calculate SLA information based on type and priority\r\n  const slaDeatails = useMemo(() => {\r\n    const typeConfig = COMPLAINT_TYPES.find(t => t.value === complaintType);\r\n    const priorityConfig = PRIORITIES.find(p => p.value === priority);\r\n    \r\n    if (!typeConfig || !priorityConfig) return null;\r\n\r\n    return {\r\n      type: typeConfig,\r\n      priority: priorityConfig,\r\n      responseDeadline: dayjs().add(2, 'hours'), // Simplified\r\n      resolutionDeadline: dayjs().add(1, 'day'), // Simplified\r\n    };\r\n  }, [complaintType, priority]);\r\n\r\n  // Get department based on type\r\n  const assignedDepartment = useMemo(() => {\r\n    const typeConfig = COMPLAINT_TYPES.find(t => t.value === complaintType);\r\n    return typeConfig?.department || 'Support Team';\r\n  }, [complaintType]);\r\n\r\n  // Handle form submission\r\n  const handleSubmit = useCallback(async (values: any) => {\r\n    try {\r\n      setIsSubmitting(true);\r\n      const submitData = {\r\n        ...values,\r\n        complaint_number: complaintNumber,\r\n        tags: tags,\r\n        assigned_department: assignedDepartment,\r\n      };\r\n\r\n      // Simulate API call\r\n      console.log('Submitting complaint:', submitData);\r\n      message.success('Complaint saved successfully');\r\n      onClose();\r\n      form.resetFields();\r\n    } catch (error) {\r\n      message.error('Failed to save complaint');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [complaintNumber, tags, assignedDepartment, onClose, form]);\r\n\r\n  // Add tag\r\n  const addTag = useCallback((tag: string) => {\r\n    if (!tags.includes(tag)) {\r\n      setTags([...tags, tag]);\r\n    }\r\n  }, [tags]);\r\n\r\n  // Remove tag\r\n  const removeTag = useCallback((tag: string) => {\r\n    setTags(tags.filter(t => t !== tag));\r\n  }, [tags]);\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>\r\n          <span>{mode === 'create' ? 'Create Complaint' : 'Edit Complaint'}</span>\r\n          {complaintNumber && (\r\n            <Tag color=\"blue\" style={{ marginRight: 16 }}>\r\n              {complaintNumber}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n      }\r\n      placement=\"right\"\r\n      onClose={onClose}\r\n      open={isOpen}\r\n      width={800}\r\n      styles={{ body: { padding: '24px' } }}\r\n    >\r\n      <Spin spinning={isSubmitting}>\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          initialValues={complaint || {}}\r\n          onFinish={handleSubmit}\r\n          autoComplete=\"off\"\r\n        >\r\n          {/* ===== 1. Complaint Information Card ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <BugOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Complaint Information\r\n              </h3>\r\n            </div>\r\n\r\n            <Card size=\"small\" style={{ marginBottom: 16, backgroundColor: '#f9fafb' }}>\r\n              <Row gutter={16}>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic \r\n                    title=\"Complaint ID\" \r\n                    value={complaintNumber}\r\n                    prefix={<LinkOutlined />}\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic \r\n                    title=\"Status\" \r\n                    value={complaint?.status?.toUpperCase() || 'NEW'}\r\n                    valueStyle={{ color: '#1890ff' }}\r\n                  />\r\n                </Col>\r\n              </Row>\r\n            </Card>\r\n\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label={<><WarningOutlined /> Priority Level</>}\r\n                  name=\"priority\"\r\n                  rules={[{ required: true, message: 'Please select priority' }]}\r\n                >\r\n                  <Select\r\n                    placeholder=\"Select priority\"\r\n                    value={priority}\r\n                    onChange={setPriority}\r\n                    options={PRIORITIES.map(p => ({\r\n                      label: `${p.icon} ${p.label}`,\r\n                      value: p.value,\r\n                    }))}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label={<><ToolOutlined /> Complaint Type</>}\r\n                  name=\"type\"\r\n                  rules={[{ required: true, message: 'Please select type' }]}\r\n                >\r\n                  <Select\r\n                    placeholder=\"Select complaint type\"\r\n                    value={complaintType}\r\n                    onChange={setComplaintType}\r\n                    options={COMPLAINT_TYPES.map(t => ({\r\n                      label: `${t.label}`,\r\n                      value: t.value,\r\n                    }))}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 2. SLA & Type Information Card ===== */}\r\n          {slaDeatails && (\r\n            <div style={{ marginBottom: 24 }}>\r\n              <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n                <ClockCircleOutlined style={{ marginRight: 8, fontSize: 18, color: '#dc2626' }} />\r\n                <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                  SLA & Resolution Time\r\n                </h3>\r\n              </div>\r\n\r\n              <Card\r\n                size=\"small\"\r\n                style={{\r\n                  marginBottom: 16,\r\n                  borderLeft: `4px solid #${slaDeatails.type.color}`,\r\n                  backgroundColor: '#fef3c7',\r\n                }}\r\n              >\r\n                <Row gutter={16}>\r\n                  <Col xs={24} sm={12}>\r\n                    <Statistic\r\n                      title=\"Response Time\"\r\n                      value={slaDeatails.type.slaResponse}\r\n                      prefix={<ThunderboltOutlined />}\r\n                      valueStyle={{ color: '#d97706' }}\r\n                    />\r\n                  </Col>\r\n                  <Col xs={24} sm={12}>\r\n                    <Statistic\r\n                      title=\"Resolution Target\"\r\n                      value={slaDeatails.type.slaResolution}\r\n                      prefix={<CheckCircleOutlined />}\r\n                      valueStyle={{ color: '#059669' }}\r\n                    />\r\n                  </Col>\r\n                </Row>\r\n              </Card>\r\n\r\n              <Alert\r\n                message={`This ${slaDeatails.type.label.toLowerCase()} will be routed to: ${assignedDepartment}`}\r\n                type=\"info\"\r\n                showIcon\r\n                style={{ marginBottom: 16 }}\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 3. Complaint Details ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <FileTextOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Complaint Details\r\n              </h3>\r\n            </div>\r\n\r\n            <Form.Item\r\n              label=\"Title\"\r\n              name=\"title\"\r\n              rules={[\r\n                { required: true, message: 'Please enter complaint title' },\r\n                { min: 5, message: 'Title must be at least 5 characters' },\r\n                { max: 100, message: 'Title must not exceed 100 characters' },\r\n              ]}\r\n            >\r\n              <Input \r\n                placeholder=\"Brief summary of the complaint\"\r\n                showCount\r\n                maxLength={100}\r\n              />\r\n            </Form.Item>\r\n\r\n            <Form.Item\r\n              label=\"Detailed Description\"\r\n              name=\"description\"\r\n              rules={[\r\n                { required: true, message: 'Please enter complaint description' },\r\n                { min: 10, message: 'Description must be at least 10 characters' },\r\n                { max: 1000, message: 'Description must not exceed 1000 characters' },\r\n              ]}\r\n            >\r\n              <Input.TextArea\r\n                rows={5}\r\n                placeholder=\"Provide detailed information about the complaint...\"\r\n                showCount\r\n                maxLength={1000}\r\n              />\r\n            </Form.Item>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 4. Customer & Assignment ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <UserOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Customer & Assignment\r\n              </h3>\r\n            </div>\r\n\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Customer\"\r\n                  name=\"customer_id\"\r\n                  rules={[{ required: true, message: 'Please select customer' }]}\r\n                >\r\n                  <Select placeholder=\"Select customer\" />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Assigned Engineer\"\r\n                  name=\"assigned_engineer_id\"\r\n                >\r\n                  <Select \r\n                    placeholder=\"Assign to engineer\"\r\n                    allowClear\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 5. Timeline & Deadlines ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <ClockCircleOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Timeline & Deadlines\r\n              </h3>\r\n            </div>\r\n\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Target Response Date\"\r\n                  name=\"response_target_date\"\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Target Resolution Date\"\r\n                  name=\"resolution_target_date\"\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 6. Tags & Metadata ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <BgColorsOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Tags & Metadata\r\n              </h3>\r\n            </div>\r\n\r\n            <div style={{ marginBottom: 12 }}>\r\n              <label style={{ display: 'block', marginBottom: 8, color: '#666' }}>\r\n                Current Tags\r\n              </label>\r\n              <Space wrap>\r\n                {tags.length === 0 ? (\r\n                  <span style={{ color: '#999' }}>No tags selected</span>\r\n                ) : (\r\n                  tags.map(tag => (\r\n                    <Tag\r\n                      key={tag}\r\n                      closable\r\n                      onClose={() => removeTag(tag)}\r\n                      color=\"blue\"\r\n                    >\r\n                      {tag}\r\n                    </Tag>\r\n                  ))\r\n                )}\r\n              </Space>\r\n            </div>\r\n\r\n            <div>\r\n              <label style={{ display: 'block', marginBottom: 8, color: '#666' }}>\r\n                Suggested Tags (Click to add)\r\n              </label>\r\n              <Space wrap>\r\n                {SUGGESTED_TAGS.map(suggestedTag => (\r\n                  <Tag\r\n                    key={suggestedTag}\r\n                    onClick={() => addTag(suggestedTag)}\r\n                    style={{\r\n                      cursor: 'pointer',\r\n                      opacity: tags.includes(suggestedTag) ? 0.5 : 1,\r\n                    }}\r\n                  >\r\n                    + {suggestedTag}\r\n                  </Tag>\r\n                ))}\r\n              </Space>\r\n            </div>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 7. Resolution Notes ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <CheckCircleOutlined style={{ marginRight: 8, fontSize: 18, color: '#059669' }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Resolution Notes\r\n              </h3>\r\n            </div>\r\n\r\n            <Form.Item\r\n              label=\"Engineer's Resolution\"\r\n              name=\"engineer_resolution\"\r\n            >\r\n              <Input.TextArea\r\n                rows={4}\r\n                placeholder=\"Document the resolution steps taken...\"\r\n                showCount\r\n                maxLength={500}\r\n              />\r\n            </Form.Item>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 8. Pro Tips Footer ===== */}\r\n          <Alert\r\n            type=\"info\"\r\n            message=\"üí° Pro Tips for Better Complaints\"\r\n            description={\r\n              <ul style={{ margin: '8px 0', paddingLeft: 20 }}>\r\n                <li>Be specific about the issue - include error codes or symptoms</li>\r\n                <li>Assign appropriate priority based on business impact</li>\r\n                <li>Route to correct department for faster resolution</li>\r\n                <li>Add relevant tags for better tracking and reporting</li>\r\n                <li>Set realistic timelines based on SLA targets</li>\r\n              </ul>\r\n            }\r\n            showIcon\r\n            style={{ marginBottom: 24 }}\r\n          />\r\n\r\n          {/* ===== Form Actions ===== */}\r\n          <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n            <Button onClick={onClose}>\r\n              Cancel\r\n            </Button>\r\n            <Button type=\"primary\" htmlType=\"submit\" loading={isSubmitting}>\r\n              {mode === 'create' ? 'Create Complaint' : 'Update Complaint'}\r\n            </Button>\r\n          </Space>\r\n        </Form>\r\n      </Spin>\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\complaints\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\complaints\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":12,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":12,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Complaints Routes\r\n */\r\nimport React, { lazy } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\n\r\n// Lazy load components\r\nconst ComplaintsPage = lazy(() => import('./views/ComplaintsPage'));\r\n\r\n// Route wrapper with error boundary\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      {children}\r\n    </React.Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const complaintsRoutes: RouteObject[] = [\r\n  {\r\n    path: 'complaints',\r\n    element: (\r\n      <RouteWrapper>\r\n        <ComplaintsPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\complaints\\views\\ComplaintsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1137,1140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1137,1140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'complaintService'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":76,"suggestions":[{"desc":"Update the dependencies array to be: [searchTerm, statusFilter, typeFilter, priorityFilter, engineerFilter, complaintService]","fix":{"range":[2778,2848],"text":"[searchTerm, statusFilter, typeFilter, priorityFilter, engineerFilter, complaintService]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'complaintService'. Either include it or remove the dependency array.","line":86,"column":6,"nodeType":"ArrayExpression","endLine":86,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [complaintService]","fix":{"range":[3121,3123],"text":"[complaintService]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Complaints Page - Modular Version\r\n * Enhanced complaint management with lifecycle tracking\r\n */\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport { Complaint, ComplaintFilters } from '@/types/complaints';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Button, \r\n  Input, \r\n  Select, \r\n  Table, \r\n  Tag, \r\n  Space, \r\n  Spin,\r\n  Alert\r\n} from 'antd';\r\nimport { \r\n  PlusOutlined,\r\n  SearchOutlined,\r\n  ReloadOutlined,\r\n  EyeOutlined,\r\n  EditOutlined\r\n} from '@ant-design/icons';\r\nimport { \r\n  AlertTriangle,\r\n  Clock,\r\n  CheckCircle,\r\n  Building2,\r\n  User,\r\n  Wrench\r\n} from 'lucide-react';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { ComplaintsFormPanel } from '@/modules/features/complaints/components/ComplaintsFormPanel';\r\nimport ComplaintDetailModal from '@/components/complaints/ComplaintDetailModal';\r\nimport { toast } from 'sonner';\r\n\r\nexport const ComplaintsPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const complaintService = useService<any>('complaintService');\r\n  const [complaints, setComplaints] = useState<Complaint[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<string>('all');\r\n  const [typeFilter, setTypeFilter] = useState<string>('all');\r\n  const [priorityFilter, setPriorityFilter] = useState<string>('all');\r\n  const [engineerFilter, setEngineerFilter] = useState<string>('all');\r\n  const [showFormPanel, setShowFormPanel] = useState(false);\r\n  const [formMode, setFormMode] = useState<'create' | 'edit'>('create');\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n  const [selectedComplaint, setSelectedComplaint] = useState<Complaint | null>(null);\r\n  const [engineers, setEngineers] = useState<Array<{ id: string; name: string; }>>([]);\r\n\r\n  const fetchComplaints = useCallback(async (): Promise<void> => {\r\n    try {\r\n      setIsLoading(true);\r\n      const filters: ComplaintFilters = {};\r\n      \r\n      if (searchTerm) filters.search = searchTerm;\r\n      if (statusFilter !== 'all') filters.status = statusFilter;\r\n      if (typeFilter !== 'all') filters.type = typeFilter;\r\n      if (priorityFilter !== 'all') filters.priority = priorityFilter;\r\n      if (engineerFilter !== 'all') filters.assigned_engineer = engineerFilter;\r\n\r\n      const data = await complaintService.getComplaints(filters);\r\n      setComplaints(data);\r\n    } catch (error: unknown) {\r\n      console.error('Failed to fetch complaints:', error);\r\n      toast.error('Failed to fetch complaints');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [searchTerm, statusFilter, typeFilter, priorityFilter, engineerFilter]);\r\n\r\n  const fetchEngineers = useCallback(async (): Promise<void> => {\r\n    try {\r\n      const data = await complaintService.getEngineers();\r\n      setEngineers(data);\r\n    } catch (error: unknown) {\r\n      console.error('Failed to fetch engineers:', error);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    void fetchComplaints();\r\n    void fetchEngineers();\r\n  }, [fetchComplaints, fetchEngineers]);\r\n\r\n  const handleCreateComplaint = () => {\r\n    setSelectedComplaint(null);\r\n    setFormMode('create');\r\n    setShowFormPanel(true);\r\n  };\r\n\r\n  const handleEditComplaint = (complaint: Complaint) => {\r\n    setSelectedComplaint(complaint);\r\n    setFormMode('edit');\r\n    setShowFormPanel(true);\r\n  };\r\n\r\n  const handleCloseFormPanel = () => {\r\n    setShowFormPanel(false);\r\n    setSelectedComplaint(null);\r\n  };\r\n\r\n  const getStatusTag = (status: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      new: 'blue',\r\n      in_progress: 'orange',\r\n      closed: 'green'\r\n    };\r\n    \r\n    return (\r\n      <Tag color={colorMap[status] || 'default'}>\r\n        {status.replace('_', ' ').toUpperCase()}\r\n      </Tag>\r\n    );\r\n  };\r\n\r\n  const getPriorityTag = (priority: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      low: 'green',\r\n      medium: 'orange',\r\n      high: 'red',\r\n      urgent: 'red'\r\n    };\r\n    \r\n    return (\r\n      <Tag color={colorMap[priority] || 'default'}>\r\n        {priority.toUpperCase()}\r\n      </Tag>\r\n    );\r\n  };\r\n\r\n  const getTypeTag = (type: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      technical: 'blue',\r\n      service: 'cyan',\r\n      billing: 'purple',\r\n      other: 'default'\r\n    };\r\n    \r\n    return (\r\n      <Tag color={colorMap[type] || 'default'}>\r\n        {type.replace('_', ' ').toUpperCase()}\r\n      </Tag>\r\n    );\r\n  };\r\n\r\n  const handleViewDetails = (complaint: Complaint) => {\r\n    setSelectedComplaint(complaint);\r\n    setShowDetailModal(true);\r\n  };\r\n\r\n  if (!hasPermission('manage_complaints')) {\r\n    return (\r\n      <>\r\n        <div style={{ padding: 24 }}>\r\n          <Alert\r\n            message=\"Access Denied\"\r\n            description=\"You don't have permission to access complaint management.\"\r\n            type=\"error\"\r\n            showIcon\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  const stats = {\r\n    total: complaints.length,\r\n    new: complaints.filter(c => c.status === 'new').length,\r\n    inProgress: complaints.filter(c => c.status === 'in_progress').length,\r\n    closed: complaints.filter(c => c.status === 'closed').length\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Complaint',\r\n      dataIndex: 'title',\r\n      key: 'title',\r\n      render: (_: string | unknown, record: Complaint) => (\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n          <div style={{ \r\n            padding: 8, \r\n            background: '#FEE2E2', \r\n            borderRadius: 8,\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center'\r\n          }}>\r\n            <AlertTriangle size={16} color=\"#DC2626\" />\r\n          </div>\r\n          <div>\r\n            <div style={{ fontWeight: 500 }}>{record.title}</div>\r\n            <div style={{ fontSize: 12, color: '#6B7280', maxWidth: 300, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\r\n              {record.description}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Customer',\r\n      dataIndex: 'customer_name',\r\n      key: 'customer_name',\r\n      render: (text: string) => (\r\n        <Space>\r\n          <Building2 size={14} color=\"#6B7280\" />\r\n          <span style={{ fontWeight: 500 }}>{text}</span>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Type',\r\n      dataIndex: 'type',\r\n      key: 'type',\r\n      render: (type: string) => getTypeTag(type),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      render: (status: string) => getStatusTag(status),\r\n    },\r\n    {\r\n      title: 'Priority',\r\n      dataIndex: 'priority',\r\n      key: 'priority',\r\n      render: (priority: string) => getPriorityTag(priority),\r\n    },\r\n    {\r\n      title: 'Assigned Engineer',\r\n      dataIndex: 'assigned_engineer_name',\r\n      key: 'assigned_engineer_name',\r\n      render: (text: string) => (\r\n        <Space>\r\n          <User size={14} color=\"#6B7280\" />\r\n          <span>{text || 'Unassigned'}</span>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'created_at',\r\n      key: 'created_at',\r\n      render: (date: string) => new Date(date).toLocaleDateString(),\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      align: 'right' as const,\r\n      render: (_: unknown, record: Complaint) => (\r\n        <Space>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<EyeOutlined />}\r\n            onClick={() => handleViewDetails(record)}\r\n          />\r\n          {hasPermission('write') && (\r\n            <Button\r\n              type=\"text\"\r\n              icon={<EditOutlined />}\r\n              onClick={() => handleEditComplaint(record)}\r\n            />\r\n          )}\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Complaint Management\"\r\n        description=\"Manage customer complaints with enhanced lifecycle tracking\"\r\n        breadcrumbs={[\r\n          { label: 'Dashboard', path: '/dashboard' },\r\n          { label: 'Complaints' }\r\n        ]}\r\n        extra={\r\n          <Space>\r\n            <Button\r\n              icon={<ReloadOutlined spin={isLoading} />}\r\n              onClick={fetchComplaints}\r\n              loading={isLoading}\r\n            >\r\n              Refresh\r\n            </Button>\r\n            {hasPermission('write') && (\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<PlusOutlined />}\r\n                onClick={handleCreateComplaint}\r\n              >\r\n                Create Complaint\r\n              </Button>\r\n            )}\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Stats Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Complaints\"\r\n              value={stats.total}\r\n              icon={Wrench}\r\n              color=\"primary\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"New\"\r\n              value={stats.new}\r\n              icon={AlertTriangle}\r\n              color=\"info\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"In Progress\"\r\n              value={stats.inProgress}\r\n              icon={Clock}\r\n              color=\"warning\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Closed\"\r\n              value={stats.closed}\r\n              icon={CheckCircle}\r\n              color=\"success\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Space direction=\"vertical\" style={{ width: '100%' }} size=\"middle\">\r\n            <div style={{ fontSize: 16, fontWeight: 500 }}>Search & Filters</div>\r\n            <Row gutter={[16, 16]}>\r\n              <Col xs={24} md={12}>\r\n                <Input\r\n                  placeholder=\"Search complaints...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  onPressEnter={fetchComplaints}\r\n                  prefix={<SearchOutlined />}\r\n                />\r\n              </Col>\r\n              <Col xs={12} md={6}>\r\n                <Select\r\n                  value={statusFilter}\r\n                  onChange={setStatusFilter}\r\n                  style={{ width: '100%' }}\r\n                  placeholder=\"Status\"\r\n                >\r\n                  <Select.Option value=\"all\">All Statuses</Select.Option>\r\n                  <Select.Option value=\"new\">New</Select.Option>\r\n                  <Select.Option value=\"in_progress\">In Progress</Select.Option>\r\n                  <Select.Option value=\"closed\">Closed</Select.Option>\r\n                </Select>\r\n              </Col>\r\n              <Col xs={12} md={6}>\r\n                <Select\r\n                  value={typeFilter}\r\n                  onChange={setTypeFilter}\r\n                  style={{ width: '100%' }}\r\n                  placeholder=\"Type\"\r\n                >\r\n                  <Select.Option value=\"all\">All Types</Select.Option>\r\n                  <Select.Option value=\"technical\">Technical</Select.Option>\r\n                  <Select.Option value=\"service\">Service</Select.Option>\r\n                  <Select.Option value=\"billing\">Billing</Select.Option>\r\n                  <Select.Option value=\"other\">Other</Select.Option>\r\n                </Select>\r\n              </Col>\r\n              <Col xs={12} md={6}>\r\n                <Select\r\n                  value={priorityFilter}\r\n                  onChange={setPriorityFilter}\r\n                  style={{ width: '100%' }}\r\n                  placeholder=\"Priority\"\r\n                >\r\n                  <Select.Option value=\"all\">All Priorities</Select.Option>\r\n                  <Select.Option value=\"low\">Low</Select.Option>\r\n                  <Select.Option value=\"medium\">Medium</Select.Option>\r\n                  <Select.Option value=\"high\">High</Select.Option>\r\n                  <Select.Option value=\"urgent\">Urgent</Select.Option>\r\n                </Select>\r\n              </Col>\r\n              <Col xs={12} md={6}>\r\n                <Select\r\n                  value={engineerFilter}\r\n                  onChange={setEngineerFilter}\r\n                  style={{ width: '100%' }}\r\n                  placeholder=\"Engineer\"\r\n                >\r\n                  <Select.Option value=\"all\">All Engineers</Select.Option>\r\n                  {engineers.map(engineer => (\r\n                    <Select.Option key={engineer.id} value={engineer.id}>\r\n                      {engineer.name}\r\n                    </Select.Option>\r\n                  ))}\r\n                </Select>\r\n              </Col>\r\n              <Col xs={12} md={6}>\r\n                <Button type=\"primary\" icon={<SearchOutlined />} onClick={fetchComplaints} block>\r\n                  Search\r\n                </Button>\r\n              </Col>\r\n            </Row>\r\n          </Space>\r\n        </Card>\r\n\r\n        {/* Complaints Table */}\r\n        <Card \r\n          title={`Complaints (${complaints.length})`}\r\n          extra={<span style={{ color: '#6B7280', fontWeight: 'normal' }}>Showing {complaints.length} complaint{complaints.length !== 1 ? 's' : ''}</span>}\r\n        >\r\n          {isLoading ? (\r\n            <div style={{ textAlign: 'center', padding: '40px 0' }}>\r\n              <Spin spinning tip=\"Loading complaints...\" />\r\n            </div>\r\n          ) : complaints.length === 0 ? (\r\n            <div style={{ textAlign: 'center', padding: '40px 0' }}>\r\n              <Wrench size={48} color=\"#9CA3AF\" style={{ marginBottom: 16 }} />\r\n              <h3 style={{ fontSize: 18, fontWeight: 600, marginBottom: 8 }}>No complaints found</h3>\r\n              <p style={{ color: '#6B7280', marginBottom: 16 }}>\r\n                Get started by creating your first complaint\r\n              </p>\r\n              {hasPermission('write') && (\r\n                <Button\r\n                  type=\"primary\"\r\n                  icon={<PlusOutlined />}\r\n                  onClick={handleCreateComplaint}\r\n                >\r\n                  Create Complaint\r\n                </Button>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <Table\r\n              columns={columns}\r\n              dataSource={complaints}\r\n              rowKey=\"id\"\r\n              pagination={{\r\n                pageSize: 10,\r\n                showSizeChanger: true,\r\n                showTotal: (total) => `Total ${total} complaints`,\r\n              }}\r\n            />\r\n          )}\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Side Panel Forms */}\r\n      <ComplaintsFormPanel\r\n        complaint={selectedComplaint}\r\n        mode={formMode}\r\n        isOpen={showFormPanel}\r\n        onClose={handleCloseFormPanel}\r\n      />\r\n\r\n      {selectedComplaint && (\r\n        <ComplaintDetailModal\r\n          open={showDetailModal}\r\n          onOpenChange={setShowDetailModal}\r\n          complaint={selectedComplaint}\r\n          onSuccess={fetchComplaints}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ComplaintsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\complaints\\views\\ComplaintsPageNew.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchComplaints'. Either include it or remove the dependency array.","line":62,"column":6,"nodeType":"ArrayExpression","endLine":62,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [fetchComplaints, searchTerm, statusFilter]","fix":{"range":[1947,1973],"text":"[fetchComplaints, searchTerm, statusFilter]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Complaints Page - Modular Version\r\n * Enhanced complaint management with lifecycle tracking\r\n */\r\nimport React, { useEffect, useState } from 'react';\r\nimport { complaintService } from '@/services/complaintService';\r\nimport { Complaint, ComplaintFilters } from '@/types/complaints';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { \r\n  Table, \r\n  TableBody, \r\n  TableCell, \r\n  TableHead, \r\n  TableHeader, \r\n  TableRow \r\n} from '@/components/ui/table';\r\nimport { \r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { \r\n  Plus, \r\n  Search, \r\n  AlertTriangle,\r\n  Clock,\r\n  CheckCircle,\r\n  Eye,\r\n  Edit,\r\n  Trash2,\r\n  Building2,\r\n  User,\r\n  Calendar,\r\n  MessageSquare,\r\n  Wrench,\r\n  RefreshCw,\r\n  Loader2\r\n} from 'lucide-react';\r\nimport { ComplaintsFormPanel } from '@/modules/features/complaints/components/ComplaintsFormPanel';\r\nimport ComplaintDetailModal from '@/components/complaints/ComplaintDetailModal';\r\nimport { toast } from 'sonner';\r\n\r\nexport const ComplaintsPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const [complaints, setComplaints] = useState<Complaint[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<string>('all');\r\n  const [showFormPanel, setShowFormPanel] = useState(false);\r\n  const [formMode, setFormMode] = useState<'create' | 'edit'>('create');\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n  const [selectedComplaint, setSelectedComplaint] = useState<Complaint | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchComplaints();\r\n  }, [searchTerm, statusFilter]);\r\n\r\n  const fetchComplaints = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const filters: ComplaintFilters = {};\r\n      \r\n      if (searchTerm) filters.search = searchTerm;\r\n      if (statusFilter !== 'all') filters.status = statusFilter;\r\n\r\n      const data = await complaintService.getComplaints(filters);\r\n      setComplaints(data);\r\n    } catch (error) {\r\n      console.error('Failed to fetch complaints:', error);\r\n      toast.error('Failed to fetch complaints');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const variants: Record<string, 'default' | 'secondary' | 'destructive' | 'outline'> = {\r\n      new: 'outline',\r\n      in_progress: 'default',\r\n      closed: 'secondary'\r\n    };\r\n    \r\n    return (\r\n      <Badge variant={variants[status] || 'secondary'}>\r\n        {status.replace('_', ' ')}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const handleCreateComplaint = () => {\r\n    setSelectedComplaint(null);\r\n    setFormMode('create');\r\n    setShowFormPanel(true);\r\n  };\r\n\r\n  const handleEditComplaint = (complaint: Complaint) => {\r\n    setSelectedComplaint(complaint);\r\n    setFormMode('edit');\r\n    setShowFormPanel(true);\r\n  };\r\n\r\n  const handleCloseFormPanel = () => {\r\n    setShowFormPanel(false);\r\n    setSelectedComplaint(null);\r\n  };\r\n\r\n  const handleViewDetails = (complaint: Complaint) => {\r\n    setSelectedComplaint(complaint);\r\n    setShowDetailModal(true);\r\n  };\r\n\r\n  const handleSearch = () => {\r\n    fetchComplaints();\r\n  };\r\n\r\n  if (!hasPermission('manage_complaints')) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <Card>\r\n          <CardContent className=\"flex items-center justify-center h-32\">\r\n            <p className=\"text-muted-foreground\">You don't have permission to access complaint management.</p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const stats = {\r\n    total: complaints.length,\r\n    new: complaints.filter(c => c.status === 'new').length,\r\n    inProgress: complaints.filter(c => c.status === 'in_progress').length,\r\n    closed: complaints.filter(c => c.status === 'closed').length\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\r\n            <Wrench className=\"h-8 w-8\" />\r\n            Complaint Management\r\n          </h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Manage customer complaints with enhanced lifecycle tracking\r\n          </p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={fetchComplaints}\r\n            disabled={isLoading}\r\n          >\r\n            <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\r\n            Refresh\r\n          </Button>\r\n          {hasPermission('write') && (\r\n            <Button onClick={handleCreateComplaint}>\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Create Complaint\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Complaints</CardTitle>\r\n            <Wrench className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">New</CardTitle>\r\n            <AlertTriangle className=\"h-4 w-4 text-blue-600\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.new}</div>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">In Progress</CardTitle>\r\n            <Clock className=\"h-4 w-4 text-yellow-600\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.inProgress}</div>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Closed</CardTitle>\r\n            <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.closed}</div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Search & Filters</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex flex-col sm:flex-row gap-4\">\r\n            <div className=\"flex-1\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Search complaints...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n              <SelectTrigger className=\"w-full sm:w-48\">\r\n                <SelectValue placeholder=\"Status\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">All Statuses</SelectItem>\r\n                <SelectItem value=\"new\">New</SelectItem>\r\n                <SelectItem value=\"in_progress\">In Progress</SelectItem>\r\n                <SelectItem value=\"closed\">Closed</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            \r\n            <Button onClick={handleSearch}>\r\n              <Search className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Complaints Table */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Complaints ({complaints.length})</CardTitle>\r\n          <CardDescription>\r\n            Showing {complaints.length} complaint{complaints.length !== 1 ? 's' : ''}\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {isLoading ? (\r\n            <div className=\"flex items-center justify-center h-32\">\r\n              <Loader2 className=\"h-6 w-6 animate-spin\" />\r\n              <span className=\"ml-2\">Loading complaints...</span>\r\n            </div>\r\n          ) : complaints.length === 0 ? (\r\n            <div className=\"text-center py-8\">\r\n              <Wrench className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-semibold mb-2\">No complaints found</h3>\r\n              <p className=\"text-muted-foreground mb-4\">\r\n                Get started by creating your first complaint\r\n              </p>\r\n              {hasPermission('write') && (\r\n                <Button onClick={handleCreateComplaint}>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  Create Complaint\r\n                </Button>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    <TableHead>Complaint</TableHead>\r\n                    <TableHead>Customer</TableHead>\r\n                    <TableHead>Status</TableHead>\r\n                    <TableHead>Priority</TableHead>\r\n                    <TableHead>Assigned Engineer</TableHead>\r\n                    <TableHead>Created</TableHead>\r\n                    <TableHead className=\"text-right\">Actions</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {complaints.map((complaint) => (\r\n                    <TableRow key={complaint.id}>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <div className=\"p-2 bg-red-100 rounded-lg\">\r\n                            <AlertTriangle className=\"h-4 w-4 text-red-600\" />\r\n                          </div>\r\n                          <div>\r\n                            <div className=\"font-medium\">{complaint.title}</div>\r\n                            <div className=\"text-sm text-muted-foreground truncate max-w-xs\">\r\n                              {complaint.description}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Building2 className=\"h-4 w-4 text-muted-foreground\" />\r\n                          <span className=\"font-medium\">{complaint.customer_name}</span>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>{getStatusBadge(complaint.status)}</TableCell>\r\n                      <TableCell>\r\n                        <Badge variant=\"outline\">{complaint.priority}</Badge>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\r\n                          <span className=\"text-sm\">{complaint.assigned_engineer_name || 'Unassigned'}</span>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\r\n                          <Calendar className=\"h-3 w-3\" />\r\n                          {new Date(complaint.created_at).toLocaleDateString()}\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell className=\"text-right\">\r\n                        <div className=\"flex items-center justify-end gap-2\">\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleViewDetails(complaint)}\r\n                          >\r\n                            <Eye className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          {hasPermission('write') && (\r\n                            <Button\r\n                              variant=\"ghost\"\r\n                              size=\"sm\"\r\n                              onClick={() => handleEditComplaint(complaint)}\r\n                            >\r\n                              <Edit className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Side Panel Forms */}\r\n      <ComplaintsFormPanel\r\n        complaint={selectedComplaint}\r\n        mode={formMode}\r\n        isOpen={showFormPanel}\r\n        onClose={handleCloseFormPanel}\r\n      />\r\n\r\n      {selectedComplaint && (\r\n        <ComplaintDetailModal\r\n          open={showDetailModal}\r\n          onOpenChange={setShowDetailModal}\r\n          complaint={selectedComplaint}\r\n          onSuccess={fetchComplaints}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ComplaintsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\components\\ConfigTestResultPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2321,2324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2321,2324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Configuration Test Result Panel\r\n * Side drawer panel for displaying configuration test results\r\n */\r\n\r\nimport React from 'react';\r\nimport {\r\n  Drawer,\r\n  Button,\r\n  Descriptions,\r\n  Result,\r\n  Timeline,\r\n  Empty,\r\n  Divider,\r\n  Tag,\r\n  Space,\r\n  Row,\r\n  Col,\r\n} from 'antd';\r\nimport {\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  ClockCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport { ConfigTestResult, ConfigTestHistory } from '../types/configTest';\r\n\r\ninterface ConfigTestResultPanelProps {\r\n  visible: boolean;\r\n  result: ConfigTestResult | null;\r\n  history?: ConfigTestHistory[];\r\n  loading?: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const ConfigTestResultPanel: React.FC<ConfigTestResultPanelProps> = ({\r\n  visible,\r\n  result,\r\n  history = [],\r\n  loading = false,\r\n  onClose,\r\n}) => {\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'success':\r\n        return <CheckCircleOutlined style={{ color: '#52c41a', fontSize: 16 }} />;\r\n      case 'error':\r\n        return <CloseCircleOutlined style={{ color: '#ff4d4f', fontSize: 16 }} />;\r\n      case 'testing':\r\n        return <ClockCircleOutlined style={{ color: '#1890ff', fontSize: 16 }} />;\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'success':\r\n        return 'success';\r\n      case 'error':\r\n        return 'error';\r\n      case 'testing':\r\n        return 'processing';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  if (!result) {\r\n    return (\r\n      <Drawer\r\n        title=\"Test Results\"\r\n        placement=\"right\"\r\n        onClose={onClose}\r\n        open={visible}\r\n        width={500}\r\n      >\r\n        <Empty description=\"No test results\" />\r\n      </Drawer>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Drawer\r\n      title=\"Test Results\"\r\n      placement=\"right\"\r\n      onClose={onClose}\r\n      open={visible}\r\n      width={500}\r\n      loading={loading}\r\n      footer={\r\n        <Row gutter={8} justify=\"end\">\r\n          <Col>\r\n            <Button onClick={onClose}>Close</Button>\r\n          </Col>\r\n        </Row>\r\n      }\r\n    >\r\n      <div style={{ marginBottom: 24 }}>\r\n        {/* Result Status */}\r\n        <div style={{ marginBottom: 24 }}>\r\n          <Result\r\n            status={result.status as any}\r\n            title={result.message}\r\n            subTitle={result.details}\r\n            extra={\r\n              <Space>\r\n                <Tag color={getStatusColor(result.status)}>\r\n                  {result.status.charAt(0).toUpperCase() + result.status.slice(1)}\r\n                </Tag>\r\n                {result.duration && (\r\n                  <Tag>Duration: {result.duration}ms</Tag>\r\n                )}\r\n              </Space>\r\n            }\r\n          />\r\n        </div>\r\n\r\n        {/* Test Details */}\r\n        <div style={{ marginBottom: 24 }}>\r\n          <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>Test Information</div>\r\n          <Descriptions column={1} size=\"small\" bordered>\r\n            <Descriptions.Item label=\"Status\" span={1}>\r\n              <Tag color={getStatusColor(result.status)}>\r\n                {result.status.charAt(0).toUpperCase() + result.status.slice(1)}\r\n              </Tag>\r\n            </Descriptions.Item>\r\n\r\n            <Descriptions.Item label=\"Message\" span={1}>\r\n              {result.message}\r\n            </Descriptions.Item>\r\n\r\n            {result.details && (\r\n              <Descriptions.Item label=\"Details\" span={1}>\r\n                <div style={{ whiteSpace: 'pre-wrap', fontSize: 12 }}>\r\n                  {result.details}\r\n                </div>\r\n              </Descriptions.Item>\r\n            )}\r\n\r\n            <Descriptions.Item label=\"Tested At\" span={1}>\r\n              {new Date(result.timestamp).toLocaleString()}\r\n            </Descriptions.Item>\r\n\r\n            {result.duration && (\r\n              <Descriptions.Item label=\"Duration\" span={1}>\r\n                {result.duration}ms\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n        </div>\r\n\r\n        {/* Test History */}\r\n        {history && history.length > 0 && (\r\n          <>\r\n            <Divider />\r\n            <div style={{ marginBottom: 24 }}>\r\n              <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>Recent Test History</div>\r\n              <Timeline\r\n                items={history.slice(0, 10).map((item) => ({\r\n                  dot: getStatusIcon(item.status),\r\n                  children: (\r\n                    <div style={{ marginBottom: 16 }}>\r\n                      <div style={{\r\n                        fontWeight: 500,\r\n                        marginBottom: 4,\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: 8,\r\n                      }}>\r\n                        {item.message}\r\n                        <Tag color={getStatusColor(item.status)}>\r\n                          {item.status}\r\n                        </Tag>\r\n                      </div>\r\n                      <div style={{ fontSize: 12, color: '#999' }}>\r\n                        {new Date(item.timestamp).toLocaleString()}\r\n                      </div>\r\n                    </div>\r\n                  ),\r\n                }))}\r\n              />\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {/* Success Tips */}\r\n        {result.status === 'success' && (\r\n          <>\r\n            <Divider />\r\n            <div style={{\r\n              padding: 12,\r\n              backgroundColor: '#f6ffed',\r\n              border: '1px solid #b7eb8f',\r\n              borderRadius: 4,\r\n              fontSize: 12,\r\n              color: '#52c41a',\r\n            }}>\r\n              <div style={{ fontWeight: 600, marginBottom: 8 }}>‚úì Configuration is working correctly</div>\r\n              <ul style={{ margin: 0, paddingLeft: 20 }}>\r\n                <li>All required credentials are valid</li>\r\n                <li>Connection is established</li>\r\n                <li>Service is responding normally</li>\r\n              </ul>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {/* Error Tips */}\r\n        {result.status === 'error' && (\r\n          <>\r\n            <Divider />\r\n            <div style={{\r\n              padding: 12,\r\n              backgroundColor: '#fff1f0',\r\n              border: '1px solid #ffa39e',\r\n              borderRadius: 4,\r\n              fontSize: 12,\r\n              color: '#ff4d4f',\r\n            }}>\r\n              <div style={{ fontWeight: 600, marginBottom: 8 }}>‚úó Configuration test failed</div>\r\n              <ul style={{ margin: 0, paddingLeft: 20 }}>\r\n                <li>Please verify your configuration settings</li>\r\n                <li>Check API credentials and endpoints</li>\r\n                <li>Ensure network connectivity</li>\r\n                <li>Review error message for details</li>\r\n              </ul>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\hooks\\useConfigurationTests.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1148,1151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1148,1151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1805,1808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1805,1808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2492,2495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2492,2495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3149,3152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3149,3152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useConfigurationTests Hook\r\n * Custom hook for managing configuration test operations\r\n */\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { configTestService } from '../services/configTestService';\r\nimport {\r\n  EmailTestConfig,\r\n  SMSTestConfig,\r\n  PaymentTestConfig,\r\n  APITestConfig,\r\n  ConfigTestResult,\r\n  ConfigTestHistory,\r\n} from '../types/configTest';\r\n\r\nexport const useConfigurationTests = (options: Record<string, never> = {}) => {\r\n  const [result, setResult] = useState<ConfigTestResult | null>(null);\r\n  const [history, setHistory] = useState<ConfigTestHistory[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [activeTest, setActiveTest] = useState<string | null>(null);\r\n  const [error, setError] = useState<Error | null>(null);\r\n\r\n  const testEmail = useCallback(async (config: EmailTestConfig) => {\r\n    try {\r\n      setIsLoading(true);\r\n      setActiveTest('email');\r\n      setError(null);\r\n      const testResult = await configTestService.testEmail(config);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      return testResult;\r\n    } catch (err: any) {\r\n      const testResult = err as ConfigTestResult;\r\n      const error = new Error(testResult.message);\r\n      setError(error);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const testSMS = useCallback(async (config: SMSTestConfig) => {\r\n    try {\r\n      setIsLoading(true);\r\n      setActiveTest('sms');\r\n      setError(null);\r\n      const testResult = await configTestService.testSMS(config);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      return testResult;\r\n    } catch (err: any) {\r\n      const testResult = err as ConfigTestResult;\r\n      const error = new Error(testResult.message);\r\n      setError(error);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const testPaymentGateway = useCallback(async (config: PaymentTestConfig) => {\r\n    try {\r\n      setIsLoading(true);\r\n      setActiveTest('payment');\r\n      setError(null);\r\n      const testResult = await configTestService.testPaymentGateway(config);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      return testResult;\r\n    } catch (err: any) {\r\n      const testResult = err as ConfigTestResult;\r\n      const error = new Error(testResult.message);\r\n      setError(error);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const testAPI = useCallback(async (config: APITestConfig) => {\r\n    try {\r\n      setIsLoading(true);\r\n      setActiveTest('api');\r\n      setError(null);\r\n      const testResult = await configTestService.testAPI(config);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      return testResult;\r\n    } catch (err: any) {\r\n      const testResult = err as ConfigTestResult;\r\n      const error = new Error(testResult.message);\r\n      setError(error);\r\n      setResult(testResult);\r\n      setHistory(configTestService.getTestHistory());\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const clearHistory = useCallback(() => {\r\n    configTestService.clearTestHistory();\r\n    setHistory([]);\r\n  }, []);\r\n\r\n  return {\r\n    result,\r\n    history,\r\n    isLoading,\r\n    activeTest,\r\n    error,\r\n    testEmail,\r\n    testSMS,\r\n    testPaymentGateway,\r\n    testAPI,\r\n    clearHistory,\r\n  };\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":31,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":31,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Configuration Routes\r\n * \r\n * Nested routing structure for Configuration module:\r\n * - /tenant/configuration (parent) ‚Üí redirects to /tenant/configuration/tenant\r\n * - /tenant/configuration/tenant ‚Üí TenantConfigurationPage (Tenant Settings)\r\n * - /tenant/configuration/pdf-templates ‚Üí PDFTemplatesPage (PDF Templates)\r\n * \r\n * Backward compatible routes maintained:\r\n * - /tenant/tenant-configuration (old route, still works)\r\n * \r\n * This structure aligns with:\r\n * 1. Navigation configuration in src/config/navigationPermissions.ts\r\n * 2. Application routing patterns (Masters, User Management modules)\r\n * 3. React Router nested routing best practices\r\n */\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject, Navigate } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components\r\nconst TenantConfigurationPage = lazy(() => import('./views/TenantConfigurationPage'));\r\nconst ConfigurationTestPage = lazy(() => import('./views/ConfigurationTestPage'));\r\nconst PDFTemplatesPage = lazy(() => import('../pdf-templates/views/PDFTemplatesPage'));\r\n\r\n/**\r\n * Route wrapper component with error boundary and loading spinner\r\n * Provides consistent error handling and loading UI across all routes\r\n */\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner size=\"lg\" text=\"Loading configuration...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\n/**\r\n * Configuration module routes with nested structure\r\n * Parent path: 'configuration'\r\n * Children: tenant (index), pdf-templates, test (for backward compatibility)\r\n */\r\nexport const configurationRoutes: RouteObject[] = [\r\n  {\r\n    path: 'configuration',\r\n    children: [\r\n      {\r\n        index: true,\r\n        element: <Navigate to=\"tenant\" replace />,\r\n      },\r\n      {\r\n        path: 'tenant',\r\n        element: (\r\n          <RouteWrapper>\r\n            <TenantConfigurationPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'pdf-templates',\r\n        element: (\r\n          <RouteWrapper>\r\n            <PDFTemplatesPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'test',\r\n        element: (\r\n          <RouteWrapper>\r\n            <ConfigurationTestPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  // Backward compatibility: old flat routes still work\r\n  {\r\n    path: 'tenant-configuration',\r\n    element: (\r\n      <RouteWrapper>\r\n        <TenantConfigurationPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n  {\r\n    path: 'configuration-test',\r\n    element: (\r\n      <RouteWrapper>\r\n        <ConfigurationTestPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\services\\configTestService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\types\\configTest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\views\\ConfigurationTestPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1156,1159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1156,1159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2103,2106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2103,2106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2774,2777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2774,2777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3492,3495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3492,3495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4163,4166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4163,4166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Configuration Test Page - Complete Refactor\r\n * Test and validate system configurations with drawer-based results, consistent UI\r\n */\r\nimport React, { useState } from 'react';\r\nimport {\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Form,\r\n  Input,\r\n  Select,\r\n  Space,\r\n  Alert,\r\n  message,\r\n  Divider,\r\n  Typography,\r\n  Table,\r\n  Tag,\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport {\r\n  SendOutlined,\r\n  MailOutlined,\r\n  PhoneOutlined,\r\n  CreditCardOutlined,\r\n  ApiOutlined,\r\n  ReloadOutlined,\r\n} from '@ant-design/icons';\r\nimport { PageHeader } from '@/components/common';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { ConfigTestResultPanel } from '../components/ConfigTestResultPanel';\r\nimport type {\r\n  EmailTestConfig,\r\n  SMSTestConfig,\r\n  PaymentTestConfig,\r\n  APITestConfig,\r\n  ConfigTestResult,\r\n  ConfigTestHistory,\r\n} from '../types/configTest';\r\n\r\nconst { TextArea } = Input;\r\nconst { Title } = Typography;\r\n\r\nconst ConfigurationTestPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const configTestService = useService<any>('configTestService');\r\n  const [emailForm] = Form.useForm();\r\n  const [smsForm] = Form.useForm();\r\n  const [paymentForm] = Form.useForm();\r\n  const [apiForm] = Form.useForm();\r\n\r\n  // State\r\n  const [activeTest, setActiveTest] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [testResult, setTestResult] = useState<ConfigTestResult | null>(null);\r\n  const [testHistory, setTestHistory] = useState<ConfigTestHistory[]>([]);\r\n  const [isPanelVisible, setIsPanelVisible] = useState(false);\r\n\r\n  // Handle email test\r\n  const handleEmailTest = async (values: EmailTestConfig) => {\r\n    try {\r\n      setLoading(true);\r\n      setActiveTest('email');\r\n      const result = await configTestService.testEmail(values);\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.success('Email test completed');\r\n    } catch (error: any) {\r\n      const result = error as ConfigTestResult;\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.error(result.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle SMS test\r\n  const handleSMSTest = async (values: SMSTestConfig) => {\r\n    try {\r\n      setLoading(true);\r\n      setActiveTest('sms');\r\n      const result = await configTestService.testSMS(values);\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.success('SMS test completed');\r\n    } catch (error: any) {\r\n      const result = error as ConfigTestResult;\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.error(result.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle payment gateway test\r\n  const handlePaymentTest = async (values: PaymentTestConfig) => {\r\n    try {\r\n      setLoading(true);\r\n      setActiveTest('payment');\r\n      const result = await configTestService.testPaymentGateway(values);\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.success('Payment gateway test completed');\r\n    } catch (error: any) {\r\n      const result = error as ConfigTestResult;\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.error(result.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle API test\r\n  const handleAPITest = async (values: APITestConfig) => {\r\n    try {\r\n      setLoading(true);\r\n      setActiveTest('api');\r\n      const result = await configTestService.testAPI(values);\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.success('API test completed');\r\n    } catch (error: any) {\r\n      const result = error as ConfigTestResult;\r\n      setTestResult(result);\r\n      setTestHistory(configTestService.getTestHistory());\r\n      setIsPanelVisible(true);\r\n      message.error(result.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'success':\r\n        return 'success';\r\n      case 'error':\r\n        return 'error';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  // Test history columns\r\n  const historyColumns: ColumnsType<ConfigTestHistory> = [\r\n    {\r\n      title: 'Type',\r\n      dataIndex: 'type',\r\n      key: 'type',\r\n      width: 100,\r\n      render: (type: string) => (\r\n        <Tag>\r\n          {type.charAt(0).toUpperCase() + type.slice(1)}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 100,\r\n      render: (status: string) => (\r\n        <Tag color={getStatusColor(status)}>\r\n          {status.charAt(0).toUpperCase() + status.slice(1)}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Message',\r\n      dataIndex: 'message',\r\n      key: 'message',\r\n      flex: 1,\r\n    },\r\n    {\r\n      title: 'Time',\r\n      dataIndex: 'timestamp',\r\n      key: 'timestamp',\r\n      width: 180,\r\n      render: (timestamp: string) => new Date(timestamp).toLocaleString(),\r\n    },\r\n  ];\r\n\r\n  if (!hasPermission('super_admin')) {\r\n    return (\r\n      <div style={{ padding: 24 }}>\r\n        <Alert\r\n          message=\"Access Denied\"\r\n          description=\"You don't have permission to access configuration tests. Only super administrators can test configurations.\"\r\n          type=\"error\"\r\n          showIcon\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Configuration Tests\"\r\n        description=\"Test and validate system configurations\"\r\n        breadcrumbs={[\r\n          { label: 'Home', path: '/' },\r\n          { label: 'Configuration', path: '/configuration' },\r\n          { label: 'Configuration Tests' },\r\n        ]}\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        <Alert\r\n          message=\"Configuration Testing\"\r\n          description=\"Use this page to test and validate your system configurations for email, SMS, payment gateways, and APIs. Test results are displayed in the side panel.\"\r\n          type=\"info\"\r\n          showIcon\r\n          style={{ marginBottom: 24 }}\r\n        />\r\n\r\n        {/* Email Configuration Test */}\r\n        <Card\r\n          title={\r\n            <Space>\r\n              <MailOutlined />\r\n              <span>Email Configuration Test</span>\r\n            </Space>\r\n          }\r\n          style={{ marginBottom: 24 }}\r\n        >\r\n          <Form\r\n            form={emailForm}\r\n            layout=\"vertical\"\r\n            onFinish={handleEmailTest}\r\n          >\r\n            <Row gutter={16}>\r\n              <Col xs={24} md={12}>\r\n                <Form.Item\r\n                  label=\"Test Email Address\"\r\n                  name=\"recipientEmail\"\r\n                  rules={[\r\n                    { required: true, message: 'Please enter email address' },\r\n                    { type: 'email', message: 'Please enter valid email' },\r\n                  ]}\r\n                >\r\n                  <Input\r\n                    placeholder=\"test@example.com\"\r\n                    prefix={<MailOutlined />}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} md={12}>\r\n                <Form.Item>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    htmlType=\"submit\"\r\n                    loading={loading && activeTest === 'email'}\r\n                    icon={<SendOutlined />}\r\n                    block\r\n                  >\r\n                    Send Test Email\r\n                  </Button>\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n            <Form.Item\r\n              label=\"Test Message (Optional)\"\r\n              name=\"testMessage\"\r\n            >\r\n              <TextArea\r\n                rows={3}\r\n                placeholder=\"Enter a custom test message (optional)\"\r\n              />\r\n            </Form.Item>\r\n          </Form>\r\n        </Card>\r\n\r\n        {/* SMS Configuration Test */}\r\n        <Card\r\n          title={\r\n            <Space>\r\n              <PhoneOutlined />\r\n              <span>SMS Configuration Test</span>\r\n            </Space>\r\n          }\r\n          style={{ marginBottom: 24 }}\r\n        >\r\n          <Form\r\n            form={smsForm}\r\n            layout=\"vertical\"\r\n            onFinish={handleSMSTest}\r\n          >\r\n            <Row gutter={16}>\r\n              <Col xs={24} md={12}>\r\n                <Form.Item\r\n                  label=\"Test Phone Number\"\r\n                  name=\"phoneNumber\"\r\n                  rules={[\r\n                    { required: true, message: 'Please enter phone number' },\r\n                  ]}\r\n                >\r\n                  <Input\r\n                    placeholder=\"+1234567890\"\r\n                    prefix={<PhoneOutlined />}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} md={12}>\r\n                <Form.Item>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    htmlType=\"submit\"\r\n                    loading={loading && activeTest === 'sms'}\r\n                    icon={<SendOutlined />}\r\n                    block\r\n                  >\r\n                    Send Test SMS\r\n                  </Button>\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n            <Form.Item\r\n              label=\"Test Message (Optional)\"\r\n              name=\"testMessage\"\r\n            >\r\n              <TextArea\r\n                rows={2}\r\n                placeholder=\"Enter a custom test message (optional)\"\r\n                maxLength={160}\r\n              />\r\n            </Form.Item>\r\n          </Form>\r\n        </Card>\r\n\r\n        {/* Payment Gateway Test */}\r\n        <Card\r\n          title={\r\n            <Space>\r\n              <CreditCardOutlined />\r\n              <span>Payment Gateway Test</span>\r\n            </Space>\r\n          }\r\n          style={{ marginBottom: 24 }}\r\n        >\r\n          <Form\r\n            form={paymentForm}\r\n            layout=\"vertical\"\r\n            onFinish={handlePaymentTest}\r\n          >\r\n            <Row gutter={16}>\r\n              <Col xs={24} md={12}>\r\n                <Form.Item\r\n                  label=\"Payment Gateway\"\r\n                  name=\"gateway\"\r\n                  rules={[\r\n                    { required: true, message: 'Please select payment gateway' },\r\n                  ]}\r\n                >\r\n                  <Select placeholder=\"Select gateway\">\r\n                    <Select.Option value=\"stripe\">Stripe</Select.Option>\r\n                    <Select.Option value=\"paypal\">PayPal</Select.Option>\r\n                    <Select.Option value=\"razorpay\">Razorpay</Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} md={12}>\r\n                <Form.Item>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    htmlType=\"submit\"\r\n                    loading={loading && activeTest === 'payment'}\r\n                    icon={<SendOutlined />}\r\n                    block\r\n                  >\r\n                    Test Payment Gateway\r\n                  </Button>\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </Form>\r\n        </Card>\r\n\r\n        {/* API Endpoint Test */}\r\n        <Card\r\n          title={\r\n            <Space>\r\n              <ApiOutlined />\r\n              <span>API Endpoint Test</span>\r\n            </Space>\r\n          }\r\n          style={{ marginBottom: 24 }}\r\n        >\r\n          <Form\r\n            form={apiForm}\r\n            layout=\"vertical\"\r\n            onFinish={handleAPITest}\r\n          >\r\n            <Row gutter={16}>\r\n              <Col xs={24} md={16}>\r\n                <Form.Item\r\n                  label=\"API Endpoint URL\"\r\n                  name=\"endpoint\"\r\n                  rules={[\r\n                    { required: true, message: 'Please enter endpoint URL' },\r\n                    { type: 'url', message: 'Please enter valid URL' },\r\n                  ]}\r\n                >\r\n                  <Input\r\n                    placeholder=\"https://api.example.com/health\"\r\n                    prefix={<ApiOutlined />}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} md={8}>\r\n                <Form.Item\r\n                  label=\"HTTP Method\"\r\n                  name=\"method\"\r\n                  initialValue=\"GET\"\r\n                >\r\n                  <Select>\r\n                    <Select.Option value=\"GET\">GET</Select.Option>\r\n                    <Select.Option value=\"POST\">POST</Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n            <Form.Item>\r\n              <Button\r\n                type=\"primary\"\r\n                htmlType=\"submit\"\r\n                loading={loading && activeTest === 'api'}\r\n                icon={<SendOutlined />}\r\n              >\r\n                Test API Endpoint\r\n              </Button>\r\n            </Form.Item>\r\n          </Form>\r\n        </Card>\r\n\r\n        {/* Test History */}\r\n        {testHistory.length > 0 && (\r\n          <Card\r\n            title=\"Test History\"\r\n            extra={\r\n              <Button\r\n                size=\"small\"\r\n                onClick={() => {\r\n                  configTestService.clearTestHistory();\r\n                  setTestHistory([]);\r\n                }}\r\n              >\r\n                Clear History\r\n              </Button>\r\n            }\r\n          >\r\n            <Table<ConfigTestHistory>\r\n              columns={historyColumns}\r\n              dataSource={testHistory}\r\n              rowKey=\"id\"\r\n              pagination={{\r\n                pageSize: 10,\r\n                showSizeChanger: true,\r\n              }}\r\n              size=\"small\"\r\n            />\r\n          </Card>\r\n        )}\r\n      </div>\r\n\r\n      {/* Result Panel */}\r\n      <ConfigTestResultPanel\r\n        visible={isPanelVisible}\r\n        result={testResult}\r\n        history={testHistory}\r\n        loading={loading}\r\n        onClose={() => setIsPanelVisible(false)}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ConfigurationTestPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\configuration\\views\\TenantConfigurationPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1150,1153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1150,1153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'tenantService'. Either include it or remove the dependency array.","line":115,"column":6,"nodeType":"ArrayExpression","endLine":115,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [form, tenantService]","fix":{"range":[3819,3825],"text":"[form, tenantService]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tenant Configuration Page - Enterprise Design\r\n * Comprehensive tenant settings management with tabs\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Tabs, \r\n  Form, \r\n  Input, \r\n  Select, \r\n  Switch, \r\n  Button, \r\n  Upload, \r\n  ColorPicker, \r\n  Divider,\r\n  Space,\r\n  message,\r\n  Spin\r\n} from 'antd';\r\nimport { \r\n  SaveOutlined, \r\n  ReloadOutlined, \r\n  UploadOutlined,\r\n  SettingOutlined,\r\n  BgColorsOutlined,\r\n  AppstoreOutlined,\r\n  MailOutlined,\r\n  MessageOutlined,\r\n  LockOutlined\r\n} from '@ant-design/icons';\r\nimport { \r\n  Settings,\r\n  Palette,\r\n  Zap,\r\n  Mail,\r\n  MessageSquare,\r\n  Shield,\r\n  Globe,\r\n  DollarSign,\r\n  Clock\r\n} from 'lucide-react';\r\nimport { PageHeader } from '@/components/common';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { TenantSettings } from '@/types/rbac';\r\nimport type { Color } from 'antd/es/color-picker';\r\n\r\nconst { TextArea } = Input;\r\n\r\nexport const TenantConfigurationPage: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const tenantService = useService<any>('tenantService');\r\n  const [form] = Form.useForm();\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [settings, setSettings] = useState<TenantSettings | null>(null);\r\n  const [activeTab, setActiveTab] = useState('general');\r\n\r\n  const fetchSettings = useCallback(async (): Promise<void> => {\r\n    try {\r\n      setLoading(true);\r\n      const tenant = await tenantService.getCurrentTenant();\r\n      if (tenant) {\r\n        setSettings(tenant.settings);\r\n        form.setFieldsValue({\r\n          // General\r\n          timezone: tenant.settings.timezone,\r\n          date_format: tenant.settings.date_format,\r\n          time_format: tenant.settings.time_format,\r\n          currency: tenant.settings.currency,\r\n          language: tenant.settings.language,\r\n          \r\n          // Branding\r\n          company_name: tenant.settings.branding.company_name,\r\n          logo_url: tenant.settings.branding.logo_url,\r\n          primary_color: tenant.settings.branding.primary_color,\r\n          secondary_color: tenant.settings.branding.secondary_color,\r\n          \r\n          // Features\r\n          enable_customers: tenant.settings.features.enable_customers,\r\n          enable_sales: tenant.settings.features.enable_sales,\r\n          enable_contracts: tenant.settings.features.enable_contracts,\r\n          enable_tickets: tenant.settings.features.enable_tickets,\r\n          enable_complaints: tenant.settings.features.enable_complaints,\r\n          enable_job_works: tenant.settings.features.enable_job_works,\r\n          \r\n          // Email\r\n          email_enabled: tenant.settings.email?.enabled || false,\r\n          smtp_host: tenant.settings.email?.smtp_host || '',\r\n          smtp_port: tenant.settings.email?.smtp_port || 587,\r\n          smtp_user: tenant.settings.email?.smtp_user || '',\r\n          smtp_from: tenant.settings.email?.smtp_from || '',\r\n          \r\n          // SMS\r\n          sms_enabled: tenant.settings.sms?.enabled || false,\r\n          sms_provider: tenant.settings.sms?.provider || 'twilio',\r\n          \r\n          // Security\r\n          mfa_enabled: tenant.settings.security?.mfa_enabled || false,\r\n          password_expiry_days: tenant.settings.security?.password_expiry_days || 90,\r\n          session_timeout_minutes: tenant.settings.security?.session_timeout_minutes || 30,\r\n          ip_whitelist_enabled: tenant.settings.security?.ip_whitelist_enabled || false\r\n        });\r\n      }\r\n    } catch (error: unknown) {\r\n      console.error('Failed to fetch settings:', error);\r\n      message.error('Failed to load tenant settings');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [form]);\r\n\r\n  useEffect(() => {\r\n    void fetchSettings();\r\n  }, [fetchSettings]);\r\n\r\n  const handleSave = async (): Promise<void> => {\r\n    try {\r\n      setSaving(true);\r\n      const values = await form.validateFields() as Record<string, unknown>;\r\n      \r\n      if (!user?.tenant_id) {\r\n        message.error('Tenant ID not found');\r\n        return;\r\n      }\r\n\r\n      const allowedIps = typeof values.allowed_ips === 'string' \r\n        ? values.allowed_ips.split(',').map((ip: string) => ip.trim())\r\n        : [];\r\n\r\n      const updatedSettings: Partial<TenantSettings> = {\r\n        timezone: values.timezone as string,\r\n        date_format: values.date_format as string,\r\n        time_format: values.time_format as string,\r\n        currency: values.currency as string,\r\n        language: values.language as string,\r\n        branding: {\r\n          company_name: values.company_name as string,\r\n          logo_url: (values.logo_url as string) || '',\r\n          primary_color: typeof values.primary_color === 'string' \r\n            ? values.primary_color \r\n            : (values.primary_color as { toHexString?: () => string })?.toHexString?.() || '#1890ff',\r\n          secondary_color: typeof values.secondary_color === 'string'\r\n            ? values.secondary_color\r\n            : (values.secondary_color as { toHexString?: () => string })?.toHexString?.() || '#52c41a'\r\n        },\r\n        features: {\r\n          enable_customers: values.enable_customers as boolean,\r\n          enable_sales: values.enable_sales as boolean,\r\n          enable_contracts: values.enable_contracts as boolean,\r\n          enable_tickets: values.enable_tickets as boolean,\r\n          enable_complaints: values.enable_complaints as boolean,\r\n          enable_job_works: values.enable_job_works as boolean\r\n        },\r\n        email: {\r\n          enabled: values.email_enabled as boolean,\r\n          smtp_host: values.smtp_host as string,\r\n          smtp_port: values.smtp_port as number,\r\n          smtp_user: values.smtp_user as string,\r\n          smtp_password: (values.smtp_password as string) || '',\r\n          smtp_from: values.smtp_from as string\r\n        },\r\n        sms: {\r\n          enabled: values.sms_enabled as boolean,\r\n          provider: values.sms_provider as string,\r\n          api_key: (values.sms_api_key as string) || '',\r\n          sender_id: (values.sms_sender_id as string) || ''\r\n        },\r\n        security: {\r\n          mfa_enabled: values.mfa_enabled as boolean,\r\n          password_expiry_days: values.password_expiry_days as number,\r\n          session_timeout_minutes: values.session_timeout_minutes as number,\r\n          ip_whitelist_enabled: values.ip_whitelist_enabled as boolean,\r\n          allowed_ips: allowedIps\r\n        }\r\n      };\r\n\r\n      await tenantService.updateTenantSettings(user.tenant_id, updatedSettings);\r\n      message.success('Settings saved successfully');\r\n      void fetchSettings();\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        console.error('Failed to save settings:', error.message);\r\n        message.error(error.message || 'Failed to save settings');\r\n      }\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleReset = () => {\r\n    fetchSettings();\r\n    message.info('Settings reset to saved values');\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <>\r\n        <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '400px' }}>\r\n          <Spin size=\"large\" />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Tenant Configuration\"\r\n        description=\"Manage your tenant settings, branding, and features\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/dashboard' },\r\n            { title: 'Configuration' }\r\n          ]\r\n        }}\r\n        extra={\r\n          <Space>\r\n            <Button icon={<ReloadOutlined />} onClick={handleReset}>\r\n              Reset\r\n            </Button>\r\n            <Button \r\n              type=\"primary\" \r\n              icon={<SaveOutlined />} \r\n              onClick={handleSave}\r\n              loading={saving}\r\n            >\r\n              Save Changes\r\n            </Button>\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        <Card>\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            autoComplete=\"off\"\r\n          >\r\n            <Tabs\r\n              activeKey={activeTab}\r\n              onChange={setActiveTab}\r\n              items={[\r\n                {\r\n                  label: (\r\n                    <span>\r\n                      <SettingOutlined />\r\n                      General\r\n                    </span>\r\n                  ),\r\n                  key: 'general',\r\n                  children: (\r\n                    <Row gutter={[24, 16]}>\r\n                  <Col span={24}>\r\n                    <h3 style={{ marginBottom: 16 }}>\r\n                      <Globe size={20} style={{ marginRight: 8, verticalAlign: 'middle' }} />\r\n                      Regional Settings\r\n                    </h3>\r\n                  </Col>\r\n                  \r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Timezone\"\r\n                      name=\"timezone\"\r\n                      rules={[{ required: true, message: 'Please select timezone' }]}\r\n                    >\r\n                      <Select placeholder=\"Select timezone\">\r\n                        <Select.Option value=\"UTC\">UTC</Select.Option>\r\n                        <Select.Option value=\"America/New_York\">Eastern Time (ET)</Select.Option>\r\n                        <Select.Option value=\"America/Chicago\">Central Time (CT)</Select.Option>\r\n                        <Select.Option value=\"America/Denver\">Mountain Time (MT)</Select.Option>\r\n                        <Select.Option value=\"America/Los_Angeles\">Pacific Time (PT)</Select.Option>\r\n                        <Select.Option value=\"Europe/London\">London (GMT)</Select.Option>\r\n                        <Select.Option value=\"Europe/Paris\">Paris (CET)</Select.Option>\r\n                        <Select.Option value=\"Asia/Dubai\">Dubai (GST)</Select.Option>\r\n                        <Select.Option value=\"Asia/Kolkata\">India (IST)</Select.Option>\r\n                        <Select.Option value=\"Asia/Singapore\">Singapore (SGT)</Select.Option>\r\n                        <Select.Option value=\"Asia/Tokyo\">Tokyo (JST)</Select.Option>\r\n                        <Select.Option value=\"Australia/Sydney\">Sydney (AEDT)</Select.Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Language\"\r\n                      name=\"language\"\r\n                      rules={[{ required: true, message: 'Please select language' }]}\r\n                    >\r\n                      <Select placeholder=\"Select language\">\r\n                        <Select.Option value=\"en\">English</Select.Option>\r\n                        <Select.Option value=\"es\">Spanish</Select.Option>\r\n                        <Select.Option value=\"fr\">French</Select.Option>\r\n                        <Select.Option value=\"de\">German</Select.Option>\r\n                        <Select.Option value=\"ar\">Arabic</Select.Option>\r\n                        <Select.Option value=\"hi\">Hindi</Select.Option>\r\n                        <Select.Option value=\"zh\">Chinese</Select.Option>\r\n                        <Select.Option value=\"ja\">Japanese</Select.Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={8}>\r\n                    <Form.Item\r\n                      label=\"Date Format\"\r\n                      name=\"date_format\"\r\n                      rules={[{ required: true, message: 'Please select date format' }]}\r\n                    >\r\n                      <Select placeholder=\"Select date format\">\r\n                        <Select.Option value=\"MM/DD/YYYY\">MM/DD/YYYY</Select.Option>\r\n                        <Select.Option value=\"DD/MM/YYYY\">DD/MM/YYYY</Select.Option>\r\n                        <Select.Option value=\"YYYY-MM-DD\">YYYY-MM-DD</Select.Option>\r\n                        <Select.Option value=\"DD-MMM-YYYY\">DD-MMM-YYYY</Select.Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={8}>\r\n                    <Form.Item\r\n                      label=\"Time Format\"\r\n                      name=\"time_format\"\r\n                      rules={[{ required: true, message: 'Please select time format' }]}\r\n                    >\r\n                      <Select placeholder=\"Select time format\">\r\n                        <Select.Option value=\"12h\">12 Hour (AM/PM)</Select.Option>\r\n                        <Select.Option value=\"24h\">24 Hour</Select.Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={8}>\r\n                    <Form.Item\r\n                      label=\"Currency\"\r\n                      name=\"currency\"\r\n                      rules={[{ required: true, message: 'Please select currency' }]}\r\n                    >\r\n                      <Select placeholder=\"Select currency\">\r\n                        <Select.Option value=\"USD\">USD ($)</Select.Option>\r\n                        <Select.Option value=\"EUR\">EUR (‚Ç¨)</Select.Option>\r\n                        <Select.Option value=\"GBP\">GBP (¬£)</Select.Option>\r\n                        <Select.Option value=\"AED\">AED (ÿØ.ÿ•)</Select.Option>\r\n                        <Select.Option value=\"INR\">INR (‚Çπ)</Select.Option>\r\n                        <Select.Option value=\"JPY\">JPY (¬•)</Select.Option>\r\n                        <Select.Option value=\"CNY\">CNY (¬•)</Select.Option>\r\n                        <Select.Option value=\"AUD\">AUD ($)</Select.Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n                  </Col>\r\n                    </Row>\r\n                  )\r\n                },\r\n                {\r\n                  label: (\r\n                    <span>\r\n                      <BgColorsOutlined />\r\n                      Branding\r\n                    </span>\r\n                  ),\r\n                  key: 'branding',\r\n                  children: (\r\n                    <Row gutter={[24, 16]}>\r\n                  <Col span={24}>\r\n                    <h3 style={{ marginBottom: 16 }}>\r\n                      <Palette size={20} style={{ marginRight: 8, verticalAlign: 'middle' }} />\r\n                      Company Branding\r\n                    </h3>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Company Name\"\r\n                      name=\"company_name\"\r\n                      rules={[{ required: true, message: 'Please enter company name' }]}\r\n                    >\r\n                      <Input placeholder=\"Enter company name\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Logo URL\"\r\n                      name=\"logo_url\"\r\n                    >\r\n                      <Input placeholder=\"https://example.com/logo.png\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Primary Color\"\r\n                      name=\"primary_color\"\r\n                    >\r\n                      <ColorPicker \r\n                        showText \r\n                        format=\"hex\"\r\n                        style={{ width: '100%' }}\r\n                      />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Secondary Color\"\r\n                      name=\"secondary_color\"\r\n                    >\r\n                      <ColorPicker \r\n                        showText \r\n                        format=\"hex\"\r\n                        style={{ width: '100%' }}\r\n                      />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col span={24}>\r\n                    <Divider />\r\n                    <p style={{ color: '#8c8c8c', fontSize: '14px' }}>\r\n                      <strong>Note:</strong> Logo and color changes will be applied across the entire application.\r\n                      Make sure to use high-quality images and accessible color combinations.\r\n                    </p>\r\n                  </Col>\r\n                    </Row>\r\n                  )\r\n                },\r\n                {\r\n                  label: (\r\n                    <span>\r\n                      <AppstoreOutlined />\r\n                      Features\r\n                    </span>\r\n                  ),\r\n                  key: 'features',\r\n                  children: (\r\n                    <Row gutter={[24, 16]}>\r\n                  <Col span={24}>\r\n                    <h3 style={{ marginBottom: 16 }}>\r\n                      <Zap size={20} style={{ marginRight: 8, verticalAlign: 'middle' }} />\r\n                      Module Management\r\n                    </h3>\r\n                    <p style={{ color: '#8c8c8c', marginBottom: 24 }}>\r\n                      Enable or disable modules for your organization\r\n                    </p>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Card size=\"small\">\r\n                      <Form.Item\r\n                        label=\"Customer Management\"\r\n                        name=\"enable_customers\"\r\n                        valuePropName=\"checked\"\r\n                        style={{ marginBottom: 0 }}\r\n                      >\r\n                        <Switch />\r\n                      </Form.Item>\r\n                      <p style={{ color: '#8c8c8c', fontSize: '12px', marginTop: 8 }}>\r\n                        Manage customer information and relationships\r\n                      </p>\r\n                    </Card>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Card size=\"small\">\r\n                      <Form.Item\r\n                        label=\"Sales Management\"\r\n                        name=\"enable_sales\"\r\n                        valuePropName=\"checked\"\r\n                        style={{ marginBottom: 0 }}\r\n                      >\r\n                        <Switch />\r\n                      </Form.Item>\r\n                      <p style={{ color: '#8c8c8c', fontSize: '12px', marginTop: 8 }}>\r\n                        Track sales opportunities and product sales\r\n                      </p>\r\n                    </Card>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Card size=\"small\">\r\n                      <Form.Item\r\n                        label=\"Contract Management\"\r\n                        name=\"enable_contracts\"\r\n                        valuePropName=\"checked\"\r\n                        style={{ marginBottom: 0 }}\r\n                      >\r\n                        <Switch />\r\n                      </Form.Item>\r\n                      <p style={{ color: '#8c8c8c', fontSize: '12px', marginTop: 8 }}>\r\n                        Manage contracts and service agreements\r\n                      </p>\r\n                    </Card>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Card size=\"small\">\r\n                      <Form.Item\r\n                        label=\"Support Tickets\"\r\n                        name=\"enable_tickets\"\r\n                        valuePropName=\"checked\"\r\n                        style={{ marginBottom: 0 }}\r\n                      >\r\n                        <Switch />\r\n                      </Form.Item>\r\n                      <p style={{ color: '#8c8c8c', fontSize: '12px', marginTop: 8 }}>\r\n                        Handle customer support tickets\r\n                      </p>\r\n                    </Card>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Card size=\"small\">\r\n                      <Form.Item\r\n                        label=\"Complaints Management\"\r\n                        name=\"enable_complaints\"\r\n                        valuePropName=\"checked\"\r\n                        style={{ marginBottom: 0 }}\r\n                      >\r\n                        <Switch />\r\n                      </Form.Item>\r\n                      <p style={{ color: '#8c8c8c', fontSize: '12px', marginTop: 8 }}>\r\n                        Track and resolve customer complaints\r\n                      </p>\r\n                    </Card>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Card size=\"small\">\r\n                      <Form.Item\r\n                        label=\"Job Works\"\r\n                        name=\"enable_job_works\"\r\n                        valuePropName=\"checked\"\r\n                        style={{ marginBottom: 0 }}\r\n                      >\r\n                        <Switch />\r\n                      </Form.Item>\r\n                      <p style={{ color: '#8c8c8c', fontSize: '12px', marginTop: 8 }}>\r\n                        Manage job work assignments and tracking\r\n                      </p>\r\n                    </Card>\r\n                  </Col>\r\n                    </Row>\r\n                  )\r\n                },\r\n                {\r\n                  label: (\r\n                    <span>\r\n                      <MailOutlined />\r\n                      Email\r\n                    </span>\r\n                  ),\r\n                  key: 'email',\r\n                  children: (\r\n                    <Row gutter={[24, 16]}>\r\n                  <Col span={24}>\r\n                    <h3 style={{ marginBottom: 16 }}>\r\n                      <Mail size={20} style={{ marginRight: 8, verticalAlign: 'middle' }} />\r\n                      Email Configuration\r\n                    </h3>\r\n                  </Col>\r\n\r\n                  <Col span={24}>\r\n                    <Form.Item\r\n                      label=\"Enable Email Notifications\"\r\n                      name=\"email_enabled\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"SMTP Host\"\r\n                      name=\"smtp_host\"\r\n                    >\r\n                      <Input placeholder=\"smtp.gmail.com\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"SMTP Port\"\r\n                      name=\"smtp_port\"\r\n                    >\r\n                      <Input type=\"number\" placeholder=\"587\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"SMTP Username\"\r\n                      name=\"smtp_user\"\r\n                    >\r\n                      <Input placeholder=\"your-email@example.com\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"SMTP Password\"\r\n                      name=\"smtp_password\"\r\n                    >\r\n                      <Input.Password placeholder=\"Enter SMTP password\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"From Email Address\"\r\n                      name=\"smtp_from\"\r\n                    >\r\n                      <Input placeholder=\"noreply@example.com\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n                    </Row>\r\n                  )\r\n                },\r\n                {\r\n                  label: (\r\n                    <span>\r\n                      <MessageOutlined />\r\n                      SMS\r\n                    </span>\r\n                  ),\r\n                  key: 'sms',\r\n                  children: (\r\n                    <Row gutter={[24, 16]}>\r\n                  <Col span={24}>\r\n                    <h3 style={{ marginBottom: 16 }}>\r\n                      <MessageSquare size={20} style={{ marginRight: 8, verticalAlign: 'middle' }} />\r\n                      SMS Configuration\r\n                    </h3>\r\n                  </Col>\r\n\r\n                  <Col span={24}>\r\n                    <Form.Item\r\n                      label=\"Enable SMS Notifications\"\r\n                      name=\"sms_enabled\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"SMS Provider\"\r\n                      name=\"sms_provider\"\r\n                    >\r\n                      <Select placeholder=\"Select SMS provider\">\r\n                        <Select.Option value=\"twilio\">Twilio</Select.Option>\r\n                        <Select.Option value=\"aws_sns\">AWS SNS</Select.Option>\r\n                        <Select.Option value=\"nexmo\">Nexmo</Select.Option>\r\n                        <Select.Option value=\"msg91\">MSG91</Select.Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"API Key\"\r\n                      name=\"sms_api_key\"\r\n                    >\r\n                      <Input.Password placeholder=\"Enter API key\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Sender ID\"\r\n                      name=\"sms_sender_id\"\r\n                    >\r\n                      <Input placeholder=\"Enter sender ID\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n                    </Row>\r\n                  )\r\n                },\r\n                {\r\n                  label: (\r\n                    <span>\r\n                      <LockOutlined />\r\n                      Security\r\n                    </span>\r\n                  ),\r\n                  key: 'security',\r\n                  children: (\r\n                    <Row gutter={[24, 16]}>\r\n                  <Col span={24}>\r\n                    <h3 style={{ marginBottom: 16 }}>\r\n                      <Shield size={20} style={{ marginRight: 8, verticalAlign: 'middle' }} />\r\n                      Security Settings\r\n                    </h3>\r\n                  </Col>\r\n\r\n                  <Col span={24}>\r\n                    <Form.Item\r\n                      label=\"Enable Multi-Factor Authentication (MFA)\"\r\n                      name=\"mfa_enabled\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Password Expiry (Days)\"\r\n                      name=\"password_expiry_days\"\r\n                    >\r\n                      <Input type=\"number\" placeholder=\"90\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col xs={24} md={12}>\r\n                    <Form.Item\r\n                      label=\"Session Timeout (Minutes)\"\r\n                      name=\"session_timeout_minutes\"\r\n                    >\r\n                      <Input type=\"number\" placeholder=\"30\" />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col span={24}>\r\n                    <Form.Item\r\n                      label=\"Enable IP Whitelist\"\r\n                      name=\"ip_whitelist_enabled\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n                  </Col>\r\n\r\n                  <Col span={24}>\r\n                    <Form.Item\r\n                      label=\"Allowed IP Addresses\"\r\n                      name=\"allowed_ips\"\r\n                      help=\"Enter comma-separated IP addresses (e.g., 192.168.1.1, 10.0.0.1)\"\r\n                    >\r\n                      <TextArea \r\n                        rows={3} \r\n                        placeholder=\"192.168.1.1, 10.0.0.1, 172.16.0.1\"\r\n                      />\r\n                    </Form.Item>\r\n                  </Col>\r\n                    </Row>\r\n                  )\r\n                }\r\n              ]}\r\n            />\r\n          </Form>\r\n        </Card>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default TenantConfigurationPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\components\\ContractDetailPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5743,5746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5743,5746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6729,6732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6729,6732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8565,8568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8565,8568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8620,8623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8620,8623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8694,8697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8694,8697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8757,8760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8757,8760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":273,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9709,9712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9709,9712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9764,9767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9764,9767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9834,9837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9834,9837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9897,9900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9897,9900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11229,11232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11229,11232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":301,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11284,11287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11284,11287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11356,11359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11356,11359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11419,11422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11419,11422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12709,12712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12709,12712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":327,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12764,12767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12764,12767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12838,12841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12838,12841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12901,12904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12901,12904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":346,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":346,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13772,13775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13772,13775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":347,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":347,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13827,13830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13827,13830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":348,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13897,13900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13897,13900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":349,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13960,13963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13960,13963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":369,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":369,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15073,15076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15073,15076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":370,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15128,15131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15128,15131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":371,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15205,15208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15205,15208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":372,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15268,15271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15268,15271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16068,16071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16068,16071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":386,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":386,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16125,16128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16125,16128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":388,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":388,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16246,16249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16246,16249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Contract Detail Panel - Enterprise Edition\r\n * Side drawer for viewing contract details in read-only mode with professional UI/UX\r\n * ‚ú® Enhanced with:\r\n *   - Professional card-based layout\r\n *   - Clear visual hierarchy\r\n *   - Rich metric displays\r\n *   - Status indicators with badges\r\n *   - Organized sections\r\n */\r\n\r\nimport React from 'react';\r\nimport { \r\n  Drawer, Descriptions, Button, Space, Divider, Tag, Empty, Row, Col, Statistic, \r\n  Card, Alert, Progress\r\n} from 'antd';\r\nimport { \r\n  EditOutlined, MailOutlined, CalendarOutlined, DollarOutlined, FileTextOutlined,\r\n  UserOutlined, SafetyOutlined, CheckCircleOutlined, SyncOutlined, ArrowRightOutlined\r\n} from '@ant-design/icons';\r\nimport { Contract } from '@/types/contracts';\r\n\r\ninterface ContractDetailPanelProps {\r\n  visible: boolean;\r\n  contract: Contract | null;\r\n  onClose: () => void;\r\n  onEdit: () => void;\r\n}\r\n\r\n// Status styling configurations\r\nconst statusConfig = {\r\n  draft: { color: 'processing', icon: 'üìù', bg: '#f0f5ff' },\r\n  pending_approval: { color: 'warning', icon: '‚è≥', bg: '#fffbe6' },\r\n  active: { color: 'success', icon: '‚úÖ', bg: '#f6ffed' },\r\n  renewed: { color: 'processing', icon: 'üîÑ', bg: '#f0f5ff' },\r\n  expired: { color: 'error', icon: '‚ùå', bg: '#fff1f0' },\r\n  terminated: { color: 'error', icon: 'üõë', bg: '#fff1f0' },\r\n};\r\n\r\nconst typeConfig = {\r\n  service_agreement: { color: 'blue', icon: 'üìã' },\r\n  nda: { color: 'purple', icon: 'üîí' },\r\n  purchase_order: { color: 'green', icon: 'üì¶' },\r\n  employment: { color: 'orange', icon: 'üë§' },\r\n  custom: { color: 'default', icon: '‚öôÔ∏è' },\r\n};\r\n\r\nconst priorityConfig = {\r\n  low: { color: 'success', icon: 'üü¢' },\r\n  medium: { color: 'processing', icon: 'üü°' },\r\n  high: { color: 'warning', icon: 'üü†' },\r\n  urgent: { color: 'error', icon: 'üî¥' },\r\n};\r\n\r\nconst sectionStyles = {\r\n  card: {\r\n    marginBottom: 20,\r\n    boxShadow: '0 1px 3px rgba(0,0,0,0.08)',\r\n    border: '1px solid #f0f0f0',\r\n    borderRadius: 8,\r\n  },\r\n  header: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gap: 10,\r\n    marginBottom: 20,\r\n    paddingBottom: 12,\r\n    borderBottom: '2px solid #f0f0f0',\r\n  },\r\n  headerIcon: {\r\n    fontSize: 18,\r\n    color: '#0ea5e9',\r\n  },\r\n  headerTitle: {\r\n    fontSize: 15,\r\n    fontWeight: 700,\r\n    color: '#1f2937',\r\n    margin: 0,\r\n  },\r\n};\r\n\r\nexport const ContractDetailPanel: React.FC<ContractDetailPanelProps> = ({\r\n  visible,\r\n  contract,\r\n  onClose,\r\n  onEdit,\r\n}) => {\r\n  if (!contract) {\r\n    return null;\r\n  }\r\n\r\n  const getStatusColor = (status: string): string => {\r\n    const colorMap: Record<string, string> = {\r\n      'active': 'green',\r\n      'draft': 'default',\r\n      'pending_approval': 'orange',\r\n      'expired': 'red',\r\n      'terminated': 'red',\r\n      'renewed': 'blue',\r\n    };\r\n    return colorMap[status] || 'default';\r\n  };\r\n\r\n  const getTypeColor = (type: string): string => {\r\n    const colorMap: Record<string, string> = {\r\n      'service_agreement': 'blue',\r\n      'nda': 'purple',\r\n      'purchase_order': 'green',\r\n      'employment': 'orange',\r\n      'custom': 'default',\r\n    };\r\n    return colorMap[type] || 'default';\r\n  };\r\n\r\n  const getPriorityColor = (priority: string): string => {\r\n    const colorMap: Record<string, string> = {\r\n      'urgent': 'red',\r\n      'high': 'orange',\r\n      'medium': 'gold',\r\n      'low': 'green',\r\n    };\r\n    return colorMap[priority] || 'default';\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: contract.currency || 'USD',\r\n    }).format(amount);\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n    });\r\n  };\r\n\r\n  const getDaysRemaining = () => {\r\n    const end = new Date(contract.end_date);\r\n    const now = new Date();\r\n    const diffTime = end.getTime() - now.getTime();\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n    return diffDays;\r\n  };\r\n\r\n  const displayType = contract.type.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase());\r\n  const displayStatus = contract.status.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase());\r\n  const daysRemaining = getDaysRemaining();\r\n  const isExpiringSoon = daysRemaining <= 30 && daysRemaining > 0;\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\r\n          <FileTextOutlined style={{ color: '#0ea5e9', fontSize: 20 }} />\r\n          <span>Contract Details</span>\r\n        </div>\r\n      }\r\n      placement=\"right\"\r\n      width={600}\r\n      onClose={onClose}\r\n      open={visible}\r\n      footer={\r\n        <Space style={{ float: 'right', gap: 8 }}>\r\n          <Button size=\"large\" onClick={onClose}>\r\n            Close\r\n          </Button>\r\n          <Button \r\n            type=\"primary\" \r\n            icon={<EditOutlined />} \r\n            onClick={onEdit}\r\n            size=\"large\"\r\n          >\r\n            Edit Contract\r\n          </Button>\r\n        </Space>\r\n      }\r\n      styles={{\r\n        header: { borderBottom: '1px solid #e5e7eb' },\r\n        body: { padding: '24px', background: '#fafafa' }\r\n      }}\r\n    >\r\n      {contract ? (\r\n        <div>\r\n          {/* Expiring Soon Alert */}\r\n          {isExpiringSoon && (\r\n            <Alert\r\n              message={`Contract expires in ${daysRemaining} days`}\r\n              description=\"Consider initiating renewal process or reviewing terms\"\r\n              type=\"warning\"\r\n              showIcon\r\n              style={{ marginBottom: 20 }}\r\n            />\r\n          )}\r\n\r\n          {/* Key Metrics Section */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <Row gutter={[16, 16]}>\r\n              <Col xs={24} sm={12}>\r\n                <Statistic\r\n                  title=\"Contract Value\"\r\n                  value={formatCurrency(contract.value || 0)}\r\n                  prefix={<DollarOutlined style={{ color: '#10b981' }} />}\r\n                  valueStyle={{ color: '#1f2937', fontSize: 20, fontWeight: 700 }}\r\n                />\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Statistic\r\n                  title=\"Days Remaining\"\r\n                  value={daysRemaining}\r\n                  suffix={daysRemaining > 0 ? 'days' : 'Expired'}\r\n                  prefix={<CalendarOutlined style={{ color: '#f59e0b' }} />}\r\n                  valueStyle={{ color: daysRemaining > 0 ? '#1f2937' : '#dc2626', fontSize: 20, fontWeight: 700 }}\r\n                />\r\n              </Col>\r\n            </Row>\r\n          </Card>\r\n\r\n          {/* Status Badges */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={8}>\r\n                <div style={{ padding: '12px', background: statusConfig[contract.status as keyof typeof statusConfig]?.bg || '#f0f0f0', borderRadius: 8, textAlign: 'center' }}>\r\n                  <div style={{ fontSize: 12, color: '#666', marginBottom: 8 }}>Status</div>\r\n                  <Tag color={getStatusColor(contract.status)} style={{ fontSize: 12, padding: '4px 8px' }}>\r\n                    {statusConfig[contract.status as keyof typeof statusConfig]?.icon} {displayStatus}\r\n                  </Tag>\r\n                </div>\r\n              </Col>\r\n              <Col xs={24} sm={8}>\r\n                <div style={{ padding: '12px', background: '#f0f5ff', borderRadius: 8, textAlign: 'center' }}>\r\n                  <div style={{ fontSize: 12, color: '#666', marginBottom: 8 }}>Type</div>\r\n                  <Tag color={getTypeColor(contract.type)} style={{ fontSize: 12, padding: '4px 8px' }}>\r\n                    {typeConfig[contract.type as keyof typeof typeConfig]?.icon} {displayType}\r\n                  </Tag>\r\n                </div>\r\n              </Col>\r\n              <Col xs={24} sm={8}>\r\n                <div style={{ padding: '12px', background: '#fef2f2', borderRadius: 8, textAlign: 'center' }}>\r\n                  <div style={{ fontSize: 12, color: '#666', marginBottom: 8 }}>Priority</div>\r\n                  <Tag color={getPriorityColor(contract.priority)} style={{ fontSize: 12, padding: '4px 8px' }}>\r\n                    {priorityConfig[contract.priority as keyof typeof priorityConfig]?.icon} {contract.priority?.toUpperCase()}\r\n                  </Tag>\r\n                </div>\r\n              </Col>\r\n            </Row>\r\n          </Card>\r\n\r\n          {/* Basic Information Section */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <div style={sectionStyles.header as any}>\r\n              <FileTextOutlined style={sectionStyles.headerIcon as any} />\r\n              <h3 style={sectionStyles.headerTitle as any}>Basic Information</h3>\r\n            </div>\r\n            <Descriptions column={1} size=\"small\">\r\n              <Descriptions.Item label=\"Title\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.title}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Contract Number\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                <code style={{ background: '#f3f4f6', padding: '2px 6px', borderRadius: 4 }}>\r\n                  {contract.contract_number}\r\n                </code>\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Description\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.description || <span style={{ color: '#9ca3af' }}>‚Äî</span>}\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n          </Card>\r\n\r\n          {/* Party Information Section */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <div style={sectionStyles.header as any}>\r\n              <UserOutlined style={sectionStyles.headerIcon as any} />\r\n              <h3 style={sectionStyles.headerTitle as any}>Party Information</h3>\r\n            </div>\r\n            <Descriptions column={1} size=\"small\">\r\n              <Descriptions.Item label=\"Customer Name\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.customer_name}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Contact\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.customer_contact ? (\r\n                  <a href={`mailto:${contract.customer_contact}`} style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                    <MailOutlined /> {contract.customer_contact}\r\n                  </a>\r\n                ) : <span style={{ color: '#9ca3af' }}>‚Äî</span>}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Assigned To\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.assigned_to_name ? (\r\n                  <span style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n                    <UserOutlined /> {contract.assigned_to_name}\r\n                  </span>\r\n                ) : <span style={{ color: '#9ca3af' }}>‚Äî</span>}\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n          </Card>\r\n\r\n          {/* Financial Information Section */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <div style={sectionStyles.header as any}>\r\n              <DollarOutlined style={sectionStyles.headerIcon as any} />\r\n              <h3 style={sectionStyles.headerTitle as any}>Financial Information</h3>\r\n            </div>\r\n            <Descriptions column={1} size=\"small\">\r\n              <Descriptions.Item label=\"Contract Value\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                <span style={{ fontSize: 15, fontWeight: 700, color: '#10b981' }}>\r\n                  {formatCurrency(contract.value || 0)}\r\n                </span>\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Currency\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.currency || 'USD'}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Payment Terms\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.payment_terms ? (\r\n                  <Tag color=\"blue\">{contract.payment_terms}</Tag>\r\n                ) : <span style={{ color: '#9ca3af' }}>‚Äî</span>}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Delivery Terms\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.delivery_terms || <span style={{ color: '#9ca3af' }}>‚Äî</span>}\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n          </Card>\r\n\r\n          {/* Duration Section */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <div style={sectionStyles.header as any}>\r\n              <CalendarOutlined style={sectionStyles.headerIcon as any} />\r\n              <h3 style={sectionStyles.headerTitle as any}>Duration</h3>\r\n            </div>\r\n            <Descriptions column={1} size=\"small\">\r\n              <Descriptions.Item label=\"Start Date\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                <span style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                  <CalendarOutlined /> {formatDate(contract.start_date)}\r\n                </span>\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"End Date\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                <span style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                  <CalendarOutlined /> {formatDate(contract.end_date)}\r\n                </span>\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n          </Card>\r\n\r\n          {/* Renewal Settings Section */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <div style={sectionStyles.header as any}>\r\n              <SyncOutlined style={sectionStyles.headerIcon as any} />\r\n              <h3 style={sectionStyles.headerTitle as any}>Renewal Settings</h3>\r\n            </div>\r\n            <Descriptions column={1} size=\"small\">\r\n              <Descriptions.Item label=\"Auto Renewal\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                <Tag color={contract.auto_renew ? 'green' : 'default'}>\r\n                  {contract.auto_renew ? 'üîÑ Enabled' : '‚õî Disabled'}\r\n                </Tag>\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Renewal Period\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.renewal_period_months ? (\r\n                  <span>{contract.renewal_period_months} months</span>\r\n                ) : <span style={{ color: '#9ca3af' }}>‚Äî</span>}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Renewal Terms\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                {contract.renewal_terms || <span style={{ color: '#9ca3af' }}>‚Äî</span>}\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n          </Card>\r\n\r\n          {/* Compliance Section */}\r\n          <Card style={sectionStyles.card as any}>\r\n            <div style={sectionStyles.header as any}>\r\n              <CheckCircleOutlined style={sectionStyles.headerIcon as any} />\r\n              <h3 style={sectionStyles.headerTitle as any}>Compliance</h3>\r\n            </div>\r\n            <Descriptions column={1} size=\"small\">\r\n              <Descriptions.Item label=\"Compliance Status\" labelStyle={{ fontWeight: 600, color: '#374151' }}>\r\n                <Tag color={contract.compliance_status === 'compliant' ? 'green' : contract.compliance_status === 'pending_review' ? 'orange' : 'red'}>\r\n                  {contract.compliance_status === 'compliant' ? '‚úÖ' : contract.compliance_status === 'pending_review' ? '‚è≥' : '‚ùå'} {contract.compliance_status?.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\r\n                </Tag>\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n          </Card>\r\n\r\n          {/* Notes Section */}\r\n          {contract.notes && (\r\n            <Card style={sectionStyles.card as any}>\r\n              <div style={sectionStyles.header as any}>\r\n                <span style={{ fontSize: 16 }}>üìù</span>\r\n                <h3 style={sectionStyles.headerTitle as any}>Additional Notes</h3>\r\n              </div>\r\n              <div style={{ \r\n                padding: 12, \r\n                background: '#fffbeb', \r\n                borderRadius: 8,\r\n                border: '1px solid #fcd34d',\r\n                whiteSpace: 'pre-wrap',\r\n                wordBreak: 'break-word',\r\n                color: '#42342a',\r\n                lineHeight: '1.6',\r\n              }}>\r\n                {contract.notes}\r\n              </div>\r\n            </Card>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <Empty description=\"No contract selected\" />\r\n      )}\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\components\\ContractFormPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4887,4890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4887,4890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4940,4943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4940,4943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5012,5015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5012,5015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5073,5076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5073,5076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6652,6655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6652,6655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6705,6708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6705,6708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":233,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6775,6778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6775,6778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6836,6839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6836,6839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10173,10176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10173,10176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":312,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10226,10229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10226,10229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10294,10297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10294,10297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10355,10358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10355,10358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11850,11853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11850,11853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":362,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11903,11906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11903,11906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":363,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11973,11976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11973,11976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":364,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":364,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12034,12037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12034,12037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":419,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":419,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14093,14096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14093,14096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":420,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14146,14149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14146,14149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":421,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":421,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14218,14221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14218,14221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":422,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14279,14282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14279,14282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":458,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15499,15502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15499,15502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":459,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":459,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15552,15555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15552,15555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":460,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":460,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15620,15623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15620,15623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":461,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15681,15684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15681,15684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":503,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16970,16973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16970,16973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":504,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":504,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17023,17026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17023,17026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":505,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":505,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17098,17101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17098,17101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":506,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":506,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17159,17162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17159,17162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Contract Form Panel - Enterprise Edition\r\n * Side drawer for creating/editing contract information with professional UI/UX\r\n * ‚ú® Enhanced with:\r\n *   - Professional visual hierarchy\r\n *   - Organized section cards\r\n *   - Field grouping and descriptions\r\n *   - Improved spacing and typography\r\n *   - Better validation feedback\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { \r\n  Drawer, Form, Input, Select, Button, Space, message, InputNumber, Checkbox, DatePicker, \r\n  Card, Row, Col, Divider, Alert\r\n} from 'antd';\r\nimport { \r\n  FileTextOutlined, CalendarOutlined, DollarOutlined, UserOutlined, \r\n  SafetyOutlined, CheckCircleOutlined, SyncOutlined, SaveOutlined, CloseOutlined \r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { Contract } from '@/types/contracts';\r\nimport { useCreateContract, useUpdateContract } from '../hooks/useContracts';\r\n\r\ninterface ContractFormPanelProps {\r\n  visible: boolean;\r\n  contract: Contract | null;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\n// Professional section styling\r\nconst sectionStyles = {\r\n  header: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gap: 10,\r\n    marginBottom: 20,\r\n    paddingBottom: 12,\r\n    borderBottom: '2px solid #f0f0f0',\r\n  },\r\n  headerTitle: {\r\n    fontSize: 15,\r\n    fontWeight: 700,\r\n    color: '#1f2937',\r\n    margin: 0,\r\n  },\r\n  headerIcon: {\r\n    fontSize: 18,\r\n    color: '#0ea5e9',\r\n  },\r\n  card: {\r\n    marginBottom: 20,\r\n    boxShadow: '0 1px 3px rgba(0,0,0,0.08)',\r\n    border: '1px solid #f0f0f0',\r\n    borderRadius: 8,\r\n  },\r\n  fieldGroup: {\r\n    display: 'grid',\r\n    gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',\r\n    gap: 16,\r\n  },\r\n  fieldLabel: {\r\n    fontSize: 13,\r\n    fontWeight: 600,\r\n    color: '#374151',\r\n    marginBottom: 8,\r\n    display: 'block',\r\n  },\r\n  fieldDescription: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n    marginBottom: 8,\r\n  },\r\n};\r\n\r\nexport const ContractFormPanel: React.FC<ContractFormPanelProps> = ({\r\n  visible,\r\n  contract,\r\n  onClose,\r\n  onSuccess,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [loading, setLoading] = useState(false);\r\n  const createContract = useCreateContract();\r\n  const updateContract = useUpdateContract();\r\n\r\n  const isEditMode = !!contract;\r\n\r\n  useEffect(() => {\r\n    if (visible && contract) {\r\n      form.setFieldsValue({\r\n        ...contract,\r\n        start_date: contract.start_date ? dayjs(contract.start_date) : null,\r\n        end_date: contract.end_date ? dayjs(contract.end_date) : null,\r\n      });\r\n    } else if (visible) {\r\n      form.resetFields();\r\n    }\r\n  }, [visible, contract, form]);\r\n\r\n  const handleSubmit = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      setLoading(true);\r\n\r\n      // Convert dayjs objects to date strings\r\n      const formData = {\r\n        ...values,\r\n        start_date: values.start_date ? values.start_date.format('YYYY-MM-DD') : '',\r\n        end_date: values.end_date ? values.end_date.format('YYYY-MM-DD') : '',\r\n      };\r\n\r\n      if (isEditMode && contract) {\r\n        await updateContract.mutateAsync({\r\n          id: contract.id,\r\n          data: formData,\r\n        });\r\n        message.success('Contract updated successfully');\r\n      } else {\r\n        await createContract.mutateAsync(formData);\r\n        message.success('Contract created successfully');\r\n      }\r\n\r\n      onSuccess();\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        message.error(error.message);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\r\n          <FileTextOutlined style={{ color: '#0ea5e9', fontSize: 20 }} />\r\n          <span>{isEditMode ? 'Edit Contract' : 'Create New Contract'}</span>\r\n        </div>\r\n      }\r\n      placement=\"right\"\r\n      width={600}\r\n      onClose={onClose}\r\n      open={visible}\r\n      footer={\r\n        <Space style={{ float: 'right', gap: 8 }}>\r\n          <Button \r\n            icon={<CloseOutlined />} \r\n            onClick={onClose}\r\n            size=\"large\"\r\n          >\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            type=\"primary\"\r\n            loading={loading}\r\n            onClick={handleSubmit}\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n          >\r\n            {isEditMode ? 'Update Contract' : 'Create Contract'}\r\n          </Button>\r\n        </Space>\r\n      }\r\n      styles={{\r\n        header: { borderBottom: '1px solid #e5e7eb' },\r\n        body: { padding: '24px', background: '#fafafa' }\r\n      }}\r\n    >\r\n      <Form\r\n        form={form}\r\n        layout=\"vertical\"\r\n        requiredMark=\"optional\"\r\n        autoComplete=\"off\"\r\n      >\r\n        {/* Basic Information Section */}\r\n        <Card style={sectionStyles.card as any}>\r\n          <div style={sectionStyles.header as any}>\r\n            <FileTextOutlined style={sectionStyles.headerIcon as any} />\r\n            <h3 style={sectionStyles.headerTitle as any}>Basic Information</h3>\r\n          </div>\r\n\r\n          <Form.Item\r\n            label=\"Contract Title\"\r\n            name=\"title\"\r\n            rules={[\r\n              { required: true, message: 'Please enter contract title' },\r\n              { min: 3, message: 'Title must be at least 3 characters' }\r\n            ]}\r\n            tooltip=\"Provide a clear, descriptive title for the contract\"\r\n          >\r\n            <Input \r\n              placeholder=\"e.g., Software License Agreement 2025\" \r\n              size=\"large\"\r\n              prefix={<FileTextOutlined />}\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Contract Number\"\r\n            name=\"contract_number\"\r\n            rules={[{ required: true, message: 'Please enter contract number' }]}\r\n            tooltip=\"Unique identifier for tracking and reference\"\r\n          >\r\n            <Input \r\n              placeholder=\"e.g., CNT-2025-001\" \r\n              size=\"large\"\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Description\"\r\n            name=\"description\"\r\n            tooltip=\"Add details about the contract scope and key terms\"\r\n          >\r\n            <Input.TextArea \r\n              rows={3} \r\n              placeholder=\"Enter contract description, objectives, and key terms...\" \r\n              maxLength={500}\r\n              showCount\r\n            />\r\n          </Form.Item>\r\n        </Card>\r\n\r\n        {/* Contract Details Section */}\r\n        <Card style={sectionStyles.card as any}>\r\n          <div style={sectionStyles.header as any}>\r\n            <SafetyOutlined style={sectionStyles.headerIcon as any} />\r\n            <h3 style={sectionStyles.headerTitle as any}>Contract Details</h3>\r\n          </div>\r\n\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Type\"\r\n                name=\"type\"\r\n                rules={[{ required: true, message: 'Please select contract type' }]}\r\n                tooltip=\"Choose the category of this contract\"\r\n              >\r\n                <Select \r\n                  placeholder=\"Select contract type\"\r\n                  size=\"large\"\r\n                  optionLabelProp=\"label\"\r\n                >\r\n                  <Select.Option value=\"service_agreement\" label=\"üìã Service Agreement\">\r\n                    Service Agreement\r\n                  </Select.Option>\r\n                  <Select.Option value=\"nda\" label=\"üîí NDA\">\r\n                    NDA\r\n                  </Select.Option>\r\n                  <Select.Option value=\"purchase_order\" label=\"üì¶ Purchase Order\">\r\n                    Purchase Order\r\n                  </Select.Option>\r\n                  <Select.Option value=\"employment\" label=\"üë§ Employment\">\r\n                    Employment\r\n                  </Select.Option>\r\n                  <Select.Option value=\"custom\" label=\"‚öôÔ∏è Custom\">\r\n                    Custom\r\n                  </Select.Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Status\"\r\n                name=\"status\"\r\n                rules={[{ required: true, message: 'Please select status' }]}\r\n                tooltip=\"Current state of the contract lifecycle\"\r\n              >\r\n                <Select \r\n                  placeholder=\"Select contract status\"\r\n                  size=\"large\"\r\n                  optionLabelProp=\"label\"\r\n                >\r\n                  <Select.Option value=\"draft\" label=\"üìù Draft\">Draft</Select.Option>\r\n                  <Select.Option value=\"pending_approval\" label=\"‚è≥ Pending\">Pending Approval</Select.Option>\r\n                  <Select.Option value=\"active\" label=\"‚úÖ Active\">Active</Select.Option>\r\n                  <Select.Option value=\"renewed\" label=\"üîÑ Renewed\">Renewed</Select.Option>\r\n                  <Select.Option value=\"expired\" label=\"‚ùå Expired\">Expired</Select.Option>\r\n                  <Select.Option value=\"terminated\" label=\"üõë Terminated\">Terminated</Select.Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item\r\n            label=\"Priority\"\r\n            name=\"priority\"\r\n            rules={[{ required: true, message: 'Please select priority' }]}\r\n            tooltip=\"Set the importance level for this contract\"\r\n          >\r\n            <Select \r\n              placeholder=\"Select priority level\"\r\n              size=\"large\"\r\n              optionLabelProp=\"label\"\r\n            >\r\n              <Select.Option value=\"low\" label=\"üü¢ Low\">Low</Select.Option>\r\n              <Select.Option value=\"medium\" label=\"üü° Medium\">Medium</Select.Option>\r\n              <Select.Option value=\"high\" label=\"üü† High\">High</Select.Option>\r\n              <Select.Option value=\"urgent\" label=\"üî¥ Urgent\">Urgent</Select.Option>\r\n            </Select>\r\n          </Form.Item>\r\n        </Card>\r\n\r\n        {/* Party Information Section */}\r\n        <Card style={sectionStyles.card as any}>\r\n          <div style={sectionStyles.header as any}>\r\n            <UserOutlined style={sectionStyles.headerIcon as any} />\r\n            <h3 style={sectionStyles.headerTitle as any}>Party Information</h3>\r\n          </div>\r\n\r\n          <Form.Item\r\n            label=\"Customer Name\"\r\n            name=\"customer_name\"\r\n            rules={[{ required: true, message: 'Please enter customer name' }]}\r\n            tooltip=\"Name of the organization or individual party\"\r\n          >\r\n            <Input \r\n              placeholder=\"Enter customer/party name\" \r\n              size=\"large\"\r\n              prefix={<UserOutlined />}\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Customer Contact\"\r\n            name=\"customer_contact\"\r\n            rules={[\r\n              { type: 'email', message: 'Please enter a valid email' }\r\n            ]}\r\n            tooltip=\"Email or phone number for primary contact\"\r\n          >\r\n            <Input \r\n              placeholder=\"contact@company.com or +1-xxx-xxx-xxxx\" \r\n              size=\"large\"\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Assigned To\"\r\n            name=\"assigned_to_name\"\r\n            tooltip=\"Name of the internal person responsible for this contract\"\r\n          >\r\n            <Input \r\n              placeholder=\"Enter assigned person name\" \r\n              size=\"large\"\r\n              prefix={<UserOutlined />}\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n        </Card>\r\n\r\n        {/* Financial Information Section */}\r\n        <Card style={sectionStyles.card as any}>\r\n          <div style={sectionStyles.header as any}>\r\n            <DollarOutlined style={sectionStyles.headerIcon as any} />\r\n            <h3 style={sectionStyles.headerTitle as any}>Financial Information</h3>\r\n          </div>\r\n\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Contract Value\"\r\n                name=\"value\"\r\n                rules={[\r\n                  { required: true, message: 'Please enter contract value' },\r\n                  { type: 'number', min: 0, message: 'Value must be positive' }\r\n                ]}\r\n                tooltip=\"Total monetary value of the contract\"\r\n              >\r\n                <InputNumber\r\n                  placeholder=\"0.00\"\r\n                  formatter={(value) => `$${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\r\n                  parser={(value) => parseFloat(value?.replace(/\\$\\s?|(,*)/g, '') as string) || 0}\r\n                  min={0}\r\n                  precision={2}\r\n                  style={{ width: '100%' }}\r\n                  size=\"large\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Currency\"\r\n                name=\"currency\"\r\n                initialValue=\"USD\"\r\n              >\r\n                <Select size=\"large\">\r\n                  <Select.Option value=\"USD\">üá∫üá∏ USD - US Dollar</Select.Option>\r\n                  <Select.Option value=\"EUR\">üá™üá∫ EUR - Euro</Select.Option>\r\n                  <Select.Option value=\"GBP\">üá¨üáß GBP - British Pound</Select.Option>\r\n                  <Select.Option value=\"INR\">üáÆüá≥ INR - Indian Rupee</Select.Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item\r\n            label=\"Payment Terms\"\r\n            name=\"payment_terms\"\r\n            tooltip=\"e.g., Net 30, Net 60, Due on Receipt, etc.\"\r\n          >\r\n            <Input \r\n              placeholder=\"e.g., Net 30, Net 60, Due on Receipt\" \r\n              size=\"large\"\r\n              allowClear\r\n            />\r\n          </Form.Item>\r\n        </Card>\r\n\r\n        {/* Dates Section */}\r\n        <Card style={sectionStyles.card as any}>\r\n          <div style={sectionStyles.header as any}>\r\n            <CalendarOutlined style={sectionStyles.headerIcon as any} />\r\n            <h3 style={sectionStyles.headerTitle as any}>Dates</h3>\r\n          </div>\r\n\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Start Date\"\r\n                name=\"start_date\"\r\n                rules={[{ required: true, message: 'Please select start date' }]}\r\n                tooltip=\"When does the contract become effective?\"\r\n              >\r\n                <DatePicker \r\n                  style={{ width: '100%' }}\r\n                  size=\"large\"\r\n                  placeholder=\"Select start date\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"End Date\"\r\n                name=\"end_date\"\r\n                rules={[{ required: true, message: 'Please select end date' }]}\r\n                tooltip=\"When does the contract expire or end?\"\r\n              >\r\n                <DatePicker \r\n                  style={{ width: '100%' }}\r\n                  size=\"large\"\r\n                  placeholder=\"Select end date\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Renewal Section */}\r\n        <Card style={sectionStyles.card as any}>\r\n          <div style={sectionStyles.header as any}>\r\n            <SyncOutlined style={sectionStyles.headerIcon as any} />\r\n            <h3 style={sectionStyles.headerTitle as any}>Renewal Settings</h3>\r\n          </div>\r\n\r\n          <Form.Item\r\n            name=\"auto_renew\"\r\n            valuePropName=\"checked\"\r\n            initialValue={false}\r\n          >\r\n            <Checkbox style={{ fontSize: 14 }}>\r\n              Enable automatic renewal when contract expires\r\n            </Checkbox>\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Renewal Period\"\r\n            name=\"renewal_period_months\"\r\n            tooltip=\"How many months to renew for each cycle (if auto-renewal enabled)\"\r\n          >\r\n            <InputNumber \r\n              min={0}\r\n              placeholder=\"Enter renewal period in months\"\r\n              style={{ width: '100%' }}\r\n              size=\"large\"\r\n              suffix=\"months\"\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Renewal Terms\"\r\n            name=\"renewal_terms\"\r\n            tooltip=\"Any special conditions or terms for renewal\"\r\n          >\r\n            <Input.TextArea \r\n              rows={2} \r\n              placeholder=\"Enter renewal terms and conditions...\" \r\n              maxLength={300}\r\n              showCount\r\n            />\r\n          </Form.Item>\r\n        </Card>\r\n\r\n        {/* Compliance Section */}\r\n        <Card style={sectionStyles.card as any}>\r\n          <div style={sectionStyles.header as any}>\r\n            <CheckCircleOutlined style={sectionStyles.headerIcon as any} />\r\n            <h3 style={sectionStyles.headerTitle as any}>Compliance & Notes</h3>\r\n          </div>\r\n\r\n          <Form.Item\r\n            label=\"Compliance Status\"\r\n            name=\"compliance_status\"\r\n            initialValue=\"compliant\"\r\n            tooltip=\"Current compliance status of this contract\"\r\n          >\r\n            <Select size=\"large\">\r\n              <Select.Option value=\"compliant\">‚úÖ Compliant</Select.Option>\r\n              <Select.Option value=\"non_compliant\">‚ùå Non-Compliant</Select.Option>\r\n              <Select.Option value=\"pending_review\">‚è≥ Pending Review</Select.Option>\r\n            </Select>\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Additional Notes\"\r\n            name=\"notes\"\r\n            tooltip=\"Any additional information or special conditions\"\r\n          >\r\n            <Input.TextArea \r\n              rows={3} \r\n              placeholder=\"Add any important notes, special conditions, or additional information...\" \r\n              maxLength={1000}\r\n              showCount\r\n            />\r\n          </Form.Item>\r\n        </Card>\r\n\r\n        {/* Helper Alert */}\r\n        {!isEditMode && (\r\n          <Alert\r\n            message=\"Contract Created\"\r\n            description=\"Once created, you can further manage this contract including approvals, signatures, and renewals.\"\r\n            type=\"info\"\r\n            showIcon\r\n            style={{ marginTop: 16 }}\r\n          />\r\n        )}\r\n      </Form>\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\components\\ContractsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\hooks\\useContracts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\hooks\\useServiceContracts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":16,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":16,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Contracts Routes\r\n * Route definitions for the contracts module\r\n */\r\n\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components for code splitting\r\nconst ContractsPage = lazy(() => import('./views/ContractsPage'));\r\nconst ContractDetailPage = lazy(() => import('./views/ContractDetailPage').then(m => ({ default: m.ContractDetailPage })));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading contracts...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const contractsRoutes: RouteObject[] = [\r\n  {\r\n    path: 'contracts',\r\n    element: (\r\n      <RouteWrapper>\r\n        <ContractsPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n  {\r\n    path: 'contracts/:id',\r\n    element: (\r\n      <RouteWrapper>\r\n        <ContractDetailPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];\r\n\r\nexport default contractsRoutes;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\services\\contractService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3580,3583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3580,3583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3923,3926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3923,3926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Contract Service - Module Layer\r\n * Business logic for contract management and lifecycle\r\n * ‚ö†Ô∏è IMPORTANT: This is for the Contracts module (/src/modules/features/contracts/)\r\n * For Service Contracts, use serviceContractService from serviceFactory instead\r\n *\r\n * This service uses the Service Factory pattern to route between mock and Supabase implementations\r\n * based on VITE_API_MODE environment variable\r\n */\r\n\r\nimport { BaseService } from '@/modules/core/services/BaseService';\r\nimport { PaginatedResponse } from '@/modules/core/types';\r\nimport { Contract, ContractFilters, ApprovalRecord } from '@/types/contracts';\r\n\r\n// Define ContractFormData interface locally since it might not exist in types\r\nexport interface ContractFormData {\r\n  title: string;\r\n  description?: string;\r\n  type: 'service_agreement' | 'nda' | 'purchase_order' | 'employment' | 'custom';\r\n  status: 'draft' | 'pending_approval' | 'active' | 'renewed' | 'expired' | 'terminated';\r\n  customer_id: string;\r\n  customer_name?: string;\r\n  customer_contact?: string;\r\n  parties: Array<Record<string, unknown>>;\r\n  value: number;\r\n  total_value: number;\r\n  currency: string;\r\n  payment_terms?: string;\r\n  delivery_terms?: string;\r\n  start_date: string;\r\n  end_date: string;\r\n  auto_renew: boolean;\r\n  renewal_period_months?: number;\r\n  renewal_terms?: string;\r\n  terms?: string;\r\n  compliance_status: 'compliant' | 'non_compliant' | 'pending_review';\r\n  created_by: string;\r\n  assigned_to?: string;\r\n  assigned_to_name?: string;\r\n  tags: string[];\r\n  priority: 'low' | 'medium' | 'high' | 'urgent';\r\n  reminder_days: number[];\r\n  notes?: string;\r\n}\r\n\r\n// Import factory-routed service for multi-backend support\r\nimport { contractService as factoryContractService } from '@/services/serviceFactory';\r\n\r\nexport interface ContractStats {\r\n  total: number;\r\n  byStatus: Record<string, number>;\r\n  byType: Record<string, number>;\r\n  activeContracts: number;\r\n  pendingApproval: number;\r\n  expiringContracts: number;\r\n  totalValue: number;\r\n  averageValue: number;\r\n  renewalsDue: number;\r\n}\r\n\r\nexport class ContractService extends BaseService {\r\n  /**\r\n   * Get contracts with filtering and pagination\r\n   * Routes to mock or Supabase service based on VITE_API_MODE\r\n   */\r\n  async getContracts(filters: ContractFilters = {}): Promise<PaginatedResponse<Contract>> {\r\n    try {\r\n      try {\r\n        // Use factory service for multi-backend support\r\n        return await factoryContractService.getContracts(filters);\r\n      } catch (error) {\r\n        // Handle tenant context not initialized gracefully\r\n        if (error instanceof Error && error.message.includes('Tenant context not initialized')) {\r\n          // Return empty response instead of throwing\r\n          const { page = 1, pageSize = 20 } = filters;\r\n          return {\r\n            data: [],\r\n            total: 0,\r\n            page,\r\n            pageSize,\r\n            totalPages: 0,\r\n          };\r\n        }\r\n        throw error;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching contracts:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a single contract by ID\r\n   */\r\n  async getContract(id: string): Promise<Contract> {\r\n    try {\r\n      return await factoryContractService.getContract(id);\r\n    } catch (error) {\r\n      this.handleError(`Failed to fetch contract ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new contract\r\n   */\r\n  async createContract(data: ContractFormData): Promise<Contract> {\r\n    try {\r\n      return await factoryContractService.createContract(data as any);\r\n    } catch (error) {\r\n      this.handleError('Failed to create contract', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing contract\r\n   */\r\n  async updateContract(id: string, data: Partial<ContractFormData>): Promise<Contract> {\r\n    try {\r\n      return await factoryContractService.updateContract(id, data as any);\r\n    } catch (error) {\r\n      this.handleError(`Failed to update contract ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a contract\r\n   */\r\n  async deleteContract(id: string): Promise<void> {\r\n    try {\r\n      await factoryContractService.deleteContract(id);\r\n    } catch (error) {\r\n      this.handleError(`Failed to delete contract ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update contract status\r\n   */\r\n  async updateContractStatus(id: string, status: string): Promise<Contract> {\r\n    try {\r\n      const contractStatus = status as 'draft' | 'pending_approval' | 'active' | 'renewed' | 'expired' | 'terminated';\r\n      return await this.updateContract(id, { status: contractStatus });\r\n    } catch (error) {\r\n      this.handleError(`Failed to update contract status for ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Approve contract\r\n   */\r\n  async approveContract(id: string, approvalData: { stage: string; comments?: string }): Promise<Contract> {\r\n    try {\r\n      const contract = await this.getContract(id);\r\n      const approvalRecord: ApprovalRecord = {\r\n        id: Date.now().toString(),\r\n        stage: approvalData.stage,\r\n        approver: 'current_user',\r\n        approver_name: 'Current User',\r\n        status: 'approved',\r\n        comments: approvalData.comments,\r\n        approved_at: new Date().toISOString(),\r\n      };\r\n      \r\n      const updatedContract: Contract = {\r\n        ...contract,\r\n        approval_stage: 'approved',\r\n        approval_history: [...contract.approval_history, approvalRecord],\r\n        status: 'active',\r\n        updated_at: new Date().toISOString(),\r\n      };\r\n      \r\n      return updatedContract;\r\n    } catch (error) {\r\n      this.handleError(`Failed to approve contract ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get contract statistics\r\n   */\r\n  async getContractStats(): Promise<ContractStats> {\r\n    try {\r\n      // Use factory service for stats calculation\r\n      // The service handles all stat calculations and aggregations\r\n      return await factoryContractService.getContractStats();\r\n    } catch (error) {\r\n      this.handleError('Failed to fetch contract statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get contracts by customer ID\r\n   */\r\n  async getContractsByCustomer(\r\n    customerId: string,\r\n    filters: ContractFilters = {}\r\n  ): Promise<PaginatedResponse<Contract>> {\r\n    try {\r\n      // Use factory service with customer_id filter\r\n      return await factoryContractService.getContracts({ ...filters, customer_id: customerId });\r\n    } catch (error) {\r\n      console.error(`Failed to fetch contracts for customer ${customerId}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get expiring contracts\r\n   */\r\n  async getExpiringContracts(days: number = 30): Promise<Contract[]> {\r\n    try {\r\n      // Use factory service with expiring_soon filter\r\n      const response = await factoryContractService.getExpiringContracts({ expiring_soon: true }, days);\r\n      \r\n      // Safely handle response - could be array or object with data property\r\n      let contracts: Contract[] = [];\r\n      \r\n      if (Array.isArray(response)) {\r\n        contracts = response;\r\n      } else if (response?.data && Array.isArray(response.data)) {\r\n        contracts = response.data;\r\n      }\r\n      \r\n      return contracts;\r\n    } catch (error) {\r\n      this.handleError('Failed to fetch expiring contracts', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get contracts due for renewal\r\n   */\r\n  async getContractsDueForRenewal(days: number = 30): Promise<Contract[]> {\r\n    try {\r\n      // Use factory service to get contracts with auto_renew flag\r\n      const response = await factoryContractService.getContracts({ \r\n        auto_renew: true,\r\n        pageSize: 1000 \r\n      });\r\n      \r\n      // Safely handle response structure - ensure data is an array\r\n      const contracts = response?.data || response || [];\r\n      \r\n      // Guard against non-array responses\r\n      if (!Array.isArray(contracts)) {\r\n        console.warn('getContractsDueForRenewal: response.data is not an array', { response, contracts });\r\n        return [];\r\n      }\r\n      \r\n      const cutoffDate = new Date();\r\n      cutoffDate.setDate(cutoffDate.getDate() + days);\r\n      \r\n      return contracts.filter(contract => \r\n        contract.next_renewal_date && \r\n        new Date(contract.next_renewal_date) <= cutoffDate &&\r\n        contract.status === 'active'\r\n      );\r\n    } catch (error) {\r\n      this.handleError('Failed to fetch contracts due for renewal', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export contracts\r\n   */\r\n  async exportContracts(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    try {\r\n      const response = await this.getContracts({ pageSize: 10000 });\r\n      const contracts = response.data;\r\n\r\n      if (format === 'json') {\r\n        return JSON.stringify(contracts, null, 2);\r\n      }\r\n\r\n      // CSV format\r\n      const headers = ['ID', 'Contract Number', 'Title', 'Type', 'Status', 'Customer', 'Value', 'Start Date', 'End Date'];\r\n      const rows = contracts.map(contract => [\r\n        contract.id,\r\n        contract.contract_number || '',\r\n        contract.title,\r\n        contract.type || '',\r\n        contract.status || '',\r\n        contract.customer_name || '',\r\n        contract.value || 0,\r\n        contract.start_date || '',\r\n        contract.end_date || ''\r\n      ]);\r\n\r\n      const csv = [headers, ...rows]\r\n        .map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n        .join('\\r\\n');\r\n\r\n      return csv;\r\n    } catch (error) {\r\n      this.handleError('Failed to export contracts', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\services\\serviceContractService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\store\\contractStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\views\\ContractDetailPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadContract'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadContract]","fix":{"range":[3183,3187],"text":"[id, loadContract]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Contract Detail Page - Modular Version\r\n * Enhanced contract detail view with comprehensive management features\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { Contract, ApprovalRecord } from '@/types/contracts';\r\nimport { contractService } from '@/services';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Label } from '@/components/ui/label';\r\nimport { notificationService } from '@/services/uiNotificationService';\r\nimport {\r\n  ArrowLeft,\r\n  FileText,\r\n  Calendar,\r\n  DollarSign,\r\n  Users,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle,\r\n  Edit,\r\n  Download,\r\n  RefreshCw,\r\n  Send,\r\n  MessageSquare,\r\n  Shield,\r\n  Eye,\r\n  PenTool,\r\n  History\r\n} from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\n// Import new contract management components\r\nimport ContractTemplateManager from '@/components/contracts/ContractTemplateManager';\r\nimport DigitalSignatureWorkflow from '@/components/contracts/DigitalSignatureWorkflow';\r\nimport ContractDocumentGenerator from '@/components/contracts/ContractDocumentGenerator';\r\nimport ContractVersioning from '@/components/contracts/ContractVersioning';\r\nimport ContractComplianceTracker from '@/components/contracts/ContractComplianceTracker';\r\nimport ContractRenewalManager from '@/components/contracts/ContractRenewalManager';\r\nimport ContractAuditTrail from '@/components/contracts/ContractAuditTrail';\r\nimport ContractApprovalWorkflow from '@/components/contracts/ContractApprovalWorkflow';\r\nimport ContractAttachmentManager from '@/components/contracts/ContractAttachmentManager';\r\n\r\nexport const ContractDetailPage: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { user, hasPermission } = useAuth();\r\n  const [contract, setContract] = useState<Contract | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showApprovalDialog, setShowApprovalDialog] = useState(false);\r\n  const [showRejectDialog, setShowRejectDialog] = useState(false);\r\n  const [approvalComments, setApprovalComments] = useState('');\r\n  const [rejectComments, setRejectComments] = useState('');\r\n  const [activeTab, setActiveTab] = useState('overview');\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      loadContract();\r\n    }\r\n  }, [id]);\r\n\r\n  const loadContract = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await contractService.getContract(id!);\r\n      setContract(data);\r\n    } catch (error) {\r\n      toast({\r\n        title: 'Error',\r\n        description: 'Failed to load contract details',\r\n        variant: 'destructive'\r\n      });\r\n      navigate('/contracts');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleApprove = async () => {\r\n    if (!contract) return;\r\n    \r\n    try {\r\n      await contractService.approveContract(contract.id, 'manager_approval', approvalComments);\r\n      toast({\r\n        title: 'Success',\r\n        description: 'Contract approved successfully'\r\n      });\r\n      loadContract();\r\n      setShowApprovalDialog(false);\r\n      setApprovalComments('');\r\n    } catch (error) {\r\n      toast({\r\n        title: 'Error',\r\n        description: 'Failed to approve contract',\r\n        variant: 'destructive'\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleReject = async () => {\r\n    if (!contract) return;\r\n    \r\n    try {\r\n      await contractService.rejectContract(contract.id, 'manager_approval', rejectComments);\r\n      toast({\r\n        title: 'Success',\r\n        description: 'Contract rejected'\r\n      });\r\n      loadContract();\r\n      setShowRejectDialog(false);\r\n      setRejectComments('');\r\n    } catch (error) {\r\n      toast({\r\n        title: 'Error',\r\n        description: 'Failed to reject contract',\r\n        variant: 'destructive'\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleToggleAutoRenewal = async () => {\r\n    if (!contract) return;\r\n    \r\n    try {\r\n      await contractService.toggleAutoRenewal(contract.id, !contract.autoRenew);\r\n      toast({\r\n        title: 'Success',\r\n        description: `Auto-renewal ${!contract.autoRenew ? 'enabled' : 'disabled'}`\r\n      });\r\n      loadContract();\r\n    } catch (error) {\r\n      toast({\r\n        title: 'Error',\r\n        description: 'Failed to update auto-renewal setting',\r\n        variant: 'destructive'\r\n      });\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const statusConfig = {\r\n      draft: { color: 'bg-gray-100 text-gray-800', icon: FileText },\r\n      pending_approval: { color: 'bg-yellow-100 text-yellow-800', icon: Clock },\r\n      active: { color: 'bg-green-100 text-green-800', icon: CheckCircle },\r\n      renewed: { color: 'bg-blue-100 text-blue-800', icon: RefreshCw },\r\n      expired: { color: 'bg-red-100 text-red-800', icon: XCircle }\r\n    };\r\n\r\n    const config = statusConfig[status as keyof typeof statusConfig] || statusConfig.draft;\r\n    const Icon = config.icon;\r\n\r\n    return (\r\n      <Badge className={cn('flex items-center gap-1', config.color)}>\r\n        <Icon className=\"h-3 w-3\" />\r\n        {status.replace('_', ' ').toUpperCase()}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const getPriorityBadge = (priority: string) => {\r\n    const priorityConfig = {\r\n      low: 'bg-gray-100 text-gray-800',\r\n      medium: 'bg-blue-100 text-blue-800',\r\n      high: 'bg-orange-100 text-orange-800',\r\n      urgent: 'bg-red-100 text-red-800'\r\n    };\r\n\r\n    return (\r\n      <Badge className={cn('text-xs', priorityConfig[priority as keyof typeof priorityConfig])}>\r\n        {priority.toUpperCase()}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  const formatCurrency = (amount: number, currency: string) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: currency\r\n    }).format(amount);\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const formatDateTime = (dateString: string) => {\r\n    return new Date(dateString).toLocaleString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getDaysUntilExpiry = (endDate: string) => {\r\n    const end = new Date(endDate);\r\n    const now = new Date();\r\n    const diffTime = end.getTime() - now.getTime();\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n    return diffDays;\r\n  };\r\n\r\n  const getSignatureProgress = () => {\r\n    if (!contract) return 0;\r\n    return (contract.signatureStatus.completed / contract.signatureStatus.totalRequired) * 100;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-8\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!contract) {\r\n    return (\r\n      <div className=\"text-center py-8\">\r\n        <p className=\"text-muted-foreground\">Contract not found</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const daysUntilExpiry = getDaysUntilExpiry(contract.endDate);\r\n  const signatureProgress = getSignatureProgress();\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate('/contracts')}>\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            Back to Contracts\r\n          </Button>\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold tracking-tight\">{contract.title}</h1>\r\n            <div className=\"flex items-center gap-2 mt-1\">\r\n              {getStatusBadge(contract.status)}\r\n              {getPriorityBadge(contract.priority)}\r\n              <Badge variant=\"outline\">\r\n                {contract.type.replace('_', ' ').toUpperCase()}\r\n              </Badge>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          {contract.status === 'pending_approval' && hasPermission('write') && (\r\n            <>\r\n              <Button variant=\"outline\" onClick={() => setShowRejectDialog(true)}>\r\n                <XCircle className=\"h-4 w-4 mr-2\" />\r\n                Reject\r\n              </Button>\r\n              <Button onClick={() => setShowApprovalDialog(true)}>\r\n                <CheckCircle className=\"h-4 w-4 mr-2\" />\r\n                Approve\r\n              </Button>\r\n            </>\r\n          )}\r\n          <Button variant=\"outline\">\r\n            <Download className=\"h-4 w-4 mr-2\" />\r\n            Download PDF\r\n          </Button>\r\n          {hasPermission('write') && (\r\n            <Button variant=\"outline\">\r\n              <Edit className=\"h-4 w-4 mr-2\" />\r\n              Edit\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Alert for expiring contracts */}\r\n      {contract.status === 'active' && daysUntilExpiry <= 30 && daysUntilExpiry > 0 && (\r\n        <div className=\"bg-orange-50 border border-orange-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <AlertCircle className=\"h-5 w-5 text-orange-600\" />\r\n            <span className=\"font-medium text-orange-800\">\r\n              Contract expires in {daysUntilExpiry} days\r\n            </span>\r\n          </div>\r\n          <p className=\"text-sm text-orange-700 mt-1\">\r\n            Consider initiating renewal process or reviewing terms.\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Key Metrics */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Contract Value</CardTitle>\r\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">\r\n              {contract.value > 0 ? formatCurrency(contract.value, contract.currency) : 'N/A'}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Duration</CardTitle>\r\n            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">\r\n              {Math.ceil((new Date(contract.endDate).getTime() - new Date(contract.startDate).getTime()) / (1000 * 60 * 60 * 24))} days\r\n            </div>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              {formatDate(contract.startDate)} - {formatDate(contract.endDate)}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Signatures</CardTitle>\r\n            <PenTool className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">\r\n              {contract.signatureStatus.completed}/{contract.signatureStatus.totalRequired}\r\n            </div>\r\n            <Progress value={signatureProgress} className=\"h-2 mt-2\" />\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Auto-Renewal</CardTitle>\r\n            <RefreshCw className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"flex items-center justify-between\">\r\n              <Badge variant={contract.autoRenew ? 'default' : 'secondary'}>\r\n                {contract.autoRenew ? 'Enabled' : 'Disabled'}\r\n              </Badge>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={handleToggleAutoRenewal}\r\n                disabled={!hasPermission('write')}\r\n              >\r\n                Toggle\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n        <TabsList className=\"grid w-full grid-cols-4 lg:grid-cols-8\">\r\n          <TabsTrigger value=\"overview\" className=\"flex items-center gap-2\">\r\n            <Eye className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Overview</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"parties\" className=\"flex items-center gap-2\">\r\n            <Users className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Parties</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"content\" className=\"flex items-center gap-2\">\r\n            <FileText className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Content</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"approval\" className=\"flex items-center gap-2\">\r\n            <History className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Approval</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"signatures\" className=\"flex items-center gap-2\">\r\n            <PenTool className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Signatures</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"compliance\" className=\"flex items-center gap-2\">\r\n            <Shield className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Compliance</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"renewal\" className=\"flex items-center gap-2\">\r\n            <RefreshCw className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Renewal</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"management\" className=\"flex items-center gap-2\">\r\n            <FileText className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Management</span>\r\n          </TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"overview\" className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Contract Details</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Type</Label>\r\n                    <p className=\"text-sm\">{contract.type.replace('_', ' ').toUpperCase()}</p>\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Priority</Label>\r\n                    <p className=\"text-sm\">{contract.priority.toUpperCase()}</p>\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Created</Label>\r\n                    <p className=\"text-sm\">{formatDate(contract.created_at)}</p>\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Last Updated</Label>\r\n                    <p className=\"text-sm\">{formatDate(contract.updated_at)}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                <Separator />\r\n                \r\n                <div>\r\n                  <Label className=\"text-sm font-medium text-muted-foreground\">Tags</Label>\r\n                  <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                    {contract.tags.map((tag) => (\r\n                      <Badge key={tag} variant=\"secondary\" className=\"text-xs\">\r\n                        {tag}\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n                \r\n                {contract.renewalTerms && (\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Renewal Terms</Label>\r\n                    <p className=\"text-sm mt-1\">{contract.renewalTerms}</p>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Compliance & Status</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Compliance Status</Label>\r\n                    <Badge \r\n                      variant={contract.complianceStatus === 'compliant' ? 'default' : 'secondary'}\r\n                      className=\"mt-1\"\r\n                    >\r\n                      {contract.complianceStatus.replace('_', ' ').toUpperCase()}\r\n                    </Badge>\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Approval Stage</Label>\r\n                    <p className=\"text-sm\">{contract.approvalStage.replace('_', ' ').toUpperCase()}</p>\r\n                  </div>\r\n                </div>\r\n                \r\n                {contract.signedDate && (\r\n                  <div>\r\n                    <Label className=\"text-sm font-medium text-muted-foreground\">Signed Date</Label>\r\n                    <p className=\"text-sm\">{formatDate(contract.signedDate)}</p>\r\n                  </div>\r\n                )}\r\n                \r\n                <div>\r\n                  <Label className=\"text-sm font-medium text-muted-foreground\">Reminder Schedule</Label>\r\n                  <div className=\"flex flex-wrap gap-1 mt-1\">\r\n                    {contract.reminderDays.map((days) => (\r\n                      <Badge key={days} variant=\"outline\" className=\"text-xs\">\r\n                        {days} days\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"parties\" className=\"space-y-4\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Contract Parties</CardTitle>\r\n              <CardDescription>\r\n                All parties involved in this contract\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {contract.parties.map((party) => (\r\n                  <div key={party.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Avatar>\r\n                        <AvatarFallback>\r\n                          {party.name.split(' ').map(n => n[0]).join('')}\r\n                        </AvatarFallback>\r\n                      </Avatar>\r\n                      <div>\r\n                        <div className=\"font-medium\">{party.name}</div>\r\n                        <div className=\"text-sm text-muted-foreground\">{party.email}</div>\r\n                        <div className=\"flex items-center gap-2 mt-1\">\r\n                          <Badge variant=\"outline\">{party.role}</Badge>\r\n                          {party.signatureRequired && (\r\n                            <Badge variant={party.signedAt ? 'default' : 'secondary'}>\r\n                              {party.signedAt ? 'Signed' : 'Signature Required'}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      {party.signedAt ? (\r\n                        <div>\r\n                          <CheckCircle className=\"h-5 w-5 text-green-600 mx-auto\" />\r\n                          <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            {formatDateTime(party.signedAt)}\r\n                          </p>\r\n                        </div>\r\n                      ) : party.signatureRequired ? (\r\n                        <div>\r\n                          <Clock className=\"h-5 w-5 text-yellow-600 mx-auto\" />\r\n                          <p className=\"text-xs text-muted-foreground mt-1\">Pending</p>\r\n                        </div>\r\n                      ) : (\r\n                        <div>\r\n                          <span className=\"text-xs text-muted-foreground\">No signature required</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"content\" className=\"space-y-4\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Contract Content</CardTitle>\r\n              <CardDescription>\r\n                Full contract text and terms\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n                <pre className=\"whitespace-pre-wrap text-sm font-mono\">\r\n                  {contract.content}\r\n                </pre>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"approval\" className=\"space-y-6\">\r\n          <ContractApprovalWorkflow\r\n            contract={contract}\r\n            onApprovalUpdate={loadContract}\r\n          />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"signatures\" className=\"space-y-6\">\r\n          <DigitalSignatureWorkflow\r\n            contract={contract}\r\n            onSignatureUpdate={loadContract}\r\n          />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"compliance\" className=\"space-y-6\">\r\n          <ContractComplianceTracker\r\n            contract={contract}\r\n            onComplianceUpdate={loadContract}\r\n          />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"renewal\" className=\"space-y-6\">\r\n          <ContractRenewalManager\r\n            contract={contract}\r\n            onRenewalUpdate={loadContract}\r\n          />\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"management\" className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <div className=\"space-y-6\">\r\n              <ContractTemplateManager />\r\n              <ContractVersioning\r\n                contract={contract}\r\n                onVersionChange={loadContract}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-6\">\r\n              <ContractDocumentGenerator\r\n                contract={contract}\r\n                onDocumentGenerated={loadContract}\r\n              />\r\n              <ContractAttachmentManager\r\n                contract={contract}\r\n                onAttachmentUpdate={loadContract}\r\n              />\r\n            </div>\r\n          </div>\r\n          <ContractAuditTrail contract={contract} />\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Approval Dialog */}\r\n      <Dialog open={showApprovalDialog} onOpenChange={setShowApprovalDialog}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Approve Contract</DialogTitle>\r\n            <DialogDescription>\r\n              Add comments for this approval (optional)\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label htmlFor=\"approvalComments\">Comments</Label>\r\n              <Textarea\r\n                id=\"approvalComments\"\r\n                value={approvalComments}\r\n                onChange={(e) => setApprovalComments(e.target.value)}\r\n                placeholder=\"Add any comments about this approval...\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowApprovalDialog(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleApprove}>\r\n              <CheckCircle className=\"h-4 w-4 mr-2\" />\r\n              Approve Contract\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Reject Dialog */}\r\n      <Dialog open={showRejectDialog} onOpenChange={setShowRejectDialog}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Reject Contract</DialogTitle>\r\n            <DialogDescription>\r\n              Please provide a reason for rejecting this contract\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label htmlFor=\"rejectComments\">Reason for Rejection *</Label>\r\n              <Textarea\r\n                id=\"rejectComments\"\r\n                value={rejectComments}\r\n                onChange={(e) => setRejectComments(e.target.value)}\r\n                placeholder=\"Explain why this contract is being rejected...\"\r\n                rows={3}\r\n                required\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setShowRejectDialog(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button \r\n              variant=\"destructive\" \r\n              onClick={handleReject}\r\n              disabled={!rejectComments.trim()}\r\n            >\r\n              <XCircle className=\"h-4 w-4 mr-2\" />\r\n              Reject Contract\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ContractDetailPage;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\contracts\\views\\ContractsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\components\\CustomerDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\components\\CustomerFormPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\components\\CustomerList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\hooks\\useCompanySizes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\hooks\\useCustomers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9604,9607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9604,9607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9693,9696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9693,9696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":308,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9900,9903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9900,9903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9993,9996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9993,9996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10181,10184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10181,10184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":316,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":316,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10314,10317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10314,10317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":319,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10404,10407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10404,10407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11111,11114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11111,11114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11170,11173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11170,11173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":337,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11232,11235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11232,11235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":338,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11296,11299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11296,11299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11353,11356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11353,11356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":340,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11399,11402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11399,11402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":341,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11443,11446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11443,11446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11931,11934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11931,11934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customer Hooks\r\n * React hooks for customer operations\r\n */\r\n\r\nimport { useCallback } from 'react';\r\nimport { useQuery, useMutation, useInvalidateQueries } from '@/modules/core/hooks/useQuery';\r\nimport { useCustomerStore } from '../store/customerStore';\r\nimport { CustomerService, CustomerFilters, CreateCustomerData } from '../services/customerService';\r\nimport { inject } from '@/modules/core/services/ServiceContainer';\r\nimport { useTenantContext } from '@/hooks/useTenantContext';\r\n\r\n// Get customer service instance with error handling\r\nconst getCustomerService = () => {\r\n  try {\r\n    const service = inject<CustomerService>('customerService');\r\n    if (!service) {\r\n      throw new Error('CustomerService instance is null or undefined');\r\n    }\r\n    return service;\r\n  } catch (error) {\r\n    console.warn('[useCustomers] Failed to get customer service:', error instanceof Error ? error.message : String(error));\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Hook for fetching customers with pagination and filtering\r\n */\r\nexport function useCustomers(filters: CustomerFilters = {}) {\r\n  const setCustomers = useCustomerStore((state) => state.setCustomers);\r\n  const setPagination = useCustomerStore((state) => state.setPagination);\r\n  const setError = useCustomerStore((state) => state.setError);\r\n  const customers = useCustomerStore((state) => state.customers);\r\n  const pagination = useCustomerStore((state) => state.pagination);\r\n  const isLoading = useCustomerStore((state) => state.isLoading);\r\n  const error = useCustomerStore((state) => state.error);\r\n  \r\n  // Get tenant context to check if tenant is initialized\r\n  // Uses the same reliable pattern as Dashboard hooks\r\n  const { isInitialized: isTenantInitialized, tenantId } = useTenantContext();\r\n\r\n  // Create a stable query key by serializing filter values\r\n  const queryKey = [\r\n    'customers',\r\n    filters.search,\r\n    filters.status,\r\n    filters.industry,\r\n    filters.size,\r\n    filters.assignedTo,\r\n    filters.tags?.join(','),\r\n    filters.dateRange?.start,\r\n    filters.dateRange?.end,\r\n    filters.page,\r\n    filters.pageSize,\r\n  ];\r\n\r\n  console.log('[useCustomers] Query state:', { \r\n    isTenantInitialized, \r\n    tenantId,\r\n    enabled: isTenantInitialized,\r\n    customersCount: customers?.length ?? 0\r\n  });\r\n\r\n  const query = useQuery(\r\n    queryKey,\r\n    async () => {\r\n      console.log('[useCustomers] Query function executing with filters:', filters);\r\n      try {\r\n        const result = await getCustomerService().getCustomers(filters);\r\n        console.log('[useCustomers] Query function resolved with result:', result);\r\n        return result;\r\n      } catch (err) {\r\n        console.error('[useCustomers] Query function caught error:', err);\r\n        throw err;\r\n      }\r\n    },\r\n    {\r\n      // Only run query when tenant is initialized\r\n      enabled: isTenantInitialized,\r\n      onSuccess: (data) => {\r\n        console.log('[useCustomers] onSuccess callback triggered with data:', data);\r\n        console.log('[useCustomers] Data type:', typeof data);\r\n        console.log('[useCustomers] Is array?', Array.isArray(data));\r\n        console.log('[useCustomers] data.data:', data?.data);\r\n        console.log('[useCustomers] data.total:', data?.total);\r\n        console.log('[useCustomers] data.page:', data?.page);\r\n        \r\n        // Extract the customer array - handle both formats\r\n        const customerArray = Array.isArray(data) ? data : (data?.data || []);\r\n        const pageNum = data?.page || 1;\r\n        const pageSize = data?.pageSize || 20;\r\n        const total = data?.total || (Array.isArray(data) ? data.length : 0);\r\n        \r\n        console.log('[useCustomers] Setting customers with:', { customerArray: customerArray.length, pageNum, pageSize, total });\r\n        \r\n        setCustomers(customerArray);\r\n        setPagination({\r\n          page: pageNum,\r\n          pageSize: pageSize,\r\n          total: total,\r\n        });\r\n        setError(null);\r\n      },\r\n      onError: (error) => {\r\n        console.log('[useCustomers] onError callback triggered with error:', error);\r\n        // Only set error if it's not a tenant initialization issue\r\n        const errorMsg = error instanceof Error ? error.message : 'Failed to fetch customers';\r\n        if (!errorMsg.includes('Tenant context not initialized')) {\r\n          setError(errorMsg);\r\n        }\r\n      },\r\n      staleTime: 5 * 60 * 1000, // 5 minutes\r\n    }\r\n  );\r\n\r\n  return {\r\n    customers,\r\n    pagination,\r\n    isLoading: query.isLoading || isLoading,\r\n    error: query.error || error,\r\n    refetch: query.refetch,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for fetching a single customer\r\n */\r\nexport function useCustomer(id: string) {\r\n  const setSelectedCustomer = useCustomerStore((state) => state.setSelectedCustomer);\r\n  const { isInitialized: isTenantInitialized } = useTenantContext();\r\n\r\n  return useQuery(\r\n    ['customer', id],\r\n    () => getCustomerService().getCustomer(id),\r\n    {\r\n      enabled: !!id && isTenantInitialized,\r\n      onSuccess: (customer) => {\r\n        setSelectedCustomer(customer);\r\n      },\r\n      staleTime: 5 * 60 * 1000,\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for creating a customer\r\n */\r\nexport function useCreateCustomer() {\r\n  const addCustomer = useCustomerStore((state) => state.addCustomer);\r\n  const { invalidate } = useInvalidateQueries();\r\n\r\n  return useMutation(\r\n    (data: CreateCustomerData) => getCustomerService().createCustomer(data),\r\n    {\r\n      onSuccess: (customer) => {\r\n        addCustomer(customer);\r\n        invalidate(['customers']);\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Customer created successfully',\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for updating a customer\r\n */\r\nexport function useUpdateCustomer() {\r\n  const updateCustomer = useCustomerStore((state) => state.updateCustomer);\r\n  const { invalidate } = useInvalidateQueries();\r\n\r\n  return useMutation(\r\n    ({ id, data }: { id: string; data: Partial<CreateCustomerData> }) =>\r\n      getCustomerService().updateCustomer(id, data),\r\n    {\r\n      onSuccess: (customer) => {\r\n        updateCustomer(customer.id, customer);\r\n        invalidate(['customers']);\r\n        invalidate(['customer', customer.id]);\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Customer updated successfully',\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for deleting a customer\r\n */\r\nexport function useDeleteCustomer() {\r\n  const removeCustomer = useCustomerStore((state) => state.removeCustomer);\r\n  const { invalidate } = useInvalidateQueries();\r\n\r\n  return useMutation(\r\n    (id: string) => getCustomerService().deleteCustomer(id),\r\n    {\r\n      onSuccess: (_, id) => {\r\n        removeCustomer(id);\r\n        invalidate(['customers']);\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Customer deleted successfully',\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for bulk operations\r\n */\r\nexport function useBulkCustomerOperations() {\r\n  const bulkDeleteCustomers = useCustomerStore((state) => state.bulkDeleteCustomers);\r\n  const bulkUpdateCustomers = useCustomerStore((state) => state.bulkUpdateCustomers);\r\n  const clearSelection = useCustomerStore((state) => state.clearSelection);\r\n  const { invalidate } = useInvalidateQueries();\r\n\r\n  const bulkDelete = useMutation(\r\n    (ids: string[]) => getCustomerService().bulkDeleteCustomers(ids),\r\n    {\r\n      onSuccess: (_, ids) => {\r\n        bulkDeleteCustomers(ids);\r\n        clearSelection();\r\n        invalidate(['customers']);\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Customers deleted successfully',\r\n    }\r\n  );\r\n\r\n  const bulkUpdate = useMutation(\r\n    ({ ids, updates }: { ids: string[]; updates: Partial<CreateCustomerData> }) =>\r\n      getCustomerService().bulkUpdateCustomers(ids, updates),\r\n    {\r\n      onSuccess: (customers, { ids, updates }) => {\r\n        bulkUpdateCustomers(ids, updates);\r\n        clearSelection();\r\n        invalidate(['customers']);\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Customers updated successfully',\r\n    }\r\n  );\r\n\r\n  return {\r\n    bulkDelete,\r\n    bulkUpdate,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for customer tags\r\n */\r\nexport function useCustomerTags() {\r\n  const setTags = useCustomerStore((state) => state.setTags);\r\n  const addTag = useCustomerStore((state) => state.addTag);\r\n  const tags = useCustomerStore((state) => state.tags);\r\n\r\n  const tagsQuery = useQuery(\r\n    ['customer-tags'],\r\n    () => getCustomerService().getTags(),\r\n    {\r\n      onSuccess: setTags,\r\n      staleTime: 10 * 60 * 1000, // 10 minutes\r\n    }\r\n  );\r\n\r\n  const createTag = useMutation(\r\n    ({ name, color }: { name: string; color: string }) =>\r\n      getCustomerService().createTag(name, color),\r\n    {\r\n      onSuccess: (tag) => {\r\n        addTag(tag);\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Tag created successfully',\r\n    }\r\n  );\r\n\r\n  return {\r\n    tags,\r\n    isLoading: tagsQuery.isLoading,\r\n    createTag,\r\n    refetch: tagsQuery.refetch,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for customer statistics\r\n */\r\nexport function useCustomerStats() {\r\n  const { isInitialized: isTenantInitialized } = useTenantContext();\r\n\r\n  return useQuery(\r\n    ['customer-stats'],\r\n    async () => {\r\n      try {\r\n        const service = getCustomerService();\r\n        const protoMethods = Object.getOwnPropertyNames(Object.getPrototypeOf(service) || {});\r\n        const ownMethods = Object.getOwnPropertyNames(service || {});\r\n        \r\n        console.log('[useCustomerStats] Retrieved service:', {\r\n          type: typeof service,\r\n          constructor: (service as any)?.constructor?.name || 'unknown',\r\n          hasGetCustomerStats: typeof (service as any)?.getCustomerStats,\r\n          protoMethodsCount: protoMethods.length,\r\n          protoMethods: protoMethods,\r\n          ownMethods: ownMethods,\r\n          isGetCustomerStatsCallable: typeof (service as any)?.getCustomerStats === 'function'\r\n        });\r\n        \r\n        if (typeof (service as any)?.getCustomerStats !== 'function') {\r\n          console.error('[useCustomerStats] ‚úó getCustomerStats is not a function!', {\r\n            service,\r\n            type: typeof (service as any)?.getCustomerStats\r\n          });\r\n          throw new Error(`getCustomerStats is not a function. Got type: ${typeof (service as any)?.getCustomerStats}`);\r\n        }\r\n        \r\n        const result = await (service as any).getCustomerStats();\r\n        console.log('[useCustomerStats] ‚úì Retrieved stats:', result);\r\n        return result;\r\n      } catch (error) {\r\n        console.error('[useCustomerStats] ‚úó Error retrieving stats:', error);\r\n        throw error;\r\n      }\r\n    },\r\n    {\r\n      enabled: isTenantInitialized,\r\n      onSuccess: (data) => {\r\n        // Log data format information\r\n        console.log('[useCustomerStats] onSuccess callback triggered with data:', data);\r\n        console.log('[useCustomerStats] Data type:', typeof data);\r\n        console.log('[useCustomerStats] Is array?', Array.isArray(data));\r\n        console.log('[useCustomerStats] Data structure:', {\r\n          totalCustomers: (data as any)?.totalCustomers,\r\n          activeCustomers: (data as any)?.activeCustomers,\r\n          inactiveCustomers: (data as any)?.inactiveCustomers,\r\n          prospectCustomers: (data as any)?.prospectCustomers,\r\n          byIndustry: (data as any)?.byIndustry,\r\n          bySize: (data as any)?.bySize,\r\n          byStatus: (data as any)?.byStatus,\r\n        });\r\n        \r\n        // Ensure we have the expected structure\r\n        if (!data || typeof data !== 'object') {\r\n          console.warn('[useCustomerStats] ‚ö†Ô∏è Stats data is not an object:', data);\r\n        }\r\n        \r\n        // Verify all required fields exist (from Supabase service)\r\n        const requiredFields = ['totalCustomers', 'activeCustomers', 'prospectCustomers'];\r\n        const missingFields = requiredFields.filter(field => !(field in (data as any)));\r\n        if (missingFields.length > 0) {\r\n          console.warn('[useCustomerStats] ‚ö†Ô∏è Missing fields in stats:', missingFields);\r\n        } else {\r\n          console.log('[useCustomerStats] ‚úÖ All required fields present - stats are valid!');\r\n        }\r\n      },\r\n      onError: (error) => {\r\n        console.error('[useCustomerStats] onError callback triggered with error:', error);\r\n      },\r\n      staleTime: 5 * 60 * 1000, // 5 minutes\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for customer export\r\n */\r\nexport function useCustomerExport() {\r\n  return useMutation(\r\n    (format: 'csv' | 'json' = 'csv') => getCustomerService().exportCustomers(format),\r\n    {\r\n      onSuccess: (data, format) => {\r\n        // Download the file\r\n        const blob = new Blob([data], { \r\n          type: format === 'csv' ? 'text/csv' : 'application/json' \r\n        });\r\n        const url = URL.createObjectURL(blob);\r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.download = `customers.${format}`;\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        URL.revokeObjectURL(url);\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Customers exported successfully',\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for customer import\r\n */\r\nexport function useCustomerImport() {\r\n  const { invalidate } = useInvalidateQueries();\r\n\r\n  return useMutation(\r\n    (csv: string) => getCustomerService().importCustomers(csv),\r\n    {\r\n      onSuccess: (result) => {\r\n        invalidate(['customers']);\r\n        if (result.errors.length > 0) {\r\n          console.warn('Import completed with errors:', result.errors);\r\n        }\r\n      },\r\n      showSuccessNotification: true,\r\n      successMessage: 'Customers imported successfully',\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for customer search\r\n */\r\nexport function useCustomerSearch() {\r\n  return useCallback(\r\n    (query: string) => getCustomerService().searchCustomers(query),\r\n    []\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\hooks\\useIndustries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\hooks\\useUsers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":17,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":17,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Customer Routes\n * Route configuration for customer module\n */\n\nimport React from 'react';\nimport { RouteObject } from 'react-router-dom';\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\n\n// Lazy load components\nconst CustomerListPage = React.lazy(() => import('./views/CustomerListPage'));\nconst CustomerDetailPage = React.lazy(() => import('./views/CustomerDetailPage'));\nconst CustomerCreatePage = React.lazy(() => import('./views/CustomerCreatePage'));\nconst CustomerEditPage = React.lazy(() => import('./views/CustomerEditPage'));\n\n// Route wrapper with error boundary\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n  <ErrorBoundary>\n    <React.Suspense fallback={<div>Loading...</div>}>\n      {children}\n    </React.Suspense>\n  </ErrorBoundary>\n);\n\nexport const customerRoutes: RouteObject[] = [\n  {\n    path: 'customers',\n    children: [\n      {\n        index: true,\n        element: (\n          <RouteWrapper>\n            <CustomerListPage />\n          </RouteWrapper>\n        ),\n      },\n      {\n        path: 'new',\n        element: (\n          <RouteWrapper>\n            <CustomerCreatePage />\n          </RouteWrapper>\n        ),\n      },\n      {\n        path: ':id',\n        element: (\n          <RouteWrapper>\n            <CustomerDetailPage />\n          </RouteWrapper>\n        ),\n      },\n      {\n        path: ':id/edit',\n        element: (\n          <RouteWrapper>\n            <CustomerEditPage />\n          </RouteWrapper>\n        ),\n      },\n    ],\n  },\n];\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\services\\customerService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9914,9917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9914,9917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":321,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9976,9979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9976,9979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":322,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10041,10044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10041,10044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10109,10112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10109,10112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10178,10181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10178,10181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":325,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10237,10240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10237,10240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10954,10957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10954,10957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11264,11267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11264,11267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":352,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":352,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11555,11558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11555,11558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":353,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11642,11645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11642,11645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":354,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11732,11735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11732,11735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":362,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12043,12046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12043,12046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":368,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12287,12290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12287,12290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12630,12633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12630,12633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customer Service\r\n * Business logic for customer operations\r\n * ‚ö†Ô∏è CRITICAL: Uses Service Factory Pattern for multi-backend routing\r\n * \r\n * This module delegates all customer operations through the centralized Service Factory\r\n * which routes requests to mock (development) or Supabase (production) based on VITE_API_MODE.\r\n * \r\n * See: /src/services/serviceFactory.ts for factory routing logic\r\n * \r\n * Module Distinction:\r\n * - This module manages CUSTOMER entity and business logic\r\n * - NOT to be confused with Product/Product Sales or other modules\r\n */\r\n\r\nimport { BaseService } from '@/modules/core/services/BaseService';\r\nimport { Customer, CustomerTag } from '@/types/crm';\r\nimport { FilterOptions, PaginatedResponse } from '@/modules/core/types';\r\nimport { customerService as factoryCustomerService } from '@/services/serviceFactory';\r\n\r\nexport interface CreateCustomerData {\r\n  company_name: string;\r\n  contact_name: string;\r\n  email: string;\r\n  phone?: string;\r\n  mobile?: string;\r\n  website?: string;\r\n  address?: string;\r\n  city?: string;\r\n  country?: string;\r\n  industry?: string;\r\n  size?: 'startup' | 'small' | 'medium' | 'enterprise';\r\n  status?: 'active' | 'inactive' | 'prospect';\r\n  customer_type?: 'business' | 'individual';\r\n  credit_limit?: number;\r\n  payment_terms?: string;\r\n  tax_id?: string;\r\n  notes?: string;\r\n  assigned_to?: string;\r\n  source?: string;\r\n  rating?: string;\r\n  tags?: CustomerTag[];\r\n}\r\n\r\nexport interface UpdateCustomerData extends Partial<CreateCustomerData> {\r\n  id: string;\r\n}\r\n\r\nexport interface CustomerFilters extends FilterOptions {\r\n  status?: string;\r\n  industry?: string;\r\n  size?: string;\r\n  assignedTo?: string;\r\n  tags?: string[];\r\n  dateRange?: {\r\n    start: string;\r\n    end: string;\r\n  };\r\n}\r\n\r\nexport class CustomerService extends BaseService {\r\n  /**\r\n   * Get paginated customers with filters\r\n   */\r\n  async getCustomers(filters: CustomerFilters = {}): Promise<PaginatedResponse<Customer>> {\r\n    try {\r\n      console.log('[CustomerService] getCustomers called with filters:', filters);\r\n      \r\n      // Delegate to factory service (routes to mock or Supabase based on VITE_API_MODE)\r\n      const result = await factoryCustomerService.getCustomers(filters);\r\n      \r\n      console.log('[CustomerService] Received result from factory:', result);\r\n      \r\n      // Handle both array and paginated response formats\r\n      let allCustomers: Customer[] = [];\r\n      if (Array.isArray(result)) {\r\n        console.log('[CustomerService] Result is array, length:', result.length);\r\n        allCustomers = result;\r\n      } else if (result && typeof result === 'object' && 'data' in result && Array.isArray(result.data)) {\r\n        console.log('[CustomerService] Result is paginated response, data length:', result.data.length);\r\n        allCustomers = result.data;\r\n      } else {\r\n        console.error('[CustomerService] Unexpected result format:', result);\r\n        allCustomers = [];\r\n      }\r\n      \r\n      // Transform to paginated response\r\n      const { page = 1, pageSize = 20 } = filters;\r\n      const startIndex = (page - 1) * pageSize;\r\n      const endIndex = startIndex + pageSize;\r\n      const paginatedData = allCustomers.slice(startIndex, endIndex);\r\n      \r\n      console.log('[CustomerService] Returning paginated response - total:', allCustomers.length, 'page:', page, 'data:', paginatedData.length);\r\n      \r\n      return {\r\n        data: paginatedData,\r\n        total: allCustomers.length,\r\n        page,\r\n        pageSize,\r\n        totalPages: Math.ceil(allCustomers.length / pageSize),\r\n      };\r\n    } catch (error) {\r\n      // Handle authorization/tenant context errors gracefully by returning empty response\r\n      const errorMsg = error instanceof Error ? error.message : String(error);\r\n      console.error('[CustomerService] Error fetching customers:', errorMsg);\r\n      \r\n      if (errorMsg.includes('Tenant context not initialized') || errorMsg.includes('Unauthorized')) {\r\n        // Return empty response instead of throwing when auth context is not ready\r\n        const { page = 1, pageSize = 20 } = filters;\r\n        console.log('[CustomerService] ‚úÖ Auth context not ready - returning empty response gracefully');\r\n        return {\r\n          data: [],\r\n          total: 0,\r\n          page,\r\n          pageSize,\r\n          totalPages: 0,\r\n        };\r\n      }\r\n      \r\n      // For other errors, log and re-throw\r\n      console.error('[CustomerService] ‚ùå Unexpected error, rethrowing:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a single customer by ID\r\n   */\r\n  async getCustomer(id: string): Promise<Customer | null> {\r\n    try {\r\n      return await factoryCustomerService.getCustomer(id);\r\n    } catch (error) {\r\n      // Handle authorization/tenant context errors gracefully by returning null\r\n      const errorMsg = error instanceof Error ? error.message : String(error);\r\n      console.error('[CustomerService] Error fetching customer:', errorMsg);\r\n      \r\n      if (errorMsg.includes('Tenant context not initialized') || errorMsg.includes('Unauthorized')) {\r\n        console.log('[CustomerService] ‚úÖ Auth context not ready - returning null for customer');\r\n        return null;\r\n      }\r\n      \r\n      // For other errors, log and re-throw\r\n      console.error('[CustomerService] ‚ùå Unexpected error, rethrowing:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new customer\r\n   */\r\n  async createCustomer(data: CreateCustomerData): Promise<Customer> {\r\n    try {\r\n      return await factoryCustomerService.createCustomer(data);\r\n    } catch (error) {\r\n      console.error('Error creating customer:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing customer\r\n   */\r\n  async updateCustomer(id: string, data: Partial<CreateCustomerData>): Promise<Customer> {\r\n    try {\r\n      return await factoryCustomerService.updateCustomer(id, data);\r\n    } catch (error) {\r\n      console.error('Error updating customer:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a customer\r\n   */\r\n  async deleteCustomer(id: string): Promise<void> {\r\n    try {\r\n      await factoryCustomerService.deleteCustomer(id);\r\n    } catch (error) {\r\n      console.error('Error deleting customer:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bulk delete customers\r\n   */\r\n  async bulkDeleteCustomers(ids: string[]): Promise<void> {\r\n    try {\r\n      await Promise.all(ids.map(id => this.deleteCustomer(id)));\r\n    } catch (error) {\r\n      console.error('Error bulk deleting customers:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bulk update customers\r\n   */\r\n  async bulkUpdateCustomers(ids: string[], updates: Partial<CreateCustomerData>): Promise<Customer[]> {\r\n    try {\r\n      const results = await Promise.all(\r\n        ids.map(id => this.updateCustomer(id, updates))\r\n      );\r\n      return results;\r\n    } catch (error) {\r\n      console.error('Error bulk updating customers:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get customer tags\r\n   */\r\n  async getTags(): Promise<CustomerTag[]> {\r\n    try {\r\n      return await factoryCustomerService.getTags();\r\n    } catch (error) {\r\n      console.error('Error fetching customer tags:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new tag\r\n   */\r\n  async createTag(name: string, color: string): Promise<CustomerTag> {\r\n    try {\r\n      return await factoryCustomerService.createTag(name, color);\r\n    } catch (error) {\r\n      console.error('Error creating customer tag:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get available industries\r\n   */\r\n  async getIndustries(): Promise<string[]> {\r\n    try {\r\n      return await factoryCustomerService.getIndustries();\r\n    } catch (error) {\r\n      console.error('Error fetching industries:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get available company sizes\r\n   */\r\n  async getSizes(): Promise<string[]> {\r\n    try {\r\n      return await factoryCustomerService.getSizes();\r\n    } catch (error) {\r\n      console.error('Error fetching company sizes:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export customers\r\n   */\r\n  async exportCustomers(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    try {\r\n      return await factoryCustomerService.exportCustomers(format);\r\n    } catch (error) {\r\n      console.error('Error exporting customers:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Import customers from CSV\r\n   */\r\n  async importCustomers(csv: string): Promise<{ success: number; errors: string[] }> {\r\n    try {\r\n      return await factoryCustomerService.importCustomers(csv);\r\n    } catch (error) {\r\n      console.error('Error importing customers:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search customers\r\n   */\r\n  async searchCustomers(query: string): Promise<Customer[]> {\r\n    try {\r\n      const filters = { search: query };\r\n      const result = await this.getCustomers(filters);\r\n      return result.data;\r\n    } catch (error) {\r\n      console.error('Error searching customers:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get customer statistics\r\n   */\r\n  async getCustomerStats(): Promise<{\r\n    total: number;\r\n    active: number;\r\n    inactive: number;\r\n    prospects: number;\r\n    byIndustry: Record<string, number>;\r\n    bySize: Record<string, number>;\r\n    recentlyAdded: number;\r\n  }> {\r\n    try {\r\n      console.log('[CustomerService] getCustomerStats() called');\r\n      \r\n      // Try to use the factory's getCustomerStats if available\r\n      const factoryService = factoryCustomerService;\r\n      if (factoryService.getCustomerStats) {\r\n        console.log('[CustomerService] Using factory service getCustomerStats()');\r\n        const factoryStats = await factoryService.getCustomerStats();\r\n        \r\n        // Map factory stats to wrapper format\r\n        return {\r\n          total: (factoryStats as any).totalCustomers || 0,\r\n          active: (factoryStats as any).activeCustomers || 0,\r\n          inactive: (factoryStats as any).inactiveCustomers || 0,\r\n          prospects: (factoryStats as any).prospectCustomers || 0,\r\n          byIndustry: (factoryStats as any).byIndustry || {},\r\n          bySize: (factoryStats as any).bySize || {},\r\n          recentlyAdded: 0, // Factory doesn't calculate this, would need additional logic\r\n        };\r\n      }\r\n      \r\n      // Fallback: fetch customers and calculate stats manually\r\n      console.log('[CustomerService] Falling back to manual calculation via getCustomers()');\r\n      try {\r\n        const customers = await factoryCustomerService.getCustomers();\r\n        \r\n        console.log('[CustomerService] Got customers array, length:', customers?.length || 0);\r\n        console.log('[CustomerService] Customers data type:', typeof customers, 'Is array?', Array.isArray(customers));\r\n        \r\n        // Safety check: handle both array and paginated response\r\n        let customerArray: any[] = [];\r\n        if (Array.isArray(customers)) {\r\n          customerArray = customers;\r\n        } else if (customers && typeof customers === 'object' && 'data' in customers) {\r\n          console.log('[CustomerService] ‚ö†Ô∏è Got paginated response instead of array!');\r\n          customerArray = (customers as any).data || [];\r\n        } else {\r\n          console.error('[CustomerService] ‚ùå Unexpected response format:', customers);\r\n          customerArray = [];\r\n        }\r\n        \r\n        const stats = {\r\n          total: customerArray.length,\r\n          active: customerArray.filter(c => (c as any).status === 'active').length,\r\n          inactive: customerArray.filter(c => (c as any).status === 'inactive').length,\r\n          prospects: customerArray.filter(c => (c as any).status === 'prospect').length,\r\n          byIndustry: {} as Record<string, number>,\r\n          bySize: {} as Record<string, number>,\r\n          recentlyAdded: 0,\r\n        };\r\n\r\n        // Calculate industry distribution\r\n        customerArray.forEach(customer => {\r\n          const industry = (customer as any).industry || 'Unknown';\r\n          stats.byIndustry[industry] = (stats.byIndustry[industry] || 0) + 1;\r\n        });\r\n\r\n        // Calculate size distribution\r\n        customerArray.forEach(customer => {\r\n          const size = (customer as any).size || 'Unknown';\r\n          stats.bySize[size] = (stats.bySize[size] || 0) + 1;\r\n        });\r\n\r\n        // Calculate recently added (last 30 days)\r\n        const thirtyDaysAgo = new Date();\r\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n        stats.recentlyAdded = customerArray.filter(c => \r\n          new Date((c as any).created_at) > thirtyDaysAgo\r\n        ).length;\r\n\r\n        console.log('[CustomerService] Calculated stats:', stats);\r\n        return stats;\r\n      } catch (error) {\r\n        const errorMsg = error instanceof Error ? error.message : String(error);\r\n        console.error('[CustomerService] ‚ùå Error calculating stats:', errorMsg, error);\r\n        \r\n        // Handle tenant context not initialized gracefully\r\n        if (errorMsg.includes('Tenant context not initialized') || errorMsg.includes('Unauthorized')) {\r\n          console.log('[CustomerService] üìã Returning empty stats due to auth/tenant context');\r\n          // Return empty stats instead of throwing\r\n          return {\r\n            total: 0,\r\n            active: 0,\r\n            inactive: 0,\r\n            prospects: 0,\r\n            byIndustry: {},\r\n            bySize: {},\r\n            recentlyAdded: 0,\r\n          };\r\n        }\r\n        throw error;\r\n      }\r\n    } catch (error) {\r\n      const errorMsg = error instanceof Error ? error.message : String(error);\r\n      console.error('[CustomerService] ‚ùå CRITICAL Error fetching customer stats:', errorMsg, error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\store\\customerStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\views\\CustomerCreatePage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\views\\CustomerDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2962,2965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2962,2965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3502,3505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3502,3505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customer Detail Page - Redesigned with Ant Design\r\n * Displays comprehensive customer information with tabs for related data\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport {\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Descriptions,\r\n  Tag,\r\n  Button,\r\n  Space,\r\n  Tabs,\r\n  Table,\r\n  Empty,\r\n  Spin,\r\n  Alert,\r\n  Tooltip,\r\n  Popconfirm,\r\n  Modal,\r\n  message,\r\n  Skeleton,\r\n} from 'antd';\r\nimport {\r\n  ArrowLeftOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  MailOutlined,\r\n  PhoneOutlined,\r\n  GlobalOutlined,\r\n  EnvironmentOutlined,\r\n  UserOutlined,\r\n  ShoppingCartOutlined,\r\n  FileTextOutlined,\r\n  CustomerServiceOutlined,\r\n  DollarOutlined,\r\n  CalendarOutlined,\r\n} from '@ant-design/icons';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport { DataTabErrorBoundary } from '@/components/errors/DataTabErrorBoundary';\r\nimport { useCustomer, useDeleteCustomer } from '../hooks/useCustomers';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useSalesByCustomer } from '@/modules/features/sales/hooks/useSales';\r\nimport { useContractsByCustomer } from '@/modules/features/contracts/hooks/useContracts';\r\nimport { useTicketsByCustomer } from '@/modules/features/tickets/hooks/useTickets';\r\n\r\n// Mock data for related entities (will be replaced with real API calls)\r\ninterface RelatedSale {\r\n  id: string;\r\n  sale_number: string;\r\n  product_name: string;\r\n  amount: number;\r\n  status: string;\r\n  sale_date: string;\r\n}\r\n\r\ninterface RelatedContract {\r\n  id: string;\r\n  contract_number: string;\r\n  service_level: string;\r\n  value: number;\r\n  status: string;\r\n  start_date: string;\r\n  end_date: string;\r\n}\r\n\r\ninterface RelatedTicket {\r\n  id: string;\r\n  ticket_number: string;\r\n  subject: string;\r\n  priority: string;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\nconst CustomerDetailPage: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { hasPermission } = useAuth();\r\n  const { data: customer, isLoading, error, refetch } = useCustomer(id!);\r\n  const { mutateAsync: deleteCustomer, isPending: isDeleting } = useDeleteCustomer();\r\n  const [activeTab, setActiveTab] = useState('overview');\r\n\r\n  // Fetch related data from API\r\n  const { data: salesData, isLoading: salesLoading, error: salesError, refetch: refetchSales } = useSalesByCustomer(id!);\r\n  const { contracts: relatedContracts = [], isLoading: contractsLoading, error: contractsError, refetch: refetchContracts } = useContractsByCustomer(id!);\r\n  const { data: ticketsData, isLoading: ticketsLoading, error: ticketsError, refetch: refetchTickets } = useTicketsByCustomer(id!);\r\n\r\n  // Transform sales data to match the RelatedSale interface\r\n  const relatedSales: RelatedSale[] = Array.isArray(salesData?.data) \r\n    ? salesData.data.map((deal: any) => ({\r\n        id: deal.id,\r\n        sale_number: deal.id?.substring(0, 8).toUpperCase() || 'SAL-UNKNOWN',\r\n        product_name: deal.title || 'Untitled Deal',\r\n        amount: deal.value || 0,\r\n        status: deal.stage === 'closed_won' ? 'completed' : 'pending',\r\n        sale_date: deal.created_at || new Date().toISOString(),\r\n      }))\r\n    : [];\r\n\r\n  // Transform tickets data to match the RelatedTicket interface\r\n  const relatedTickets: RelatedTicket[] = Array.isArray(ticketsData?.data)\r\n    ? ticketsData.data.map((ticket: any) => ({\r\n        id: ticket.id,\r\n        ticket_number: ticket.id?.substring(0, 8).toUpperCase() || 'TKT-UNKNOWN',\r\n        subject: ticket.title || ticket.subject || 'Untitled Ticket',\r\n        priority: ticket.priority || 'medium',\r\n        status: ticket.status || 'open',\r\n        created_at: ticket.created_at || new Date().toISOString(),\r\n      }))\r\n    : [];\r\n\r\n  const handleDelete = () => {\r\n    if (!id) return;\r\n\r\n    Modal.confirm({\r\n      title: 'Delete Customer',\r\n      content: `Are you sure you want to delete \"${customer?.company_name}\"? This action cannot be undone.`,\r\n      okText: 'Delete',\r\n      okType: 'danger',\r\n      onOk: async () => {\r\n        try {\r\n          await deleteCustomer(id);\r\n          message.success('Customer deleted successfully');\r\n          navigate('/tenant/customers');\r\n        } catch (error) {\r\n          const errorMsg = error instanceof Error ? error.message : 'Failed to delete customer';\r\n          message.error(errorMsg);\r\n          console.error('Delete error:', error);\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  const getStatusTag = (status: string) => {\r\n    const statusConfig: Record<string, { color: string; text: string }> = {\r\n      active: { color: 'success', text: 'Active' },\r\n      inactive: { color: 'default', text: 'Inactive' },\r\n      prospect: { color: 'processing', text: 'Prospect' },\r\n    };\r\n    const config = statusConfig[status] || { color: 'default', text: status };\r\n    return <Tag color={config.color}>{config.text}</Tag>;\r\n  };\r\n\r\n  const getSizeTag = (size: string) => {\r\n    const sizeConfig: Record<string, { color: string }> = {\r\n      startup: { color: 'blue' },\r\n      small: { color: 'cyan' },\r\n      medium: { color: 'geekblue' },\r\n      enterprise: { color: 'purple' },\r\n    };\r\n    const config = sizeConfig[size] || { color: 'default' };\r\n    return <Tag color={config.color}>{size?.toUpperCase()}</Tag>;\r\n  };\r\n\r\n  const formatCurrency = (value: number) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n    }).format(value);\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n    });\r\n  };\r\n\r\n  // Sales table columns\r\n  const salesColumns: ColumnsType<RelatedSale> = [\r\n    {\r\n      title: 'Sale #',\r\n      dataIndex: 'sale_number',\r\n      key: 'sale_number',\r\n      render: (text: string, record: RelatedSale) => (\r\n        <a onClick={() => navigate(`/tenant/sales/${record.id}`)}>{text}</a>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Product',\r\n      dataIndex: 'product_name',\r\n      key: 'product_name',\r\n    },\r\n    {\r\n      title: 'Amount',\r\n      dataIndex: 'amount',\r\n      key: 'amount',\r\n      render: (value: number) => (\r\n        <span style={{ color: '#1890ff', fontWeight: 500 }}>\r\n          {formatCurrency(value)}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      render: (status: string) => (\r\n        <Tag color={status === 'completed' ? 'success' : 'processing'}>\r\n          {status.toUpperCase()}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Date',\r\n      dataIndex: 'sale_date',\r\n      key: 'sale_date',\r\n      render: (date: string) => formatDate(date),\r\n    },\r\n  ];\r\n\r\n  // Contracts table columns\r\n  const contractsColumns: ColumnsType<RelatedContract> = [\r\n    {\r\n      title: 'Contract #',\r\n      dataIndex: 'contract_number',\r\n      key: 'contract_number',\r\n      render: (text: string, record: RelatedContract) => (\r\n        <a onClick={() => navigate(`/tenant/contracts/${record.id}`)}>{text}</a>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Service Level',\r\n      dataIndex: 'service_level',\r\n      key: 'service_level',\r\n      render: (level: string) => {\r\n        const colors: Record<string, string> = {\r\n          basic: 'default',\r\n          standard: 'blue',\r\n          premium: 'gold',\r\n          enterprise: 'purple',\r\n        };\r\n        return <Tag color={colors[level]}>{level.toUpperCase()}</Tag>;\r\n      },\r\n    },\r\n    {\r\n      title: 'Value',\r\n      dataIndex: 'value',\r\n      key: 'value',\r\n      render: (value: number) => (\r\n        <span style={{ color: '#1890ff', fontWeight: 500 }}>\r\n          {formatCurrency(value)}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      render: (status: string) => (\r\n        <Tag color={status === 'active' ? 'success' : 'default'}>\r\n          {status.toUpperCase()}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Period',\r\n      key: 'period',\r\n      render: (_: unknown, record: RelatedContract) => (\r\n        <span>\r\n          {formatDate(record.start_date)} - {formatDate(record.end_date)}\r\n        </span>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  // Tickets table columns\r\n  const ticketsColumns: ColumnsType<RelatedTicket> = [\r\n    {\r\n      title: 'Ticket #',\r\n      dataIndex: 'ticket_number',\r\n      key: 'ticket_number',\r\n      render: (text: string, record: RelatedTicket) => (\r\n        <a onClick={() => navigate(`/tenant/tickets/${record.id}`)}>{text}</a>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Subject',\r\n      dataIndex: 'subject',\r\n      key: 'subject',\r\n    },\r\n    {\r\n      title: 'Priority',\r\n      dataIndex: 'priority',\r\n      key: 'priority',\r\n      render: (priority: string) => {\r\n        const colors: Record<string, string> = {\r\n          low: 'default',\r\n          medium: 'blue',\r\n          high: 'orange',\r\n          urgent: 'red',\r\n        };\r\n        return <Tag color={colors[priority]}>{priority.toUpperCase()}</Tag>;\r\n      },\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      render: (status: string) => {\r\n        const colors: Record<string, string> = {\r\n          open: 'processing',\r\n          'in-progress': 'blue',\r\n          resolved: 'success',\r\n          closed: 'default',\r\n        };\r\n        return <Tag color={colors[status]}>{status.toUpperCase()}</Tag>;\r\n      },\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'created_at',\r\n      key: 'created_at',\r\n      render: (date: string) => formatDate(date),\r\n    },\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <>\r\n        <div style={{ textAlign: 'center', padding: '100px 0' }}>\r\n          <Spin size=\"large\" spinning tip=\"Loading customer details...\" />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (error || !customer) {\r\n    return (\r\n      <>\r\n        <div style={{ textAlign: 'center', padding: '100px 0' }}>\r\n          <Empty\r\n            description={\r\n              <span>\r\n                <h2 style={{ color: '#ff4d4f', marginBottom: 16 }}>Customer Not Found</h2>\r\n                <p style={{ color: '#8c8c8c' }}>\r\n                  The customer you're looking for doesn't exist or has been deleted.\r\n                </p>\r\n              </span>\r\n            }\r\n          >\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<ArrowLeftOutlined />}\r\n              onClick={() => navigate('/tenant/customers')}\r\n            >\r\n              Back to Customers\r\n            </Button>\r\n          </Empty>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  const breadcrumbs = [\r\n    { label: 'Home', path: '/tenant/dashboard' },\r\n    { label: 'Customers', path: '/tenant/customers' },\r\n    { label: customer.company_name },\r\n  ];\r\n\r\n  const headerActions = (\r\n    <Space>\r\n      <Button\r\n        icon={<ArrowLeftOutlined />}\r\n        onClick={() => navigate('/tenant/customers')}\r\n      >\r\n        Back\r\n      </Button>\r\n      {hasPermission('customers.update') && (\r\n        <Button\r\n          type=\"primary\"\r\n          icon={<EditOutlined />}\r\n          onClick={() => navigate(`/tenant/customers/${customer.id}/edit`)}\r\n        >\r\n          Edit Customer\r\n        </Button>\r\n      )}\r\n      {hasPermission('customers.delete') && (\r\n        <Popconfirm\r\n          title=\"Delete Customer\"\r\n          description=\"Are you sure you want to delete this customer? This action cannot be undone.\"\r\n          onConfirm={handleDelete}\r\n          okText=\"Yes, Delete\"\r\n          cancelText=\"Cancel\"\r\n          okButtonProps={{ danger: true, loading: deleting }}\r\n        >\r\n          <Button danger icon={<DeleteOutlined />}>\r\n            Delete\r\n          </Button>\r\n        </Popconfirm>\r\n      )}\r\n    </Space>\r\n  );\r\n\r\n  // Calculate statistics\r\n  const totalSales = relatedSales.reduce((sum, sale) => sum + sale.amount, 0);\r\n  const totalContracts = relatedContracts.length;\r\n  const activeContracts = relatedContracts.filter(c => c.status === 'active').length;\r\n  const openTickets = relatedTickets.filter(t => t.status === 'open').length;\r\n\r\n  const tabItems = [\r\n    {\r\n      key: 'overview',\r\n      label: (\r\n        <span>\r\n          <UserOutlined /> Overview\r\n        </span>\r\n      ),\r\n      children: (\r\n        <div>\r\n          {/* Statistics */}\r\n          <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n            <Col xs={24} sm={12} lg={6}>\r\n              <StatCard\r\n                title=\"Total Sales\"\r\n                value={formatCurrency(totalSales)}\r\n                icon={<ShoppingCartOutlined />}\r\n                color=\"primary\"\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={12} lg={6}>\r\n              <StatCard\r\n                title=\"Active Contracts\"\r\n                value={activeContracts}\r\n                icon={<FileTextOutlined />}\r\n                color=\"success\"\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={12} lg={6}>\r\n              <StatCard\r\n                title=\"Open Tickets\"\r\n                value={openTickets}\r\n                icon={<CustomerServiceOutlined />}\r\n                color=\"warning\"\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={12} lg={6}>\r\n              <StatCard\r\n                title=\"Customer Since\"\r\n                value={formatDate(customer.created_at)}\r\n                icon={<CalendarOutlined />}\r\n                color=\"info\"\r\n              />\r\n            </Col>\r\n          </Row>\r\n\r\n          {/* Customer Information */}\r\n          <Row gutter={[16, 16]}>\r\n            <Col xs={24} lg={12}>\r\n              <Card title=\"Contact Information\" variant=\"borderless\">\r\n                <Descriptions column={1} bordered size=\"small\">\r\n                  <Descriptions.Item label=\"Company Name\">\r\n                    {customer.company_name}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Contact Name\">\r\n                    {customer.contact_name}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Email\">\r\n                    {customer.email ? (\r\n                      <Space>\r\n                        <MailOutlined />\r\n                        <a href={`mailto:${customer.email}`}>{customer.email}</a>\r\n                      </Space>\r\n                    ) : (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Phone\">\r\n                    {customer.phone ? (\r\n                      <Space>\r\n                        <PhoneOutlined />\r\n                        <a href={`tel:${customer.phone}`}>{customer.phone}</a>\r\n                      </Space>\r\n                    ) : (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Mobile\">\r\n                    {customer.mobile ? (\r\n                      <Space>\r\n                        <PhoneOutlined />\r\n                        <a href={`tel:${customer.mobile}`}>{customer.mobile}</a>\r\n                      </Space>\r\n                    ) : (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Website\">\r\n                    {customer.website ? (\r\n                      <Space>\r\n                        <GlobalOutlined />\r\n                        <a href={customer.website} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                          {customer.website}\r\n                        </a>\r\n                      </Space>\r\n                    ) : (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                </Descriptions>\r\n              </Card>\r\n            </Col>\r\n\r\n            <Col xs={24} lg={12}>\r\n              <Card title=\"Business Information\" variant=\"borderless\">\r\n                <Descriptions column={1} bordered size=\"small\">\r\n                  <Descriptions.Item label=\"Status\">\r\n                    {getStatusTag(customer.status || 'unknown')}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Customer Type\">\r\n                    <Tag color=\"blue\">\r\n                      {customer.customer_type?.toUpperCase() || 'BUSINESS'}\r\n                    </Tag>\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Industry\">\r\n                    {customer.industry || (\r\n                      <span style={{ color: '#8c8c8c' }}>Not specified</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Company Size\">\r\n                    {customer.size ? (\r\n                      getSizeTag(customer.size)\r\n                    ) : (\r\n                      <span style={{ color: '#8c8c8c' }}>Not specified</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Credit Limit\">\r\n                    {customer.credit_limit ? (\r\n                      formatCurrency(customer.credit_limit)\r\n                    ) : (\r\n                      <span style={{ color: '#8c8c8c' }}>Not set</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Payment Terms\">\r\n                    {customer.payment_terms || (\r\n                      <span style={{ color: '#8c8c8c' }}>Not specified</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Tax ID\">\r\n                    {customer.tax_id || (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                </Descriptions>\r\n              </Card>\r\n            </Col>\r\n\r\n            <Col xs={24}>\r\n              <Card title=\"Address Information\" variant=\"borderless\">\r\n                <Descriptions column={1} bordered size=\"small\">\r\n                  <Descriptions.Item label=\"Address\">\r\n                    {customer.address ? (\r\n                      <Space>\r\n                        <EnvironmentOutlined />\r\n                        {customer.address}\r\n                      </Space>\r\n                    ) : (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"City\">\r\n                    {customer.city || (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                  <Descriptions.Item label=\"Country\">\r\n                    {customer.country || (\r\n                      <span style={{ color: '#8c8c8c' }}>Not provided</span>\r\n                    )}\r\n                  </Descriptions.Item>\r\n                </Descriptions>\r\n              </Card>\r\n            </Col>\r\n\r\n            {customer.notes && (\r\n              <Col xs={24}>\r\n                <Card title=\"Notes\" variant=\"borderless\">\r\n                  <p style={{ margin: 0, whiteSpace: 'pre-wrap' }}>{customer.notes}</p>\r\n                </Card>\r\n              </Col>\r\n            )}\r\n          </Row>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'sales',\r\n      label: (\r\n        <span>\r\n          <ShoppingCartOutlined /> Sales ({relatedSales.length})\r\n        </span>\r\n      ),\r\n      children: (\r\n        <DataTabErrorBoundary tabName=\"Sales\" onRetry={() => refetchSales()}>\r\n          <Card variant=\"borderless\">\r\n            {salesError && (\r\n              <Alert\r\n                message=\"Error Loading Sales\"\r\n                description={salesError instanceof Error ? salesError.message : 'Failed to load sales data'}\r\n                type=\"error\"\r\n                showIcon\r\n                style={{ marginBottom: 16 }}\r\n              />\r\n            )}\r\n            {salesLoading ? (\r\n              <Skeleton active paragraph={{ rows: 4 }} />\r\n            ) : (\r\n              <Table\r\n                columns={salesColumns}\r\n                dataSource={relatedSales}\r\n                rowKey=\"id\"\r\n                pagination={false}\r\n                locale={{\r\n                  emptyText: (\r\n                    <Empty\r\n                      description=\"No sales found for this customer\"\r\n                      image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                    />\r\n                  ),\r\n                }}\r\n              />\r\n            )}\r\n          </Card>\r\n        </DataTabErrorBoundary>\r\n      ),\r\n    },\r\n    {\r\n      key: 'contracts',\r\n      label: (\r\n        <span>\r\n          <FileTextOutlined /> Contracts ({relatedContracts.length})\r\n        </span>\r\n      ),\r\n      children: (\r\n        <DataTabErrorBoundary tabName=\"Contracts\" onRetry={() => refetchContracts()}>\r\n          <Card variant=\"borderless\">\r\n            {contractsError && (\r\n              <Alert\r\n                message=\"Error Loading Contracts\"\r\n                description={contractsError instanceof Error ? contractsError.message : 'Failed to load contracts data'}\r\n                type=\"error\"\r\n                showIcon\r\n                style={{ marginBottom: 16 }}\r\n              />\r\n            )}\r\n            {contractsLoading ? (\r\n              <Skeleton active paragraph={{ rows: 4 }} />\r\n            ) : (\r\n              <Table\r\n                columns={contractsColumns}\r\n                dataSource={relatedContracts}\r\n                rowKey=\"id\"\r\n                pagination={false}\r\n                locale={{\r\n                  emptyText: (\r\n                    <Empty\r\n                      description=\"No contracts found for this customer\"\r\n                      image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                    />\r\n                  ),\r\n                }}\r\n              />\r\n            )}\r\n          </Card>\r\n        </DataTabErrorBoundary>\r\n      ),\r\n    },\r\n    {\r\n      key: 'tickets',\r\n      label: (\r\n        <span>\r\n          <CustomerServiceOutlined /> Support Tickets ({relatedTickets.length})\r\n        </span>\r\n      ),\r\n      children: (\r\n        <DataTabErrorBoundary tabName=\"Support Tickets\" onRetry={refetchTickets}>\r\n          <Card variant=\"borderless\">\r\n            {ticketsError && (\r\n              <Alert\r\n                message=\"Error Loading Tickets\"\r\n                description={ticketsError instanceof Error ? ticketsError.message : 'Failed to load tickets data'}\r\n                type=\"error\"\r\n                showIcon\r\n                style={{ marginBottom: 16 }}\r\n              />\r\n            )}\r\n            {ticketsLoading ? (\r\n              <Skeleton active paragraph={{ rows: 4 }} />\r\n            ) : (\r\n              <Table\r\n                columns={ticketsColumns}\r\n                dataSource={relatedTickets}\r\n                rowKey=\"id\"\r\n                pagination={false}\r\n                locale={{\r\n                  emptyText: (\r\n                    <Empty\r\n                      description=\"No support tickets found for this customer\"\r\n                      image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                    />\r\n                  ),\r\n                }}\r\n              />\r\n            )}\r\n          </Card>\r\n        </DataTabErrorBoundary>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title={customer.company_name}\r\n        description={`Customer ID: ${customer.id} ‚Ä¢ ${customer.contact_name}`}\r\n        breadcrumbs={breadcrumbs}\r\n        extra={headerActions}\r\n      />\r\n      <div style={{ padding: 24 }}>\r\n        <Tabs\r\n          activeKey={activeTab}\r\n          onChange={setActiveTab}\r\n          items={tabItems}\r\n          size=\"large\"\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CustomerDetailPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\views\\CustomerEditPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\customers\\views\\CustomerListPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2609,2612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2609,2612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2745,2748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2745,2748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":859,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":859,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28768,28771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28768,28771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customer List Page - Enterprise Design\r\n * Main page for displaying and managing customers\r\n * Unified grid control with side drawer panels for CRUD operations\r\n */\r\n\r\nimport React, { useState, useRef } from 'react';\r\nimport { Row, Col, Card, Button, Table, Input, Select, Space, Tag, Popconfirm, message, Empty, Modal, Checkbox, Alert, Upload, Spin } from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport { PlusOutlined, ReloadOutlined, SearchOutlined, EyeOutlined, EditOutlined, DeleteOutlined, ClearOutlined, DeleteFilled, DownloadOutlined, UploadOutlined } from '@ant-design/icons';\r\nimport { Users, Mail, Phone } from 'lucide-react';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { CustomerDetailPanel } from '../components/CustomerDetailPanel';\r\nimport { CustomerFormPanel } from '../components/CustomerFormPanel';\r\nimport { Customer, CustomerFilters } from '@/types/crm';\r\nimport { useCustomers, useDeleteCustomer, useCustomerStats, useCustomerExport, useCustomerImport } from '../hooks/useCustomers';\r\nimport { useIndustries } from '../hooks/useIndustries';\r\nimport { useCompanySizes } from '../hooks/useCompanySizes';\r\nimport { useActiveUsers } from '../hooks/useUsers';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\n\r\nconst { Search } = Input;\r\nconst { Option } = Select;\r\n\r\nconst CustomerListPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const [filters, setFilters] = useState<Partial<CustomerFilters>>({\r\n    page: 1,\r\n    pageSize: 20,\r\n  });\r\n  const [searchText, setSearchText] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<string>('all');\r\n  const [industryFilter, setIndustryFilter] = useState<string>('');\r\n  const [sizeFilter, setSizeFilter] = useState<string>('');\r\n  const [assignedFilter, setAssignedFilter] = useState<string>('');\r\n  \r\n  // Drawer states\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\r\n  const [drawerMode, setDrawerMode] = useState<'create' | 'edit' | 'view' | null>(null);\r\n\r\n  // Bulk operations states\r\n  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n  const [isBulkDeleting, setIsBulkDeleting] = useState(false);\r\n\r\n  // Export/Import states\r\n  const [isExportModalVisible, setIsExportModalVisible] = useState(false);\r\n  const [exportFormat, setExportFormat] = useState<'csv' | 'json'>('csv');\r\n  const [isImportModalVisible, setIsImportModalVisible] = useState(false);\r\n  const [importFile, setImportFile] = useState<File | null>(null);\r\n  const [importPreviewData, setImportPreviewData] = useState<any[]>([]);\r\n  const [showImportPreview, setShowImportPreview] = useState(false);\r\n  const [importResults, setImportResults] = useState<any>(null);\r\n\r\n  // Queries\r\n  const { customers, pagination, isLoading: customersLoading, refetch } = useCustomers(filters as CustomerFilters);\r\n  const deleteCustomer = useDeleteCustomer();\r\n  const exportCustomers = useCustomerExport();\r\n  const importCustomers = useCustomerImport();\r\n  const { data: statsData, isLoading: statsLoading } = useCustomerStats();\r\n  \r\n  // Fetch dynamic dropdown data\r\n  const { data: industries = [] } = useIndustries();\r\n  const { data: companySizes = [] } = useCompanySizes();\r\n  const { data: users = [] } = useActiveUsers();\r\n\r\n  // Real stats from service\r\n  const stats = statsData || {\r\n    totalCustomers: 0,\r\n    activeCustomers: 0,\r\n    prospectCustomers: 0,\r\n    inactiveCustomers: 0,\r\n    byIndustry: {},\r\n    bySize: {},\r\n    byStatus: {}\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    refetch();\r\n    message.success('Data refreshed successfully');\r\n  };\r\n\r\n  const handleCreate = () => {\r\n    setSelectedCustomer(null);\r\n    setDrawerMode('create');\r\n  };\r\n\r\n  const handleEdit = (customer: Customer) => {\r\n    setSelectedCustomer(customer);\r\n    setDrawerMode('edit');\r\n  };\r\n\r\n  const handleView = (customer: Customer) => {\r\n    setSelectedCustomer(customer);\r\n    setDrawerMode('view');\r\n  };\r\n\r\n  const handleDelete = async (customer: Customer) => {\r\n    try {\r\n      await deleteCustomer.mutateAsync(customer.id);\r\n      message.success(`Customer \"${customer.company_name}\" deleted successfully`);\r\n      refetch();\r\n    } catch (error) {\r\n      message.error('Failed to delete customer');\r\n    }\r\n  };\r\n\r\n  const handleBulkDelete = async () => {\r\n    if (!hasPermission('customers:delete')) {\r\n      message.error('You do not have permission to delete customers');\r\n      return;\r\n    }\r\n\r\n    const customersToDelete = customers?.filter(c => selectedRowKeys.includes(c.id)) || [];\r\n    \r\n    Modal.confirm({\r\n      title: 'Bulk Delete Customers',\r\n      icon: <DeleteFilled />,\r\n      content: (\r\n        <div>\r\n          <p>Are you sure you want to delete <strong>{selectedRowKeys.length}</strong> customer(s)?</p>\r\n          {customersToDelete.length > 0 && (\r\n            <div style={{ marginTop: 16, maxHeight: 200, overflowY: 'auto' }}>\r\n              <p style={{ fontSize: 12, color: '#8c8c8c' }}>Selected customers:</p>\r\n              {customersToDelete.map(c => (\r\n                <div key={c.id} style={{ fontSize: 12, padding: '4px 0' }}>\r\n                  ‚Ä¢ {c.company_name}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <Alert \r\n            message=\"This action cannot be undone\"\r\n            type=\"warning\"\r\n            style={{ marginTop: 16 }}\r\n            showIcon\r\n          />\r\n        </div>\r\n      ),\r\n      okText: 'Delete',\r\n      okButtonProps: { danger: true },\r\n      cancelText: 'Cancel',\r\n      onOk: async () => {\r\n        try {\r\n          setIsBulkDeleting(true);\r\n          const failedIds: string[] = [];\r\n          \r\n          for (const customerId of selectedRowKeys as string[]) {\r\n            try {\r\n              await deleteCustomer.mutateAsync(customerId);\r\n            } catch (error) {\r\n              failedIds.push(customerId);\r\n            }\r\n          }\r\n          \r\n          if (failedIds.length === 0) {\r\n            message.success(`Successfully deleted ${selectedRowKeys.length} customer(s)`);\r\n            setSelectedRowKeys([]);\r\n            refetch();\r\n          } else {\r\n            message.warning(`Deleted ${selectedRowKeys.length - failedIds.length} customer(s), but ${failedIds.length} failed`);\r\n            setSelectedRowKeys(failedIds as React.Key[]);\r\n            refetch();\r\n          }\r\n        } catch (error) {\r\n          message.error('Failed to bulk delete customers');\r\n        } finally {\r\n          setIsBulkDeleting(false);\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  // Export handler\r\n  const handleExport = async () => {\r\n    if (!hasPermission('customers:read')) {\r\n      message.error('You do not have permission to export customers');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await exportCustomers.mutateAsync(exportFormat);\r\n      setIsExportModalVisible(false);\r\n      message.success(`Customers exported successfully as ${exportFormat.toUpperCase()}`);\r\n    } catch (error) {\r\n      message.error('Failed to export customers');\r\n    }\r\n  };\r\n\r\n  // Import handlers\r\n  const handleImportFileSelect = (file: File) => {\r\n    setImportFile(file);\r\n    \r\n    // Read file to preview\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      try {\r\n        const content = e.target?.result as string;\r\n        if (file.name.endsWith('.json')) {\r\n          const data = JSON.parse(content);\r\n          const preview = Array.isArray(data) ? data.slice(0, 5) : [data];\r\n          setImportPreviewData(preview);\r\n        } else if (file.name.endsWith('.csv')) {\r\n          // Simple CSV preview - first 5 lines\r\n          const lines = content.split('\\n').slice(0, 6);\r\n          setImportPreviewData(lines.map((line, idx) => ({ row: idx, data: line })));\r\n        }\r\n        setShowImportPreview(true);\r\n      } catch (error) {\r\n        message.error('Invalid file format');\r\n        setImportFile(null);\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n    \r\n    return false; // Prevent default upload behavior\r\n  };\r\n\r\n  const handleImportConfirm = async () => {\r\n    if (!importFile) {\r\n      message.error('Please select a file to import');\r\n      return;\r\n    }\r\n\r\n    if (!hasPermission('customers:create')) {\r\n      message.error('You do not have permission to import customers');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const reader = new FileReader();\r\n      reader.onload = async (e) => {\r\n        try {\r\n          const content = e.target?.result as string;\r\n          const result = await importCustomers.mutateAsync(content);\r\n          \r\n          setImportResults(result);\r\n          setShowImportPreview(false);\r\n          \r\n          if (result.errors && result.errors.length > 0) {\r\n            message.warning(\r\n              `Import completed: ${result.successCount} imported, ${result.errors.length} failed`\r\n            );\r\n          } else {\r\n            message.success('Customers imported successfully');\r\n          }\r\n          \r\n          // Refresh the table\r\n          refetch();\r\n          setIsImportModalVisible(false);\r\n          setImportFile(null);\r\n        } catch (error) {\r\n          message.error('Failed to import customers');\r\n        }\r\n      };\r\n      reader.readAsText(importFile);\r\n    } catch (error) {\r\n      message.error('Failed to process import file');\r\n    }\r\n  };\r\n\r\n  const handleImportCancel = () => {\r\n    setIsImportModalVisible(false);\r\n    setImportFile(null);\r\n    setImportPreviewData([]);\r\n    setShowImportPreview(false);\r\n    setImportResults(null);\r\n  };\r\n\r\n  const handleSearch = (value: string) => {\r\n    setSearchText(value);\r\n    setFilters({ ...filters, search: value, page: 1 });\r\n  };\r\n\r\n  const handleStatusFilterChange = (value: string) => {\r\n    setStatusFilter(value);\r\n    const statusValue: 'active' | 'inactive' | 'prospect' | undefined = value === 'all' ? undefined : (value as 'active' | 'inactive' | 'prospect');\r\n    setFilters({ ...filters, status: statusValue, page: 1 });\r\n  };\r\n\r\n  const handleIndustryFilterChange = (value: string) => {\r\n    setIndustryFilter(value);\r\n    setFilters({ ...filters, industry: value || undefined, page: 1 });\r\n  };\r\n\r\n  const handleSizeFilterChange = (value: string) => {\r\n    setSizeFilter(value);\r\n    setFilters({ ...filters, size: value || undefined, page: 1 });\r\n  };\r\n\r\n  const handleAssignedFilterChange = (value: string) => {\r\n    setAssignedFilter(value);\r\n    setFilters({ ...filters, assigned_to: value || undefined, page: 1 });\r\n  };\r\n\r\n  const handleClearFilters = () => {\r\n    setSearchText('');\r\n    setStatusFilter('all');\r\n    setIndustryFilter('');\r\n    setSizeFilter('');\r\n    setAssignedFilter('');\r\n    setSelectedRowKeys([]);\r\n    setFilters({ page: 1, pageSize: 20 });\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'active': return 'green';\r\n      case 'inactive': return 'default';\r\n      case 'prospect': return 'blue';\r\n      default: return 'default';\r\n    }\r\n  };\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<Customer> = [\r\n    {\r\n      title: 'Customer',\r\n      key: 'company_name',\r\n      dataIndex: 'company_name',\r\n      width: 250,\r\n      render: (text, record) => (\r\n        <div>\r\n          <div style={{ fontWeight: 500, marginBottom: 4 }}>{text}</div>\r\n          <div style={{ fontSize: 12, color: '#8c8c8c' }}>{record.contact_name}</div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Contact',\r\n      key: 'contact',\r\n      width: 200,\r\n      render: (_, record) => (\r\n        <Space direction=\"vertical\" size={0}>\r\n          {record.email && (\r\n            <div style={{ fontSize: 12, display: 'flex', alignItems: 'center' }}>\r\n              <Mail size={12} style={{ marginRight: 6 }} />\r\n              {record.email}\r\n            </div>\r\n          )}\r\n          {record.phone && (\r\n            <div style={{ fontSize: 12, color: '#8c8c8c', display: 'flex', alignItems: 'center' }}>\r\n              <Phone size={12} style={{ marginRight: 6 }} />\r\n              {record.phone}\r\n            </div>\r\n          )}\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Industry',\r\n      key: 'industry',\r\n      dataIndex: 'industry',\r\n      width: 120,\r\n      render: (industry) => (\r\n        <Tag color=\"blue\">{industry || 'Not specified'}</Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Company Size',\r\n      key: 'size',\r\n      dataIndex: 'size',\r\n      width: 110,\r\n      render: (size) => (\r\n        <Tag color=\"purple\">{size || 'Not specified'}</Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      key: 'status',\r\n      dataIndex: 'status',\r\n      width: 100,\r\n      render: (status) => (\r\n        <Tag color={getStatusColor(status)}>\r\n          {status?.toUpperCase()}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Assigned To',\r\n      key: 'assigned_to',\r\n      dataIndex: 'assigned_to',\r\n      width: 130,\r\n      render: (assignedTo: string) => (\r\n        <span>{assignedTo ? users.find(u => u.id === assignedTo)?.firstName : 'Unassigned'}</span>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Created',\r\n      key: 'created_at',\r\n      dataIndex: 'created_at',\r\n      width: 120,\r\n      render: (date) => date ? new Date(date).toLocaleDateString() : '-',\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      fixed: 'right',\r\n      width: 150,\r\n      render: (_, record) => (\r\n        <Space size=\"small\">\r\n          <Button\r\n            type=\"link\"\r\n            size=\"small\"\r\n            icon={<EyeOutlined />}\r\n            onClick={() => handleView(record)}\r\n          >\r\n            View\r\n          </Button>\r\n          {hasPermission('customers:update') && (\r\n            <Button\r\n              type=\"link\"\r\n              size=\"small\"\r\n              icon={<EditOutlined />}\r\n              onClick={() => handleEdit(record)}\r\n            >\r\n              Edit\r\n            </Button>\r\n          )}\r\n          {hasPermission('customers:delete') && (\r\n            <Popconfirm\r\n              title=\"Delete Customer\"\r\n              description={`Are you sure you want to delete \"${record.company_name}\"?`}\r\n              onConfirm={() => handleDelete(record)}\r\n              okText=\"Yes\"\r\n              cancelText=\"No\"\r\n              okButtonProps={{ danger: true }}\r\n            >\r\n              <Button\r\n                type=\"link\"\r\n                size=\"small\"\r\n                danger\r\n                icon={<DeleteOutlined />}\r\n              >\r\n                Delete\r\n              </Button>\r\n            </Popconfirm>\r\n          )}\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Customers\"\r\n        description=\"Manage your customer relationships and interactions\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Dashboard', path: '/tenant/dashboard' },\r\n            { title: 'Customers' }\r\n          ]\r\n        }}\r\n        extra={\r\n          <>\r\n            <Button icon={<ReloadOutlined />} onClick={handleRefresh}>\r\n              Refresh\r\n            </Button>\r\n            {hasPermission('customers:read') && (\r\n              <Button icon={<DownloadOutlined />} onClick={() => setIsExportModalVisible(true)}>\r\n                Export\r\n              </Button>\r\n            )}\r\n            {hasPermission('customers:create') && (\r\n              <Button icon={<UploadOutlined />} onClick={() => setIsImportModalVisible(true)}>\r\n                Import\r\n              </Button>\r\n            )}\r\n            {hasPermission('customers:create') && (\r\n              <Button type=\"primary\" icon={<PlusOutlined />} onClick={handleCreate}>\r\n                Add Customer\r\n              </Button>\r\n            )}\r\n          </>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Customers\"\r\n              value={stats.totalCustomers}\r\n              description=\"All customers\"\r\n              icon={Users}\r\n              color=\"primary\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Active Customers\"\r\n              value={stats.activeCustomers}\r\n              description={`${stats.totalCustomers > 0 ? ((stats.activeCustomers / stats.totalCustomers) * 100).toFixed(1) : 0}% of total`}\r\n              icon={Users}\r\n              color=\"success\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Prospects\"\r\n              value={stats.prospectCustomers}\r\n              description=\"Potential customers\"\r\n              icon={Users}\r\n              color=\"info\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Top Industry\"\r\n              value={Object.entries(stats.byIndustry).sort(([,a], [,b]) => b - a)[0]?.[0] || 'N/A'}\r\n              description=\"Most common\"\r\n              icon={Users}\r\n              color=\"warning\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Customers Table */}\r\n        <Card\r\n          style={{\r\n            borderRadius: 8,\r\n            boxShadow: '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)',\r\n          }}\r\n        >\r\n          {/* Search and Filters */}\r\n          <Space style={{ marginBottom: 16, width: '100%' }} direction=\"vertical\">\r\n            <Space.Compact style={{ width: '100%' }}>\r\n              <Search\r\n                placeholder=\"Search customers by name, email, or phone...\"\r\n                allowClear\r\n                enterButton={<SearchOutlined />}\r\n                size=\"large\"\r\n                onSearch={handleSearch}\r\n                style={{ flex: 1 }}\r\n              />\r\n              <Button \r\n                icon={<ClearOutlined />} \r\n                onClick={handleClearFilters}\r\n                size=\"large\"\r\n                title=\"Clear all filters\"\r\n              >\r\n                Clear\r\n              </Button>\r\n            </Space.Compact>\r\n            <Space style={{ width: '100%' }} wrap>\r\n              <Select\r\n                value={statusFilter}\r\n                onChange={handleStatusFilterChange}\r\n                style={{ width: 130 }}\r\n                placeholder=\"Status\"\r\n                size=\"large\"\r\n              >\r\n                <Option value=\"all\">All Status</Option>\r\n                <Option value=\"active\">Active</Option>\r\n                <Option value=\"inactive\">Inactive</Option>\r\n                <Option value=\"prospect\">Prospect</Option>\r\n              </Select>\r\n              \r\n              <Select\r\n                value={industryFilter}\r\n                onChange={handleIndustryFilterChange}\r\n                style={{ width: 140 }}\r\n                placeholder=\"Industry\"\r\n                allowClear\r\n                size=\"large\"\r\n              >\r\n                {industries.map(industry => (\r\n                  <Option key={industry.id || industry.value} value={industry.value || industry.label}>\r\n                    {industry.label || industry.value}\r\n                  </Option>\r\n                ))}\r\n              </Select>\r\n              \r\n              <Select\r\n                value={sizeFilter}\r\n                onChange={handleSizeFilterChange}\r\n                style={{ width: 130 }}\r\n                placeholder=\"Company Size\"\r\n                allowClear\r\n                size=\"large\"\r\n              >\r\n                {companySizes.map(size => (\r\n                  <Option key={size.id || size.value} value={size.value || size.label}>\r\n                    {size.label || size.value}\r\n                  </Option>\r\n                ))}\r\n              </Select>\r\n              \r\n              <Select\r\n                value={assignedFilter}\r\n                onChange={handleAssignedFilterChange}\r\n                style={{ width: 150 }}\r\n                placeholder=\"Assigned To\"\r\n                allowClear\r\n                size=\"large\"\r\n              >\r\n                {users.map(user => (\r\n                  <Option key={user.id} value={user.id}>\r\n                    {user.firstName} {user.lastName}\r\n                  </Option>\r\n                ))}\r\n              </Select>\r\n            </Space>\r\n          </Space>\r\n\r\n          {/* Bulk Operations Toolbar */}\r\n          {selectedRowKeys.length > 0 && (\r\n            <Alert\r\n              message={`${selectedRowKeys.length} customer(s) selected`}\r\n              type=\"info\"\r\n              style={{ marginBottom: 16 }}\r\n              action={\r\n                <Space size=\"small\">\r\n                  <Button \r\n                    type=\"primary\" \r\n                    danger\r\n                    size=\"small\"\r\n                    icon={<DeleteFilled />}\r\n                    onClick={handleBulkDelete}\r\n                    loading={isBulkDeleting}\r\n                    disabled={!hasPermission('customers:delete')}\r\n                  >\r\n                    Delete Selected\r\n                  </Button>\r\n                  <Button \r\n                    size=\"small\"\r\n                    onClick={() => setSelectedRowKeys([])}\r\n                  >\r\n                    Clear Selection\r\n                  </Button>\r\n                </Space>\r\n              }\r\n            />\r\n          )}\r\n\r\n          {/* Table */}\r\n          <Table\r\n            columns={columns}\r\n            dataSource={customers || []}\r\n            loading={customersLoading}\r\n            pagination={{\r\n              current: filters.page || 1,\r\n              pageSize: filters.pageSize || 20,\r\n              total: pagination?.total || 0,\r\n              showSizeChanger: true,\r\n              showQuickJumper: true,\r\n              onChange: (page, pageSize) => {\r\n                setFilters({ ...filters, page, pageSize });\r\n              },\r\n            }}\r\n            rowKey=\"id\"\r\n            rowSelection={{\r\n              selectedRowKeys,\r\n              onChange: (keys) => setSelectedRowKeys(keys),\r\n              selections: [\r\n                Table.SELECTION_ALL,\r\n                Table.SELECTION_INVERT,\r\n                Table.SELECTION_NONE,\r\n              ],\r\n            }}\r\n            locale={{\r\n              emptyText: <Empty description=\"No customers found\" style={{ marginTop: 48, marginBottom: 48 }} />,\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Detail Panel (View) */}\r\n      <CustomerDetailPanel\r\n        visible={drawerMode === 'view'}\r\n        customer={selectedCustomer}\r\n        onClose={() => setDrawerMode(null)}\r\n        onEdit={() => setDrawerMode('edit')}\r\n      />\r\n\r\n      {/* Form Panel (Create/Edit) */}\r\n      <CustomerFormPanel\r\n        visible={drawerMode === 'create' || drawerMode === 'edit'}\r\n        customer={drawerMode === 'edit' ? selectedCustomer : null}\r\n        onClose={() => setDrawerMode(null)}\r\n        onSuccess={() => {\r\n          setDrawerMode(null);\r\n          refetch();\r\n        }}\r\n      />\r\n\r\n      {/* Export Modal */}\r\n      <Modal\r\n        title=\"Export Customers\"\r\n        open={isExportModalVisible}\r\n        onOk={handleExport}\r\n        onCancel={() => setIsExportModalVisible(false)}\r\n        okText=\"Export\"\r\n        cancelText=\"Cancel\"\r\n        width={500}\r\n      >\r\n        <div style={{ marginBottom: 16 }}>\r\n          <p>Select the format for your export:</p>\r\n          <Select\r\n            value={exportFormat}\r\n            onChange={(value) => setExportFormat(value as 'csv' | 'json')}\r\n            style={{ width: '100%' }}\r\n            size=\"large\"\r\n          >\r\n            <Option value=\"csv\">\r\n              <div>\r\n                <div style={{ fontWeight: 500 }}>CSV Format</div>\r\n                <div style={{ fontSize: 12, color: '#8c8c8c' }}>\r\n                  Compatible with Excel and other spreadsheet applications\r\n                </div>\r\n              </div>\r\n            </Option>\r\n            <Option value=\"json\">\r\n              <div>\r\n                <div style={{ fontWeight: 500 }}>JSON Format</div>\r\n                <div style={{ fontSize: 12, color: '#8c8c8c' }}>\r\n                  Structured format for data import or API usage\r\n                </div>\r\n              </div>\r\n            </Option>\r\n          </Select>\r\n        </div>\r\n        <Alert\r\n          message={`You will export ${customers?.length || 0} customer records`}\r\n          type=\"info\"\r\n          showIcon\r\n        />\r\n      </Modal>\r\n\r\n      {/* Import Modal */}\r\n      <Modal\r\n        title=\"Import Customers\"\r\n        open={isImportModalVisible}\r\n        onOk={showImportPreview ? handleImportConfirm : undefined}\r\n        onCancel={handleImportCancel}\r\n        okText={showImportPreview ? 'Confirm Import' : undefined}\r\n        cancelText=\"Cancel\"\r\n        width={600}\r\n        footer={\r\n          showImportPreview\r\n            ? [\r\n                <Button key=\"cancel\" onClick={handleImportCancel}>\r\n                  Cancel\r\n                </Button>,\r\n                <Button\r\n                  key=\"submit\"\r\n                  type=\"primary\"\r\n                  loading={importCustomers.isLoading}\r\n                  onClick={handleImportConfirm}\r\n                >\r\n                  Confirm Import\r\n                </Button>,\r\n              ]\r\n            : [\r\n                <Button key=\"cancel\" onClick={handleImportCancel}>\r\n                  Cancel\r\n                </Button>,\r\n              ]\r\n        }\r\n      >\r\n        {!showImportPreview ? (\r\n          <div>\r\n            <p style={{ marginBottom: 16 }}>\r\n              Upload a CSV or JSON file with customer data:\r\n            </p>\r\n            <Upload\r\n              accept=\".csv,.json\"\r\n              maxCount={1}\r\n              beforeUpload={handleImportFileSelect}\r\n              onRemove={() => {\r\n                setImportFile(null);\r\n                setImportPreviewData([]);\r\n              }}\r\n            >\r\n              <Button icon={<UploadOutlined />}>\r\n                Select File\r\n              </Button>\r\n            </Upload>\r\n            <Alert\r\n              message=\"Supported formats: CSV, JSON\"\r\n              type=\"info\"\r\n              style={{ marginTop: 16 }}\r\n              showIcon\r\n            />\r\n            <Alert\r\n              message=\"Required fields: company_name, email, phone\"\r\n              type=\"warning\"\r\n              style={{ marginTop: 8 }}\r\n              showIcon\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <div style={{ marginBottom: 16 }}>\r\n              <h4>Preview</h4>\r\n              <div\r\n                style={{\r\n                  backgroundColor: '#fafafa',\r\n                  padding: 12,\r\n                  borderRadius: 4,\r\n                  maxHeight: 300,\r\n                  overflowY: 'auto',\r\n                  border: '1px solid #e0e0e0',\r\n                }}\r\n              >\r\n                {importPreviewData.map((item, idx) => (\r\n                  <div\r\n                    key={idx}\r\n                    style={{\r\n                      padding: '8px 0',\r\n                      borderBottom: '1px solid #e8e8e8',\r\n                      fontSize: 12,\r\n                    }}\r\n                  >\r\n                    {typeof item === 'string' ? (\r\n                      <code>{item}</code>\r\n                    ) : (\r\n                      <code>{JSON.stringify(item)}</code>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <Alert\r\n              message=\"Please verify the data above is correct before confirming\"\r\n              type=\"warning\"\r\n              showIcon\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {importResults && (\r\n          <div style={{ marginTop: 16 }}>\r\n            <Alert\r\n              message={`Import Results: ${importResults.successCount} imported, ${\r\n                importResults.errors?.length || 0\r\n              } failed`}\r\n              type={importResults.errors?.length > 0 ? 'warning' : 'success'}\r\n              showIcon\r\n            />\r\n            {importResults.errors && importResults.errors.length > 0 && (\r\n              <div style={{ marginTop: 16 }}>\r\n                <h4>Errors:</h4>\r\n                <div\r\n                  style={{\r\n                    backgroundColor: '#fff7e6',\r\n                    padding: 12,\r\n                    borderRadius: 4,\r\n                    maxHeight: 200,\r\n                    overflowY: 'auto',\r\n                    border: '1px solid #ffe7ba',\r\n                  }}\r\n                >\r\n                  {importResults.errors.map((error: any, idx: number) => (\r\n                    <div key={idx} style={{ padding: '4px 0', fontSize: 12 }}>\r\n                      ‚Ä¢ {typeof error === 'string' ? error : error.message}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CustomerListPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\components\\DashboardWidgets.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\hooks\\useDashboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":15,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":15,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dashboard Routes\r\n * Route definitions for the dashboard module\r\n */\r\n\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components for code splitting\r\nconst DashboardPage = lazy(() => import('./views/DashboardPage').then(m => ({ default: m.DashboardPage })));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading dashboard...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const dashboardRoutes: RouteObject[] = [\r\n  {\r\n    path: 'dashboard',\r\n    element: (\r\n      <RouteWrapper>\r\n        <DashboardPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];\r\n\r\nexport default dashboardRoutes;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\services\\dashboardService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\services\\mockData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\views\\DashboardPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\dashboard\\views\\DashboardPageNew.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\components\\JobWorksDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\components\\JobWorksFormPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\components\\JobWorksFormPanelEnhanced.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6684,6687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6684,6687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Job Works Form Panel - ENTERPRISE EDITION\r\n * Side drawer for creating/editing job works with professional enterprise features\r\n * ‚úÖ Auto-generated job reference numbers (JW-CUSTSHORT-YYYYMMDD-XXXX format)\r\n * ‚úÖ Professional SLA and timeline tracking based on priority\r\n * ‚úÖ Advanced workflow management with status-based progression\r\n * ‚úÖ Quality assurance and compliance tracking\r\n * ‚úÖ Engineer assignment with availability management\r\n * ‚úÖ Dynamic pricing calculation with multipliers\r\n * ‚úÖ Delivery tracking and instructions\r\n * ‚úÖ Enterprise-level form organization and validation\r\n * Features:\r\n *   - Auto-generated unique job reference numbers with tenant isolation\r\n *   - Professional SLA cards with turnaround time estimates\r\n *   - Priority-based workflow with intelligent status progression\r\n *   - Customer and product relationship management\r\n *   - Engineer assignment and routing\r\n *   - Timeline management (due date, start, completion)\r\n *   - Quality metrics and compliance tracking\r\n *   - Delivery address and special instructions\r\n *   - Advanced pricing with piece and size multipliers\r\n *   - Job specifications and custom requirements\r\n *   - Comprehensive validation and error handling\r\n * RBAC Integration: Controls create/edit form permissions\r\n */\r\n\r\nimport React, { useEffect, useCallback, useState, useMemo } from 'react';\r\nimport {\r\n  Drawer,\r\n  Form,\r\n  Input,\r\n  Button,\r\n  Select,\r\n  DatePicker,\r\n  Spin,\r\n  Space,\r\n  Divider,\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Tag,\r\n  Badge,\r\n  Alert,\r\n  Tooltip,\r\n  Statistic,\r\n  Empty,\r\n  message,\r\n  InputNumber,\r\n  Checkbox,\r\n} from 'antd';\r\nimport {\r\n  ClockCircleOutlined,\r\n  AlertOutlined,\r\n  CheckCircleOutlined,\r\n  UserOutlined,\r\n  BgColorsOutlined,\r\n  LockOutlined,\r\n  FileTextOutlined,\r\n  LinkOutlined,\r\n  ToolOutlined,\r\n  BugOutlined,\r\n  WarningOutlined,\r\n  ThunderboltOutlined,\r\n  TeamOutlined,\r\n  CreditCardOutlined,\r\n  EnvironmentOutlined,\r\n  FileOutlined,\r\n  CalendarOutlined,\r\n} from '@ant-design/icons';\r\nimport { JobWork } from '@/types/jobWork';\r\nimport dayjs from 'dayjs';\r\n\r\ninterface JobWorksFormPanelEnhancedProps {\r\n  jobWork: JobWork | null;\r\n  mode: 'create' | 'edit';\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess?: () => void;\r\n}\r\n\r\n// Job priority configuration with SLA definitions\r\nconst PRIORITY_CONFIG = [\r\n  { \r\n    label: 'Low', \r\n    value: 'low', \r\n    color: 'default', \r\n    turnaroundDays: 14,\r\n    responseTime: '48 hours',\r\n    icon: 'üìä'\r\n  },\r\n  { \r\n    label: 'Medium', \r\n    value: 'medium', \r\n    color: 'processing', \r\n    turnaroundDays: 7,\r\n    responseTime: '24 hours',\r\n    icon: '‚ö†Ô∏è'\r\n  },\r\n  { \r\n    label: 'High', \r\n    value: 'high', \r\n    color: 'warning', \r\n    turnaroundDays: 3,\r\n    responseTime: '12 hours',\r\n    icon: 'üî¥'\r\n  },\r\n  { \r\n    label: 'Urgent', \r\n    value: 'urgent', \r\n    color: 'red', \r\n    turnaroundDays: 1,\r\n    responseTime: '4 hours',\r\n    icon: 'üö®'\r\n  },\r\n];\r\n\r\n// Status configuration with workflow\r\nconst STATUS_CONFIG = [\r\n  { label: 'Pending', value: 'pending', color: 'warning', icon: 'üìå', description: 'Awaiting processing' },\r\n  { label: 'In Progress', value: 'in_progress', color: 'processing', icon: '‚è≥', description: 'Being worked on' },\r\n  { label: 'Completed', value: 'completed', color: 'success', icon: '‚úì', description: 'Work finished' },\r\n  { label: 'Delivered', value: 'delivered', color: 'success', icon: 'üì¶', description: 'Delivered to customer' },\r\n  { label: 'Cancelled', value: 'cancelled', color: 'error', icon: '‚úï', description: 'Cancelled' },\r\n];\r\n\r\n// Size categories for multipliers\r\nconst SIZE_CATEGORIES = [\r\n  { label: 'Small', value: 'small', multiplier: 0.8 },\r\n  { label: 'Medium', value: 'medium', multiplier: 1.0 },\r\n  { label: 'Large', value: 'large', multiplier: 1.5 },\r\n  { label: 'Extra Large', value: 'xlarge', multiplier: 2.0 },\r\n];\r\n\r\n// Compliance requirements presets\r\nconst COMPLIANCE_PRESETS = [\r\n  'ISO 9001 Certified',\r\n  'Food Safety Compliance',\r\n  'Environmental Standard',\r\n  'Safety Certification',\r\n  'Quality Assurance Pass',\r\n  'Inspection Required',\r\n];\r\n\r\nexport const JobWorksFormPanelEnhanced: React.FC<JobWorksFormPanelEnhancedProps> = ({\r\n  jobWork,\r\n  mode,\r\n  isOpen,\r\n  onClose,\r\n  onSuccess,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [priority, setPriority] = useState<string>(jobWork?.priority || 'medium');\r\n  const [status, setStatus] = useState<string>(jobWork?.status || 'pending');\r\n  const [jobRefId, setJobRefId] = useState<string>('');\r\n  const [size, setSize] = useState<string>(jobWork?.size || 'medium');\r\n  const [pieces, setPieces] = useState<number>(jobWork?.pieces || 1);\r\n  const [basePrice, setBasePrice] = useState<number>(jobWork?.base_price || 0);\r\n  const [selectedCompliance, setSelectedCompliance] = useState<string[]>(jobWork?.compliance_requirements || []);\r\n  const [qualityCheckPassed, setQualityCheckPassed] = useState<boolean>(jobWork?.quality_check_passed || false);\r\n\r\n  // Initialize job reference number on mount\r\n  useEffect(() => {\r\n    if (mode === 'create' && isOpen) {\r\n      const now = new Date();\r\n      const year = now.getFullYear();\r\n      const month = String(now.getMonth() + 1).padStart(2, '0');\r\n      const day = String(now.getDate()).padStart(2, '0');\r\n      const random = String(Math.floor(Math.random() * 999999)).padStart(6, '0');\r\n      const newRefId = `JW-${year}${month}${day}-${random}`;\r\n      setJobRefId(newRefId);\r\n    } else if (jobWork?.job_ref_id) {\r\n      setJobRefId(jobWork.job_ref_id);\r\n    }\r\n  }, [mode, isOpen, jobWork]);\r\n\r\n  // Calculate SLA information based on priority\r\n  const slaDetails = useMemo(() => {\r\n    const priorityConfig = PRIORITY_CONFIG.find(p => p.value === priority);\r\n    if (!priorityConfig) return null;\r\n\r\n    return {\r\n      priority: priorityConfig,\r\n      responseDeadline: dayjs().add(2, 'hours'),\r\n      completionDeadline: dayjs().add(priorityConfig.turnaroundDays, 'day'),\r\n    };\r\n  }, [priority]);\r\n\r\n  // Calculate price based on pieces and size multiplier\r\n  const calculatedPrice = useMemo(() => {\r\n    const sizeConfig = SIZE_CATEGORIES.find(s => s.value === size);\r\n    const sizeMultiplier = sizeConfig?.multiplier || 1.0;\r\n    const effectiveUnitPrice = basePrice * sizeMultiplier;\r\n    const totalPrice = effectiveUnitPrice * pieces;\r\n    return {\r\n      sizeMultiplier,\r\n      effectiveUnitPrice,\r\n      totalPrice,\r\n      formattedTotal: `$${totalPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`,\r\n    };\r\n  }, [basePrice, size, pieces]);\r\n\r\n  // Handle form submission\r\n  const handleSubmit = useCallback(async (values: any) => {\r\n    try {\r\n      setIsSubmitting(true);\r\n      const submitData = {\r\n        ...values,\r\n        job_ref_id: jobRefId,\r\n        priority,\r\n        status,\r\n        compliance_requirements: selectedCompliance,\r\n        quality_check_passed: qualityCheckPassed,\r\n      };\r\n\r\n      // Simulate API call\r\n      console.log('Submitting job work:', submitData);\r\n      message.success(mode === 'create' ? 'Job work created successfully' : 'Job work updated successfully');\r\n      onClose();\r\n      form.resetFields();\r\n      onSuccess?.();\r\n    } catch (error) {\r\n      message.error('Failed to save job work');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [jobRefId, priority, status, selectedCompliance, qualityCheckPassed, mode, onClose, onSuccess, form]);\r\n\r\n  // Toggle compliance requirement\r\n  const toggleCompliance = (requirement: string) => {\r\n    if (selectedCompliance.includes(requirement)) {\r\n      setSelectedCompliance(selectedCompliance.filter(c => c !== requirement));\r\n    } else {\r\n      setSelectedCompliance([...selectedCompliance, requirement]);\r\n    }\r\n  };\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>\r\n          <span>{mode === 'create' ? 'Create Job Work' : 'Edit Job Work'}</span>\r\n          {jobRefId && (\r\n            <Tag color=\"blue\" style={{ marginRight: 0 }}>\r\n              {jobRefId}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n      }\r\n      placement=\"right\"\r\n      onClose={onClose}\r\n      open={isOpen}\r\n      width={900}\r\n      styles={{ body: { padding: '24px' } }}\r\n      extra={\r\n        <Space>\r\n          <Button onClick={onClose}>Cancel</Button>\r\n          <Button type=\"primary\" onClick={() => form.submit()} loading={isSubmitting}>\r\n            {mode === 'create' ? 'Create' : 'Update'}\r\n          </Button>\r\n        </Space>\r\n      }\r\n    >\r\n      <Spin spinning={isSubmitting}>\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          initialValues={{\r\n            ...jobWork,\r\n            due_date: jobWork?.due_date ? dayjs(jobWork.due_date) : undefined,\r\n            started_at: jobWork?.started_at ? dayjs(jobWork.started_at) : undefined,\r\n            completed_at: jobWork?.completed_at ? dayjs(jobWork.completed_at) : undefined,\r\n          }}\r\n          onFinish={handleSubmit}\r\n          autoComplete=\"off\"\r\n        >\r\n          {/* ===== 1. JOB INFORMATION CARD ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <BugOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Job Information\r\n              </h3>\r\n            </div>\r\n\r\n            <Card size=\"small\" style={{ marginBottom: 16, backgroundColor: '#f9fafb' }}>\r\n              <Row gutter={16}>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic \r\n                    title=\"Job Reference ID\" \r\n                    value={jobRefId}\r\n                    prefix={<LinkOutlined />}\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic \r\n                    title=\"Status\" \r\n                    value={status?.toUpperCase()}\r\n                    valueStyle={{ color: '#1890ff' }}\r\n                  />\r\n                </Col>\r\n              </Row>\r\n            </Card>\r\n\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Customer ID\"\r\n                  name=\"customer_id\"\r\n                  rules={[{ required: true, message: 'Please select a customer' }]}\r\n                >\r\n                  <Select placeholder=\"Select customer\" />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Product ID\"\r\n                  name=\"product_id\"\r\n                  rules={[{ required: true, message: 'Please select a product' }]}\r\n                >\r\n                  <Select placeholder=\"Select product\" />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 2. PRIORITY & SLA CARD ===== */}\r\n          {slaDetails && (\r\n            <div style={{ marginBottom: 24 }}>\r\n              <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n                <ClockCircleOutlined style={{ marginRight: 8, fontSize: 18, color: '#dc2626' }} />\r\n                <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                  Priority & SLA\r\n                </h3>\r\n              </div>\r\n\r\n              <Row gutter={16} style={{ marginBottom: 16 }}>\r\n                <Col xs={24} sm={12}>\r\n                  <Form.Item\r\n                    label={<><WarningOutlined /> Priority Level</>}\r\n                    name=\"priority\"\r\n                    rules={[{ required: true, message: 'Please select priority' }]}\r\n                  >\r\n                    <Select\r\n                      placeholder=\"Select priority\"\r\n                      value={priority}\r\n                      onChange={setPriority}\r\n                      options={PRIORITY_CONFIG.map(p => ({\r\n                        label: `${p.icon} ${p.label}`,\r\n                        value: p.value,\r\n                      }))}\r\n                    />\r\n                  </Form.Item>\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <Form.Item\r\n                    label={<><FileOutlined /> Status</>}\r\n                    name=\"status\"\r\n                  >\r\n                    <Select\r\n                      placeholder=\"Select status\"\r\n                      value={status}\r\n                      onChange={setStatus}\r\n                      options={STATUS_CONFIG.map(s => ({\r\n                        label: `${s.icon} ${s.label}`,\r\n                        value: s.value,\r\n                      }))}\r\n                    />\r\n                  </Form.Item>\r\n                </Col>\r\n              </Row>\r\n\r\n              <Card\r\n                size=\"small\"\r\n                style={{\r\n                  marginBottom: 16,\r\n                  borderLeft: `4px solid #${slaDetails.priority.color === 'red' ? 'dc2626' : slaDetails.priority.color === 'warning' ? 'd97706' : '3b82f6'}`,\r\n                  backgroundColor: '#fef3c7',\r\n                }}\r\n              >\r\n                <Row gutter={16}>\r\n                  <Col xs={24} sm={12}>\r\n                    <Statistic\r\n                      title=\"Response Time\"\r\n                      value={slaDetails.priority.responseTime}\r\n                      prefix={<ThunderboltOutlined />}\r\n                      valueStyle={{ color: '#d97706' }}\r\n                    />\r\n                  </Col>\r\n                  <Col xs={24} sm={12}>\r\n                    <Statistic\r\n                      title=\"Turnaround Time\"\r\n                      value={`${slaDetails.priority.turnaroundDays} days`}\r\n                      prefix={<CheckCircleOutlined />}\r\n                      valueStyle={{ color: '#059669' }}\r\n                    />\r\n                  </Col>\r\n                </Row>\r\n              </Card>\r\n            </div>\r\n          )}\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 3. JOB SPECIFICATIONS ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <ToolOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Job Specifications\r\n              </h3>\r\n            </div>\r\n\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Pieces\"\r\n                  name=\"pieces\"\r\n                  rules={[{ required: true, message: 'Please enter number of pieces' }]}\r\n                >\r\n                  <InputNumber\r\n                    placeholder=\"Enter pieces\"\r\n                    min={1}\r\n                    value={pieces}\r\n                    onChange={setPieces}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Size Category\"\r\n                  name=\"size\"\r\n                  rules={[{ required: true, message: 'Please select size' }]}\r\n                >\r\n                  <Select\r\n                    placeholder=\"Select size\"\r\n                    value={size}\r\n                    onChange={setSize}\r\n                    options={SIZE_CATEGORIES.map(s => ({\r\n                      label: `${s.label} (${s.multiplier}x)`,\r\n                      value: s.value,\r\n                    }))}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 4. PRICING SECTION ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <CreditCardOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Pricing\r\n              </h3>\r\n            </div>\r\n\r\n            <Card size=\"small\" style={{ marginBottom: 16, backgroundColor: '#f0f9ff' }}>\r\n              <Row gutter={16}>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic\r\n                    title=\"Base Price\"\r\n                    value={`$${basePrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`}\r\n                    prefix={<CreditCardOutlined />}\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic\r\n                    title=\"Size Multiplier\"\r\n                    value={`${(calculatedPrice.sizeMultiplier * 100).toFixed(0)}%`}\r\n                    valueStyle={{ color: '#3b82f6' }}\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic\r\n                    title=\"Unit Price\"\r\n                    value={`$${calculatedPrice.effectiveUnitPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`}\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <Statistic\r\n                    title=\"Total Price\"\r\n                    value={calculatedPrice.formattedTotal}\r\n                    valueStyle={{ color: '#059669', fontWeight: 'bold' }}\r\n                  />\r\n                </Col>\r\n              </Row>\r\n            </Card>\r\n\r\n            <Form.Item\r\n              label=\"Base Price\"\r\n              name=\"base_price\"\r\n            >\r\n              <InputNumber\r\n                placeholder=\"Enter base price\"\r\n                min={0}\r\n                step={10}\r\n                value={basePrice}\r\n                onChange={setBasePrice}\r\n                formatter={(value) => `$${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\r\n                parser={(value) => parseInt(value?.replace(/\\$\\s?|(,*)/g, '') || '0')}\r\n              />\r\n            </Form.Item>\r\n\r\n            <Form.Item\r\n              label=\"Manual Price Override (Optional)\"\r\n              name=\"manual_price\"\r\n            >\r\n              <InputNumber\r\n                placeholder=\"Leave empty to use calculated price\"\r\n                min={0}\r\n                step={10}\r\n                formatter={(value) => `$${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\r\n                parser={(value) => parseInt(value?.replace(/\\$\\s?|(,*)/g, '') || '0')}\r\n              />\r\n            </Form.Item>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 5. ASSIGNMENT ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <TeamOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Engineer Assignment\r\n              </h3>\r\n            </div>\r\n\r\n            <Form.Item\r\n              label=\"Assigned Engineer\"\r\n              name=\"receiver_engineer_id\"\r\n              rules={[{ required: true, message: 'Please assign an engineer' }]}\r\n            >\r\n              <Select placeholder=\"Select engineer\" />\r\n            </Form.Item>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 6. TIMELINE ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <CalendarOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Timeline\r\n              </h3>\r\n            </div>\r\n\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Start Date\"\r\n                  name=\"started_at\"\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Due Date\"\r\n                  name=\"due_date\"\r\n                  rules={[{ required: true, message: 'Please set due date' }]}\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Estimated Completion\"\r\n                  name=\"estimated_completion\"\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Completion Date\"\r\n                  name=\"completed_at\"\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 7. DELIVERY ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <EnvironmentOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Delivery Information\r\n              </h3>\r\n            </div>\r\n\r\n            <Form.Item\r\n              label=\"Delivery Address\"\r\n              name=\"delivery_address\"\r\n            >\r\n              <Input.TextArea placeholder=\"Enter delivery address\" rows={2} />\r\n            </Form.Item>\r\n\r\n            <Form.Item\r\n              label=\"Delivery Instructions\"\r\n              name=\"delivery_instructions\"\r\n            >\r\n              <Input.TextArea placeholder=\"Enter special delivery instructions\" rows={2} />\r\n            </Form.Item>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 8. QUALITY & COMPLIANCE ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <FileOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Quality & Compliance\r\n              </h3>\r\n            </div>\r\n\r\n            <Card size=\"small\" style={{ marginBottom: 16, backgroundColor: '#f0fdf4' }}>\r\n              <Checkbox\r\n                checked={qualityCheckPassed}\r\n                onChange={(e) => setQualityCheckPassed(e.target.checked)}\r\n                style={{ marginBottom: 12 }}\r\n              >\r\n                <span style={{ fontWeight: 500 }}>Quality Check Passed</span>\r\n              </Checkbox>\r\n            </Card>\r\n\r\n            <Form.Item label=\"Quality Notes\" name=\"quality_notes\">\r\n              <Input.TextArea placeholder=\"Enter quality notes or findings\" rows={2} />\r\n            </Form.Item>\r\n\r\n            <div style={{ marginBottom: 16 }}>\r\n              <label style={{ display: 'block', marginBottom: 8, fontWeight: 500 }}>\r\n                Compliance Requirements\r\n              </label>\r\n              <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8 }}>\r\n                {COMPLIANCE_PRESETS.map(requirement => (\r\n                  <Tag\r\n                    key={requirement}\r\n                    color={selectedCompliance.includes(requirement) ? 'blue' : 'default'}\r\n                    onClick={() => toggleCompliance(requirement)}\r\n                    style={{ cursor: 'pointer', padding: '4px 12px' }}\r\n                  >\r\n                    {requirement}\r\n                  </Tag>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* ===== 9. COMMENTS & NOTES ===== */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', marginBottom: 16 }}>\r\n              <FileTextOutlined style={{ marginRight: 8, fontSize: 18 }} />\r\n              <h3 style={{ fontSize: 14, fontWeight: 600, margin: 0, color: '#111827' }}>\r\n                Comments & Notes\r\n              </h3>\r\n            </div>\r\n\r\n            <Form.Item label=\"Customer Comments\" name=\"comments\">\r\n              <Input.TextArea placeholder=\"Enter comments visible to customer\" rows={2} />\r\n            </Form.Item>\r\n\r\n            <Form.Item label=\"Internal Notes\" name=\"internal_notes\">\r\n              <Input.TextArea placeholder=\"Enter internal notes (not visible to customer)\" rows={2} />\r\n            </Form.Item>\r\n          </div>\r\n        </Form>\r\n      </Spin>\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\components\\JobWorksList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\hooks\\useJobWorks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":15,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":15,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * JobWorks Routes\r\n * Route definitions for the jobworks module\r\n */\r\n\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components for code splitting\r\nconst JobWorksPage = lazy(() => import('./views/JobWorksPage'));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading job works...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const jobWorksRoutes: RouteObject[] = [\r\n  {\r\n    path: 'job-works',\r\n    element: (\r\n      <RouteWrapper>\r\n        <JobWorksPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];\r\n\r\nexport default jobWorksRoutes;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\services\\jobWorksService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2228,2231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2228,2231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4042,4045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4042,4045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4382,4385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4382,4385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * JobWorks Service\r\n * Business logic for job work management\r\n * ‚ö†Ô∏è CRITICAL: Uses Service Factory Pattern for multi-backend routing\r\n * \r\n * This module delegates all job work operations through the centralized Service Factory\r\n * which routes requests to mock (development) or Supabase (production) based on VITE_API_MODE.\r\n * \r\n * See: /src/services/serviceFactory.ts for factory routing logic\r\n * \r\n * Module Distinction:\r\n * - This module manages JOB WORK entity and business logic\r\n * - NOT to be confused with other modules\r\n */\r\n\r\nimport { BaseService } from '@/modules/core/services/BaseService';\r\nimport { PaginatedResponse } from '@/modules/core/types';\r\nimport { jobWorkService as factoryJobWorkService } from '@/services/serviceFactory';\r\n\r\nexport interface JobWork {\r\n  id: string;\r\n  title: string;\r\n  description?: string;\r\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  priority: 'low' | 'medium' | 'high' | 'urgent';\r\n  customer_id: string;\r\n  customer_name?: string;\r\n  assigned_to?: string;\r\n  assigned_to_name?: string;\r\n  start_date?: string;\r\n  due_date?: string;\r\n  completion_date?: string;\r\n  estimated_hours?: number;\r\n  actual_hours?: number;\r\n  cost?: number;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface JobWorksFilters {\r\n  search?: string;\r\n  status?: string;\r\n  priority?: string;\r\n  assignedTo?: string;\r\n  customer?: string;\r\n  dateRange?: {\r\n    start: string;\r\n    end: string;\r\n  };\r\n  page?: number;\r\n  pageSize?: number;\r\n}\r\n\r\nexport interface CreateJobWorkData {\r\n  title: string;\r\n  description?: string;\r\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  priority: 'low' | 'medium' | 'high' | 'urgent';\r\n  customer_id: string;\r\n  assigned_to?: string;\r\n  start_date?: string;\r\n  due_date?: string;\r\n  estimated_hours?: number;\r\n  cost?: number;\r\n}\r\n\r\nexport class JobWorksService extends BaseService {\r\n  /**\r\n   * Get job works with filtering and pagination\r\n   */\r\n  async getJobWorks(filters: JobWorksFilters = {}): Promise<PaginatedResponse<JobWork>> {\r\n    try {\r\n      try {\r\n        // Use the legacy service to fetch real data\r\n        const jobWorks = await factoryJobWorkService.getJobWorks(filters as any);\r\n        \r\n        // Transform to paginated response\r\n        const { page = 1, pageSize = 20 } = filters;\r\n        const startIndex = (page - 1) * pageSize;\r\n        const endIndex = startIndex + pageSize;\r\n        const paginatedData = (Array.isArray(jobWorks) ? jobWorks : []).slice(startIndex, endIndex);\r\n        \r\n        return {\r\n          data: paginatedData,\r\n          total: Array.isArray(jobWorks) ? jobWorks.length : 0,\r\n          page,\r\n          pageSize,\r\n          totalPages: Math.ceil((Array.isArray(jobWorks) ? jobWorks.length : 0) / pageSize),\r\n        };\r\n      } catch (error) {\r\n        // Handle authentication/authorization errors gracefully\r\n        if (error instanceof Error && (error.message.includes('Unauthorized') || error.message.includes('Tenant context not initialized'))) {\r\n          // Return empty response instead of throwing\r\n          const { page = 1, pageSize = 20 } = filters;\r\n          console.warn('[JobWorksService] Auth error, returning empty response:', error.message);\r\n          return {\r\n            data: [],\r\n            total: 0,\r\n            page,\r\n            pageSize,\r\n            totalPages: 0,\r\n          };\r\n        }\r\n        throw error;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching job works:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a single job work by ID\r\n   */\r\n  async getJobWork(id: string): Promise<JobWork> {\r\n    try {\r\n      return await factoryJobWorkService.getJobWork(id);\r\n    } catch (error) {\r\n      this.handleError(`Failed to fetch job work ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new job work\r\n   */\r\n  async createJobWork(data: CreateJobWorkData): Promise<JobWork> {\r\n    try {\r\n      return await factoryJobWorkService.createJobWork(data as any);\r\n    } catch (error) {\r\n      this.handleError('Failed to create job work', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing job work\r\n   */\r\n  async updateJobWork(id: string, data: Partial<CreateJobWorkData>): Promise<JobWork> {\r\n    try {\r\n      return await factoryJobWorkService.updateJobWork(id, data as any);\r\n    } catch (error) {\r\n      this.handleError(`Failed to update job work ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a job work\r\n   */\r\n  async deleteJobWork(id: string): Promise<void> {\r\n    try {\r\n      await factoryJobWorkService.deleteJobWork(id);\r\n    } catch (error) {\r\n      this.handleError(`Failed to delete job work ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update job work status\r\n   */\r\n  async updateJobWorkStatus(id: string, status: string): Promise<JobWork> {\r\n    try {\r\n      const typedStatus = status as 'pending' | 'in_progress' | 'completed' | 'delivered' | 'cancelled';\r\n      return await this.updateJobWork(id, { status: typedStatus });\r\n    } catch (error) {\r\n      this.handleError(`Failed to update job work status for ${id}`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get job work statistics\r\n   */\r\n  async getJobWorkStats(): Promise<unknown> {\r\n    try {\r\n      const response = await this.getJobWorks({ pageSize: 1000 });\r\n      const jobWorks = response.data;\r\n\r\n      const stats = {\r\n        total: jobWorks.length,\r\n        byStatus: {} as Record<string, number>,\r\n        byPriority: {} as Record<string, number>,\r\n        totalCost: 0,\r\n        totalHours: 0,\r\n        completedThisMonth: 0,\r\n        overdueJobs: 0,\r\n      };\r\n\r\n      // If no job works returned (e.g., auth error), return empty stats\r\n      if (!jobWorks || jobWorks.length === 0) {\r\n        console.warn('[JobWorksService] No job works available for statistics calculation');\r\n        return stats;\r\n      }\r\n\r\n      const now = new Date();\r\n      const thisMonth = now.getMonth();\r\n      const thisYear = now.getFullYear();\r\n\r\n      jobWorks.forEach(job => {\r\n        // Status stats\r\n        stats.byStatus[job.status] = (stats.byStatus[job.status] || 0) + 1;\r\n        \r\n        // Priority stats\r\n        stats.byPriority[job.priority] = (stats.byPriority[job.priority] || 0) + 1;\r\n        \r\n        // Cost and hours\r\n        stats.totalCost += job.cost || 0;\r\n        stats.totalHours += job.actual_hours || job.estimated_hours || 0;\r\n        \r\n        // Completed this month\r\n        if (job.status === 'completed' && job.completion_date) {\r\n          const completionDate = new Date(job.completion_date);\r\n          if (completionDate.getMonth() === thisMonth && completionDate.getFullYear() === thisYear) {\r\n            stats.completedThisMonth++;\r\n          }\r\n        }\r\n        \r\n        // Overdue jobs\r\n        if (job.due_date && new Date(job.due_date) < now && job.status !== 'completed' && job.status !== 'cancelled') {\r\n          stats.overdueJobs++;\r\n        }\r\n      });\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      console.warn('[JobWorksService] Error fetching job work statistics, returning empty stats:', error);\r\n      // Return empty stats instead of throwing\r\n      return {\r\n        total: 0,\r\n        byStatus: {},\r\n        byPriority: {},\r\n        totalCost: 0,\r\n        totalHours: 0,\r\n        completedThisMonth: 0,\r\n        overdueJobs: 0,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get job work statuses\r\n   */\r\n  async getJobWorkStatuses(): Promise<string[]> {\r\n    return ['pending', 'in_progress', 'completed', 'cancelled'];\r\n  }\r\n\r\n  /**\r\n   * Get job work priorities\r\n   */\r\n  async getJobWorkPriorities(): Promise<string[]> {\r\n    return ['low', 'medium', 'high', 'urgent'];\r\n  }\r\n\r\n  /**\r\n   * Export job works\r\n   */\r\n  async exportJobWorks(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    try {\r\n      const response = await this.getJobWorks({ pageSize: 10000 });\r\n      const jobWorks = response.data;\r\n\r\n      if (format === 'json') {\r\n        return JSON.stringify(jobWorks, null, 2);\r\n      }\r\n\r\n      // CSV format\r\n      const headers = ['ID', 'Title', 'Status', 'Priority', 'Customer', 'Assigned To', 'Due Date', 'Cost'];\r\n      const rows = jobWorks.map(job => [\r\n        job.id,\r\n        job.title,\r\n        job.status,\r\n        job.priority,\r\n        job.customer_name || '',\r\n        job.assigned_to_name || '',\r\n        job.due_date || '',\r\n        job.cost || 0\r\n      ]);\r\n\r\n      const csv = [headers, ...rows]\r\n        .map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n        .join('\\r\\n');\r\n\r\n      return csv;\r\n    } catch (error) {\r\n      this.handleError('Failed to export job works', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\jobworks\\views\\JobWorksPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\components\\CompaniesDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\components\\CompaniesFormPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\components\\CompaniesList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\components\\ProductsDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\components\\ProductsFormPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\components\\ProductsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\hooks\\useCompanies.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\hooks\\useProducts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":16,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":16,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Masters Routes\r\n * Route definitions for the masters module\r\n */\r\n\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components for code splitting\r\nconst CompaniesPage = lazy(() => import('./views/CompaniesPage').then(m => ({ default: m.CompaniesPage })));\r\nconst ProductsPage = lazy(() => import('./views/ProductsPage').then(m => ({ default: m.ProductsPage })));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const mastersRoutes: RouteObject[] = [\r\n  {\r\n    path: 'masters',\r\n    children: [\r\n      {\r\n        path: 'companies',\r\n        element: (\r\n          <RouteWrapper>\r\n            <CompaniesPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'products',\r\n        element: (\r\n          <RouteWrapper>\r\n            <ProductsPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n];\r\n\r\nexport default mastersRoutes;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\services\\companyService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\services\\productService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\views\\CompaniesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\masters\\views\\ProductsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\notifications\\components\\NotificationDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\notifications\\components\\NotificationPreferencesPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\notifications\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\notifications\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":12,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":12,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Notifications Routes\r\n */\r\nimport React, { lazy } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\n\r\n// Lazy load components\r\nconst NotificationsPage = lazy(() => import('./views/NotificationsPage'));\r\n\r\n// Route wrapper with error boundary\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      {children}\r\n    </React.Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const notificationsRoutes: RouteObject[] = [\r\n  {\r\n    path: 'notifications',\r\n    element: (\r\n      <RouteWrapper>\r\n        <NotificationsPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\notifications\\views\\NotificationsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1347,1350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1347,1350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'notificationService'. Either include it or remove the dependency array.","line":109,"column":6,"nodeType":"ArrayExpression","endLine":109,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications, fetchPreferences, notificationService]","fix":{"range":[3457,3495],"text":"[fetchNotifications, fetchPreferences, notificationService]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Notifications Page - Enterprise Design\r\n * Manage user notifications with real-time updates\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  List, \r\n  Button, \r\n  Input, \r\n  Select, \r\n  Tag, \r\n  Space, \r\n  Badge,\r\n  Modal,\r\n  Empty,\r\n  message,\r\n  Tooltip\r\n} from 'antd';\r\nimport { \r\n  SearchOutlined, \r\n  BellOutlined,\r\n  CheckOutlined,\r\n  DeleteOutlined,\r\n  SettingOutlined,\r\n  MailOutlined,\r\n  MessageOutlined,\r\n  MobileOutlined,\r\n  EyeOutlined,\r\n  CloseCircleOutlined\r\n} from '@ant-design/icons';\r\nimport { \r\n  Bell,\r\n  CheckCircle,\r\n  AlertTriangle,\r\n  Info,\r\n  XCircle\r\n} from 'lucide-react';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport type { Notification, NotificationPreferences } from '@/services/uiNotificationService';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { NotificationDetailPanel } from '../components/NotificationDetailPanel';\r\nimport { NotificationPreferencesPanel } from '../components/NotificationPreferencesPanel';\r\n\r\ninterface NotificationFilters {\r\n  search?: string;\r\n  is_read?: boolean;\r\n  category?: string;\r\n}\r\n\r\nexport const NotificationsPage: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const notificationService = useService<any>('notificationService');\r\n  const [notifications, setNotifications] = useState<Notification[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterRead, setFilterRead] = useState<string>('all');\r\n  const [filterCategory, setFilterCategory] = useState<string>('all');\r\n  const [drawerMode, setDrawerMode] = useState<'details' | 'preferences' | null>(null);\r\n  const [preferences, setPreferences] = useState<NotificationPreferences | null>(null);\r\n  const [selectedNotification, setSelectedNotification] = useState<Notification | null>(null);\r\n\r\n  const fetchNotifications = useCallback(async (): Promise<void> => {\r\n    try {\r\n      setLoading(true);\r\n      const filters: NotificationFilters = {};\r\n      \r\n      if (searchTerm) filters.search = searchTerm;\r\n      if (filterRead !== 'all') filters.is_read = filterRead === 'read';\r\n      if (filterCategory !== 'all') filters.category = filterCategory;\r\n\r\n      const data = await notificationService.getNotifications(filters);\r\n      setNotifications(data);\r\n    } catch (error: unknown) {\r\n      console.error('Failed to fetch notifications:', error);\r\n      message.error('Failed to fetch notifications');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [searchTerm, filterRead, filterCategory, notificationService]);\r\n\r\n  const fetchPreferences = useCallback(async (): Promise<void> => {\r\n    try {\r\n      const prefs = await notificationService.getNotificationPreferences();\r\n      setPreferences(prefs);\r\n    } catch (error: unknown) {\r\n      console.error('Failed to fetch preferences:', error);\r\n    }\r\n  }, [notificationService]);\r\n\r\n  useEffect(() => {\r\n    void fetchNotifications();\r\n    void fetchPreferences();\r\n\r\n    // Subscribe to real-time notifications\r\n    const unsubscribe = notificationService.subscribeToNotifications((notification: Notification) => {\r\n      message.info({\r\n        content: notification.title,\r\n        duration: 3\r\n      });\r\n      setNotifications(prev => [notification, ...prev]);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [fetchNotifications, fetchPreferences]);\r\n\r\n  useEffect(() => {\r\n    void fetchNotifications();\r\n  }, [fetchNotifications]);\r\n\r\n  const handleMarkAsRead = async (id: string): Promise<void> => {\r\n    try {\r\n      await notificationService.markAsRead(id);\r\n      message.success('Marked as read');\r\n      void fetchNotifications();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to mark as read';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleMarkAsUnread = async (id: string): Promise<void> => {\r\n    try {\r\n      // Note: markAsUnread not yet implemented in service\r\n      // await notificationService.markAsUnread(id);\r\n      message.success('Marked as unread');\r\n      void fetchNotifications();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to mark as unread';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleMarkAllAsRead = async (): Promise<void> => {\r\n    try {\r\n      await notificationService.markAllAsRead();\r\n      message.success('All notifications marked as read');\r\n      void fetchNotifications();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to mark all as read';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string): Promise<void> => {\r\n    Modal.confirm({\r\n      title: 'Delete Notification',\r\n      content: 'Are you sure you want to delete this notification?',\r\n      okText: 'Delete',\r\n      okType: 'danger',\r\n      onOk: async () => {\r\n        try {\r\n          await notificationService.deleteNotification(id);\r\n          message.success('Notification deleted');\r\n          void fetchNotifications();\r\n        } catch (error: unknown) {\r\n          const errorMessage = error instanceof Error ? error.message : 'Failed to delete notification';\r\n          message.error(errorMessage);\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleDeleteAllRead = async (): Promise<void> => {\r\n    Modal.confirm({\r\n      title: 'Delete All Read Notifications',\r\n      content: 'Are you sure you want to delete all read notifications?',\r\n      okText: 'Delete',\r\n      okType: 'danger',\r\n      onOk: async () => {\r\n        try {\r\n          await notificationService.clearAllNotifications();\r\n          message.success('All read notifications deleted');\r\n          void fetchNotifications();\r\n        } catch (error: unknown) {\r\n          const errorMessage = error instanceof Error ? error.message : 'Failed to delete notifications';\r\n          message.error(errorMessage);\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleSavePreferences = async (values: NotificationPreferences): Promise<void> => {\r\n    try {\r\n      await notificationService.updateNotificationPreferences(values);\r\n      message.success('Preferences saved successfully');\r\n      setDrawerMode(null);\r\n      void fetchPreferences();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to save preferences';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleViewDetails = (notification: Notification) => {\r\n    setSelectedNotification(notification);\r\n    setDrawerMode('details');\r\n    if (!notification.is_read) {\r\n      void handleMarkAsRead(notification.id);\r\n    }\r\n  };\r\n\r\n  const closeDrawer = () => {\r\n    setDrawerMode(null);\r\n    setSelectedNotification(null);\r\n  };\r\n\r\n  const getNotificationIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'success':\r\n        return <CheckCircle size={20} color=\"#52c41a\" />;\r\n      case 'warning':\r\n        return <AlertTriangle size={20} color=\"#faad14\" />;\r\n      case 'error':\r\n        return <XCircle size={20} color=\"#ff4d4f\" />;\r\n      default:\r\n        return <Info size={20} color=\"#1890ff\" />;\r\n    }\r\n  };\r\n\r\n  const getNotificationColor = (type: string) => {\r\n    switch (type) {\r\n      case 'success':\r\n        return 'success';\r\n      case 'warning':\r\n        return 'warning';\r\n      case 'error':\r\n        return 'error';\r\n      default:\r\n        return 'processing';\r\n    }\r\n  };\r\n\r\n  const getCategoryColor = (category: string) => {\r\n    switch (category) {\r\n      case 'system':\r\n        return 'blue';\r\n      case 'user':\r\n        return 'green';\r\n      case 'alert':\r\n        return 'red';\r\n      case 'reminder':\r\n        return 'orange';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  const getTimeAgo = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);\r\n\r\n    if (seconds < 60) return 'Just now';\r\n    if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;\r\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;\r\n    if (seconds < 604800) return `${Math.floor(seconds / 86400)} days ago`;\r\n    return date.toLocaleDateString();\r\n  };\r\n\r\n  const stats = {\r\n    total: notifications.length,\r\n    unread: notifications.filter(n => !n.is_read).length,\r\n    alerts: notifications.filter(n => n.category === 'alert' && !n.is_read).length,\r\n    today: notifications.filter(n => {\r\n      const notifDate = new Date(n.created_at);\r\n      const today = new Date();\r\n      return notifDate.toDateString() === today.toDateString();\r\n    }).length\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Notifications\"\r\n        description=\"View and manage your notifications\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/dashboard' },\r\n            { title: 'Notifications' }\r\n          ]\r\n        }}\r\n        extra={\r\n          <Space>\r\n            <Button \r\n              icon={<CheckOutlined />} \r\n              onClick={handleMarkAllAsRead}\r\n              disabled={stats.unread === 0}\r\n            >\r\n              Mark All Read\r\n            </Button>\r\n            <Button \r\n              icon={<DeleteOutlined />} \r\n              onClick={handleDeleteAllRead}\r\n            >\r\n              Delete Read\r\n            </Button>\r\n            <Button \r\n              icon={<SettingOutlined />} \r\n              onClick={() => setDrawerMode('preferences')}\r\n            >\r\n              Preferences\r\n            </Button>\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Notifications\"\r\n              value={stats.total}\r\n              description=\"All notifications\"\r\n              icon={Bell}\r\n              color=\"primary\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Unread\"\r\n              value={stats.unread}\r\n              description=\"Unread notifications\"\r\n              icon={Bell}\r\n              color=\"warning\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Alerts\"\r\n              value={stats.alerts}\r\n              description=\"Unread alerts\"\r\n              icon={AlertTriangle}\r\n              color=\"danger\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Today\"\r\n              value={stats.today}\r\n              description=\"Notifications today\"\r\n              icon={Bell}\r\n              color=\"info\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Row gutter={16}>\r\n            <Col xs={24} md={8}>\r\n              <Input\r\n                placeholder=\"Search notifications...\"\r\n                prefix={<SearchOutlined />}\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                allowClear\r\n              />\r\n            </Col>\r\n            <Col xs={24} md={8}>\r\n              <Select\r\n                placeholder=\"Filter by status\"\r\n                value={filterRead}\r\n                onChange={setFilterRead}\r\n                style={{ width: '100%' }}\r\n              >\r\n                <Select.Option value=\"all\">All Notifications</Select.Option>\r\n                <Select.Option value=\"unread\">Unread Only</Select.Option>\r\n                <Select.Option value=\"read\">Read Only</Select.Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} md={8}>\r\n              <Select\r\n                placeholder=\"Filter by category\"\r\n                value={filterCategory}\r\n                onChange={setFilterCategory}\r\n                style={{ width: '100%' }}\r\n              >\r\n                <Select.Option value=\"all\">All Categories</Select.Option>\r\n                <Select.Option value=\"system\">System</Select.Option>\r\n                <Select.Option value=\"user\">User</Select.Option>\r\n                <Select.Option value=\"alert\">Alert</Select.Option>\r\n                <Select.Option value=\"reminder\">Reminder</Select.Option>\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Notifications List */}\r\n        <Card>\r\n          <List\r\n            loading={loading}\r\n            dataSource={notifications}\r\n            locale={{\r\n              emptyText: (\r\n                <Empty\r\n                  image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                  description=\"No notifications found\"\r\n                />\r\n              )\r\n            }}\r\n            renderItem={(notification) => (\r\n              <List.Item\r\n                key={notification.id}\r\n                style={{\r\n                  background: notification.is_read ? 'transparent' : '#f0f5ff',\r\n                  padding: '16px',\r\n                  marginBottom: '8px',\r\n                  borderRadius: '4px',\r\n                  cursor: 'pointer'\r\n                }}\r\n                onClick={() => handleViewDetails(notification)}\r\n                actions={[\r\n                  <Tooltip title={notification.is_read ? 'Mark as unread' : 'Mark as read'}>\r\n                    <Button\r\n                      type=\"text\"\r\n                      size=\"small\"\r\n                      icon={notification.is_read ? <CloseCircleOutlined /> : <CheckOutlined />}\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        if (notification.is_read) {\r\n                          handleMarkAsUnread(notification.id);\r\n                        } else {\r\n                          handleMarkAsRead(notification.id);\r\n                        }\r\n                      }}\r\n                    />\r\n                  </Tooltip>,\r\n                  <Tooltip title=\"Delete\">\r\n                    <Button\r\n                      type=\"text\"\r\n                      size=\"small\"\r\n                      danger\r\n                      icon={<DeleteOutlined />}\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        handleDelete(notification.id);\r\n                      }}\r\n                    />\r\n                  </Tooltip>\r\n                ]}\r\n              >\r\n                <List.Item.Meta\r\n                  avatar={\r\n                    <Badge dot={!notification.is_read} color=\"blue\">\r\n                      {getNotificationIcon(notification.type)}\r\n                    </Badge>\r\n                  }\r\n                  title={\r\n                    <Space>\r\n                      <span style={{ fontWeight: notification.is_read ? 'normal' : 'bold' }}>\r\n                        {notification.title}\r\n                      </span>\r\n                      <Tag color={getCategoryColor(notification.category)}>\r\n                        {notification.category.toUpperCase()}\r\n                      </Tag>\r\n                    </Space>\r\n                  }\r\n                  description={\r\n                    <Space direction=\"vertical\" size={4} style={{ width: '100%' }}>\r\n                      <span>{notification.message}</span>\r\n                      <span style={{ fontSize: '12px', color: '#8c8c8c' }}>\r\n                        {getTimeAgo(notification.created_at)}\r\n                      </span>\r\n                    </Space>\r\n                  }\r\n                />\r\n              </List.Item>\r\n            )}\r\n            pagination={{\r\n              pageSize: 10,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} notifications`\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Detail Drawer */}\r\n      <NotificationDetailPanel\r\n        notification={selectedNotification}\r\n        open={drawerMode === 'details'}\r\n        onClose={closeDrawer}\r\n        onMarkAsRead={handleMarkAsRead}\r\n        onDelete={handleDelete}\r\n      />\r\n\r\n      {/* Preferences Drawer */}\r\n      <NotificationPreferencesPanel\r\n        open={drawerMode === 'preferences'}\r\n        onClose={closeDrawer}\r\n        preferences={preferences}\r\n        onSaved={fetchPreferences}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default NotificationsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\pdf-templates\\components\\PDFTemplateDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\pdf-templates\\components\\PDFTemplateFormPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\pdf-templates\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\pdf-templates\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":12,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":12,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PDF Templates Routes\r\n */\r\nimport React, { lazy } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\n\r\n// Lazy load components\r\nconst PDFTemplatesPage = lazy(() => import('./views/PDFTemplatesPage'));\r\n\r\n// Route wrapper with error boundary\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      {children}\r\n    </React.Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const pdfTemplatesRoutes: RouteObject[] = [\r\n  {\r\n    path: 'pdf-templates',\r\n    element: (\r\n      <RouteWrapper>\r\n        <PDFTemplatesPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\pdf-templates\\views\\PDFTemplatesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1594,1597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1594,1597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'pdfTemplateService'. Either include it or remove the dependency array.","line":93,"column":6,"nodeType":"ArrayExpression","endLine":93,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [searchTerm, categoryFilter, pdfTemplateService]","fix":{"range":[2720,2748],"text":"[searchTerm, categoryFilter, pdfTemplateService]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PDF Templates Page - Enterprise Design\r\n * Manage PDF templates for invoices, contracts, reports, etc.\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Table, \r\n  Button, \r\n  Input, \r\n  Select, \r\n  Modal, \r\n  Tag, \r\n  Space, \r\n  Dropdown, \r\n  Tabs,\r\n  message,\r\n  Upload,\r\n  Badge\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport type { MenuProps, FormInstance } from 'antd';\r\nimport { \r\n  PlusOutlined, \r\n  SearchOutlined, \r\n  MoreOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  EyeOutlined,\r\n  CopyOutlined,\r\n  DownloadOutlined,\r\n  UploadOutlined,\r\n  StarOutlined,\r\n  StarFilled,\r\n  FileTextOutlined\r\n} from '@ant-design/icons';\r\nimport { \r\n  FileText,\r\n  FileCheck,\r\n  FileSpreadsheet,\r\n  Mail\r\n} from 'lucide-react';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport type { PDFTemplate } from '@/services/pdfTemplateService';\r\nimport { PDFTemplateDetailPanel } from '../components/PDFTemplateDetailPanel';\r\nimport { PDFTemplateFormPanel } from '../components/PDFTemplateFormPanel';\r\n\r\nconst { TextArea } = Input;\r\n\r\n// Form values interface for PDF templates\r\ninterface TemplateFormValues {\r\n  name: string;\r\n  category: string;\r\n  description: string;\r\n  content: string;\r\n  variables: string;\r\n  is_active?: boolean;\r\n}\r\n\r\nexport const PDFTemplatesPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const pdfTemplateService = useService<any>('pdfTemplateService');\r\n  const [templates, setTemplates] = useState<PDFTemplate[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [categoryFilter, setCategoryFilter] = useState<string>('all');\r\n  const [drawerMode, setDrawerMode] = useState<'create' | 'edit' | 'view' | null>(null);\r\n  const [selectedTemplate, setSelectedTemplate] = useState<PDFTemplate | null>(null);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [previewHtml, setPreviewHtml] = useState('');\r\n\r\n  const fetchTemplates = useCallback(async (): Promise<void> => {\r\n    try {\r\n      setLoading(true);\r\n      const filters: Record<string, string> = {};\r\n      \r\n      if (searchTerm) filters.search = searchTerm;\r\n      if (categoryFilter !== 'all') filters.category = categoryFilter;\r\n\r\n      const data = await pdfTemplateService.getTemplates(filters);\r\n      setTemplates(data);\r\n    } catch (error) {\r\n      console.error('Failed to fetch templates:', error);\r\n      message.error('Failed to fetch templates');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [searchTerm, categoryFilter]);\r\n\r\n  useEffect(() => {\r\n    fetchTemplates();\r\n  }, [fetchTemplates]);\r\n\r\n  const closeDrawer = () => {\r\n    setDrawerMode(null);\r\n    setSelectedTemplate(null);\r\n  };\r\n\r\n  const handleOpenCreate = () => {\r\n    setSelectedTemplate(null);\r\n    setDrawerMode('create');\r\n  };\r\n\r\n  const handleOpenEdit = (template: PDFTemplate) => {\r\n    setSelectedTemplate(template);\r\n    setDrawerMode('edit');\r\n  };\r\n\r\n  const handleOpenView = (template: PDFTemplate) => {\r\n    setSelectedTemplate(template);\r\n    setDrawerMode('view');\r\n  };\r\n\r\n  const handleFormSave = async (values: TemplateFormValues): Promise<void> => {\r\n    try {\r\n      setIsSaving(true);\r\n      \r\n      if (drawerMode === 'create') {\r\n        await pdfTemplateService.createTemplate({\r\n          name: values.name,\r\n          category: values.category,\r\n          description: values.description,\r\n          content: values.content,\r\n          variables: values.variables?.split(',').map((v: string) => v.trim()) || [],\r\n          is_default: false,\r\n          is_active: true,\r\n          created_by: 'current_user'\r\n        });\r\n        message.success('Template created successfully');\r\n      } else if (drawerMode === 'edit' && selectedTemplate) {\r\n        await pdfTemplateService.updateTemplate(selectedTemplate.id, {\r\n          name: values.name,\r\n          category: values.category,\r\n          description: values.description,\r\n          content: values.content,\r\n          variables: values.variables?.split(',').map((v: string) => v.trim()) || [],\r\n          is_active: values.is_active\r\n        });\r\n        message.success('Template updated successfully');\r\n      }\r\n      \r\n      closeDrawer();\r\n      fetchTemplates();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to save template';\r\n      message.error(errorMessage);\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (template: PDFTemplate): Promise<void> => {\r\n    Modal.confirm({\r\n      title: 'Delete Template',\r\n      content: `Are you sure you want to delete \"${template.name}\"?`,\r\n      okText: 'Delete',\r\n      okType: 'danger',\r\n      onOk: async () => {\r\n        try {\r\n          await pdfTemplateService.deleteTemplate(template.id);\r\n          message.success('Template deleted successfully');\r\n          fetchTemplates();\r\n        } catch (error: unknown) {\r\n          const errorMessage = error instanceof Error ? error.message : 'Failed to delete template';\r\n          message.error(errorMessage);\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleDuplicate = async (template: PDFTemplate): Promise<void> => {\r\n    try {\r\n      await pdfTemplateService.duplicateTemplate(template.id);\r\n      message.success('Template duplicated successfully');\r\n      fetchTemplates();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to duplicate template';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleSetDefault = async (template: PDFTemplate): Promise<void> => {\r\n    try {\r\n      await pdfTemplateService.setDefaultTemplate(template.id, template.category);\r\n      message.success('Default template updated');\r\n      fetchTemplates();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to set default template';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handlePreview = async (template: PDFTemplate): Promise<void> => {\r\n    try {\r\n      // Create sample data for preview\r\n      const sampleData: Record<string, string> = {};\r\n      template.variables.forEach((variable: string) => {\r\n        sampleData[variable] = `[${variable}]`;\r\n      });\r\n\r\n      const html = await pdfTemplateService.previewTemplate(template.id, sampleData);\r\n      setPreviewHtml(html);\r\n      setSelectedTemplate(template);\r\n      setShowPreviewModal(true);\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to preview template';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleExport = async (template: PDFTemplate): Promise<void> => {\r\n    try {\r\n      const blob = await pdfTemplateService.exportTemplate(template.id);\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `${template.name.replace(/\\s+/g, '_')}.json`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n      message.success('Template exported successfully');\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to export template';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  const handleImport = async (file: File): Promise<boolean> => {\r\n    try {\r\n      await pdfTemplateService.importTemplate(file);\r\n      message.success('Template imported successfully');\r\n      fetchTemplates();\r\n      return false; // Prevent default upload behavior\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to import template';\r\n      message.error(errorMessage);\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const getActionMenu = (template: PDFTemplate): MenuProps => ({\r\n    items: [\r\n      {\r\n        key: 'view',\r\n        label: 'View Details',\r\n        icon: <EyeOutlined />,\r\n        onClick: () => handleOpenView(template)\r\n      },\r\n      {\r\n        key: 'preview',\r\n        label: 'Preview',\r\n        icon: <FileTextOutlined />,\r\n        onClick: () => handlePreview(template)\r\n      },\r\n      {\r\n        key: 'edit',\r\n        label: 'Edit',\r\n        icon: <EditOutlined />,\r\n        onClick: () => handleOpenEdit(template),\r\n        disabled: !hasPermission('manage_templates')\r\n      },\r\n      {\r\n        key: 'duplicate',\r\n        label: 'Duplicate',\r\n        icon: <CopyOutlined />,\r\n        onClick: () => handleDuplicate(template)\r\n      },\r\n      {\r\n        key: 'default',\r\n        label: template.is_default ? 'Default Template' : 'Set as Default',\r\n        icon: template.is_default ? <StarFilled /> : <StarOutlined />,\r\n        onClick: () => handleSetDefault(template),\r\n        disabled: template.is_default || !hasPermission('manage_templates')\r\n      },\r\n      {\r\n        key: 'export',\r\n        label: 'Export',\r\n        icon: <DownloadOutlined />,\r\n        onClick: () => handleExport(template)\r\n      },\r\n      {\r\n        type: 'divider'\r\n      },\r\n      {\r\n        key: 'delete',\r\n        label: 'Delete',\r\n        icon: <DeleteOutlined />,\r\n        danger: true,\r\n        onClick: () => handleDelete(template),\r\n        disabled: template.is_default || !hasPermission('manage_templates')\r\n      }\r\n    ]\r\n  });\r\n\r\n  const getCategoryIcon = (category: string) => {\r\n    switch (category) {\r\n      case 'invoice':\r\n        return <FileText size={16} />;\r\n      case 'contract':\r\n        return <FileCheck size={16} />;\r\n      case 'report':\r\n        return <FileSpreadsheet size={16} />;\r\n      case 'letter':\r\n        return <Mail size={16} />;\r\n      default:\r\n        return <FileText size={16} />;\r\n    }\r\n  };\r\n\r\n  const getCategoryColor = (category: string) => {\r\n    switch (category) {\r\n      case 'invoice':\r\n        return 'blue';\r\n      case 'contract':\r\n        return 'green';\r\n      case 'report':\r\n        return 'orange';\r\n      case 'letter':\r\n        return 'purple';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  const columns: ColumnsType<PDFTemplate> = [\r\n    {\r\n      title: 'Template Name',\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n      render: (text, record) => (\r\n        <Space>\r\n          {getCategoryIcon(record.category)}\r\n          <span style={{ fontWeight: 500 }}>{text}</span>\r\n          {record.is_default && (\r\n            <StarFilled style={{ color: '#faad14', fontSize: 14 }} />\r\n          )}\r\n        </Space>\r\n      )\r\n    },\r\n    {\r\n      title: 'Category',\r\n      dataIndex: 'category',\r\n      key: 'category',\r\n      render: (category) => (\r\n        <Tag color={getCategoryColor(category)}>\r\n          {category.toUpperCase()}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Description',\r\n      dataIndex: 'description',\r\n      key: 'description',\r\n      ellipsis: true\r\n    },\r\n    {\r\n      title: 'Variables',\r\n      dataIndex: 'variables',\r\n      key: 'variables',\r\n      render: (variables: string[]) => (\r\n        <Badge count={variables.length} showZero color=\"#1890ff\" />\r\n      )\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'is_active',\r\n      key: 'is_active',\r\n      render: (is_active) => (\r\n        <Tag color={is_active ? 'success' : 'default'}>\r\n          {is_active ? 'Active' : 'Inactive'}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Updated',\r\n      dataIndex: 'updated_at',\r\n      key: 'updated_at',\r\n      render: (date) => new Date(date).toLocaleDateString()\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      width: 100,\r\n      render: (_, record) => (\r\n        <Dropdown menu={getActionMenu(record)} trigger={['click']}>\r\n          <Button type=\"text\" icon={<MoreOutlined />} />\r\n        </Dropdown>\r\n      )\r\n    }\r\n  ];\r\n\r\n  const stats = {\r\n    total: templates.length,\r\n    invoice: templates.filter(t => t.category === 'invoice').length,\r\n    contract: templates.filter(t => t.category === 'contract').length,\r\n    report: templates.filter(t => t.category === 'report').length\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"PDF Templates\"\r\n        description=\"Manage PDF templates for invoices, contracts, and reports\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/dashboard' },\r\n            { title: 'Configuration', path: '/tenant-configuration' },\r\n            { title: 'PDF Templates' }\r\n          ]\r\n        }}\r\n        extra={\r\n          <Space>\r\n            <Upload\r\n              accept=\".json\"\r\n              showUploadList={false}\r\n              beforeUpload={handleImport}\r\n            >\r\n              <Button icon={<UploadOutlined />}>\r\n                Import Template\r\n              </Button>\r\n            </Upload>\r\n            <Button \r\n              type=\"primary\" \r\n              icon={<PlusOutlined />} \r\n              onClick={handleOpenCreate}\r\n              disabled={!hasPermission('manage_templates')}\r\n            >\r\n              New Template\r\n            </Button>\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Templates\"\r\n              value={stats.total}\r\n              description=\"All PDF templates\"\r\n              icon={FileText}\r\n              color=\"primary\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Invoice Templates\"\r\n              value={stats.invoice}\r\n              description=\"Invoice templates\"\r\n              icon={FileText}\r\n              color=\"info\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Contract Templates\"\r\n              value={stats.contract}\r\n              description=\"Contract templates\"\r\n              icon={FileCheck}\r\n              color=\"success\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Report Templates\"\r\n              value={stats.report}\r\n              description=\"Report templates\"\r\n              icon={FileSpreadsheet}\r\n              color=\"warning\"\r\n              loading={loading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Row gutter={16}>\r\n            <Col xs={24} md={12}>\r\n              <Input\r\n                placeholder=\"Search templates...\"\r\n                prefix={<SearchOutlined />}\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                allowClear\r\n              />\r\n            </Col>\r\n            <Col xs={24} md={12}>\r\n              <Select\r\n                placeholder=\"Filter by category\"\r\n                value={categoryFilter}\r\n                onChange={setCategoryFilter}\r\n                style={{ width: '100%' }}\r\n              >\r\n                <Select.Option value=\"all\">All Categories</Select.Option>\r\n                <Select.Option value=\"invoice\">Invoice</Select.Option>\r\n                <Select.Option value=\"contract\">Contract</Select.Option>\r\n                <Select.Option value=\"report\">Report</Select.Option>\r\n                <Select.Option value=\"letter\">Letter</Select.Option>\r\n                <Select.Option value=\"other\">Other</Select.Option>\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Templates Table */}\r\n        <Card>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={templates}\r\n            rowKey=\"id\"\r\n            loading={loading}\r\n            pagination={{\r\n              pageSize: 10,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} templates`\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* PDF Template Detail Drawer */}\r\n      {drawerMode === 'view' && selectedTemplate && (\r\n        <PDFTemplateDetailPanel\r\n          template={selectedTemplate}\r\n          open={true}\r\n          onClose={closeDrawer}\r\n          onEdit={handleOpenEdit}\r\n        />\r\n      )}\r\n\r\n      {/* PDF Template Form Drawer - Create/Edit */}\r\n      {(drawerMode === 'create' || drawerMode === 'edit') && (\r\n        <PDFTemplateFormPanel\r\n          open={true}\r\n          mode={drawerMode}\r\n          template={selectedTemplate}\r\n          onClose={closeDrawer}\r\n          onSave={handleFormSave}\r\n          loading={isSaving}\r\n        />\r\n      )}\r\n\r\n      {/* Preview Modal - Keep for preview functionality */}\r\n      <Modal\r\n        title={`Preview: ${selectedTemplate?.name}`}\r\n        open={previewHtml !== ''}\r\n        onCancel={() => {\r\n          setPreviewHtml('');\r\n          setSelectedTemplate(null);\r\n        }}\r\n        footer={[\r\n          <Button key=\"close\" onClick={() => setPreviewHtml('')}>\r\n            Close\r\n          </Button>\r\n        ]}\r\n        width={900}\r\n      >\r\n        <div \r\n          style={{ \r\n            border: '1px solid #d9d9d9', \r\n            padding: 16, \r\n            borderRadius: 4,\r\n            maxHeight: 600,\r\n            overflow: 'auto'\r\n          }}\r\n          dangerouslySetInnerHTML={{ __html: previewHtml }}\r\n        />\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PDFTemplatesPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\__tests__\\mockData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\AdvancedFiltersModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1950,1953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1950,1953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2241,2244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2241,2244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Advanced Filters Modal for Product Sales\r\n * Provides comprehensive filtering and preset management\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n  Modal,\r\n  Form,\r\n  Select,\r\n  DatePicker,\r\n  Slider,\r\n  Button,\r\n  Space,\r\n  message,\r\n  Input,\r\n  Tag,\r\n  Row,\r\n  Col,\r\n  Divider,\r\n} from 'antd';\r\nimport { DeleteOutlined, SaveOutlined } from '@ant-design/icons';\r\nimport dayjs, { Dayjs } from 'dayjs';\r\nimport { ProductSaleFilters, PRODUCT_SALE_STATUSES } from '@/types/productSales';\r\nimport { useService } from '@/hooks/useService';\r\n\r\nconst { RangePicker } = DatePicker;\r\n\r\ninterface AdvancedFiltersModalProps {\r\n  visible: boolean;\r\n  filters: ProductSaleFilters;\r\n  onApply: (filters: ProductSaleFilters) => void;\r\n  onClose: () => void;\r\n}\r\n\r\ninterface FilterPreset {\r\n  name: string;\r\n  filters: ProductSaleFilters;\r\n  createdAt: string;\r\n}\r\n\r\nexport const AdvancedFiltersModal: React.FC<AdvancedFiltersModalProps> = ({\r\n  visible,\r\n  filters,\r\n  onApply,\r\n  onClose,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [priceRange, setPriceRange] = useState<[number, number]>([0, 1000000]);\r\n  const [presets, setPresets] = useState<FilterPreset[]>([]);\r\n  const [presetName, setPresetName] = useState('');\r\n  const [customers, setCustomers] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [products, setProducts] = useState<Array<{ id: string; name: string }>>([]);\r\n\r\n  const customerService = useService('customerService');\r\n  const productService = useService('productService');\r\n\r\n  // Load customers and products\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      try {\r\n        const [customersList, productsList] = await Promise.all([\r\n          customerService.getCustomers?.(),\r\n          productService.getProducts?.(),\r\n        ]);\r\n\r\n        if (customersList) {\r\n          setCustomers(\r\n            Array.isArray(customersList)\r\n              ? customersList.map((c: any) => ({\r\n                  id: c.id,\r\n                  name: c.company_name || c.name,\r\n                }))\r\n              : []\r\n          );\r\n        }\r\n\r\n        if (productsList) {\r\n          setProducts(\r\n            Array.isArray(productsList)\r\n              ? productsList.map((p: any) => ({\r\n                  id: p.id,\r\n                  name: p.name,\r\n                }))\r\n              : []\r\n          );\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading filter data:', error);\r\n      }\r\n    };\r\n\r\n    if (visible) {\r\n      loadData();\r\n    }\r\n  }, [visible, customerService, productService]);\r\n\r\n  // Load presets from localStorage\r\n  useEffect(() => {\r\n    const savedPresets = localStorage.getItem('productSalesFilterPresets');\r\n    if (savedPresets) {\r\n      try {\r\n        setPresets(JSON.parse(savedPresets));\r\n      } catch (error) {\r\n        console.error('Error loading presets:', error);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Initialize form with current filters\r\n  useEffect(() => {\r\n    if (visible && filters) {\r\n      form.setFieldsValue({\r\n        status: filters.status,\r\n        customer_id: filters.customer_id,\r\n        product_id: filters.product_id,\r\n        dateRange: filters.start_date && filters.end_date \r\n          ? [dayjs(filters.start_date), dayjs(filters.end_date)]\r\n          : undefined,\r\n        warranty_status: filters.warranty_status,\r\n      });\r\n\r\n      if (filters.min_price && filters.max_price) {\r\n        setPriceRange([filters.min_price, filters.max_price]);\r\n      }\r\n    }\r\n  }, [visible, filters, form]);\r\n\r\n  const handleApplyFilters = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      \r\n      const newFilters: ProductSaleFilters = {\r\n        status: values.status,\r\n        customer_id: values.customer_id,\r\n        product_id: values.product_id,\r\n        warranty_status: values.warranty_status,\r\n        min_price: priceRange[0],\r\n        max_price: priceRange[1],\r\n      };\r\n\r\n      if (values.dateRange) {\r\n        newFilters.start_date = values.dateRange[0].format('YYYY-MM-DD');\r\n        newFilters.end_date = values.dateRange[1].format('YYYY-MM-DD');\r\n      }\r\n\r\n      onApply(newFilters);\r\n      message.success('Filters applied successfully');\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error applying filters:', error);\r\n    }\r\n  };\r\n\r\n  const handleResetFilters = () => {\r\n    form.resetFields();\r\n    setPriceRange([0, 1000000]);\r\n    onApply({});\r\n    onClose();\r\n  };\r\n\r\n  const handleSavePreset = () => {\r\n    if (!presetName.trim()) {\r\n      message.error('Please enter a preset name');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const values = form.getFieldsValue();\r\n      const newPreset: FilterPreset = {\r\n        name: presetName,\r\n        filters: {\r\n          status: values.status,\r\n          customer_id: values.customer_id,\r\n          product_id: values.product_id,\r\n          warranty_status: values.warranty_status,\r\n          min_price: priceRange[0],\r\n          max_price: priceRange[1],\r\n          start_date: values.dateRange?.[0]?.format('YYYY-MM-DD'),\r\n          end_date: values.dateRange?.[1]?.format('YYYY-MM-DD'),\r\n        },\r\n        createdAt: new Date().toISOString(),\r\n      };\r\n\r\n      const updatedPresets = [...presets, newPreset];\r\n      setPresets(updatedPresets);\r\n      localStorage.setItem('productSalesFilterPresets', JSON.stringify(updatedPresets));\r\n      setPresetName('');\r\n      message.success('Preset saved successfully');\r\n    } catch (error) {\r\n      message.error('Failed to save preset');\r\n      console.error('Error saving preset:', error);\r\n    }\r\n  };\r\n\r\n  const handleLoadPreset = (preset: FilterPreset) => {\r\n    form.setFieldsValue({\r\n      status: preset.filters.status,\r\n      customer_id: preset.filters.customer_id,\r\n      product_id: preset.filters.product_id,\r\n      warranty_status: preset.filters.warranty_status,\r\n      dateRange: preset.filters.start_date && preset.filters.end_date\r\n        ? [dayjs(preset.filters.start_date), dayjs(preset.filters.end_date)]\r\n        : undefined,\r\n    });\r\n\r\n    if (preset.filters.min_price && preset.filters.max_price) {\r\n      setPriceRange([preset.filters.min_price, preset.filters.max_price]);\r\n    }\r\n  };\r\n\r\n  const handleDeletePreset = (index: number) => {\r\n    const updatedPresets = presets.filter((_, i) => i !== index);\r\n    setPresets(updatedPresets);\r\n    localStorage.setItem('productSalesFilterPresets', JSON.stringify(updatedPresets));\r\n    message.success('Preset deleted');\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Advanced Filters\"\r\n      open={visible}\r\n      onCancel={onClose}\r\n      width={700}\r\n      footer={\r\n        <Space style={{ float: 'right' }}>\r\n          <Button onClick={handleResetFilters}>Reset</Button>\r\n          <Button type=\"primary\" onClick={handleApplyFilters}>\r\n            Apply Filters\r\n          </Button>\r\n        </Space>\r\n      }\r\n    >\r\n      <Form form={form} layout=\"vertical\">\r\n        {/* Status Filter */}\r\n        <Form.Item label=\"Status\" name=\"status\">\r\n          <Select\r\n            placeholder=\"Select status\"\r\n            allowClear\r\n            mode=\"multiple\"\r\n          >\r\n            {PRODUCT_SALE_STATUSES.map((status) => (\r\n              <Select.Option key={status.value} value={status.value}>\r\n                {status.label}\r\n              </Select.Option>\r\n            ))}\r\n          </Select>\r\n        </Form.Item>\r\n\r\n        {/* Date Range Filter */}\r\n        <Form.Item label=\"Sale Date Range\" name=\"dateRange\">\r\n          <RangePicker style={{ width: '100%' }} />\r\n        </Form.Item>\r\n\r\n        {/* Price Range Filter */}\r\n        <Form.Item label=\"Price Range\">\r\n          <div style={{ marginBottom: 10 }}>\r\n            <span>${priceRange[0].toLocaleString()}</span>\r\n            {' - '}\r\n            <span>${priceRange[1].toLocaleString()}</span>\r\n          </div>\r\n          <Slider\r\n            range\r\n            min={0}\r\n            max={1000000}\r\n            step={1000}\r\n            value={priceRange}\r\n            onChange={(value) => setPriceRange(value as [number, number])}\r\n          />\r\n        </Form.Item>\r\n\r\n        {/* Customer Filter */}\r\n        <Form.Item label=\"Customer\" name=\"customer_id\">\r\n          <Select\r\n            placeholder=\"Select customers\"\r\n            allowClear\r\n            mode=\"multiple\"\r\n            optionLabelProp=\"label\"\r\n          >\r\n            {customers.map((customer) => (\r\n              <Select.Option key={customer.id} value={customer.id} label={customer.name}>\r\n                {customer.name}\r\n              </Select.Option>\r\n            ))}\r\n          </Select>\r\n        </Form.Item>\r\n\r\n        {/* Product Filter */}\r\n        <Form.Item label=\"Product\" name=\"product_id\">\r\n          <Select\r\n            placeholder=\"Select products\"\r\n            allowClear\r\n            mode=\"multiple\"\r\n            optionLabelProp=\"label\"\r\n          >\r\n            {products.map((product) => (\r\n              <Select.Option key={product.id} value={product.id} label={product.name}>\r\n                {product.name}\r\n              </Select.Option>\r\n            ))}\r\n          </Select>\r\n        </Form.Item>\r\n\r\n        {/* Warranty Status Filter */}\r\n        <Form.Item label=\"Warranty Status\" name=\"warranty_status\">\r\n          <Select placeholder=\"Select warranty status\" allowClear>\r\n            <Select.Option value=\"active\">Active</Select.Option>\r\n            <Select.Option value=\"expiring_soon\">Expiring Soon (30 days)</Select.Option>\r\n            <Select.Option value=\"expired\">Expired</Select.Option>\r\n          </Select>\r\n        </Form.Item>\r\n      </Form>\r\n\r\n      {/* Preset Management */}\r\n      <Divider>Manage Presets</Divider>\r\n\r\n      <Row gutter={[8, 8]} style={{ marginBottom: 16 }}>\r\n        <Col span={16}>\r\n          <Input\r\n            placeholder=\"Enter preset name\"\r\n            value={presetName}\r\n            onChange={(e) => setPresetName(e.target.value)}\r\n            onPressEnter={handleSavePreset}\r\n          />\r\n        </Col>\r\n        <Col span={8}>\r\n          <Button\r\n            block\r\n            icon={<SaveOutlined />}\r\n            onClick={handleSavePreset}\r\n          >\r\n            Save Preset\r\n          </Button>\r\n        </Col>\r\n      </Row>\r\n\r\n      {presets.length > 0 && (\r\n        <div>\r\n          <div style={{ marginBottom: 8, fontSize: 12, color: '#999' }}>\r\n            Saved Presets:\r\n          </div>\r\n          <Space wrap>\r\n            {presets.map((preset, index) => (\r\n              <div\r\n                key={index}\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  gap: 8,\r\n                  padding: '8px 12px',\r\n                  background: '#f5f5f5',\r\n                  borderRadius: 4,\r\n                }}\r\n              >\r\n                <span\r\n                  onClick={() => handleLoadPreset(preset)}\r\n                  style={{\r\n                    cursor: 'pointer',\r\n                    color: '#1890ff',\r\n                    textDecoration: 'underline',\r\n                  }}\r\n                >\r\n                  {preset.name}\r\n                </span>\r\n                <DeleteOutlined\r\n                  onClick={() => handleDeletePreset(index)}\r\n                  style={{ cursor: 'pointer', color: '#ff4d4f' }}\r\n                />\r\n              </div>\r\n            ))}\r\n          </Space>\r\n        </div>\r\n      )}\r\n    </Modal>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\AdvancedSearchModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\BulkActionToolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\DynamicColumnsModal.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":317,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":317,"endColumn":31},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":330,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":330,"endColumn":31},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":353,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":353,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dynamic Columns Modal - Product Sales\r\n * Allows users to show/hide, reorder, and manage table columns\r\n * Preferences are saved to localStorage for persistence\r\n */\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n  Modal,\r\n  List,\r\n  Checkbox,\r\n  Button,\r\n  Space,\r\n  Row,\r\n  Col,\r\n  message,\r\n  Empty,\r\n  Divider,\r\n  Tag,\r\n  Tooltip,\r\n  Alert\r\n} from 'antd';\r\nimport {\r\n  DragOutlined,\r\n  CheckOutlined,\r\n  UndoOutlined,\r\n  SaveOutlined,\r\n  EyeOutlined,\r\n  EyeInvisibleOutlined\r\n} from '@ant-design/icons';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport { ProductSale } from '@/types/productSales';\r\n\r\n// Storage key for column preferences\r\nconst STORAGE_KEY_COLUMN_PREFS = 'product_sales_column_prefs';\r\n\r\n// Column configuration\r\nexport interface ColumnConfig {\r\n  key: string;\r\n  title: string;\r\n  visible: boolean;\r\n  order: number;\r\n}\r\n\r\n// Default column configuration\r\nconst DEFAULT_COLUMNS: ColumnConfig[] = [\r\n  { key: 'sale_number', title: 'Sale #', visible: true, order: 0 },\r\n  { key: 'customer_name', title: 'Customer', visible: true, order: 1 },\r\n  { key: 'product_name', title: 'Product', visible: true, order: 2 },\r\n  { key: 'quantity', title: 'Quantity', visible: true, order: 3 },\r\n  { key: 'unit_price', title: 'Unit Price', visible: true, order: 4 },\r\n  { key: 'total_value', title: 'Total Value', visible: true, order: 5 },\r\n  { key: 'status', title: 'Status', visible: true, order: 6 },\r\n  { key: 'sale_date', title: 'Sale Date', visible: true, order: 7 },\r\n  { key: 'actions', title: 'Actions', visible: true, order: 8 } // Always visible\r\n];\r\n\r\ninterface DynamicColumnsModalProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onColumnsChange: (columns: ColumnConfig[]) => void;\r\n}\r\n\r\nexport const DynamicColumnsModal: React.FC<DynamicColumnsModalProps> = ({\r\n  visible,\r\n  onClose,\r\n  onColumnsChange\r\n}) => {\r\n  const [columns, setColumns] = useState<ColumnConfig[]>(DEFAULT_COLUMNS);\r\n  const [isChanged, setIsChanged] = useState(false);\r\n\r\n  // Load preferences from localStorage on component mount\r\n  const loadColumnPrefs = useCallback(() => {\r\n    try {\r\n      const saved = localStorage.getItem(STORAGE_KEY_COLUMN_PREFS);\r\n      if (saved) {\r\n        const parsedPrefs = JSON.parse(saved);\r\n        // Merge with defaults to handle new columns added in future\r\n        const merged = DEFAULT_COLUMNS.map(defaultCol => ({\r\n          ...defaultCol,\r\n          ...parsedPrefs.find((p: ColumnConfig) => p.key === defaultCol.key)\r\n        })).sort((a, b) => a.order - b.order);\r\n        setColumns(merged);\r\n      } else {\r\n        setColumns(DEFAULT_COLUMNS);\r\n      }\r\n      setIsChanged(false);\r\n    } catch (error) {\r\n      console.error('Failed to load column preferences:', error);\r\n      setColumns(DEFAULT_COLUMNS);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      loadColumnPrefs();\r\n    }\r\n  }, [visible, loadColumnPrefs]);\r\n\r\n  // Toggle column visibility\r\n  const handleToggleVisibility = (key: string) => {\r\n    // Actions column is always visible\r\n    if (key === 'actions') {\r\n      message.info('Actions column is always visible');\r\n      return;\r\n    }\r\n\r\n    setColumns(prevColumns =>\r\n      prevColumns.map(col =>\r\n        col.key === key ? { ...col, visible: !col.visible } : col\r\n      )\r\n    );\r\n    setIsChanged(true);\r\n  };\r\n\r\n  // Move column up in order\r\n  const handleMoveUp = (index: number) => {\r\n    if (index === 0) return;\r\n\r\n    const newColumns = [...columns];\r\n    const temp = newColumns[index];\r\n    newColumns[index] = newColumns[index - 1];\r\n    newColumns[index - 1] = temp;\r\n\r\n    // Update order values\r\n    newColumns.forEach((col, idx) => {\r\n      col.order = idx;\r\n    });\r\n\r\n    setColumns(newColumns);\r\n    setIsChanged(true);\r\n  };\r\n\r\n  // Move column down in order\r\n  const handleMoveDown = (index: number) => {\r\n    if (index === columns.length - 1) return;\r\n\r\n    const newColumns = [...columns];\r\n    const temp = newColumns[index];\r\n    newColumns[index] = newColumns[index + 1];\r\n    newColumns[index + 1] = temp;\r\n\r\n    // Update order values\r\n    newColumns.forEach((col, idx) => {\r\n      col.order = idx;\r\n    });\r\n\r\n    setColumns(newColumns);\r\n    setIsChanged(true);\r\n  };\r\n\r\n  // Save preferences to localStorage\r\n  const handleSave = () => {\r\n    try {\r\n      localStorage.setItem(STORAGE_KEY_COLUMN_PREFS, JSON.stringify(columns));\r\n      onColumnsChange(columns);\r\n      setIsChanged(false);\r\n      message.success('Column preferences saved');\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to save column preferences:', error);\r\n      message.error('Failed to save preferences');\r\n    }\r\n  };\r\n\r\n  // Reset to default layout\r\n  const handleReset = () => {\r\n    setColumns(DEFAULT_COLUMNS);\r\n    setIsChanged(true);\r\n    message.info('Reset to default layout');\r\n  };\r\n\r\n  // Reset and save defaults\r\n  const handleResetAndSave = () => {\r\n    try {\r\n      localStorage.setItem(STORAGE_KEY_COLUMN_PREFS, JSON.stringify(DEFAULT_COLUMNS));\r\n      onColumnsChange(DEFAULT_COLUMNS);\r\n      setColumns(DEFAULT_COLUMNS);\r\n      setIsChanged(false);\r\n      message.success('Column layout reset to default');\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to reset column preferences:', error);\r\n      message.error('Failed to reset preferences');\r\n    }\r\n  };\r\n\r\n  // Count visible columns\r\n  const visibleCount = columns.filter(col => col.visible).length;\r\n  const hiddenCount = columns.filter(col => !col.visible).length;\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Manage Columns\"\r\n      visible={visible}\r\n      onCancel={onClose}\r\n      width={600}\r\n      centered\r\n      footer={[\r\n        <Button key=\"reset\" onClick={handleResetAndSave} danger>\r\n          <UndoOutlined /> Reset to Default\r\n        </Button>,\r\n        <Button key=\"cancel\" onClick={onClose}>\r\n          Cancel\r\n        </Button>,\r\n        <Button\r\n          key=\"submit\"\r\n          type=\"primary\"\r\n          onClick={handleSave}\r\n          disabled={!isChanged}\r\n          icon={<SaveOutlined />}\r\n        >\r\n          Save Changes\r\n        </Button>\r\n      ]}\r\n    >\r\n      <div style={{ marginBottom: 16 }}>\r\n        <Alert\r\n          message=\"Drag items to reorder, use toggle to show/hide columns, or reset to default layout\"\r\n          type=\"info\"\r\n          showIcon\r\n          style={{ marginBottom: 16 }}\r\n        />\r\n        <div style={{ display: 'flex', gap: 16, marginBottom: 16 }}>\r\n          <div>\r\n            <EyeOutlined style={{ marginRight: 8 }} />\r\n            Visible: <Tag color=\"blue\">{visibleCount}</Tag>\r\n          </div>\r\n          <div>\r\n            <EyeInvisibleOutlined style={{ marginRight: 8 }} />\r\n            Hidden: <Tag color=\"default\">{hiddenCount}</Tag>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <Divider />\r\n\r\n      <div style={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n        <List\r\n          dataSource={columns}\r\n          renderItem={(column, index) => (\r\n            <List.Item\r\n              key={column.key}\r\n              style={{\r\n                padding: '12px 0',\r\n                borderBottom: index === columns.length - 1 ? 'none' : '1px solid #f0f0f0'\r\n              }}\r\n            >\r\n              <div style={{ width: '100%' }}>\r\n                <Row gutter={12} align=\"middle\">\r\n                  <Col span={2}>\r\n                    <Tooltip title=\"Drag to reorder\">\r\n                      <DragOutlined style={{ cursor: 'grab', color: '#999' }} />\r\n                    </Tooltip>\r\n                  </Col>\r\n                  <Col span={2}>\r\n                    <Checkbox\r\n                      checked={column.visible}\r\n                      onChange={() => handleToggleVisibility(column.key)}\r\n                      disabled={column.key === 'actions'}\r\n                    />\r\n                  </Col>\r\n                  <Col span={10}>\r\n                    <span\r\n                      style={{\r\n                        fontWeight: 500,\r\n                        opacity: column.visible ? 1 : 0.5\r\n                      }}\r\n                    >\r\n                      {column.title}\r\n                    </span>\r\n                    {column.key === 'actions' && (\r\n                      <Tag\r\n                        color=\"cyan\"\r\n                        style={{ marginLeft: 8 }}\r\n                      >\r\n                        Always Visible\r\n                      </Tag>\r\n                    )}\r\n                  </Col>\r\n                  <Col span={10} style={{ textAlign: 'right' }}>\r\n                    <Space size=\"small\">\r\n                      <Tooltip title=\"Move up\">\r\n                        <Button\r\n                          type=\"text\"\r\n                          size=\"small\"\r\n                          onClick={() => handleMoveUp(index)}\r\n                          disabled={index === 0}\r\n                        >\r\n                          ‚Üë\r\n                        </Button>\r\n                      </Tooltip>\r\n                      <Tooltip title=\"Move down\">\r\n                        <Button\r\n                          type=\"text\"\r\n                          size=\"small\"\r\n                          onClick={() => handleMoveDown(index)}\r\n                          disabled={index === columns.length - 1}\r\n                        >\r\n                          ‚Üì\r\n                        </Button>\r\n                      </Tooltip>\r\n                    </Space>\r\n                  </Col>\r\n                </Row>\r\n              </div>\r\n            </List.Item>\r\n          )}\r\n        />\r\n      </div>\r\n\r\n      {columns.length === 0 && <Empty description=\"No columns available\" />}\r\n    </Modal>\r\n  );\r\n};\r\n\r\n// Export column configuration utility\r\nexport const getVisibleColumns = (): ColumnConfig[] => {\r\n  try {\r\n    const saved = localStorage.getItem(STORAGE_KEY_COLUMN_PREFS);\r\n    if (saved) {\r\n      return JSON.parse(saved).filter((col: ColumnConfig) => col.visible);\r\n    }\r\n  } catch (error) {\r\n    console.error('Failed to get visible columns:', error);\r\n  }\r\n  return DEFAULT_COLUMNS.filter(col => col.visible);\r\n};\r\n\r\n// Export function to apply column configuration to table columns\r\nexport const applyColumnConfig = (\r\n  tableColumns: ColumnsType<ProductSale>,\r\n  columnConfig: ColumnConfig[]\r\n): ColumnsType<ProductSale> => {\r\n  // Create a map for quick lookup\r\n  const configMap = new Map(columnConfig.map(c => [c.key, c]));\r\n\r\n  // Filter and reorder columns\r\n  return tableColumns\r\n    .filter(col => {\r\n      const config = configMap.get(col.key as string);\r\n      return config ? config.visible : true;\r\n    })\r\n    .sort((a, b) => {\r\n      const configA = configMap.get(a.key as string);\r\n      const configB = configMap.get(b.key as string);\r\n      const orderA = configA?.order ?? 999;\r\n      const orderB = configB?.order ?? 999;\r\n      return orderA - orderB;\r\n    });\r\n};\r\n\r\n// Export hook for using dynamic columns\r\nexport const useDynamicColumns = () => {\r\n  const [columnConfig, setColumnConfig] = useState<ColumnConfig[]>(DEFAULT_COLUMNS);\r\n\r\n  const loadConfig = useCallback(() => {\r\n    try {\r\n      const saved = localStorage.getItem(STORAGE_KEY_COLUMN_PREFS);\r\n      if (saved) {\r\n        setColumnConfig(JSON.parse(saved));\r\n      } else {\r\n        setColumnConfig(DEFAULT_COLUMNS);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load column config:', error);\r\n      setColumnConfig(DEFAULT_COLUMNS);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadConfig();\r\n  }, [loadConfig]);\r\n\r\n  return { columnConfig, loadConfig };\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\ExportModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2485,2488],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2485,2488],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Export Modal for Product Sales\r\n * Handles CSV and PDF export with column selection\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n  Modal,\r\n  Form,\r\n  Select,\r\n  Button,\r\n  Space,\r\n  message,\r\n  Checkbox,\r\n  Row,\r\n  Col,\r\n  Radio,\r\n  Divider,\r\n  Empty,\r\n} from 'antd';\r\nimport { DownloadOutlined } from '@ant-design/icons';\r\nimport { ProductSale } from '@/types/productSales';\r\nimport * as XLSX from 'xlsx';\r\n\r\ninterface ExportModalProps {\r\n  visible: boolean;\r\n  data: ProductSale[];\r\n  onClose: () => void;\r\n}\r\n\r\ninterface ExportColumn {\r\n  key: string;\r\n  label: string;\r\n  default: boolean;\r\n}\r\n\r\nconst EXPORT_COLUMNS: ExportColumn[] = [\r\n  { key: 'sale_number', label: 'Sale Number', default: true },\r\n  { key: 'customer_name', label: 'Customer Name', default: true },\r\n  { key: 'product_name', label: 'Product Name', default: true },\r\n  { key: 'quantity', label: 'Quantity', default: true },\r\n  { key: 'unit_price', label: 'Unit Price', default: true },\r\n  { key: 'total_value', label: 'Total Value', default: true },\r\n  { key: 'status', label: 'Status', default: true },\r\n  { key: 'sale_date', label: 'Sale Date', default: true },\r\n  { key: 'delivery_date', label: 'Delivery Date', default: false },\r\n  { key: 'warranty_period', label: 'Warranty Period', default: false },\r\n  { key: 'warranty_expiry_date', label: 'Warranty Expiry', default: false },\r\n  { key: 'notes', label: 'Notes', default: false },\r\n  { key: 'invoice_url', label: 'Invoice', default: false },\r\n  { key: 'created_at', label: 'Created At', default: false },\r\n  { key: 'updated_at', label: 'Updated At', default: false },\r\n];\r\n\r\nexport const ExportModal: React.FC<ExportModalProps> = ({\r\n  visible,\r\n  data,\r\n  onClose,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [selectedColumns, setSelectedColumns] = useState<string[]>(\r\n    EXPORT_COLUMNS.filter((c) => c.default).map((c) => c.key)\r\n  );\r\n  const [exportFormat, setExportFormat] = useState<'csv' | 'pdf'>('csv');\r\n\r\n  const handleColumnChange = (columnKey: string, checked: boolean) => {\r\n    if (checked) {\r\n      setSelectedColumns([...selectedColumns, columnKey]);\r\n    } else {\r\n      setSelectedColumns(selectedColumns.filter((c) => c !== columnKey));\r\n    }\r\n  };\r\n\r\n  const handleSelectAll = () => {\r\n    if (selectedColumns.length === EXPORT_COLUMNS.length) {\r\n      setSelectedColumns([]);\r\n    } else {\r\n      setSelectedColumns(EXPORT_COLUMNS.map((c) => c.key));\r\n    }\r\n  };\r\n\r\n  const formatCellValue = (value: any, key: string): string => {\r\n    if (value === null || value === undefined) return '';\r\n\r\n    switch (key) {\r\n      case 'unit_price':\r\n      case 'total_value':\r\n        return typeof value === 'number' ? `$${value.toFixed(2)}` : String(value);\r\n      case 'sale_date':\r\n      case 'delivery_date':\r\n      case 'warranty_expiry_date':\r\n      case 'created_at':\r\n      case 'updated_at':\r\n        return new Date(value).toLocaleDateString('en-US', {\r\n          year: 'numeric',\r\n          month: 'short',\r\n          day: 'numeric',\r\n        });\r\n      case 'warranty_period':\r\n        return `${value} months`;\r\n      default:\r\n        return String(value);\r\n    }\r\n  };\r\n\r\n  const exportToCSV = () => {\r\n    if (selectedColumns.length === 0) {\r\n      message.error('Please select at least one column to export');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Prepare data\r\n      const headers = selectedColumns.map((col) => {\r\n        const column = EXPORT_COLUMNS.find((c) => c.key === col);\r\n        return column?.label || col;\r\n      });\r\n\r\n      const rows = data.map((item) =>\r\n        selectedColumns.map((col) => formatCellValue(item[col as keyof ProductSale], col))\r\n      );\r\n\r\n      // Create CSV content\r\n      const csvContent = [\r\n        headers.join(','),\r\n        ...rows.map((row) =>\r\n          row\r\n            .map((cell) =>\r\n              cell.includes(',') || cell.includes('\"') || cell.includes('\\n')\r\n                ? `\"${cell.replace(/\"/g, '\"\"')}\"`\r\n                : cell\r\n            )\r\n            .join(',')\r\n        ),\r\n      ].join('\\n');\r\n\r\n      // Download CSV\r\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n      const link = document.createElement('a');\r\n      const url = URL.createObjectURL(blob);\r\n      link.setAttribute('href', url);\r\n      link.setAttribute('download', `product_sales_${new Date().getTime()}.csv`);\r\n      link.style.visibility = 'hidden';\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n\r\n      message.success(`${data.length} records exported to CSV successfully`);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error exporting to CSV:', error);\r\n      message.error('Failed to export to CSV');\r\n    }\r\n  };\r\n\r\n  const exportToExcel = () => {\r\n    if (selectedColumns.length === 0) {\r\n      message.error('Please select at least one column to export');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Prepare data\r\n      const headers = selectedColumns.map((col) => {\r\n        const column = EXPORT_COLUMNS.find((c) => c.key === col);\r\n        return column?.label || col;\r\n      });\r\n\r\n      const rows = data.map((item) =>\r\n        selectedColumns.map((col) => formatCellValue(item[col as keyof ProductSale], col))\r\n      );\r\n\r\n      // Create worksheet\r\n      const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);\r\n      \r\n      // Set column widths\r\n      ws['!cols'] = selectedColumns.map(() => ({ wch: 20 }));\r\n\r\n      // Create workbook\r\n      const wb = XLSX.utils.book_new();\r\n      XLSX.utils.book_append_sheet(wb, ws, 'Product Sales');\r\n\r\n      // Write file\r\n      XLSX.writeFile(wb, `product_sales_${new Date().getTime()}.xlsx`);\r\n\r\n      message.success(`${data.length} records exported to Excel successfully`);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error exporting to Excel:', error);\r\n      message.error('Failed to export to Excel');\r\n    }\r\n  };\r\n\r\n  const handleExport = () => {\r\n    if (exportFormat === 'csv') {\r\n      exportToCSV();\r\n    } else {\r\n      exportToExcel();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Export Product Sales\"\r\n      open={visible}\r\n      onCancel={onClose}\r\n      width={600}\r\n      footer={\r\n        <Space style={{ float: 'right' }}>\r\n          <Button onClick={onClose}>Cancel</Button>\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<DownloadOutlined />}\r\n            onClick={handleExport}\r\n            disabled={selectedColumns.length === 0}\r\n          >\r\n            Export ({data.length} records)\r\n          </Button>\r\n        </Space>\r\n      }\r\n    >\r\n      {data.length === 0 ? (\r\n        <Empty description=\"No data to export\" />\r\n      ) : (\r\n        <>\r\n          {/* Export Format Selection */}\r\n          <Form layout=\"vertical\">\r\n            <Form.Item label=\"Export Format\" required>\r\n              <Radio.Group\r\n                value={exportFormat}\r\n                onChange={(e) => setExportFormat(e.target.value)}\r\n              >\r\n                <Radio value=\"csv\">CSV (.csv)</Radio>\r\n                <Radio value=\"pdf\">Excel (.xlsx)</Radio>\r\n              </Radio.Group>\r\n            </Form.Item>\r\n          </Form>\r\n\r\n          <Divider>Select Columns to Export</Divider>\r\n\r\n          {/* Column Selection */}\r\n          <div style={{ marginBottom: 16 }}>\r\n            <Button\r\n              size=\"small\"\r\n              onClick={handleSelectAll}\r\n              style={{ marginBottom: 12 }}\r\n            >\r\n              {selectedColumns.length === EXPORT_COLUMNS.length\r\n                ? 'Deselect All'\r\n                : 'Select All'}\r\n            </Button>\r\n            <div style={{ fontSize: 12, color: '#999' }}>\r\n              Selected: {selectedColumns.length} / {EXPORT_COLUMNS.length}\r\n            </div>\r\n          </div>\r\n\r\n          <Row gutter={[16, 12]}>\r\n            {EXPORT_COLUMNS.map((column) => (\r\n              <Col key={column.key} span={12}>\r\n                <Checkbox\r\n                  checked={selectedColumns.includes(column.key)}\r\n                  onChange={(e) => handleColumnChange(column.key, e.target.checked)}\r\n                >\r\n                  {column.label}\r\n                </Checkbox>\r\n              </Col>\r\n            ))}\r\n          </Row>\r\n\r\n          <Divider />\r\n\r\n          {/* Export Summary */}\r\n          <div style={{ fontSize: 12, color: '#666' }}>\r\n            <strong>Export Summary:</strong>\r\n            <div>‚Ä¢ Format: {exportFormat.toUpperCase()}</div>\r\n            <div>‚Ä¢ Columns: {selectedColumns.length} selected</div>\r\n            <div>‚Ä¢ Records: {data.length}</div>\r\n            <div>‚Ä¢ File: product_sales_[timestamp].{exportFormat === 'csv' ? 'csv' : 'xlsx'}</div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </Modal>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\FilterPresetsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\InvoiceEmailModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1032,1035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1032,1035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4092,4095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4092,4095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4897,4900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4897,4900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Invoice Email Modal\r\n * Allows users to configure and send invoices via email with professional templates\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n  Modal,\r\n  Form,\r\n  Input,\r\n  Button,\r\n  Spin,\r\n  Space,\r\n  Row,\r\n  Col,\r\n  Divider,\r\n  Alert,\r\n  Empty,\r\n  Select,\r\n  DatePicker,\r\n  Switch,\r\n  Tooltip,\r\n  Card,\r\n  Tabs,\r\n  Checkbox\r\n} from 'antd';\r\nimport {\r\n  SendOutlined,\r\n  ClockCircleOutlined,\r\n  FilePdfOutlined,\r\n  EyeOutlined,\r\n  InfoCircleOutlined,\r\n  MailOutlined,\r\n  UserOutlined,\r\n  CopyOutlined\r\n} from '@ant-design/icons';\r\nimport { ProductSale, ProductSaleItem } from '@/types/productSales';\r\nimport { Invoice } from '../services/invoiceService';\r\nimport { useInvoiceEmail } from '../hooks/useInvoiceEmail';\r\nimport { InvoiceEmailConfig } from '../services/invoiceEmailService';\r\nimport dayjs from 'dayjs';\r\n\r\ninterface InvoiceEmailModalProps {\r\n  visible: boolean;\r\n  invoice: Invoice;\r\n  sale: ProductSale;\r\n  saleItems: ProductSaleItem[];\r\n  onClose: () => void;\r\n  onSuccess?: (result: any) => void;\r\n  pdfBlob?: Blob;\r\n}\r\n\r\nconst DEFAULT_PAYMENT_TERMS = [\r\n  { label: 'Due on Receipt', value: 'Due on Receipt' },\r\n  { label: 'Net 15', value: 'Net 15' },\r\n  { label: 'Net 30', value: 'Net 30' },\r\n  { label: 'Net 45', value: 'Net 45' },\r\n  { label: 'Net 60', value: 'Net 60' }\r\n];\r\n\r\nexport const InvoiceEmailModal: React.FC<InvoiceEmailModalProps> = ({\r\n  visible,\r\n  invoice,\r\n  sale,\r\n  saleItems,\r\n  onClose,\r\n  onSuccess,\r\n  pdfBlob\r\n}) => {\r\n  const [form] = Form.useForm<Record<string, string>>();\r\n  const { sendEmail, isSendingEmail, sendEmailError, scheduleEmail, isSchedulingEmail, scheduleEmailError } = useInvoiceEmail();\r\n\r\n  const [activeTab, setActiveTab] = useState<'send' | 'schedule' | 'preview'>('send');\r\n  const [includeAttachment, setIncludeAttachment] = useState(true);\r\n  const [scheduleDate, setScheduleDate] = useState<dayjs.Dayjs | null>(null);\r\n  const [ccEmails, setCcEmails] = useState<string[]>([]);\r\n  const [newCcEmail, setNewCcEmail] = useState('');\r\n\r\n  const handleAddCc = () => {\r\n    const email = newCcEmail.trim();\r\n    if (email && !ccEmails.includes(email)) {\r\n      setCcEmails([...ccEmails, email]);\r\n      setNewCcEmail('');\r\n    }\r\n  };\r\n\r\n  const handleRemoveCc = (email: string) => {\r\n    setCcEmails(ccEmails.filter(e => e !== email));\r\n  };\r\n\r\n  const handleSendEmail = async (values: Record<string, string>) => {\r\n    try {\r\n      const config: InvoiceEmailConfig = {\r\n        to: values.recipientEmail,\r\n        cc: ccEmails.length > 0 ? ccEmails : undefined,\r\n        subject: values.subject || `Invoice ${invoice.invoice_number}`,\r\n        customMessage: values.customMessage || undefined\r\n      };\r\n\r\n      await sendEmail({\r\n        invoice,\r\n        sale,\r\n        items: saleItems,\r\n        config,\r\n        includeAttachment: includeAttachment && pdfBlob ? true : false,\r\n        pdfBlob: includeAttachment && pdfBlob ? pdfBlob : undefined\r\n      });\r\n\r\n      onSuccess?.(true);\r\n      form.resetFields();\r\n      setCcEmails([]);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to send email:', error);\r\n    }\r\n  };\r\n\r\n  const handleScheduleEmail = async (values: Record<string, string>) => {\r\n    try {\r\n      if (!scheduleDate) {\r\n        throw new Error('Please select a date and time to schedule the email');\r\n      }\r\n\r\n      const config: InvoiceEmailConfig = {\r\n        to: values.recipientEmail,\r\n        cc: ccEmails.length > 0 ? ccEmails : undefined,\r\n        subject: values.subject || `Invoice ${invoice.invoice_number}`,\r\n        customMessage: values.customMessage || undefined,\r\n        scheduledFor: scheduleDate.toDate()\r\n      };\r\n\r\n      await scheduleEmail({\r\n        invoice,\r\n        sale,\r\n        items: saleItems,\r\n        config,\r\n        scheduledFor: scheduleDate.toDate()\r\n      });\r\n\r\n      onSuccess?.(true);\r\n      form.resetFields();\r\n      setCcEmails([]);\r\n      setScheduleDate(null);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to schedule email:', error);\r\n    }\r\n  };\r\n\r\n  const onFinish = (values: any) => {\r\n    if (activeTab === 'schedule') {\r\n      handleScheduleEmail(values);\r\n    } else {\r\n      handleSendEmail(values);\r\n    }\r\n  };\r\n\r\n  const customerEmail = sale.customer_email || invoice.customer_email || '';\r\n  const isLoading = isSendingEmail || isSchedulingEmail;\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <MailOutlined style={{ color: '#667eea' }} />\r\n          Send Invoice Email\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={onClose}\r\n      width={800}\r\n      footer={null}\r\n      styles={{ body: { maxHeight: '70vh', overflowY: 'auto' } }}\r\n    >\r\n      <Spin spinning={isLoading}>\r\n        <Tabs\r\n          activeKey={activeTab}\r\n          onChange={(key) => setActiveTab(key as any)}\r\n          items={[\r\n            {\r\n              key: 'send',\r\n              label: <span><SendOutlined /> Send Now</span>,\r\n              children: (\r\n                <Form\r\n                  form={form}\r\n                  layout=\"vertical\"\r\n                  onFinish={onFinish}\r\n                  initialValues={{\r\n                    recipientEmail: customerEmail,\r\n                    subject: `Invoice ${invoice.invoice_number}`,\r\n                    attachPdf: true\r\n                  }}\r\n                >\r\n                  {sendEmailError && (\r\n                    <Alert\r\n                      type=\"error\"\r\n                      message=\"Error\"\r\n                      description={sendEmailError instanceof Error ? sendEmailError.message : 'Failed to send email'}\r\n                      showIcon\r\n                      style={{ marginBottom: '16px' }}\r\n                      closable\r\n                    />\r\n                  )}\r\n\r\n                  {/* Recipient Email */}\r\n                  <Form.Item\r\n                    label=\"Recipient Email\"\r\n                    name=\"recipientEmail\"\r\n                    rules={[\r\n                      { required: true, message: 'Please enter recipient email' },\r\n                      {\r\n                        pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\r\n                        message: 'Please enter a valid email address'\r\n                      }\r\n                    ]}\r\n                  >\r\n                    <Input\r\n                      prefix={<MailOutlined />}\r\n                      placeholder=\"customer@example.com\"\r\n                      disabled={isLoading}\r\n                    />\r\n                  </Form.Item>\r\n\r\n                  {/* CC Emails */}\r\n                  <Form.Item label=\"CC Recipients (Optional)\">\r\n                    <Input.Group compact>\r\n                      <Input\r\n                        style={{ width: 'calc(100% - 80px)' }}\r\n                        placeholder=\"manager@example.com\"\r\n                        value={newCcEmail}\r\n                        onChange={(e) => setNewCcEmail(e.target.value)}\r\n                        onPressEnter={handleAddCc}\r\n                        disabled={isLoading}\r\n                      />\r\n                      <Button\r\n                        onClick={handleAddCc}\r\n                        disabled={!newCcEmail.trim() || isLoading}\r\n                      >\r\n                        Add\r\n                      </Button>\r\n                    </Input.Group>\r\n\r\n                    {ccEmails.length > 0 && (\r\n                      <div style={{ marginTop: '8px' }}>\r\n                        {ccEmails.map((email) => (\r\n                          <div\r\n                            key={email}\r\n                            style={{\r\n                              display: 'inline-block',\r\n                              padding: '4px 12px',\r\n                              margin: '4px 4px 4px 0',\r\n                              backgroundColor: '#f0f0f0',\r\n                              borderRadius: '4px',\r\n                              fontSize: '12px'\r\n                            }}\r\n                          >\r\n                            {email}\r\n                            <Button\r\n                              type=\"text\"\r\n                              size=\"small\"\r\n                              style={{ marginLeft: '8px', padding: 0 }}\r\n                              onClick={() => handleRemoveCc(email)}\r\n                              disabled={isLoading}\r\n                            >\r\n                              ‚úï\r\n                            </Button>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </Form.Item>\r\n\r\n                  {/* Subject */}\r\n                  <Form.Item\r\n                    label=\"Email Subject\"\r\n                    name=\"subject\"\r\n                    rules={[{ required: true, message: 'Please enter email subject' }]}\r\n                  >\r\n                    <Input placeholder=\"Invoice #INV-2025-01-00001\" disabled={isLoading} />\r\n                  </Form.Item>\r\n\r\n                  {/* Custom Message */}\r\n                  <Form.Item\r\n                    label=\"Custom Message (Optional)\"\r\n                    name=\"customMessage\"\r\n                  >\r\n                    <Input.TextArea\r\n                      rows={3}\r\n                      placeholder=\"Add a personal message to include in the email...\"\r\n                      disabled={isLoading}\r\n                    />\r\n                  </Form.Item>\r\n\r\n                  {/* PDF Attachment */}\r\n                  <Form.Item>\r\n                    <Checkbox\r\n                      checked={includeAttachment}\r\n                      onChange={(e) => setIncludeAttachment(e.target.checked)}\r\n                      disabled={!pdfBlob || isLoading}\r\n                    >\r\n                      <span>\r\n                        <FilePdfOutlined style={{ marginRight: '8px' }} />\r\n                        Include Invoice PDF as Attachment\r\n                      </span>\r\n                      {!pdfBlob && (\r\n                        <Tooltip title=\"PDF not available - generate invoice first\">\r\n                          <InfoCircleOutlined style={{ marginLeft: '8px', color: '#f57800' }} />\r\n                        </Tooltip>\r\n                      )}\r\n                    </Checkbox>\r\n                  </Form.Item>\r\n\r\n                  {/* Invoice Summary */}\r\n                  <Divider />\r\n                  <div style={{ marginBottom: '16px' }}>\r\n                    <h4>Invoice Summary</h4>\r\n                    <Row gutter={16}>\r\n                      <Col span={12}>\r\n                        <div style={{ fontSize: '12px', color: '#666' }}>\r\n                          <div><strong>Invoice #:</strong> {invoice.invoice_number}</div>\r\n                          <div><strong>Amount:</strong> ${invoice.total.toFixed(2)}</div>\r\n                        </div>\r\n                      </Col>\r\n                      <Col span={12}>\r\n                        <div style={{ fontSize: '12px', color: '#666' }}>\r\n                          <div><strong>Customer:</strong> {invoice.customer_name}</div>\r\n                          <div><strong>Date:</strong> {new Date(invoice.generated_at).toLocaleDateString()}</div>\r\n                        </div>\r\n                      </Col>\r\n                    </Row>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <Form.Item>\r\n                    <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n                      <Button onClick={onClose} disabled={isLoading}>\r\n                        Cancel\r\n                      </Button>\r\n                      <Button type=\"primary\" htmlType=\"submit\" loading={isLoading} icon={<SendOutlined />}>\r\n                        Send Email Now\r\n                      </Button>\r\n                    </Space>\r\n                  </Form.Item>\r\n                </Form>\r\n              )\r\n            },\r\n            {\r\n              key: 'schedule',\r\n              label: <span><ClockCircleOutlined /> Schedule</span>,\r\n              children: (\r\n                <Form\r\n                  form={form}\r\n                  layout=\"vertical\"\r\n                  onFinish={onFinish}\r\n                  initialValues={{\r\n                    recipientEmail: customerEmail,\r\n                    subject: `Invoice ${invoice.invoice_number}`\r\n                  }}\r\n                >\r\n                  {scheduleEmailError && (\r\n                    <Alert\r\n                      type=\"error\"\r\n                      message=\"Error\"\r\n                      description={scheduleEmailError instanceof Error ? scheduleEmailError.message : 'Failed to schedule email'}\r\n                      showIcon\r\n                      style={{ marginBottom: '16px' }}\r\n                      closable\r\n                    />\r\n                  )}\r\n\r\n                  <Alert\r\n                    type=\"info\"\r\n                    message=\"Schedule Email\"\r\n                    description=\"Schedule this invoice to be sent at a specific date and time\"\r\n                    showIcon\r\n                    style={{ marginBottom: '16px' }}\r\n                  />\r\n\r\n                  {/* Recipient Email */}\r\n                  <Form.Item\r\n                    label=\"Recipient Email\"\r\n                    name=\"recipientEmail\"\r\n                    rules={[\r\n                      { required: true, message: 'Please enter recipient email' },\r\n                      {\r\n                        pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\r\n                        message: 'Please enter a valid email address'\r\n                      }\r\n                    ]}\r\n                  >\r\n                    <Input\r\n                      prefix={<MailOutlined />}\r\n                      placeholder=\"customer@example.com\"\r\n                      disabled={isLoading}\r\n                    />\r\n                  </Form.Item>\r\n\r\n                  {/* CC Emails */}\r\n                  <Form.Item label=\"CC Recipients (Optional)\">\r\n                    <Input.Group compact>\r\n                      <Input\r\n                        style={{ width: 'calc(100% - 80px)' }}\r\n                        placeholder=\"manager@example.com\"\r\n                        value={newCcEmail}\r\n                        onChange={(e) => setNewCcEmail(e.target.value)}\r\n                        onPressEnter={handleAddCc}\r\n                        disabled={isLoading}\r\n                      />\r\n                      <Button\r\n                        onClick={handleAddCc}\r\n                        disabled={!newCcEmail.trim() || isLoading}\r\n                      >\r\n                        Add\r\n                      </Button>\r\n                    </Input.Group>\r\n\r\n                    {ccEmails.length > 0 && (\r\n                      <div style={{ marginTop: '8px' }}>\r\n                        {ccEmails.map((email) => (\r\n                          <div\r\n                            key={email}\r\n                            style={{\r\n                              display: 'inline-block',\r\n                              padding: '4px 12px',\r\n                              margin: '4px 4px 4px 0',\r\n                              backgroundColor: '#f0f0f0',\r\n                              borderRadius: '4px',\r\n                              fontSize: '12px'\r\n                            }}\r\n                          >\r\n                            {email}\r\n                            <Button\r\n                              type=\"text\"\r\n                              size=\"small\"\r\n                              style={{ marginLeft: '8px', padding: 0 }}\r\n                              onClick={() => handleRemoveCc(email)}\r\n                              disabled={isLoading}\r\n                            >\r\n                              ‚úï\r\n                            </Button>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </Form.Item>\r\n\r\n                  {/* Subject */}\r\n                  <Form.Item\r\n                    label=\"Email Subject\"\r\n                    name=\"subject\"\r\n                    rules={[{ required: true, message: 'Please enter email subject' }]}\r\n                  >\r\n                    <Input placeholder=\"Invoice #INV-2025-01-00001\" disabled={isLoading} />\r\n                  </Form.Item>\r\n\r\n                  {/* Custom Message */}\r\n                  <Form.Item\r\n                    label=\"Custom Message (Optional)\"\r\n                    name=\"customMessage\"\r\n                  >\r\n                    <Input.TextArea\r\n                      rows={3}\r\n                      placeholder=\"Add a personal message to include in the email...\"\r\n                      disabled={isLoading}\r\n                    />\r\n                  </Form.Item>\r\n\r\n                  {/* Schedule Date and Time */}\r\n                  <Form.Item\r\n                    label=\"Schedule Date & Time\"\r\n                    required\r\n                  >\r\n                    <DatePicker\r\n                      showTime\r\n                      format=\"YYYY-MM-DD HH:mm\"\r\n                      value={scheduleDate}\r\n                      onChange={setScheduleDate}\r\n                      disabled={isLoading}\r\n                      style={{ width: '100%' }}\r\n                      disabledDate={(current) => {\r\n                        // Disable past dates\r\n                        return current && current < dayjs().startOf('day');\r\n                      }}\r\n                    />\r\n                  </Form.Item>\r\n\r\n                  {/* Invoice Summary */}\r\n                  <Divider />\r\n                  <div style={{ marginBottom: '16px' }}>\r\n                    <h4>Invoice Summary</h4>\r\n                    <Row gutter={16}>\r\n                      <Col span={12}>\r\n                        <div style={{ fontSize: '12px', color: '#666' }}>\r\n                          <div><strong>Invoice #:</strong> {invoice.invoice_number}</div>\r\n                          <div><strong>Amount:</strong> ${invoice.total.toFixed(2)}</div>\r\n                        </div>\r\n                      </Col>\r\n                      <Col span={12}>\r\n                        <div style={{ fontSize: '12px', color: '#666' }}>\r\n                          <div><strong>Customer:</strong> {invoice.customer_name}</div>\r\n                          <div><strong>Date:</strong> {new Date(invoice.generated_at).toLocaleDateString()}</div>\r\n                        </div>\r\n                      </Col>\r\n                    </Row>\r\n                  </div>\r\n\r\n                  {/* Actions */}\r\n                  <Form.Item>\r\n                    <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n                      <Button onClick={onClose} disabled={isLoading}>\r\n                        Cancel\r\n                      </Button>\r\n                      <Button type=\"primary\" htmlType=\"submit\" loading={isLoading} icon={<ClockCircleOutlined />}>\r\n                        Schedule Email\r\n                      </Button>\r\n                    </Space>\r\n                  </Form.Item>\r\n                </Form>\r\n              )\r\n            },\r\n            {\r\n              key: 'preview',\r\n              label: <span><EyeOutlined /> Preview</span>,\r\n              children: (\r\n                <div>\r\n                  <Alert\r\n                    type=\"info\"\r\n                    message=\"Email Preview\"\r\n                    description=\"This is how the invoice will look in the customer's email\"\r\n                    showIcon\r\n                    style={{ marginBottom: '16px' }}\r\n                  />\r\n\r\n                  <div\r\n                    style={{\r\n                      border: '1px solid #d9d9d9',\r\n                      borderRadius: '4px',\r\n                      padding: '16px',\r\n                      backgroundColor: '#fafafa',\r\n                      maxHeight: '500px',\r\n                      overflowY: 'auto'\r\n                    }}\r\n                  >\r\n                    <iframe\r\n                      srcDoc={`\r\n                        <!DOCTYPE html>\r\n                        <html>\r\n                        <head>\r\n                          <meta charset=\"UTF-8\">\r\n                          <style>\r\n                            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }\r\n                          </style>\r\n                        </head>\r\n                        <body>\r\n                          <div style=\"max-width: 600px; margin: 0 auto;\">\r\n                            <p><strong>To:</strong> ${sale.customer_email || 'customer@example.com'}</p>\r\n                            <p><strong>Subject:</strong> Invoice ${invoice.invoice_number}</p>\r\n                            <hr />\r\n                            <p><em>Email content will be displayed here...</em></p>\r\n                          </div>\r\n                        </body>\r\n                        </html>\r\n                      `}\r\n                      style={{\r\n                        width: '100%',\r\n                        height: '400px',\r\n                        border: 'none',\r\n                        borderRadius: '4px'\r\n                      }}\r\n                    />\r\n                  </div>\r\n\r\n                  <p style={{ marginTop: '16px', fontSize: '12px', color: '#666' }}>\r\n                    Note: The full email preview will include all invoice details, items, and totals formatted professionally.\r\n                  </p>\r\n                </div>\r\n              )\r\n            }\r\n          ]}\r\n        />\r\n      </Spin>\r\n    </Modal>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\InvoiceGenerationModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1906,1909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1906,1909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Invoice Generation Modal Component\r\n * Allows users to generate invoices for product sales\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n  Modal,\r\n  Form,\r\n  Input,\r\n  InputNumber,\r\n  Select,\r\n  Spin,\r\n  Alert,\r\n  Row,\r\n  Col,\r\n  Space,\r\n  Divider,\r\n  Tag,\r\n} from 'antd';\r\nimport { ProductSale, ProductSaleItem } from '@/types/productSales';\r\nimport { useGenerateInvoice } from '../hooks/useGenerateInvoice';\r\nimport { invoiceService } from '../services/invoiceService';\r\n\r\ninterface InvoiceGenerationModalProps {\r\n  visible: boolean;\r\n  sale: ProductSale | null;\r\n  saleItems: ProductSaleItem[];\r\n  onClose: () => void;\r\n  onSuccess?: (invoiceNumber: string) => void;\r\n}\r\n\r\n/**\r\n * Invoice Generation Modal\r\n */\r\nexport const InvoiceGenerationModal: React.FC<InvoiceGenerationModalProps> = ({\r\n  visible,\r\n  sale,\r\n  saleItems,\r\n  onClose,\r\n  onSuccess,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [taxRate, setTaxRate] = useState(0);\r\n  const [currency, setCurrency] = useState('USD');\r\n  const [calculatedTotals, setCalculatedTotals] = useState({\r\n    subtotal: 0,\r\n    tax: 0,\r\n    total: 0,\r\n  });\r\n\r\n  const generateInvoiceMutation = useGenerateInvoice();\r\n  const isLoading = generateInvoiceMutation.isPending;\r\n\r\n  // Calculate totals when tax rate or currency changes\r\n  React.useEffect(() => {\r\n    if (saleItems.length > 0) {\r\n      const items = saleItems.map(item => ({\r\n        product_id: item.product_id,\r\n        product_name: item.product_name || 'Product',\r\n        description: item.description || '',\r\n        quantity: item.quantity,\r\n        unit_price: item.unit_price,\r\n        tax_rate: taxRate,\r\n        line_total: item.quantity * item.unit_price,\r\n      }));\r\n\r\n      const totals = invoiceService.calculateTotals(items, taxRate);\r\n      setCalculatedTotals(totals);\r\n    }\r\n  }, [taxRate, saleItems]);\r\n\r\n  const handleGenerate = async (values: any) => {\r\n    if (!sale) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await generateInvoiceMutation.mutateAsync({\r\n        sale,\r\n        saleItems,\r\n        taxRate,\r\n        currency,\r\n        paymentTerms: values.paymentTerms || 'Net 30',\r\n        notes: values.notes || '',\r\n      });\r\n\r\n      onSuccess?.(result.invoice_number);\r\n      onClose();\r\n      form.resetFields();\r\n    } catch (error) {\r\n      // Error is handled by the mutation hook\r\n      console.error('Invoice generation error:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Generate Invoice\"\r\n      open={visible}\r\n      onCancel={onClose}\r\n      onOk={() => form.submit()}\r\n      width={720}\r\n      okText=\"Generate Invoice\"\r\n      cancelText=\"Cancel\"\r\n      okButtonProps={{ loading: isLoading }}\r\n      maskClosable={false}\r\n    >\r\n      <Spin spinning={isLoading}>\r\n        {!sale ? (\r\n          <Alert message=\"No sale selected\" type=\"error\" />\r\n        ) : (\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            onFinish={handleGenerate}\r\n            initialValues={{\r\n              paymentTerms: 'Net 30',\r\n              notes: '',\r\n            }}\r\n          >\r\n            {/* Sale Information */}\r\n            <div className=\"mb-4 p-4 bg-blue-50 rounded\">\r\n              <h4 className=\"font-semibold mb-2\">Sale Information</h4>\r\n              <Row gutter={16}>\r\n                <Col span={12}>\r\n                  <p>\r\n                    <strong>Sale ID:</strong> {sale.sale_number}\r\n                  </p>\r\n                </Col>\r\n                <Col span={12}>\r\n                  <p>\r\n                    <strong>Customer:</strong> {sale.customer_name}\r\n                  </p>\r\n                </Col>\r\n                <Col span={12}>\r\n                  <p>\r\n                    <strong>Email:</strong> {sale.customer_email || 'N/A'}\r\n                  </p>\r\n                </Col>\r\n                <Col span={12}>\r\n                  <p>\r\n                    <strong>Sale Date:</strong> {new Date(sale.created_at).toLocaleDateString()}\r\n                  </p>\r\n                </Col>\r\n              </Row>\r\n            </div>\r\n\r\n            <Divider />\r\n\r\n            {/* Invoice Settings */}\r\n            <h4 className=\"font-semibold mb-4\">Invoice Settings</h4>\r\n\r\n            <Row gutter={16}>\r\n              <Col span={12}>\r\n                <Form.Item\r\n                  label=\"Currency\"\r\n                  name=\"currency\"\r\n                  initialValue={currency}\r\n                >\r\n                  <Select\r\n                    value={currency}\r\n                    onChange={setCurrency}\r\n                    options={[\r\n                      { label: 'USD - US Dollar', value: 'USD' },\r\n                      { label: 'EUR - Euro', value: 'EUR' },\r\n                      { label: 'GBP - British Pound', value: 'GBP' },\r\n                      { label: 'INR - Indian Rupee', value: 'INR' },\r\n                    ]}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col span={12}>\r\n                <Form.Item label=\"Tax Rate (%)\" name=\"taxRate\">\r\n                  <InputNumber\r\n                    min={0}\r\n                    max={100}\r\n                    step={0.01}\r\n                    value={taxRate}\r\n                    onChange={(value) => setTaxRate(value || 0)}\r\n                    placeholder=\"Enter tax rate\"\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n\r\n            <Row gutter={16}>\r\n              <Col span={12}>\r\n                <Form.Item\r\n                  label=\"Payment Terms\"\r\n                  name=\"paymentTerms\"\r\n                  rules={[{ required: true, message: 'Payment terms are required' }]}\r\n                >\r\n                  <Select\r\n                    options={[\r\n                      { label: 'Net 15', value: 'Net 15' },\r\n                      { label: 'Net 30', value: 'Net 30' },\r\n                      { label: 'Net 45', value: 'Net 45' },\r\n                      { label: 'Net 60', value: 'Net 60' },\r\n                      { label: 'Due on Receipt', value: 'Due on Receipt' },\r\n                    ]}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n\r\n            <Form.Item label=\"Notes\" name=\"notes\">\r\n              <Input.TextArea\r\n                placeholder=\"Add any additional notes to the invoice\"\r\n                rows={3}\r\n              />\r\n            </Form.Item>\r\n\r\n            <Divider />\r\n\r\n            {/* Invoice Items Summary */}\r\n            <h4 className=\"font-semibold mb-4\">Invoice Items</h4>\r\n            <div className=\"mb-4 p-3 bg-gray-50 rounded\">\r\n              <table style={{ width: '100%', fontSize: '12px' }}>\r\n                <thead>\r\n                  <tr style={{ borderBottom: '1px solid #ddd' }}>\r\n                    <th style={{ padding: '8px', textAlign: 'left' }}>Product</th>\r\n                    <th style={{ padding: '8px', textAlign: 'center' }}>Qty</th>\r\n                    <th style={{ padding: '8px', textAlign: 'right' }}>Price</th>\r\n                    <th style={{ padding: '8px', textAlign: 'right' }}>Total</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {saleItems.map((item, index) => (\r\n                    <tr key={index} style={{ borderBottom: '1px solid #eee' }}>\r\n                      <td style={{ padding: '8px' }}>{item.product_name}</td>\r\n                      <td style={{ padding: '8px', textAlign: 'center' }}>{item.quantity}</td>\r\n                      <td style={{ padding: '8px', textAlign: 'right' }}>\r\n                        {invoiceService.formatCurrency(item.unit_price, currency)}\r\n                      </td>\r\n                      <td style={{ padding: '8px', textAlign: 'right' }}>\r\n                        {invoiceService.formatCurrency(\r\n                          item.quantity * item.unit_price,\r\n                          currency\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n\r\n            {/* Invoice Totals */}\r\n            <div className=\"p-4 bg-blue-50 rounded\" style={{ marginBottom: '16px' }}>\r\n              <Row justify=\"end\" gutter={16} style={{ marginBottom: '8px' }}>\r\n                <Col span={12}>\r\n                  <strong>Subtotal:</strong>\r\n                </Col>\r\n                <Col span={12} style={{ textAlign: 'right' }}>\r\n                  <Tag color=\"blue\">{invoiceService.formatCurrency(calculatedTotals.subtotal, currency)}</Tag>\r\n                </Col>\r\n              </Row>\r\n              {taxRate > 0 && (\r\n                <Row justify=\"end\" gutter={16} style={{ marginBottom: '8px' }}>\r\n                  <Col span={12}>\r\n                    <strong>Tax ({taxRate}%):</strong>\r\n                  </Col>\r\n                  <Col span={12} style={{ textAlign: 'right' }}>\r\n                    <Tag color=\"orange\">{invoiceService.formatCurrency(calculatedTotals.tax, currency)}</Tag>\r\n                  </Col>\r\n                </Row>\r\n              )}\r\n              <Row justify=\"end\" gutter={16}>\r\n                <Col span={12}>\r\n                  <strong style={{ fontSize: '16px' }}>Total:</strong>\r\n                </Col>\r\n                <Col span={12} style={{ textAlign: 'right' }}>\r\n                  <Tag color=\"green\" style={{ fontSize: '14px', padding: '4px 12px' }}>\r\n                    {invoiceService.formatCurrency(calculatedTotals.total, currency)}\r\n                  </Tag>\r\n                </Col>\r\n              </Row>\r\n            </div>\r\n\r\n            <Alert\r\n              message=\"Note: Invoice will be generated and stored. Make sure all details are correct before proceeding.\"\r\n              type=\"info\"\r\n              showIcon\r\n              style={{ marginTop: '16px' }}\r\n            />\r\n          </Form>\r\n        )}\r\n      </Spin>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default InvoiceGenerationModal;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\NotificationHistoryPanel.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadNotificationHistory'. Either include it or remove the dependency array.","line":93,"column":6,"nodeType":"ArrayExpression","endLine":93,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [loadNotificationHistory, sale?.id]","fix":{"range":[2519,2529],"text":"[loadNotificationHistory, sale?.id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Notification History Panel\r\n * Displays all notifications sent for a specific product sale\r\n * Shows notification type, channels, timestamp, and status\r\n */\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Empty,\r\n  Tag,\r\n  Space,\r\n  Button,\r\n  Spin,\r\n  Tooltip,\r\n  Badge,\r\n  Timeline,\r\n} from 'antd';\r\nimport {\r\n  BellOutlined,\r\n  MailOutlined,\r\n  PhoneOutlined,\r\n  CheckCircleOutlined,\r\n  ClockCircleOutlined,\r\n  DeleteOutlined,\r\n  ReloadOutlined,\r\n} from '@ant-design/icons';\r\nimport { ProductSale } from '@/types/productSales';\r\nimport { productSalesNotificationService } from '../services/productSalesNotificationService';\r\n\r\ninterface NotificationHistoryPanelProps {\r\n  sale: ProductSale | null;\r\n}\r\n\r\ninterface NotificationItem {\r\n  id: string;\r\n  type: string;\r\n  channels: string[];\r\n  title: string;\r\n  message: string;\r\n  createdAt: string;\r\n  status: 'sent' | 'pending' | 'failed';\r\n}\r\n\r\nconst notificationTypeConfig: Record<string, { label: string; color: string }> = {\r\n  status_change: { label: 'Status Update', color: 'blue' },\r\n  approval_required: { label: 'Approval', color: 'orange' },\r\n  shipment_ready: { label: 'Shipment', color: 'cyan' },\r\n  delivery_confirmed: { label: 'Delivered', color: 'green' },\r\n  invoice_generated: { label: 'Invoice', color: 'purple' },\r\n  payment_received: { label: 'Payment', color: 'gold' },\r\n  sale_cancelled: { label: 'Cancelled', color: 'red' },\r\n  refund_processed: { label: 'Refund', color: 'magenta' },\r\n};\r\n\r\nconst getChannelIcon = (channel: string) => {\r\n  switch (channel) {\r\n    case 'email':\r\n      return <MailOutlined title=\"Email\" />;\r\n    case 'sms':\r\n      return <PhoneOutlined title=\"SMS\" />;\r\n    case 'in_app':\r\n      return <BellOutlined title=\"In-App\" />;\r\n    default:\r\n      return null;\r\n  }\r\n};\r\n\r\nconst getStatusIcon = (status: string) => {\r\n  switch (status) {\r\n    case 'sent':\r\n      return <CheckCircleOutlined style={{ color: '#52c41a' }} />;\r\n    case 'pending':\r\n      return <ClockCircleOutlined style={{ color: '#faad14' }} />;\r\n    case 'failed':\r\n      return <CheckCircleOutlined style={{ color: '#f5222d' }} />;\r\n    default:\r\n      return null;\r\n  }\r\n};\r\n\r\nexport const NotificationHistoryPanel: React.FC<NotificationHistoryPanelProps> = ({\r\n  sale,\r\n}) => {\r\n  const [notifications, setNotifications] = useState<NotificationItem[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (sale?.id) {\r\n      loadNotificationHistory();\r\n    }\r\n  }, [sale?.id]);\r\n\r\n  const loadNotificationHistory = async () => {\r\n    if (!sale?.id) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      const history = await productSalesNotificationService.getNotificationHistory(sale.id);\r\n      \r\n      const mapped: NotificationItem[] = history.map(item => ({\r\n        id: item.id,\r\n        type: item.type,\r\n        channels: item.channels_sent,\r\n        title: item.title,\r\n        message: item.message,\r\n        createdAt: item.created_at,\r\n        status: item.status,\r\n      }));\r\n\r\n      setNotifications(mapped);\r\n    } catch (error) {\r\n      console.error('Error loading notification history:', error);\r\n      setNotifications([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    loadNotificationHistory();\r\n  };\r\n\r\n  if (!sale) {\r\n    return (\r\n      <Card title=\"Notification History\">\r\n        <Empty description=\"No sale selected\" />\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Type',\r\n      dataIndex: 'type',\r\n      key: 'type',\r\n      width: 150,\r\n      render: (type: string) => {\r\n        const config = notificationTypeConfig[type];\r\n        return (\r\n          <Tag color={config?.color || 'default'}>\r\n            {config?.label || type}\r\n          </Tag>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      title: 'Channels',\r\n      dataIndex: 'channels',\r\n      key: 'channels',\r\n      width: 150,\r\n      render: (channels: string[]) => (\r\n        <Space size=\"small\">\r\n          {channels.map(channel => (\r\n            <Tooltip key={channel} title={channel}>\r\n              {getChannelIcon(channel)}\r\n            </Tooltip>\r\n          ))}\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Message',\r\n      dataIndex: 'title',\r\n      key: 'title',\r\n      render: (title: string, record: NotificationItem) => (\r\n        <Tooltip title={record.message}>\r\n          <span>{title}</span>\r\n        </Tooltip>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 100,\r\n      render: (status: string) => (\r\n        <Space size=\"small\">\r\n          {getStatusIcon(status)}\r\n          <Tag color={status === 'sent' ? 'green' : status === 'pending' ? 'orange' : 'red'}>\r\n            {status.charAt(0).toUpperCase() + status.slice(1)}\r\n          </Tag>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Sent At',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      width: 180,\r\n      render: (date: string) => {\r\n        try {\r\n          return new Date(date).toLocaleString();\r\n        } catch {\r\n          return date;\r\n        }\r\n      },\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Card\r\n      title={\r\n        <Space>\r\n          <BellOutlined />\r\n          <span>Notification History</span>\r\n          <Badge count={notifications.length} style={{ backgroundColor: '#1890ff' }} />\r\n        </Space>\r\n      }\r\n      extra={\r\n        <Button\r\n          type=\"text\"\r\n          icon={<ReloadOutlined />}\r\n          onClick={handleRefresh}\r\n          loading={loading}\r\n        >\r\n          Refresh\r\n        </Button>\r\n      }\r\n      style={{ marginTop: 24 }}\r\n    >\r\n      <Spin spinning={loading}>\r\n        {notifications.length === 0 ? (\r\n          <Empty description=\"No notifications sent yet\" />\r\n        ) : (\r\n          <>\r\n            <div style={{ marginBottom: 24 }}>\r\n              <Timeline\r\n                items={notifications.map(notif => ({\r\n                  dot: getStatusIcon(notif.status),\r\n                  children: (\r\n                    <div>\r\n                      <div style={{ fontWeight: 500 }}>\r\n                        {notificationTypeConfig[notif.type]?.label || notif.type}\r\n                      </div>\r\n                      <div style={{ fontSize: 12, color: '#8c8c8c', marginTop: 4 }}>\r\n                        {notif.title}\r\n                      </div>\r\n                      <div style={{ fontSize: 12, color: '#595959', marginTop: 4 }}>\r\n                        {new Date(notif.createdAt).toLocaleString()}\r\n                      </div>\r\n                      <div style={{ marginTop: 8 }}>\r\n                        <Space size=\"small\">\r\n                          {notif.channels.map(channel => (\r\n                            <Tag key={channel} color=\"blue\" style={{ fontSize: 11 }}>\r\n                              {channel}\r\n                            </Tag>\r\n                          ))}\r\n                        </Space>\r\n                      </div>\r\n                    </div>\r\n                  ),\r\n                }))}\r\n              />\r\n            </div>\r\n\r\n            <Table\r\n              columns={columns}\r\n              dataSource={notifications.map((n, i) => ({ ...n, key: n.id || i }))}\r\n              pagination={{ pageSize: 10 }}\r\n              size=\"small\"\r\n              bordered\r\n            />\r\n          </>\r\n        )}\r\n      </Spin>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default NotificationHistoryPanel;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\NotificationPreferencesModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPreferences'. Either include it or remove the dependency array.","line":119,"column":6,"nodeType":"ArrayExpression","endLine":119,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [loadPreferences, visible]","fix":{"range":[2849,2858],"text":"[loadPreferences, visible]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Notification Preferences Modal\r\n * Allows users to configure notification preferences for different events and channels\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n  Modal,\r\n  Form,\r\n  Switch,\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Divider,\r\n  Space,\r\n  Spin,\r\n  message,\r\n  Alert,\r\n  Button,\r\n  Tabs,\r\n} from 'antd';\r\nimport {\r\n  BellOutlined,\r\n  MailOutlined,\r\n  PhoneOutlined,\r\n  AppstoreOutlined,\r\n  CheckOutlined,\r\n  ExclamationCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport { productSalesNotificationService } from '../services/productSalesNotificationService';\r\n\r\ninterface NotificationPreferencesModalProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onSuccess?: () => void;\r\n}\r\n\r\ninterface PreferencesData {\r\n  email: boolean;\r\n  sms: boolean;\r\n  push: boolean;\r\n  in_app: boolean;\r\n  categories: Record<\r\n    string,\r\n    {\r\n      email: boolean;\r\n      sms: boolean;\r\n      push: boolean;\r\n      in_app: boolean;\r\n    }\r\n  >;\r\n}\r\n\r\nconst notificationTypes = [\r\n  {\r\n    key: 'status_change',\r\n    label: 'Status Updates',\r\n    description: 'Get notified when your order status changes',\r\n  },\r\n  {\r\n    key: 'approval_required',\r\n    label: 'Approval Required',\r\n    description: 'Get notified when an approval is needed',\r\n  },\r\n  {\r\n    key: 'shipment_ready',\r\n    label: 'Shipment Ready',\r\n    description: 'Get notified when your order is ready to ship',\r\n  },\r\n  {\r\n    key: 'delivery_confirmed',\r\n    label: 'Delivery Confirmed',\r\n    description: 'Get notified when your order is delivered',\r\n  },\r\n  {\r\n    key: 'invoice_generated',\r\n    label: 'Invoice Generated',\r\n    description: 'Get notified when an invoice is generated',\r\n  },\r\n  {\r\n    key: 'payment_received',\r\n    label: 'Payment Received',\r\n    description: 'Get notified when payment is received',\r\n  },\r\n  {\r\n    key: 'sale_cancelled',\r\n    label: 'Order Cancelled',\r\n    description: 'Get notified when an order is cancelled',\r\n  },\r\n  {\r\n    key: 'refund_processed',\r\n    label: 'Refund Processed',\r\n    description: 'Get notified when a refund is processed',\r\n  },\r\n];\r\n\r\nconst channels = [\r\n  { key: 'email', label: 'Email', icon: <MailOutlined /> },\r\n  { key: 'sms', label: 'SMS', icon: <PhoneOutlined /> },\r\n  { key: 'push', label: 'Push', icon: <BellOutlined /> },\r\n  { key: 'in_app', label: 'In-App', icon: <AppstoreOutlined /> },\r\n];\r\n\r\nexport const NotificationPreferencesModal: React.FC<NotificationPreferencesModalProps> = ({\r\n  visible,\r\n  onClose,\r\n  onSuccess,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [loading, setLoading] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [preferences, setPreferences] = useState<PreferencesData | null>(null);\r\n  const [changed, setChanged] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      loadPreferences();\r\n    }\r\n  }, [visible]);\r\n\r\n  const loadPreferences = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const prefs = await productSalesNotificationService.getUserNotificationPreferences();\r\n      setPreferences(prefs);\r\n      form.setFieldsValue(prefs);\r\n      setChanged(false);\r\n    } catch (error) {\r\n      console.error('Error loading preferences:', error);\r\n      message.error('Failed to load notification preferences');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    try {\r\n      setSaving(true);\r\n      const values = await form.validateFields();\r\n      await productSalesNotificationService.updateUserNotificationPreferences(values);\r\n      message.success('Notification preferences updated successfully');\r\n      setChanged(false);\r\n      setPreferences(values);\r\n      if (onSuccess) {\r\n        onSuccess();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving preferences:', error);\r\n      message.error('Failed to save notification preferences');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (changed) {\r\n      Modal.confirm({\r\n        icon: <ExclamationCircleOutlined />,\r\n        title: 'Unsaved Changes',\r\n        content: 'You have unsaved changes. Are you sure you want to close?',\r\n        okText: 'Close',\r\n        cancelText: 'Continue Editing',\r\n        onOk: () => {\r\n          onClose();\r\n        },\r\n      });\r\n    } else {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleFormChange = () => {\r\n    setChanged(true);\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <Space>\r\n          <BellOutlined />\r\n          <span>Notification Preferences</span>\r\n        </Space>\r\n      }\r\n      open={visible}\r\n      onCancel={handleClose}\r\n      width={900}\r\n      footer={\r\n        <Space style={{ float: 'right' }}>\r\n          <Button onClick={handleClose}>Cancel</Button>\r\n          <Button type=\"primary\" onClick={handleSave} loading={saving} disabled={!changed || loading}>\r\n            Save Changes\r\n          </Button>\r\n        </Space>\r\n      }\r\n    >\r\n      <Spin spinning={loading}>\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          onValuesChange={handleFormChange}\r\n          initialValues={preferences || {}}\r\n        >\r\n          {/* Global Channel Preferences */}\r\n          <div style={{ marginBottom: 24 }}>\r\n            <h4>Global Notification Channels</h4>\r\n            <Alert\r\n              message=\"Configure which channels to use for all notifications\"\r\n              type=\"info\"\r\n              showIcon\r\n              style={{ marginBottom: 16 }}\r\n            />\r\n            <Row gutter={[16, 16]}>\r\n              {channels.map(channel => (\r\n                <Col key={channel.key} xs={24} sm={12} md={6}>\r\n                  <Card size=\"small\" hoverable>\r\n                    <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                      <Space>\r\n                        {channel.icon}\r\n                        <span>{channel.label}</span>\r\n                      </Space>\r\n                      <Form.Item\r\n                        name={channel.key}\r\n                        valuePropName=\"checked\"\r\n                        style={{ margin: 0 }}\r\n                      >\r\n                        <Switch />\r\n                      </Form.Item>\r\n                    </Space>\r\n                  </Card>\r\n                </Col>\r\n              ))}\r\n            </Row>\r\n          </div>\r\n\r\n          <Divider />\r\n\r\n          {/* Notification Type Preferences */}\r\n          <div>\r\n            <h4>Notification Type Preferences</h4>\r\n            <Alert\r\n              message=\"Configure channels for specific notification types\"\r\n              type=\"info\"\r\n              showIcon\r\n              style={{ marginBottom: 16 }}\r\n            />\r\n\r\n            <Tabs\r\n              items={notificationTypes.map(type => ({\r\n                key: type.key,\r\n                label: (\r\n                  <Tooltip title={type.description}>\r\n                    {type.label}\r\n                  </Tooltip>\r\n                ),\r\n                children: (\r\n                  <div style={{ paddingTop: 16 }}>\r\n                    <p style={{ color: '#8c8c8c', marginBottom: 16 }}>\r\n                      {type.description}\r\n                    </p>\r\n                    <Row gutter={[16, 16]}>\r\n                      {channels.map(channel => (\r\n                        <Col key={channel.key} xs={24} sm={12} md={6}>\r\n                          <Card size=\"small\" hoverable>\r\n                            <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                              <Space>\r\n                                {channel.icon}\r\n                                <span>{channel.label}</span>\r\n                              </Space>\r\n                              <Form.Item\r\n                                name={['categories', type.key, channel.key]}\r\n                                valuePropName=\"checked\"\r\n                                style={{ margin: 0 }}\r\n                              >\r\n                                <Switch />\r\n                              </Form.Item>\r\n                            </Space>\r\n                          </Card>\r\n                        </Col>\r\n                      ))}\r\n                    </Row>\r\n                  </div>\r\n                ),\r\n              }))}\r\n            />\r\n          </div>\r\n        </Form>\r\n      </Spin>\r\n    </Modal>\r\n  );\r\n};\r\n\r\ninterface TooltipProps {\r\n  title: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst Tooltip: React.FC<TooltipProps> = ({ title, children }) => (\r\n  <div title={title}>{children}</div>\r\n);\r\n\r\nexport default NotificationPreferencesModal;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\ProductSaleDetailPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2058,2061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2058,2061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sale Detail Panel\r\n * Side drawer for viewing product sale details in read-only mode\r\n * Aligned with Contracts module standards\r\n * RBAC Integration: Controls view and action permissions\r\n */\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport {\r\n  Drawer,\r\n  Descriptions,\r\n  Button,\r\n  Space,\r\n  Divider,\r\n  Tag,\r\n  Empty,\r\n  Row,\r\n  Col,\r\n  Statistic,\r\n  Modal,\r\n  message,\r\n  Tooltip,\r\n} from 'antd';\r\nimport {\r\n  EditOutlined,\r\n  MailOutlined,\r\n  CalendarOutlined,\r\n  DollarOutlined,\r\n  UserOutlined,\r\n  ShoppingCartOutlined,\r\n  FileTextOutlined,\r\n  DeleteOutlined,\r\n  SwapOutlined,\r\n  FilePdfOutlined,\r\n  BellOutlined,\r\n  LockOutlined,\r\n} from '@ant-design/icons';\r\nimport { ProductSale, ProductSaleItem } from '@/types/productSales';\r\nimport { StatusTransitionModal } from './StatusTransitionModal';\r\nimport { InvoiceGenerationModal } from './InvoiceGenerationModal';\r\nimport { InvoiceEmailModal } from './InvoiceEmailModal';\r\nimport { NotificationHistoryPanel } from './NotificationHistoryPanel';\r\nimport { useGenerateContractFromSale } from '../hooks/useGenerateContractFromSale';\r\nimport { useProductSalesPermissions } from '../hooks/useProductSalesPermissions';\r\n\r\ninterface ProductSaleDetailPanelProps {\r\n  visible: boolean;\r\n  productSale: ProductSale | null;\r\n  saleItems?: ProductSaleItem[];\r\n  onClose: () => void;\r\n  onEdit: () => void;\r\n  onGenerateContract?: () => void;\r\n  onDelete?: () => void;\r\n  onStatusChanged?: () => void;\r\n  onInvoiceGenerated?: (invoiceNumber: string) => void;\r\n}\r\n\r\nexport const ProductSaleDetailPanel: React.FC<ProductSaleDetailPanelProps> = ({\r\n  visible,\r\n  productSale,\r\n  saleItems = [],\r\n  onClose,\r\n  onEdit,\r\n  onGenerateContract,\r\n  onDelete,\r\n  onStatusChanged,\r\n  onInvoiceGenerated,\r\n}) => {\r\n  const [showStatusTransition, setShowStatusTransition] = useState(false);\r\n  const [showInvoiceGeneration, setShowInvoiceGeneration] = useState(false);\r\n  const [showInvoiceEmail, setShowInvoiceEmail] = useState(false);\r\n  const [generatedInvoice, setGeneratedInvoice] = useState<any>(null);\r\n  const [showNotificationHistory, setShowNotificationHistory] = useState(false);\r\n  \r\n  // Hook for generating contracts from sales\r\n  const { generateContract } = useGenerateContractFromSale();\r\n  \r\n  // RBAC permission checking\r\n  const permissions = useProductSalesPermissions({\r\n    sale: productSale || undefined,\r\n    autoLoad: visible, // Load permissions when drawer opens\r\n  });\r\n\r\n  if (!productSale) {\r\n    return null;\r\n  }\r\n\r\n  const handleGenerateContract = () => {\r\n    Modal.confirm({\r\n      title: 'Generate Service Contract',\r\n      content: `Create a new service contract for sale ${productSale.sale_number}? You'll be redirected to the contract creation form with pre-filled data from this sale.`,\r\n      okText: 'Yes, Generate',\r\n      cancelText: 'Cancel',\r\n      onOk() {\r\n        try {\r\n          // Navigate to contract creation with pre-filled data\r\n          generateContract(productSale);\r\n          \r\n          // Call callback if provided\r\n          if (onGenerateContract) {\r\n            onGenerateContract();\r\n          }\r\n        } catch (error) {\r\n          console.error('Error generating contract:', error);\r\n          message.error('Failed to generate contract. Please try again.');\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    Modal.confirm({\r\n      title: 'Delete Product Sale',\r\n      content: `Are you sure you want to delete sale ${productSale.sale_number}? This action cannot be undone.`,\r\n      okText: 'Delete',\r\n      okType: 'danger',\r\n      cancelText: 'Cancel',\r\n      onOk() {\r\n        if (onDelete) {\r\n          onDelete();\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  const getStatusColor = (status: string): string => {\r\n    const colorMap: Record<string, string> = {\r\n      'draft': 'default',\r\n      'pending': 'processing',\r\n      'confirmed': 'success',\r\n      'delivered': 'success',\r\n      'cancelled': 'error',\r\n      'refunded': 'warning',\r\n    };\r\n    return colorMap[status] || 'default';\r\n  };\r\n\r\n  const formatCurrency = (amount: number): string => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n    }).format(amount);\r\n  };\r\n\r\n  const formatDate = (dateString: string): string => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n    });\r\n  };\r\n\r\n  const displayStatus = productSale.status\r\n    .replace('_', ' ')\r\n    .replace(/\\b\\w/g, l => l.toUpperCase());\r\n\r\n  return (\r\n    <>\r\n      <Drawer\r\n        title=\"Product Sale Details\"\r\n        placement=\"right\"\r\n        width={550}\r\n        onClose={onClose}\r\n        open={visible}\r\n        footer={\r\n        <Space style={{ float: 'right' }}>\r\n          <Button onClick={onClose}>Close</Button>\r\n          \r\n          {/* View Notification History - Always available if viewing details */}\r\n          <Tooltip title=\"View notification history\">\r\n            <Button \r\n              icon={<BellOutlined />} \r\n              onClick={() => setShowNotificationHistory(true)}\r\n            >\r\n              Notifications\r\n            </Button>\r\n          </Tooltip>\r\n          \r\n          {/* Change Status - Only if permission granted */}\r\n          {permissions.canChangeStatus ? (\r\n            <Tooltip title=\"Change sale status\">\r\n              <Button \r\n                icon={<SwapOutlined />} \r\n                onClick={() => setShowStatusTransition(true)}\r\n              >\r\n                Change Status\r\n              </Button>\r\n            </Tooltip>\r\n          ) : (\r\n            <Tooltip title=\"Permission denied: Cannot change status\">\r\n              <Button \r\n                icon={<SwapOutlined />}\r\n                disabled\r\n              >\r\n                Change Status\r\n              </Button>\r\n            </Tooltip>\r\n          )}\r\n          \r\n          {/* Generate Invoice - Only if delivered and permitted */}\r\n          {productSale.status === 'delivered' && saleItems.length > 0 && (\r\n            <>\r\n              {permissions.canExport ? (\r\n                <Tooltip title=\"Generate invoice for this sale\">\r\n                  <Button \r\n                    icon={<FilePdfOutlined />} \r\n                    onClick={() => setShowInvoiceGeneration(true)}\r\n                    title=\"Generate invoice from this sale\"\r\n                  >\r\n                    Generate Invoice\r\n                  </Button>\r\n                </Tooltip>\r\n              ) : (\r\n                <Tooltip title=\"Permission denied: Cannot generate invoices\">\r\n                  <Button \r\n                    icon={<FilePdfOutlined />}\r\n                    disabled\r\n                    title=\"Permission denied\"\r\n                  >\r\n                    Generate Invoice\r\n                  </Button>\r\n                </Tooltip>\r\n              )}\r\n              \r\n              {generatedInvoice && (\r\n                permissions.canExport ? (\r\n                  <Tooltip title=\"Send generated invoice to customer email\">\r\n                    <Button \r\n                      icon={<MailOutlined />} \r\n                      onClick={() => setShowInvoiceEmail(true)}\r\n                      title=\"Send invoice via email\"\r\n                      type=\"default\"\r\n                    >\r\n                      Send Invoice Email\r\n                    </Button>\r\n                  </Tooltip>\r\n                ) : (\r\n                  <Tooltip title=\"Permission denied: Cannot send invoices\">\r\n                    <Button \r\n                      icon={<MailOutlined />}\r\n                      disabled\r\n                      type=\"default\"\r\n                    >\r\n                      Send Invoice Email\r\n                    </Button>\r\n                  </Tooltip>\r\n                )\r\n              )}\r\n            </>\r\n          )}\r\n          \r\n          {/* Generate Contract - Only if permitted */}\r\n          {!productSale.service_contract_id && (\r\n            permissions.canCreate ? (\r\n              <Button \r\n                icon={<FileTextOutlined />} \r\n                onClick={handleGenerateContract}\r\n                title=\"Generate a service contract from this sale\"\r\n              >\r\n                Generate Contract\r\n              </Button>\r\n            ) : (\r\n              <Tooltip title=\"Permission denied: Cannot generate contracts\">\r\n                <Button \r\n                  icon={<FileTextOutlined />}\r\n                  disabled\r\n                  title=\"Permission denied\"\r\n                >\r\n                  Generate Contract\r\n                </Button>\r\n              </Tooltip>\r\n            )\r\n          )}\r\n          \r\n          {/* Delete - Only if permitted */}\r\n          {onDelete && (\r\n            permissions.canDelete ? (\r\n              <Button \r\n                danger \r\n                icon={<DeleteOutlined />} \r\n                onClick={handleDelete}\r\n                title=\"Delete this product sale\"\r\n              >\r\n                Delete\r\n              </Button>\r\n            ) : (\r\n              <Tooltip title=\"Permission denied: Cannot delete sales\">\r\n                <Button \r\n                  danger\r\n                  icon={<DeleteOutlined />}\r\n                  disabled\r\n                  title=\"Permission denied\"\r\n                >\r\n                  Delete\r\n                </Button>\r\n              </Tooltip>\r\n            )\r\n          )}\r\n          \r\n          {/* Edit - Only if permitted */}\r\n          {permissions.canEdit ? (\r\n            <Button type=\"primary\" icon={<EditOutlined />} onClick={onEdit}>\r\n              Edit\r\n            </Button>\r\n          ) : (\r\n            <Tooltip title=\"Permission denied: Cannot edit sales\">\r\n              <Button type=\"primary\" icon={<LockOutlined />} disabled>\r\n                Edit\r\n              </Button>\r\n            </Tooltip>\r\n          )}\r\n        </Space>\r\n      }\r\n    >\r\n      {productSale ? (\r\n        <div>\r\n          {/* Key Metrics */}\r\n          <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n            <Col xs={12}>\r\n              <Statistic\r\n                title=\"Total Value\"\r\n                value={formatCurrency(productSale.total_value || 0)}\r\n                prefix={<DollarOutlined />}\r\n                valueStyle={{ color: '#1890ff', fontSize: 18 }}\r\n              />\r\n            </Col>\r\n            <Col xs={12}>\r\n              <Statistic\r\n                title=\"Quantity\"\r\n                value={productSale.quantity}\r\n                prefix={<ShoppingCartOutlined />}\r\n                valueStyle={{ fontSize: 18 }}\r\n              />\r\n            </Col>\r\n          </Row>\r\n\r\n          <Divider />\r\n\r\n          {/* Sale Information */}\r\n          <h3 style={{ marginBottom: 16, fontWeight: 600 }}>Sale Information</h3>\r\n          <Descriptions column={1} size=\"small\" bordered>\r\n            <Descriptions.Item label=\"Sale Number\">\r\n              {productSale.sale_number}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Status\">\r\n              <Tag color={getStatusColor(productSale.status)}>\r\n                {displayStatus}\r\n              </Tag>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Sale Date\">\r\n              <span style={{ display: 'flex', alignItems: 'center' }}>\r\n                <CalendarOutlined style={{ marginRight: 8 }} />\r\n                {formatDate(productSale.sale_date)}\r\n              </span>\r\n            </Descriptions.Item>\r\n            {productSale.delivery_date && (\r\n              <Descriptions.Item label=\"Delivery Date\">\r\n                <span style={{ display: 'flex', alignItems: 'center' }}>\r\n                  <CalendarOutlined style={{ marginRight: 8 }} />\r\n                  {formatDate(productSale.delivery_date)}\r\n                </span>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n\r\n          <Divider />\r\n\r\n          {/* Customer Information */}\r\n          <h3 style={{ marginBottom: 16, fontWeight: 600 }}>Customer Information</h3>\r\n          <Descriptions column={1} size=\"small\" bordered>\r\n            <Descriptions.Item label=\"Customer Name\">\r\n              <span style={{ display: 'flex', alignItems: 'center' }}>\r\n                <UserOutlined style={{ marginRight: 8 }} />\r\n                {productSale.customer_name}\r\n              </span>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Customer ID\">\r\n              {productSale.customer_id}\r\n            </Descriptions.Item>\r\n            {productSale.customer_email && (\r\n              <Descriptions.Item label=\"Email\">\r\n                <a href={`mailto:${productSale.customer_email}`}>\r\n                  <MailOutlined style={{ marginRight: 8 }} />\r\n                  {productSale.customer_email}\r\n                </a>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n\r\n          <Divider />\r\n\r\n          {/* Product Information */}\r\n          <h3 style={{ marginBottom: 16, fontWeight: 600 }}>Product Information</h3>\r\n          <Descriptions column={1} size=\"small\" bordered>\r\n            <Descriptions.Item label=\"Product Name\">\r\n              <span style={{ display: 'flex', alignItems: 'center' }}>\r\n                <ShoppingCartOutlined style={{ marginRight: 8 }} />\r\n                {productSale.product_name}\r\n              </span>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Product ID\">\r\n              {productSale.product_id}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Quantity\">\r\n              {productSale.quantity}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Unit Price\">\r\n              {formatCurrency(productSale.unit_price || 0)}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Total Value\">\r\n              <span style={{ fontWeight: 600, color: '#1890ff' }}>\r\n                {formatCurrency(productSale.total_value || 0)}\r\n              </span>\r\n            </Descriptions.Item>\r\n          </Descriptions>\r\n\r\n          <Divider />\r\n\r\n          {/* Warranty Information */}\r\n          <h3 style={{ marginBottom: 16, fontWeight: 600 }}>Warranty Information</h3>\r\n          <Descriptions column={1} size=\"small\" bordered>\r\n            <Descriptions.Item label=\"Warranty Period\">\r\n              {productSale.warranty_period ? `${productSale.warranty_period} months` : 'Not specified'}\r\n            </Descriptions.Item>\r\n            {productSale.warranty_expiry_date && (\r\n              <Descriptions.Item label=\"Warranty Expiry Date\">\r\n                <span style={{ display: 'flex', alignItems: 'center' }}>\r\n                  <CalendarOutlined style={{ marginRight: 8 }} />\r\n                  {formatDate(productSale.warranty_expiry_date)}\r\n                </span>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n\r\n          {/* Additional Information */}\r\n          {productSale.notes && (\r\n            <>\r\n              <Divider />\r\n              <h3 style={{ marginBottom: 16, fontWeight: 600 }}>Notes</h3>\r\n              <div\r\n                style={{\r\n                  padding: 12,\r\n                  background: '#f5f5f5',\r\n                  borderRadius: 4,\r\n                  whiteSpace: 'pre-wrap',\r\n                  wordBreak: 'break-word',\r\n                }}\r\n              >\r\n                {productSale.notes}\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {/* Service Contract Link */}\r\n          {productSale.service_contract_id && (\r\n            <>\r\n              <Divider />\r\n              <h3 style={{ marginBottom: 16, fontWeight: 600 }}>Service Contract</h3>\r\n              <Descriptions column={1} size=\"small\" bordered>\r\n                <Descriptions.Item label=\"Contract ID\">\r\n                  <a href={`/app/service-contracts/${productSale.service_contract_id}`} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                    {productSale.service_contract_id}\r\n                  </a>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Status\">\r\n                  <Tag color=\"blue\">Linked</Tag>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Action\">\r\n                  <Button \r\n                    type=\"link\" \r\n                    size=\"small\"\r\n                    onClick={() => window.open(`/app/service-contracts/${productSale.service_contract_id}`, '_blank')}\r\n                  >\r\n                    View Contract Details\r\n                  </Button>\r\n                </Descriptions.Item>\r\n              </Descriptions>\r\n            </>\r\n          )}\r\n\r\n          {/* Metadata */}\r\n          {productSale.created_at && (\r\n            <>\r\n              <Divider />\r\n              <div style={{ fontSize: 12, color: '#999' }}>\r\n                <div>Created: {formatDate(productSale.created_at)}</div>\r\n                {productSale.updated_at && (\r\n                  <div>Last Updated: {formatDate(productSale.updated_at)}</div>\r\n                )}\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <Empty description=\"No sale selected\" />\r\n      )}\r\n      </Drawer>\r\n\r\n      {/* Status Transition Modal */}\r\n      <StatusTransitionModal\r\n        visible={showStatusTransition}\r\n        sale={productSale}\r\n        onClose={() => setShowStatusTransition(false)}\r\n        onSuccess={() => {\r\n          setShowStatusTransition(false);\r\n          if (onStatusChanged) {\r\n            onStatusChanged();\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* Invoice Generation Modal */}\r\n      {productSale && (\r\n        <InvoiceGenerationModal\r\n          visible={showInvoiceGeneration}\r\n          sale={productSale}\r\n          saleItems={saleItems}\r\n          onClose={() => setShowInvoiceGeneration(false)}\r\n          onSuccess={(invoice) => {\r\n            setShowInvoiceGeneration(false);\r\n            setGeneratedInvoice(invoice);\r\n            message.success(`Invoice ${invoice.invoice_number} generated successfully`);\r\n            if (onInvoiceGenerated) {\r\n              onInvoiceGenerated(invoice.invoice_number);\r\n            }\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Invoice Email Modal */}\r\n      {productSale && generatedInvoice && (\r\n        <InvoiceEmailModal\r\n          visible={showInvoiceEmail}\r\n          invoice={generatedInvoice}\r\n          sale={productSale}\r\n          saleItems={saleItems}\r\n          onClose={() => setShowInvoiceEmail(false)}\r\n          onSuccess={() => {\r\n            message.success('Invoice email sent successfully');\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Notification History Modal */}\r\n      {showNotificationHistory && (\r\n        <Modal\r\n          title=\"Notification History\"\r\n          visible={showNotificationHistory}\r\n          onCancel={() => setShowNotificationHistory(false)}\r\n          footer={null}\r\n          width={800}\r\n          style={{ top: 20 }}\r\n        >\r\n          <NotificationHistoryPanel sale={productSale} />\r\n        </Modal>\r\n      )}\r\n    </>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\ProductSaleFormPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4448,4451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4448,4451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCustomers'. Either include it or remove the dependency array.","line":207,"column":6,"nodeType":"ArrayExpression","endLine":207,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [visible, customerService, loadCustomers]","fix":{"range":[7483,7509],"text":"[visible, customerService, loadCustomers]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProducts'. Either include it or remove the dependency array.","line":243,"column":6,"nodeType":"ArrayExpression","endLine":243,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [visible, productService, loadProducts]","fix":{"range":[8764,8789],"text":"[visible, productService, loadProducts]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'saleItems.length'. Either include it or remove the dependency array.","line":303,"column":6,"nodeType":"ArrayExpression","endLine":303,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [visible, productSale, form, customers, saleItems.length]","fix":{"range":[10976,11015],"text":"[visible, productSale, form, customers, saleItems.length]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sale Form Panel - ENTERPRISE EDITION\r\n * Side drawer for creating/editing product sales with professional enterprise features\r\n * ‚úÖ Auto-generated sales numbers (PSN-YYYYMM-001 format)\r\n * ‚úÖ Professional financial management and summaries\r\n * ‚úÖ Advanced tax and discount calculations\r\n * ‚úÖ Enterprise-level form organization and validation\r\n * Features:\r\n *   - Auto-generated unique sales numbers with tenant isolation\r\n *   - Professional financial summary cards\r\n *   - Advanced tax and global discount handling\r\n *   - Payment terms and reference number tracking\r\n *   - Quote/order status management\r\n *   - Detailed customer information display with linked alert\r\n *   - Product search/filtering with SKU and price info\r\n *   - Line items table with editable quantities and discounts\r\n *   - Multi-product support similar to Sales deals\r\n * RBAC Integration: Controls create/edit form permissions\r\n */\r\n\r\nimport React, { useState, useEffect, useMemo } from 'react';\r\nimport {\r\n  Drawer,\r\n  Form,\r\n  Input,\r\n  Select,\r\n  Button,\r\n  Space,\r\n  message,\r\n  InputNumber,\r\n  DatePicker,\r\n  Divider,\r\n  Spin,\r\n  Empty,\r\n  Alert,\r\n  Tooltip,\r\n  Card,\r\n  Table,\r\n  Row,\r\n  Col,\r\n  Tag,\r\n  Badge,\r\n  Statistic,\r\n} from 'antd';\r\nimport { LockOutlined, LinkOutlined, DeleteOutlined as DeleteIcon, PlusOutlined, FileTextOutlined, CheckCircleOutlined, ClockCircleOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { ProductSale, ProductSaleFormData } from '@/types/productSales';\r\nimport { Customer } from '@/types/crm';\r\nimport { Product } from '@/types/masters';\r\nimport { useProductSalesPermissions } from '../hooks/useProductSalesPermissions';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { CustomerService } from '@/modules/features/customers/services/customerService';\r\nimport { ProductService } from '@/modules/features/masters/services/productService';\r\n\r\n// Sale item type for line items table\r\ninterface SaleLineItem {\r\n  id: string;\r\n  product_id: string;\r\n  product_name: string;\r\n  product_sku: string;\r\n  product_description?: string;\r\n  quantity: number;\r\n  unit_price: number;\r\n  discount: number;\r\n  tax: number;\r\n  line_total: number;\r\n}\r\n\r\n// Enterprise-level configuration for financial calculations\r\ninterface FinancialConfig {\r\n  subtotal: number;\r\n  globalDiscount: number;\r\n  globalDiscountType: 'fixed' | 'percentage';\r\n  taxRate: number;\r\n  totalTax: number;\r\n  totalAmount: number;\r\n}\r\n\r\ninterface ProductSaleFormPanelProps {\r\n  visible: boolean;\r\n  productSale: ProductSale | null;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nexport const ProductSaleFormPanel: React.FC<ProductSaleFormPanelProps> = ({\r\n  visible,\r\n  productSale,\r\n  onClose,\r\n  onSuccess,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [loading, setLoading] = useState(false);\r\n  const [customers, setCustomers] = useState<Customer[]>([]);\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [dataLoading, setDataLoading] = useState(false);\r\n  const [loadingCustomers, setLoadingCustomers] = useState(false);\r\n  const [loadingProducts, setLoadingProducts] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [permissionError, setPermissionError] = useState<string | null>(null);\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\r\n  const [saleItems, setSaleItems] = useState<SaleLineItem[]>([]);\r\n  const [selectedProductId, setSelectedProductId] = useState<string | undefined>(undefined);\r\n\r\n  // Enterprise-level state\r\n  const [globalDiscountRate, setGlobalDiscountRate] = useState<number>(0);\r\n  const [globalDiscountType, setGlobalDiscountType] = useState<'fixed' | 'percentage'>('percentage');\r\n  const [taxRate, setTaxRate] = useState<number>(0);\r\n  const [paymentTerms, setPaymentTerms] = useState<string>('net_30');\r\n  const [referenceNumber, setReferenceNumber] = useState<string>('');\r\n  const [quoteStatus, setQuoteStatus] = useState<'draft' | 'sent' | 'accepted' | 'rejected'>('draft');\r\n  const [autoGeneratedSaleNumber, setAutoGeneratedSaleNumber] = useState<string>('');\r\n\r\n  const isEditMode = !!productSale;\r\n  \r\n  // ‚úÖ Get services using module service container (standardized pattern)\r\n  const customerService = useService<CustomerService>('customerService');\r\n  const productService = useService<ProductService>('productService');\r\n  const productSaleService = useService<any>('productSaleService');\r\n  \r\n  // RBAC permission checking\r\n  const permissions = useProductSalesPermissions({\r\n    sale: productSale || undefined,\r\n    autoLoad: visible,\r\n  });\r\n  \r\n  /**\r\n   * Generate auto-incremented sales number with tenant isolation\r\n   * Format: PSN-YYYYMM-XXXX (e.g., PSN-202501-0001)\r\n   * Enterprise feature: Unique per tenant per month\r\n   */\r\n  const generateSalesNumber = (): string => {\r\n    const now = new Date();\r\n    const year = now.getFullYear();\r\n    const month = String(now.getMonth() + 1).padStart(2, '0');\r\n    const monthKey = `${year}${month}`;\r\n    \r\n    // Get sequence from localStorage (in production, this would be from database)\r\n    const storageKey = `psn_sequence_${monthKey}`;\r\n    const currentSequence = parseInt(localStorage.getItem(storageKey) || '0', 10);\r\n    const nextSequence = currentSequence + 1;\r\n    localStorage.setItem(storageKey, String(nextSequence));\r\n    \r\n    const sequenceNum = String(nextSequence).padStart(4, '0');\r\n    return `PSN-${monthKey}-${sequenceNum}`;\r\n  };\r\n\r\n  /**\r\n   * Calculate financial totals with tax and discounts\r\n   * Supports both fixed and percentage-based discounts\r\n   */\r\n  const calculateFinancials = useMemo<FinancialConfig>(() => {\r\n    const subtotal = saleItems.reduce((sum, item) => sum + item.line_total, 0);\r\n    \r\n    // Calculate global discount\r\n    let discount = 0;\r\n    if (globalDiscountType === 'percentage') {\r\n      discount = (subtotal * globalDiscountRate) / 100;\r\n    } else {\r\n      discount = globalDiscountRate;\r\n    }\r\n    \r\n    const afterDiscount = subtotal - discount;\r\n    const totalTax = (afterDiscount * taxRate) / 100;\r\n    const totalAmount = afterDiscount + totalTax;\r\n    \r\n    return {\r\n      subtotal,\r\n      globalDiscount: discount,\r\n      globalDiscountType,\r\n      taxRate,\r\n      totalTax,\r\n      totalAmount,\r\n    };\r\n  }, [saleItems, globalDiscountRate, globalDiscountType, taxRate]);\r\n  \r\n  // Check if user has permission for this operation\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setPermissionError(null);\r\n      return;\r\n    }\r\n    \r\n    if (isEditMode && !permissions.canEdit) {\r\n      setPermissionError('You do not have permission to edit product sales.');\r\n    } else if (!isEditMode && !permissions.canCreate) {\r\n      setPermissionError('You do not have permission to create product sales.');\r\n    } else {\r\n      setPermissionError(null);\r\n    }\r\n  }, [visible, isEditMode, permissions.canCreate, permissions.canEdit]);\r\n\r\n  // Generate auto sales number on form open (new mode only)\r\n  useEffect(() => {\r\n    if (visible && !isEditMode && !autoGeneratedSaleNumber) {\r\n      const newSalesNumber = generateSalesNumber();\r\n      setAutoGeneratedSaleNumber(newSalesNumber);\r\n      form.setFieldValue('sale_number', newSalesNumber);\r\n    }\r\n  }, [visible, isEditMode, form, autoGeneratedSaleNumber]);\r\n\r\n  // Load customers and products (matches Sales module pattern)\r\n  useEffect(() => {\r\n    if (visible && customerService) {\r\n      loadCustomers();\r\n    }\r\n  }, [visible, customerService]);\r\n\r\n  // Separate effect for loading customers\r\n  const loadCustomers = async () => {\r\n    try {\r\n      setLoadingCustomers(true);\r\n      console.log('[ProductSaleFormPanel] Loading customers...');\r\n      \r\n      if (!customerService) {\r\n        console.error('[ProductSaleFormPanel] customerService is undefined');\r\n        throw new Error('Customer service not initialized');\r\n      }\r\n      \r\n      const result = await customerService.getCustomers({ pageSize: 1000 });\r\n      console.log('[ProductSaleFormPanel] Received customers:', result);\r\n      \r\n      if (result?.data && Array.isArray(result.data)) {\r\n        console.log('[ProductSaleFormPanel] Setting customers:', result.data.length, 'items');\r\n        setCustomers(result.data);\r\n      } else if (Array.isArray(result)) {\r\n        setCustomers(result);\r\n      }\r\n      setLoadingCustomers(false);\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Failed to load customers';\r\n      setError(errorMsg);\r\n      console.error('[ProductSaleFormPanel] Error loading customers:', err);\r\n      setLoadingCustomers(false);\r\n    }\r\n  };\r\n\r\n  // Load products separately\r\n  useEffect(() => {\r\n    if (visible && productService) {\r\n      loadProducts();\r\n    }\r\n  }, [visible, productService]);\r\n\r\n  const loadProducts = async () => {\r\n    try {\r\n      setLoadingProducts(true);\r\n      const result = await productService.getProducts({ pageSize: 1000, status: 'active' });\r\n      \r\n      if (result?.data && Array.isArray(result.data)) {\r\n        setProducts(result.data);\r\n      } else if (Array.isArray(result)) {\r\n        setProducts(result);\r\n      }\r\n      setLoadingProducts(false);\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Failed to load products';\r\n      setError(errorMsg);\r\n      console.error('Error loading products:', err);\r\n      setLoadingProducts(false);\r\n    }\r\n  }\r\n\r\n  // Populate form when editing\r\n  useEffect(() => {\r\n    if (visible && productSale) {\r\n      console.log('[ProductSaleFormPanel] üìù Updating form for product sale:', productSale.id);\r\n      \r\n      const selectedCust = customers.find(c => c.id === productSale.customer_id);\r\n      setSelectedCustomer(selectedCust || null);\r\n      \r\n      // Initialize with single product as line item if not in edit mode with multiple items\r\n      if (!saleItems.length) {\r\n        const lineItem: SaleLineItem = {\r\n          id: `item-${Date.now()}`,\r\n          product_id: productSale.product_id,\r\n          product_name: productSale.product_name,\r\n          product_sku: '',\r\n          quantity: productSale.quantity,\r\n          unit_price: productSale.unit_price,\r\n          discount: 0,\r\n          tax: 0,\r\n          line_total: productSale.total_value,\r\n        };\r\n        setSaleItems([lineItem]);\r\n      }\r\n      \r\n      form.setFieldsValue({\r\n        sale_number: productSale.sale_number,\r\n        customer_id: productSale.customer_id,\r\n        status: productSale.status,\r\n        sale_date: productSale.sale_date ? dayjs(productSale.sale_date) : null,\r\n        delivery_date: productSale.delivery_date ? dayjs(productSale.delivery_date) : null,\r\n        warranty_period: productSale.warranty_period,\r\n        notes: productSale.notes,\r\n      });\r\n    } else if (visible) {\r\n      console.log('[ProductSaleFormPanel] Resetting form (new product sale)');\r\n      form.resetFields();\r\n      setSelectedCustomer(null);\r\n      setSaleItems([]);\r\n    }\r\n  }, [visible, productSale, form, customers]);\r\n\r\n  // Handle customer selection - update form with customer details\r\n  const handleCustomerChange = (customerId: string) => {\r\n    const customer = customers.find(c => c.id === customerId);\r\n    setSelectedCustomer(customer || null);\r\n    // Ensure form field is properly updated\r\n    form.setFieldsValue({ customer_id: customerId });\r\n  };\r\n\r\n  // Handle adding product to sale\r\n  const handleAddProduct = () => {\r\n    if (!selectedProductId) {\r\n      message.warning('Please select a product');\r\n      return;\r\n    }\r\n\r\n    // Check if product already in items\r\n    if (saleItems.find(item => item.product_id === selectedProductId)) {\r\n      message.warning('This product is already in the sale. Update the quantity instead.');\r\n      return;\r\n    }\r\n\r\n    const selectedProduct = products.find(p => p.id === selectedProductId);\r\n    if (!selectedProduct) {\r\n      message.error('Product not found');\r\n      return;\r\n    }\r\n\r\n    const newItem: SaleLineItem = {\r\n      id: `item-${Date.now()}`,\r\n      product_id: selectedProduct.id,\r\n      product_name: selectedProduct.name,\r\n      product_sku: selectedProduct.sku || '',\r\n      product_description: selectedProduct.description,\r\n      quantity: 1,\r\n      unit_price: selectedProduct.price || 0,\r\n      discount: 0,\r\n      tax: 0,\r\n      line_total: selectedProduct.price || 0,\r\n    };\r\n\r\n    setSaleItems([...saleItems, newItem]);\r\n    setSelectedProductId(undefined);\r\n    message.success(`${selectedProduct.name} added to sale`);\r\n  };\r\n\r\n  // Handle removing product from sale\r\n  const handleRemoveItem = (itemId: string) => {\r\n    setSaleItems(saleItems.filter(item => item.id !== itemId));\r\n  };\r\n\r\n  // Update item quantity\r\n  const handleUpdateItemQuantity = (itemId: string, quantity: number) => {\r\n    setSaleItems(saleItems.map(item => {\r\n      if (item.id === itemId) {\r\n        const lineTotal = (item.unit_price * quantity) - item.discount + item.tax;\r\n        return { ...item, quantity, line_total: lineTotal };\r\n      }\r\n      return item;\r\n    }));\r\n  };\r\n\r\n  // Update item discount\r\n  const handleUpdateItemDiscount = (itemId: string, discount: number) => {\r\n    setSaleItems(saleItems.map(item => {\r\n      if (item.id === itemId) {\r\n        const lineTotal = (item.unit_price * item.quantity) - discount + item.tax;\r\n        return { ...item, discount, line_total: lineTotal };\r\n      }\r\n      return item;\r\n    }));\r\n  };\r\n\r\n  // Calculate total sale value from items\r\n  const calculateTotalFromItems = useMemo(() => {\r\n    return saleItems.reduce((sum, item) => sum + item.line_total, 0);\r\n  }, [saleItems]);\r\n\r\n  const handleSubmit = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      \r\n      // Validate at least one product is selected\r\n      if (saleItems.length === 0) {\r\n        message.error('Please add at least one product to the sale');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      // Find customer details\r\n      const selectedCust = customers.find(c => c.id === values.customer_id);\r\n      if (!selectedCust) {\r\n        message.error('Selected customer not found');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // For now, create/update with the first product (future: support multiple line items)\r\n      // When database schema supports line items, this will iterate over saleItems\r\n      const primaryItem = saleItems[0];\r\n      const primaryProduct = products.find(p => p.id === primaryItem.product_id);\r\n\r\n      if (!primaryProduct) {\r\n        message.error('Primary product not found');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Prepare form data\r\n      const formData: ProductSaleFormData = {\r\n        customer_id: values.customer_id,\r\n        customer_name: selectedCust.company_name,\r\n        product_id: primaryItem.product_id,\r\n        product_name: primaryItem.product_name,\r\n        quantity: primaryItem.quantity,\r\n        unit_price: primaryItem.unit_price,\r\n        total_value: calculateTotalFromItems,\r\n        status: values.status || 'pending',\r\n        sale_date: values.sale_date ? values.sale_date.format('YYYY-MM-DD') : new Date().toISOString().split('T')[0],\r\n        delivery_date: values.delivery_date ? values.delivery_date.format('YYYY-MM-DD') : '',\r\n        warranty_period: values.warranty_period || 12,\r\n        notes: values.notes,\r\n      };\r\n\r\n      if (isEditMode && productSale) {\r\n        await productSaleService.updateProductSale(productSale.id, formData);\r\n        message.success('Product sale updated successfully');\r\n      } else {\r\n        await productSaleService.createProductSale(formData);\r\n        message.success('Product sale created successfully');\r\n      }\r\n\r\n      form.resetFields();\r\n      onSuccess();\r\n      onClose();\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Failed to save product sale';\r\n      setError(errorMsg);\r\n      message.error(errorMsg);\r\n      console.error('Error saving product sale:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    form.resetFields();\r\n    setError(null);\r\n    setSelectedCustomer(null);\r\n    setSaleItems([]);\r\n    setSelectedProductId(undefined);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n          <span>{isEditMode ? 'üìù Edit Product Sale' : '‚ú® Create New Product Sale'}</span>\r\n          {!isEditMode && autoGeneratedSaleNumber && (\r\n            <Tag color=\"blue\" style={{ marginLeft: 16 }}>\r\n              {autoGeneratedSaleNumber}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n      }\r\n      placement=\"right\"\r\n      width={900}\r\n      onClose={handleClose}\r\n      open={visible}\r\n      footer={\r\n        <Space style={{ float: 'right' }}>\r\n          <Button onClick={handleClose}>Cancel</Button>\r\n          {permissionError ? (\r\n            <Tooltip title={permissionError}>\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<LockOutlined />}\r\n                disabled\r\n              >\r\n                {isEditMode ? 'Update' : 'Create'}\r\n              </Button>\r\n            </Tooltip>\r\n          ) : (\r\n            <Button\r\n              type=\"primary\"\r\n              loading={loading}\r\n              onClick={handleSubmit}\r\n              disabled={dataLoading || saleItems.length === 0}\r\n            >\r\n              {isEditMode ? 'Update' : 'Create Sale'}\r\n            </Button>\r\n          )}\r\n        </Space>\r\n      }\r\n    >\r\n      {permissionError && (\r\n        <Alert\r\n          message=\"Permission Denied\"\r\n          description={permissionError}\r\n          type=\"error\"\r\n          showIcon\r\n          style={{ marginBottom: 16 }}\r\n          closable\r\n        />\r\n      )}\r\n      {dataLoading ? (\r\n        <Spin size=\"large\" spinning fullscreen />\r\n      ) : error ? (\r\n        <Alert\r\n          message=\"Error Loading Data\"\r\n          description={error}\r\n          type=\"error\"\r\n          showIcon\r\n          style={{ marginBottom: 16 }}\r\n        />\r\n      ) : (\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          requiredMark=\"optional\"\r\n          autoComplete=\"off\"\r\n          disabled={!!permissionError}\r\n        >\r\n          {/* ENTERPRISE: Sales Header with Auto-Generated Number */}\r\n          <Card \r\n            size=\"small\" \r\n            style={{ marginBottom: 24, backgroundColor: '#f6f8fb', borderColor: '#1890ff' }}\r\n            title={<strong>üìä Sale Header Information</strong>}\r\n          >\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label={<strong>Sale Number (Auto-Generated)</strong>}\r\n                  name=\"sale_number\"\r\n                  rules={[{ required: true, message: 'Sale number is required' }]}\r\n                >\r\n                  <Input \r\n                    placeholder=\"Auto-generated\" \r\n                    disabled\r\n                    prefix={<FileTextOutlined />}\r\n                    style={{ fontWeight: 600 }}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Reference/PO Number\"\r\n                  name=\"reference_number\"\r\n                >\r\n                  <Input \r\n                    placeholder=\"e.g., PO-12345 or Reference ID\"\r\n                    value={referenceNumber}\r\n                    onChange={(e) => setReferenceNumber(e.target.value)}\r\n                  />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Quote Status\"\r\n                  name=\"quote_status\"\r\n                >\r\n                  <Select \r\n                    value={quoteStatus}\r\n                    onChange={setQuoteStatus}\r\n                    optionLabelProp=\"label\"\r\n                  >\r\n                    <Select.Option value=\"draft\" label={<Badge color=\"orange\" text=\"Draft\" />}>\r\n                      Draft\r\n                    </Select.Option>\r\n                    <Select.Option value=\"sent\" label={<Badge color=\"blue\" text=\"Sent to Customer\" />}>\r\n                      Sent to Customer\r\n                    </Select.Option>\r\n                    <Select.Option value=\"accepted\" label={<Badge color=\"green\" text=\"Accepted\" />}>\r\n                      Accepted\r\n                    </Select.Option>\r\n                    <Select.Option value=\"rejected\" label={<Badge color=\"red\" text=\"Rejected\" />}>\r\n                      Rejected\r\n                    </Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Payment Terms\"\r\n                  name=\"payment_terms\"\r\n                >\r\n                  <Select \r\n                    value={paymentTerms}\r\n                    onChange={setPaymentTerms}\r\n                  >\r\n                    <Select.Option value=\"immediate\">Immediate Payment</Select.Option>\r\n                    <Select.Option value=\"net_7\">Net 7 Days</Select.Option>\r\n                    <Select.Option value=\"net_15\">Net 15 Days</Select.Option>\r\n                    <Select.Option value=\"net_30\">Net 30 Days</Select.Option>\r\n                    <Select.Option value=\"net_60\">Net 60 Days</Select.Option>\r\n                    <Select.Option value=\"net_90\">Net 90 Days</Select.Option>\r\n                    <Select.Option value=\"custom\">Custom Terms</Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </Card>\r\n\r\n          {/* Customer Section */}\r\n          <Divider style={{ margin: '20px 0' }} />\r\n          <h3 style={{ marginBottom: 16, fontWeight: 600 }}>Customer Information</h3>\r\n\r\n          {selectedCustomer && (\r\n            <Alert\r\n              message=\"Customer Linked\"\r\n              description={`Company: ${selectedCustomer.company_name} | Contact: ${selectedCustomer.contact_name}`}\r\n              type=\"success\"\r\n              icon={<LinkOutlined />}\r\n              showIcon\r\n              style={{ marginBottom: 16 }}\r\n            />\r\n          )}\r\n\r\n          <Form.Item\r\n            label=\"Customer *\"\r\n            name=\"customer_id\"\r\n            rules={[{ required: true, message: 'Please select a customer' }]}\r\n            tooltip=\"Select a customer to link this sale. Required for sale creation.\"\r\n          >\r\n            <Select\r\n              placeholder=\"Select customer\"\r\n              loading={loadingCustomers}\r\n              optionLabelProp=\"label\"\r\n              onChange={handleCustomerChange}\r\n              onSelect={handleCustomerChange}\r\n              filterOption={(input, option) =>\r\n                (option?.label as string)?.toLowerCase().includes(input.toLowerCase())\r\n              }\r\n            >\r\n              {customers.map(customer => (\r\n                <Select.Option\r\n                  key={customer.id}\r\n                  value={customer.id}\r\n                  label={`${customer.company_name}`}\r\n                >\r\n                  <div>\r\n                    <div style={{ fontWeight: 500 }}>{customer.company_name}</div>\r\n                    <div style={{ fontSize: '12px', color: '#999' }}>\r\n                      {customer.contact_name} ‚Ä¢ {customer.email}\r\n                    </div>\r\n                  </div>\r\n                </Select.Option>\r\n              ))}\r\n            </Select>\r\n          </Form.Item>\r\n\r\n          {/* Customer Details Display */}\r\n          {selectedCustomer && (\r\n            <Card size=\"small\" style={{ marginBottom: 16, backgroundColor: '#fafafa' }}>\r\n              <div style={{ fontSize: '12px', lineHeight: 1.8 }}>\r\n                <div><strong>Contact:</strong> {selectedCustomer.contact_name}</div>\r\n                <div><strong>Email:</strong> {selectedCustomer.email}</div>\r\n                <div><strong>Phone:</strong> {selectedCustomer.phone}</div>\r\n                <div><strong>Industry:</strong> {selectedCustomer.industry}</div>\r\n                <div><strong>Company Size:</strong> {selectedCustomer.size}</div>\r\n                <div><strong>Status:</strong> {selectedCustomer.status}</div>\r\n              </div>\r\n            </Card>\r\n          )}\r\n\r\n          {/* ENTERPRISE: Products/Services Section */}\r\n          <Divider style={{ margin: '24px 0' }} />\r\n          <Card \r\n            size=\"small\" \r\n            title={<strong>üì¶ Products/Services & Pricing</strong>}\r\n            style={{ marginBottom: 24 }}\r\n          >\r\n            {/* Product Selection */}\r\n            <div style={{ marginBottom: 16 }}>\r\n              <label style={{ display: 'block', marginBottom: 8, fontWeight: 600 }}>Add Products to Sale</label>\r\n              <div style={{ display: 'flex', gap: 8 }}>\r\n                <Select\r\n                  placeholder=\"Search and select product\"\r\n                  style={{ flex: 1 }}\r\n                  loading={loadingProducts}\r\n                  value={selectedProductId}\r\n                  onChange={setSelectedProductId}\r\n                  optionLabelProp=\"label\"\r\n                  filterOption={(input, option) =>\r\n                    (option?.label as string)?.toLowerCase().includes(input.toLowerCase())\r\n                  }\r\n                >\r\n                  {products.map(product => (\r\n                    <Select.Option\r\n                      key={product.id}\r\n                      value={product.id}\r\n                      label={`${product.name} (${product.sku})`}\r\n                    >\r\n                      <div>\r\n                        <div style={{ fontWeight: 500 }}>{product.name}</div>\r\n                        <div style={{ fontSize: '12px', color: '#999' }}>\r\n                          SKU: {product.sku} ‚Ä¢ Price: ${product.price?.toFixed(2)}\r\n                        </div>\r\n                      </div>\r\n                    </Select.Option>\r\n                  ))}\r\n                </Select>\r\n                <Button\r\n                  type=\"primary\"\r\n                  icon={<PlusOutlined />}\r\n                  onClick={handleAddProduct}\r\n                  loading={loadingProducts}\r\n                >\r\n                  Add\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Enterprise Tax & Discount Controls */}\r\n            <Divider style={{ margin: '16px 0' }} />\r\n            <div style={{ marginBottom: 16 }}>\r\n              <label style={{ display: 'block', marginBottom: 8, fontWeight: 600 }}>üí∞ Financial Settings</label>\r\n              <Row gutter={16}>\r\n                <Col xs={24} sm={12} md={6}>\r\n                  <div style={{ fontSize: '12px', color: '#666', marginBottom: 4 }}>Global Discount</div>\r\n                  <div style={{ display: 'flex', gap: 4 }}>\r\n                    <InputNumber\r\n                      min={0}\r\n                      value={globalDiscountRate}\r\n                      onChange={(val) => setGlobalDiscountRate(val || 0)}\r\n                      placeholder=\"0\"\r\n                      style={{ flex: 1 }}\r\n                    />\r\n                    <Select\r\n                      value={globalDiscountType}\r\n                      onChange={setGlobalDiscountType}\r\n                      style={{ width: 60 }}\r\n                    >\r\n                      <Select.Option value=\"percentage\">%</Select.Option>\r\n                      <Select.Option value=\"fixed\">$</Select.Option>\r\n                    </Select>\r\n                  </div>\r\n                </Col>\r\n                <Col xs={24} sm={12} md={6}>\r\n                  <div style={{ fontSize: '12px', color: '#666', marginBottom: 4 }}>Tax Rate (%)</div>\r\n                  <InputNumber\r\n                    min={0}\r\n                    max={100}\r\n                    value={taxRate}\r\n                    onChange={(val) => setTaxRate(val || 0)}\r\n                    placeholder=\"0\"\r\n                    precision={2}\r\n                    style={{ width: '100%' }}\r\n                  />\r\n                </Col>\r\n              </Row>\r\n            </div>\r\n          </Card>\r\n\r\n          {/* Sale Items Table */}\r\n          {saleItems.length > 0 ? (\r\n            <Card size=\"small\" style={{ marginBottom: 16 }}>\r\n              <div style={{ fontSize: '12px', overflowX: 'auto' }}>\r\n                <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                  <thead>\r\n                    <tr style={{ borderBottom: '1px solid #f0f0f0', backgroundColor: '#fafafa' }}>\r\n                      <th style={{ padding: '8px', textAlign: 'left', fontWeight: 600 }}>Product</th>\r\n                      <th style={{ padding: '8px', textAlign: 'center', width: '60px', fontWeight: 600 }}>Qty</th>\r\n                      <th style={{ padding: '8px', textAlign: 'right', width: '70px', fontWeight: 600 }}>Price</th>\r\n                      <th style={{ padding: '8px', textAlign: 'right', width: '70px', fontWeight: 600 }}>Discount</th>\r\n                      <th style={{ padding: '8px', textAlign: 'right', width: '70px', fontWeight: 600 }}>Total</th>\r\n                      <th style={{ padding: '8px', textAlign: 'center', width: '40px' }}></th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {saleItems.map((item) => (\r\n                      <tr key={item.id} style={{ borderBottom: '1px solid #f0f0f0' }}>\r\n                        <td style={{ padding: '8px' }}>\r\n                          <div style={{ fontWeight: 500, marginBottom: 4 }}>{item.product_name}</div>\r\n                          {item.product_description && (\r\n                            <div style={{ fontSize: '11px', color: '#999' }}>{item.product_description}</div>\r\n                          )}\r\n                        </td>\r\n                        <td style={{ padding: '8px', textAlign: 'center' }}>\r\n                          <InputNumber\r\n                            min={1}\r\n                            value={item.quantity}\r\n                            onChange={(val) => handleUpdateItemQuantity(item.id, val || 1)}\r\n                            size=\"small\"\r\n                            style={{ width: '50px' }}\r\n                          />\r\n                        </td>\r\n                        <td style={{ padding: '8px', textAlign: 'right' }}>\r\n                          ${item.unit_price.toFixed(2)}\r\n                        </td>\r\n                        <td style={{ padding: '8px', textAlign: 'right' }}>\r\n                          <InputNumber\r\n                            min={0}\r\n                            value={item.discount}\r\n                            onChange={(val) => handleUpdateItemDiscount(item.id, val || 0)}\r\n                            size=\"small\"\r\n                            style={{ width: '60px' }}\r\n                          />\r\n                        </td>\r\n                        <td style={{ padding: '8px', textAlign: 'right', fontWeight: 600 }}>\r\n                          ${item.line_total.toFixed(2)}\r\n                        </td>\r\n                        <td style={{ padding: '8px', textAlign: 'center' }}>\r\n                          <Button\r\n                            type=\"text\"\r\n                            danger\r\n                            size=\"small\"\r\n                            icon={<DeleteIcon />}\r\n                            onClick={() => handleRemoveItem(item.id)}\r\n                          />\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                    <tr style={{ backgroundColor: '#fafafa', fontWeight: 600, borderTop: '2px solid #f0f0f0' }}>\r\n                      <td colSpan={4} style={{ padding: '8px', textAlign: 'right' }}>\r\n                        Total:\r\n                      </td>\r\n                      <td style={{ padding: '8px', textAlign: 'right' }}>\r\n                        ${calculateTotalFromItems.toFixed(2)}\r\n                      </td>\r\n                      <td></td>\r\n                    </tr>\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </Card>\r\n          ) : (\r\n            <Empty\r\n              description=\"No products added\"\r\n              style={{ marginBottom: 16, padding: '20px' }}\r\n            />\r\n          )}\r\n\r\n          {/* ENTERPRISE: Financial Summary Card */}\r\n          {saleItems.length > 0 && (\r\n            <Card \r\n              size=\"small\" \r\n              style={{ marginBottom: 24, backgroundColor: '#f0f5ff', borderColor: '#1890ff', borderWidth: 2 }}\r\n              title={<strong>üíµ Financial Summary</strong>}\r\n            >\r\n              <Row gutter={24}>\r\n                <Col xs={12} sm={6}>\r\n                  <Statistic\r\n                    title=\"Subtotal\"\r\n                    value={calculateFinancials.subtotal}\r\n                    prefix=\"$\"\r\n                    precision={2}\r\n                    valueStyle={{ color: '#262626', fontSize: '16px', fontWeight: 600 }}\r\n                  />\r\n                </Col>\r\n                {calculateFinancials.globalDiscount > 0 && (\r\n                  <Col xs={12} sm={6}>\r\n                    <Statistic\r\n                      title=\"Discount\"\r\n                      value={calculateFinancials.globalDiscount}\r\n                      prefix={globalDiscountType === 'percentage' ? '' : '$'}\r\n                      suffix={globalDiscountType === 'percentage' ? '%' : ''}\r\n                      precision={2}\r\n                      valueStyle={{ color: '#ff7a45', fontSize: '16px', fontWeight: 600 }}\r\n                    />\r\n                  </Col>\r\n                )}\r\n                {taxRate > 0 && (\r\n                  <Col xs={12} sm={6}>\r\n                    <Statistic\r\n                      title={`Tax (${taxRate}%)`}\r\n                      value={calculateFinancials.totalTax}\r\n                      prefix=\"$\"\r\n                      precision={2}\r\n                      valueStyle={{ color: '#faad14', fontSize: '16px', fontWeight: 600 }}\r\n                    />\r\n                  </Col>\r\n                )}\r\n                <Col xs={12} sm={6}>\r\n                  <Statistic\r\n                    title=\"TOTAL AMOUNT\"\r\n                    value={calculateFinancials.totalAmount}\r\n                    prefix=\"$\"\r\n                    precision={2}\r\n                    valueStyle={{ color: '#52c41a', fontSize: '18px', fontWeight: 700 }}\r\n                  />\r\n                </Col>\r\n              </Row>\r\n            </Card>\r\n          )}\r\n\r\n          {/* ENTERPRISE: Sale Details Section */}\r\n          <Card \r\n            size=\"small\" \r\n            title={<strong>üìÖ Sale Details & Timeline</strong>}\r\n            style={{ marginBottom: 24 }}\r\n          >\r\n            <Row gutter={16}>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Sale Date\"\r\n                  name=\"sale_date\"\r\n                  rules={[{ required: true, message: 'Please select sale date' }]}\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Delivery Date\"\r\n                  name=\"delivery_date\"\r\n                >\r\n                  <DatePicker style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Status\"\r\n                  name=\"status\"\r\n                  initialValue=\"pending\"\r\n                  rules={[{ required: true, message: 'Please select status' }]}\r\n                >\r\n                  <Select placeholder=\"Select status\" optionLabelProp=\"label\">\r\n                    <Select.Option value=\"draft\" label={<Badge status=\"default\" text=\"Draft\" />}>\r\n                      Draft\r\n                    </Select.Option>\r\n                    <Select.Option value=\"pending\" label={<Badge status=\"processing\" text=\"Pending\" />}>\r\n                      Pending\r\n                    </Select.Option>\r\n                    <Select.Option value=\"confirmed\" label={<Badge status=\"processing\" text=\"Confirmed\" />}>\r\n                      Confirmed\r\n                    </Select.Option>\r\n                    <Select.Option value=\"delivered\" label={<Badge status=\"success\" text=\"Delivered\" />}>\r\n                      Delivered\r\n                    </Select.Option>\r\n                    <Select.Option value=\"cancelled\" label={<Badge status=\"error\" text=\"Cancelled\" />}>\r\n                      Cancelled\r\n                    </Select.Option>\r\n                    <Select.Option value=\"refunded\" label={<Badge status=\"error\" text=\"Refunded\" />}>\r\n                      Refunded\r\n                    </Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col xs={24} sm={12}>\r\n                <Form.Item\r\n                  label=\"Warranty Period (months)\"\r\n                  name=\"warranty_period\"\r\n                  initialValue={12}\r\n                >\r\n                  <InputNumber min={0} max={120} placeholder=\"Enter warranty period\" style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </Card>\r\n\r\n          {/* ENTERPRISE: Additional Information */}\r\n          <Card \r\n            size=\"small\" \r\n            title={<strong>üìù Additional Information & Comments</strong>}\r\n            style={{ marginBottom: 24 }}\r\n          >\r\n            <Form.Item\r\n              label=\"Internal Notes\"\r\n              name=\"notes\"\r\n              tooltip=\"Internal notes visible only to your team\"\r\n            >\r\n              <Input.TextArea \r\n                rows={4} \r\n                placeholder=\"Add internal notes, special instructions, or customer requirements...\"\r\n                style={{ fontFamily: 'monospace' }}\r\n              />\r\n            </Form.Item>\r\n          </Card>\r\n        </Form>\r\n      )}\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\ProductSalesAnalyticsDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\ProductSalesList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\ReportsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1337,1340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1337,1340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2282,2285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2282,2285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":479,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14485,14488],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14485,14488],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Reports Modal Component\r\n * Allows users to generate various types of reports\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n  Modal,\r\n  Form,\r\n  Select,\r\n  Button,\r\n  Space,\r\n  message,\r\n  Tabs,\r\n  Card,\r\n  Row,\r\n  Col,\r\n  DatePicker,\r\n  Input,\r\n  Switch,\r\n  Tag,\r\n  Divider,\r\n  Empty,\r\n  Spin,\r\n} from 'antd';\r\nimport {\r\n  DownloadOutlined,\r\n  FileTextOutlined,\r\n  MailOutlined,\r\n  CalendarOutlined,\r\n} from '@ant-design/icons';\r\nimport type { TabsProps } from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport { ProductSale, ProductSalesAnalytics } from '@/types/productSales';\r\nimport {\r\n  reportGenerationService,\r\n  MonthlySalesReport,\r\n  CustomerSalesReport,\r\n  ProductSalesReport,\r\n  RevenueReport,\r\n  ReportSchedule,\r\n} from '../services/reportGenerationService';\r\n\r\ninterface ReportsModalProps {\r\n  visible: boolean;\r\n  data: ProductSale[];\r\n  analytics: ProductSalesAnalytics | null;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const ReportsModal: React.FC<ReportsModalProps> = ({\r\n  visible,\r\n  data,\r\n  analytics,\r\n  onClose,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [reportType, setReportType] = useState<'monthly_sales' | 'customer_sales' | 'product_sales' | 'revenue_report'>('monthly_sales');\r\n  const [loading, setLoading] = useState(false);\r\n  const [generatedReport, setGeneratedReport] = useState<any>(null);\r\n  const [schedules, setSchedules] = useState<ReportSchedule[]>([]);\r\n  const [scheduleFormData, setScheduleFormData] = useState({\r\n    name: '',\r\n    frequency: 'monthly' as const,\r\n    recipients: [] as string[],\r\n  });\r\n\r\n  const reportTypeOptions = [\r\n    { label: 'Monthly Sales Report', value: 'monthly_sales' },\r\n    { label: 'Customer Sales Report', value: 'customer_sales' },\r\n    { label: 'Product Sales Report', value: 'product_sales' },\r\n    { label: 'Revenue Report', value: 'revenue_report' },\r\n  ];\r\n\r\n  const frequencyOptions = [\r\n    { label: 'Daily', value: 'daily' },\r\n    { label: 'Weekly', value: 'weekly' },\r\n    { label: 'Monthly', value: 'monthly' },\r\n  ];\r\n\r\n  /**\r\n   * Generate the requested report\r\n   */\r\n  const handleGenerateReport = async () => {\r\n    if (!analytics) {\r\n      message.error('Analytics data not available');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      let report: any;\r\n      let reportTitle = '';\r\n\r\n      switch (reportType) {\r\n        case 'monthly_sales': {\r\n          const month = form.getFieldValue('month') || dayjs().format('MM-YYYY');\r\n          report = reportGenerationService.generateMonthlySalesReport(data, analytics, month);\r\n          reportTitle = `Monthly Sales Report - ${month}`;\r\n          break;\r\n        }\r\n\r\n        case 'customer_sales': {\r\n          const customerName = form.getFieldValue('customer_name');\r\n          if (!customerName) {\r\n            message.error('Please select a customer');\r\n            setLoading(false);\r\n            return;\r\n          }\r\n          report = reportGenerationService.generateCustomerSalesReport(data, customerName);\r\n          reportTitle = `Customer Sales Report - ${customerName}`;\r\n          break;\r\n        }\r\n\r\n        case 'product_sales': {\r\n          const productName = form.getFieldValue('product_name');\r\n          if (!productName) {\r\n            message.error('Please select a product');\r\n            setLoading(false);\r\n            return;\r\n          }\r\n          report = reportGenerationService.generateProductSalesReport(data, productName);\r\n          reportTitle = `Product Sales Report - ${productName}`;\r\n          break;\r\n        }\r\n\r\n        case 'revenue_report': {\r\n          const period = form.getFieldValue('period') || dayjs().format('YYYY-MM');\r\n          report = reportGenerationService.generateRevenueReport(data, analytics, period);\r\n          reportTitle = `Revenue Report - ${period}`;\r\n          break;\r\n        }\r\n\r\n        default:\r\n          message.error('Unknown report type');\r\n          setLoading(false);\r\n          return;\r\n      }\r\n\r\n      setGeneratedReport({ data: report, title: reportTitle, type: reportType });\r\n      message.success('Report generated successfully');\r\n    } catch (error) {\r\n      console.error('Error generating report:', error);\r\n      message.error('Failed to generate report');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Download report as HTML/PDF\r\n   */\r\n  const handleDownloadReport = () => {\r\n    if (!generatedReport) {\r\n      message.error('No report to download');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const html = reportGenerationService.exportToHTML(generatedReport.data, generatedReport.type, {\r\n        title: generatedReport.title,\r\n        includeSummary: true,\r\n        includeCharts: true,\r\n      });\r\n\r\n      const blob = new Blob([html], { type: 'text/html;charset=utf-8;' });\r\n      const link = document.createElement('a');\r\n      const url = URL.createObjectURL(blob);\r\n      link.setAttribute('href', url);\r\n      link.setAttribute('download', `${generatedReport.title.replace(/\\s+/g, '_')}.html`);\r\n      link.style.visibility = 'hidden';\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n\r\n      message.success('Report downloaded successfully');\r\n    } catch (error) {\r\n      console.error('Error downloading report:', error);\r\n      message.error('Failed to download report');\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Schedule report for recurring delivery\r\n   */\r\n  const handleScheduleReport = () => {\r\n    if (!scheduleFormData.name || scheduleFormData.recipients.length === 0) {\r\n      message.error('Please fill in all schedule fields');\r\n      return;\r\n    }\r\n\r\n    const newSchedule: ReportSchedule = {\r\n      id: Date.now().toString(),\r\n      name: scheduleFormData.name,\r\n      reportType,\r\n      frequency: scheduleFormData.frequency,\r\n      recipients: scheduleFormData.recipients,\r\n      isActive: true,\r\n      createdAt: new Date(),\r\n    };\r\n\r\n    setSchedules([...schedules, newSchedule]);\r\n    setScheduleFormData({ name: '', frequency: 'monthly', recipients: [] });\r\n    message.success('Report scheduled successfully');\r\n  };\r\n\r\n  /**\r\n   * Remove scheduled report\r\n   */\r\n  const handleRemoveSchedule = (id: string) => {\r\n    setSchedules(schedules.filter(s => s.id !== id));\r\n    message.success('Schedule removed');\r\n  };\r\n\r\n  /**\r\n   * Toggle schedule active status\r\n   */\r\n  const handleToggleSchedule = (id: string) => {\r\n    setSchedules(schedules.map(s =>\r\n      s.id === id ? { ...s, isActive: !s.isActive } : s\r\n    ));\r\n  };\r\n\r\n  /**\r\n   * Get available customers\r\n   */\r\n  const getCustomerOptions = () => {\r\n    const customers = Array.from(new Set(data.map(s => s.customer_name).filter(Boolean)));\r\n    return customers.map(customer => ({ label: customer, value: customer }));\r\n  };\r\n\r\n  /**\r\n   * Get available products\r\n   */\r\n  const getProductOptions = () => {\r\n    const products = Array.from(new Set(data.map(s => s.product_name).filter(Boolean)));\r\n    return products.map(product => ({ label: product, value: product }));\r\n  };\r\n\r\n  const tabItems: TabsProps['items'] = [\r\n    {\r\n      key: 'generate',\r\n      label: 'Generate Report',\r\n      icon: <FileTextOutlined />,\r\n      children: (\r\n        <div>\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            style={{ marginBottom: 20 }}\r\n          >\r\n            {/* Report Type Selection */}\r\n            <Form.Item label=\"Report Type\" required>\r\n              <Select\r\n                value={reportType}\r\n                onChange={(value) => {\r\n                  setReportType(value);\r\n                  form.resetFields();\r\n                }}\r\n                options={reportTypeOptions}\r\n              />\r\n            </Form.Item>\r\n\r\n            {/* Conditional Fields Based on Report Type */}\r\n            {reportType === 'monthly_sales' && (\r\n              <Form.Item\r\n                name=\"month\"\r\n                label=\"Month\"\r\n                initialValue={dayjs()}\r\n              >\r\n                <DatePicker picker=\"month\" />\r\n              </Form.Item>\r\n            )}\r\n\r\n            {reportType === 'customer_sales' && (\r\n              <Form.Item\r\n                name=\"customer_name\"\r\n                label=\"Customer\"\r\n                required\r\n              >\r\n                <Select\r\n                  placeholder=\"Select a customer\"\r\n                  options={getCustomerOptions()}\r\n                />\r\n              </Form.Item>\r\n            )}\r\n\r\n            {reportType === 'product_sales' && (\r\n              <Form.Item\r\n                name=\"product_name\"\r\n                label=\"Product\"\r\n                required\r\n              >\r\n                <Select\r\n                  placeholder=\"Select a product\"\r\n                  options={getProductOptions()}\r\n                />\r\n              </Form.Item>\r\n            )}\r\n\r\n            {reportType === 'revenue_report' && (\r\n              <Form.Item\r\n                name=\"period\"\r\n                label=\"Period\"\r\n                initialValue={dayjs().format('YYYY-MM')}\r\n              >\r\n                <Input type=\"month\" />\r\n              </Form.Item>\r\n            )}\r\n\r\n            <Form.Item>\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<FileTextOutlined />}\r\n                onClick={handleGenerateReport}\r\n                loading={loading}\r\n                block\r\n              >\r\n                Generate Report\r\n              </Button>\r\n            </Form.Item>\r\n          </Form>\r\n\r\n          {/* Generated Report Preview */}\r\n          {generatedReport && (\r\n            <Card\r\n              title=\"Report Preview\"\r\n              extra={\r\n                <Button\r\n                  type=\"primary\"\r\n                  icon={<DownloadOutlined />}\r\n                  onClick={handleDownloadReport}\r\n                >\r\n                  Download\r\n                </Button>\r\n              }\r\n              style={{ marginTop: 20 }}\r\n            >\r\n              {renderReportPreview(generatedReport.data, generatedReport.type)}\r\n            </Card>\r\n          )}\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'schedule',\r\n      label: 'Schedule Reports',\r\n      icon: <CalendarOutlined />,\r\n      children: (\r\n        <div>\r\n          {/* Schedule Form */}\r\n          <Card title=\"Create Schedule\" style={{ marginBottom: 20 }}>\r\n            <Form layout=\"vertical\">\r\n              <Form.Item label=\"Schedule Name\" required>\r\n                <Input\r\n                  placeholder=\"e.g., Weekly Revenue Report\"\r\n                  value={scheduleFormData.name}\r\n                  onChange={(e) =>\r\n                    setScheduleFormData({ ...scheduleFormData, name: e.target.value })\r\n                  }\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item label=\"Report Type\" required>\r\n                <Select\r\n                  value={reportType}\r\n                  onChange={(value) => setReportType(value)}\r\n                  options={reportTypeOptions}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item label=\"Frequency\" required>\r\n                <Select\r\n                  value={scheduleFormData.frequency}\r\n                  onChange={(value) =>\r\n                    setScheduleFormData({ ...scheduleFormData, frequency: value })\r\n                  }\r\n                  options={frequencyOptions}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item label=\"Recipients (Email)\" required>\r\n                <Select\r\n                  mode=\"tags\"\r\n                  placeholder=\"Enter email addresses\"\r\n                  value={scheduleFormData.recipients}\r\n                  onChange={(value) =>\r\n                    setScheduleFormData({ ...scheduleFormData, recipients: value })\r\n                  }\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item>\r\n                <Button\r\n                  type=\"primary\"\r\n                  icon={<MailOutlined />}\r\n                  onClick={handleScheduleReport}\r\n                  block\r\n                >\r\n                  Schedule Report\r\n                </Button>\r\n              </Form.Item>\r\n            </Form>\r\n          </Card>\r\n\r\n          {/* Scheduled Reports List */}\r\n          <div>\r\n            <h3>Active Schedules</h3>\r\n            {schedules.length === 0 ? (\r\n              <Empty description=\"No scheduled reports\" />\r\n            ) : (\r\n              <div>\r\n                {schedules.map((schedule) => (\r\n                  <Card\r\n                    key={schedule.id}\r\n                    size=\"small\"\r\n                    style={{ marginBottom: 12 }}\r\n                    extra={\r\n                      <Space>\r\n                        <Switch\r\n                          checked={schedule.isActive}\r\n                          onChange={() => handleToggleSchedule(schedule.id)}\r\n                        />\r\n                        <Button\r\n                          danger\r\n                          size=\"small\"\r\n                          onClick={() => handleRemoveSchedule(schedule.id)}\r\n                        >\r\n                          Delete\r\n                        </Button>\r\n                      </Space>\r\n                    }\r\n                  >\r\n                    <Row gutter={16}>\r\n                      <Col span={12}>\r\n                        <div>\r\n                          <strong>{schedule.name}</strong>\r\n                          <br />\r\n                          <Tag>{reportTypeOptions.find(o => o.value === schedule.reportType)?.label}</Tag>\r\n                          <Tag color=\"blue\">{schedule.frequency}</Tag>\r\n                        </div>\r\n                      </Col>\r\n                      <Col span={12}>\r\n                        <div style={{ fontSize: 12, color: '#666' }}>\r\n                          Recipients: {schedule.recipients.join(', ')}\r\n                        </div>\r\n                      </Col>\r\n                    </Row>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Reports & Analytics\"\r\n      visible={visible}\r\n      onCancel={onClose}\r\n      width={900}\r\n      footer={[\r\n        <Button key=\"close\" onClick={onClose}>\r\n          Close\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <Tabs items={tabItems} />\r\n    </Modal>\r\n  );\r\n};\r\n\r\n/**\r\n * Render report preview based on type\r\n */\r\nfunction renderReportPreview(report: any, reportType: string): JSX.Element {\r\n  switch (reportType) {\r\n    case 'monthly_sales':\r\n      return (\r\n        <div>\r\n          <Row gutter={16}>\r\n            <Col span={8}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Total Sales</div>\r\n                <div style={{ fontSize: 20, fontWeight: 'bold', color: '#1890ff' }}>\r\n                  {report.totalSales}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col span={8}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Total Revenue</div>\r\n                <div style={{ fontSize: 20, fontWeight: 'bold', color: '#52c41a' }}>\r\n                  ${report.totalRevenue.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col span={8}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Avg Sale Value</div>\r\n                <div style={{ fontSize: 20, fontWeight: 'bold', color: '#faad14' }}>\r\n                  ${report.averageSaleValue.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n      );\r\n\r\n    case 'customer_sales':\r\n      return (\r\n        <div>\r\n          <Row gutter={16} style={{ marginBottom: 16 }}>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Customer</div>\r\n                <div style={{ fontSize: 16, fontWeight: 'bold' }}>\r\n                  {report.customerName}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Total Revenue</div>\r\n                <div style={{ fontSize: 16, fontWeight: 'bold', color: '#1890ff' }}>\r\n                  ${report.totalRevenue.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n          <Divider />\r\n          <div style={{ fontSize: 12 }}>\r\n            <strong>Products Purchased:</strong> {report.products.length}\r\n          </div>\r\n        </div>\r\n      );\r\n\r\n    case 'product_sales':\r\n      return (\r\n        <div>\r\n          <Row gutter={16} style={{ marginBottom: 16 }}>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Product</div>\r\n                <div style={{ fontSize: 16, fontWeight: 'bold' }}>\r\n                  {report.productName}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Units Sold</div>\r\n                <div style={{ fontSize: 16, fontWeight: 'bold', color: '#1890ff' }}>\r\n                  {report.totalUnitsSold}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Total Revenue</div>\r\n                <div style={{ fontSize: 16, fontWeight: 'bold', color: '#52c41a' }}>\r\n                  ${report.totalRevenue.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Avg Unit Price</div>\r\n                <div style={{ fontSize: 16, fontWeight: 'bold', color: '#faad14' }}>\r\n                  ${report.averageUnitPrice.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n      );\r\n\r\n    case 'revenue_report':\r\n      return (\r\n        <div>\r\n          <Row gutter={16}>\r\n            <Col span={8}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Total Revenue</div>\r\n                <div style={{ fontSize: 18, fontWeight: 'bold', color: '#1890ff' }}>\r\n                  ${report.totalRevenue.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col span={8}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Total Sales</div>\r\n                <div style={{ fontSize: 18, fontWeight: 'bold', color: '#52c41a' }}>\r\n                  {report.totalSales}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col span={8}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#666' }}>Avg Order Value</div>\r\n                <div style={{ fontSize: 18, fontWeight: 'bold', color: '#faad14' }}>\r\n                  ${report.averageOrderValue.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n      );\r\n\r\n    default:\r\n      return <Empty />;\r\n  }\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\StatusTransitionModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useBulkOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useCreateProductSale.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1029,1032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1029,1032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3621,3624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3621,3624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4279,4282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4279,4282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useCreateProductSale Hook\r\n * Mutation for creating new product sales\r\n * Handles validation, cache invalidation, and notifications\r\n */\r\n\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { ProductSale, ProductSaleFormData } from '@/types/productSales';\r\nimport { useProductSalesStore } from '../store/productSalesStore';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { productSalesKeys } from './useProductSales';\r\nimport { productSalesAuditService } from '../services/productSalesAuditService';\r\nimport { productSalesRbacService } from '../services/productSalesRbacService';\r\n\r\n/**\r\n * Hook for creating a new product sale\r\n * @returns Mutation object with mutate function and states\r\n */\r\nexport const useCreateProductSale = () => {\r\n  const queryClient = useQueryClient();\r\n  const { addSale, setSaving, setError, clearError } = useProductSalesStore();\r\n  const { toast } = useToast();\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useMutation({\r\n    mutationFn: async (data: ProductSaleFormData) => {\r\n      clearError();\r\n      setSaving(true);\r\n\r\n      try {\r\n        // Check RBAC permission for create operation\r\n        const permissionResult = await productSalesRbacService.canCreateProductSale();\r\n        if (!permissionResult.allowed) {\r\n          throw new Error(permissionResult.reason || 'You do not have permission to create product sales');\r\n        }\r\n\r\n        if (!data.customer_id || !data.product_id) {\r\n          throw new Error('Customer and Product are required');\r\n        }\r\n\r\n        if (data.units <= 0 || data.cost_per_unit <= 0) {\r\n          throw new Error('Units and cost per unit must be greater than 0');\r\n        }\r\n\r\n        const newSale: ProductSale = await service.createProductSale(data);\r\n\r\n        return newSale;\r\n      } catch (error) {\r\n        const errorMessage = error instanceof Error ? error.message : 'Failed to create product sale';\r\n        setError(errorMessage);\r\n        throw error;\r\n      } finally {\r\n        setSaving(false);\r\n      }\r\n    },\r\n\r\n    onSuccess: (newSale: ProductSale) => {\r\n      // Log audit trail for product sale creation\r\n      productSalesAuditService.logCreateProductSale(\r\n        newSale,\r\n        { source: 'form_submission' }\r\n      ).catch(error => {\r\n        console.error('Audit logging failed:', error);\r\n        // Don't block the flow\r\n      });\r\n\r\n      // Update store with new sale\r\n      addSale(newSale);\r\n\r\n      // Invalidate and refetch product sales list\r\n      queryClient.invalidateQueries({\r\n        queryKey: productSalesKeys.list(),\r\n      });\r\n\r\n      // Show success notification\r\n      toast({\r\n        title: 'Success',\r\n        description: 'Product sale created successfully',\r\n        variant: 'default',\r\n      });\r\n\r\n      return newSale;\r\n    },\r\n\r\n    onError: (error: Error) => {\r\n      const errorMessage = error.message || 'Failed to create product sale';\r\n\r\n      // Show error notification\r\n      toast({\r\n        title: 'Error',\r\n        description: errorMessage,\r\n        variant: 'destructive',\r\n      });\r\n\r\n      console.error('Create product sale error:', error);\r\n    },\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for creating product sale with service contract\r\n * @returns Mutation object with contract creation capability\r\n */\r\nexport const useCreateProductSaleWithContract = () => {\r\n  const queryClient = useQueryClient();\r\n  const { addSale, setSaving, setError, clearError } = useProductSalesStore();\r\n  const { toast } = useToast();\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useMutation({\r\n    mutationFn: async (data: ProductSaleFormData & { generateContract: boolean }) => {\r\n      clearError();\r\n      setSaving(true);\r\n\r\n      try {\r\n        const result = await service.createProductSaleWithContract(\r\n          data,\r\n          data.generateContract\r\n        );\r\n\r\n        return result;\r\n      } catch (error) {\r\n        const errorMessage =\r\n          error instanceof Error ? error.message : 'Failed to create product sale with contract';\r\n        setError(errorMessage);\r\n        throw error;\r\n      } finally {\r\n        setSaving(false);\r\n      }\r\n    },\r\n\r\n    onSuccess: (result: any) => {\r\n      // Log audit trail for product sale creation with contract\r\n      productSalesAuditService.logCreateProductSale(\r\n        result.productSale,\r\n        { \r\n          source: 'form_submission',\r\n          relatedContract: result.serviceContractId,\r\n          withServiceContract: true\r\n        }\r\n      ).catch(error => {\r\n        console.error('Audit logging failed:', error);\r\n        // Don't block the flow\r\n      });\r\n\r\n      // Update store\r\n      addSale(result.productSale);\r\n\r\n      // Invalidate caches\r\n      queryClient.invalidateQueries({\r\n        queryKey: productSalesKeys.list(),\r\n      });\r\n\r\n      toast({\r\n        title: 'Success',\r\n        description: 'Product sale and service contract created successfully',\r\n        variant: 'default',\r\n      });\r\n\r\n      return result;\r\n    },\r\n\r\n    onError: (error: Error) => {\r\n      toast({\r\n        title: 'Error',\r\n        description: error.message || 'Failed to create product sale with contract',\r\n        variant: 'destructive',\r\n      });\r\n    },\r\n  });\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useDeleteProductSale.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useGenerateContractFromSale.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useGenerateInvoice.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1593,1596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1593,1596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useGenerateInvoice Hook\r\n * Handles invoice generation mutation for product sales\r\n */\r\n\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { ProductSale, ProductSaleItem } from '@/types/productSales';\r\nimport { invoiceService } from '../services/invoiceService';\r\nimport { useNotification } from '@/hooks/useNotification';\r\n\r\ninterface GenerateInvoiceParams {\r\n  sale: ProductSale;\r\n  saleItems: ProductSaleItem[];\r\n  taxRate?: number;\r\n  paymentTerms?: string;\r\n  notes?: string;\r\n  currency?: string;\r\n}\r\n\r\nexport function useGenerateInvoice() {\r\n  const queryClient = useQueryClient();\r\n  const notification = useNotification();\r\n\r\n  const mutation = useMutation({\r\n    mutationFn: async (params: GenerateInvoiceParams) => {\r\n      const { sale, saleItems, ...options } = params;\r\n      \r\n      // Validate parameters\r\n      if (!sale || !saleItems || saleItems.length === 0) {\r\n        throw new Error('Invalid sale or sale items');\r\n      }\r\n\r\n      // Generate invoice\r\n      const invoice = await invoiceService.generateInvoice(\r\n        sale,\r\n        saleItems,\r\n        options\r\n      );\r\n\r\n      return invoice;\r\n    },\r\n    onSuccess: (invoice) => {\r\n      // Invalidate relevant queries\r\n      queryClient.invalidateQueries({ queryKey: ['productSales'] });\r\n      queryClient.invalidateQueries({ queryKey: ['productSale', invoice.sale_id] });\r\n\r\n      notification.success({\r\n        title: 'Invoice Generated',\r\n        description: `Invoice ${invoice.invoice_number} has been generated successfully`,\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      const errorMessage = error?.message || 'Failed to generate invoice';\r\n      \r\n      notification.error({\r\n        title: 'Invoice Generation Failed',\r\n        description: errorMessage,\r\n      });\r\n    },\r\n  });\r\n\r\n  return mutation;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useInvoiceEmail.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useProductSale.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[729,732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[729,732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1817,1820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1817,1820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useProductSale Hook\r\n * Fetches a single product sale by ID\r\n * Uses React Query for caching with proper cache invalidation\r\n */\r\n\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { ProductSale } from '@/types/productSales';\r\nimport { useProductSalesStore } from '../store/productSalesStore';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { productSalesKeys } from './useProductSales';\r\n\r\n/**\r\n * Hook for fetching a single product sale by ID\r\n * @param id Product Sale ID\r\n * @returns Query result with data, loading, error\r\n */\r\nexport const useProductSale = (id: string) => {\r\n  const { setSelectedSale, setError, clearError } = useProductSalesStore();\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: productSalesKeys.detail(id),\r\n    queryFn: async () => {\r\n      clearError();\r\n      try {\r\n        if (!id) {\r\n          throw new Error('Product sale ID is required');\r\n        }\r\n\r\n        const sale: ProductSale = await service.getProductSale(id);\r\n\r\n        // Update store with selected sale\r\n        setSelectedSale(sale);\r\n\r\n        return sale;\r\n      } catch (error) {\r\n        const errorMessage = error instanceof Error ? error.message : 'Failed to fetch product sale';\r\n        setError(errorMessage);\r\n        throw error;\r\n      }\r\n    },\r\n    enabled: !!id,\r\n    staleTime: 5 * 60 * 1000, // 5 minutes\r\n    gcTime: 10 * 60 * 1000,\r\n    retry: 2,\r\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for fetching product sale with related contract data\r\n * @param id Product Sale ID\r\n * @returns Query result with extended data including contract information\r\n */\r\nexport const useProductSaleWithContract = (id: string) => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.detail(id), 'with-contract'],\r\n    queryFn: async () => {\r\n      if (!id) {\r\n        throw new Error('Product sale ID is required');\r\n      }\r\n\r\n      return service.getProductSaleWithContract(id);\r\n    },\r\n    enabled: !!id,\r\n    staleTime: 5 * 60 * 1000,\r\n    gcTime: 10 * 60 * 1000,\r\n    retry: 2,\r\n  });\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useProductSales.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1364,1367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1364,1367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2795,2798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2795,2798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useProductSales Hook\r\n * Fetches all product sales with optional filters\r\n * Uses React Query for caching and refetch capabilities\r\n */\r\n\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { ProductSale, ProductSaleFilters, ProductSalesResponse } from '@/types/productSales';\r\nimport { useProductSalesStore } from '../store/productSalesStore';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\n\r\n/** Query keys for product sales */\r\nexport const productSalesKeys = {\r\n  all: ['productSales'] as const,\r\n  list: () => [...productSalesKeys.all, 'list'] as const,\r\n  filtered: (filters: ProductSaleFilters) => [...productSalesKeys.list(), filters] as const,\r\n  detail: (id: string) => [...productSalesKeys.all, 'detail', id] as const,\r\n  analytics: () => [...productSalesKeys.all, 'analytics'] as const,\r\n};\r\n\r\n/**\r\n * Hook for fetching product sales with filters and pagination\r\n * @param filters Optional ProductSaleFilters for filtering\r\n * @param page Page number (1-indexed)\r\n * @param pageSize Items per page\r\n * @returns Query result with data, loading, error, and refetch\r\n */\r\nexport const useProductSales = (\r\n  filters: ProductSaleFilters = {},\r\n  page: number = 1,\r\n  pageSize: number = 20\r\n) => {\r\n  const { setSales, setLoading, setPagination, setError, clearError } = useProductSalesStore();\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: productSalesKeys.filtered({ ...filters, page, pageSize }),\r\n    queryFn: async () => {\r\n      clearError();\r\n      setLoading(true);\r\n      try {\r\n        const response: ProductSalesResponse = await service.getProductSales(\r\n          filters,\r\n          page,\r\n          pageSize\r\n        );\r\n\r\n        // Update store with response data\r\n        setSales(response.data);\r\n        setPagination({\r\n          currentPage: response.page,\r\n          pageSize: response.pageSize,\r\n          totalCount: response.total,\r\n          totalPages: response.totalPages,\r\n        });\r\n\r\n        return response;\r\n      } catch (error) {\r\n        const errorMessage = error instanceof Error ? error.message : 'Failed to fetch product sales';\r\n        setError(errorMessage);\r\n        throw error;\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    staleTime: 5 * 60 * 1000, // 5 minutes\r\n    gcTime: 10 * 60 * 1000, // 10 minutes (was cacheTime)\r\n    retry: 2,\r\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for fetching product sales by customer\r\n * @param customerId Customer ID\r\n * @param filters Optional ProductSaleFilters\r\n * @returns Query result\r\n */\r\nexport const useProductSalesByCustomer = (\r\n  customerId: string,\r\n  filters: ProductSaleFilters = {}\r\n) => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.filtered(filters), 'customer', customerId],\r\n    queryFn: async () => {\r\n      if (!customerId) {\r\n        throw new Error('Customer ID is required');\r\n      }\r\n      // Service hook is already called at top level, safe to use here\r\n      return service.getProductSalesByCustomer(customerId, filters);\r\n    },\r\n    enabled: !!customerId,\r\n    staleTime: 5 * 60 * 1000,\r\n    gcTime: 10 * 60 * 1000,\r\n    retry: 2,\r\n  });\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useProductSalesAnalytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2967,2970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2967,2970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3505,3508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3505,3508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4069,4072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4069,4072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4904,4907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4904,4907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5460,5463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5460,5463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5952,5955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5952,5955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useProductSalesAnalytics Hook\r\n * Fetches analytics data for product sales dashboard\r\n * Includes caching with TTL for performance\r\n */\r\n\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport type { ProductSalesAnalyticsDTO } from '@/types/dtos/productSalesDtos';\r\nimport { useProductSalesStore } from '../store/productSalesStore';\r\nimport { productSaleService as factoryProductSaleService } from '@/services/serviceFactory';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { productSalesKeys } from './useProductSales';\r\n\r\n/**\r\n * Hook for fetching product sales analytics data\r\n * @returns Query result with analytics data\r\n */\r\nexport const useProductSalesAnalytics = () => {\r\n  const { user } = useAuth();\r\n  const tenantId = user?.tenant_id || 'default-tenant';\r\n  const { setAnalytics, setError, clearError } = useProductSalesStore();\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.analytics()],\r\n    queryFn: async () => {\r\n      clearError();\r\n      try {\r\n        const analytics = await factoryProductSaleService.getProductSalesAnalytics(tenantId);\r\n\r\n        // Transform and update store\r\n        const analyticsState = {\r\n          totalSales: analytics.totalSales ?? 0,\r\n          totalRevenue: analytics.totalRevenue ?? 0,\r\n          averageSaleValue: analytics.averageSaleValue ?? 0,\r\n          topProducts: analytics.topProducts?.map((p) => ({\r\n            id: p.productId,\r\n            name: p.productName,\r\n            count: p.quantity,\r\n            revenue: p.revenue,\r\n          })) || [],\r\n          topCustomers: analytics.topCustomers?.map((c) => ({\r\n            id: c.customerId,\r\n            name: c.customerName,\r\n            count: c.totalSales,\r\n            revenue: c.revenue,\r\n          })) || [],\r\n          statusDistribution: (analytics.byStatus || []).reduce(\r\n            (acc, s) => ({\r\n              ...acc,\r\n              [s.status]: s.count,\r\n            }),\r\n            {}\r\n          ),\r\n          monthlyTrend: analytics.revenueByMonth ? Object.entries(analytics.revenueByMonth).map(([month, revenue]) => ({\r\n            month,\r\n            sales: 0, // Calculated from topProducts if needed\r\n            revenue,\r\n          })) || [] : [],\r\n        };\r\n\r\n        setAnalytics(analyticsState);\r\n        return analyticsState;\r\n      } catch (error) {\r\n        const errorMessage =\r\n          error instanceof Error ? error.message : 'Failed to fetch analytics data';\r\n        setError(errorMessage);\r\n        throw error;\r\n      }\r\n    },\r\n    staleTime: 15 * 60 * 1000, // 15 minutes\r\n    gcTime: 30 * 60 * 1000, // 30 minutes (was cacheTime)\r\n    retry: 2,\r\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for fetching top selling products\r\n * @param limit Number of top products to fetch\r\n * @returns Query result with top products\r\n */\r\nexport const useTopProductSales = (limit: number = 10) => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.analytics(), 'top-products', limit],\r\n    queryFn: async () => {\r\n      return service.getTopProducts(limit);\r\n    },\r\n    staleTime: 15 * 60 * 1000,\r\n    gcTime: 30 * 60 * 1000,\r\n    retry: 2,\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for fetching top customers by revenue\r\n * @param limit Number of top customers to fetch\r\n * @returns Query result with top customers\r\n */\r\nexport const useTopCustomerSales = (limit: number = 10) => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.analytics(), 'top-customers', limit],\r\n    queryFn: async () => {\r\n      return service.getTopCustomers(limit);\r\n    },\r\n    staleTime: 15 * 60 * 1000,\r\n    gcTime: 30 * 60 * 1000,\r\n    retry: 2,\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for fetching sales revenue trend over time\r\n * @param monthsBack Number of months to look back (default: 12)\r\n * @returns Query result with trend data\r\n */\r\nexport const useSalesRevenueTrend = (monthsBack: number = 12) => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.analytics(), 'revenue-trend', monthsBack],\r\n    queryFn: async () => {\r\n      // Calculate date range\r\n      const endDate = new Date();\r\n      const startDate = new Date();\r\n      startDate.setMonth(startDate.getMonth() - monthsBack);\r\n\r\n      return service.getRevenueTrend(\r\n        startDate.toISOString().split('T')[0],\r\n        endDate.toISOString().split('T')[0]\r\n      );\r\n    },\r\n    staleTime: 15 * 60 * 1000,\r\n    gcTime: 30 * 60 * 1000,\r\n    retry: 2,\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for fetching warranties expiring soon\r\n * @param daysAhead Number of days ahead to check (default: 30)\r\n * @returns Query result with expiring warranties\r\n */\r\nexport const useExpiringWarranties = (daysAhead: number = 30) => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.analytics(), 'expiring-warranties', daysAhead],\r\n    queryFn: async () => {\r\n      return service.getExpiringWarranties(daysAhead);\r\n    },\r\n    staleTime: 60 * 60 * 1000, // 1 hour (less frequent updates for this)\r\n    gcTime: 2 * 60 * 60 * 1000, // 2 hours\r\n    retry: 2,\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for fetching sales summary statistics\r\n * @returns Query result with summary statistics\r\n */\r\nexport const useSalesSummaryStats = () => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.analytics(), 'summary-stats'],\r\n    queryFn: async () => {\r\n      return service.getSummaryStats();\r\n    },\r\n    staleTime: 10 * 60 * 1000, // 10 minutes\r\n    gcTime: 20 * 60 * 1000,\r\n    retry: 2,\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for checking contract renewal opportunities\r\n * @returns Query result with renewal opportunities\r\n */\r\nexport const useRenewalOpportunities = () => {\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useQuery({\r\n    queryKey: [...productSalesKeys.analytics(), 'renewal-opportunities'],\r\n    queryFn: async () => {\r\n      return service.getRenewalOpportunities();\r\n    },\r\n    staleTime: 60 * 60 * 1000, // 1 hour\r\n    gcTime: 2 * 60 * 60 * 1000,\r\n    retry: 2,\r\n  });\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useProductSalesFilters.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'setFilters'. Either include it or remove the dependency array.","line":88,"column":6,"nodeType":"ArrayExpression","endLine":88,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [searchParams, setFilters]","fix":{"range":[2698,2712],"text":"[searchParams, setFilters]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useProductSalesFilters Hook\r\n * Manages filter state with URL synchronization\r\n * Supports filter presets and search debouncing\r\n */\r\n\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport { ProductSaleFilters } from '@/types/productSales';\r\nimport { useProductSalesStore } from '../store/productSalesStore';\r\n\r\n/**\r\n * Filter preset configuration\r\n */\r\nexport interface FilterPreset {\r\n  name: string;\r\n  filters: ProductSaleFilters;\r\n  description?: string;\r\n}\r\n\r\n/**\r\n * Default filter presets for quick filtering\r\n */\r\nexport const DEFAULT_PRESETS: FilterPreset[] = [\r\n  {\r\n    name: 'All Sales',\r\n    filters: {},\r\n    description: 'Show all product sales',\r\n  },\r\n  {\r\n    name: 'New Sales',\r\n    filters: { status: 'new' },\r\n    description: 'Show only new product sales',\r\n  },\r\n  {\r\n    name: 'Renewed Sales',\r\n    filters: { status: 'renewed' },\r\n    description: 'Show renewed product sales',\r\n  },\r\n  {\r\n    name: 'Expired Sales',\r\n    filters: { status: 'expired' },\r\n    description: 'Show expired product sales',\r\n  },\r\n  {\r\n    name: 'High Value',\r\n    filters: { min_amount: 50000 },\r\n    description: 'Sales over $50,000',\r\n  },\r\n];\r\n\r\n/**\r\n * Hook for managing product sales filters\r\n * Syncs filters with URL search params and store\r\n * @returns Filter management utilities\r\n */\r\nexport const useProductSalesFilters = () => {\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const { filters, setFilters, setSearchText, searchText, resetFilters } = useProductSalesStore();\r\n  const [presets, setPresets] = useState<FilterPreset[]>(DEFAULT_PRESETS);\r\n  const [searchTimeout, setSearchTimeout] = useState<NodeJS.Timeout | null>(null);\r\n\r\n  // Sync filters with URL on mount and when filters change\r\n  useEffect(() => {\r\n    // Parse URL params and apply to store\r\n    const params = Object.fromEntries(searchParams);\r\n    if (Object.keys(params).length > 0) {\r\n      const urlFilters: ProductSaleFilters = {\r\n        search: params.search,\r\n        customer_id: params.customer_id,\r\n        product_id: params.product_id,\r\n        status: params.status,\r\n        date_from: params.date_from,\r\n        date_to: params.date_to,\r\n        min_amount: params.min_amount ? Number(params.min_amount) : undefined,\r\n        max_amount: params.max_amount ? Number(params.max_amount) : undefined,\r\n      };\r\n\r\n      // Filter out undefined values\r\n      Object.keys(urlFilters).forEach((key) => {\r\n        if (urlFilters[key as keyof ProductSaleFilters] === undefined) {\r\n          delete urlFilters[key as keyof ProductSaleFilters];\r\n        }\r\n      });\r\n\r\n      setFilters(urlFilters);\r\n    }\r\n  }, [searchParams]);\r\n\r\n  /**\r\n   * Update filters and sync with URL\r\n   */\r\n  const updateFilters = useCallback(\r\n    (newFilters: Partial<ProductSaleFilters>) => {\r\n      const updatedFilters = { ...filters, ...newFilters };\r\n\r\n      // Remove undefined values\r\n      Object.keys(updatedFilters).forEach((key) => {\r\n        if (updatedFilters[key as keyof ProductSaleFilters] === undefined) {\r\n          delete updatedFilters[key as keyof ProductSaleFilters];\r\n        }\r\n      });\r\n\r\n      setFilters(updatedFilters);\r\n\r\n      // Update URL params\r\n      const newParams = new URLSearchParams();\r\n      Object.entries(updatedFilters).forEach(([key, value]) => {\r\n        if (value !== undefined) {\r\n          newParams.set(key, String(value));\r\n        }\r\n      });\r\n\r\n      setSearchParams(newParams);\r\n    },\r\n    [filters, setFilters, setSearchParams]\r\n  );\r\n\r\n  /**\r\n   * Debounced search text update\r\n   */\r\n  const updateSearchText = useCallback(\r\n    (text: string, delay = 300) => {\r\n      if (searchTimeout) {\r\n        clearTimeout(searchTimeout);\r\n      }\r\n\r\n      const timeout = setTimeout(() => {\r\n        setSearchText(text);\r\n        updateFilters({ search: text || undefined });\r\n      }, delay);\r\n\r\n      setSearchTimeout(timeout);\r\n    },\r\n    [searchTimeout, setSearchText, updateFilters]\r\n  );\r\n\r\n  /**\r\n   * Apply a preset filter\r\n   */\r\n  const applyPreset = useCallback(\r\n    (presetName: string) => {\r\n      const preset = presets.find((p) => p.name === presetName);\r\n      if (preset) {\r\n        updateFilters(preset.filters);\r\n      }\r\n    },\r\n    [presets, updateFilters]\r\n  );\r\n\r\n  /**\r\n   * Save current filters as preset\r\n   */\r\n  const saveAsPreset = useCallback(\r\n    (presetName: string, description?: string) => {\r\n      const newPreset: FilterPreset = {\r\n        name: presetName,\r\n        filters,\r\n        description,\r\n      };\r\n\r\n      const existingIndex = presets.findIndex((p) => p.name === presetName);\r\n      if (existingIndex >= 0) {\r\n        const updated = [...presets];\r\n        updated[existingIndex] = newPreset;\r\n        setPresets(updated);\r\n      } else {\r\n        setPresets([...presets, newPreset]);\r\n      }\r\n    },\r\n    [filters, presets]\r\n  );\r\n\r\n  /**\r\n   * Delete a preset\r\n   */\r\n  const deletePreset = useCallback(\r\n    (presetName: string) => {\r\n      setPresets(presets.filter((p) => p.name !== presetName));\r\n    },\r\n    [presets]\r\n  );\r\n\r\n  /**\r\n   * Clear all filters and reset to defaults\r\n   */\r\n  const clearAllFilters = useCallback(() => {\r\n    resetFilters();\r\n    setSearchParams(new URLSearchParams());\r\n  }, [resetFilters, setSearchParams]);\r\n\r\n  return {\r\n    // Current state\r\n    filters,\r\n    searchText,\r\n    presets,\r\n\r\n    // Update functions\r\n    updateFilters,\r\n    updateSearchText,\r\n    applyPreset,\r\n    saveAsPreset,\r\n    deletePreset,\r\n    clearAllFilters,\r\n\r\n    // Utilities\r\n    hasActiveFilters: Object.keys(filters).length > 0 || searchText.length > 0,\r\n  };\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useProductSalesForm.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4031,4034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4031,4034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4474,4477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4474,4477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4490,4493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4490,4493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useProductSalesForm Hook\r\n * Form state management using Ant Design Form\r\n * Handles form validation, submission, and error handling\r\n */\r\n\r\nimport { Form, FormInstance } from 'antd';\r\nimport { useCallback, useEffect } from 'react';\r\nimport { ProductSale, ProductSaleFormData, ProductSaleFilters } from '@/types/productSales';\r\nimport { useCreateProductSale } from './useCreateProductSale';\r\nimport { useUpdateProductSale } from './useUpdateProductSale';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\n/**\r\n * Form mode enumeration\r\n */\r\nexport type FormMode = 'create' | 'edit' | 'view';\r\n\r\n/**\r\n * Hook for managing product sales form\r\n * @param initialData Optional initial form data for edit mode\r\n * @param mode Form mode (create, edit, or view)\r\n * @param onSubmitSuccess Callback after successful submit\r\n * @returns Form management utilities\r\n */\r\nexport const useProductSalesForm = (\r\n  initialData?: ProductSale,\r\n  mode: FormMode = 'create',\r\n  onSubmitSuccess?: (data: ProductSale) => void\r\n) => {\r\n  const [form] = Form.useForm();\r\n  const createMutation = useCreateProductSale();\r\n  const updateMutation = useUpdateProductSale();\r\n  const { toast } = useToast();\r\n\r\n  // Populate form with initial data in edit mode\r\n  useEffect(() => {\r\n    if (mode === 'edit' && initialData) {\r\n      form.setFieldsValue({\r\n        customer_id: initialData.customer_id,\r\n        product_id: initialData.product_id,\r\n        units: initialData.units,\r\n        cost_per_unit: initialData.cost_per_unit,\r\n        delivery_date: initialData.delivery_date,\r\n        warranty_expiry: initialData.warranty_expiry,\r\n        status: initialData.status,\r\n        notes: initialData.notes,\r\n      });\r\n    }\r\n  }, [mode, initialData, form]);\r\n\r\n  /**\r\n   * Handle form submission\r\n   */\r\n  const handleSubmit = useCallback(\r\n    async (values: ProductSaleFormData) => {\r\n      try {\r\n        let result: ProductSale;\r\n\r\n        if (mode === 'edit' && initialData) {\r\n          // Update existing sale\r\n          const { data } = await updateMutation.mutateAsync({\r\n            id: initialData.id,\r\n            updates: values as Partial<ProductSale>,\r\n          });\r\n          result = data;\r\n        } else {\r\n          // Create new sale\r\n          result = await createMutation.mutateAsync(values);\r\n        }\r\n\r\n        // Clear form\r\n        form.resetFields();\r\n\r\n        // Call success callback\r\n        if (onSubmitSuccess) {\r\n          onSubmitSuccess(result);\r\n        }\r\n\r\n        return result;\r\n      } catch (error) {\r\n        console.error('Form submission error:', error);\r\n        throw error;\r\n      }\r\n    },\r\n    [mode, initialData, form, createMutation, updateMutation, onSubmitSuccess]\r\n  );\r\n\r\n  /**\r\n   * Reset form to initial state\r\n   */\r\n  const handleReset = useCallback(() => {\r\n    if (mode === 'edit' && initialData) {\r\n      // Reset to initial data in edit mode\r\n      form.setFieldsValue({\r\n        customer_id: initialData.customer_id,\r\n        product_id: initialData.product_id,\r\n        units: initialData.units,\r\n        cost_per_unit: initialData.cost_per_unit,\r\n        delivery_date: initialData.delivery_date,\r\n        warranty_expiry: initialData.warranty_expiry,\r\n        status: initialData.status,\r\n        notes: initialData.notes,\r\n      });\r\n    } else {\r\n      // Clear form in create mode\r\n      form.resetFields();\r\n    }\r\n  }, [mode, initialData, form]);\r\n\r\n  /**\r\n   * Validate form fields\r\n   */\r\n  const validateFields = useCallback(async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      return { valid: true, values };\r\n    } catch (error) {\r\n      return { valid: false, error };\r\n    }\r\n  }, [form]);\r\n\r\n  /**\r\n   * Get form field errors\r\n   */\r\n  const getFieldErrors = useCallback(() => {\r\n    return form.getFieldsError();\r\n  }, [form]);\r\n\r\n  /**\r\n   * Set field error message\r\n   */\r\n  const setFieldError = useCallback(\r\n    (fieldName: string, errorMessage: string) => {\r\n      form.setFields([\r\n        {\r\n          name: fieldName as any,\r\n          errors: [errorMessage],\r\n        },\r\n      ]);\r\n    },\r\n    [form]\r\n  );\r\n\r\n  /**\r\n   * Calculate total cost based on units and cost per unit\r\n   */\r\n  const calculateTotal = useCallback(\r\n    (units: number, costPerUnit: number) => {\r\n      return units * costPerUnit;\r\n    },\r\n    []\r\n  );\r\n\r\n  /**\r\n   * Auto-calculate total when units or cost changes\r\n   */\r\n  const handleFieldsChange = useCallback(\r\n    (_changedFields: any, allFields: any) => {\r\n      const units = form.getFieldValue('units');\r\n      const costPerUnit = form.getFieldValue('cost_per_unit');\r\n\r\n      if (units && costPerUnit) {\r\n        const total = calculateTotal(units, costPerUnit);\r\n        // Note: This would typically update a read-only display field\r\n        // form.setFieldValue('total_cost', total);\r\n      }\r\n    },\r\n    [form, calculateTotal]\r\n  );\r\n\r\n  /**\r\n   * Get form state\r\n   */\r\n  const getFormState = useCallback(\r\n    () => ({\r\n      mode,\r\n      isLoading: createMutation.isPending || updateMutation.isPending,\r\n      isValid: form.isFieldsTouched() && !form.getFieldsError().some((f) => f.errors.length),\r\n      isDirty: form.isFieldsTouched(),\r\n      values: form.getFieldsValue(),\r\n    }),\r\n    [mode, form, createMutation.isPending, updateMutation.isPending]\r\n  );\r\n\r\n  return {\r\n    // Form instance\r\n    form,\r\n\r\n    // State\r\n    isLoading: createMutation.isPending || updateMutation.isPending,\r\n    isSubmitting: createMutation.isPending || updateMutation.isPending,\r\n    error: createMutation.error || updateMutation.error,\r\n    mode,\r\n\r\n    // Methods\r\n    handleSubmit,\r\n    handleReset,\r\n    validateFields,\r\n    getFieldErrors,\r\n    setFieldError,\r\n    calculateTotal,\r\n    handleFieldsChange,\r\n    getFormState,\r\n\r\n    // Mutation states\r\n    createMutation,\r\n    updateMutation,\r\n  };\r\n};\r\n\r\n/**\r\n * Hook for validating product sale form data\r\n * @param data Form data to validate\r\n * @returns Validation result with errors if any\r\n */\r\nexport const useProductSalesFormValidation = (data: Partial<ProductSaleFormData>) => {\r\n  const errors: Record<string, string> = {};\r\n\r\n  // Validate customer_id\r\n  if (!data.customer_id) {\r\n    errors.customer_id = 'Customer is required';\r\n  }\r\n\r\n  // Validate product_id\r\n  if (!data.product_id) {\r\n    errors.product_id = 'Product is required';\r\n  }\r\n\r\n  // Validate units\r\n  if (!data.units || data.units <= 0) {\r\n    errors.units = 'Units must be greater than 0';\r\n  }\r\n\r\n  // Validate cost_per_unit\r\n  if (!data.cost_per_unit || data.cost_per_unit <= 0) {\r\n    errors.cost_per_unit = 'Cost per unit must be greater than 0';\r\n  }\r\n\r\n  // Validate delivery_date\r\n  if (!data.delivery_date) {\r\n    errors.delivery_date = 'Delivery date is required';\r\n  } else if (new Date(data.delivery_date) < new Date()) {\r\n    errors.delivery_date = 'Delivery date must be in the future';\r\n  }\r\n\r\n  // Validate notes (optional but max length)\r\n  if (data.notes && data.notes.length > 1000) {\r\n    errors.notes = 'Notes cannot exceed 1000 characters';\r\n  }\r\n\r\n  return {\r\n    isValid: Object.keys(errors).length === 0,\r\n    errors,\r\n    hasErrors: Object.keys(errors).length > 0,\r\n  };\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useProductSalesPermissions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2656,2659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2656,2659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2744,2747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2744,2747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2827,2830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2827,2830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2923,2926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2923,2926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3011,3014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3011,3014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3312,3315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3312,3315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useProductSalesPermissions Hook\r\n * Manages RBAC permission checks for product sales actions\r\n * Provides permission state for UI button visibility control\r\n */\r\n\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport { ProductSale } from '@/types/productSales';\r\nimport { productSalesRbacService } from '../services/productSalesRbacService';\r\n\r\n/**\r\n * Available actions with their permissions\r\n */\r\nexport interface ProductSalesPermissions {\r\n  canCreate: boolean;\r\n  canView: boolean;\r\n  canEdit: boolean;\r\n  canDelete: boolean;\r\n  canChangeStatus: boolean;\r\n  canApprove: boolean;\r\n  canReject: boolean;\r\n  canBulkDelete: boolean;\r\n  canBulkUpdateStatus: boolean;\r\n  canExport: boolean;\r\n  canViewAuditTrail: boolean;\r\n}\r\n\r\n/**\r\n * Props for the hook\r\n */\r\ninterface UseProductSalesPermissionsProps {\r\n  sale?: ProductSale | null;\r\n  tenantId?: string;\r\n  autoLoad?: boolean;\r\n}\r\n\r\n/**\r\n * useProductSalesPermissions Hook\r\n * Automatically checks permissions for product sales actions\r\n * \r\n * @param sale - Current product sale record (optional)\r\n * @param tenantId - Tenant ID for multi-tenant support\r\n * @param autoLoad - Whether to automatically load permissions on mount (default: true)\r\n * @returns Permissions object with boolean flags\r\n */\r\nexport const useProductSalesPermissions = ({\r\n  sale,\r\n  tenantId,\r\n  autoLoad = true,\r\n}: UseProductSalesPermissionsProps): ProductSalesPermissions => {\r\n  const [permissions, setPermissions] = useState<ProductSalesPermissions>({\r\n    canCreate: false,\r\n    canView: false,\r\n    canEdit: false,\r\n    canDelete: false,\r\n    canChangeStatus: false,\r\n    canApprove: false,\r\n    canReject: false,\r\n    canBulkDelete: false,\r\n    canBulkUpdateStatus: false,\r\n    canExport: false,\r\n    canViewAuditTrail: false,\r\n  });\r\n\r\n  /**\r\n   * Load all permissions\r\n   */\r\n  const loadPermissions = useCallback(async () => {\r\n    try {\r\n      // Check individual permissions (no sale needed for create, view, etc.)\r\n      const [\r\n        createResult,\r\n        viewResult,\r\n        editResult,\r\n        deleteResult,\r\n        changeStatusResult,\r\n        approveResult,\r\n        rejectResult,\r\n        bulkDeleteResult,\r\n        bulkUpdateStatusResult,\r\n        exportResult,\r\n        viewAuditResult,\r\n      ] = await Promise.all([\r\n        productSalesRbacService.canCreateProductSale(tenantId),\r\n        productSalesRbacService.canViewProductSales(tenantId),\r\n        // For edit/delete/etc without a specific sale, we need to check the permission\r\n        // These will return true/false based on role permissions alone\r\n        productSalesRbacService.canEditProductSale({ id: 'temp' } as any, tenantId),\r\n        productSalesRbacService.canDeleteProductSale({ id: 'temp' } as any, tenantId),\r\n        productSalesRbacService.canChangeStatus({ id: 'temp' } as any, 'new', tenantId),\r\n        productSalesRbacService.canApproveProductSale({ id: 'temp' } as any, tenantId),\r\n        productSalesRbacService.canRejectProductSale({ id: 'temp' } as any, tenantId),\r\n        productSalesRbacService.canBulkDeleteProductSales(1, tenantId),\r\n        productSalesRbacService.canBulkUpdateStatus(1, 'new', tenantId),\r\n        productSalesRbacService.canExportProductSales(1, tenantId),\r\n        productSalesRbacService.canViewAuditTrail({ id: 'temp' } as any, tenantId),\r\n      ]);\r\n\r\n      setPermissions({\r\n        canCreate: createResult.allowed || false,\r\n        canView: viewResult.allowed || false,\r\n        canEdit: editResult.allowed || false,\r\n        canDelete: deleteResult.allowed || false,\r\n        canChangeStatus: changeStatusResult.allowed || false,\r\n        canApprove: approveResult.allowed || false,\r\n        canReject: rejectResult.allowed || false,\r\n        canBulkDelete: bulkDeleteResult.allowed || false,\r\n        canBulkUpdateStatus: bulkUpdateStatusResult.allowed || false,\r\n        canExport: exportResult.allowed || false,\r\n        canViewAuditTrail: viewAuditResult.allowed || false,\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to load product sales permissions:', error);\r\n      // Keep default denied state\r\n    }\r\n  }, [tenantId]);\r\n\r\n  /**\r\n   * Load permissions on mount or when dependencies change\r\n   */\r\n  useEffect(() => {\r\n    if (autoLoad) {\r\n      loadPermissions();\r\n    }\r\n  }, [autoLoad, loadPermissions]);\r\n\r\n  return permissions;\r\n};\r\n\r\n/**\r\n * useProductSalesActionPermission Hook\r\n * Checks a single action permission with optional sale context\r\n * Useful for checking specific actions\r\n * \r\n * @param action - Action to check (create, edit, delete, etc.)\r\n * @param sale - Product sale for context-specific checks\r\n * @param tenantId - Tenant ID\r\n * @returns Boolean indicating if action is allowed\r\n */\r\nexport const useProductSalesActionPermission = (\r\n  action: 'create' | 'view' | 'edit' | 'delete' | 'changeStatus' | 'approve' | 'reject' | 'bulkDelete' | 'bulkUpdateStatus' | 'export' | 'viewAuditTrail',\r\n  sale?: ProductSale | null,\r\n  tenantId?: string\r\n): boolean => {\r\n  const [allowed, setAllowed] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const checkPermission = async () => {\r\n      try {\r\n        let result;\r\n\r\n        switch (action) {\r\n          case 'create':\r\n            result = await productSalesRbacService.canCreateProductSale(tenantId);\r\n            break;\r\n          case 'view':\r\n            result = await productSalesRbacService.canViewProductSales(tenantId);\r\n            break;\r\n          case 'edit':\r\n            result = sale\r\n              ? await productSalesRbacService.canEditProductSale(sale, tenantId)\r\n              : { allowed: false };\r\n            break;\r\n          case 'delete':\r\n            result = sale\r\n              ? await productSalesRbacService.canDeleteProductSale(sale, tenantId)\r\n              : { allowed: false };\r\n            break;\r\n          case 'changeStatus':\r\n            result = sale\r\n              ? await productSalesRbacService.canChangeStatus(sale, 'new', tenantId)\r\n              : { allowed: false };\r\n            break;\r\n          case 'approve':\r\n            result = sale\r\n              ? await productSalesRbacService.canApproveProductSale(sale, tenantId)\r\n              : { allowed: false };\r\n            break;\r\n          case 'reject':\r\n            result = sale\r\n              ? await productSalesRbacService.canRejectProductSale(sale, tenantId)\r\n              : { allowed: false };\r\n            break;\r\n          case 'bulkDelete':\r\n            result = await productSalesRbacService.canBulkDeleteProductSales(tenantId);\r\n            break;\r\n          case 'bulkUpdateStatus':\r\n            result = await productSalesRbacService.canBulkUpdateStatus(tenantId);\r\n            break;\r\n          case 'export':\r\n            result = await productSalesRbacService.canExportProductSales(tenantId);\r\n            break;\r\n          case 'viewAuditTrail':\r\n            result = sale\r\n              ? await productSalesRbacService.canViewAuditTrail(sale, tenantId)\r\n              : { allowed: false };\r\n            break;\r\n          default:\r\n            result = { allowed: false };\r\n        }\r\n\r\n        setAllowed(result?.allowed || false);\r\n      } catch (error) {\r\n        console.error(`Failed to check ${action} permission:`, error);\r\n        setAllowed(false);\r\n      }\r\n    };\r\n\r\n    checkPermission();\r\n  }, [action, sale, tenantId]);\r\n\r\n  return allowed;\r\n};\r\n\r\nexport default useProductSalesPermissions;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useStatusTransition.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4354,4357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4354,4357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useStatusTransition Hook\r\n * Manages status transitions with validation, UI feedback, and notifications\r\n */\r\n\r\nimport { useCallback, useState } from 'react';\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { message } from 'antd';\r\nimport { ProductSale } from '@/types/productSales';\r\nimport { statusTransitionService } from '../services/statusTransitionService';\r\nimport { productSalesNotificationService } from '../services/productSalesNotificationService';\r\nimport { productSalesAuditService } from '../services/productSalesAuditService';\r\nimport { productSalesRbacService } from '../services/productSalesRbacService';\r\nimport { ProductSaleStatus, getValidNextStatuses } from '../utils/statusTransitions';\r\n\r\ninterface UseStatusTransitionResult {\r\n  transitionStatus: (sale: ProductSale, newStatus: ProductSaleStatus, reason?: string) => Promise<void>;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  validNextStatuses: ProductSaleStatus[];\r\n  setValidNextStatuses: (statuses: ProductSaleStatus[]) => void;\r\n}\r\n\r\nexport const useStatusTransition = (sale: ProductSale | null): UseStatusTransitionResult => {\r\n  const queryClient = useQueryClient();\r\n  const [validNextStatuses, setValidNextStatuses] = useState<ProductSaleStatus[]>([]);\r\n\r\n  // Update valid next statuses when sale changes\r\n  const updateValidStatuses = useCallback(() => {\r\n    if (sale?.status) {\r\n      const nextStatuses = getValidNextStatuses(sale.status as ProductSaleStatus);\r\n      setValidNextStatuses(nextStatuses);\r\n    }\r\n  }, [sale?.status]);\r\n\r\n  // Call updateValidStatuses when sale changes\r\n  if (sale?.status) {\r\n    const nextStatuses = getValidNextStatuses(sale.status as ProductSaleStatus);\r\n    if (nextStatuses !== validNextStatuses) {\r\n      updateValidStatuses();\r\n    }\r\n  }\r\n\r\n  const mutation = useMutation({\r\n    mutationFn: async (params: { \r\n      sale: ProductSale; \r\n      newStatus: ProductSaleStatus; \r\n      reason?: string \r\n    }) => {\r\n      // Check RBAC permission for status change\r\n      const permissionCheck = await productSalesRbacService.canChangeStatus(\r\n        params.sale,\r\n        params.newStatus,\r\n        params.sale.tenantId\r\n      );\r\n\r\n      if (!permissionCheck.allowed) {\r\n        throw new Error(\r\n          permissionCheck.reason || 'You do not have permission to change the status of this product sale'\r\n        );\r\n      }\r\n\r\n      const result = await statusTransitionService.transitionStatus(\r\n        params.sale,\r\n        params.newStatus,\r\n        params.reason\r\n      );\r\n\r\n      if (!result.success) {\r\n        throw new Error(result.message);\r\n      }\r\n\r\n      return result;\r\n    },\r\n    onSuccess: (result, params) => {\r\n      message.success(result.message);\r\n      \r\n      // Log audit trail for status change\r\n      if (params.sale && params.sale.status) {\r\n        try {\r\n          productSalesAuditService.logStatusChange(\r\n            params.sale,\r\n            params.sale.status as string,\r\n            params.newStatus as string,\r\n            params.reason,\r\n            { source: 'status_transition_modal' }\r\n          ).catch(error => {\r\n            console.error('Failed to log status change audit:', error);\r\n            // Don't block the flow if audit logging fails\r\n          });\r\n        } catch (error) {\r\n          console.error('Error logging status change:', error);\r\n        }\r\n      }\r\n      \r\n      // Send notification for status change\r\n      if (params.sale && params.sale.status) {\r\n        try {\r\n          productSalesNotificationService.notifyStatusChange(\r\n            params.sale,\r\n            params.sale.status as ProductSaleStatus,\r\n            params.newStatus,\r\n            params.reason\r\n          ).catch(error => {\r\n            console.error('Failed to send notification:', error);\r\n            // Don't block the flow if notification fails\r\n          });\r\n        } catch (error) {\r\n          console.error('Error triggering notification:', error);\r\n        }\r\n      }\r\n      \r\n      // Invalidate product sales queries\r\n      queryClient.invalidateQueries({\r\n        queryKey: ['productSales'],\r\n      });\r\n      \r\n      // Invalidate specific sale\r\n      if (params.sale?.id) {\r\n        queryClient.invalidateQueries({\r\n          queryKey: ['productSales', params.sale.id],\r\n        });\r\n      }\r\n    },\r\n    onError: (error: any) => {\r\n      const errorMessage = error?.message || 'Failed to transition status';\r\n      message.error(errorMessage);\r\n    },\r\n  });\r\n\r\n  const transitionStatus = useCallback(\r\n    async (targetSale: ProductSale, newStatus: ProductSaleStatus, reason?: string) => {\r\n      await mutation.mutateAsync({\r\n        sale: targetSale,\r\n        newStatus,\r\n        reason,\r\n      });\r\n    },\r\n    [mutation]\r\n  );\r\n\r\n  return {\r\n    transitionStatus,\r\n    isLoading: mutation.isPending,\r\n    error: mutation.error?.message || null,\r\n    validNextStatuses,\r\n    setValidNextStatuses,\r\n  };\r\n};\r\n\r\nexport default useStatusTransition;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\hooks\\useUpdateProductSale.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[999,1002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[999,1002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3936,3939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3936,3939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useUpdateProductSale Hook\r\n * Mutation for updating existing product sales\r\n * Handles cache invalidation and notifications\r\n */\r\n\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { ProductSale } from '@/types/productSales';\r\nimport { useProductSalesStore } from '../store/productSalesStore';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { productSalesKeys } from './useProductSales';\r\nimport { productSalesAuditService } from '../services/productSalesAuditService';\r\nimport { productSalesRbacService } from '../services/productSalesRbacService';\r\n\r\n/**\r\n * Hook for updating a product sale\r\n * @returns Mutation object with mutate function and states\r\n */\r\nexport const useUpdateProductSale = () => {\r\n  const queryClient = useQueryClient();\r\n  const { updateSale, setSaving, setError, clearError } = useProductSalesStore();\r\n  const { toast } = useToast();\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useMutation({\r\n    mutationFn: async ({\r\n      id,\r\n      updates,\r\n      oldSale,\r\n    }: {\r\n      id: string;\r\n      updates: Partial<ProductSale>;\r\n      oldSale?: ProductSale;\r\n    }) => {\r\n      clearError();\r\n      setSaving(true);\r\n\r\n      try {\r\n        if (!id) {\r\n          throw new Error('Product sale ID is required');\r\n        }\r\n\r\n        // Check RBAC permission for edit operation\r\n        if (oldSale) {\r\n          const permissionResult = await productSalesRbacService.canEditProductSale(\r\n            oldSale,\r\n            undefined,\r\n            Object.keys(updates) as string[]\r\n          );\r\n          if (!permissionResult.allowed) {\r\n            throw new Error(permissionResult.reason || 'You do not have permission to edit this product sale');\r\n          }\r\n        }\r\n\r\n        const updatedSale: ProductSale = await service.updateProductSale(id, updates);\r\n\r\n        return { updatedSale, oldSale };\r\n      } catch (error) {\r\n        const errorMessage =\r\n          error instanceof Error ? error.message : 'Failed to update product sale';\r\n        setError(errorMessage);\r\n        throw error;\r\n      } finally {\r\n        setSaving(false);\r\n      }\r\n    },\r\n\r\n    onSuccess: (result: { updatedSale: ProductSale; oldSale?: ProductSale }, variables) => {\r\n      const { updatedSale, oldSale } = result;\r\n\r\n      // Log audit trail for product sale update\r\n      if (oldSale) {\r\n        productSalesAuditService.logUpdateProductSale(\r\n          oldSale,\r\n          updatedSale,\r\n          { source: 'form_submission' }\r\n        ).catch(error => {\r\n          console.error('Audit logging failed:', error);\r\n          // Don't block the flow\r\n        });\r\n      }\r\n\r\n      // Update store\r\n      updateSale(variables.id, updatedSale);\r\n\r\n      // Invalidate and refetch related queries\r\n      queryClient.invalidateQueries({\r\n        queryKey: productSalesKeys.detail(variables.id),\r\n      });\r\n\r\n      queryClient.invalidateQueries({\r\n        queryKey: productSalesKeys.list(),\r\n      });\r\n\r\n      // Show success notification\r\n      toast({\r\n        title: 'Success',\r\n        description: 'Product sale updated successfully',\r\n        variant: 'default',\r\n      });\r\n\r\n      return updatedSale;\r\n    },\r\n\r\n    onError: (error: Error) => {\r\n      const errorMessage = error.message || 'Failed to update product sale';\r\n\r\n      toast({\r\n        title: 'Error',\r\n        description: errorMessage,\r\n        variant: 'destructive',\r\n      });\r\n\r\n      console.error('Update product sale error:', error);\r\n    },\r\n  });\r\n};\r\n\r\n/**\r\n * Hook for bulk updating multiple product sales\r\n * @returns Mutation object for bulk updates\r\n */\r\nexport const useBulkUpdateProductSales = () => {\r\n  const queryClient = useQueryClient();\r\n  const { bulkUpdateSales, setSaving, setError, clearError } = useProductSalesStore();\r\n  const { toast } = useToast();\r\n  const service = useService<any>('productSaleService');\r\n\r\n  return useMutation({\r\n    mutationFn: async ({\r\n      ids,\r\n      updates,\r\n    }: {\r\n      ids: string[];\r\n      updates: Partial<ProductSale>;\r\n    }) => {\r\n      clearError();\r\n      setSaving(true);\r\n\r\n      try {\r\n        if (!ids || ids.length === 0) {\r\n          throw new Error('At least one product sale ID is required');\r\n        }\r\n\r\n        const results = await Promise.all(\r\n          ids.map((id) => service.updateProductSale(id, updates))\r\n        );\r\n\r\n        return results;\r\n      } catch (error) {\r\n        const errorMessage =\r\n          error instanceof Error ? error.message : 'Failed to update product sales';\r\n        setError(errorMessage);\r\n        throw error;\r\n      } finally {\r\n        setSaving(false);\r\n      }\r\n    },\r\n\r\n    onSuccess: (results: ProductSale[], variables) => {\r\n      // Log audit trail for bulk product sale updates\r\n      productSalesAuditService.logBulkStatusChange(\r\n        variables.ids,\r\n        'bulk',\r\n        'updated',\r\n        'Bulk update operation',\r\n        { source: 'bulk_update', recordCount: results.length }\r\n      ).catch(error => {\r\n        console.error('Audit logging failed:', error);\r\n        // Don't block the flow\r\n      });\r\n\r\n      // Update store with bulk updates\r\n      bulkUpdateSales(variables.ids, variables.updates);\r\n\r\n      // Invalidate caches\r\n      queryClient.invalidateQueries({\r\n        queryKey: productSalesKeys.list(),\r\n      });\r\n\r\n      toast({\r\n        title: 'Success',\r\n        description: `${variables.ids.length} product sales updated successfully`,\r\n        variant: 'default',\r\n      });\r\n\r\n      return results;\r\n    },\r\n\r\n    onError: (error: Error) => {\r\n      toast({\r\n        title: 'Error',\r\n        description: error.message || 'Failed to update product sales',\r\n        variant: 'destructive',\r\n      });\r\n    },\r\n  });\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":14,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":14,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales Module Routes\r\n * Defines routing for product sales pages\r\n */\r\n\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load product sales pages\r\nconst ProductSalesPage = lazy(() => import('./views/ProductSalesPage').then(m => ({ default: m.ProductSalesPage })));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading product sales...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const productSalesRoutes = [\r\n  {\r\n    path: 'product-sales',\r\n    element: (\r\n      <RouteWrapper>\r\n        <ProductSalesPage />\r\n      </RouteWrapper>\r\n    )\r\n  }\r\n];\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\bulkOperationsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\invoiceEmailService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\invoiceService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3036,3039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3036,3039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales Invoice Service\r\n * Handles invoice generation, numbering, and storage for product sales\r\n */\r\n\r\nimport { ProductSale, ProductSaleItem } from '@/types/productSales';\r\nimport { pdfTemplateService } from '@/services/pdfTemplateService';\r\nimport { auditService } from '@/services';\r\n\r\nexport interface Invoice {\r\n  id: string;\r\n  sale_id: string;\r\n  invoice_number: string;\r\n  customer_id: string;\r\n  customer_name: string;\r\n  customer_email?: string;\r\n  customer_address?: string;\r\n  items: InvoiceLineItem[];\r\n  subtotal: number;\r\n  tax: number;\r\n  tax_rate: number;\r\n  total: number;\r\n  currency: string;\r\n  status: 'draft' | 'generated' | 'sent' | 'viewed' | 'paid';\r\n  generated_at: Date;\r\n  sent_at?: Date;\r\n  paid_at?: Date;\r\n  pdf_url?: string;\r\n  notes?: string;\r\n  payment_terms?: string;\r\n  due_date?: Date;\r\n}\r\n\r\nexport interface InvoiceLineItem {\r\n  product_id: string;\r\n  product_name: string;\r\n  description: string;\r\n  quantity: number;\r\n  unit_price: number;\r\n  tax_rate: number;\r\n  line_total: number;\r\n}\r\n\r\ninterface InvoiceGenerationOptions {\r\n  taxRate?: number;\r\n  paymentTerms?: string;\r\n  notes?: string;\r\n  currency?: string;\r\n}\r\n\r\n/**\r\n * Generate next invoice number\r\n * Format: INV-YYYY-MM-XXXXX (INV-2025-01-00001)\r\n */\r\nfunction generateInvoiceNumber(): string {\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  const month = String(now.getMonth() + 1).padStart(2, '0');\r\n  \r\n  // Use timestamp-based sequence for uniqueness\r\n  const timestamp = Date.now().toString().slice(-5);\r\n  const sequence = String(parseInt(timestamp) % 100000).padStart(5, '0');\r\n  \r\n  return `INV-${year}-${month}-${sequence}`;\r\n}\r\n\r\n/**\r\n * Calculate invoice totals\r\n */\r\nfunction calculateInvoiceTotals(\r\n  items: InvoiceLineItem[],\r\n  taxRate: number = 0\r\n): { subtotal: number; tax: number; total: number } {\r\n  const subtotal = items.reduce((sum, item) => sum + item.line_total, 0);\r\n  const tax = subtotal * (taxRate / 100);\r\n  const total = subtotal + tax;\r\n\r\n  return {\r\n    subtotal: Math.round(subtotal * 100) / 100,\r\n    tax: Math.round(tax * 100) / 100,\r\n    total: Math.round(total * 100) / 100,\r\n  };\r\n}\r\n\r\n/**\r\n * Convert ProductSale to InvoiceLineItems\r\n */\r\nfunction convertSaleItemsToInvoiceItems(\r\n  saleItems: ProductSaleItem[],\r\n  taxRate: number = 0\r\n): InvoiceLineItem[] {\r\n  return saleItems.map(item => ({\r\n    product_id: item.product_id,\r\n    product_name: item.product_name || 'Product',\r\n    description: item.description || '',\r\n    quantity: item.quantity,\r\n    unit_price: item.unit_price,\r\n    tax_rate: taxRate,\r\n    line_total: item.quantity * item.unit_price,\r\n  }));\r\n}\r\n\r\n/**\r\n * Format currency value\r\n */\r\nfunction formatCurrency(value: number, currency: string = 'USD'): string {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency,\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2,\r\n  }).format(value);\r\n}\r\n\r\n/**\r\n * Render invoice HTML from template\r\n */\r\nfunction renderInvoiceHTML(invoice: Invoice, template: any): string {\r\n  let html = template.content;\r\n\r\n  // Replace template variables\r\n  const replacements: Record<string, string> = {\r\n    invoice_number: invoice.invoice_number,\r\n    date: invoice.generated_at.toLocaleDateString(),\r\n    due_date: invoice.due_date?.toLocaleDateString() || 'Upon Receipt',\r\n    customer_name: invoice.customer_name,\r\n    customer_address: invoice.customer_address || '',\r\n    customer_city: '',\r\n    customer_state: '',\r\n    customer_zip: '',\r\n    subtotal: formatCurrency(invoice.subtotal),\r\n    tax: formatCurrency(invoice.tax),\r\n    total: formatCurrency(invoice.total),\r\n    items: invoice.items\r\n      .map(\r\n        item => `\r\n          <tr>\r\n            <td style=\"border: 1px solid #ddd; padding: 8px;\">${item.product_name}</td>\r\n            <td style=\"border: 1px solid #ddd; padding: 8px; text-align: center;\">${item.quantity}</td>\r\n            <td style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">${formatCurrency(item.unit_price)}</td>\r\n            <td style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">${formatCurrency(item.line_total)}</td>\r\n          </tr>\r\n        `\r\n      )\r\n      .join(''),\r\n  };\r\n\r\n  // Replace all variables in template\r\n  Object.entries(replacements).forEach(([key, value]) => {\r\n    html = html.replace(new RegExp(`{{${key}}}`, 'g'), value);\r\n  });\r\n\r\n  return html;\r\n}\r\n\r\nexport const invoiceService = {\r\n  /**\r\n   * Generate invoice from ProductSale\r\n   */\r\n  async generateInvoice(\r\n    sale: ProductSale,\r\n    saleItems: ProductSaleItem[],\r\n    options: InvoiceGenerationOptions = {}\r\n  ): Promise<Invoice> {\r\n    try {\r\n      const {\r\n        taxRate = 0,\r\n        paymentTerms = 'Net 30',\r\n        notes = '',\r\n        currency = 'USD',\r\n      } = options;\r\n\r\n      // Generate invoice number\r\n      const invoiceNumber = generateInvoiceNumber();\r\n\r\n      // Convert sale items to invoice items\r\n      const invoiceItems = convertSaleItemsToInvoiceItems(saleItems, taxRate);\r\n\r\n      // Calculate totals\r\n      const { subtotal, tax, total } = calculateInvoiceTotals(invoiceItems, taxRate);\r\n\r\n      // Create due date (30 days from now by default)\r\n      const dueDate = new Date();\r\n      dueDate.setDate(dueDate.getDate() + 30);\r\n\r\n      const invoice: Invoice = {\r\n        id: `inv_${Date.now()}`,\r\n        sale_id: sale.id,\r\n        invoice_number: invoiceNumber,\r\n        customer_id: sale.customer_id,\r\n        customer_name: sale.customer_name || 'Valued Customer',\r\n        customer_email: sale.customer_email,\r\n        customer_address: sale.billing_address || sale.shipping_address,\r\n        items: invoiceItems,\r\n        subtotal,\r\n        tax,\r\n        tax_rate: taxRate,\r\n        total,\r\n        currency,\r\n        status: 'generated',\r\n        generated_at: new Date(),\r\n        due_date: dueDate,\r\n        payment_terms: paymentTerms,\r\n        notes,\r\n      };\r\n\r\n      // Log invoice generation\r\n      await auditService.logAction({\r\n        action: 'invoice_generated',\r\n        resource: 'product_sale',\r\n        resource_id: sale.id,\r\n        details: {\r\n          invoice_number: invoiceNumber,\r\n          total,\r\n          tax_rate: taxRate,\r\n        },\r\n      });\r\n\r\n      return invoice;\r\n    } catch (error) {\r\n      console.error('Error generating invoice:', error);\r\n      throw new Error('Failed to generate invoice');\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get default invoice template\r\n   */\r\n  async getDefaultTemplate() {\r\n    try {\r\n      const templates = await pdfTemplateService.getAllTemplates({\r\n        category: 'invoice',\r\n        is_active: true,\r\n      });\r\n\r\n      // Return default template or first active one\r\n      return templates.find(t => t.is_default) || templates[0];\r\n    } catch (error) {\r\n      console.error('Error fetching invoice template:', error);\r\n      return null;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Render invoice to HTML (for PDF conversion)\r\n   */\r\n  async renderInvoiceHTML(invoice: Invoice): Promise<string> {\r\n    try {\r\n      const template = await this.getDefaultTemplate();\r\n      if (!template) {\r\n        throw new Error('No invoice template found');\r\n      }\r\n\r\n      return renderInvoiceHTML(invoice, template);\r\n    } catch (error) {\r\n      console.error('Error rendering invoice HTML:', error);\r\n      throw new Error('Failed to render invoice');\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Calculate invoice totals\r\n   */\r\n  calculateTotals(items: InvoiceLineItem[], taxRate: number = 0) {\r\n    return calculateInvoiceTotals(items, taxRate);\r\n  },\r\n\r\n  /**\r\n   * Generate invoice number\r\n   */\r\n  generateInvoiceNumber() {\r\n    return generateInvoiceNumber();\r\n  },\r\n\r\n  /**\r\n   * Format currency\r\n   */\r\n  formatCurrency(value: number, currency: string = 'USD'): string {\r\n    return formatCurrency(value, currency);\r\n  },\r\n};\r\n\r\nexport default invoiceService;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\productSalesAuditService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2710,2713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2710,2713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2761,2764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2761,2764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3251,3254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3251,3254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3378,3381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3378,3381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales Audit Service\r\n * Handles audit logging for all product sales operations\r\n * - CRUD operations (create, update, delete)\r\n * - Status changes\r\n * - User actions\r\n * - IP address and user agent tracking\r\n */\r\n\r\nimport { ProductSale } from '@/types/productSales';\r\nimport { auditService } from '@/services/auditService';\r\n\r\ninterface AuditLogParams {\r\n  action: 'CREATE' | 'UPDATE' | 'DELETE' | 'STATUS_CHANGE' | 'EXPORT' | 'BULK_DELETE' | 'APPROVE' | 'REJECT';\r\n  resource: string;\r\n  resourceId: string;\r\n  before?: unknown;\r\n  after?: unknown;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\ninterface AuditTrailEntry {\r\n  id: string;\r\n  action: string;\r\n  resource: string;\r\n  resourceId: string;\r\n  userId: string;\r\n  userName: string;\r\n  userEmail: string;\r\n  changes?: {\r\n    before: unknown;\r\n    after: unknown;\r\n  };\r\n  metadata?: Record<string, unknown>;\r\n  ipAddress: string;\r\n  userAgent: string;\r\n  createdAt: string;\r\n  tenantId: string;\r\n}\r\n\r\nclass ProductSalesAuditService {\r\n  /**\r\n   * Log product sale creation\r\n   */\r\n  async logCreateProductSale(\r\n    sale: ProductSale,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      await auditService.logAction(\r\n        'CREATE',\r\n        'product_sale',\r\n        sale.id,\r\n        {\r\n          before: {},\r\n          after: {\r\n            customer_id: sale.customer_id,\r\n            customer_name: sale.customer_name,\r\n            product_id: sale.product_id,\r\n            product_name: sale.product_name,\r\n            units: sale.units,\r\n            cost_per_unit: sale.cost_per_unit,\r\n            total_cost: sale.total_cost,\r\n            delivery_date: sale.delivery_date,\r\n            warranty_expiry: sale.warranty_expiry,\r\n            status: sale.status,\r\n            notes: sale.notes\r\n          }\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log product sale creation:', error);\r\n      // Don't throw - audit failures should not block operations\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log product sale update\r\n   */\r\n  async logUpdateProductSale(\r\n    oldSale: ProductSale,\r\n    newSale: ProductSale,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      // Extract changed fields only\r\n      const changes: Record<string, unknown> = {};\r\n      const fields = [\r\n        'customer_id',\r\n        'customer_name',\r\n        'product_id',\r\n        'product_name',\r\n        'units',\r\n        'cost_per_unit',\r\n        'delivery_date',\r\n        'warranty_expiry',\r\n        'notes'\r\n      ];\r\n\r\n      fields.forEach(field => {\r\n        const oldValue = (oldSale as any)[field];\r\n        const newValue = (newSale as any)[field];\r\n        if (oldValue !== newValue) {\r\n          changes[field] = {\r\n            from: oldValue,\r\n            to: newValue\r\n          };\r\n        }\r\n      });\r\n\r\n      if (Object.keys(changes).length === 0) {\r\n        return; // No changes, don't log\r\n      }\r\n\r\n      await auditService.logAction(\r\n        'UPDATE',\r\n        'product_sale',\r\n        newSale.id,\r\n        {\r\n          before: Object.fromEntries(\r\n            Object.keys(changes).map(key => [key, (oldSale as any)[key]])\r\n          ),\r\n          after: Object.fromEntries(\r\n            Object.keys(changes).map(key => [key, (newSale as any)[key]])\r\n          )\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          changedFields: Object.keys(changes),\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log product sale update:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log product sale deletion\r\n   */\r\n  async logDeleteProductSale(\r\n    sale: ProductSale,\r\n    reason?: string,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      await auditService.logAction(\r\n        'DELETE',\r\n        'product_sale',\r\n        sale.id,\r\n        {\r\n          before: {\r\n            customer_id: sale.customer_id,\r\n            customer_name: sale.customer_name,\r\n            product_id: sale.product_id,\r\n            product_name: sale.product_name,\r\n            units: sale.units,\r\n            total_cost: sale.total_cost,\r\n            status: sale.status\r\n          },\r\n          after: {}\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          reason: reason || 'User initiated deletion',\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log product sale deletion:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log product sale status change\r\n   */\r\n  async logStatusChange(\r\n    sale: ProductSale,\r\n    oldStatus: string,\r\n    newStatus: string,\r\n    reason?: string,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      await auditService.logAction(\r\n        'STATUS_CHANGE',\r\n        'product_sale',\r\n        sale.id,\r\n        {\r\n          before: { status: oldStatus },\r\n          after: { status: newStatus }\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          oldStatus,\r\n          newStatus,\r\n          reason: reason || 'No reason provided',\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log status change:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log bulk deletion operation\r\n   */\r\n  async logBulkDelete(\r\n    saleIds: string[],\r\n    reason?: string,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      await auditService.logAction(\r\n        'BULK_DELETE',\r\n        'product_sale',\r\n        'bulk',\r\n        {\r\n          before: { count: saleIds.length, ids: saleIds },\r\n          after: {}\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          recordCount: saleIds.length,\r\n          reason: reason || 'Bulk deletion initiated',\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log bulk deletion:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log bulk status change operation\r\n   */\r\n  async logBulkStatusChange(\r\n    saleIds: string[],\r\n    oldStatus: string,\r\n    newStatus: string,\r\n    reason?: string,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      await auditService.logAction(\r\n        'STATUS_CHANGE',\r\n        'product_sale_bulk',\r\n        'bulk',\r\n        {\r\n          before: { status: oldStatus, count: saleIds.length },\r\n          after: { status: newStatus, count: saleIds.length }\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          isBulkOperation: true,\r\n          recordCount: saleIds.length,\r\n          oldStatus,\r\n          newStatus,\r\n          reason: reason || 'Bulk status change initiated',\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log bulk status change:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log data export operation\r\n   */\r\n  async logExport(\r\n    format: 'csv' | 'json' | 'excel',\r\n    recordCount: number,\r\n    filters?: Record<string, unknown>,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      await auditService.logAction(\r\n        'EXPORT',\r\n        'product_sale',\r\n        'export',\r\n        {\r\n          before: {},\r\n          after: { format, recordCount }\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          format,\r\n          recordCount,\r\n          filters: filters || {},\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log export:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log approval action\r\n   */\r\n  async logApproval(\r\n    sale: ProductSale,\r\n    approvalType: 'approved' | 'rejected',\r\n    reason?: string,\r\n    metadata?: Record<string, unknown>\r\n  ): Promise<void> {\r\n    try {\r\n      await auditService.logAction(\r\n        approvalType === 'approved' ? 'APPROVE' : 'REJECT',\r\n        'product_sale',\r\n        sale.id,\r\n        {\r\n          before: { status: sale.status },\r\n          after: { approvalType }\r\n        },\r\n        {\r\n          source: 'product_sales_module',\r\n          approvalType,\r\n          reason: reason || 'No reason provided',\r\n          saleName: `${sale.customer_name} - ${sale.product_name}`,\r\n          ...metadata\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to log approval action:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get audit trail for a specific product sale\r\n   * This delegates to the main audit service\r\n   */\r\n  async getAuditTrail(\r\n    saleId: string,\r\n    limit: number = 50\r\n  ): Promise<AuditTrailEntry[]> {\r\n    try {\r\n      // Get all audit logs for this product sale\r\n      const logs = await auditService.getAuditLogs({\r\n        resource: 'product_sale',\r\n        search: saleId,\r\n        limit,\r\n        page: 1\r\n      });\r\n\r\n      // Filter to only logs for this specific sale\r\n      return logs\r\n        .filter(log => log.resourceId === saleId)\r\n        .map(log => ({\r\n          id: log.id,\r\n          action: log.action,\r\n          resource: log.resource,\r\n          resourceId: log.resourceId,\r\n          userId: log.user.id,\r\n          userName: log.user.name,\r\n          userEmail: log.user.email,\r\n          changes: log.changes,\r\n          metadata: log.metadata,\r\n          ipAddress: log.ipAddress,\r\n          userAgent: log.userAgent,\r\n          createdAt: log.createdAt,\r\n          tenantId: log.tenantId\r\n        }));\r\n    } catch (error) {\r\n      console.error('Failed to retrieve audit trail:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get audit statistics for product sales\r\n   */\r\n  async getAuditStats(): Promise<{\r\n    totalActions: number;\r\n    actionBreakdown: Record<string, number>;\r\n    recentActions: number;\r\n  }> {\r\n    try {\r\n      const stats = await auditService.getAuditStats();\r\n      \r\n      return {\r\n        totalActions: stats.totalLogs,\r\n        actionBreakdown: stats.actionBreakdown.reduce((acc, item) => {\r\n          acc[item.action] = item.count;\r\n          return acc;\r\n        }, {} as Record<string, number>),\r\n        recentActions: stats.recentActivity\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to retrieve audit statistics:', error);\r\n      return {\r\n        totalActions: 0,\r\n        actionBreakdown: {},\r\n        recentActions: 0\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export audit trail for a product sale\r\n   */\r\n  async exportAuditTrail(\r\n    saleId: string,\r\n    format: 'csv' | 'json' = 'csv'\r\n  ): Promise<string> {\r\n    try {\r\n      const trail = await this.getAuditTrail(saleId, 1000);\r\n\r\n      if (format === 'json') {\r\n        return JSON.stringify(trail, null, 2);\r\n      }\r\n\r\n      // CSV format\r\n      const headers = [\r\n        'Action',\r\n        'Date',\r\n        'User',\r\n        'User Email',\r\n        'Changes',\r\n        'Reason',\r\n        'IP Address'\r\n      ];\r\n\r\n      const rows = trail.map(entry => [\r\n        entry.action,\r\n        entry.createdAt,\r\n        entry.userName,\r\n        entry.userEmail,\r\n        entry.changes ? JSON.stringify(entry.changes) : '-',\r\n        (entry.metadata?.reason as string) || '-',\r\n        entry.ipAddress\r\n      ]);\r\n\r\n      return [headers, ...rows]\r\n        .map(row => \r\n          row\r\n            .map(cell => `\"${cell?.toString().replace(/\"/g, '\"\"') || ''}\"`)\r\n            .join(',')\r\n        )\r\n        .join('\\r\\n');\r\n    } catch (error) {\r\n      console.error('Failed to export audit trail:', error);\r\n      return '';\r\n    }\r\n  }\r\n}\r\n\r\nexport const productSalesAuditService = new ProductSalesAuditService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\productSalesNotificationService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[799,802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[799,802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":445,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":445,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14992,14995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14992,14995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":458,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15372,15375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15372,15375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales Notification Service\r\n * Handles notifications for product sales events (status changes, approvals, etc.)\r\n * Supports SMS, email, and in-app notifications with user preferences\r\n */\r\n\r\nimport { notificationService as factoryNotificationService } from '@/services/serviceFactory';\r\nimport { authService } from '@/services/authService';\r\nimport { ProductSale, ProductSaleStatus } from '@/types/productSales';\r\n\r\nexport interface NotificationPayload {\r\n  type: 'status_change' | 'approval_required' | 'shipment_ready' | 'delivery_confirmed' | 'invoice_generated' | 'payment_received' | 'sale_cancelled' | 'refund_processed';\r\n  channels: ('sms' | 'email' | 'in_app')[];\r\n  recipient_id?: string;\r\n  sale_id: string;\r\n  title: string;\r\n  message: string;\r\n  data?: Record<string, any>;\r\n  action_url?: string;\r\n  action_label?: string;\r\n}\r\n\r\nexport interface NotificationHistory {\r\n  id: string;\r\n  sale_id: string;\r\n  type: NotificationPayload['type'];\r\n  channels_sent: ('sms' | 'email' | 'in_app')[];\r\n  recipient_id: string;\r\n  title: string;\r\n  message: string;\r\n  created_at: string;\r\n  status: 'sent' | 'pending' | 'failed';\r\n}\r\n\r\nclass ProductSalesNotificationService {\r\n  /**\r\n   * Send notification on status change with user preferences\r\n   */\r\n  async notifyStatusChange(\r\n    sale: ProductSale,\r\n    oldStatus: ProductSaleStatus,\r\n    newStatus: ProductSaleStatus,\r\n    reason?: string\r\n  ): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      // Get user notification preferences\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n\r\n      // Determine notification channels based on preferences\r\n      const channels = this.getEnabledChannels(preferences, 'status_change');\r\n      if (channels.length === 0) {\r\n        console.log('Status change notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      // Create notification payload\r\n      const payload: NotificationPayload = {\r\n        type: 'status_change',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: sale.customer_id,\r\n        title: `Order Status Changed`,\r\n        message: `Your order #${sale.id} status has been updated from ${oldStatus} to ${newStatus}${reason ? ': ' + reason : ''}`,\r\n        data: {\r\n          old_status: oldStatus,\r\n          new_status: newStatus,\r\n          sale_id: sale.id,\r\n          customer_name: sale.customer_name,\r\n          order_date: sale.created_at,\r\n          reason,\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'View Order',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending status change notification:', error);\r\n      // Don't throw - notification errors shouldn't break the main flow\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send approval required notification\r\n   */\r\n  async notifyApprovalRequired(sale: ProductSale, approverEmail: string): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n      const channels = this.getEnabledChannels(preferences, 'approval_required');\r\n\r\n      if (channels.length === 0) {\r\n        console.log('Approval notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      const payload: NotificationPayload = {\r\n        type: 'approval_required',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: approverEmail,\r\n        title: `Approval Required`,\r\n        message: `Order #${sale.id} from ${sale.customer_name} requires your approval`,\r\n        data: {\r\n          sale_id: sale.id,\r\n          customer_name: sale.customer_name,\r\n          amount: sale.total_amount,\r\n          items_count: sale.items?.length || 0,\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'Review & Approve',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending approval notification:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send shipment ready notification\r\n   */\r\n  async notifyShipmentReady(sale: ProductSale): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n      const channels = this.getEnabledChannels(preferences, 'shipment_ready');\r\n\r\n      if (channels.length === 0) {\r\n        console.log('Shipment notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      const payload: NotificationPayload = {\r\n        type: 'shipment_ready',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: sale.customer_id,\r\n        title: `Shipment Ready`,\r\n        message: `Your order #${sale.id} is ready for shipment`,\r\n        data: {\r\n          sale_id: sale.id,\r\n          customer_name: sale.customer_name,\r\n          tracking_number: sale.tracking_number,\r\n          items_count: sale.items?.length || 0,\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'Track Shipment',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending shipment ready notification:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send delivery confirmed notification\r\n   */\r\n  async notifyDeliveryConfirmed(sale: ProductSale): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n      const channels = this.getEnabledChannels(preferences, 'delivery_confirmed');\r\n\r\n      if (channels.length === 0) {\r\n        console.log('Delivery notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      const payload: NotificationPayload = {\r\n        type: 'delivery_confirmed',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: sale.customer_id,\r\n        title: `Delivery Confirmed`,\r\n        message: `Your order #${sale.id} has been successfully delivered`,\r\n        data: {\r\n          sale_id: sale.id,\r\n          customer_name: sale.customer_name,\r\n          delivery_date: new Date().toISOString(),\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'View Details',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending delivery confirmed notification:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send invoice generated notification\r\n   */\r\n  async notifyInvoiceGenerated(sale: ProductSale, invoiceNumber: string): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n      const channels = this.getEnabledChannels(preferences, 'invoice_generated');\r\n\r\n      if (channels.length === 0) {\r\n        console.log('Invoice notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      const payload: NotificationPayload = {\r\n        type: 'invoice_generated',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: sale.customer_id,\r\n        title: `Invoice Generated`,\r\n        message: `Invoice ${invoiceNumber} has been generated for order #${sale.id}`,\r\n        data: {\r\n          sale_id: sale.id,\r\n          invoice_number: invoiceNumber,\r\n          amount: sale.total_amount,\r\n          customer_name: sale.customer_name,\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'Download Invoice',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending invoice notification:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send payment received notification\r\n   */\r\n  async notifyPaymentReceived(sale: ProductSale, amount: number): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n      const channels = this.getEnabledChannels(preferences, 'payment_received');\r\n\r\n      if (channels.length === 0) {\r\n        console.log('Payment notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      const payload: NotificationPayload = {\r\n        type: 'payment_received',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: sale.customer_id,\r\n        title: `Payment Received`,\r\n        message: `Payment of $${amount.toFixed(2)} has been received for order #${sale.id}`,\r\n        data: {\r\n          sale_id: sale.id,\r\n          amount,\r\n          customer_name: sale.customer_name,\r\n          payment_date: new Date().toISOString(),\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'View Payment Details',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending payment notification:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send sale cancelled notification\r\n   */\r\n  async notifySaleCancelled(sale: ProductSale, reason?: string): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n      const channels = this.getEnabledChannels(preferences, 'sale_cancelled');\r\n\r\n      if (channels.length === 0) {\r\n        console.log('Cancellation notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      const payload: NotificationPayload = {\r\n        type: 'sale_cancelled',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: sale.customer_id,\r\n        title: `Order Cancelled`,\r\n        message: `Order #${sale.id} has been cancelled${reason ? ': ' + reason : ''}`,\r\n        data: {\r\n          sale_id: sale.id,\r\n          customer_name: sale.customer_name,\r\n          cancelled_date: new Date().toISOString(),\r\n          reason,\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'View Details',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending cancellation notification:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send refund processed notification\r\n   */\r\n  async notifyRefundProcessed(sale: ProductSale, refundAmount: number): Promise<void> {\r\n    try {\r\n      const currentUser = await authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('Cannot send notification: no current user');\r\n        return;\r\n      }\r\n\r\n      const preferences = await factoryNotificationService.getNotificationPreferences();\r\n      const channels = this.getEnabledChannels(preferences, 'refund_processed');\r\n\r\n      if (channels.length === 0) {\r\n        console.log('Refund notifications disabled by user');\r\n        return;\r\n      }\r\n\r\n      const payload: NotificationPayload = {\r\n        type: 'refund_processed',\r\n        channels,\r\n        sale_id: sale.id,\r\n        recipient_id: sale.customer_id,\r\n        title: `Refund Processed`,\r\n        message: `Refund of $${refundAmount.toFixed(2)} has been processed for order #${sale.id}`,\r\n        data: {\r\n          sale_id: sale.id,\r\n          refund_amount: refundAmount,\r\n          customer_name: sale.customer_name,\r\n          refund_date: new Date().toISOString(),\r\n        },\r\n        action_url: `/product-sales/${sale.id}`,\r\n        action_label: 'View Refund Details',\r\n      };\r\n\r\n      await this.sendNotification(payload, currentUser.id);\r\n    } catch (error) {\r\n      console.error('Error sending refund notification:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get notification history for a sale\r\n   */\r\n  async getNotificationHistory(saleId: string): Promise<NotificationHistory[]> {\r\n    try {\r\n      // Query notifications for this sale (in-app notifications only)\r\n      const notifications = await factoryNotificationService.getNotifications({\r\n        category: 'product_sales',\r\n      });\r\n\r\n      // Filter by sale_id from data\r\n      const saleNotifications = notifications\r\n        .filter(n => n.data?.sale_id === saleId)\r\n        .map(n => ({\r\n          id: n.id,\r\n          sale_id: saleId,\r\n          type: (n.data?.notification_type || 'status_change') as NotificationPayload['type'],\r\n          channels_sent: n.data?.channels_sent || ['in_app'],\r\n          recipient_id: n.user_id,\r\n          title: n.title,\r\n          message: n.message,\r\n          created_at: n.created_at,\r\n          status: 'sent' as const,\r\n        }));\r\n\r\n      return saleNotifications;\r\n    } catch (error) {\r\n      console.error('Error fetching notification history:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get user notification preferences\r\n   */\r\n  async getUserNotificationPreferences() {\r\n    try {\r\n      return await factoryNotificationService.getNotificationPreferences();\r\n    } catch (error) {\r\n      console.error('Error fetching notification preferences:', error);\r\n      // Return default preferences\r\n      return {\r\n        email: true,\r\n        sms: false,\r\n        push: true,\r\n        in_app: true,\r\n        categories: {\r\n          status_change: { email: true, sms: false, push: true, in_app: true },\r\n          approval_required: { email: true, sms: true, push: true, in_app: true },\r\n          shipment_ready: { email: true, sms: true, push: true, in_app: true },\r\n          delivery_confirmed: { email: true, sms: false, push: true, in_app: true },\r\n          invoice_generated: { email: true, sms: false, push: false, in_app: true },\r\n          payment_received: { email: true, sms: true, push: true, in_app: true },\r\n          sale_cancelled: { email: true, sms: false, push: true, in_app: true },\r\n          refund_processed: { email: true, sms: true, push: true, in_app: true },\r\n        },\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update user notification preferences\r\n   */\r\n  async updateUserNotificationPreferences(preferences: any): Promise<void> {\r\n    try {\r\n      await factoryNotificationService.updateNotificationPreferences(preferences);\r\n    } catch (error) {\r\n      console.error('Error updating notification preferences:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Private: Get enabled notification channels based on preferences\r\n   */\r\n  private getEnabledChannels(\r\n    preferences: any,\r\n    notificationType: string\r\n  ): ('sms' | 'email' | 'in_app')[] {\r\n    const channels: ('sms' | 'email' | 'in_app')[] = [];\r\n\r\n    try {\r\n      // Get category-specific preferences or fall back to global preferences\r\n      const categoryPrefs = preferences.categories?.[notificationType] || preferences;\r\n\r\n      if (categoryPrefs.email !== false && preferences.email !== false) {\r\n        channels.push('email');\r\n      }\r\n      if (categoryPrefs.sms === true && preferences.sms !== false) {\r\n        channels.push('sms');\r\n      }\r\n      if (categoryPrefs.in_app !== false && preferences.in_app !== false) {\r\n        channels.push('in_app');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error determining enabled channels:', error);\r\n      // Default to in-app only\r\n      channels.push('in_app');\r\n    }\r\n\r\n    return channels;\r\n  }\r\n\r\n  /**\r\n   * Private: Send notification through appropriate channels\r\n   */\r\n  private async sendNotification(\r\n    payload: NotificationPayload,\r\n    senderId: string\r\n  ): Promise<void> {\r\n    try {\r\n      // Send in-app notification\r\n      if (payload.channels.includes('in_app')) {\r\n        await factoryNotificationService.notify({\r\n          type: 'info',\r\n          message: payload.title,\r\n          description: payload.message,\r\n          duration: 5,\r\n          category: 'product_sales',\r\n        });\r\n\r\n        // Also create a persistent notification in database\r\n        // This is handled by the notificationService\r\n      }\r\n\r\n      // Log notification sent for audit\r\n      console.log(`üìß Notification sent - Type: ${payload.type}, Channels: ${payload.channels.join(', ')}`);\r\n    } catch (error) {\r\n      console.error('Error sending notification through channels:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nexport const productSalesNotificationService = new ProductSalesNotificationService();\r\nexport default productSalesNotificationService;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\productSalesRbacService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2459,2462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2459,2462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales RBAC Service\r\n * Handles role-based access control and permission checks for product sales operations\r\n * Integrates with application-wide rbacService for permission validation\r\n * \r\n * Pattern: Module-specific RBAC service that delegates to application-wide rbacService\r\n * Factory Pattern: Uses service factory for multi-mode support (mock/supabase)\r\n * Non-blocking: Permission failures are non-blocking and allow graceful degradation\r\n */\r\n\r\nimport { rbacService as factoryRbacService } from '@/services/serviceFactory';\r\nimport { ProductSale } from '@/types/productSales';\r\n\r\n/**\r\n * RBAC actions specific to product sales module\r\n * Used for permission checking and audit logging\r\n */\r\nexport enum ProductSalesRbacAction {\r\n  // Create operations\r\n  CREATE_PRODUCT_SALE = 'product_sales:create',\r\n  CREATE_PRODUCT_SALE_WITH_CONTRACT = 'product_sales:create_with_contract',\r\n  \r\n  // Read operations\r\n  VIEW_PRODUCT_SALES = 'product_sales:view',\r\n  VIEW_PRODUCT_SALE_DETAILS = 'product_sales:view_details',\r\n  VIEW_AUDIT_TRAIL = 'product_sales:view_audit',\r\n  EXPORT_PRODUCT_SALES = 'product_sales:export',\r\n  \r\n  // Update operations\r\n  EDIT_PRODUCT_SALE = 'product_sales:edit',\r\n  EDIT_PRODUCT_SALE_FIELDS = 'product_sales:edit_fields',\r\n  CHANGE_STATUS = 'product_sales:change_status',\r\n  \r\n  // Delete operations\r\n  DELETE_PRODUCT_SALE = 'product_sales:delete',\r\n  BULK_DELETE_PRODUCT_SALES = 'product_sales:bulk_delete',\r\n  \r\n  // Approval operations\r\n  APPROVE_PRODUCT_SALE = 'product_sales:approve',\r\n  REJECT_PRODUCT_SALE = 'product_sales:reject',\r\n  \r\n  // Bulk operations\r\n  BULK_UPDATE_STATUS = 'product_sales:bulk_update_status',\r\n  BULK_EXPORT = 'product_sales:bulk_export',\r\n}\r\n\r\n/**\r\n * RBAC permission result interface\r\n */\r\nexport interface PermissionResult {\r\n  allowed: boolean;\r\n  reason?: string;\r\n  denialCode?: 'ROLE_MISSING' | 'PERMISSION_DENIED' | 'TENANT_MISMATCH' | 'UNKNOWN';\r\n}\r\n\r\n/**\r\n * Product Sales RBAC Service\r\n * Provides permission checking and authorization logic for product sales operations\r\n */\r\nexport const productSalesRbacService = {\r\n  /**\r\n   * Check if user can create a product sale\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @param metadata - Optional metadata for detailed permission checks\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canCreateProductSale: async (\r\n    tenantId?: string,\r\n    metadata?: Record<string, any>\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.CREATE_PRODUCT_SALE,\r\n        { tenantId, ...metadata }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to create product sales',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking create permission:', error);\r\n      // On error, log but allow (graceful degradation)\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can view product sales list\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag\r\n   */\r\n  canViewProductSales: async (tenantId?: string): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.VIEW_PRODUCT_SALES,\r\n        { tenantId }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to view product sales',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking view permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can view product sale details\r\n   * @param sale - The product sale record to check\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag\r\n   */\r\n  canViewProductSaleDetails: async (\r\n    sale: ProductSale,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.VIEW_PRODUCT_SALE_DETAILS,\r\n        { tenantId, saleId: sale?.id }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to view this sale',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking view details permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can edit a product sale\r\n   * @param sale - The product sale record to edit\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @param fieldNames - Specific fields being edited (optional, for fine-grained permissions)\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canEditProductSale: async (\r\n    sale: ProductSale,\r\n    tenantId?: string,\r\n    fieldNames?: string[]\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      // Check general edit permission first\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.EDIT_PRODUCT_SALE,\r\n        { tenantId, saleId: sale?.id, fields: fieldNames }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to edit this sale',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      // If specific fields provided, check field-level permissions\r\n      if (fieldNames && fieldNames.length > 0) {\r\n        for (const field of fieldNames) {\r\n          // Certain fields might require special permissions\r\n          if (['status', 'approvalStatus'].includes(field)) {\r\n            const fieldResult = await factoryRbacService.validateRolePermissions(\r\n              ProductSalesRbacAction.CHANGE_STATUS,\r\n              { tenantId, saleId: sale?.id, field }\r\n            );\r\n            if (!fieldResult) {\r\n              return {\r\n                allowed: false,\r\n                reason: `You do not have permission to modify the ${field} field`,\r\n                denialCode: 'PERMISSION_DENIED',\r\n              };\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking edit permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can delete a product sale\r\n   * @param sale - The product sale record to delete\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canDeleteProductSale: async (\r\n    sale: ProductSale,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.DELETE_PRODUCT_SALE,\r\n        { tenantId, saleId: sale?.id }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to delete product sales',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking delete permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can change product sale status\r\n   * @param sale - The product sale record\r\n   * @param newStatus - The new status being set\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canChangeStatus: async (\r\n    sale: ProductSale,\r\n    newStatus: string,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.CHANGE_STATUS,\r\n        { tenantId, saleId: sale?.id, newStatus }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: `You do not have permission to change status to ${newStatus}`,\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking status change permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can approve a product sale\r\n   * @param sale - The product sale record to approve\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canApproveProductSale: async (\r\n    sale: ProductSale,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.APPROVE_PRODUCT_SALE,\r\n        { tenantId, saleId: sale?.id }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to approve product sales',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking approval permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can reject a product sale\r\n   * @param sale - The product sale record to reject\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canRejectProductSale: async (\r\n    sale: ProductSale,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.REJECT_PRODUCT_SALE,\r\n        { tenantId, saleId: sale?.id }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to reject product sales',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking reject permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can bulk delete product sales\r\n   * @param recordCount - Number of records being deleted\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canBulkDeleteProductSales: async (\r\n    recordCount: number,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.BULK_DELETE_PRODUCT_SALES,\r\n        { tenantId, recordCount }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to bulk delete product sales',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking bulk delete permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can bulk update status\r\n   * @param recordCount - Number of records being updated\r\n   * @param newStatus - The new status being set\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canBulkUpdateStatus: async (\r\n    recordCount: number,\r\n    newStatus: string,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.BULK_UPDATE_STATUS,\r\n        { tenantId, recordCount, newStatus }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to bulk update status',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking bulk update permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can export product sales\r\n   * @param recordCount - Number of records being exported\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canExportProductSales: async (\r\n    recordCount: number,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.EXPORT_PRODUCT_SALES,\r\n        { tenantId, recordCount }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to export product sales',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking export permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if user can view audit trail\r\n   * @param sale - The product sale record\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns PermissionResult with allowed flag and reason if denied\r\n   */\r\n  canViewAuditTrail: async (\r\n    sale: ProductSale,\r\n    tenantId?: string\r\n  ): Promise<PermissionResult> => {\r\n    try {\r\n      const result = await factoryRbacService.validateRolePermissions(\r\n        ProductSalesRbacAction.VIEW_AUDIT_TRAIL,\r\n        { tenantId, saleId: sale?.id }\r\n      );\r\n\r\n      if (!result) {\r\n        return {\r\n          allowed: false,\r\n          reason: 'You do not have permission to view audit trail',\r\n          denialCode: 'PERMISSION_DENIED',\r\n        };\r\n      }\r\n\r\n      return { allowed: true };\r\n    } catch (error) {\r\n      console.error('Error checking audit trail permission:', error);\r\n      return { allowed: true };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check multiple permissions at once\r\n   * Useful for determining which actions are available for a sale\r\n   * @param sale - The product sale record\r\n   * @param tenantId - Tenant ID for multi-tenant validation\r\n   * @returns Object with boolean flags for each permission\r\n   */\r\n  getAvailableActions: async (\r\n    sale: ProductSale,\r\n    tenantId?: string\r\n  ): Promise<{\r\n    canView: boolean;\r\n    canEdit: boolean;\r\n    canDelete: boolean;\r\n    canChangeStatus: boolean;\r\n    canApprove: boolean;\r\n    canReject: boolean;\r\n    canViewAudit: boolean;\r\n  }> => {\r\n    try {\r\n      const [\r\n        viewResult,\r\n        editResult,\r\n        deleteResult,\r\n        statusResult,\r\n        approveResult,\r\n        rejectResult,\r\n        auditResult,\r\n      ] = await Promise.all([\r\n        productSalesRbacService.canViewProductSaleDetails(sale, tenantId),\r\n        productSalesRbacService.canEditProductSale(sale, tenantId),\r\n        productSalesRbacService.canDeleteProductSale(sale, tenantId),\r\n        productSalesRbacService.canChangeStatus(sale, '', tenantId),\r\n        productSalesRbacService.canApproveProductSale(sale, tenantId),\r\n        productSalesRbacService.canRejectProductSale(sale, tenantId),\r\n        productSalesRbacService.canViewAuditTrail(sale, tenantId),\r\n      ]);\r\n\r\n      return {\r\n        canView: viewResult.allowed,\r\n        canEdit: editResult.allowed,\r\n        canDelete: deleteResult.allowed,\r\n        canChangeStatus: statusResult.allowed,\r\n        canApprove: approveResult.allowed,\r\n        canReject: rejectResult.allowed,\r\n        canViewAudit: auditResult.allowed,\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting available actions:', error);\r\n      // On error, allow all actions (graceful degradation)\r\n      return {\r\n        canView: true,\r\n        canEdit: true,\r\n        canDelete: true,\r\n        canChangeStatus: true,\r\n        canApprove: true,\r\n        canReject: true,\r\n        canViewAudit: true,\r\n      };\r\n    }\r\n  },\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\reportGenerationService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6897,6900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6897,6900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11883,11886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11883,11886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":394,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12379,12382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12379,12382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Report Generation Service for Product Sales\r\n * Generates comprehensive reports in various formats\r\n */\r\n\r\nimport { ProductSale, ProductSalesAnalytics } from '@/types/productSales';\r\n\r\nexport interface ReportConfig {\r\n  title: string;\r\n  subtitle?: string;\r\n  includeSummary: boolean;\r\n  includeCharts: boolean;\r\n  dateRange?: {\r\n    startDate: Date;\r\n    endDate: Date;\r\n  };\r\n  filters?: {\r\n    status?: string;\r\n    customerName?: string;\r\n    productName?: string;\r\n  };\r\n}\r\n\r\nexport interface ReportSchedule {\r\n  id: string;\r\n  name: string;\r\n  reportType: 'monthly_sales' | 'customer_sales' | 'product_sales' | 'revenue_report';\r\n  frequency: 'daily' | 'weekly' | 'monthly';\r\n  recipients: string[];\r\n  isActive: boolean;\r\n  createdAt: Date;\r\n}\r\n\r\nexport interface MonthlySalesReport {\r\n  month: string;\r\n  totalSales: number;\r\n  totalRevenue: number;\r\n  averageSaleValue: number;\r\n  topProducts: Array<{ name: string; count: number; revenue: number }>;\r\n  topCustomers: Array<{ name: string; count: number; revenue: number }>;\r\n  statusBreakdown: Array<{ status: string; count: number; percentage: number }>;\r\n}\r\n\r\nexport interface CustomerSalesReport {\r\n  customerName: string;\r\n  totalSales: number;\r\n  totalRevenue: number;\r\n  averageSaleValue: number;\r\n  products: Array<{ name: string; quantity: number; totalValue: number }>;\r\n  recentSales: Array<{ saleNumber: string; date: string; amount: number; status: string }>;\r\n}\r\n\r\nexport interface ProductSalesReport {\r\n  productName: string;\r\n  totalUnitsSold: number;\r\n  totalRevenue: number;\r\n  averageUnitPrice: number;\r\n  topCustomers: Array<{ name: string; quantity: number; totalValue: number }>;\r\n  sales: Array<{ saleNumber: string; customer: string; quantity: number; value: number; date: string }>;\r\n}\r\n\r\nexport interface RevenueReport {\r\n  period: string;\r\n  totalRevenue: number;\r\n  totalSales: number;\r\n  averageOrderValue: number;\r\n  revenueByStatus: Array<{ status: string; revenue: number; count: number }>;\r\n  revenueByProduct: Array<{ product: string; revenue: number; count: number }>;\r\n  revenueByCustomer: Array<{ customer: string; revenue: number; count: number }>;\r\n  revenueGrowth: number; // Percentage compared to previous period\r\n}\r\n\r\nclass ReportGenerationService {\r\n  /**\r\n   * Generate monthly sales report\r\n   */\r\n  generateMonthlySalesReport(\r\n    sales: ProductSale[],\r\n    analytics: ProductSalesAnalytics,\r\n    month: string\r\n  ): MonthlySalesReport {\r\n    const [monthNum, year] = month.split('-').map(Number);\r\n    const monthSales = sales.filter(s => {\r\n      const saleDate = new Date(s.sale_date);\r\n      return saleDate.getMonth() === monthNum - 1 && saleDate.getFullYear() === year;\r\n    });\r\n\r\n    return {\r\n      month,\r\n      totalSales: monthSales.length,\r\n      totalRevenue: monthSales.reduce((sum, s) => sum + (s.total_value || 0), 0),\r\n      averageSaleValue: monthSales.length > 0 \r\n        ? monthSales.reduce((sum, s) => sum + (s.total_value || 0), 0) / monthSales.length\r\n        : 0,\r\n      topProducts: analytics.top_products || [],\r\n      topCustomers: analytics.top_customers || [],\r\n      statusBreakdown: this.getStatusBreakdown(monthSales),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate customer sales report\r\n   */\r\n  generateCustomerSalesReport(\r\n    sales: ProductSale[],\r\n    customerName: string\r\n  ): CustomerSalesReport {\r\n    const customerSales = sales.filter(s => s.customer_name === customerName);\r\n    const totalRevenue = customerSales.reduce((sum, s) => sum + (s.total_value || 0), 0);\r\n\r\n    // Group by product\r\n    const productMap = new Map<string, { quantity: number; totalValue: number }>();\r\n    customerSales.forEach(sale => {\r\n      const existing = productMap.get(sale.product_name || 'Unknown') || { quantity: 0, totalValue: 0 };\r\n      existing.quantity += sale.quantity || 0;\r\n      existing.totalValue += sale.total_value || 0;\r\n      productMap.set(sale.product_name || 'Unknown', existing);\r\n    });\r\n\r\n    return {\r\n      customerName,\r\n      totalSales: customerSales.length,\r\n      totalRevenue,\r\n      averageSaleValue: customerSales.length > 0 ? totalRevenue / customerSales.length : 0,\r\n      products: Array.from(productMap.entries()).map(([name, data]) => ({\r\n        name,\r\n        quantity: data.quantity,\r\n        totalValue: data.totalValue,\r\n      })),\r\n      recentSales: customerSales.map(s => ({\r\n        saleNumber: s.sale_number || 'N/A',\r\n        date: new Date(s.sale_date).toLocaleDateString('en-US'),\r\n        amount: s.total_value || 0,\r\n        status: s.status || 'Unknown',\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate product sales report\r\n   */\r\n  generateProductSalesReport(\r\n    sales: ProductSale[],\r\n    productName: string\r\n  ): ProductSalesReport {\r\n    const productSales = sales.filter(s => s.product_name === productName);\r\n    const totalRevenue = productSales.reduce((sum, s) => sum + (s.total_value || 0), 0);\r\n    const totalUnits = productSales.reduce((sum, s) => sum + (s.quantity || 0), 0);\r\n\r\n    // Group by customer\r\n    const customerMap = new Map<string, { quantity: number; totalValue: number }>();\r\n    productSales.forEach(sale => {\r\n      const existing = customerMap.get(sale.customer_name || 'Unknown') || { quantity: 0, totalValue: 0 };\r\n      existing.quantity += sale.quantity || 0;\r\n      existing.totalValue += sale.total_value || 0;\r\n      customerMap.set(sale.customer_name || 'Unknown', existing);\r\n    });\r\n\r\n    return {\r\n      productName,\r\n      totalUnitsSold: totalUnits,\r\n      totalRevenue,\r\n      averageUnitPrice: totalUnits > 0 ? totalRevenue / totalUnits : 0,\r\n      topCustomers: Array.from(customerMap.entries())\r\n        .map(([name, data]) => ({\r\n          name,\r\n          quantity: data.quantity,\r\n          totalValue: data.totalValue,\r\n        }))\r\n        .sort((a, b) => b.totalValue - a.totalValue)\r\n        .slice(0, 5),\r\n      sales: productSales.map(s => ({\r\n        saleNumber: s.sale_number || 'N/A',\r\n        customer: s.customer_name || 'Unknown',\r\n        quantity: s.quantity || 0,\r\n        value: s.total_value || 0,\r\n        date: new Date(s.sale_date).toLocaleDateString('en-US'),\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate revenue report\r\n   */\r\n  generateRevenueReport(\r\n    sales: ProductSale[],\r\n    analytics: ProductSalesAnalytics,\r\n    period: string\r\n  ): RevenueReport {\r\n    const totalRevenue = sales.reduce((sum, s) => sum + (s.total_value || 0), 0);\r\n\r\n    return {\r\n      period,\r\n      totalRevenue,\r\n      totalSales: sales.length,\r\n      averageOrderValue: sales.length > 0 ? totalRevenue / sales.length : 0,\r\n      revenueByStatus: this.getRevenueByStatus(sales),\r\n      revenueByProduct: this.getRevenueByProduct(sales),\r\n      revenueByCustomer: this.getRevenueByCustomer(sales),\r\n      revenueGrowth: 0, // Would need previous period data\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Export report to HTML\r\n   */\r\n  exportToHTML(report: any, reportType: string, config: ReportConfig): string {\r\n    const currentDate = new Date().toLocaleDateString('en-US');\r\n    \r\n    let reportContent = '';\r\n\r\n    switch (reportType) {\r\n      case 'monthly_sales':\r\n        reportContent = this.renderMonthlySalesHTML(report as MonthlySalesReport, config);\r\n        break;\r\n      case 'customer_sales':\r\n        reportContent = this.renderCustomerSalesHTML(report as CustomerSalesReport, config);\r\n        break;\r\n      case 'product_sales':\r\n        reportContent = this.renderProductSalesHTML(report as ProductSalesReport, config);\r\n        break;\r\n      case 'revenue_report':\r\n        reportContent = this.renderRevenueReportHTML(report as RevenueReport, config);\r\n        break;\r\n      default:\r\n        reportContent = '<p>Unknown report type</p>';\r\n    }\r\n\r\n    return `\r\n      <!DOCTYPE html>\r\n      <html>\r\n      <head>\r\n        <meta charset=\"UTF-8\">\r\n        <title>${config.title}</title>\r\n        <style>\r\n          body {\r\n            font-family: Arial, sans-serif;\r\n            color: #333;\r\n            line-height: 1.6;\r\n            margin: 0;\r\n            padding: 20px;\r\n          }\r\n          .header {\r\n            text-align: center;\r\n            border-bottom: 2px solid #1890ff;\r\n            padding-bottom: 20px;\r\n            margin-bottom: 30px;\r\n          }\r\n          .header h1 {\r\n            color: #1890ff;\r\n            margin: 0;\r\n          }\r\n          .header p {\r\n            margin: 5px 0;\r\n            color: #666;\r\n          }\r\n          .section {\r\n            margin-bottom: 30px;\r\n          }\r\n          .section h2 {\r\n            color: #1890ff;\r\n            border-bottom: 1px solid #e0e0e0;\r\n            padding-bottom: 10px;\r\n          }\r\n          table {\r\n            width: 100%;\r\n            border-collapse: collapse;\r\n            margin-top: 15px;\r\n          }\r\n          th {\r\n            background-color: #f0f0f0;\r\n            border: 1px solid #ddd;\r\n            padding: 12px;\r\n            text-align: left;\r\n            font-weight: bold;\r\n          }\r\n          td {\r\n            border: 1px solid #ddd;\r\n            padding: 10px;\r\n          }\r\n          .summary-box {\r\n            background-color: #f9f9f9;\r\n            border-left: 4px solid #1890ff;\r\n            padding: 15px;\r\n            margin: 15px 0;\r\n          }\r\n          .summary-item {\r\n            display: inline-block;\r\n            margin-right: 30px;\r\n          }\r\n          .summary-label {\r\n            color: #666;\r\n            font-size: 12px;\r\n          }\r\n          .summary-value {\r\n            color: #1890ff;\r\n            font-size: 18px;\r\n            font-weight: bold;\r\n          }\r\n          .footer {\r\n            text-align: center;\r\n            color: #999;\r\n            font-size: 12px;\r\n            margin-top: 40px;\r\n            border-top: 1px solid #e0e0e0;\r\n            padding-top: 20px;\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <div class=\"header\">\r\n          <h1>${config.title}</h1>\r\n          ${config.subtitle ? `<p>${config.subtitle}</p>` : ''}\r\n          <p>Generated on ${currentDate}</p>\r\n        </div>\r\n        \r\n        ${reportContent}\r\n        \r\n        <div class=\"footer\">\r\n          <p>This report was automatically generated. Please verify data accuracy.</p>\r\n        </div>\r\n      </body>\r\n      </html>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Generate HTML for monthly sales report\r\n   */\r\n  private renderMonthlySalesHTML(report: MonthlySalesReport, config: ReportConfig): string {\r\n    return `\r\n      <div class=\"section\">\r\n        <h2>Sales Summary</h2>\r\n        <div class=\"summary-box\">\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Sales</div>\r\n            <div class=\"summary-value\">${report.totalSales}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Revenue</div>\r\n            <div class=\"summary-value\">$${report.totalRevenue.toFixed(2)}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Average Sale Value</div>\r\n            <div class=\"summary-value\">$${report.averageSaleValue.toFixed(2)}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Status Breakdown</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Status</th>\r\n            <th>Count</th>\r\n            <th>Percentage</th>\r\n          </tr>\r\n          ${report.statusBreakdown.map(item => `\r\n            <tr>\r\n              <td>${item.status}</td>\r\n              <td>${item.count}</td>\r\n              <td>${item.percentage.toFixed(1)}%</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Top Products</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Product</th>\r\n            <th>Units Sold</th>\r\n            <th>Revenue</th>\r\n          </tr>\r\n          ${report.topProducts.slice(0, 5).map((item: any) => `\r\n            <tr>\r\n              <td>${item.name}</td>\r\n              <td>${item.count}</td>\r\n              <td>$${item.revenue.toFixed(2)}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Top Customers</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Customer</th>\r\n            <th>Purchases</th>\r\n            <th>Total Spent</th>\r\n          </tr>\r\n          ${report.topCustomers.slice(0, 5).map((item: any) => `\r\n            <tr>\r\n              <td>${item.name}</td>\r\n              <td>${item.count}</td>\r\n              <td>$${item.revenue.toFixed(2)}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Generate HTML for customer sales report\r\n   */\r\n  private renderCustomerSalesHTML(report: CustomerSalesReport, config: ReportConfig): string {\r\n    return `\r\n      <div class=\"section\">\r\n        <h2>Customer Information</h2>\r\n        <div class=\"summary-box\">\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Customer Name</div>\r\n            <div class=\"summary-value\">${report.customerName}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Sales</div>\r\n            <div class=\"summary-value\">${report.totalSales}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Revenue</div>\r\n            <div class=\"summary-value\">$${report.totalRevenue.toFixed(2)}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Average Sale Value</div>\r\n            <div class=\"summary-value\">$${report.averageSaleValue.toFixed(2)}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Products Purchased</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Product</th>\r\n            <th>Quantity</th>\r\n            <th>Total Value</th>\r\n          </tr>\r\n          ${report.products.map(item => `\r\n            <tr>\r\n              <td>${item.name}</td>\r\n              <td>${item.quantity}</td>\r\n              <td>$${item.totalValue.toFixed(2)}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Recent Sales</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Sale Number</th>\r\n            <th>Date</th>\r\n            <th>Amount</th>\r\n            <th>Status</th>\r\n          </tr>\r\n          ${report.recentSales.map(item => `\r\n            <tr>\r\n              <td>${item.saleNumber}</td>\r\n              <td>${item.date}</td>\r\n              <td>$${item.amount.toFixed(2)}</td>\r\n              <td>${item.status}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Generate HTML for product sales report\r\n   */\r\n  private renderProductSalesHTML(report: ProductSalesReport, config: ReportConfig): string {\r\n    return `\r\n      <div class=\"section\">\r\n        <h2>Product Information</h2>\r\n        <div class=\"summary-box\">\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Product</div>\r\n            <div class=\"summary-value\">${report.productName}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Units Sold</div>\r\n            <div class=\"summary-value\">${report.totalUnitsSold}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Revenue</div>\r\n            <div class=\"summary-value\">$${report.totalRevenue.toFixed(2)}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Average Unit Price</div>\r\n            <div class=\"summary-value\">$${report.averageUnitPrice.toFixed(2)}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Top Customers</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Customer</th>\r\n            <th>Quantity</th>\r\n            <th>Total Value</th>\r\n          </tr>\r\n          ${report.topCustomers.map(item => `\r\n            <tr>\r\n              <td>${item.name}</td>\r\n              <td>${item.quantity}</td>\r\n              <td>$${item.totalValue.toFixed(2)}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Sales Details</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Sale Number</th>\r\n            <th>Customer</th>\r\n            <th>Quantity</th>\r\n            <th>Value</th>\r\n            <th>Date</th>\r\n          </tr>\r\n          ${report.sales.slice(0, 20).map(item => `\r\n            <tr>\r\n              <td>${item.saleNumber}</td>\r\n              <td>${item.customer}</td>\r\n              <td>${item.quantity}</td>\r\n              <td>$${item.value.toFixed(2)}</td>\r\n              <td>${item.date}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Generate HTML for revenue report\r\n   */\r\n  private renderRevenueReportHTML(report: RevenueReport, config: ReportConfig): string {\r\n    return `\r\n      <div class=\"section\">\r\n        <h2>Revenue Summary</h2>\r\n        <div class=\"summary-box\">\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Revenue</div>\r\n            <div class=\"summary-value\">$${report.totalRevenue.toFixed(2)}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Total Sales</div>\r\n            <div class=\"summary-value\">${report.totalSales}</div>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <div class=\"summary-label\">Average Order Value</div>\r\n            <div class=\"summary-value\">$${report.averageOrderValue.toFixed(2)}</div>\r\n          </div>\r\n          ${report.revenueGrowth !== 0 ? `\r\n            <div class=\"summary-item\">\r\n              <div class=\"summary-label\">Growth vs Previous Period</div>\r\n              <div class=\"summary-value\">${report.revenueGrowth > 0 ? '+' : ''}${report.revenueGrowth.toFixed(1)}%</div>\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Revenue by Status</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Status</th>\r\n            <th>Revenue</th>\r\n            <th>Count</th>\r\n          </tr>\r\n          ${report.revenueByStatus.map(item => `\r\n            <tr>\r\n              <td>${item.status}</td>\r\n              <td>$${item.revenue.toFixed(2)}</td>\r\n              <td>${item.count}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Revenue by Product (Top 10)</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Product</th>\r\n            <th>Revenue</th>\r\n            <th>Count</th>\r\n          </tr>\r\n          ${report.revenueByProduct.slice(0, 10).map(item => `\r\n            <tr>\r\n              <td>${item.product}</td>\r\n              <td>$${item.revenue.toFixed(2)}</td>\r\n              <td>${item.count}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h2>Revenue by Customer (Top 10)</h2>\r\n        <table>\r\n          <tr>\r\n            <th>Customer</th>\r\n            <th>Revenue</th>\r\n            <th>Count</th>\r\n          </tr>\r\n          ${report.revenueByCustomer.slice(0, 10).map(item => `\r\n            <tr>\r\n              <td>${item.customer}</td>\r\n              <td>$${item.revenue.toFixed(2)}</td>\r\n              <td>${item.count}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </table>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Helper: Get status breakdown\r\n   */\r\n  private getStatusBreakdown(sales: ProductSale[]): Array<{ status: string; count: number; percentage: number }> {\r\n    const statusMap = new Map<string, number>();\r\n    sales.forEach(s => {\r\n      const status = s.status || 'Unknown';\r\n      statusMap.set(status, (statusMap.get(status) || 0) + 1);\r\n    });\r\n\r\n    return Array.from(statusMap.entries()).map(([status, count]) => ({\r\n      status,\r\n      count,\r\n      percentage: sales.length > 0 ? (count / sales.length) * 100 : 0,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Helper: Get revenue by status\r\n   */\r\n  private getRevenueByStatus(sales: ProductSale[]): Array<{ status: string; revenue: number; count: number }> {\r\n    const statusMap = new Map<string, { revenue: number; count: number }>();\r\n    sales.forEach(s => {\r\n      const status = s.status || 'Unknown';\r\n      const existing = statusMap.get(status) || { revenue: 0, count: 0 };\r\n      existing.revenue += s.total_value || 0;\r\n      existing.count += 1;\r\n      statusMap.set(status, existing);\r\n    });\r\n\r\n    return Array.from(statusMap.entries()).map(([status, data]) => ({\r\n      status,\r\n      revenue: data.revenue,\r\n      count: data.count,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Helper: Get revenue by product\r\n   */\r\n  private getRevenueByProduct(sales: ProductSale[]): Array<{ product: string; revenue: number; count: number }> {\r\n    const productMap = new Map<string, { revenue: number; count: number }>();\r\n    sales.forEach(s => {\r\n      const product = s.product_name || 'Unknown';\r\n      const existing = productMap.get(product) || { revenue: 0, count: 0 };\r\n      existing.revenue += s.total_value || 0;\r\n      existing.count += 1;\r\n      productMap.set(product, existing);\r\n    });\r\n\r\n    return Array.from(productMap.entries())\r\n      .map(([product, data]) => ({\r\n        product,\r\n        revenue: data.revenue,\r\n        count: data.count,\r\n      }))\r\n      .sort((a, b) => b.revenue - a.revenue);\r\n  }\r\n\r\n  /**\r\n   * Helper: Get revenue by customer\r\n   */\r\n  private getRevenueByCustomer(sales: ProductSale[]): Array<{ customer: string; revenue: number; count: number }> {\r\n    const customerMap = new Map<string, { revenue: number; count: number }>();\r\n    sales.forEach(s => {\r\n      const customer = s.customer_name || 'Unknown';\r\n      const existing = customerMap.get(customer) || { revenue: 0, count: 0 };\r\n      existing.revenue += s.total_value || 0;\r\n      existing.count += 1;\r\n      customerMap.set(customer, existing);\r\n    });\r\n\r\n    return Array.from(customerMap.entries())\r\n      .map(([customer, data]) => ({\r\n        customer,\r\n        revenue: data.revenue,\r\n        count: data.count,\r\n      }))\r\n      .sort((a, b) => b.revenue - a.revenue);\r\n  }\r\n\r\n  /**\r\n   * Download report as PDF (requires html2pdf or similar)\r\n   */\r\n  downloadReportAsPDF(html: string, filename: string): void {\r\n    const blob = new Blob([html], { type: 'text/html;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', `${filename}.html`);\r\n    link.style.visibility = 'hidden';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  }\r\n}\r\n\r\nexport const reportGenerationService = new ReportGenerationService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\statusTransitionService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[615,618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[615,618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Status Transition Service\r\n * Handles status transitions with business logic and audit logging\r\n */\r\n\r\nimport { ProductSale } from '@/types/productSales';\r\nimport { \r\n  isValidTransition, \r\n  getValidNextStatuses,\r\n  ProductSaleStatus \r\n} from '../utils/statusTransitions';\r\nimport { auditService } from '@/services';\r\nimport { workflowNotificationService } from './workflowNotificationService';\r\n\r\ninterface StatusTransitionEvent {\r\n  saleId: string;\r\n  fromStatus: ProductSaleStatus;\r\n  toStatus: ProductSaleStatus;\r\n  reason?: string;\r\n  userId?: string;\r\n  timestamp: Date;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport const statusTransitionService = {\r\n  /**\r\n   * Validate and perform status transition\r\n   */\r\n  async transitionStatus(\r\n    sale: ProductSale,\r\n    newStatus: ProductSaleStatus,\r\n    reason?: string\r\n  ): Promise<{ success: boolean; message: string; sale?: ProductSale; event?: StatusTransitionEvent }> {\r\n    try {\r\n      // Validate transition\r\n      if (!isValidTransition(sale.status as ProductSaleStatus, newStatus)) {\r\n        return {\r\n          success: false,\r\n          message: `Cannot transition from ${sale.status} to ${newStatus}`,\r\n        };\r\n      }\r\n\r\n      // Create transition event\r\n      const event: StatusTransitionEvent = {\r\n        saleId: sale.id,\r\n        fromStatus: sale.status as ProductSaleStatus,\r\n        toStatus: newStatus,\r\n        reason,\r\n        timestamp: new Date(),\r\n      };\r\n\r\n      // Log the transition\r\n      await auditService.logAction({\r\n        action: 'status_transition',\r\n        resource: 'product_sale',\r\n        resource_id: sale.id,\r\n        details: {\r\n          from_status: event.fromStatus,\r\n          to_status: event.toStatus,\r\n          reason: event.reason,\r\n        },\r\n      });\r\n\r\n      // Perform status-specific side effects\r\n      await performStatusSpecificActions(sale, newStatus, event);\r\n\r\n      return {\r\n        success: true,\r\n        message: `Sale transitioned from ${sale.status} to ${newStatus}`,\r\n        event,\r\n      };\r\n    } catch (error) {\r\n      console.error('Error transitioning status:', error);\r\n      return {\r\n        success: false,\r\n        message: 'Failed to transition status',\r\n      };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get valid next statuses\r\n   */\r\n  getValidNextStatuses(currentStatus: ProductSaleStatus): ProductSaleStatus[] {\r\n    return getValidNextStatuses(currentStatus);\r\n  },\r\n\r\n  /**\r\n   * Check if transition is valid\r\n   */\r\n  canTransition(fromStatus: ProductSaleStatus, toStatus: ProductSaleStatus): boolean {\r\n    return isValidTransition(fromStatus, toStatus);\r\n  },\r\n};\r\n\r\n/**\r\n * Perform status-specific side effects\r\n */\r\nasync function performStatusSpecificActions(\r\n  sale: ProductSale,\r\n  newStatus: ProductSaleStatus,\r\n  event: StatusTransitionEvent\r\n): Promise<void> {\r\n  switch (newStatus) {\r\n    case 'confirmed':\r\n      // Check inventory and reserve stock\r\n      await handleConfirmedStatus(sale, event);\r\n      break;\r\n\r\n    case 'shipped':\r\n      // Create shipment record\r\n      await handleShippedStatus(sale, event);\r\n      break;\r\n\r\n    case 'delivered':\r\n      // Update inventory, activate warranty\r\n      await handleDeliveredStatus(sale, event);\r\n      break;\r\n\r\n    case 'invoiced':\r\n      // Generate invoice\r\n      await handleInvoicedStatus(sale, event);\r\n      break;\r\n\r\n    case 'paid':\r\n      // Activate service contract if exists\r\n      await handlePaidStatus(sale, event);\r\n      break;\r\n\r\n    case 'cancelled':\r\n      // Release reserved inventory\r\n      await handleCancelledStatus(sale, event);\r\n      break;\r\n\r\n    case 'refunded':\r\n      // Reverse transactions\r\n      await handleRefundedStatus(sale, event);\r\n      break;\r\n\r\n    default:\r\n      // No specific actions for other statuses\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle 'confirmed' status transition\r\n * - Verify inventory availability\r\n * - Reserve stock\r\n * - Notify stakeholders\r\n */\r\nasync function handleConfirmedStatus(sale: ProductSale, event: StatusTransitionEvent): Promise<void> {\r\n  try {\r\n    // TODO: Implement inventory check and reservation\r\n    // const inventoryService = getInventoryService();\r\n    // await inventoryService.reserveStock(sale.product_id, sale.quantity);\r\n    console.log('Stock reserved for sale:', sale.id);\r\n\r\n    // Send confirmation notification\r\n    await workflowNotificationService.notifyStatusChange({\r\n      saleNumber: sale.sale_number,\r\n      customerId: sale.customer_id,\r\n      customerName: sale.customer_name || 'Valued Customer',\r\n      productName: sale.product_name || 'Product',\r\n      totalValue: sale.total_value,\r\n      oldStatus: event.fromStatus,\r\n      newStatus: event.toStatus,\r\n      reason: event.reason,\r\n      recipientRole: 'all',\r\n    });\r\n  } catch (error) {\r\n    console.error('Error reserving stock:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle 'shipped' status transition\r\n * - Create shipment record\r\n * - Send notification\r\n */\r\nasync function handleShippedStatus(sale: ProductSale, event: StatusTransitionEvent): Promise<void> {\r\n  try {\r\n    // TODO: Implement shipment creation\r\n    // const shipmentService = getShipmentService();\r\n    // const shipment = await shipmentService.create({\r\n    //   product_sale_id: sale.id,\r\n    //   customer_id: sale.customer_id,\r\n    //   status: 'shipped',\r\n    // });\r\n    console.log('Shipment created for sale:', sale.id);\r\n\r\n    // Send shipment notification\r\n    await workflowNotificationService.notifyShipmentReady({\r\n      saleNumber: sale.sale_number,\r\n      customerId: sale.customer_id,\r\n      customerName: sale.customer_name || 'Valued Customer',\r\n      productName: sale.product_name || 'Product',\r\n      totalValue: sale.total_value,\r\n      quantity: sale.quantity,\r\n    });\r\n  } catch (error) {\r\n    console.error('Error handling shipped status:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle 'delivered' status transition\r\n * - Update inventory (reduce by quantity)\r\n * - Activate warranty period\r\n * - Trigger delivery notifications\r\n */\r\nasync function handleDeliveredStatus(sale: ProductSale, event: StatusTransitionEvent): Promise<void> {\r\n  try {\r\n    // TODO: Implement delivery completion\r\n    // const inventoryService = getInventoryService();\r\n    // await inventoryService.reduceStock(sale.product_id, sale.quantity);\r\n    \r\n    // TODO: Activate warranty\r\n    // const warrantyService = getWarrantyService();\r\n    // await warrantyService.activateWarranty({\r\n    //   product_sale_id: sale.id,\r\n    //   warranty_period: sale.warranty_period,\r\n    //   start_date: new Date(),\r\n    // });\r\n\r\n    console.log('Delivery completed for sale:', sale.id);\r\n\r\n    // Send delivery confirmation notification\r\n    await workflowNotificationService.notifyDeliveryConfirmed({\r\n      saleNumber: sale.sale_number,\r\n      customerId: sale.customer_id,\r\n      customerName: sale.customer_name || 'Valued Customer',\r\n      productName: sale.product_name || 'Product',\r\n      totalValue: sale.total_value,\r\n    });\r\n  } catch (error) {\r\n    console.error('Error handling delivered status:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle 'invoiced' status transition\r\n * - Generate invoice document\r\n * - Send invoice to customer\r\n * - Record in accounting system\r\n */\r\nasync function handleInvoicedStatus(sale: ProductSale, event: StatusTransitionEvent): Promise<void> {\r\n  try {\r\n    // TODO: Implement invoice generation\r\n    // const invoiceService = getInvoiceService();\r\n    // const invoice = await invoiceService.generate({\r\n    //   product_sale_id: sale.id,\r\n    //   customer_id: sale.customer_id,\r\n    //   amount: sale.total_value,\r\n    //   items: sale.items,\r\n    // });\r\n\r\n    console.log('Invoice generated for sale:', sale.id);\r\n\r\n    // Send invoice notification\r\n    await workflowNotificationService.notifyInvoiceGenerated({\r\n      saleNumber: sale.sale_number,\r\n      customerId: sale.customer_id,\r\n      customerName: sale.customer_name || 'Valued Customer',\r\n      productName: sale.product_name || 'Product',\r\n      totalValue: sale.total_value,\r\n    });\r\n  } catch (error) {\r\n    console.error('Error handling invoiced status:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle 'paid' status transition\r\n * - Activate service contract if exists\r\n * - Record payment\r\n * - Update accounting records\r\n */\r\nasync function handlePaidStatus(sale: ProductSale, event: StatusTransitionEvent): Promise<void> {\r\n  try {\r\n    // Activate service contract if it exists\r\n    if (sale.service_contract_id) {\r\n      // TODO: Implement contract activation\r\n      // const contractService = getContractService();\r\n      // await contractService.activateContract(sale.service_contract_id);\r\n      console.log('Service contract activated for sale:', sale.id);\r\n    }\r\n\r\n    // TODO: Record payment in accounting system\r\n    console.log('Payment recorded for sale:', sale.id);\r\n\r\n    // Send payment received notification\r\n    await workflowNotificationService.notifyPaymentReceived({\r\n      saleNumber: sale.sale_number,\r\n      customerId: sale.customer_id,\r\n      customerName: sale.customer_name || 'Valued Customer',\r\n      productName: sale.product_name || 'Product',\r\n      totalValue: sale.total_value,\r\n      paymentMethod: sale.payment_method || 'Bank Transfer',\r\n    });\r\n  } catch (error) {\r\n    console.error('Error handling paid status:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle 'cancelled' status transition\r\n * - Release reserved inventory\r\n * - Cancel related records (invoices, etc.)\r\n * - Send cancellation notification\r\n */\r\nasync function handleCancelledStatus(sale: ProductSale, event: StatusTransitionEvent): Promise<void> {\r\n  try {\r\n    // TODO: Release reserved inventory\r\n    // const inventoryService = getInventoryService();\r\n    // await inventoryService.releaseReservedStock(sale.product_id, sale.quantity);\r\n\r\n    console.log('Sale cancelled, inventory released for sale:', sale.id);\r\n\r\n    // Send cancellation notification\r\n    await workflowNotificationService.notifySaleCancelled({\r\n      saleNumber: sale.sale_number,\r\n      customerId: sale.customer_id,\r\n      customerName: sale.customer_name || 'Valued Customer',\r\n      productName: sale.product_name || 'Product',\r\n      totalValue: sale.total_value,\r\n      reason: event.reason || 'Not specified',\r\n    });\r\n  } catch (error) {\r\n    console.error('Error handling cancelled status:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle 'refunded' status transition\r\n * - Reverse inventory operations\r\n * - Process refund\r\n * - Cancel related contracts\r\n * - Send refund notification\r\n */\r\nasync function handleRefundedStatus(sale: ProductSale, event: StatusTransitionEvent): Promise<void> {\r\n  try {\r\n    // TODO: Implement refund processing\r\n    // const refundService = getRefundService();\r\n    // await refundService.process({\r\n    //   product_sale_id: sale.id,\r\n    //   amount: sale.total_value,\r\n    //   reason: event.reason,\r\n    // });\r\n\r\n    // TODO: Cancel service contract if exists\r\n    if (sale.service_contract_id) {\r\n      // const contractService = getContractService();\r\n      // await contractService.cancelContract(sale.service_contract_id);\r\n    }\r\n\r\n    console.log('Refund processed for sale:', sale.id);\r\n\r\n    // Send refund notification\r\n    await workflowNotificationService.notifyRefundProcessed({\r\n      saleNumber: sale.sale_number,\r\n      customerId: sale.customer_id,\r\n      customerName: sale.customer_name || 'Valued Customer',\r\n      productName: sale.product_name || 'Product',\r\n      totalValue: sale.total_value,\r\n      reason: event.reason || 'Not specified',\r\n    });\r\n  } catch (error) {\r\n    console.error('Error handling refunded status:', error);\r\n  }\r\n}\r\n\r\nexport default statusTransitionService;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\services\\workflowNotificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\store\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\store\\productSalesStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6582,6585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6582,6585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6599,6602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6599,6602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6619,6622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6619,6622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6639,6642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6639,6642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6664,6667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6664,6667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6686,6689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6686,6689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6706,6709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6706,6709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6725,6728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6725,6728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6746,6749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6746,6749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":283,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6764,6767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6764,6767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":284,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6784,6787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6784,6787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":285,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6804,6807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6804,6807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":286,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6827,6830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6827,6830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":287,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6849,6852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6849,6852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":288,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6873,6876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6873,6876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6894,6897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6894,6897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":290,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6917,6920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6917,6920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6945,6948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6945,6948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6974,6977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6974,6977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6998,7001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6998,7001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7022,7025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7022,7025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":295,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7043,7046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7043,7046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7063,7066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7063,7066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7081,7084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7081,7084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7099,7102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7099,7102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7119,7122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7119,7122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7139,7142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7139,7142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":301,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7164,7167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7164,7167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7189,7192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7189,7192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7204,7207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7204,7207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":30,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales Store\r\n * Zustand store for product sales state management\r\n * Handles product sales data, filtering, pagination, and analytics\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport { devtools, subscribeWithSelector } from 'zustand/middleware';\r\nimport { immer } from 'zustand/middleware/immer';\r\nimport { ProductSale, ProductSalesFilters, ProductSalesAnalytics } from '@/types/productSales';\r\n\r\n/**\r\n * Product Sales Analytics State\r\n * Tracks analytics data for dashboard and reporting\r\n */\r\nexport interface ProductSalesAnalyticsState {\r\n  totalSales: number;\r\n  totalRevenue: number;\r\n  averageDealSize: number;\r\n  topProducts: Array<{ id: string; name: string; count: number; revenue: number }>;\r\n  topCustomers: Array<{ id: string; name: string; count: number; revenue: number }>;\r\n  statusDistribution: Record<string, number>;\r\n  monthlyTrend: Array<{ month: string; sales: number; revenue: number }>;\r\n}\r\n\r\n/**\r\n * Product Sales Pagination State\r\n * Tracks pagination information\r\n */\r\nexport interface ProductSalesPaginationState {\r\n  currentPage: number;\r\n  pageSize: number;\r\n  totalCount: number;\r\n  totalPages: number;\r\n}\r\n\r\n/**\r\n * Product Sales Store State and Actions\r\n * Complete state interface for product sales management\r\n */\r\nexport interface ProductSalesStore {\r\n  // ========== Data State ==========\r\n  /** Array of product sales */\r\n  sales: ProductSale[];\r\n  /** Currently selected product sale */\r\n  selectedSale: ProductSale | null;\r\n  /** Analytics data */\r\n  analytics: ProductSalesAnalyticsState | null;\r\n\r\n  // ========== Loading/Error States ==========\r\n  /** Main loading state */\r\n  isLoading: boolean;\r\n  /** Creating new sale state */\r\n  isSaving: boolean;\r\n  /** Deleting sale state */\r\n  isDeleting: boolean;\r\n  /** Error message if any */\r\n  error: string | null;\r\n\r\n  // ========== Filters and Search ==========\r\n  /** Active filters */\r\n  filters: ProductSalesFilters;\r\n  /** Search text */\r\n  searchText: string;\r\n\r\n  // ========== Pagination ==========\r\n  /** Pagination state */\r\n  pagination: ProductSalesPaginationState;\r\n\r\n  // ========== Selection ==========\r\n  /** Selected sale IDs for bulk operations */\r\n  selectedSaleIds: string[];\r\n\r\n  // ========== View State ==========\r\n  /** Current view mode */\r\n  viewMode: 'table' | 'cards' | 'kanban';\r\n  /** Sort column */\r\n  sortBy: string;\r\n  /** Sort order */\r\n  sortOrder: 'asc' | 'desc';\r\n\r\n  // ========== Modal States ==========\r\n  /** Form modal visibility */\r\n  showFormModal: boolean;\r\n  /** Detail modal visibility */\r\n  showDetailModal: boolean;\r\n\r\n  // ========== Data Actions ==========\r\n  /**\r\n   * Set all product sales\r\n   * @param sales Array of product sales\r\n   */\r\n  setSales: (sales: ProductSale[]) => void;\r\n\r\n  /**\r\n   * Add a new product sale to the list\r\n   * @param sale Product sale to add\r\n   */\r\n  addSale: (sale: ProductSale) => void;\r\n\r\n  /**\r\n   * Update an existing product sale\r\n   * @param id Sale ID\r\n   * @param updates Partial updates\r\n   */\r\n  updateSale: (id: string, updates: Partial<ProductSale>) => void;\r\n\r\n  /**\r\n   * Delete a product sale from the list\r\n   * @param id Sale ID\r\n   */\r\n  deleteSale: (id: string) => void;\r\n\r\n  /**\r\n   * Set the currently selected sale\r\n   * @param sale Product sale or null\r\n   */\r\n  setSelectedSale: (sale: ProductSale | null) => void;\r\n\r\n  /**\r\n   * Set analytics data\r\n   * @param analytics Analytics state\r\n   */\r\n  setAnalytics: (analytics: ProductSalesAnalyticsState | null) => void;\r\n\r\n  // ========== Loading/Error Actions ==========\r\n  /**\r\n   * Set main loading state\r\n   * @param loading Boolean\r\n   */\r\n  setLoading: (loading: boolean) => void;\r\n\r\n  /**\r\n   * Set saving state\r\n   * @param saving Boolean\r\n   */\r\n  setSaving: (saving: boolean) => void;\r\n\r\n  /**\r\n   * Set deleting state\r\n   * @param deleting Boolean\r\n   */\r\n  setDeleting: (deleting: boolean) => void;\r\n\r\n  /**\r\n   * Set error message\r\n   * @param error Error message or null\r\n   */\r\n  setError: (error: string | null) => void;\r\n\r\n  /**\r\n   * Clear error message\r\n   */\r\n  clearError: () => void;\r\n\r\n  // ========== Filter Actions ==========\r\n  /**\r\n   * Update filters\r\n   * @param filters Partial filter updates\r\n   */\r\n  setFilters: (filters: Partial<ProductSalesFilters>) => void;\r\n\r\n  /**\r\n   * Set search text\r\n   * @param text Search text\r\n   */\r\n  setSearchText: (text: string) => void;\r\n\r\n  /**\r\n   * Reset all filters to default\r\n   */\r\n  resetFilters: () => void;\r\n\r\n  // ========== Pagination Actions ==========\r\n  /**\r\n   * Set current page\r\n   * @param page Page number\r\n   */\r\n  setCurrentPage: (page: number) => void;\r\n\r\n  /**\r\n   * Set page size\r\n   * @param size Items per page\r\n   */\r\n  setPageSize: (size: number) => void;\r\n\r\n  /**\r\n   * Update full pagination state\r\n   * @param pagination Partial pagination updates\r\n   */\r\n  setPagination: (pagination: Partial<ProductSalesPaginationState>) => void;\r\n\r\n  // ========== Selection Actions ==========\r\n  /**\r\n   * Set selected sale IDs\r\n   * @param ids Array of IDs\r\n   */\r\n  setSelectedSaleIds: (ids: string[]) => void;\r\n\r\n  /**\r\n   * Toggle selection of a specific sale\r\n   * @param id Sale ID\r\n   */\r\n  toggleSaleSelection: (id: string) => void;\r\n\r\n  /**\r\n   * Select all sales\r\n   */\r\n  selectAllSales: () => void;\r\n\r\n  /**\r\n   * Clear all selections\r\n   */\r\n  clearSelection: () => void;\r\n\r\n  // ========== View Actions ==========\r\n  /**\r\n   * Set view mode\r\n   * @param mode View mode\r\n   */\r\n  setViewMode: (mode: 'table' | 'cards' | 'kanban') => void;\r\n\r\n  /**\r\n   * Set sorting\r\n   * @param sortBy Column to sort by\r\n   * @param sortOrder Sort order\r\n   */\r\n  setSorting: (sortBy: string, sortOrder: 'asc' | 'desc') => void;\r\n\r\n  // ========== Modal Actions ==========\r\n  /**\r\n   * Show form modal\r\n   */\r\n  showForm: () => void;\r\n\r\n  /**\r\n   * Hide form modal\r\n   */\r\n  hideForm: () => void;\r\n\r\n  /**\r\n   * Show detail modal\r\n   */\r\n  showDetail: () => void;\r\n\r\n  /**\r\n   * Hide detail modal\r\n   */\r\n  hideDetail: () => void;\r\n\r\n  // ========== Bulk Actions ==========\r\n  /**\r\n   * Bulk update multiple sales\r\n   * @param ids Array of sale IDs\r\n   * @param updates Partial updates\r\n   */\r\n  bulkUpdateSales: (ids: string[], updates: Partial<ProductSale>) => void;\r\n\r\n  /**\r\n   * Bulk delete multiple sales\r\n   * @param ids Array of sale IDs\r\n   */\r\n  bulkDeleteSales: (ids: string[]) => void;\r\n\r\n  // ========== Utility Actions ==========\r\n  /**\r\n   * Reset entire store to initial state\r\n   */\r\n  reset: () => void;\r\n}\r\n\r\n// ========== Initial State ==========\r\nconst initialState: Omit<ProductSalesStore, keyof {\r\n  setSales: any;\r\n  addSale: any;\r\n  updateSale: any;\r\n  deleteSale: any;\r\n  setSelectedSale: any;\r\n  setAnalytics: any;\r\n  setLoading: any;\r\n  setSaving: any;\r\n  setDeleting: any;\r\n  setError: any;\r\n  clearError: any;\r\n  setFilters: any;\r\n  setSearchText: any;\r\n  resetFilters: any;\r\n  setCurrentPage: any;\r\n  setPageSize: any;\r\n  setPagination: any;\r\n  setSelectedSaleIds: any;\r\n  toggleSaleSelection: any;\r\n  selectAllSales: any;\r\n  clearSelection: any;\r\n  setViewMode: any;\r\n  setSorting: any;\r\n  showForm: any;\r\n  hideForm: any;\r\n  showDetail: any;\r\n  hideDetail: any;\r\n  bulkUpdateSales: any;\r\n  bulkDeleteSales: any;\r\n  reset: any;\r\n}> = {\r\n  // Data\r\n  sales: [],\r\n  selectedSale: null,\r\n  analytics: null,\r\n\r\n  // Loading/Error\r\n  isLoading: false,\r\n  isSaving: false,\r\n  isDeleting: false,\r\n  error: null,\r\n\r\n  // Filters\r\n  filters: {},\r\n  searchText: '',\r\n\r\n  // Pagination\r\n  pagination: {\r\n    currentPage: 1,\r\n    pageSize: 20,\r\n    totalCount: 0,\r\n    totalPages: 0,\r\n  },\r\n\r\n  // Selection\r\n  selectedSaleIds: [],\r\n\r\n  // View\r\n  viewMode: 'table',\r\n  sortBy: 'created_at',\r\n  sortOrder: 'desc',\r\n\r\n  // Modals\r\n  showFormModal: false,\r\n  showDetailModal: false,\r\n};\r\n\r\n/**\r\n * Create Product Sales Store\r\n * Zustand store with devtools, subscribeWithSelector, and immer middleware\r\n */\r\nexport const useProductSalesStore = create<ProductSalesStore>()(\r\n  devtools(\r\n    subscribeWithSelector(\r\n      immer((set, get) => ({\r\n        ...initialState,\r\n\r\n        // ========== Data Actions ==========\r\n        setSales: (sales) => {\r\n          set((state) => {\r\n            // Filter and validate sales data\r\n            state.sales = (Array.isArray(sales) ? sales : [])\r\n              .filter((sale) => sale && typeof sale === 'object' && sale.id)\r\n              .map((sale) => ({\r\n                ...sale,\r\n                // Ensure all required fields have defaults\r\n                id: sale.id,\r\n                customer_id: sale.customer_id || '',\r\n                customer_name: sale.customer_name || '',\r\n                product_id: sale.product_id || '',\r\n                product_name: sale.product_name || '',\r\n                units: Number(sale.units) || 0,\r\n                cost_per_unit: Number(sale.cost_per_unit) || 0,\r\n                total_cost: Number(sale.total_cost) || 0,\r\n                delivery_date: sale.delivery_date || '',\r\n                warranty_expiry: sale.warranty_expiry || '',\r\n                status: sale.status || 'new',\r\n                notes: sale.notes || '',\r\n                attachments: Array.isArray(sale.attachments) ? sale.attachments : [],\r\n                service_contract_id: sale.service_contract_id || undefined,\r\n                tenant_id: sale.tenant_id || '',\r\n                created_at: sale.created_at || new Date().toISOString(),\r\n                updated_at: sale.updated_at || new Date().toISOString(),\r\n                created_by: sale.created_by || '',\r\n              }));\r\n          });\r\n        },\r\n\r\n        addSale: (sale) => {\r\n          set((state) => {\r\n            state.sales.unshift(sale);\r\n            state.pagination.totalCount += 1;\r\n          });\r\n        },\r\n\r\n        updateSale: (id, updates) => {\r\n          set((state) => {\r\n            const index = state.sales.findIndex((s) => s.id === id);\r\n            if (index !== -1) {\r\n              Object.assign(state.sales[index], updates);\r\n            }\r\n            if (state.selectedSale?.id === id) {\r\n              Object.assign(state.selectedSale, updates);\r\n            }\r\n          });\r\n        },\r\n\r\n        deleteSale: (id) => {\r\n          set((state) => {\r\n            state.sales = state.sales.filter((s) => s.id !== id);\r\n            state.pagination.totalCount -= 1;\r\n            if (state.selectedSale?.id === id) {\r\n              state.selectedSale = null;\r\n            }\r\n          });\r\n        },\r\n\r\n        setSelectedSale: (sale) => {\r\n          set((state) => {\r\n            state.selectedSale = sale;\r\n          });\r\n        },\r\n\r\n        setAnalytics: (analytics) => {\r\n          set((state) => {\r\n            state.analytics = analytics;\r\n          });\r\n        },\r\n\r\n        // ========== Loading/Error Actions ==========\r\n        setLoading: (loading) => {\r\n          set((state) => {\r\n            state.isLoading = loading;\r\n          });\r\n        },\r\n\r\n        setSaving: (saving) => {\r\n          set((state) => {\r\n            state.isSaving = saving;\r\n          });\r\n        },\r\n\r\n        setDeleting: (deleting) => {\r\n          set((state) => {\r\n            state.isDeleting = deleting;\r\n          });\r\n        },\r\n\r\n        setError: (error) => {\r\n          set((state) => {\r\n            state.error = error;\r\n          });\r\n        },\r\n\r\n        clearError: () => {\r\n          set((state) => {\r\n            state.error = null;\r\n          });\r\n        },\r\n\r\n        // ========== Filter Actions ==========\r\n        setFilters: (filters) => {\r\n          set((state) => {\r\n            state.filters = { ...state.filters, ...filters };\r\n            state.pagination.currentPage = 1; // Reset to first page on filter change\r\n          });\r\n        },\r\n\r\n        setSearchText: (text) => {\r\n          set((state) => {\r\n            state.searchText = text;\r\n            state.pagination.currentPage = 1; // Reset to first page on search\r\n          });\r\n        },\r\n\r\n        resetFilters: () => {\r\n          set((state) => {\r\n            state.filters = {};\r\n            state.searchText = '';\r\n            state.pagination.currentPage = 1;\r\n          });\r\n        },\r\n\r\n        // ========== Pagination Actions ==========\r\n        setCurrentPage: (page) => {\r\n          set((state) => {\r\n            state.pagination.currentPage = Math.max(1, page);\r\n          });\r\n        },\r\n\r\n        setPageSize: (size) => {\r\n          set((state) => {\r\n            state.pagination.pageSize = Math.max(1, size);\r\n            state.pagination.currentPage = 1; // Reset to first page on size change\r\n          });\r\n        },\r\n\r\n        setPagination: (pagination) => {\r\n          set((state) => {\r\n            state.pagination = { ...state.pagination, ...pagination };\r\n          });\r\n        },\r\n\r\n        // ========== Selection Actions ==========\r\n        setSelectedSaleIds: (ids) => {\r\n          set((state) => {\r\n            state.selectedSaleIds = ids;\r\n          });\r\n        },\r\n\r\n        toggleSaleSelection: (id) => {\r\n          set((state) => {\r\n            const index = state.selectedSaleIds.indexOf(id);\r\n            if (index > -1) {\r\n              state.selectedSaleIds.splice(index, 1);\r\n            } else {\r\n              state.selectedSaleIds.push(id);\r\n            }\r\n          });\r\n        },\r\n\r\n        selectAllSales: () => {\r\n          set((state) => {\r\n            state.selectedSaleIds = state.sales.map((s) => s.id);\r\n          });\r\n        },\r\n\r\n        clearSelection: () => {\r\n          set((state) => {\r\n            state.selectedSaleIds = [];\r\n          });\r\n        },\r\n\r\n        // ========== View Actions ==========\r\n        setViewMode: (mode) => {\r\n          set((state) => {\r\n            state.viewMode = mode;\r\n          });\r\n        },\r\n\r\n        setSorting: (sortBy, sortOrder) => {\r\n          set((state) => {\r\n            state.sortBy = sortBy;\r\n            state.sortOrder = sortOrder;\r\n          });\r\n        },\r\n\r\n        // ========== Modal Actions ==========\r\n        showForm: () => {\r\n          set((state) => {\r\n            state.showFormModal = true;\r\n          });\r\n        },\r\n\r\n        hideForm: () => {\r\n          set((state) => {\r\n            state.showFormModal = false;\r\n          });\r\n        },\r\n\r\n        showDetail: () => {\r\n          set((state) => {\r\n            state.showDetailModal = true;\r\n          });\r\n        },\r\n\r\n        hideDetail: () => {\r\n          set((state) => {\r\n            state.showDetailModal = false;\r\n          });\r\n        },\r\n\r\n        // ========== Bulk Actions ==========\r\n        bulkUpdateSales: (ids, updates) => {\r\n          set((state) => {\r\n            state.sales = state.sales.map((sale) =>\r\n              ids.includes(sale.id) ? { ...sale, ...updates } : sale\r\n            );\r\n          });\r\n        },\r\n\r\n        bulkDeleteSales: (ids) => {\r\n          set((state) => {\r\n            state.sales = state.sales.filter((sale) => !ids.includes(sale.id));\r\n            state.pagination.totalCount = state.sales.length;\r\n            if (state.selectedSale && ids.includes(state.selectedSale.id)) {\r\n              state.selectedSale = null;\r\n            }\r\n          });\r\n        },\r\n\r\n        // ========== Utility Actions ==========\r\n        reset: () => {\r\n          set(() => initialState);\r\n        },\r\n      }))\r\n    )\r\n  ),\r\n  {\r\n    name: 'ProductSalesStore', // DevTools name\r\n    version: 1,\r\n  }\r\n);\r\n\r\nexport default useProductSalesStore;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\utils\\statusTransitions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\product-sales\\views\\ProductSalesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2072,2075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2072,2075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'handleDeleteSale'. Either include it or remove the dependency array.","line":496,"column":6,"nodeType":"ArrayExpression","endLine":496,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [handleDeleteSale, hasPermission]","fix":{"range":[15267,15282],"text":"[handleDeleteSale, hasPermission]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales Page - Enterprise Version\r\n * Redesigned with Ant Design and EnterpriseLayout\r\n */\r\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Button,\r\n  Space,\r\n  Input,\r\n  Select,\r\n  Tag,\r\n  Row,\r\n  Col,\r\n  Popconfirm,\r\n  Alert,\r\n  Empty,\r\n  message,\r\n  Tooltip\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport {\r\n  PlusOutlined,\r\n  SearchOutlined,\r\n  ReloadOutlined,\r\n  EyeOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  DownloadOutlined,\r\n  ShoppingCartOutlined,\r\n  DollarOutlined,\r\n  FileTextOutlined,\r\n  RiseOutlined,\r\n  FilterOutlined,\r\n  BarChartOutlined,\r\n  TableOutlined,\r\n  BellOutlined\r\n} from '@ant-design/icons';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { \r\n  ProductSale, \r\n  ProductSaleFilters, \r\n  PRODUCT_SALE_STATUSES,\r\n  ProductSalesAnalytics \r\n} from '@/types/productSales';\r\nimport { \r\n  ProductSaleFormPanel, \r\n  ProductSaleDetailPanel,\r\n  AdvancedFiltersModal,\r\n  AdvancedSearchModal,\r\n  AdvancedSearchInputs,\r\n  FilterPresetsModal,\r\n  FilterPreset,\r\n  DynamicColumnsModal,\r\n  ColumnConfig,\r\n  applyColumnConfig,\r\n  ExportModal,\r\n  BulkActionToolbar,\r\n  ProductSalesAnalyticsDashboard,\r\n  ReportsModal,\r\n  NotificationPreferencesModal\r\n} from '../components';\r\nimport { useGenerateContractFromSale, useDeleteProductSale } from '../hooks';\r\nimport { useBulkOperations } from '../hooks/useBulkOperations';\r\nimport { BulkStatusUpdateRequest, BulkDeleteRequest } from '../services/bulkOperationsService';\r\n\r\nconst { Search } = Input;\r\nconst { Option } = Select;\r\n\r\nexport const ProductSalesPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const navigate = useNavigate();\r\n\r\n  // ‚úÖ Get service from module service container (standardized pattern)\r\n  const productSaleService = useService<any>('productSaleService');\r\n\r\n  // Initialize custom hooks\r\n  const { generateContract } = useGenerateContractFromSale();\r\n  const { mutate: deleteProductSale } = useDeleteProductSale();\r\n  const { bulkUpdateStatus, bulkDelete, bulkExport } = useBulkOperations();\r\n\r\n  // State management\r\n  const [productSales, setProductSales] = useState<ProductSale[]>([]);\r\n  const [analytics, setAnalytics] = useState<ProductSalesAnalytics | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n\r\n  // Pagination and filtering\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(10);\r\n  const [totalItems, setTotalItems] = useState(0);\r\n  const [filters, setFilters] = useState<ProductSaleFilters>({});\r\n  const [searchText, setSearchText] = useState('');\r\n\r\n  // Bulk operations\r\n  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n  const selectedSales = productSales.filter(sale => selectedRowKeys.includes(sale.id));\r\n\r\n  // Modal states\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\r\n  const [showAdvancedSearch, setShowAdvancedSearch] = useState(false);\r\n  const [showFilterPresets, setShowFilterPresets] = useState(false);\r\n  const [showDynamicColumns, setShowDynamicColumns] = useState(false);\r\n  const [showExportModal, setShowExportModal] = useState(false);\r\n  const [showReportsModal, setShowReportsModal] = useState(false);\r\n  const [showNotificationPreferences, setShowNotificationPreferences] = useState(false);\r\n  const [selectedSale, setSelectedSale] = useState<ProductSale | null>(null);\r\n  \r\n  // Column configuration\r\n  const [columnConfig, setColumnConfig] = useState<ColumnConfig[]>([]);\r\n  \r\n  // View mode state\r\n  const [viewMode, setViewMode] = useState<'table' | 'analytics'>('table');\r\n\r\n  // Load data\r\n   \r\n  const loadProductSales = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await productSaleService.getProductSales(filters, currentPage, pageSize);\r\n      setProductSales(response.data);\r\n      setTotalItems(response.total);\r\n    } catch (err) {\r\n      message.error('Failed to load product sales');\r\n      console.error('Error loading product sales:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [filters, currentPage, pageSize, productSaleService]);\r\n\r\n   \r\n  const loadAnalytics = useCallback(async () => {\r\n    try {\r\n      const analyticsData = await productSaleService.getProductSalesAnalytics();\r\n      setAnalytics(analyticsData);\r\n    } catch (err) {\r\n      console.error('Error loading analytics:', err);\r\n    }\r\n  }, [productSaleService]);\r\n\r\n  useEffect(() => {\r\n    void loadProductSales();\r\n    void loadAnalytics();\r\n  }, [loadProductSales, loadAnalytics]);\r\n\r\n  // Load column configuration from localStorage\r\n  useEffect(() => {\r\n    try {\r\n      const saved = localStorage.getItem('product_sales_column_prefs');\r\n      if (saved) {\r\n        setColumnConfig(JSON.parse(saved));\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load column preferences:', error);\r\n    }\r\n  }, []);\r\n\r\n  const handleRefresh = async () => {\r\n    setRefreshing(true);\r\n    await Promise.all([loadProductSales(), loadAnalytics()]);\r\n    setRefreshing(false);\r\n    message.success('Data refreshed successfully');\r\n  };\r\n\r\n  const handleCreateSale = () => {\r\n    setSelectedSale(null);\r\n    setShowCreateModal(true);\r\n  };\r\n\r\n  const handleEditSale = (sale: ProductSale) => {\r\n    setSelectedSale(sale);\r\n    setShowEditModal(true);\r\n  };\r\n\r\n  const handleViewSale = (sale: ProductSale) => {\r\n    setSelectedSale(sale);\r\n    setShowDetailModal(true);\r\n  };\r\n\r\n  const handleDeleteSale = async (sale: ProductSale) => {\r\n    try {\r\n      await productSaleService.deleteProductSale(sale.id);\r\n      message.success('Product sale deleted successfully');\r\n      loadProductSales();\r\n      loadAnalytics();\r\n    } catch (err) {\r\n      message.error('Failed to delete product sale');\r\n      console.error('Error deleting product sale:', err);\r\n    }\r\n  };\r\n\r\n  const handleGenerateContract = () => {\r\n    if (selectedSale) {\r\n      generateContract(selectedSale);\r\n      setShowDetailModal(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteFromDetail = () => {\r\n    if (selectedSale) {\r\n      deleteProductSale(selectedSale.id, {\r\n        onSuccess: () => {\r\n          message.success('Product sale deleted successfully');\r\n          setShowDetailModal(false);\r\n          setSelectedSale(null);\r\n          loadProductSales();\r\n          loadAnalytics();\r\n        },\r\n        onError: () => {\r\n          message.error('Failed to delete product sale');\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleFormSuccess = () => {\r\n    setShowCreateModal(false);\r\n    setShowEditModal(false);\r\n    setShowDetailModal(false);\r\n    setSelectedSale(null);\r\n    loadProductSales();\r\n    loadAnalytics();\r\n    message.success('Operation completed successfully');\r\n  };\r\n\r\n  const handleSearch = (value: string) => {\r\n    setSearchText(value);\r\n    setFilters(prev => ({ ...prev, search: value }));\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const handleAdvancedSearch = (searchInputs: AdvancedSearchInputs) => {\r\n    const newFilters: ProductSaleFilters = { ...filters };\r\n    \r\n    // Apply full-text search across all fields\r\n    if (searchInputs.full_text) {\r\n      newFilters.search = searchInputs.full_text;\r\n    } else {\r\n      // Apply field-specific searches\r\n      if (searchInputs.sale_id) {\r\n        newFilters.sale_id = searchInputs.sale_id;\r\n      }\r\n      if (searchInputs.customer_name) {\r\n        newFilters.customer_name = searchInputs.customer_name;\r\n      }\r\n      if (searchInputs.product_name) {\r\n        newFilters.product_name = searchInputs.product_name;\r\n      }\r\n      if (searchInputs.notes) {\r\n        newFilters.notes = searchInputs.notes;\r\n      }\r\n    }\r\n\r\n    setFilters(newFilters);\r\n    setCurrentPage(1);\r\n    setShowAdvancedSearch(false);\r\n  };\r\n\r\n  const handleStatusFilter = (value: string) => {\r\n    setFilters(prev => ({ ...prev, status: value || undefined }));\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const handleCustomerFilter = (value: string) => {\r\n    setFilters(prev => ({ ...prev, customer_name: value || undefined }));\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    setFilters({});\r\n    setSearchText('');\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const handleBulkStatusUpdate = (request: BulkStatusUpdateRequest) => {\r\n    bulkUpdateStatus.mutate(request, {\r\n      onSuccess: () => {\r\n        setSelectedRowKeys([]);\r\n        loadProductSales();\r\n        loadAnalytics();\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleBulkDelete = (saleIds: string[], reason?: string) => {\r\n    const request: BulkDeleteRequest = { saleIds, reason };\r\n    bulkDelete.mutate(request, {\r\n      onSuccess: () => {\r\n        setSelectedRowKeys([]);\r\n        loadProductSales();\r\n        loadAnalytics();\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleBulkExport = (sales: ProductSale[], format: 'csv' | 'xlsx', columns: string[]) => {\r\n    bulkExport.mutate({ sales, format, columns });\r\n  };\r\n\r\n  const handleClearSelection = () => {\r\n    setSelectedRowKeys([]);\r\n  };\r\n\r\n  const handleApplyAdvancedFilters = (advancedFilters: ProductSaleFilters) => {\r\n    setFilters(advancedFilters);\r\n    setCurrentPage(1);\r\n    setShowAdvancedFilters(false);\r\n  };\r\n\r\n  const handleLoadPreset = (preset: FilterPreset) => {\r\n    // Convert preset filters back to ProductSaleFilters format\r\n    setFilters(preset.filters as ProductSaleFilters);\r\n    setCurrentPage(1);\r\n    setShowFilterPresets(false);\r\n    message.success(`Loaded preset: ${preset.name}`);\r\n  };\r\n\r\n  const handleColumnsChange = (newColumnConfig: ColumnConfig[]) => {\r\n    setColumnConfig(newColumnConfig);\r\n  };\r\n\r\n  const getStatusTag = (status: string) => {\r\n    const statusConfig = PRODUCT_SALE_STATUSES.find(s => s.value === status);\r\n    const colorMap: Record<string, string> = {\r\n      'draft': 'default',\r\n      'pending': 'processing',\r\n      'confirmed': 'success',\r\n      'delivered': 'success',\r\n      'cancelled': 'error',\r\n      'refunded': 'warning'\r\n    };\r\n    return (\r\n      <Tag color={colorMap[status] || 'default'}>\r\n        {statusConfig?.label || status}\r\n      </Tag>\r\n    );\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD'\r\n    }).format(amount);\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  // Table columns - base configuration\r\n   \r\n  const baseColumns = useMemo(() => {\r\n    const cols: ColumnsType<ProductSale> = [\r\n      {\r\n        title: 'Sale #',\r\n        dataIndex: 'sale_number',\r\n        key: 'sale_number',\r\n        width: 150,\r\n        render: (text: string, record: ProductSale) => (\r\n          <div>\r\n            <div style={{ fontWeight: 500 }}>{text}</div>\r\n            <div style={{ fontSize: '12px', color: '#8c8c8c' }}>ID: {record.id}</div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Customer',\r\n        dataIndex: 'customer_name',\r\n        key: 'customer_name',\r\n        width: 200,\r\n        render: (text: string, record: ProductSale) => (\r\n          <div>\r\n            <div style={{ fontWeight: 500 }}>{text}</div>\r\n            <div style={{ fontSize: '12px', color: '#8c8c8c' }}>ID: {record.customer_id}</div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Product',\r\n        dataIndex: 'product_name',\r\n        key: 'product_name',\r\n        width: 200,\r\n        render: (text: string, record: ProductSale) => (\r\n          <div>\r\n            <div style={{ fontWeight: 500 }}>{text}</div>\r\n            <div style={{ fontSize: '12px', color: '#8c8c8c' }}>\r\n              {record.warranty_period} months warranty\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Quantity',\r\n        dataIndex: 'quantity',\r\n        key: 'quantity',\r\n        width: 100,\r\n        align: 'center',\r\n        render: (text: number) => <span style={{ fontWeight: 500 }}>{text}</span>,\r\n      },\r\n      {\r\n        title: 'Unit Price',\r\n        dataIndex: 'unit_price',\r\n        key: 'unit_price',\r\n        width: 120,\r\n        align: 'right',\r\n        render: (text: number) => <span style={{ fontWeight: 500 }}>{formatCurrency(text)}</span>,\r\n      },\r\n      {\r\n        title: 'Total Value',\r\n        dataIndex: 'total_value',\r\n        key: 'total_value',\r\n        width: 130,\r\n        align: 'right',\r\n        render: (text: number) => (\r\n          <span style={{ fontWeight: 600, color: '#1890ff' }}>{formatCurrency(text)}</span>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Status',\r\n        dataIndex: 'status',\r\n        key: 'status',\r\n        width: 120,\r\n        render: (status: string) => getStatusTag(status),\r\n      },\r\n      {\r\n        title: 'Sale Date',\r\n        dataIndex: 'sale_date',\r\n        key: 'sale_date',\r\n        width: 120,\r\n        render: (date: string) => formatDate(date),\r\n      },\r\n      {\r\n        title: 'Actions',\r\n        key: 'actions',\r\n        fixed: 'right',\r\n        width: 180,\r\n        align: 'center',\r\n        render: (_: unknown, record: ProductSale) => (\r\n          <Space size=\"small\">\r\n            <Tooltip title=\"View Details\">\r\n              <Button\r\n                type=\"text\"\r\n                icon={<EyeOutlined />}\r\n                onClick={() => handleViewSale(record)}\r\n              />\r\n            </Tooltip>\r\n            {hasPermission('manage_product_sales') && (\r\n              <Tooltip title=\"Edit\">\r\n                <Button\r\n                  type=\"text\"\r\n                  icon={<EditOutlined />}\r\n                  onClick={() => handleEditSale(record)}\r\n                />\r\n              </Tooltip>\r\n            )}\r\n            {record.invoice_url && (\r\n              <Tooltip title=\"Download Invoice\">\r\n                <Button\r\n                  type=\"text\"\r\n                  icon={<DownloadOutlined />}\r\n                  onClick={() => window.open(record.invoice_url, '_blank')}\r\n                />\r\n              </Tooltip>\r\n            )}\r\n            {hasPermission('manage_product_sales') && (\r\n              <Popconfirm\r\n                title=\"Delete Product Sale\"\r\n                description={`Are you sure you want to delete sale ${record.sale_number}? This action cannot be undone.`}\r\n                onConfirm={() => handleDeleteSale(record)}\r\n                okText=\"Delete\"\r\n                cancelText=\"Cancel\"\r\n                okButtonProps={{ danger: true }}\r\n              >\r\n                <Tooltip title=\"Delete\">\r\n                  <Button type=\"text\" danger icon={<DeleteOutlined />} />\r\n                </Tooltip>\r\n              </Popconfirm>\r\n            )}\r\n          </Space>\r\n        ),\r\n      },\r\n    ];\r\n    return cols;\r\n  }, [hasPermission]);\r\n\r\n  // Apply column configuration\r\n   \r\n  const columns = useMemo(() => {\r\n    if (columnConfig.length === 0) {\r\n      return baseColumns;\r\n    }\r\n    return applyColumnConfig(baseColumns, columnConfig);\r\n  }, [baseColumns, columnConfig]);\r\n\r\n  if (!hasPermission('manage_product_sales')) {\r\n    return (\r\n      <>\r\n        <div style={{ padding: 24 }}>\r\n          <Alert\r\n            message=\"Access Denied\"\r\n            description=\"You don't have permission to access product sales.\"\r\n            type=\"warning\"\r\n            showIcon\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Product Sales\"\r\n        description=\"Manage product sales and generate service contracts\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/tenant/dashboard' },\r\n            { title: 'Sales', path: '/tenant/sales' },\r\n            { title: 'Product Sales' }\r\n          ]\r\n        }}\r\n        extra={\r\n          <Space>\r\n            <Button\r\n              icon={<TableOutlined />}\r\n              type={viewMode === 'table' ? 'primary' : 'default'}\r\n              onClick={() => setViewMode('table')}\r\n            >\r\n              Table\r\n            </Button>\r\n            <Button\r\n              icon={<BarChartOutlined />}\r\n              type={viewMode === 'analytics' ? 'primary' : 'default'}\r\n              onClick={() => setViewMode('analytics')}\r\n            >\r\n              Analytics\r\n            </Button>\r\n            <Button\r\n              icon={<ReloadOutlined spin={refreshing} />}\r\n              onClick={handleRefresh}\r\n              disabled={refreshing}\r\n            >\r\n              Refresh\r\n            </Button>\r\n            {hasPermission('manage_product_sales') && (\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<PlusOutlined />}\r\n                onClick={handleCreateSale}\r\n              >\r\n                Create Sale\r\n              </Button>\r\n            )}\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Analytics View */}\r\n        {viewMode === 'analytics' && analytics ? (\r\n          <ProductSalesAnalyticsDashboard analytics={analytics} loading={loading} />\r\n        ) : (\r\n          <>\r\n            {/* Table View - Statistics Cards */}\r\n            {analytics && (\r\n              <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n                <Col xs={24} sm={12} lg={6}>\r\n                  <StatCard\r\n                    title=\"Total Sales\"\r\n                    value={analytics.total_sales}\r\n                    icon={<ShoppingCartOutlined />}\r\n                    color=\"primary\"\r\n                    description=\"All product sales\"\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12} lg={6}>\r\n                  <StatCard\r\n                    title=\"Total Revenue\"\r\n                    value={formatCurrency(analytics.total_revenue)}\r\n                    icon={<DollarOutlined />}\r\n                    color=\"success\"\r\n                    description=\"Total sales value\"\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12} lg={6}>\r\n                  <StatCard\r\n                    title=\"Active Contracts\"\r\n                    value={analytics.active_contracts}\r\n                    icon={<FileTextOutlined />}\r\n                    color=\"info\"\r\n                    description=\"Generated contracts\"\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12} lg={6}>\r\n                  <StatCard\r\n                    title=\"Avg Sale Value\"\r\n                    value={formatCurrency(analytics.average_sale_value)}\r\n                    icon={<RiseOutlined />}\r\n                    color=\"warning\"\r\n                    description=\"Per sale average\"\r\n                  />\r\n                </Col>\r\n              </Row>\r\n            )}\r\n\r\n            {/* Filters */}\r\n            <Card style={{ marginBottom: 16 }}>\r\n              <Row gutter={[16, 16]}>\r\n                <Col xs={24} sm={12} md={8}>\r\n                  <Search\r\n                    placeholder=\"Search sales...\"\r\n                    allowClear\r\n                    value={searchText}\r\n                    onChange={(e) => setSearchText(e.target.value)}\r\n                    onSearch={handleSearch}\r\n                    prefix={<SearchOutlined />}\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12} md={6}>\r\n                  <Select\r\n                    placeholder=\"Filter by status\"\r\n                    allowClear\r\n                    style={{ width: '100%' }}\r\n                    onChange={handleStatusFilter}\r\n                    value={filters.status}\r\n                  >\r\n                    {PRODUCT_SALE_STATUSES.map((status) => (\r\n                      <Option key={status.value} value={status.value}>\r\n                        {status.label}\r\n                      </Option>\r\n                    ))}\r\n                  </Select>\r\n                </Col>\r\n                <Col xs={24} sm={12} md={6}>\r\n                  <Input\r\n                    placeholder=\"Filter by customer...\"\r\n                    allowClear\r\n                    value={filters.customer_name}\r\n                    onChange={(e) => handleCustomerFilter(e.target.value)}\r\n                  />\r\n                </Col>\r\n                <Col xs={24} sm={12} md={4}>\r\n                  <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n                    <Button\r\n                      icon={<SearchOutlined />}\r\n                      onClick={() => setShowAdvancedSearch(true)}\r\n                    >\r\n                      Advanced Search\r\n                    </Button>\r\n                    <Button\r\n                      icon={<FilterOutlined />}\r\n                      onClick={() => setShowAdvancedFilters(true)}\r\n                    >\r\n                      Advanced\r\n                    </Button>\r\n                    <Button\r\n                      icon={<FilterOutlined />}\r\n                      onClick={() => setShowFilterPresets(true)}\r\n                      title=\"Save, load, and manage filter presets\"\r\n                    >\r\n                      Presets\r\n                    </Button>\r\n                    <Tooltip title=\"Show/hide columns, reorder columns, and save layout\">\r\n                      <Button\r\n                        icon={<TableOutlined />}\r\n                        onClick={() => setShowDynamicColumns(true)}\r\n                      >\r\n                        Columns\r\n                      </Button>\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Configure notification preferences for product sales events\">\r\n                      <Button\r\n                        icon={<BellOutlined />}\r\n                        onClick={() => setShowNotificationPreferences(true)}\r\n                      >\r\n                        Notifications\r\n                      </Button>\r\n                    </Tooltip>\r\n                    <Button\r\n                      icon={<DownloadOutlined />}\r\n                      onClick={() => setShowReportsModal(true)}\r\n                    >\r\n                      Reports\r\n                    </Button>\r\n                    <Button\r\n                      icon={<DownloadOutlined />}\r\n                      onClick={() => setShowExportModal(true)}\r\n                    >\r\n                      Export\r\n                    </Button>\r\n                    {Object.keys(filters).length > 0 && (\r\n                      <Button\r\n                        danger\r\n                        onClick={clearFilters}\r\n                      >\r\n                        Clear\r\n                      </Button>\r\n                    )}\r\n                  </Space>\r\n                </Col>\r\n              </Row>\r\n            </Card>\r\n\r\n            {/* Bulk Action Toolbar */}\r\n            {selectedRowKeys.length > 0 && (\r\n              <BulkActionToolbar\r\n                selectedCount={selectedRowKeys.length}\r\n                selectedSales={selectedSales}\r\n                onBulkStatusUpdate={handleBulkStatusUpdate}\r\n                onBulkDelete={handleBulkDelete}\r\n                onBulkExport={handleBulkExport}\r\n                onClearSelection={handleClearSelection}\r\n                loading={bulkUpdateStatus.isLoading || bulkDelete.isLoading || bulkExport.isLoading}\r\n              />\r\n            )}\r\n\r\n            {/* Product Sales Table */}\r\n            <Card>\r\n              <Table\r\n                columns={columns}\r\n                dataSource={productSales}\r\n                rowKey=\"id\"\r\n                loading={loading}\r\n                rowSelection={{\r\n                  selectedRowKeys,\r\n                  onChange: (keys) => setSelectedRowKeys(keys),\r\n                  checkStrictly: true,\r\n                  preserveSelectedRowKeys: true\r\n                }}\r\n                pagination={{\r\n                  current: currentPage,\r\n                  pageSize: pageSize,\r\n                  total: totalItems,\r\n                  showSizeChanger: true,\r\n                  showTotal: (total) => `Total ${total} sales`,\r\n                  onChange: (page, size) => {\r\n                    setCurrentPage(page);\r\n                    setPageSize(size);\r\n                  },\r\n                }}\r\n                scroll={{ x: 1400 }}\r\n                locale={{\r\n                  emptyText: (\r\n                    <Empty\r\n                      image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                      description=\"No product sales found\"\r\n                    >\r\n                      {hasPermission('manage_product_sales') && (\r\n                        <Button\r\n                          type=\"primary\"\r\n                          icon={<PlusOutlined />}\r\n                          onClick={handleCreateSale}\r\n                        >\r\n                          Create First Sale\r\n                        </Button>\r\n                      )}\r\n                    </Empty>\r\n                  ),\r\n                }}\r\n              />\r\n            </Card>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Product Sale Form Side Panel - Create */}\r\n      <ProductSaleFormPanel\r\n        visible={showCreateModal}\r\n        productSale={null}\r\n        onClose={() => setShowCreateModal(false)}\r\n        onSuccess={handleFormSuccess}\r\n      />\r\n\r\n      {/* Product Sale Form Side Panel - Edit */}\r\n      <ProductSaleFormPanel\r\n        visible={showEditModal}\r\n        productSale={selectedSale}\r\n        onClose={() => setShowEditModal(false)}\r\n        onSuccess={handleFormSuccess}\r\n      />\r\n\r\n      {/* Product Sale Detail Side Panel */}\r\n      <ProductSaleDetailPanel\r\n        visible={showDetailModal}\r\n        productSale={selectedSale}\r\n        onClose={() => setShowDetailModal(false)}\r\n        onEdit={() => {\r\n          setShowDetailModal(false);\r\n          setShowEditModal(true);\r\n        }}\r\n        onGenerateContract={handleGenerateContract}\r\n        onDelete={handleDeleteFromDetail}\r\n      />\r\n\r\n      {/* Advanced Search Modal */}\r\n      <AdvancedSearchModal\r\n        visible={showAdvancedSearch}\r\n        onSearch={handleAdvancedSearch}\r\n        onClose={() => setShowAdvancedSearch(false)}\r\n      />\r\n\r\n      {/* Advanced Filters Modal */}\r\n      <AdvancedFiltersModal\r\n        visible={showAdvancedFilters}\r\n        filters={filters}\r\n        onApply={handleApplyAdvancedFilters}\r\n        onClose={() => setShowAdvancedFilters(false)}\r\n      />\r\n\r\n      {/* Reports Modal */}\r\n      <ReportsModal\r\n        visible={showReportsModal}\r\n        data={productSales}\r\n        onClose={() => setShowReportsModal(false)}\r\n      />\r\n\r\n      {/* Export Modal */}\r\n      <ExportModal\r\n        visible={showExportModal}\r\n        data={productSales}\r\n        onClose={() => setShowExportModal(false)}\r\n      />\r\n\r\n      {/* Filter Presets Modal */}\r\n      <FilterPresetsModal\r\n        visible={showFilterPresets}\r\n        currentFilters={filters}\r\n        onLoadPreset={handleLoadPreset}\r\n        onClose={() => setShowFilterPresets(false)}\r\n      />\r\n\r\n      {/* Dynamic Columns Modal */}\r\n      <DynamicColumnsModal\r\n        visible={showDynamicColumns}\r\n        onClose={() => setShowDynamicColumns(false)}\r\n        onColumnsChange={handleColumnsChange}\r\n      />\r\n\r\n      {/* Notification Preferences Modal */}\r\n      <NotificationPreferencesModal\r\n        visible={showNotificationPreferences}\r\n        onClose={() => setShowNotificationPreferences(false)}\r\n        onSuccess={() => {\r\n          message.success('Notification preferences updated successfully');\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProductSalesPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\__tests__\\multiTenantSafety.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[657,660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[657,660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[782,785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[782,785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[985,988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[985,988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1130,1133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1130,1133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1310,1313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1310,1313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1372,1375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1372,1375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1504,1507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1504,1507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1718,1721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1718,1721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1836,1839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1836,1839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2154,2157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2154,2157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2544,2547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2544,2547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2657,2660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2657,2660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3210,3213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3210,3213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3324,3327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3324,3327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3818,3821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3818,3821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4292,4295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4292,4295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4803,4806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4803,4806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5312,5315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5312,5315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5478,5481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5478,5481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5688,5691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5688,5691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5825,5828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5825,5828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5990,5993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5990,5993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6092,6095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6092,6095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6386,6389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6386,6389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6730,6733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6730,6733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8178,8181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8178,8181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8302,8305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8302,8305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8629,8632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8629,8632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8700,8703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8700,8703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8880,8883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8880,8883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8992,8995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8992,8995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":268,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9131,9134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9131,9134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":283,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9629,9632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9629,9632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9808,9811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9808,9811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10097,10100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10097,10100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10615,10618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10615,10618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":316,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":316,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10828,10831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10828,10831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\r\nimport { mockSalesService } from '@/services/salesService';\r\n\r\n/**\r\n * Multi-Tenant Safety Tests for Sales Module\r\n * Ensures that tenant data is properly isolated and not accessible across tenant boundaries\r\n */\r\n\r\ndescribe('Sales Module - Multi-Tenant Safety', () => {\r\n  const tenant1Id = 'tenant_1';\r\n  const tenant2Id = 'tenant_2';\r\n  const customerId = 'customer_1';\r\n\r\n  // Core Multi-Tenant Isolation Tests\r\n\r\n  describe('Tenant Data Isolation - getDealsByCustomer', () => {\r\n    it('should only return deals for specified tenant', async () => {\r\n      const tenant1Deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId,\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      tenant1Deals.forEach((deal: any) => {\r\n        expect(deal.tenantId).toBe(tenant1Id);\r\n      });\r\n    });\r\n\r\n    it('should not return deals from other tenants', async () => {\r\n      const tenant1Deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId,\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      const tenant2Deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId,\r\n        tenantId: tenant2Id,\r\n      });\r\n\r\n      // Extract deal IDs for each tenant\r\n      const tenant1Ids = tenant1Deals.map((d: any) => d.id);\r\n      const tenant2Ids = tenant2Deals.map((d: any) => d.id);\r\n\r\n      // Find intersection - should be empty (no shared deals)\r\n      const intersection = tenant1Ids.filter((id: any) => tenant2Ids.includes(id));\r\n      expect(intersection.length).toBe(0);\r\n    });\r\n\r\n    it('should respect both customerId and tenantId filters', async () => {\r\n      const deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId,\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      deals.forEach((deal: any) => {\r\n        expect(deal.customerId).toBe(customerId);\r\n        expect(deal.tenantId).toBe(tenant1Id);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Tenant Data Isolation - getSalesStats', () => {\r\n    it('should return stats scoped to specific tenant', async () => {\r\n      const stats = await (mockSalesService as any).getSalesStats({\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      // In production, these stats should be calculated only from tenant_1 deals\r\n      expect(stats).toHaveProperty('totalDeals');\r\n      expect(typeof stats.totalDeals).toBe('number');\r\n    });\r\n\r\n    it('should return different stats for different tenants', async () => {\r\n      const stats1 = await (mockSalesService as any).getSalesStats({\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      const stats2 = await (mockSalesService as any).getSalesStats({\r\n        tenantId: tenant2Id,\r\n      });\r\n\r\n      // Both should be valid stats\r\n      expect(stats1).toHaveProperty('totalDeals');\r\n      expect(stats2).toHaveProperty('totalDeals');\r\n\r\n      // In real scenario with Supabase RLS, these would be different\r\n      // For mock, they might be same data, but the isolation mechanism exists\r\n    });\r\n  });\r\n\r\n  describe('Tenant Data Isolation - getDealStages', () => {\r\n    it('should return stages for specific tenant', async () => {\r\n      const stages1 = await (mockSalesService as any).getDealStages({\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      const stages2 = await (mockSalesService as any).getDealStages({\r\n        tenantId: tenant2Id,\r\n      });\r\n\r\n      expect(Array.isArray(stages1)).toBe(true);\r\n      expect(Array.isArray(stages2)).toBe(true);\r\n      expect(stages1.length).toBeGreaterThan(0);\r\n      expect(stages2.length).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  // Bulk Operation Tenant Safety\r\n\r\n  describe('Bulk Operations - Tenant Safety', () => {\r\n    it('should only update deals for specified tenant', async () => {\r\n      const result = await (mockSalesService as any).bulkUpdateDeals({\r\n        tenantId: tenant1Id,\r\n        deals: [\r\n          { id: 'deal_1', status: 'closed' },\r\n          { id: 'deal_2', status: 'closed' },\r\n        ],\r\n      });\r\n\r\n      // Should only process tenant_1 deals\r\n      expect(result).toHaveProperty('successCount');\r\n      expect(result).toHaveProperty('failureCount');\r\n    });\r\n\r\n    it('should only delete deals for specified tenant', async () => {\r\n      const result = await (mockSalesService as any).bulkDeleteDeals({\r\n        tenantId: tenant1Id,\r\n        dealIds: ['deal_1', 'deal_2'],\r\n      });\r\n\r\n      // Should only delete tenant_1 deals\r\n      expect(result).toHaveProperty('successCount');\r\n      expect(result).toHaveProperty('failureCount');\r\n    });\r\n\r\n    it('should not allow cross-tenant bulk operations', async () => {\r\n      // Attempting to update a deal from tenant2 while operating as tenant1\r\n      // should fail or ignore the request\r\n      const result = await (mockSalesService as any).bulkUpdateDeals({\r\n        tenantId: tenant1Id,\r\n        deals: [\r\n          { id: 'deal_from_tenant_2', status: 'closed' },\r\n        ],\r\n      });\r\n\r\n      // Should either fail or have 0 successes\r\n      expect(result.successCount + result.failureCount).toBeDefined();\r\n    });\r\n  });\r\n\r\n  // Search and Filter Tenant Safety\r\n\r\n  describe('Search Operations - Tenant Safety', () => {\r\n    it('should only search within specified tenant', async () => {\r\n      const results = await (mockSalesService as any).searchDeals({\r\n        tenantId: tenant1Id,\r\n        query: 'deal',\r\n      });\r\n\r\n      expect(Array.isArray(results)).toBe(true);\r\n      results.forEach((deal: any) => {\r\n        expect(deal.tenantId).toBe(tenant1Id);\r\n      });\r\n    });\r\n\r\n    it('should return different results for different tenants', async () => {\r\n      const results1 = await (mockSalesService as any).searchDeals({\r\n        tenantId: tenant1Id,\r\n        query: 'deal',\r\n      });\r\n\r\n      const results2 = await (mockSalesService as any).searchDeals({\r\n        tenantId: tenant2Id,\r\n        query: 'deal',\r\n      });\r\n\r\n      // Each should be scoped to their tenant\r\n      results1.forEach((deal: any) => {\r\n        expect(deal.tenantId).toBe(tenant1Id);\r\n      });\r\n\r\n      results2.forEach((deal: any) => {\r\n        expect(deal.tenantId).toBe(tenant2Id);\r\n      });\r\n    });\r\n  });\r\n\r\n  // Export/Import Tenant Safety\r\n\r\n  describe('Export/Import - Tenant Safety', () => {\r\n    it('should export only deals from specified tenant', async () => {\r\n      const csv = await (mockSalesService as any).exportDeals({\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      expect(typeof csv).toBe('string');\r\n      // Should contain only tenant_1 data\r\n    });\r\n\r\n    it('should import deals with tenant context preserved', async () => {\r\n      const csv = 'id,title,value\\ndeal_1,Test Deal,50000';\r\n      const result = await (mockSalesService as any).importDeals({\r\n        tenantId: tenant1Id,\r\n        csvData: csv,\r\n      });\r\n\r\n      expect(result).toHaveProperty('importedCount');\r\n      // Imported deals should be assigned to tenant_1\r\n    });\r\n  });\r\n\r\n  // Query Key Isolation (for React Query)\r\n\r\n  describe('Query Key Isolation', () => {\r\n    it('should include tenantId in query key for cache separation', () => {\r\n      // This validates that the hook layer includes tenantId in React Query keys\r\n      // Query keys should follow pattern: ['sales', tenantId, 'deals', customerId]\r\n      // This ensures different tenants don't share cache\r\n\r\n      // Example expected query key:\r\n      // ['sales', 'tenant_1', 'deals', 'customer_1']\r\n      // ['sales', 'tenant_2', 'deals', 'customer_1']\r\n      // These should be different cache entries\r\n\r\n      expect(true).toBe(true); // Placeholder - actual testing done in hook tests\r\n    });\r\n\r\n    it('should not allow cache cross-contamination between tenants', () => {\r\n      // Ensure that loading tenant_1 data doesn't affect tenant_2 cache\r\n      // This is validated through proper query key construction at hook level\r\n      expect(true).toBe(true); // Placeholder\r\n    });\r\n  });\r\n\r\n  // Multi-Tenant Scenario Tests\r\n\r\n  describe('Multi-Tenant Scenarios', () => {\r\n    it('should handle simultaneous requests from different tenants', async () => {\r\n      const [deals1, deals2] = await Promise.all([\r\n        (mockSalesService as any).getDealsByCustomer({\r\n          customerId,\r\n          tenantId: tenant1Id,\r\n        }),\r\n        (mockSalesService as any).getDealsByCustomer({\r\n          customerId,\r\n          tenantId: tenant2Id,\r\n        }),\r\n      ]);\r\n\r\n      // Both requests should complete successfully\r\n      expect(Array.isArray(deals1)).toBe(true);\r\n      expect(Array.isArray(deals2)).toBe(true);\r\n\r\n      // Each should be tenant-isolated\r\n      deals1.forEach((d: any) => expect(d.tenantId).toBe(tenant1Id));\r\n      deals2.forEach((d: any) => expect(d.tenantId).toBe(tenant2Id));\r\n    });\r\n\r\n    it('should maintain isolation during mixed operations', async () => {\r\n      const stats1 = await (mockSalesService as any).getSalesStats({\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      const deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId,\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      const stats2 = await (mockSalesService as any).getSalesStats({\r\n        tenantId: tenant2Id,\r\n      });\r\n\r\n      // All operations should maintain their tenant isolation\r\n      expect(stats1).toHaveProperty('totalDeals');\r\n      expect(Array.isArray(deals)).toBe(true);\r\n      expect(stats2).toHaveProperty('totalDeals');\r\n    });\r\n  });\r\n\r\n  // Security Test Cases\r\n\r\n  describe('Tenant Security', () => {\r\n    it('should not expose tenant_1 data when requesting as tenant_2', async () => {\r\n      const deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId,\r\n        tenantId: tenant2Id,\r\n      });\r\n\r\n      // None of the returned deals should have tenant_1 ID\r\n      deals.forEach((deal: any) => {\r\n        expect(deal.tenantId).not.toBe(tenant1Id);\r\n      });\r\n    });\r\n\r\n    it('should require valid tenantId for all operations', async () => {\r\n      // Operations should fail or return empty when tenantId is missing/invalid\r\n      try {\r\n        await (mockSalesService as any).getDealsByCustomer({\r\n          customerId,\r\n          tenantId: null, // Invalid tenant\r\n        });\r\n        // If it doesn't throw, it should at least return empty\r\n      } catch (error) {\r\n        expect(error).toBeDefined();\r\n      }\r\n    });\r\n\r\n    it('should not allow privilege escalation through tenant parameter', async () => {\r\n      // Even if someone tries to request data from a different tenant\r\n      // they should only get their own tenant's data\r\n      const deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId: 'customer_2', // Different customer\r\n        tenantId: tenant1Id,\r\n      });\r\n\r\n      // Should either return empty or only tenant_1 data\r\n      deals.forEach((deal: any) => {\r\n        expect(deal.tenantId).toBe(tenant1Id);\r\n      });\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\components\\ConvertToContractModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\components\\CreateProductSalesModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5678,5681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5678,5681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5687,5690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5687,5690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Create Product Sales Modal\r\n * Phase 3.3: Workflow modal for creating product sales entries from deal items\r\n * Handles bulk creation of product sales when a deal is closed\r\n */\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport {\r\n  Modal,\r\n  Table,\r\n  Button,\r\n  Space,\r\n  message,\r\n  Alert,\r\n  Spin,\r\n  Tag,\r\n  Checkbox,\r\n  Row,\r\n  Col,\r\n  Card,\r\n  Divider,\r\n} from 'antd';\r\nimport { CheckCircleOutlined, ExclamationCircleOutlined } from '@ant-design/icons';\r\nimport { Deal, SaleItem } from '@/types/crm';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { SalesService } from '../services/salesService';\r\nimport { productSaleService } from '@/services';\r\n\r\ninterface CreateProductSalesModalProps {\r\n  visible: boolean;\r\n  deal: Deal | null;\r\n  onClose: () => void;\r\n  onSuccess: (createdCount: number) => void;\r\n}\r\n\r\nexport const CreateProductSalesModal: React.FC<CreateProductSalesModalProps> = ({\r\n  visible,\r\n  deal,\r\n  onClose,\r\n  onSuccess,\r\n}) => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set());\r\n  const [selectAll, setSelectAll] = useState(false);\r\n\r\n  const salesService = useService<SalesService>('salesService');\r\n\r\n  // Get items from deal\r\n  const items = useMemo(() => {\r\n    return deal?.items || [];\r\n  }, [deal]);\r\n\r\n  // Calculate summary statistics\r\n  const summary = useMemo(() => {\r\n    const totalItems = items.length;\r\n    const totalQuantity = items.reduce((sum, item) => sum + (item.quantity || 0), 0);\r\n    const totalValue = items.reduce((sum, item) => sum + (item.line_total || 0), 0);\r\n    const selectedCount = selectedItems.size;\r\n\r\n    return {\r\n      totalItems,\r\n      totalQuantity,\r\n      totalValue,\r\n      selectedCount,\r\n    };\r\n  }, [items, selectedItems]);\r\n\r\n  const handleSelectAll = (checked: boolean) => {\r\n    setSelectAll(checked);\r\n    if (checked) {\r\n      setSelectedItems(new Set(items.map((_, idx) => idx.toString())));\r\n    } else {\r\n      setSelectedItems(new Set());\r\n    }\r\n  };\r\n\r\n  const handleSelectItem = (index: string, checked: boolean) => {\r\n    const newSelected = new Set(selectedItems);\r\n    if (checked) {\r\n      newSelected.add(index);\r\n    } else {\r\n      newSelected.delete(index);\r\n    }\r\n    setSelectedItems(newSelected);\r\n    setSelectAll(newSelected.size === items.length);\r\n  };\r\n\r\n  const handleCreateProductSales = async () => {\r\n    try {\r\n      if (selectedItems.size === 0) {\r\n        message.warning('Please select at least one item');\r\n        return;\r\n      }\r\n\r\n      if (!deal) {\r\n        message.error('Deal information not available');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n\r\n      const itemsToCreate = items.filter((_, idx) => selectedItems.has(idx.toString()));\r\n\r\n      console.log('üì¶ Creating product sales for deal:', {\r\n        dealId: deal.id,\r\n        dealTitle: deal.title,\r\n        customerId: deal.customer_id,\r\n        itemCount: itemsToCreate.length,\r\n      });\r\n\r\n      // Create product sales entries\r\n      let createdCount = 0;\r\n      const errors: string[] = [];\r\n\r\n      for (const item of itemsToCreate) {\r\n        try {\r\n          const productSaleData = {\r\n            deal_id: deal.id,\r\n            deal_title: deal.title,\r\n            product_id: item.product_id,\r\n            product_name: item.product_name,\r\n            product_description: item.product_description || '',\r\n            quantity: item.quantity || 1,\r\n            unit_price: item.unit_price || 0,\r\n            discount: item.discount || 0,\r\n            tax: item.tax || 0,\r\n            total_price: item.line_total || 0,\r\n            customer_id: deal.customer_id,\r\n            customer_name: deal.customer_name || '',\r\n            sale_date: new Date().toISOString().split('T')[0],\r\n            assigned_to: deal.assigned_to,\r\n            notes: `Created from deal: ${deal.title}`,\r\n          };\r\n\r\n          // Call product sale service to create entry\r\n          await productSaleService.createProductSale(productSaleData);\r\n          createdCount++;\r\n          console.log(`‚úÖ Created product sale for: ${item.product_name}`);\r\n        } catch (error) {\r\n          const errorMsg = error instanceof Error ? error.message : 'Unknown error';\r\n          errors.push(`${item.product_name}: ${errorMsg}`);\r\n          console.error(`‚ùå Failed to create product sale for ${item.product_name}:`, error);\r\n        }\r\n      }\r\n\r\n      if (createdCount > 0) {\r\n        message.success(\r\n          `${createdCount} product sale${createdCount !== 1 ? 's' : ''} created successfully`\r\n        );\r\n        console.log('‚úÖ Product sales creation completed:', { createdCount, total: itemsToCreate.length });\r\n        onSuccess(createdCount);\r\n      }\r\n\r\n      if (errors.length > 0) {\r\n        message.warning(\r\n          `${errors.length} item${errors.length !== 1 ? 's' : ''} failed to create:\\n${errors.join('\\n')}`\r\n        );\r\n      }\r\n\r\n      // Close modal after successful creation\r\n      if (createdCount > 0) {\r\n        onClose();\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Error creating product sales:', error);\r\n      message.error(\r\n        error instanceof Error ? error.message : 'Failed to create product sales entries'\r\n      );\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: (\r\n        <Checkbox\r\n          checked={selectAll}\r\n          indeterminate={\r\n            selectedItems.size > 0 && selectedItems.size < items.length\r\n          }\r\n          onChange={(e) => handleSelectAll(e.target.checked)}\r\n        />\r\n      ),\r\n      key: 'select',\r\n      width: 50,\r\n      render: (_: any, __: any, index: number) => (\r\n        <Checkbox\r\n          checked={selectedItems.has(index.toString())}\r\n          onChange={(e) => handleSelectItem(index.toString(), e.target.checked)}\r\n        />\r\n      ),\r\n    },\r\n    {\r\n      title: 'Product Name',\r\n      dataIndex: 'product_name',\r\n      key: 'product_name',\r\n      width: 200,\r\n      render: (text: string) => (\r\n        <span style={{ fontWeight: 500 }}>{text}</span>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Quantity',\r\n      dataIndex: 'quantity',\r\n      key: 'quantity',\r\n      width: 80,\r\n      align: 'center' as const,\r\n      render: (qty: number) => <strong>{qty}</strong>,\r\n    },\r\n    {\r\n      title: 'Unit Price',\r\n      dataIndex: 'unit_price',\r\n      key: 'unit_price',\r\n      width: 100,\r\n      align: 'right' as const,\r\n      render: (price: number) => `$${price.toFixed(2)}`,\r\n    },\r\n    {\r\n      title: 'Discount',\r\n      dataIndex: 'discount',\r\n      key: 'discount',\r\n      width: 80,\r\n      align: 'right' as const,\r\n      render: (discount: number) => discount > 0 ? `-$${discount.toFixed(2)}` : '-',\r\n    },\r\n    {\r\n      title: 'Line Total',\r\n      dataIndex: 'line_total',\r\n      key: 'line_total',\r\n      width: 100,\r\n      align: 'right' as const,\r\n      render: (total: number) => (\r\n        <strong style={{ color: '#1890ff' }}>\r\n          ${total.toFixed(2)}\r\n        </strong>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  if (!deal || items.length === 0) {\r\n    return (\r\n      <Modal\r\n        title=\"Create Product Sales Entries\"\r\n        open={visible}\r\n        onCancel={onClose}\r\n        footer={[\r\n          <Button key=\"close\" onClick={onClose}>\r\n            Close\r\n          </Button>,\r\n        ]}\r\n      >\r\n        <Alert\r\n          message=\"No products available\"\r\n          description=\"This deal does not have any product items to create sales entries from.\"\r\n          type=\"info\"\r\n          showIcon\r\n        />\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Create Product Sales Entries\"\r\n      open={visible}\r\n      onCancel={onClose}\r\n      width={900}\r\n      footer={[\r\n        <Button key=\"cancel\" onClick={onClose}>\r\n          Cancel\r\n        </Button>,\r\n        <Button\r\n          key=\"submit\"\r\n          type=\"primary\"\r\n          loading={loading}\r\n          onClick={handleCreateProductSales}\r\n          disabled={selectedItems.size === 0}\r\n        >\r\n          Create {selectedItems.size > 0 ? `(${selectedItems.size} selected)` : ''}\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <Spin spinning={loading}>\r\n        {/* Deal Information */}\r\n        {deal && (\r\n          <>\r\n            <Alert\r\n              message=\"Creating Product Sales from Deal\"\r\n              description={`Deal: ${deal.title} | Customer: ${deal.customer_name || 'Unknown'} | Stage: ${deal.stage}`}\r\n              type=\"info\"\r\n              icon={<CheckCircleOutlined />}\r\n              showIcon\r\n              style={{ marginBottom: 24 }}\r\n            />\r\n          </>\r\n        )}\r\n\r\n        {/* Summary Cards */}\r\n        <Row gutter={16} style={{ marginBottom: 24 }}>\r\n          <Col xs={12} sm={6}>\r\n            <Card size=\"small\" bordered={false} style={{ backgroundColor: '#f5f5f5' }}>\r\n              <div style={{ fontSize: '12px', color: '#666' }}>Total Items</div>\r\n              <div style={{ fontSize: '20px', fontWeight: 'bold', marginTop: 8 }}>\r\n                {summary.totalItems}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={12} sm={6}>\r\n            <Card size=\"small\" bordered={false} style={{ backgroundColor: '#f5f5f5' }}>\r\n              <div style={{ fontSize: '12px', color: '#666' }}>Total Quantity</div>\r\n              <div style={{ fontSize: '20px', fontWeight: 'bold', marginTop: 8 }}>\r\n                {summary.totalQuantity}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={12} sm={6}>\r\n            <Card size=\"small\" bordered={false} style={{ backgroundColor: '#e6f7ff' }}>\r\n              <div style={{ fontSize: '12px', color: '#0050b3' }}>Total Value</div>\r\n              <div style={{ fontSize: '20px', fontWeight: 'bold', marginTop: 8, color: '#0050b3' }}>\r\n                ${summary.totalValue.toFixed(2)}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={12} sm={6}>\r\n            <Card \r\n              size=\"small\" \r\n              bordered={false} \r\n              style={{ \r\n                backgroundColor: summary.selectedCount > 0 ? '#f6ffed' : '#f5f5f5'\r\n              }}\r\n            >\r\n              <div style={{ fontSize: '12px', color: '#666' }}>Selected</div>\r\n              <div \r\n                style={{ \r\n                  fontSize: '20px', \r\n                  fontWeight: 'bold', \r\n                  marginTop: 8,\r\n                  color: summary.selectedCount > 0 ? '#52c41a' : '#999'\r\n                }}\r\n              >\r\n                {summary.selectedCount} / {summary.totalItems}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n\r\n        <Divider />\r\n\r\n        {/* Items Table */}\r\n        <h4 style={{ marginBottom: 16 }}>Select Products to Create Sales Entries</h4>\r\n        <Table\r\n          columns={columns}\r\n          dataSource={items.map((item, idx) => ({\r\n            ...item,\r\n            key: idx.toString(),\r\n          }))}\r\n          pagination={false}\r\n          size=\"small\"\r\n          bordered\r\n          scroll={{ x: true }}\r\n        />\r\n\r\n        <Divider />\r\n\r\n        {/* Info Message */}\r\n        <Alert\r\n          message=\"Product Sales will be created for selected items with:\"\r\n          description={\r\n            <ul style={{ marginBottom: 0, paddingLeft: 20 }}>\r\n              <li>Quantity, Unit Price, and Discount values from the deal</li>\r\n              <li>Customer information linked from the deal</li>\r\n              <li>Today's date as the sale date</li>\r\n              <li>Deal title and reference in notes</li>\r\n            </ul>\r\n          }\r\n          type=\"warning\"\r\n          icon={<ExclamationCircleOutlined />}\r\n          showIcon\r\n          style={{ marginTop: 16 }}\r\n        />\r\n      </Spin>\r\n    </Modal>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\components\\SalesDealDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\components\\SalesDealFormPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1218,1221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1218,1221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadCustomers'. Either include it or remove the dependency array.","line":92,"column":6,"nodeType":"ArrayExpression","endLine":92,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [visible, customerService, loadCustomers]","fix":{"range":[3861,3887],"text":"[visible, customerService, loadCustomers]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProducts'. Either include it or remove the dependency array.","line":98,"column":6,"nodeType":"ArrayExpression","endLine":98,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [visible, productService, loadProducts]","fix":{"range":[3987,4012],"text":"[visible, productService, loadProducts]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'customers'. Either include it or remove the dependency array.","line":181,"column":6,"nodeType":"ArrayExpression","endLine":181,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [visible, deal, form, customers]","fix":{"range":[6780,6801],"text":"[visible, deal, form, customers]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":676,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":676,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25932,25935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25932,25935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":677,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":677,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25993,25996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25993,25996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sales Deal Form Panel - Enterprise Enhanced Edition\r\n * Professional create/edit form with card-based sections, validation, and rich UI\r\n * ‚ú® Enterprise Grade UI/UX Enhancements (Phase 7)\r\n * ‚úÖ Phase 3.1: Link Sales to Customers\r\n * ‚úÖ Phase 3.2: Link Sales to Products\r\n */\r\n\r\nimport React, { useState, useEffect, useMemo } from 'react';\r\nimport { Drawer, Form, Input, Select, Button, Space, message, InputNumber, DatePicker, Card, Alert, Spin, Row, Col, Tag, Tooltip } from 'antd';\r\nimport { \r\n  LinkOutlined, DeleteOutlined as DeleteIcon, PlusOutlined, DollarOutlined, \r\n  CalendarOutlined, UserOutlined, ShoppingCartOutlined, FileTextOutlined,\r\n  CheckCircleOutlined, RadarChartOutlined, TeamOutlined, BgColorsOutlined \r\n} from '@ant-design/icons';\r\nimport { Deal, Customer, SaleItem } from '@/types/crm';\r\nimport { Product } from '@/types/masters';\r\nimport dayjs from 'dayjs';\r\nimport { useCreateDeal, useUpdateDeal, useDealStages } from '../hooks/useSales';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { CustomerService } from '@/modules/features/customers/services/customerService';\r\n\r\n// Product Service Interface\r\ninterface ProductServiceInterface {\r\n  getProducts(filters?: any): Promise<{ data: Product[] }>;\r\n  getProduct(id: string): Promise<Product>;\r\n}\r\n\r\ninterface SalesDealFormPanelProps {\r\n  visible: boolean;\r\n  deal: Deal | null;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\n// ‚ú® Configuration objects for professional styling\r\nconst stageConfig: Record<string, { emoji: string; label: string }> = {\r\n  'lead': { emoji: 'üéØ', label: 'Lead' },\r\n  'qualified': { emoji: '‚úÖ', label: 'Qualified' },\r\n  'proposal': { emoji: 'üìÑ', label: 'Proposal' },\r\n  'negotiation': { emoji: 'ü§ù', label: 'Negotiation' },\r\n  'closed_won': { emoji: 'üéâ', label: 'Closed Won' },\r\n  'closed_lost': { emoji: '‚ùå', label: 'Closed Lost' },\r\n};\r\n\r\nconst statusConfig: Record<string, { emoji: string; label: string; bgColor: string; textColor: string }> = {\r\n  'open': { emoji: 'üîµ', label: 'Open', bgColor: '#e6f4ff', textColor: '#0050b3' },\r\n  'won': { emoji: '‚úÖ', label: 'Won', bgColor: '#f6ffed', textColor: '#274a0a' },\r\n  'lost': { emoji: '‚ùå', label: 'Lost', bgColor: '#fff1f0', textColor: '#58181c' },\r\n  'cancelled': { emoji: '‚è∏Ô∏è', label: 'Cancelled', bgColor: '#f5f5f5', textColor: '#262626' },\r\n};\r\n\r\nconst sourceConfig: Record<string, { emoji: string; label: string }> = {\r\n  'inbound': { emoji: 'üì©', label: 'Inbound' },\r\n  'outbound': { emoji: 'üì§', label: 'Outbound' },\r\n  'referral': { emoji: 'ü§ù', label: 'Referral' },\r\n  'website': { emoji: 'üåê', label: 'Website' },\r\n  'conference': { emoji: 'üé§', label: 'Conference' },\r\n};\r\n\r\nexport const SalesDealFormPanel: React.FC<SalesDealFormPanelProps> = ({\r\n  visible,\r\n  deal,\r\n  onClose,\r\n  onSuccess,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [customers, setCustomers] = useState<Customer[]>([]);\r\n  const [loadingCustomers, setLoadingCustomers] = useState(false);\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\r\n\r\n  // Product state\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [loadingProducts, setLoadingProducts] = useState(false);\r\n  const [saleItems, setSaleItems] = useState<SaleItem[]>([]);\r\n  const [selectedProductId, setSelectedProductId] = useState<string | undefined>(undefined);\r\n\r\n  // Get services\r\n  const createDeal = useCreateDeal();\r\n  const updateDeal = useUpdateDeal();\r\n  const { data: stages = [], isLoading: loadingStages } = useDealStages();\r\n  const customerService = useService<CustomerService>('customerService');\r\n  const productService = useService<ProductServiceInterface>('productService');\r\n\r\n  const isEditMode = !!deal;\r\n\r\n  // Load customers and products\r\n  useEffect(() => {\r\n    if (visible && customerService) {\r\n      loadCustomers();\r\n    }\r\n  }, [visible, customerService]);\r\n\r\n  useEffect(() => {\r\n    if (visible && productService) {\r\n      loadProducts();\r\n    }\r\n  }, [visible, productService]);\r\n\r\n  const loadCustomers = async () => {\r\n    try {\r\n      setLoadingCustomers(true);\r\n      if (!customerService) {\r\n        throw new Error('Customer service not initialized');\r\n      }\r\n      \r\n      const result = await customerService.getCustomers({ pageSize: 1000 });\r\n      if (result?.data && Array.isArray(result.data)) {\r\n        setCustomers(result.data);\r\n      } else {\r\n        setCustomers([]);\r\n      }\r\n    } catch (error) {\r\n      const errorMsg = error instanceof Error ? error.message : String(error);\r\n      if (!errorMsg.includes('Unauthorized') && !errorMsg.includes('Tenant context not initialized')) {\r\n        message.error(`Failed to load customers: ${errorMsg}`);\r\n      }\r\n      setCustomers([]);\r\n    } finally {\r\n      setLoadingCustomers(false);\r\n    }\r\n  };\r\n\r\n  const loadProducts = async () => {\r\n    try {\r\n      setLoadingProducts(true);\r\n      if (!productService) {\r\n        setProducts([]);\r\n        return;\r\n      }\r\n      \r\n      const result = await productService.getProducts({ pageSize: 1000, status: 'active' });\r\n      if (result?.data && Array.isArray(result.data)) {\r\n        setProducts(result.data);\r\n      } else {\r\n        setProducts([]);\r\n      }\r\n    } catch (error) {\r\n      console.error('[SalesDealFormPanel] Error loading products:', error);\r\n      setProducts([]);\r\n    } finally {\r\n      setLoadingProducts(false);\r\n    }\r\n  };\r\n\r\n  // Update form values when deal changes\r\n  useEffect(() => {\r\n    if (visible && deal) {\r\n      const selectedCust = customers.find(c => c.id === deal.customer_id);\r\n      setSelectedCustomer(selectedCust || null);\r\n\r\n      if (deal.items && deal.items.length > 0) {\r\n        setSaleItems(deal.items);\r\n      } else {\r\n        setSaleItems([]);\r\n      }\r\n\r\n      const formValues = {\r\n        title: deal.title || '',\r\n        customer_id: deal.customer_id || undefined,\r\n        value: deal.value || 0,\r\n        stage: deal.stage ? String(deal.stage).toLowerCase() : 'lead',\r\n        assigned_to: deal.assigned_to || undefined,\r\n        expected_close_date: deal.expected_close_date ? dayjs(deal.expected_close_date) : undefined,\r\n        actual_close_date: deal.actual_close_date ? dayjs(deal.actual_close_date) : undefined,\r\n        probability: deal.probability || 50,\r\n        description: deal.description || '',\r\n        notes: deal.notes || '',\r\n        status: deal.status || undefined,\r\n        source: deal.source || undefined,\r\n        campaign: deal.campaign || undefined,\r\n        tags: Array.isArray(deal.tags) && deal.tags.length > 0 ? deal.tags.join(', ') : undefined,\r\n      };\r\n      \r\n      form.setFieldsValue(formValues);\r\n    } else if (visible) {\r\n      form.resetFields();\r\n      setSelectedCustomer(null);\r\n      setSaleItems([]);\r\n    }\r\n  }, [visible, deal, form]);\r\n\r\n  const handleCustomerChange = (customerId: string) => {\r\n    const customer = customers.find(c => c.id === customerId);\r\n    setSelectedCustomer(customer || null);\r\n  };\r\n\r\n  const handleAddProduct = () => {\r\n    if (!selectedProductId) {\r\n      message.warning('Please select a product');\r\n      return;\r\n    }\r\n\r\n    if (saleItems.find(item => item.product_id === selectedProductId)) {\r\n      message.warning('This product is already in the deal. Update the quantity instead.');\r\n      return;\r\n    }\r\n\r\n    const selectedProduct = products.find(p => p.id === selectedProductId);\r\n    if (!selectedProduct) {\r\n      message.error('Product not found');\r\n      return;\r\n    }\r\n\r\n    const newItem: SaleItem = {\r\n      id: `item-${Date.now()}`,\r\n      sale_id: deal?.id || 'temp',\r\n      product_id: selectedProduct.id,\r\n      product_name: selectedProduct.name,\r\n      product_description: selectedProduct.description,\r\n      quantity: 1,\r\n      unit_price: selectedProduct.price || 0,\r\n      discount: 0,\r\n      tax: 0,\r\n      line_total: selectedProduct.price || 0,\r\n    };\r\n\r\n    setSaleItems([...saleItems, newItem]);\r\n    setSelectedProductId(undefined);\r\n    message.success(`${selectedProduct.name} added to deal`);\r\n  };\r\n\r\n  const handleRemoveItem = (itemId: string) => {\r\n    setSaleItems(saleItems.filter(item => item.id !== itemId));\r\n  };\r\n\r\n  const handleUpdateItemQuantity = (itemId: string, quantity: number) => {\r\n    setSaleItems(saleItems.map(item => {\r\n      if (item.id === itemId) {\r\n        const lineTotal = (item.unit_price * quantity) - item.discount + item.tax;\r\n        return { ...item, quantity, line_total: lineTotal };\r\n      }\r\n      return item;\r\n    }));\r\n  };\r\n\r\n  const handleUpdateItemDiscount = (itemId: string, discount: number) => {\r\n    setSaleItems(saleItems.map(item => {\r\n      if (item.id === itemId) {\r\n        const lineTotal = (item.unit_price * item.quantity) - discount + item.tax;\r\n        return { ...item, discount, line_total: lineTotal };\r\n      }\r\n      return item;\r\n    }));\r\n  };\r\n\r\n  const calculateTotalFromItems = useMemo(() => {\r\n    return saleItems.reduce((sum, item) => sum + item.line_total, 0);\r\n  }, [saleItems]);\r\n\r\n  const handleSubmit = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      \r\n      if (!values.customer_id) {\r\n        message.error('Please select a customer');\r\n        return;\r\n      }\r\n\r\n      const customer = customers.find(c => c.id === values.customer_id);\r\n      if (!customer) {\r\n        message.error('Selected customer not found');\r\n        return;\r\n      }\r\n\r\n      const dealValue = saleItems.length > 0 ? calculateTotalFromItems : values.value;\r\n\r\n      const tagsArray = values.tags\r\n        ? values.tags.split(',').map((tag: string) => tag.trim()).filter((tag: string) => tag)\r\n        : [];\r\n\r\n      const stageValue = String(values.stage || 'lead').toLowerCase();\r\n      \r\n      const dealData = {\r\n        title: values.title,\r\n        description: values.description,\r\n        value: dealValue,\r\n        stage: stageValue,\r\n        status: values.status || null,\r\n        customer_id: values.customer_id,\r\n        assigned_to: values.assigned_to || null,\r\n        expected_close_date: values.expected_close_date \r\n          ? values.expected_close_date.toISOString() \r\n          : undefined,\r\n        actual_close_date: values.actual_close_date\r\n          ? values.actual_close_date.toISOString()\r\n          : undefined,\r\n        probability: values.probability,\r\n        notes: values.notes || null,\r\n        source: values.source || null,\r\n        campaign: values.campaign || null,\r\n        tags: tagsArray,\r\n        items: saleItems,\r\n      };\r\n\r\n      if (isEditMode && deal?.id) {\r\n        await updateDeal.mutateAsync({ id: deal.id, ...dealData });\r\n        message.success('Deal updated successfully');\r\n      } else {\r\n        await createDeal.mutateAsync(dealData);\r\n        message.success('Deal created successfully');\r\n      }\r\n\r\n      onSuccess();\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Form submission error:', error);\r\n      message.error('Failed to save deal');\r\n    }\r\n  };\r\n\r\n  // ‚ú® Section card styling\r\n  const sectionCardStyle = {\r\n    marginBottom: 20,\r\n    boxShadow: '0 1px 3px rgba(0, 0, 0, 0.08)',\r\n    borderRadius: 8,\r\n    border: '1px solid #f0f0f0',\r\n  };\r\n\r\n  const sectionHeaderStyle = {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    marginBottom: 16,\r\n    paddingBottom: 12,\r\n    borderBottom: '2px solid #0ea5e9',\r\n    color: '#1f2937',\r\n    fontWeight: 600,\r\n    fontSize: 14,\r\n  };\r\n\r\n  const iconStyle = {\r\n    marginRight: 8,\r\n    color: '#0ea5e9',\r\n    fontSize: 16,\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={isEditMode ? `Edit Deal - ${deal?.title}` : 'Create New Deal'}\r\n      placement=\"right\"\r\n      width={650}\r\n      onClose={onClose}\r\n      open={visible}\r\n      footer={\r\n        <Space style={{ float: 'right', width: '100%', justifyContent: 'flex-end' }}>\r\n          <Button onClick={onClose}>Cancel</Button>\r\n          <Button\r\n            type=\"primary\"\r\n            onClick={handleSubmit}\r\n            loading={createDeal.isPending || updateDeal.isPending}\r\n          >\r\n            {isEditMode ? 'Update Deal' : 'Create Deal'}\r\n          </Button>\r\n        </Space>\r\n      }\r\n    >\r\n      <Form\r\n        form={form}\r\n        layout=\"vertical\"\r\n        requiredMark=\"optional\"\r\n        autoComplete=\"off\"\r\n      >\r\n        {/* üéØ Deal Title Section */}\r\n        <Card style={sectionCardStyle}>\r\n          <div style={sectionHeaderStyle}>\r\n            <FileTextOutlined style={iconStyle} />\r\n            Deal Overview\r\n          </div>\r\n          <Row gutter={16}>\r\n            <Col xs={24}>\r\n              <Form.Item\r\n                label=\"Deal Title\"\r\n                name=\"title\"\r\n                rules={[\r\n                  { required: true, message: 'Deal title is required' },\r\n                  { min: 3, message: 'Deal title must be at least 3 characters' },\r\n                  { max: 255, message: 'Deal title cannot exceed 255 characters' }\r\n                ]}\r\n              >\r\n                <Input \r\n                  size=\"large\"\r\n                  placeholder=\"e.g., Enterprise SaaS Implementation - Acme Corp\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* üë• Customer Information */}\r\n        <Card style={sectionCardStyle}>\r\n          <div style={sectionHeaderStyle}>\r\n            <UserOutlined style={iconStyle} />\r\n            Customer Information\r\n          </div>\r\n          \r\n          {selectedCustomer && (\r\n            <Alert\r\n              message=\"‚úÖ Customer Linked\"\r\n              description={`${selectedCustomer.company_name} ‚Ä¢ ${selectedCustomer.contact_name}`}\r\n              type=\"success\"\r\n              showIcon\r\n              style={{ marginBottom: 16 }}\r\n            />\r\n          )}\r\n\r\n          <Row gutter={16}>\r\n            <Col xs={24}>\r\n              <Form.Item\r\n                label=\"Select Customer\"\r\n                name=\"customer_id\"\r\n                rules={[{ required: true, message: 'Customer is required' }]}\r\n                tooltip=\"Select or search for a customer to link this deal\"\r\n              >\r\n                <Select\r\n                  size=\"large\"\r\n                  placeholder=\"Search by company name or contact...\"\r\n                  loading={loadingCustomers}\r\n                  optionLabelProp=\"label\"\r\n                  onSelect={handleCustomerChange}\r\n                  filterOption={(input, option) =>\r\n                    (option?.label as string)?.toLowerCase().includes(input.toLowerCase())\r\n                  }\r\n                  allowClear\r\n                >\r\n                  {customers.map(customer => (\r\n                    <Select.Option\r\n                      key={customer.id}\r\n                      value={customer.id}\r\n                      label={`${customer.company_name}`}\r\n                    >\r\n                      <div>\r\n                        <div style={{ fontWeight: 500 }}>{customer.company_name}</div>\r\n                        <div style={{ fontSize: '12px', color: '#999' }}>\r\n                          {customer.contact_name} ‚Ä¢ {customer.email}\r\n                        </div>\r\n                      </div>\r\n                    </Select.Option>\r\n                  ))}\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          {selectedCustomer && (\r\n            <div style={{ backgroundColor: '#fafafa', padding: 12, borderRadius: 6 }}>\r\n              <Row gutter={16}>\r\n                <Col xs={24} sm={12}>\r\n                  <div style={{ fontSize: 12, marginBottom: 8 }}>\r\n                    <strong style={{ color: '#374151' }}>Contact Person</strong>\r\n                    <div style={{ color: '#6b7280', marginTop: 2 }}>{selectedCustomer.contact_name}</div>\r\n                  </div>\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <div style={{ fontSize: 12, marginBottom: 8 }}>\r\n                    <strong style={{ color: '#374151' }}>Email</strong>\r\n                    <div style={{ color: '#6b7280', marginTop: 2 }}>{selectedCustomer.email}</div>\r\n                  </div>\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <div style={{ fontSize: 12, marginBottom: 8 }}>\r\n                    <strong style={{ color: '#374151' }}>Phone</strong>\r\n                    <div style={{ color: '#6b7280', marginTop: 2 }}>{selectedCustomer.phone}</div>\r\n                  </div>\r\n                </Col>\r\n                <Col xs={24} sm={12}>\r\n                  <div style={{ fontSize: 12 }}>\r\n                    <strong style={{ color: '#374151' }}>Industry</strong>\r\n                    <div style={{ color: '#6b7280', marginTop: 2 }}>{selectedCustomer.industry}</div>\r\n                  </div>\r\n                </Col>\r\n              </Row>\r\n            </div>\r\n          )}\r\n        </Card>\r\n\r\n        {/* üí∞ Financial Information */}\r\n        <Card style={sectionCardStyle}>\r\n          <div style={sectionHeaderStyle}>\r\n            <DollarOutlined style={iconStyle} />\r\n            Financial Information\r\n          </div>\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Deal Value\"\r\n                name=\"value\"\r\n                rules={[\r\n                  { required: saleItems.length === 0, message: 'Deal value is required' },\r\n                  { type: 'number', message: 'Please enter a valid number' }\r\n                ]}\r\n                tooltip={saleItems.length > 0 ? `Auto-calculated: $${calculateTotalFromItems.toFixed(2)}` : 'Enter deal value'}\r\n              >\r\n                <InputNumber\r\n                  size=\"large\"\r\n                  min={0}\r\n                  disabled={saleItems.length > 0}\r\n                  placeholder={saleItems.length > 0 ? `$${calculateTotalFromItems.toFixed(2)}` : 'Enter value'}\r\n                  formatter={(value) => `$ ${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\r\n                  parser={(value) => {\r\n                    const num = parseInt(value?.replace(/\\$\\s?|(,*)/g, '') || '0');\r\n                    return isNaN(num) ? 0 : num;\r\n                  }}\r\n                  style={{ width: '100%' }}\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Win Probability (%)\"\r\n                name=\"probability\"\r\n                initialValue={50}\r\n                rules={[{ type: 'number', message: 'Please enter 0-100' }]}\r\n                tooltip=\"Probability of closing this deal successfully\"\r\n              >\r\n                <InputNumber \r\n                  size=\"large\"\r\n                  min={0} \r\n                  max={100} \r\n                  style={{ width: '100%' }}\r\n                  placeholder=\"50\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* üõí Products/Services */}\r\n        <Card style={sectionCardStyle}>\r\n          <div style={sectionHeaderStyle}>\r\n            <ShoppingCartOutlined style={iconStyle} />\r\n            Products & Services\r\n          </div>\r\n          \r\n          <div style={{ marginBottom: 16 }}>\r\n            <label style={{ display: 'block', marginBottom: 8, fontWeight: 500, color: '#374151' }}>\r\n              Add Products to Deal\r\n            </label>\r\n            <div style={{ display: 'flex', gap: 8 }}>\r\n              <Select\r\n                size=\"large\"\r\n                placeholder=\"Search product by name or SKU...\"\r\n                style={{ flex: 1 }}\r\n                loading={loadingProducts}\r\n                value={selectedProductId}\r\n                onChange={setSelectedProductId}\r\n                optionLabelProp=\"label\"\r\n                filterOption={(input, option) =>\r\n                  (option?.label as string)?.toLowerCase().includes(input.toLowerCase())\r\n                }\r\n                allowClear\r\n              >\r\n                {products.map(product => (\r\n                  <Select.Option\r\n                    key={product.id}\r\n                    value={product.id}\r\n                    label={`${product.name} (${product.sku})`}\r\n                  >\r\n                    <div>\r\n                      <div style={{ fontWeight: 500 }}>{product.name}</div>\r\n                      <div style={{ fontSize: '12px', color: '#999' }}>\r\n                        SKU: {product.sku} ‚Ä¢ ${product.price?.toFixed(2)}\r\n                      </div>\r\n                    </div>\r\n                  </Select.Option>\r\n                ))}\r\n              </Select>\r\n              <Button\r\n                type=\"primary\"\r\n                size=\"large\"\r\n                icon={<PlusOutlined />}\r\n                onClick={handleAddProduct}\r\n              >\r\n                Add\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {saleItems.length > 0 ? (\r\n            <div style={{ overflowX: 'auto' }}>\r\n              <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: 12 }}>\r\n                <thead>\r\n                  <tr style={{ backgroundColor: '#fafafa', borderBottom: '2px solid #e5e7eb' }}>\r\n                    <th style={{ padding: '10px 8px', textAlign: 'left', fontWeight: 600, color: '#374151' }}>Product</th>\r\n                    <th style={{ padding: '10px 8px', textAlign: 'center', width: '60px', fontWeight: 600, color: '#374151' }}>Qty</th>\r\n                    <th style={{ padding: '10px 8px', textAlign: 'right', width: '80px', fontWeight: 600, color: '#374151' }}>Price</th>\r\n                    <th style={{ padding: '10px 8px', textAlign: 'right', width: '80px', fontWeight: 600, color: '#374151' }}>Discount</th>\r\n                    <th style={{ padding: '10px 8px', textAlign: 'right', width: '80px', fontWeight: 600, color: '#374151' }}>Total</th>\r\n                    <th style={{ padding: '10px 8px', textAlign: 'center', width: '40px' }}></th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {saleItems.map((item, index) => (\r\n                    <tr key={item.id} style={{ borderBottom: '1px solid #f0f0f0' }}>\r\n                      <td style={{ padding: '10px 8px' }}>\r\n                        <div style={{ fontWeight: 500, color: '#1f2937' }}>{item.product_name}</div>\r\n                        {item.product_description && (\r\n                          <div style={{ fontSize: '11px', color: '#9ca3af', marginTop: 2 }}>\r\n                            {item.product_description}\r\n                          </div>\r\n                        )}\r\n                      </td>\r\n                      <td style={{ padding: '10px 8px', textAlign: 'center' }}>\r\n                        <InputNumber\r\n                          min={1}\r\n                          value={item.quantity}\r\n                          onChange={(val) => handleUpdateItemQuantity(item.id, val || 1)}\r\n                          size=\"small\"\r\n                          style={{ width: '50px' }}\r\n                        />\r\n                      </td>\r\n                      <td style={{ padding: '10px 8px', textAlign: 'right', color: '#6b7280' }}>\r\n                        ${item.unit_price.toFixed(2)}\r\n                      </td>\r\n                      <td style={{ padding: '10px 8px', textAlign: 'right' }}>\r\n                        <InputNumber\r\n                          min={0}\r\n                          value={item.discount}\r\n                          onChange={(val) => handleUpdateItemDiscount(item.id, val || 0)}\r\n                          size=\"small\"\r\n                          style={{ width: '70px' }}\r\n                        />\r\n                      </td>\r\n                      <td style={{ padding: '10px 8px', textAlign: 'right', fontWeight: 600, color: '#1f2937' }}>\r\n                        ${item.line_total.toFixed(2)}\r\n                      </td>\r\n                      <td style={{ padding: '10px 8px', textAlign: 'center' }}>\r\n                        <Button\r\n                          type=\"text\"\r\n                          danger\r\n                          size=\"small\"\r\n                          icon={<DeleteIcon />}\r\n                          onClick={() => handleRemoveItem(item.id)}\r\n                        />\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                  <tr style={{ backgroundColor: '#fafafa', fontWeight: 600, borderTop: '2px solid #e5e7eb' }}>\r\n                    <td colSpan={4} style={{ padding: '10px 8px', textAlign: 'right', color: '#1f2937' }}>\r\n                      Total Deal Value:\r\n                    </td>\r\n                    <td style={{ padding: '10px 8px', textAlign: 'right', color: '#0ea5e9' }}>\r\n                      ${calculateTotalFromItems.toFixed(2)}\r\n                    </td>\r\n                    <td></td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ) : (\r\n            <Alert\r\n              message=\"‚ÑπÔ∏è No products added yet\"\r\n              description=\"Add products to this deal or enter a manual deal value below\"\r\n              type=\"info\"\r\n              showIcon\r\n            />\r\n          )}\r\n        </Card>\r\n\r\n        {/* üìÖ Pipeline & Timeline */}\r\n        <Card style={sectionCardStyle}>\r\n          <div style={sectionHeaderStyle}>\r\n            <RadarChartOutlined style={iconStyle} />\r\n            Sales Pipeline & Timeline\r\n          </div>\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Deal Stage\"\r\n                name=\"stage\"\r\n                initialValue=\"lead\"\r\n                rules={[{ required: true, message: 'Stage is required' }]}\r\n                tooltip=\"Select the current stage in your sales pipeline\"\r\n              >\r\n                <Select size=\"large\" loading={loadingStages} placeholder=\"Select stage\" allowClear>\r\n                  {stages\r\n                    .filter((stage: any) => stage && stage.id)\r\n                    .map((stage: any) => {\r\n                      const config = stageConfig[stage.id?.toLowerCase()] || { emoji: 'üìå', label: stage.name };\r\n                      return (\r\n                        <Select.Option key={stage.id} value={stage.id}>\r\n                          <span>{config.emoji} {stage.name || stage.id}</span>\r\n                        </Select.Option>\r\n                      );\r\n                    })}\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Expected Close Date\"\r\n                name=\"expected_close_date\"\r\n                tooltip=\"When do you expect to close this deal?\"\r\n              >\r\n                <DatePicker size=\"large\" style={{ width: '100%' }} />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Actual Close Date\"\r\n                name=\"actual_close_date\"\r\n                tooltip=\"When the deal was actually closed (if applicable)\"\r\n              >\r\n                <DatePicker size=\"large\" style={{ width: '100%' }} />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Deal Status\"\r\n                name=\"status\"\r\n                tooltip=\"Current status of the deal\"\r\n              >\r\n                <Select size=\"large\" placeholder=\"Select status\" allowClear>\r\n                  {Object.entries(statusConfig).map(([key, config]) => (\r\n                    <Select.Option key={key} value={key}>\r\n                      <span>{config.emoji} {config.label}</span>\r\n                    </Select.Option>\r\n                  ))}\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* üéØ Campaign & Source */}\r\n        <Card style={sectionCardStyle}>\r\n          <div style={sectionHeaderStyle}>\r\n            <BgColorsOutlined style={iconStyle} />\r\n            Campaign & Source Information\r\n          </div>\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Lead Source\"\r\n                name=\"source\"\r\n                tooltip=\"Where did this lead/opportunity come from?\"\r\n              >\r\n                <Select size=\"large\" placeholder=\"Select source\" allowClear>\r\n                  {Object.entries(sourceConfig).map(([key, config]) => (\r\n                    <Select.Option key={key} value={key}>\r\n                      <span>{config.emoji} {config.label}</span>\r\n                    </Select.Option>\r\n                  ))}\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Campaign Name\"\r\n                name=\"campaign\"\r\n                rules={[{ max: 100, message: 'Campaign name cannot exceed 100 characters' }]}\r\n                tooltip=\"Name of the marketing or sales campaign\"\r\n              >\r\n                <Input \r\n                  size=\"large\"\r\n                  placeholder=\"e.g., Q1 Enterprise Outreach\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* üìù Tags & Notes */}\r\n        <Card style={sectionCardStyle}>\r\n          <div style={sectionHeaderStyle}>\r\n            <CheckCircleOutlined style={iconStyle} />\r\n            Tags & Additional Notes\r\n          </div>\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Tags\"\r\n                name=\"tags\"\r\n                tooltip=\"Add comma-separated tags for easy filtering\"\r\n              >\r\n                <Input \r\n                  size=\"large\"\r\n                  placeholder=\"e.g., urgent, vip, enterprise\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Assigned To\"\r\n                name=\"assigned_to\"\r\n                tooltip=\"Sales representative responsible for this deal\"\r\n              >\r\n                <Select size=\"large\" placeholder=\"Select team member\" allowClear>\r\n                  {/* TODO: Load from user service */}\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n          <Row gutter={16}>\r\n            <Col xs={24}>\r\n              <Form.Item\r\n                label=\"Internal Notes\"\r\n                name=\"notes\"\r\n                rules={[{ max: 1000, message: 'Notes cannot exceed 1000 characters' }]}\r\n              >\r\n                <Input.TextArea\r\n                  size=\"large\"\r\n                  placeholder=\"Add private notes visible only to your team...\"\r\n                  rows={3}\r\n                  showCount\r\n                  maxLength={1000}\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24}>\r\n              <Form.Item\r\n                label=\"Deal Description\"\r\n                name=\"description\"\r\n                rules={[{ max: 2000, message: 'Description cannot exceed 2000 characters' }]}\r\n              >\r\n                <Input.TextArea\r\n                  size=\"large\"\r\n                  placeholder=\"Provide detailed information about this deal...\"\r\n                  rows={4}\r\n                  showCount\r\n                  maxLength={2000}\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n      </Form>\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\components\\SalesList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\hooks\\useSales.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":15,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":15,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sales Routes\r\n * Route definitions for the sales module\r\n */\r\n\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components for code splitting\r\nconst SalesPage = lazy(() => import('./views/SalesPage').then(m => ({ default: m.SalesPage })));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading sales...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const salesRoutes: RouteObject[] = [\r\n  {\r\n    path: 'sales',\r\n    element: (\r\n      <RouteWrapper>\r\n        <SalesPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];\r\n\r\nexport default salesRoutes;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\services\\salesService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":402,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11718,11721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11718,11721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sales Service (Module-level)\r\n * Business logic for sales and deals management\r\n * \r\n * ‚ö†Ô∏è IMPORTANT DISTINCTION: This is the SALES MODULE (deals/opportunities)\r\n * NOT the Product Sales module (/src/modules/features/product-sales/)\r\n * These are completely separate modules with different data models.\r\n * \r\n * ARCHITECTURE:\r\n * This service delegates all core operations to the Service Factory pattern,\r\n * which provides automatic switching between mock (development) and Supabase \r\n * (production) backends based on VITE_API_MODE environment variable.\r\n * \r\n * MULTI-BACKEND ROUTING:\r\n * - VITE_API_MODE=mock    ‚Üí Mock service (src/services/salesService.ts)\r\n * - VITE_API_MODE=supabase ‚Üí Supabase service (src/services/supabase/salesService.ts)\r\n * \r\n * This ensures:\r\n * ‚úÖ Single backend routing point via serviceFactory\r\n * ‚úÖ Proper multi-tenant context maintained throughout stack\r\n * ‚úÖ Eliminates \"Unauthorized\" errors from mixed backend imports\r\n * ‚úÖ All module services follow consistent pattern\r\n * \r\n * @see /src/services/serviceFactory.ts - Central router for backend switching\r\n * @see /src/modules/features/contracts/services/contractService.ts - Reference implementation (Phase 4)\r\n */\r\n\r\nimport { BaseService } from '@/modules/core/services/BaseService';\r\nimport { Deal } from '@/types/crm';\r\nimport { PaginatedResponse } from '@/modules/core/types';\r\nimport { salesService as factorySalesService } from '@/services/serviceFactory';\r\n\r\nexport interface SalesFilters {\r\n  search?: string;\r\n  stage?: string;\r\n  assignedTo?: string;\r\n  dateRange?: {\r\n    start: string;\r\n    end: string;\r\n  };\r\n  minValue?: number;\r\n  maxValue?: number;\r\n  page?: number;\r\n  pageSize?: number;\r\n}\r\n\r\nexport interface CreateDealData {\r\n  title: string;\r\n  description?: string;\r\n  value: number;\r\n  stage: string;\r\n  customer_id: string;\r\n  assigned_to?: string;\r\n  expected_close_date?: string;\r\n  probability?: number;\r\n  source?: string;\r\n  tags?: string[];\r\n}\r\n\r\n// Phase 3.1: Customer validation interface\r\nexport interface CustomerValidationResult {\r\n  isValid: boolean;\r\n  errors: string[];\r\n  warnings?: string[];\r\n}\r\n\r\nexport interface DealStats {\r\n  total: number;\r\n  totalValue: number;\r\n  byStage: Record<string, number>;\r\n  byStageValue: Record<string, number>;\r\n  conversionRate: number;\r\n  averageDealSize: number;\r\n  averageSalesCycle: number;\r\n  monthlyTrend: Array<{\r\n    month: string;\r\n    deals: number;\r\n    value: number;\r\n  }>;\r\n}\r\n\r\nexport class SalesService extends BaseService {\r\n  /**\r\n   * Get deals with filtering and pagination\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async getDeals(filters: SalesFilters = {}): Promise<PaginatedResponse<Deal>> {\r\n    return factorySalesService.getDeals(filters);\r\n  }\r\n\r\n  /**\r\n   * Get a single deal by ID\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async getDeal(id: string): Promise<Deal> {\r\n    return factorySalesService.getDeal(id);\r\n  }\r\n\r\n  /**\r\n   * Create a new deal\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async createDeal(data: CreateDealData): Promise<Deal> {\r\n    return factorySalesService.createDeal(data);\r\n  }\r\n\r\n  /**\r\n   * Update an existing deal\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async updateDeal(id: string, data: Partial<CreateDealData>): Promise<Deal> {\r\n    return factorySalesService.updateDeal(id, data);\r\n  }\r\n\r\n  /**\r\n   * Delete a deal\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async deleteDeal(id: string): Promise<void> {\r\n    return factorySalesService.deleteDeal(id);\r\n  }\r\n\r\n  /**\r\n   * Update deal stage\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async updateDealStage(id: string, stage: string): Promise<Deal> {\r\n    return factorySalesService.updateDealStage(id, stage);\r\n  }\r\n\r\n  /**\r\n   * Bulk update deals\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async bulkUpdateDeals(ids: string[], updates: Partial<CreateDealData>): Promise<Deal[]> {\r\n    return factorySalesService.bulkUpdateDeals(ids, updates);\r\n  }\r\n\r\n  /**\r\n   * Bulk delete deals\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async bulkDeleteDeals(ids: string[]): Promise<void> {\r\n    return factorySalesService.bulkDeleteDeals(ids);\r\n  }\r\n\r\n  /**\r\n   * Get sales statistics\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async getSalesStats(): Promise<DealStats> {\r\n    return factorySalesService.getSalesStats();\r\n  }\r\n\r\n  /**\r\n   * Get deals by customer ID\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async getDealsByCustomer(\r\n    customerId: string,\r\n    filters: SalesFilters = {}\r\n  ): Promise<PaginatedResponse<Deal>> {\r\n    return factorySalesService.getDealsByCustomer(customerId, filters);\r\n  }\r\n\r\n  /**\r\n   * Search deals\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async searchDeals(query: string): Promise<Deal[]> {\r\n    return factorySalesService.searchDeals(query);\r\n  }\r\n\r\n  /**\r\n   * Get deal stages\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async getDealStages(): Promise<Array<{ id: string; name: string }>> {\r\n    return factorySalesService.getDealStages();\r\n  }\r\n\r\n  /**\r\n   * Export deals\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async exportDeals(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    return factorySalesService.exportDeals(format);\r\n  }\r\n\r\n  /**\r\n   * Import deals from CSV\r\n   * Delegates to factory-routed backend service\r\n   */\r\n  async importDeals(csv: string): Promise<{ success: number; errors: string[] }> {\r\n    return factorySalesService.importDeals(csv);\r\n  }\r\n\r\n  /**\r\n   * Phase 3.1: Validate customer relationship for a deal\r\n   * Validates that customer exists and is active\r\n   */\r\n  async validateCustomerRelationship(\r\n    customerId: string\r\n  ): Promise<CustomerValidationResult> {\r\n    try {\r\n      const errors: string[] = [];\r\n      const warnings: string[] = [];\r\n\r\n      // Check if customer_id is provided\r\n      if (!customerId || customerId.trim() === '') {\r\n        errors.push('Customer ID is required');\r\n        return { isValid: false, errors };\r\n      }\r\n\r\n      // In production, would fetch from customer service and validate:\r\n      // - Customer exists\r\n      // - Customer is not deleted\r\n      // - Customer is active/not suspended\r\n      // - Tenant access control\r\n\r\n      return {\r\n        isValid: errors.length === 0,\r\n        errors,\r\n        warnings: warnings.length > 0 ? warnings : undefined,\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to validate customer relationship:', error);\r\n      return {\r\n        isValid: false,\r\n        errors: ['Failed to validate customer relationship'],\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3.1: Get deals by customer with relationship details\r\n   */\r\n  async getDealsByCustomerWithDetails(\r\n    customerId: string,\r\n    filters: SalesFilters = {}\r\n  ): Promise<PaginatedResponse<Deal>> {\r\n    try {\r\n      return await this.getDealsByCustomer(customerId, filters);\r\n    } catch (error) {\r\n      console.error(`Failed to fetch deals for customer ${customerId}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3.2: Get deals filtered by product ID\r\n   * Returns all deals that include a specific product\r\n   */\r\n  async getDealsByProductId(\r\n    productId: string,\r\n    filters: SalesFilters = {}\r\n  ): Promise<PaginatedResponse<Deal>> {\r\n    try {\r\n      // Get all deals and filter by product\r\n      const deals = await this.getDeals(filters);\r\n      \r\n      const filteredDeals = deals.data.filter(deal => \r\n        deal.items && deal.items.some(item => item.product_id === productId)\r\n      );\r\n\r\n      return {\r\n        ...deals,\r\n        data: filteredDeals,\r\n        total: filteredDeals.length,\r\n      };\r\n    } catch (error) {\r\n      console.error(`Failed to fetch deals for product ${productId}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3.2: Get product breakdown and analytics for a deal\r\n   * Returns detailed product contribution to deal value\r\n   */\r\n  async getProductBreakdownForDeal(\r\n    dealId: string\r\n  ): Promise<{\r\n    products: Array<{\r\n      productId: string;\r\n      productName: string;\r\n      quantity: number;\r\n      unitPrice: number;\r\n      discount: number;\r\n      lineTotal: number;\r\n      percentage: number;\r\n    }>;\r\n    totalValue: number;\r\n    itemCount: number;\r\n  }> {\r\n    try {\r\n      const deal = await this.getDeal(dealId);\r\n      \r\n      if (!deal.items || deal.items.length === 0) {\r\n        return {\r\n          products: [],\r\n          totalValue: 0,\r\n          itemCount: 0,\r\n        };\r\n      }\r\n\r\n      const totalValue = deal.items.reduce((sum, item) => sum + item.line_total, 0);\r\n      \r\n      const products = deal.items.map(item => ({\r\n        productId: item.product_id || '',\r\n        productName: item.product_name,\r\n        quantity: item.quantity,\r\n        unitPrice: item.unit_price,\r\n        discount: item.discount,\r\n        lineTotal: item.line_total,\r\n        percentage: totalValue > 0 ? (item.line_total / totalValue) * 100 : 0,\r\n      }));\r\n\r\n      return {\r\n        products,\r\n        totalValue,\r\n        itemCount: deal.items.length,\r\n      };\r\n    } catch (error) {\r\n      console.error(`Failed to get product breakdown for deal ${dealId}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3.2: Get all products used across deals with aggregated stats\r\n   * Returns product usage frequency and value contribution\r\n   */\r\n  async getProductsUsedInDeals(filters: SalesFilters = {}): Promise<Array<{\r\n    productId: string;\r\n    productName: string;\r\n    usageCount: number;\r\n    totalValue: number;\r\n    averageQuantity: number;\r\n  }>> {\r\n    try {\r\n      const deals = await this.getDeals(filters);\r\n      const productStats = new Map<string, {\r\n        productId: string;\r\n        productName: string;\r\n        usageCount: number;\r\n        totalValue: number;\r\n        totalQuantity: number;\r\n      }>();\r\n\r\n      // Aggregate product data across all deals\r\n      deals.data.forEach(deal => {\r\n        if (deal.items) {\r\n          deal.items.forEach(item => {\r\n            const key = item.product_id || item.product_name;\r\n            const existing = productStats.get(key) || {\r\n              productId: item.product_id || '',\r\n              productName: item.product_name,\r\n              usageCount: 0,\r\n              totalValue: 0,\r\n              totalQuantity: 0,\r\n            };\r\n\r\n            productStats.set(key, {\r\n              ...existing,\r\n              usageCount: existing.usageCount + 1,\r\n              totalValue: existing.totalValue + item.line_total,\r\n              totalQuantity: existing.totalQuantity + item.quantity,\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      // Convert to array and calculate averages\r\n      return Array.from(productStats.values()).map(stat => ({\r\n        productId: stat.productId,\r\n        productName: stat.productName,\r\n        usageCount: stat.usageCount,\r\n        totalValue: stat.totalValue,\r\n        averageQuantity: stat.totalQuantity / stat.usageCount,\r\n      }));\r\n    } catch (error) {\r\n      console.error('Failed to get products used in deals:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3.3: Get contracts linked to a deal\r\n   * Returns all contracts that were created from this deal\r\n   */\r\n  async getContractsForDeal(dealId: string): Promise<Array<{\r\n    id: string;\r\n    title: string;\r\n    status: string;\r\n    value: number;\r\n    created_at: string;\r\n  }>> {\r\n    try {\r\n      // Get all contracts via legacy service\r\n      const contracts = await legacySalesService.getContractsForDeal?.(dealId) || [];\r\n      return contracts.map((contract: any) => ({\r\n        id: contract.id,\r\n        title: contract.title,\r\n        status: contract.status,\r\n        value: contract.value || contract.total_value,\r\n        created_at: contract.created_at,\r\n      }));\r\n    } catch (error) {\r\n      console.error(`Failed to get contracts for deal ${dealId}:`, error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3.3: Prepare contract data from deal for conversion\r\n   * Pre-fills contract form with deal information\r\n   */\r\n  async prepareContractFromDeal(dealId: string): Promise<{\r\n    title: string;\r\n    description?: string;\r\n    customer_id: string;\r\n    customer_name?: string;\r\n    value: number;\r\n    currency: string;\r\n    start_date: string;\r\n    end_date?: string;\r\n    assigned_to?: string;\r\n    notes?: string;\r\n    deal_id: string;\r\n    deal_title?: string;\r\n  }> {\r\n    try {\r\n      const deal = await this.getDeal(dealId);\r\n      if (!deal) {\r\n        throw new Error('Deal not found');\r\n      }\r\n\r\n      // Calculate contract end date (30 days from today)\r\n      const startDate = new Date();\r\n      const endDate = new Date();\r\n      endDate.setDate(endDate.getDate() + 30);\r\n\r\n      return {\r\n        title: `Contract from: ${deal.title}`,\r\n        description: deal.description,\r\n        customer_id: deal.customer_id,\r\n        customer_name: deal.customer_name,\r\n        value: deal.value,\r\n        currency: deal.currency || 'USD',\r\n        start_date: startDate.toISOString().split('T')[0],\r\n        end_date: endDate.toISOString().split('T')[0],\r\n        assigned_to: deal.assigned_to,\r\n        notes: deal.notes ? `Converted from deal: ${deal.notes}` : 'Converted from sales deal',\r\n        deal_id: dealId,\r\n        deal_title: deal.title,\r\n      };\r\n    } catch (error) {\r\n      console.error(`Failed to prepare contract from deal ${dealId}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 3.3: Check if deal can be converted to contract\r\n   * Validates that deal is in closed_won state and has valid customer\r\n   */\r\n  async validateDealForConversion(dealId: string): Promise<{\r\n    isValid: boolean;\r\n    errors: string[];\r\n  }> {\r\n    try {\r\n      const deal = await this.getDeal(dealId);\r\n      const errors: string[] = [];\r\n\r\n      if (!deal) {\r\n        errors.push('Deal not found');\r\n      } else {\r\n        if (deal.stage !== 'closed_won') {\r\n          errors.push('Only closed-won deals can be converted to contracts');\r\n        }\r\n        if (!deal.customer_id) {\r\n          errors.push('Deal must have a customer assigned');\r\n        }\r\n        if (deal.value <= 0) {\r\n          errors.push('Deal value must be greater than zero');\r\n        }\r\n      }\r\n\r\n      return {\r\n        isValid: errors.length === 0,\r\n        errors,\r\n      };\r\n    } catch (error) {\r\n      console.error(`Failed to validate deal ${dealId} for conversion:`, error);\r\n      return {\r\n        isValid: false,\r\n        errors: [(error as Error).message || 'Validation failed'],\r\n      };\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\store\\salesStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\sales\\views\\SalesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\service-contracts\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\service-contracts\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":13,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":13,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Contracts Routes\r\n */\r\nimport React, { lazy } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\n\r\n// Lazy load components\r\nconst ServiceContractsPage = lazy(() => import('./views/ServiceContractsPage'));\r\nconst ServiceContractDetailPage = lazy(() => import('./views/ServiceContractDetailPage'));\r\n\r\n// Route wrapper with error boundary\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      {children}\r\n    </React.Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const serviceContractsRoutes: RouteObject[] = [\r\n  {\r\n    path: 'service-contracts',\r\n    children: [\r\n      {\r\n        index: true,\r\n        element: (\r\n          <RouteWrapper>\r\n            <ServiceContractsPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: ':id',\r\n        element: (\r\n          <RouteWrapper>\r\n            <ServiceContractDetailPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\service-contracts\\views\\ServiceContractDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2340,2343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2340,2343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5091,5094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5091,5094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5416,5419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5416,5419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5570,5573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5570,5573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6321,6324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6321,6324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":251,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7168,7171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7168,7171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9748,9751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9748,9751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Contract Detail Page\r\n * Comprehensive view of service contract with timeline, renewal tracking, and billing\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport {\r\n  Card,\r\n  Descriptions,\r\n  Button,\r\n  Space,\r\n  Tag,\r\n  Timeline,\r\n  List,\r\n  Modal,\r\n  Form,\r\n  Input,\r\n  Select,\r\n  DatePicker,\r\n  InputNumber,\r\n  message,\r\n  Row,\r\n  Col,\r\n  Statistic,\r\n  Progress,\r\n  Dropdown,\r\n  Menu,\r\n  Typography,\r\n  Alert,\r\n  Divider,\r\n  Tabs,\r\n  Skeleton,\r\n  Empty,\r\n  Tooltip,\r\n  Badge,\r\n} from 'antd';\r\nimport {\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  MoreOutlined,\r\n  ClockCircleOutlined,\r\n  DollarOutlined,\r\n  FileTextOutlined,\r\n  CheckCircleOutlined,\r\n  WarningOutlined,\r\n  CalendarOutlined,\r\n  UserOutlined,\r\n  DownloadOutlined,\r\n  MailOutlined,\r\n  ReloadOutlined,\r\n  CopyOutlined,\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { PageHeader } from '@/components/common';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { ServiceContract } from '@/types/productSales';\r\n\r\nconst { TextArea } = Input;\r\nconst { Title, Text } = Typography;\r\n\r\ninterface ContractActivity {\r\n  id: string;\r\n  type: 'created' | 'renewed' | 'modified' | 'payment' | 'note' | 'cancelled';\r\n  title: string;\r\n  description: string;\r\n  timestamp: string;\r\n  user: string;\r\n}\r\n\r\ninterface EditContractValues {\r\n  service_level?: 'basic' | 'standard' | 'premium' | 'enterprise';\r\n  auto_renewal?: boolean;\r\n  renewal_notice_period?: number;\r\n  terms?: string;\r\n}\r\n\r\ninterface RenewContractValues {\r\n  renewal_period: string;\r\n  new_end_date?: string;\r\n  service_level?: 'basic' | 'standard' | 'premium' | 'enterprise';\r\n  auto_renewal?: boolean;\r\n}\r\n\r\ninterface AddNoteValues {\r\n  note: string;\r\n}\r\n\r\ninterface Invoice {\r\n  id: string;\r\n  invoice_number: string;\r\n  amount: number;\r\n  due_date: string;\r\n  paid_date?: string;\r\n  status: 'paid' | 'pending' | 'overdue';\r\n}\r\n\r\nexport const ServiceContractDetailPage: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { hasPermission } = useAuth();\r\n\r\n  // ‚úÖ Get service from module service container (standardized pattern)\r\n  const serviceContractService = useService<any>('serviceContractService');\r\n\r\n  const [contract, setContract] = useState<ServiceContract | null>(null);\r\n  const [activities, setActivities] = useState<ContractActivity[]>([]);\r\n  const [invoices, setInvoices] = useState<Invoice[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [editModalVisible, setEditModalVisible] = useState(false);\r\n  const [renewModalVisible, setRenewModalVisible] = useState(false);\r\n  const [noteModalVisible, setNoteModalVisible] = useState(false);\r\n  const [form] = Form.useForm();\r\n  const [renewForm] = Form.useForm();\r\n  const [noteForm] = Form.useForm();\r\n\r\n  // Reset forms when modals close to prevent stale instances\r\n  const handleEditModalClose = () => {\r\n    form.resetFields();\r\n    setEditModalVisible(false);\r\n  };\r\n\r\n  const handleRenewModalClose = () => {\r\n    renewForm.resetFields();\r\n    setRenewModalVisible(false);\r\n  };\r\n\r\n  const handleNoteModalClose = () => {\r\n    noteForm.resetFields();\r\n    setNoteModalVisible(false);\r\n  };\r\n\r\n   \r\n  const loadContractDetails = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      if (!id) {\r\n        throw new Error('Contract ID is required');\r\n      }\r\n\r\n      // Fetch contract from service\r\n      const contractData = await serviceContractService.getServiceContract(id);\r\n\r\n      // Create activities timeline\r\n      const mockActivities: ContractActivity[] = [\r\n        {\r\n          id: '1',\r\n          type: 'created',\r\n          title: 'Contract Created',\r\n          description: `Service contract ${contractData.contract_number} was created`,\r\n          timestamp: contractData.created_at,\r\n          user: contractData.created_by,\r\n        },\r\n      ];\r\n\r\n      // Generate mock invoices (monthly breakdown)\r\n      const mockInvoices: Invoice[] = [];\r\n      const monthlyValue = contractData.annual_value / 12;\r\n      const startDate = dayjs(contractData.start_date);\r\n      const endDate = dayjs(contractData.end_date);\r\n\r\n      let currentDate = startDate;\r\n      let invoiceCount = 1;\r\n      while (currentDate.isBefore(endDate)) {\r\n        const dueDate = currentDate.add(1, 'month').subtract(1, 'day');\r\n        const invoiceId = invoiceCount;\r\n        \r\n        mockInvoices.push({\r\n          id: `inv-${invoiceId}`,\r\n          invoice_number: `INV-${dayjs().format('YYYY')}-${String(invoiceId).padStart(3, '0')}`,\r\n          amount: monthlyValue,\r\n          due_date: dueDate.format('YYYY-MM-DD'),\r\n          status: dueDate.isBefore(dayjs()) ? 'paid' : 'pending',\r\n          paid_date: dueDate.isBefore(dayjs()) ? dueDate.format('YYYY-MM-DD') : undefined,\r\n        });\r\n\r\n        currentDate = currentDate.add(1, 'month');\r\n        invoiceCount++;\r\n      }\r\n\r\n      setContract(contractData as unknown as any);\r\n      setActivities(mockActivities);\r\n      setInvoices(mockInvoices);\r\n      form.setFieldsValue({\r\n        service_level: contractData.service_level,\r\n        auto_renewal: contractData.auto_renewal,\r\n        renewal_notice_period: contractData.renewal_notice_period,\r\n        terms: contractData.terms,\r\n      } as any);\r\n      renewForm.setFieldsValue({\r\n        service_level: contractData.service_level,\r\n        auto_renewal: contractData.auto_renewal,\r\n      } as any);\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        message.error('Failed to load contract details');\r\n        console.error('Error loading contract:', error.message);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [id, form, renewForm, serviceContractService]);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      loadContractDetails();\r\n    }\r\n  }, [id, loadContractDetails]);\r\n\r\n  const handleEdit = async (values: EditContractValues) => {\r\n    try {\r\n      if (!contract?.id) {\r\n        throw new Error('Contract ID is required');\r\n      }\r\n\r\n      const updatedContract = await serviceContractService.updateServiceContract(\r\n        contract.id,\r\n        values\r\n      );\r\n\r\n      setContract(updatedContract as any);\r\n      form.resetFields();\r\n      setEditModalVisible(false);\r\n      message.success('Contract updated successfully');\r\n\r\n      // Add activity\r\n      const newActivity: ContractActivity = {\r\n        id: Date.now().toString(),\r\n        type: 'modified',\r\n        title: 'Contract Modified',\r\n        description: 'Contract details were updated',\r\n        timestamp: new Date().toISOString(),\r\n        user: 'Current User',\r\n      };\r\n      setActivities([newActivity, ...activities]);\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        message.error(`Failed to update contract: ${error.message}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleRenew = async (values: RenewContractValues) => {\r\n    try {\r\n      if (!contract?.id) {\r\n        throw new Error('Contract ID is required');\r\n      }\r\n\r\n      const renewalData: Partial<any> = {\r\n        auto_renewal: values.auto_renewal,\r\n        service_level: values.service_level,\r\n      };\r\n\r\n      const renewedContract = await serviceContractService.renewServiceContract(\r\n        contract.id,\r\n        renewalData\r\n      );\r\n\r\n      message.success(`Contract renewed successfully! New contract: ${renewedContract.contract_number}`);\r\n      renewForm.resetFields();\r\n      setRenewModalVisible(false);\r\n\r\n      // Add activity\r\n      const newActivity: ContractActivity = {\r\n        id: Date.now().toString(),\r\n        type: 'renewed',\r\n        title: 'Contract Renewed',\r\n        description: `Contract renewed. New contract: ${renewedContract.contract_number}`,\r\n        timestamp: new Date().toISOString(),\r\n        user: 'Current User',\r\n      };\r\n      setActivities([newActivity, ...activities]);\r\n\r\n      void loadContractDetails();\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        message.error(`Failed to renew contract: ${error.message}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleAddNote = async (values: AddNoteValues) => {\r\n    try {\r\n      // Simulate API call\r\n      await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n      const newActivity: ContractActivity = {\r\n        id: Date.now().toString(),\r\n        type: 'note',\r\n        title: 'Note Added',\r\n        description: values.note,\r\n        timestamp: new Date().toISOString(),\r\n        user: 'Current User',\r\n      };\r\n      setActivities([newActivity, ...activities]);\r\n\r\n      setNoteModalVisible(false);\r\n      noteForm.resetFields();\r\n      message.success('Note added successfully');\r\n    } catch (error) {\r\n      if (error instanceof Error) {\r\n        message.error('Failed to add note');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    Modal.confirm({\r\n      title: 'Cancel Contract',\r\n      content: (\r\n        <>\r\n          <p>Are you sure you want to cancel this contract?</p>\r\n          <p style={{ marginTop: '12px', fontSize: '12px', color: '#666' }}>\r\n            This action will mark the contract as cancelled and cannot be undone. \r\n            Please provide a reason for cancellation.\r\n          </p>\r\n        </>\r\n      ),\r\n      okText: 'Cancel Contract',\r\n      okType: 'danger',\r\n      onOk: async () => {\r\n        const reason = await new Promise<string>((resolve) => {\r\n          Modal.confirm({\r\n            title: 'Cancellation Reason',\r\n            content: (\r\n              <Input.TextArea\r\n                placeholder=\"Enter reason for cancellation\"\r\n                onChange={(e) => {\r\n                  (e.target as any).cancellationReason = e.target.value;\r\n                }}\r\n              />\r\n            ),\r\n            okText: 'Confirm',\r\n            okType: 'danger',\r\n            onOk: () => {\r\n              const input = document.querySelector('textarea[placeholder=\"Enter reason for cancellation\"]') as HTMLTextAreaElement;\r\n              resolve(input?.value || 'No reason provided');\r\n            },\r\n            onCancel: () => {\r\n              resolve('');\r\n            },\r\n          });\r\n        });\r\n\r\n        if (!reason) return;\r\n\r\n        try {\r\n          if (!contract?.id) {\r\n            throw new Error('Contract ID is required');\r\n          }\r\n\r\n          await serviceContractService.cancelServiceContract(\r\n            contract.id,\r\n            reason\r\n          );\r\n\r\n          message.success('Contract cancelled successfully');\r\n\r\n          // Add activity\r\n          const newActivity: ContractActivity = {\r\n            id: Date.now().toString(),\r\n            type: 'cancelled',\r\n            title: 'Contract Cancelled',\r\n            description: `Contract cancelled. Reason: ${reason}`,\r\n            timestamp: new Date().toISOString(),\r\n            user: 'Current User',\r\n          };\r\n          setActivities([newActivity, ...activities]);\r\n\r\n          setTimeout(() => {\r\n            navigate('/tenant/service-contracts');\r\n          }, 1000);\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            message.error(`Failed to cancel contract: ${error.message}`);\r\n          }\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  const handleSendReminder = () => {\r\n    message.success('Renewal reminder sent to customer');\r\n  };\r\n\r\n  const handleDownloadContract = () => {\r\n    message.success('Contract PDF downloaded');\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    const colors: Record<string, string> = {\r\n      active: 'success',\r\n      expired: 'error',\r\n      pending: 'warning',\r\n      cancelled: 'default',\r\n    };\r\n    return colors[status] || 'default';\r\n  };\r\n\r\n  const getActivityIcon = (type: string) => {\r\n    const icons: Record<string, React.ReactNode> = {\r\n      created: <FileTextOutlined style={{ color: '#1890ff' }} />,\r\n      renewed: <CheckCircleOutlined style={{ color: '#52c41a' }} />,\r\n      modified: <EditOutlined style={{ color: '#faad14' }} />,\r\n      payment: <DollarOutlined style={{ color: '#52c41a' }} />,\r\n      note: <FileTextOutlined style={{ color: '#722ed1' }} />,\r\n      cancelled: <WarningOutlined style={{ color: '#ff4d4f' }} />,\r\n    };\r\n    return icons[type] || <ClockCircleOutlined />;\r\n  };\r\n\r\n  const getDaysUntilRenewal = () => {\r\n    if (!contract) return 0;\r\n    return dayjs(contract.renewal_date).diff(dayjs(), 'day');\r\n  };\r\n\r\n  const getContractProgress = () => {\r\n    if (!contract) return 0;\r\n    const total = dayjs(contract.end_date).diff(dayjs(contract.start_date), 'day');\r\n    const elapsed = dayjs().diff(dayjs(contract.start_date), 'day');\r\n    return Math.min(Math.round((elapsed / total) * 100), 100);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div style={{ padding: 24 }}>\r\n        <Skeleton active paragraph={{ rows: 4 }} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!contract) {\r\n    return (\r\n      <div style={{ padding: 24 }}>\r\n        <Empty description=\"Contract not found\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const daysUntilEnd = dayjs(contract.end_date).diff(dayjs(), 'day');\r\n  const contractProgress = getContractProgress();\r\n  const showRenewalAlert = daysUntilEnd <= 30 && daysUntilEnd > 0;\r\n\r\n  const actionMenuItems = [\r\n    {\r\n      key: 'edit',\r\n      icon: <EditOutlined />,\r\n      label: 'Edit Settings',\r\n      onClick: () => setEditModalVisible(true),\r\n    },\r\n    {\r\n      key: 'renew',\r\n      icon: <CheckCircleOutlined />,\r\n      label: 'Renew Contract',\r\n      onClick: () => setRenewModalVisible(true),\r\n    },\r\n    {\r\n      key: 'download',\r\n      icon: <DownloadOutlined />,\r\n      label: 'Download PDF',\r\n      onClick: handleDownloadContract,\r\n    },\r\n    {\r\n      key: 'reminder',\r\n      icon: <MailOutlined />,\r\n      label: 'Send Reminder',\r\n      onClick: handleSendReminder,\r\n    },\r\n    {\r\n      type: 'divider' as const,\r\n    },\r\n    {\r\n      key: 'cancel',\r\n      icon: <DeleteOutlined />,\r\n      label: 'Cancel Contract',\r\n      danger: true,\r\n      onClick: handleDelete,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title={`Contract ${contract.contract_number}`}\r\n        description={contract.customer_name}\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Service Contracts', path: '/tenant/service-contracts' },\r\n            { title: contract.contract_number },\r\n          ],\r\n        }}\r\n        extra={[\r\n          <Button key=\"note\" onClick={() => setNoteModalVisible(true)}>\r\n            Add Note\r\n          </Button>,\r\n          <Button key=\"renew\" onClick={() => setRenewModalVisible(true)}>\r\n            Renew\r\n          </Button>,\r\n          <Button key=\"edit\" type=\"primary\" icon={<EditOutlined />} onClick={() => setEditModalVisible(true)}>\r\n            Edit\r\n          </Button>,\r\n          <Dropdown key=\"more\" menu={{ items: actionMenuItems }} trigger={['click']}>\r\n            <Button icon={<MoreOutlined />} />\r\n          </Dropdown>,\r\n        ]}\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {showRenewalAlert && (\r\n          <Alert\r\n            message=\"Renewal Alert\"\r\n            description={`This contract expires in ${daysUntilEnd} days (${dayjs(contract.end_date).format('YYYY-MM-DD')}). Consider renewing to ensure uninterrupted service.`}\r\n            type=\"warning\"\r\n            showIcon\r\n            icon={<WarningOutlined />}\r\n            action={\r\n              <Button size=\"small\" type=\"primary\" onClick={() => setRenewModalVisible(true)}>\r\n                Renew Now\r\n              </Button>\r\n            }\r\n            style={{ marginBottom: 24 }}\r\n            closable\r\n          />\r\n        )}\r\n\r\n        {contract.status === 'cancelled' && (\r\n          <Alert\r\n            message=\"Contract Cancelled\"\r\n            description=\"This contract has been cancelled and is no longer active.\"\r\n            type=\"error\"\r\n            showIcon\r\n            style={{ marginBottom: 24 }}\r\n            closable\r\n          />\r\n        )}\r\n\r\n        {/* Key Metrics */}\r\n        <Row gutter={16} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <Card>\r\n              <Statistic\r\n                title=\"Contract Value\"\r\n                value={contract.contract_value}\r\n                prefix=\"$\"\r\n                precision={2}\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <Card>\r\n              <Statistic\r\n                title=\"Service Level\"\r\n                value={contract.service_level?.toUpperCase()}\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <Card>\r\n              <Statistic\r\n                title=\"Days Until End\"\r\n                value={daysUntilEnd}\r\n                valueStyle={{ color: daysUntilEnd <= 30 ? '#cf1322' : '#3f8600' }}\r\n              />\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <Card>\r\n              <Statistic\r\n                title=\"Progress\"\r\n                value={contractProgress}\r\n                suffix=\"%\"\r\n              />\r\n              <Progress percent={contractProgress} showInfo={false} size=\"small\" />\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n\r\n        <Row gutter={16}>\r\n          {/* Main Content */}\r\n          <Col xs={24} lg={16}>\r\n            {/* Contract Information Card */}\r\n            <Card title=\"Contract Details\" style={{ marginBottom: 16 }}>\r\n              <Descriptions column={{ xs: 1, sm: 2 }} bordered size=\"small\">\r\n                <Descriptions.Item label=\"Contract Number\">\r\n                  <Space>\r\n                    <span>{contract.contract_number}</span>\r\n                    <Tooltip title=\"Copy to clipboard\">\r\n                      <CopyOutlined \r\n                        style={{ cursor: 'pointer' }} \r\n                        onClick={() => {\r\n                          navigator.clipboard.writeText(contract.contract_number);\r\n                          message.success('Copied!');\r\n                        }}\r\n                      />\r\n                    </Tooltip>\r\n                  </Space>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Status\">\r\n                  <Badge \r\n                    status={contract.status === 'active' ? 'success' : contract.status === 'expired' ? 'error' : 'default'} \r\n                    text={<Tag color={getStatusColor(contract.status)}>{contract.status ? contract.status.toUpperCase() : 'N/A'}</Tag>} \r\n                  />\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Customer\">\r\n                  {contract.customer_name}\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Product\">\r\n                  {contract.product_name}\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Start Date\">\r\n                  <CalendarOutlined /> {dayjs(contract.start_date).format('YYYY-MM-DD')}\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"End Date\">\r\n                  <CalendarOutlined /> {dayjs(contract.end_date).format('YYYY-MM-DD')}\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Warranty Period\">\r\n                  {contract.warranty_period ?? 'N/A'} months\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Annual Value\">\r\n                  <DollarOutlined /> ${contract.annual_value ? contract.annual_value.toFixed(2) : 'N/A'}\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Service Level\">\r\n                  <Tag color=\"blue\">{contract.service_level ?? 'N/A'}</Tag>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Auto-Renewal\">\r\n                  <Tag color={contract.auto_renewal ? 'success' : 'default'}>\r\n                    {contract.auto_renewal ? 'Enabled' : 'Disabled'}\r\n                  </Tag>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Renewal Notice Period\">\r\n                  {contract.renewal_notice_period ?? 'N/A'} days\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Created By\">\r\n                  {contract.created_by ?? 'N/A'} on {dayjs(contract.created_at).format('YYYY-MM-DD')}\r\n                </Descriptions.Item>\r\n              </Descriptions>\r\n            </Card>\r\n\r\n            {/* Terms Card */}\r\n            <Card title=\"Terms & Conditions\" style={{ marginBottom: 16 }}>\r\n              <div style={{ maxHeight: 300, overflowY: 'auto', whiteSpace: 'pre-wrap', wordWrap: 'break-word' }}>\r\n                <Text>{contract.terms ?? 'No terms specified'}</Text>\r\n              </div>\r\n            </Card>\r\n\r\n            {/* Invoices */}\r\n            <Card title={`Invoices (${invoices.length})`} style={{ marginBottom: 16 }}>\r\n              {invoices.length > 0 ? (\r\n                <List\r\n                  dataSource={invoices}\r\n                  renderItem={(invoice) => (\r\n                    <List.Item\r\n                      actions={[\r\n                        <Button type=\"link\" icon={<DownloadOutlined />}>\r\n                          Download\r\n                        </Button>,\r\n                      ]}\r\n                    >\r\n                      <List.Item.Meta\r\n                        title={\r\n                          <Space>\r\n                            <strong>{invoice.invoice_number}</strong>\r\n                            <Tag\r\n                              color={\r\n                                invoice.status === 'paid'\r\n                                  ? 'success'\r\n                                  : invoice.status === 'overdue'\r\n                                  ? 'red'\r\n                                  : 'orange'\r\n                              }\r\n                            >\r\n                              {invoice.status ? invoice.status.toUpperCase() : 'N/A'}\r\n                            </Tag>\r\n                          </Space>\r\n                        }\r\n                        description={\r\n                          <Space direction=\"vertical\" size={0}>\r\n                            <Text>\r\n                              <DollarOutlined /> ${invoice.amount ? invoice.amount.toFixed(2) : 'N/A'}\r\n                            </Text>\r\n                            <Text type=\"secondary\">\r\n                              Due: {dayjs(invoice.due_date).format('YYYY-MM-DD')}\r\n                            </Text>\r\n                            {invoice.paid_date && (\r\n                              <Text type=\"success\">\r\n                                Paid: {dayjs(invoice.paid_date).format('YYYY-MM-DD')}\r\n                              </Text>\r\n                            )}\r\n                          </Space>\r\n                        }\r\n                      />\r\n                    </List.Item>\r\n                  )}\r\n                />\r\n              ) : (\r\n                <Empty description=\"No invoices yet\" />\r\n              )}\r\n            </Card>\r\n          </Col>\r\n\r\n          {/* Sidebar - Activity Timeline */}\r\n          <Col xs={24} lg={8}>\r\n            <Card title=\"Activity Timeline\">\r\n              {activities.length > 0 ? (\r\n                <Timeline\r\n                  items={activities.map((activity) => ({\r\n                    key: activity.id,\r\n                    dot: getActivityIcon(activity.type),\r\n                    children: (\r\n                      <Space direction=\"vertical\" size={2} style={{ width: '100%' }}>\r\n                        <Text strong>{activity.title}</Text>\r\n                        <Text style={{ fontSize: '13px' }}>{activity.description}</Text>\r\n                        <Text type=\"secondary\" style={{ fontSize: '11px' }}>\r\n                          {dayjs(activity.timestamp).format('YYYY-MM-DD HH:mm')} \r\n                          {' by '} <strong>{activity.user}</strong>\r\n                        </Text>\r\n                      </Space>\r\n                    ),\r\n                  }))}\r\n                />\r\n              ) : (\r\n                <Empty description=\"No activities yet\" />\r\n              )}\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Edit Modal */}\r\n        <Modal\r\n          title=\"Edit Contract Settings\"\r\n          open={editModalVisible}\r\n          onCancel={handleEditModalClose}\r\n          onOk={() => form.submit()}\r\n          width={700}\r\n          destroyOnHidden\r\n        >\r\n          <Form form={form} layout=\"vertical\" onFinish={handleEdit}>\r\n            <Row gutter={16}>\r\n              <Col span={12}>\r\n                <Form.Item \r\n                  label=\"Service Level\" \r\n                  name=\"service_level\" \r\n                  rules={[{ required: true, message: 'Please select a service level' }]}\r\n                >\r\n                  <Select placeholder=\"Select service level\">\r\n                    <Select.Option value=\"basic\">Basic</Select.Option>\r\n                    <Select.Option value=\"standard\">Standard</Select.Option>\r\n                    <Select.Option value=\"premium\">Premium</Select.Option>\r\n                    <Select.Option value=\"enterprise\">Enterprise</Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col span={12}>\r\n                <Form.Item \r\n                  label=\"Renewal Notice Period (days)\" \r\n                  name=\"renewal_notice_period\"\r\n                  rules={[{ required: true, message: 'Please enter renewal notice period' }]}\r\n                >\r\n                  <InputNumber min={1} style={{ width: '100%' }} />\r\n                </Form.Item>\r\n              </Col>\r\n              <Col span={24}>\r\n                <Form.Item \r\n                  label=\"Auto-Renewal\" \r\n                  name=\"auto_renewal\" \r\n                  valuePropName=\"checked\"\r\n                >\r\n                  <div>\r\n                    <Select placeholder=\"Select auto-renewal status\">\r\n                      <Select.Option value={true}>Enabled</Select.Option>\r\n                      <Select.Option value={false}>Disabled</Select.Option>\r\n                    </Select>\r\n                  </div>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col span={24}>\r\n                <Form.Item \r\n                  label=\"Terms & Conditions\" \r\n                  name=\"terms\"\r\n                  rules={[{ required: true, message: 'Please enter terms and conditions' }]}\r\n                >\r\n                  <TextArea rows={6} placeholder=\"Enter contract terms and conditions\" />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </Form>\r\n        </Modal>\r\n\r\n        {/* Renew Modal */}\r\n        <Modal\r\n          title=\"Renew Service Contract\"\r\n          open={renewModalVisible}\r\n          onCancel={handleRenewModalClose}\r\n          onOk={() => renewForm.submit()}\r\n          width={700}\r\n          destroyOnHidden\r\n        >\r\n          <Form form={renewForm} layout=\"vertical\" onFinish={handleRenew}>\r\n            <Row gutter={16}>\r\n              <Col span={24}>\r\n                <Alert \r\n                  message=\"Renewal Information\" \r\n                  description={`Current contract ends on ${dayjs(contract?.end_date).format('YYYY-MM-DD')}. A new contract will be created starting from ${dayjs(contract?.end_date).add(1, 'day').format('YYYY-MM-DD')}.`}\r\n                  type=\"info\"\r\n                  showIcon\r\n                  style={{ marginBottom: 16 }}\r\n                />\r\n              </Col>\r\n              <Col span={12}>\r\n                <Form.Item \r\n                  label=\"Renewal Period\" \r\n                  name=\"renewal_period\" \r\n                  rules={[{ required: true, message: 'Please select a renewal period' }]}\r\n                  initialValue=\"1 year\"\r\n                >\r\n                  <Select>\r\n                    <Select.Option value=\"1 year\">1 Year</Select.Option>\r\n                    <Select.Option value=\"2 years\">2 Years</Select.Option>\r\n                    <Select.Option value=\"3 years\">3 Years</Select.Option>\r\n                    <Select.Option value=\"custom\">Custom</Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col span={12}>\r\n                <Form.Item \r\n                  label=\"Service Level\" \r\n                  name=\"service_level\"\r\n                  initialValue={contract?.service_level}\r\n                >\r\n                  <Select>\r\n                    <Select.Option value=\"basic\">Basic</Select.Option>\r\n                    <Select.Option value=\"standard\">Standard</Select.Option>\r\n                    <Select.Option value=\"premium\">Premium</Select.Option>\r\n                    <Select.Option value=\"enterprise\">Enterprise</Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col span={12}>\r\n                <Form.Item \r\n                  label=\"Auto-Renewal\" \r\n                  name=\"auto_renewal\"\r\n                  initialValue={contract?.auto_renewal}\r\n                >\r\n                  <Select placeholder=\"Select auto-renewal status\">\r\n                    <Select.Option value={true}>Enabled</Select.Option>\r\n                    <Select.Option value={false}>Disabled</Select.Option>\r\n                  </Select>\r\n                </Form.Item>\r\n              </Col>\r\n              <Col span={12}>\r\n                <Form.Item \r\n                  label=\"New End Date\" \r\n                  name=\"new_end_date\"\r\n                >\r\n                  <DatePicker />\r\n                </Form.Item>\r\n              </Col>\r\n            </Row>\r\n          </Form>\r\n        </Modal>\r\n\r\n        {/* Add Note Modal */}\r\n        <Modal\r\n          title=\"Add Note\"\r\n          open={noteModalVisible}\r\n          onCancel={handleNoteModalClose}\r\n          onOk={() => noteForm.submit()}\r\n          destroyOnHidden\r\n        >\r\n          <Form form={noteForm} layout=\"vertical\" onFinish={handleAddNote}>\r\n            <Form.Item label=\"Note\" name=\"note\" rules={[{ required: true }]}>\r\n              <TextArea rows={4} placeholder=\"Enter your note here...\" />\r\n            </Form.Item>\r\n          </Form>\r\n        </Modal>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ServiceContractDetailPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\service-contracts\\views\\ServiceContractsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1584,1587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1584,1587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Contracts Page - Enterprise Version\r\n * Redesigned with Ant Design and EnterpriseLayout\r\n */\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Button,\r\n  Space,\r\n  Input,\r\n  Select,\r\n  Tag,\r\n  Row,\r\n  Col,\r\n  Popconfirm,\r\n  Alert,\r\n  Empty,\r\n  Modal,\r\n  message,\r\n  Tooltip,\r\n  Badge\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport {\r\n  PlusOutlined,\r\n  SearchOutlined,\r\n  ReloadOutlined,\r\n  EyeOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  DownloadOutlined,\r\n  FileTextOutlined,\r\n  DollarOutlined,\r\n  CalendarOutlined,\r\n  ClockCircleOutlined,\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  FilterOutlined\r\n} from '@ant-design/icons';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { \r\n  ServiceContract, \r\n  ServiceContractFilters,\r\n  ServiceContractsResponse \r\n} from '@/types/productSales';\r\n\r\nconst { Search } = Input;\r\nconst { Option } = Select;\r\n\r\ninterface ContractStats {\r\n  total: number;\r\n  active: number;\r\n  expiring_soon: number;\r\n  expired: number;\r\n  total_value: number;\r\n}\r\n\r\nexport const ServiceContractsPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const navigate = useNavigate();\r\n\r\n  // ‚úÖ Get service from module service container (standardized pattern)\r\n  const serviceContractService = useService<any>('serviceContractService');\r\n\r\n  // State management\r\n  const [contracts, setContracts] = useState<ServiceContract[]>([]);\r\n  const [stats, setStats] = useState<ContractStats>({\r\n    total: 0,\r\n    active: 0,\r\n    expiring_soon: 0,\r\n    expired: 0,\r\n    total_value: 0\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n\r\n  // Pagination and filtering\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(10);\r\n  const [totalItems, setTotalItems] = useState(0);\r\n  const [filters, setFilters] = useState<ServiceContractFilters>({});\r\n  const [searchText, setSearchText] = useState('');\r\n\r\n  // Modal states\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [showDetailModal, setShowDetailModal] = useState(false);\r\n  const [selectedContract, setSelectedContract] = useState<ServiceContract | null>(null);\r\n\r\n  // Load data\r\n   \r\n  const loadContracts = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await serviceContractService.getServiceContracts(filters, currentPage, pageSize);\r\n      setContracts(response.data);\r\n      setTotalItems(response.total);\r\n      \r\n      // Calculate stats\r\n      calculateStats(response.data);\r\n    } catch (err) {\r\n      message.error('Failed to load service contracts');\r\n      console.error('Error loading contracts:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [filters, currentPage, pageSize, serviceContractService]);\r\n\r\n  useEffect(() => {\r\n    void loadContracts();\r\n  }, [loadContracts]);\r\n\r\n  const calculateStats = (contractsData: ServiceContract[]) => {\r\n    const now = new Date();\r\n    const thirtyDaysFromNow = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n\r\n    const active = contractsData.filter(c => c.status === 'active').length;\r\n    const expired = contractsData.filter(c => c.status === 'expired').length;\r\n    const expiringSoon = contractsData.filter(c => {\r\n      const endDate = new Date(c.end_date);\r\n      return c.status === 'active' && endDate <= thirtyDaysFromNow && endDate >= now;\r\n    }).length;\r\n    const totalValue = contractsData.reduce((sum, c) => sum + (c.contract_value || 0), 0);\r\n\r\n    setStats({\r\n      total: contractsData.length,\r\n      active,\r\n      expiring_soon: expiringSoon,\r\n      expired,\r\n      total_value: totalValue\r\n    });\r\n  };\r\n\r\n  const handleRefresh = async () => {\r\n    setRefreshing(true);\r\n    await loadContracts();\r\n    setRefreshing(false);\r\n    message.success('Data refreshed successfully');\r\n  };\r\n\r\n  const handleCreateContract = () => {\r\n    setShowCreateModal(true);\r\n  };\r\n\r\n  const handleViewContract = (contract: ServiceContract) => {\r\n    navigate(`/tenant/service-contracts/${contract.id}`);\r\n  };\r\n\r\n  const handleDeleteContract = async (contract: ServiceContract) => {\r\n    try {\r\n      await serviceContractService.deleteServiceContract(contract.id);\r\n      message.success('Service contract deleted successfully');\r\n      loadContracts();\r\n    } catch (err) {\r\n      message.error('Failed to delete service contract');\r\n      console.error('Error deleting contract:', err);\r\n    }\r\n  };\r\n\r\n  const handleSearch = (value: string) => {\r\n    setSearchText(value);\r\n    setFilters(prev => ({ ...prev, search: value }));\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const handleStatusFilter = (value: string) => {\r\n    setFilters(prev => ({ ...prev, status: value || undefined }));\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const handleServiceLevelFilter = (value: string) => {\r\n    setFilters(prev => ({ ...prev, service_level: value || undefined }));\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    setFilters({});\r\n    setSearchText('');\r\n    setCurrentPage(1);\r\n  };\r\n\r\n  const getStatusTag = (status: string) => {\r\n    const statusConfig: Record<string, { color: string; icon: React.ReactNode }> = {\r\n      'active': { color: 'success', icon: <CheckCircleOutlined /> },\r\n      'expired': { color: 'error', icon: <CloseCircleOutlined /> },\r\n      'pending': { color: 'processing', icon: <ClockCircleOutlined /> },\r\n      'cancelled': { color: 'default', icon: <CloseCircleOutlined /> }\r\n    };\r\n\r\n    const config = statusConfig[status] || { color: 'default', icon: null };\r\n    return (\r\n      <Tag color={config.color} icon={config.icon}>\r\n        {status.toUpperCase()}\r\n      </Tag>\r\n    );\r\n  };\r\n\r\n  const getServiceLevelTag = (level: string | undefined) => {\r\n    if (!level) {\r\n      return <Tag color=\"default\">N/A</Tag>;\r\n    }\r\n\r\n    const levelConfig: Record<string, string> = {\r\n      'basic': 'default',\r\n      'standard': 'blue',\r\n      'premium': 'gold',\r\n      'enterprise': 'purple'\r\n    };\r\n\r\n    return (\r\n      <Tag color={levelConfig[level.toLowerCase()] || 'default'}>\r\n        {level.toUpperCase()}\r\n      </Tag>\r\n    );\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD'\r\n    }).format(amount);\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const isExpiringSoon = (endDate: string, status: string) => {\r\n    if (status !== 'active') return false;\r\n    const end = new Date(endDate);\r\n    const now = new Date();\r\n    const thirtyDaysFromNow = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n    return end <= thirtyDaysFromNow && end >= now;\r\n  };\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<ServiceContract> = [\r\n    {\r\n      title: 'Contract #',\r\n      dataIndex: 'contract_number',\r\n      key: 'contract_number',\r\n      width: 150,\r\n      render: (text: string, record: ServiceContract) => (\r\n        <div>\r\n          <div style={{ fontWeight: 500 }}>{text}</div>\r\n          <div style={{ fontSize: '12px', color: '#8c8c8c' }}>ID: {record.id}</div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Customer',\r\n      dataIndex: 'customer_name',\r\n      key: 'customer_name',\r\n      width: 200,\r\n      render: (text: string, record: ServiceContract) => (\r\n        <div>\r\n          <div style={{ fontWeight: 500 }}>{text}</div>\r\n          <div style={{ fontSize: '12px', color: '#8c8c8c' }}>\r\n            {record.product_name}\r\n          </div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Service Level',\r\n      dataIndex: 'service_level',\r\n      key: 'service_level',\r\n      width: 130,\r\n      render: (level: string) => getServiceLevelTag(level),\r\n    },\r\n    {\r\n      title: 'Contract Value',\r\n      dataIndex: 'contract_value',\r\n      key: 'contract_value',\r\n      width: 140,\r\n      align: 'right',\r\n      render: (value: number) => (\r\n        <span style={{ fontWeight: 600, color: '#1890ff' }}>{formatCurrency(value)}</span>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Start Date',\r\n      dataIndex: 'start_date',\r\n      key: 'start_date',\r\n      width: 120,\r\n      render: (date: string) => (\r\n        <Space size={4}>\r\n          <CalendarOutlined style={{ color: '#8c8c8c' }} />\r\n          <span>{formatDate(date)}</span>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'End Date',\r\n      dataIndex: 'end_date',\r\n      key: 'end_date',\r\n      width: 120,\r\n      render: (date: string, record: ServiceContract) => (\r\n        <Space size={4}>\r\n          <CalendarOutlined style={{ color: isExpiringSoon(date, record.status) ? '#faad14' : '#8c8c8c' }} />\r\n          <span style={{ color: isExpiringSoon(date, record.status) ? '#faad14' : 'inherit' }}>\r\n            {formatDate(date)}\r\n          </span>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 120,\r\n      render: (status: string) => getStatusTag(status),\r\n    },\r\n    {\r\n      title: 'Auto Renewal',\r\n      dataIndex: 'auto_renewal',\r\n      key: 'auto_renewal',\r\n      width: 120,\r\n      align: 'center',\r\n      render: (autoRenewal: boolean) => (\r\n        autoRenewal ? (\r\n          <Tag color=\"success\" icon={<CheckCircleOutlined />}>Yes</Tag>\r\n        ) : (\r\n          <Tag color=\"default\">No</Tag>\r\n        )\r\n      ),\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      fixed: 'right',\r\n      width: 150,\r\n      align: 'center',\r\n      render: (_: unknown, record: ServiceContract) => (\r\n        <Space size=\"small\">\r\n          <Tooltip title=\"View Details\">\r\n            <Button\r\n              type=\"text\"\r\n              icon={<EyeOutlined />}\r\n              onClick={() => handleViewContract(record)}\r\n            />\r\n          </Tooltip>\r\n          {record.pdf_url && (\r\n            <Tooltip title=\"Download PDF\">\r\n              <Button\r\n                type=\"text\"\r\n                icon={<DownloadOutlined />}\r\n                onClick={() => window.open(record.pdf_url, '_blank')}\r\n              />\r\n            </Tooltip>\r\n          )}\r\n          {hasPermission('manage_service_contracts') && (\r\n            <Popconfirm\r\n              title=\"Delete Contract\"\r\n              description={`Are you sure you want to delete contract ${record.contract_number}?`}\r\n              onConfirm={() => handleDeleteContract(record)}\r\n              okText=\"Delete\"\r\n              cancelText=\"Cancel\"\r\n              okButtonProps={{ danger: true }}\r\n            >\r\n              <Tooltip title=\"Delete\">\r\n                <Button type=\"text\" danger icon={<DeleteOutlined />} />\r\n              </Tooltip>\r\n            </Popconfirm>\r\n          )}\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  if (!hasPermission('manage_service_contracts')) {\r\n    return (\r\n      <>\r\n        <div style={{ padding: 24 }}>\r\n          <Alert\r\n            message=\"Access Denied\"\r\n            description=\"You don't have permission to access service contracts.\"\r\n            type=\"warning\"\r\n            showIcon\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Service Contracts\"\r\n        description=\"Manage service contracts and agreements\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/tenant/dashboard' },\r\n            { title: 'Sales', path: '/tenant/sales' },\r\n            { title: 'Service Contracts' }\r\n          ]\r\n        }}\r\n        extra={\r\n          <Space>\r\n            <Button\r\n              icon={<ReloadOutlined spin={refreshing} />}\r\n              onClick={handleRefresh}\r\n              disabled={refreshing}\r\n            >\r\n              Refresh\r\n            </Button>\r\n            {hasPermission('manage_service_contracts') && (\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<PlusOutlined />}\r\n                onClick={handleCreateContract}\r\n              >\r\n                Create Contract\r\n              </Button>\r\n            )}\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Contracts\"\r\n              value={stats.total}\r\n              icon={<FileTextOutlined />}\r\n              color=\"primary\"\r\n              description=\"All service contracts\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Active Contracts\"\r\n              value={stats.active}\r\n              icon={<CheckCircleOutlined />}\r\n              color=\"success\"\r\n              description=\"Currently active\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Expiring Soon\"\r\n              value={stats.expiring_soon}\r\n              icon={<ClockCircleOutlined />}\r\n              color=\"warning\"\r\n              description=\"Within 30 days\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Value\"\r\n              value={formatCurrency(stats.total_value)}\r\n              icon={<DollarOutlined />}\r\n              color=\"info\"\r\n              description=\"Contract value\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Expiring Soon Alert */}\r\n        {stats.expiring_soon > 0 && (\r\n          <Alert\r\n            message=\"Contracts Expiring Soon\"\r\n            description={`${stats.expiring_soon} contract(s) will expire within the next 30 days. Please review and take necessary action.`}\r\n            type=\"warning\"\r\n            showIcon\r\n            icon={<ClockCircleOutlined />}\r\n            closable\r\n            style={{ marginBottom: 16 }}\r\n          />\r\n        )}\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Row gutter={[16, 16]}>\r\n            <Col xs={24} sm={12} md={8}>\r\n              <Search\r\n                placeholder=\"Search contracts...\"\r\n                allowClear\r\n                value={searchText}\r\n                onChange={(e) => setSearchText(e.target.value)}\r\n                onSearch={handleSearch}\r\n                prefix={<SearchOutlined />}\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={12} md={6}>\r\n              <Select\r\n                placeholder=\"Filter by status\"\r\n                allowClear\r\n                style={{ width: '100%' }}\r\n                onChange={handleStatusFilter}\r\n                value={filters.status}\r\n              >\r\n                <Option value=\"active\">Active</Option>\r\n                <Option value=\"expired\">Expired</Option>\r\n                <Option value=\"pending\">Pending</Option>\r\n                <Option value=\"cancelled\">Cancelled</Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={12} md={6}>\r\n              <Select\r\n                placeholder=\"Filter by service level\"\r\n                allowClear\r\n                style={{ width: '100%' }}\r\n                onChange={handleServiceLevelFilter}\r\n                value={filters.service_level}\r\n              >\r\n                <Option value=\"basic\">Basic</Option>\r\n                <Option value=\"standard\">Standard</Option>\r\n                <Option value=\"premium\">Premium</Option>\r\n                <Option value=\"enterprise\">Enterprise</Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={12} md={4}>\r\n              {Object.keys(filters).length > 0 && (\r\n                <Button\r\n                  icon={<FilterOutlined />}\r\n                  onClick={clearFilters}\r\n                  block\r\n                >\r\n                  Clear Filters\r\n                </Button>\r\n              )}\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Contracts Table */}\r\n        <Card>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={contracts}\r\n            rowKey=\"id\"\r\n            loading={loading}\r\n            pagination={{\r\n              current: currentPage,\r\n              pageSize: pageSize,\r\n              total: totalItems,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} contracts`,\r\n              onChange: (page, size) => {\r\n                setCurrentPage(page);\r\n                setPageSize(size);\r\n              },\r\n            }}\r\n            scroll={{ x: 1400 }}\r\n            locale={{\r\n              emptyText: (\r\n                <Empty\r\n                  image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                  description=\"No service contracts found\"\r\n                >\r\n                  {hasPermission('manage_service_contracts') && (\r\n                    <Button\r\n                      type=\"primary\"\r\n                      icon={<PlusOutlined />}\r\n                      onClick={handleCreateContract}\r\n                    >\r\n                      Create First Contract\r\n                    </Button>\r\n                  )}\r\n                </Empty>\r\n              ),\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ServiceContractsPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\serviceContract\\hooks\\useServiceContracts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\serviceContract\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\serviceContract\\services\\serviceContractService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\components\\RoleRequestDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\components\\ServiceDetailPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2934,2937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2934,2937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Detail Panel\r\n * Side drawer panel for viewing service health details\r\n */\r\n\r\nimport React from 'react';\r\nimport {\r\n  Drawer,\r\n  Button,\r\n  Descriptions,\r\n  Progress,\r\n  Tag,\r\n  Row,\r\n  Col,\r\n  Statistic,\r\n  Empty,\r\n  Badge,\r\n} from 'antd';\r\nimport {\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  WarningOutlined,\r\n  ReloadOutlined,\r\n} from '@ant-design/icons';\r\nimport { ServiceHealth } from '../types/health';\r\n\r\ninterface ServiceDetailPanelProps {\r\n  visible: boolean;\r\n  data: ServiceHealth | null;\r\n  loading?: boolean;\r\n  onClose: () => void;\r\n  onRefresh?: (serviceId: string) => void;\r\n  isRefreshing?: boolean;\r\n}\r\n\r\nexport const ServiceDetailPanel: React.FC<ServiceDetailPanelProps> = ({\r\n  visible,\r\n  data,\r\n  loading = false,\r\n  onClose,\r\n  onRefresh,\r\n  isRefreshing = false,\r\n}) => {\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'operational':\r\n        return <CheckCircleOutlined style={{ color: '#52c41a', fontSize: 16 }} />;\r\n      case 'degraded':\r\n        return <WarningOutlined style={{ color: '#faad14', fontSize: 16 }} />;\r\n      case 'down':\r\n        return <CloseCircleOutlined style={{ color: '#ff4d4f', fontSize: 16 }} />;\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'operational':\r\n        return 'success';\r\n      case 'degraded':\r\n        return 'warning';\r\n      case 'down':\r\n        return 'error';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  const getUptimeColor = (uptime: number) => {\r\n    if (uptime > 99) return '#52c41a';\r\n    if (uptime > 95) return '#faad14';\r\n    return '#ff4d4f';\r\n  };\r\n\r\n  if (!data) {\r\n    return (\r\n      <Drawer\r\n        title=\"Service Details\"\r\n        placement=\"right\"\r\n        onClose={onClose}\r\n        open={visible}\r\n        width={500}\r\n      >\r\n        <Empty description=\"No service selected\" />\r\n      </Drawer>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Drawer\r\n      title={data.name}\r\n      placement=\"right\"\r\n      onClose={onClose}\r\n      open={visible}\r\n      width={500}\r\n      loading={loading}\r\n      footer={\r\n        <Row gutter={8} justify=\"end\">\r\n          <Col>\r\n            <Button onClick={onClose}>Close</Button>\r\n          </Col>\r\n          <Col>\r\n            <Button\r\n              icon={<ReloadOutlined />}\r\n              onClick={() => onRefresh?.(data.id)}\r\n              loading={isRefreshing}\r\n            >\r\n              Refresh\r\n            </Button>\r\n          </Col>\r\n        </Row>\r\n      }\r\n    >\r\n      <div style={{ marginBottom: 24 }}>\r\n        {/* Status Overview */}\r\n        <div style={{ marginBottom: 24 }}>\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#999', marginBottom: 8 }}>Status</div>\r\n                <Badge\r\n                  status={getStatusColor(data.status) as any}\r\n                  text={\r\n                    <span style={{ fontWeight: 500 }}>\r\n                      {data.status.charAt(0).toUpperCase() + data.status.slice(1)}\r\n                    </span>\r\n                  }\r\n                />\r\n              </div>\r\n            </Col>\r\n            <Col span={12}>\r\n              <div>\r\n                <div style={{ fontSize: 12, color: '#999', marginBottom: 8 }}>Last Checked</div>\r\n                <span>{new Date(data.lastChecked).toLocaleTimeString()}</span>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n\r\n        {/* Key Metrics */}\r\n        <div style={{ marginBottom: 24 }}>\r\n          <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>Performance Metrics</div>\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"Uptime\"\r\n                value={data.uptime}\r\n                precision={2}\r\n                suffix=\"%\"\r\n                valueStyle={{ color: getUptimeColor(data.uptime) }}\r\n              />\r\n            </Col>\r\n            <Col span={12}>\r\n              <Statistic\r\n                title=\"Response Time\"\r\n                value={data.responseTime}\r\n                suffix=\"ms\"\r\n              />\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n\r\n        {/* Detailed Information */}\r\n        <div style={{ marginBottom: 24 }}>\r\n          <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>Details</div>\r\n          <Descriptions column={1} size=\"small\" bordered>\r\n            <Descriptions.Item label=\"Service Name\" span={1}>\r\n              {data.name}\r\n            </Descriptions.Item>\r\n\r\n            <Descriptions.Item label=\"Status\" span={1}>\r\n              <Tag color={getStatusColor(data.status)}>\r\n                {data.status.charAt(0).toUpperCase() + data.status.slice(1)}\r\n              </Tag>\r\n            </Descriptions.Item>\r\n\r\n            <Descriptions.Item label=\"Uptime (30 days)\" span={1}>\r\n              <Progress\r\n                percent={Math.round(data.uptime * 100) / 100}\r\n                strokeColor={getUptimeColor(data.uptime)}\r\n                size=\"small\"\r\n              />\r\n              <span style={{ marginLeft: 8, color: '#999', fontSize: 12 }}>\r\n                {data.uptime.toFixed(2)}%\r\n              </span>\r\n            </Descriptions.Item>\r\n\r\n            <Descriptions.Item label=\"Response Time\" span={1}>\r\n              {data.responseTime}ms\r\n            </Descriptions.Item>\r\n\r\n            <Descriptions.Item label=\"Last Status Check\" span={1}>\r\n              {new Date(data.lastChecked).toLocaleString()}\r\n            </Descriptions.Item>\r\n\r\n            {data.details && (\r\n              <Descriptions.Item label=\"Additional Details\" span={1}>\r\n                <div style={{ whiteSpace: 'pre-wrap', fontSize: 12 }}>\r\n                  {data.details}\r\n                </div>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n        </div>\r\n\r\n        {/* Status Indicators */}\r\n        <div style={{ marginBottom: 24 }}>\r\n          <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 16 }}>Status Indicators</div>\r\n          <Row gutter={16}>\r\n            <Col span={8}>\r\n              <div style={{\r\n                padding: 12,\r\n                border: '1px solid #f0f0f0',\r\n                borderRadius: 4,\r\n                textAlign: 'center',\r\n              }}>\r\n                {getStatusIcon(data.status)}\r\n                <div style={{ marginTop: 8, fontSize: 12, color: '#999' }}>Current Status</div>\r\n              </div>\r\n            </Col>\r\n            <Col span={8}>\r\n              <div style={{\r\n                padding: 12,\r\n                border: '1px solid #f0f0f0',\r\n                borderRadius: 4,\r\n                textAlign: 'center',\r\n                backgroundColor: data.uptime > 99 ? '#f6ffed' : data.uptime > 95 ? '#fffbe6' : '#fff1f0',\r\n              }}>\r\n                <span style={{ color: getUptimeColor(data.uptime), fontWeight: 600 }}>\r\n                  {data.uptime.toFixed(2)}%\r\n                </span>\r\n                <div style={{ marginTop: 8, fontSize: 12, color: '#999' }}>Uptime</div>\r\n              </div>\r\n            </Col>\r\n            <Col span={8}>\r\n              <div style={{\r\n                padding: 12,\r\n                border: '1px solid #f0f0f0',\r\n                borderRadius: 4,\r\n                textAlign: 'center',\r\n              }}>\r\n                <span style={{ fontWeight: 600 }}>{data.responseTime}ms</span>\r\n                <div style={{ marginTop: 8, fontSize: 12, color: '#999' }}>Avg Response</div>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\hooks\\useRoleRequests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\hooks\\useSystemHealth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":18,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":18,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Super Admin Routes\r\n */\r\nimport React, { lazy } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\n\r\n// Lazy load components\r\nconst SuperAdminDashboardPage = lazy(() => import('./views/SuperAdminDashboardPage'));\r\nconst SuperAdminTenantsPage = lazy(() => import('./views/SuperAdminTenantsPage'));\r\nconst SuperAdminUsersPage = lazy(() => import('./views/SuperAdminUsersPage'));\r\nconst SuperAdminAnalyticsPage = lazy(() => import('./views/SuperAdminAnalyticsPage'));\r\nconst SuperAdminHealthPage = lazy(() => import('./views/SuperAdminHealthPage'));\r\nconst SuperAdminConfigurationPage = lazy(() => import('./views/SuperAdminConfigurationPage'));\r\nconst SuperAdminRoleRequestsPage = lazy(() => import('./views/SuperAdminRoleRequestsPage'));\r\n\r\n// Route wrapper with error boundary\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <React.Suspense fallback={<div>Loading...</div>}>\r\n      {children}\r\n    </React.Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const superAdminRoutes: RouteObject[] = [\r\n  {\r\n    path: 'super-admin',\r\n    children: [\r\n      {\r\n        path: 'dashboard',\r\n        element: (\r\n          <RouteWrapper>\r\n            <SuperAdminDashboardPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'tenants',\r\n        element: (\r\n          <RouteWrapper>\r\n            <SuperAdminTenantsPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'users',\r\n        element: (\r\n          <RouteWrapper>\r\n            <SuperAdminUsersPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'analytics',\r\n        element: (\r\n          <RouteWrapper>\r\n            <SuperAdminAnalyticsPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'health',\r\n        element: (\r\n          <RouteWrapper>\r\n            <SuperAdminHealthPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'configuration',\r\n        element: (\r\n          <RouteWrapper>\r\n            <SuperAdminConfigurationPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'role-requests',\r\n        element: (\r\n          <RouteWrapper>\r\n            <SuperAdminRoleRequestsPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\services\\healthService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\services\\roleRequestService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\types\\health.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\types\\roleRequest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminAnalyticsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminConfigurationPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminDashboardPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminHealthPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1026,1029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1026,1029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchHealthData'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchHealthData]","fix":{"range":[1787,1789],"text":"[fetchHealthData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3799,3802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3799,3802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Super Admin Health Page - Complete Refactor\r\n * System health monitoring with drawer-based details, consistent UI\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Table,\r\n  Badge,\r\n  Space,\r\n  Alert,\r\n  Spin,\r\n  Progress,\r\n  Tooltip,\r\n  Timeline,\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport {\r\n  ReloadOutlined,\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  WarningOutlined,\r\n} from '@ant-design/icons';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { ServiceDetailPanel } from '../components/ServiceDetailPanel';\r\nimport type { ServiceHealth, SystemMetrics, IncidentLog } from '../types/health';\r\nimport { Activity, Zap, AlertCircle, CheckCircle } from 'lucide-react';\r\n\r\nconst SuperAdminHealthPage: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const healthService = useService<any>('healthService');\r\n\r\n  // State\r\n  const [services, setServices] = useState<ServiceHealth[]>([]);\r\n  const [metrics, setMetrics] = useState<SystemMetrics>({\r\n    systemLoad: 0,\r\n    memoryUsage: 0,\r\n    databaseStatus: 'unknown',\r\n    operationalServices: 0,\r\n    totalServices: 0,\r\n  });\r\n  const [incidents, setIncidents] = useState<IncidentLog[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedService, setSelectedService] = useState<ServiceHealth | null>(null);\r\n  const [isPanelVisible, setIsPanelVisible] = useState(false);\r\n\r\n  // Auto-refresh every 30 seconds\r\n   \r\n  useEffect(() => {\r\n    fetchHealthData();\r\n    const interval = setInterval(fetchHealthData, 30000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const fetchHealthData = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await healthService.getSystemHealth();\r\n      setServices(data.services);\r\n      setMetrics(data.metrics);\r\n      setIncidents(data.incidents);\r\n    } catch (error) {\r\n      console.error('Failed to fetch health data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'operational':\r\n        return <CheckCircleOutlined style={{ color: '#52c41a' }} />;\r\n      case 'degraded':\r\n        return <WarningOutlined style={{ color: '#faad14' }} />;\r\n      case 'down':\r\n        return <CloseCircleOutlined style={{ color: '#ff4d4f' }} />;\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'operational':\r\n        return 'success';\r\n      case 'degraded':\r\n        return 'warning';\r\n      case 'down':\r\n        return 'error';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  const getSeverityColor = (severity: string) => {\r\n    switch (severity) {\r\n      case 'critical':\r\n        return 'red';\r\n      case 'warning':\r\n        return 'orange';\r\n      case 'info':\r\n        return 'blue';\r\n      default:\r\n        return 'gray';\r\n    }\r\n  };\r\n\r\n  const handleViewService = (service: ServiceHealth) => {\r\n    setSelectedService(service);\r\n    setIsPanelVisible(true);\r\n  };\r\n\r\n  // Service health table\r\n  const serviceColumns: ColumnsType<ServiceHealth> = [\r\n    {\r\n      title: 'Service',\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n      width: 200,\r\n      render: (name: string, record) => (\r\n        <Space>\r\n          {getStatusIcon(record.status)}\r\n          <span>{name}</span>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 120,\r\n      render: (status: string) => (\r\n        <Badge status={getStatusColor(status) as any} text={status.charAt(0).toUpperCase() + status.slice(1)} />\r\n      ),\r\n    },\r\n    {\r\n      title: 'Uptime',\r\n      dataIndex: 'uptime',\r\n      key: 'uptime',\r\n      width: 120,\r\n      render: (uptime: number) => (\r\n        <Tooltip title={`${uptime}% in last 30 days`}>\r\n          <Progress\r\n            type=\"circle\"\r\n            percent={Math.round(uptime)}\r\n            width={50}\r\n            strokeColor={uptime > 99 ? '#52c41a' : uptime > 95 ? '#faad14' : '#ff4d4f'}\r\n          />\r\n        </Tooltip>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Response Time',\r\n      dataIndex: 'responseTime',\r\n      key: 'responseTime',\r\n      width: 120,\r\n      render: (time: number) => `${time}ms`,\r\n    },\r\n    {\r\n      title: 'Last Checked',\r\n      dataIndex: 'lastChecked',\r\n      key: 'lastChecked',\r\n      width: 150,\r\n      render: (time: string) => new Date(time).toLocaleTimeString(),\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      width: 100,\r\n      render: (_, record) => (\r\n        <Button\r\n          type=\"text\"\r\n          size=\"small\"\r\n          onClick={() => handleViewService(record)}\r\n        >\r\n          Details\r\n        </Button>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"System Health\"\r\n        description=\"Monitor system services, performance, and incidents\"\r\n        breadcrumbs={[\r\n          { label: 'Home', path: '/' },\r\n          { label: 'Super Admin', path: '/super-admin' },\r\n          { label: 'System Health' },\r\n        ]}\r\n        extra={\r\n          <Button\r\n            icon={<ReloadOutlined spin={isLoading} />}\r\n            onClick={fetchHealthData}\r\n            loading={isLoading}\r\n          >\r\n            Refresh\r\n          </Button>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* System Metrics */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"System Load\"\r\n              value={`${Math.round(metrics.systemLoad)}%`}\r\n              icon={Activity}\r\n              color={metrics.systemLoad > 70 ? 'error' : metrics.systemLoad > 50 ? 'warning' : 'success'}\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Memory Usage\"\r\n              value={`${Math.round(metrics.memoryUsage)}%`}\r\n              icon={Zap}\r\n              color={metrics.memoryUsage > 70 ? 'error' : metrics.memoryUsage > 50 ? 'warning' : 'success'}\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Database Status\"\r\n              value={metrics.databaseStatus === 'connected' ? 'Connected' : 'Disconnected'}\r\n              icon={AlertCircle}\r\n              color={metrics.databaseStatus === 'connected' ? 'success' : 'error'}\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Services Operational\"\r\n              value={`${metrics.operationalServices}/${metrics.totalServices}`}\r\n              icon={CheckCircle}\r\n              color=\"success\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Service Health */}\r\n        <Card\r\n          title=\"Service Status\"\r\n          extra={<Spin spinning={isLoading} size=\"small\" />}\r\n          style={{ marginBottom: 24 }}\r\n        >\r\n          <Table<ServiceHealth>\r\n            columns={serviceColumns}\r\n            dataSource={services}\r\n            loading={isLoading}\r\n            rowKey=\"id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n          />\r\n        </Card>\r\n\r\n        {/* Incidents Log */}\r\n        <Card title=\"Recent Incidents\" style={{ marginBottom: 24 }}>\r\n          {incidents.length === 0 ? (\r\n            <Alert\r\n              message=\"No incidents\"\r\n              description=\"All systems are operating normally\"\r\n              type=\"success\"\r\n              showIcon\r\n            />\r\n          ) : (\r\n            <Timeline\r\n              items={incidents.map((incident) => ({\r\n                dot: <div style={{\r\n                  width: 12,\r\n                  height: 12,\r\n                  backgroundColor: getSeverityColor(incident.severity),\r\n                  borderRadius: '50%',\r\n                }} />,\r\n                children: (\r\n                  <div style={{ marginBottom: 16 }}>\r\n                    <div style={{ fontWeight: 600, marginBottom: 4 }}>\r\n                      {incident.title}\r\n                      {incident.resolved && (\r\n                        <Badge\r\n                          count=\"RESOLVED\"\r\n                          style={{\r\n                            backgroundColor: '#52c41a',\r\n                            marginLeft: 8,\r\n                            fontSize: 10,\r\n                          }}\r\n                        />\r\n                      )}\r\n                    </div>\r\n                    <div style={{ fontSize: 12, color: '#666', marginBottom: 4 }}>\r\n                      {incident.description}\r\n                    </div>\r\n                    <div style={{ fontSize: 11, color: '#999' }}>\r\n                      {new Date(incident.timestamp).toLocaleString()}\r\n                    </div>\r\n                  </div>\r\n                ),\r\n              }))}\r\n            />\r\n          )}\r\n        </Card>\r\n\r\n        {/* Performance Overview */}\r\n        <Card title=\"Performance Overview\">\r\n          <Row gutter={[16, 16]}>\r\n            <Col xs={24} md={12}>\r\n              <div style={{\r\n                padding: 16,\r\n                backgroundColor: '#fafafa',\r\n                borderRadius: 4,\r\n                textAlign: 'center',\r\n              }}>\r\n                <div style={{ fontSize: 12, color: '#999', marginBottom: 8 }}>Average Response Time</div>\r\n                <div style={{ fontSize: 24, fontWeight: 600, color: '#1890ff' }}>\r\n                  {Math.round(services.reduce((acc, s) => acc + s.responseTime, 0) / services.length)}ms\r\n                </div>\r\n              </div>\r\n            </Col>\r\n            <Col xs={24} md={12}>\r\n              <div style={{\r\n                padding: 16,\r\n                backgroundColor: '#fafafa',\r\n                borderRadius: 4,\r\n                textAlign: 'center',\r\n              }}>\r\n                <div style={{ fontSize: 12, color: '#999', marginBottom: 8 }}>Average Uptime</div>\r\n                <div style={{ fontSize: 24, fontWeight: 600, color: '#52c41a' }}>\r\n                  {(services.reduce((acc, s) => acc + s.uptime, 0) / services.length).toFixed(2)}%\r\n                </div>\r\n              </div>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Service Detail Panel */}\r\n      <ServiceDetailPanel\r\n        visible={isPanelVisible}\r\n        data={selectedService}\r\n        loading={isLoading}\r\n        onClose={() => setIsPanelVisible(false)}\r\n        onRefresh={() => fetchHealthData()}\r\n        isRefreshing={isLoading}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SuperAdminHealthPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminLogsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminRoleRequestsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRoleRequests'. Either include it or remove the dependency array.","line":66,"column":6,"nodeType":"ArrayExpression","endLine":66,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRoleRequests, isSuperAdmin, statusFilter]","fix":{"range":[2021,2049],"text":"[fetchRoleRequests, isSuperAdmin, statusFilter]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2235,2238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2235,2238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Super Admin Role Requests Page - Complete Refactor\r\n * Handles role change requests from users across all tenants\r\n * Features: Drawer-based side panels, consistent UI, proper service integration\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n  Row,\r\n  Col,\r\n  Card,\r\n  Button,\r\n  Table,\r\n  Tag,\r\n  Space,\r\n  Input,\r\n  Select,\r\n  message,\r\n  Alert,\r\n  Dropdown,\r\n  type MenuProps,\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport {\r\n  SearchOutlined,\r\n  ReloadOutlined,\r\n  MoreOutlined,\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  ClockCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { RoleRequestDetailPanel } from '../components/RoleRequestDetailPanel';\r\nimport type { RoleRequest, RoleRequestStats } from '../types/roleRequest';\r\nimport { Clock, CheckCircle, XCircle, Users } from 'lucide-react';\r\n\r\nconst SuperAdminRoleRequestsPage: React.FC = () => {\r\n  const { user: currentUser } = useAuth();\r\n  const roleRequestService = useService<any>('roleRequestService');\r\n\r\n  // State\r\n  const [requests, setRequests] = useState<RoleRequest[]>([]);\r\n  const [stats, setStats] = useState<RoleRequestStats>({\r\n    total: 0,\r\n    pending: 0,\r\n    approved: 0,\r\n    rejected: 0,\r\n  });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [searchText, setSearchText] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<string>('');\r\n  const [selectedRequest, setSelectedRequest] = useState<RoleRequest | null>(null);\r\n  const [isPanelVisible, setIsPanelVisible] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Check super admin permission\r\n  const isSuperAdmin = currentUser?.role === 'super_admin';\r\n\r\n  // Load role requests\r\n   \r\n  useEffect(() => {\r\n    if (isSuperAdmin) {\r\n      fetchRoleRequests();\r\n    }\r\n  }, [isSuperAdmin, statusFilter]);\r\n\r\n  const fetchRoleRequests = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const response = await roleRequestService.getRoleRequests({\r\n        status: statusFilter as any,\r\n        search: searchText,\r\n      });\r\n      setRequests(response.data);\r\n      setStats(response.stats);\r\n    } catch (error) {\r\n      console.error('Failed to fetch role requests:', error);\r\n      message.error('Failed to load role requests');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle approve\r\n  const handleApprove = async (request: RoleRequest) => {\r\n    try {\r\n      setIsSubmitting(true);\r\n      await roleRequestService.approveRoleRequest(request.id);\r\n      message.success(`Role request approved for ${request.userName}`);\r\n      await fetchRoleRequests();\r\n      setIsPanelVisible(false);\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to approve request';\r\n      message.error(errorMessage);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Handle reject\r\n  const handleReject = async (request: RoleRequest, reason: string) => {\r\n    try {\r\n      setIsSubmitting(true);\r\n      await roleRequestService.rejectRoleRequest(request.id, reason);\r\n      message.success('Role request rejected');\r\n      await fetchRoleRequests();\r\n      setIsPanelVisible(false);\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to reject request';\r\n      message.error(errorMessage);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Handle view details\r\n  const handleViewDetails = (request: RoleRequest) => {\r\n    setSelectedRequest(request);\r\n    setIsPanelVisible(true);\r\n  };\r\n\r\n  // Filtered requests\r\n  const filteredRequests = requests.filter(request => {\r\n    const matchesSearch = !searchText ||\r\n      request.userName.toLowerCase().includes(searchText.toLowerCase()) ||\r\n      request.userEmail.toLowerCase().includes(searchText.toLowerCase()) ||\r\n      request.tenantName.toLowerCase().includes(searchText.toLowerCase());\r\n    return matchesSearch;\r\n  });\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<RoleRequest> = [\r\n    {\r\n      title: 'User',\r\n      key: 'user',\r\n      width: 220,\r\n      render: (_, record) => (\r\n        <Space direction=\"vertical\" size={0}>\r\n          <div style={{ fontWeight: 500 }}>{record.userName}</div>\r\n          <div style={{ fontSize: 12, color: '#999' }}>{record.userEmail}</div>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Tenant',\r\n      dataIndex: 'tenantName',\r\n      key: 'tenantName',\r\n      width: 160,\r\n    },\r\n    {\r\n      title: 'Current Role',\r\n      dataIndex: 'currentRole',\r\n      key: 'currentRole',\r\n      width: 120,\r\n      render: (role: string) => (\r\n        <Tag color=\"blue\">{role.replace('_', ' ').toUpperCase()}</Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Requested Role',\r\n      dataIndex: 'requestedRole',\r\n      key: 'requestedRole',\r\n      width: 120,\r\n      render: (role: string) => (\r\n        <Tag color=\"orange\">{role.replace('_', ' ').toUpperCase()}</Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 110,\r\n      render: (status: string) => {\r\n        const colors: Record<string, string> = {\r\n          pending: 'processing',\r\n          approved: 'success',\r\n          rejected: 'error',\r\n        };\r\n        const icons: Record<string, React.ReactNode> = {\r\n          pending: <ClockCircleOutlined />,\r\n          approved: <CheckCircleOutlined />,\r\n          rejected: <CloseCircleOutlined />,\r\n        };\r\n        return (\r\n          <Tag icon={icons[status]} color={colors[status]}>\r\n            {status.charAt(0).toUpperCase() + status.slice(1)}\r\n          </Tag>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      title: 'Requested',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      width: 130,\r\n      render: (date: string) => new Date(date).toLocaleDateString(),\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      align: 'right' as const,\r\n      width: 100,\r\n      render: (_, record) => (\r\n        <Button\r\n          type=\"text\"\r\n          size=\"small\"\r\n          onClick={() => handleViewDetails(record)}\r\n        >\r\n          View Details\r\n        </Button>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  if (!isSuperAdmin) {\r\n    return (\r\n      <div style={{ padding: 24 }}>\r\n        <Alert\r\n          message=\"Access Denied\"\r\n          description=\"You don't have permission to access role requests. Only super administrators can manage role requests.\"\r\n          type=\"error\"\r\n          showIcon\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Role Change Requests\"\r\n        description=\"Manage user role change requests across all tenants\"\r\n        breadcrumbs={[\r\n          { label: 'Home', path: '/' },\r\n          { label: 'Super Admin', path: '/super-admin' },\r\n          { label: 'Role Requests' },\r\n        ]}\r\n        extra={\r\n          <Button\r\n            icon={<ReloadOutlined spin={isLoading} />}\r\n            onClick={fetchRoleRequests}\r\n            loading={isLoading}\r\n          >\r\n            Refresh\r\n          </Button>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Stats Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Requests\"\r\n              value={stats.total}\r\n              icon={Users}\r\n              color=\"primary\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Pending\"\r\n              value={stats.pending}\r\n              icon={Clock}\r\n              color=\"warning\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Approved\"\r\n              value={stats.approved}\r\n              icon={CheckCircle}\r\n              color=\"success\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Rejected\"\r\n              value={stats.rejected}\r\n              icon={XCircle}\r\n              color=\"error\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 24 }}>\r\n          <Space style={{ width: '100%' }}>\r\n            <Input\r\n              placeholder=\"Search by user, email, or tenant...\"\r\n              prefix={<SearchOutlined />}\r\n              value={searchText}\r\n              onChange={(e) => setSearchText(e.target.value)}\r\n              style={{ width: 300 }}\r\n              allowClear\r\n            />\r\n            <Select\r\n              placeholder=\"Filter by status\"\r\n              style={{ width: 150 }}\r\n              value={statusFilter}\r\n              onChange={setStatusFilter}\r\n              allowClear\r\n              options={[\r\n                { label: 'All Status', value: '' },\r\n                { label: 'Pending', value: 'pending' },\r\n                { label: 'Approved', value: 'approved' },\r\n                { label: 'Rejected', value: 'rejected' },\r\n              ]}\r\n            />\r\n            <Button\r\n              type=\"primary\"\r\n              onClick={() => {\r\n                setSearchText('');\r\n                setStatusFilter('');\r\n              }}\r\n            >\r\n              Clear Filters\r\n            </Button>\r\n          </Space>\r\n        </Card>\r\n\r\n        {/* Table */}\r\n        <Card>\r\n          <Table<RoleRequest>\r\n            columns={columns}\r\n            dataSource={filteredRequests}\r\n            loading={isLoading}\r\n            rowKey=\"id\"\r\n            pagination={{\r\n              pageSize: 20,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} requests`,\r\n            }}\r\n            size=\"middle\"\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Detail Panel */}\r\n      <RoleRequestDetailPanel\r\n        visible={isPanelVisible}\r\n        data={selectedRequest}\r\n        loading={isLoading}\r\n        onClose={() => setIsPanelVisible(false)}\r\n        onApprove={handleApprove}\r\n        onReject={handleReject}\r\n        isSubmitting={isSubmitting}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SuperAdminRoleRequestsPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminTenantsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1655,1658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1655,1658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTenants'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [statusFilter, searchText, fetchTenants]","fix":{"range":[2501,2527],"text":"[statusFilter, searchText, fetchTenants]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Super Admin Tenants Page - Enterprise Ant Design Version\r\n * Comprehensive tenant management for super administrators with full CRUD operations\r\n */\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Button, \r\n  Table, \r\n  Tag, \r\n  Space, \r\n  Spin,\r\n  Alert,\r\n  Popconfirm,\r\n  Modal,\r\n  Form,\r\n  Input,\r\n  Select,\r\n  Switch,\r\n  Tabs,\r\n  Descriptions,\r\n  message,\r\n  Dropdown,\r\n  type MenuProps\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport { \r\n  PlusOutlined,\r\n  ReloadOutlined,\r\n  EyeOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  StopOutlined,\r\n  CheckCircleOutlined,\r\n  GlobalOutlined,\r\n  SettingOutlined,\r\n  MoreOutlined,\r\n  ExportOutlined,\r\n  SearchOutlined,\r\n  FilterOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined,\r\n  ClockCircleOutlined\r\n} from '@ant-design/icons';\r\nimport { \r\n  Building2,\r\n  Users,\r\n  CheckCircle,\r\n  XCircle\r\n} from 'lucide-react';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { Tenant } from '@/types/crm';\r\nimport { TenantSettings } from '@/types/rbac';\r\n\r\nconst { Option } = Select;\r\nconst { TextArea } = Input;\r\n\r\ninterface TenantFormData {\r\n  name: string;\r\n  domain: string;\r\n  status: string;\r\n  maxUsers?: number;\r\n  description?: string;\r\n  contactEmail?: string;\r\n  contactPhone?: string;\r\n}\r\n\r\nconst SuperAdminTenantsPage: React.FC = () => {\r\n  const { hasPermission, user } = useAuth();\r\n  const tenantService = useService<any>('tenantService');\r\n  const [form] = Form.useForm();\r\n  const [settingsForm] = Form.useForm();\r\n\r\n  // State\r\n  const [tenants, setTenants] = useState<Tenant[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [searchText, setSearchText] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<string>('');\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  const [isDetailsModalVisible, setIsDetailsModalVisible] = useState(false);\r\n  const [isSettingsModalVisible, setIsSettingsModalVisible] = useState(false);\r\n  const [editingTenant, setEditingTenant] = useState<Tenant | null>(null);\r\n  const [viewingTenant, setViewingTenant] = useState<Tenant | null>(null);\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  // Load tenants\r\n   \r\n  useEffect(() => {\r\n    fetchTenants();\r\n  }, [statusFilter, searchText]);\r\n\r\n  const fetchTenants = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const data = await tenantService.getTenants({\r\n        status: statusFilter || undefined,\r\n        search: searchText || undefined\r\n      });\r\n      setTenants(data);\r\n    } catch (error) {\r\n      console.error('Failed to fetch tenants:', error);\r\n      message.error('Failed to load tenants');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle create tenant\r\n  const handleCreate = () => {\r\n    setEditingTenant(null);\r\n    form.resetFields();\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle edit tenant\r\n  const handleEdit = (tenant: Tenant) => {\r\n    setEditingTenant(tenant);\r\n    form.setFieldsValue({\r\n      name: tenant.name,\r\n      domain: tenant.domain,\r\n      status: tenant.status,\r\n      maxUsers: tenant.maxUsers,\r\n      description: tenant.description,\r\n      contactEmail: tenant.contactEmail,\r\n      contactPhone: tenant.contactPhone\r\n    });\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle view details\r\n  const handleViewDetails = async (tenant: Tenant) => {\r\n    try {\r\n      const fullTenant = await tenantService.getTenant(tenant.id);\r\n      setViewingTenant(fullTenant);\r\n      setIsDetailsModalVisible(true);\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to load tenant details';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  // Handle tenant settings\r\n  const handleSettings = async (tenant: Tenant) => {\r\n    try {\r\n      const settings = await tenantService.getTenantSettings(tenant.id);\r\n      setEditingTenant(tenant);\r\n      settingsForm.setFieldsValue(settings);\r\n      setIsSettingsModalVisible(true);\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to load tenant settings';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  // Handle delete tenant\r\n  const handleDelete = async (tenantId: string) => {\r\n    try {\r\n      await tenantService.deleteTenant(tenantId);\r\n      message.success('Tenant deleted successfully');\r\n      void fetchTenants();\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to delete tenant';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  // Handle suspend/activate tenant\r\n  const handleToggleStatus = async (tenant: Tenant) => {\r\n    try {\r\n      const newStatus = tenant.status === 'active' ? 'suspended' : 'active';\r\n      await tenantService.updateTenantStatus(tenant.id, newStatus);\r\n      message.success(`Tenant ${newStatus === 'active' ? 'activated' : 'suspended'} successfully`);\r\n      void fetchTenants();\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to update tenant status';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  // Handle form submit\r\n  const handleSubmit = async (values: TenantFormData) => {\r\n    try {\r\n      setSubmitting(true);\r\n      if (editingTenant) {\r\n        await tenantService.updateTenant(editingTenant.id, values);\r\n        message.success('Tenant updated successfully');\r\n      } else {\r\n        await tenantService.createTenant(values);\r\n        message.success('Tenant created successfully');\r\n      }\r\n      setIsModalVisible(false);\r\n      form.resetFields();\r\n      void fetchTenants();\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to save tenant';\r\n      message.error(errorMessage);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Handle settings submit\r\n  const handleSettingsSubmit = async (values: TenantSettings) => {\r\n    if (!editingTenant) return;\r\n    \r\n    try {\r\n      setSubmitting(true);\r\n      await tenantService.updateTenantSettings(editingTenant.id, values);\r\n      message.success('Tenant settings updated successfully');\r\n      setIsSettingsModalVisible(false);\r\n      settingsForm.resetFields();\r\n      void fetchTenants();\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to update tenant settings';\r\n      message.error(errorMessage);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Permission check\r\n  const canManageTenants = user?.role === 'super_admin';\r\n\r\n  if (!canManageTenants) {\r\n    return (\r\n      <>\r\n        <div style={{ padding: 24 }}>\r\n          <Alert\r\n            message=\"Access Denied\"\r\n            description=\"You don't have permission to access tenant management. Only super administrators can manage tenants.\"\r\n            type=\"error\"\r\n            showIcon\r\n            action={\r\n              <Button size=\"small\" onClick={() => window.history.back()}>\r\n                Go Back\r\n              </Button>\r\n            }\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Statistics\r\n  const stats = {\r\n    total: tenants.length,\r\n    active: tenants.filter((t) => t.status === 'active').length,\r\n    suspended: tenants.filter((t) => t.status === 'suspended').length,\r\n    totalUsers: tenants.reduce((sum, tenant) => sum + (tenant.userCount || 0), 0),\r\n  };\r\n\r\n  // Filtered tenants\r\n  const filteredTenants = tenants.filter(tenant => {\r\n    const matchesSearch = !searchText || \r\n      tenant.name.toLowerCase().includes(searchText.toLowerCase()) ||\r\n      tenant.domain?.toLowerCase().includes(searchText.toLowerCase());\r\n    const matchesStatus = !statusFilter || tenant.status === statusFilter;\r\n    return matchesSearch && matchesStatus;\r\n  });\r\n\r\n  // Action menu for each tenant\r\n  const getActionMenu = (tenant: Tenant): MenuProps['items'] => [\r\n    {\r\n      key: 'view',\r\n      icon: <EyeOutlined />,\r\n      label: 'View Details',\r\n      onClick: () => handleViewDetails(tenant),\r\n    },\r\n    {\r\n      key: 'edit',\r\n      icon: <EditOutlined />,\r\n      label: 'Edit Tenant',\r\n      onClick: () => handleEdit(tenant),\r\n    },\r\n    {\r\n      key: 'settings',\r\n      icon: <SettingOutlined />,\r\n      label: 'Settings',\r\n      onClick: () => handleSettings(tenant),\r\n    },\r\n    { type: 'divider' },\r\n    {\r\n      key: 'toggle-status',\r\n      icon: tenant.status === 'active' ? <StopOutlined /> : <CheckCircleOutlined />,\r\n      label: tenant.status === 'active' ? 'Suspend Tenant' : 'Activate Tenant',\r\n      onClick: () => handleToggleStatus(tenant),\r\n    },\r\n    {\r\n      key: 'delete',\r\n      icon: <DeleteOutlined />,\r\n      label: 'Delete Tenant',\r\n      danger: true,\r\n      disabled: tenant.id === 'platform',\r\n      onClick: () => {\r\n        Modal.confirm({\r\n          title: 'Delete Tenant',\r\n          content: `Are you sure you want to delete \"${tenant.name}\"? This action cannot be undone and will delete all associated data.`,\r\n          okText: 'Delete',\r\n          okType: 'danger',\r\n          onOk: () => handleDelete(tenant.id),\r\n        });\r\n      },\r\n    },\r\n  ];\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<Tenant> = [\r\n    {\r\n      title: 'Tenant',\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n      render: (_: unknown, record: Tenant) => (\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n          <div style={{ \r\n            padding: 8, \r\n            background: '#DBEAFE', \r\n            borderRadius: 8,\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center'\r\n          }}>\r\n            <Building2 size={16} color=\"#1E40AF\" />\r\n          </div>\r\n          <div>\r\n            <div style={{ fontWeight: 500 }}>{record.name}</div>\r\n            <div style={{ fontSize: 12, color: '#6B7280' }}>{record.domain}</div>\r\n          </div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      render: (status: string) => (\r\n        <Tag color={status === 'active' ? 'green' : status === 'suspended' ? 'red' : 'default'}>\r\n          {status.toUpperCase()}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Users',\r\n      dataIndex: 'userCount',\r\n      key: 'userCount',\r\n      render: (count: number) => (\r\n        <Space>\r\n          <Users size={14} color=\"#6B7280\" />\r\n          <span>{count || 0}</span>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      render: (date: string) => new Date(date).toLocaleDateString(),\r\n    },\r\n    {\r\n      title: 'Last Active',\r\n      dataIndex: 'lastActive',\r\n      key: 'lastActive',\r\n      render: (date: string) => date ? new Date(date).toLocaleDateString() : 'Never',\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      align: 'right',\r\n      fixed: 'right',\r\n      width: 120,\r\n      render: (_: unknown, record: Tenant) => (\r\n        <Space>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<EyeOutlined />}\r\n            onClick={() => handleViewDetails(record)}\r\n          />\r\n          <Dropdown menu={{ items: getActionMenu(record) }} trigger={['click']}>\r\n            <Button type=\"text\" icon={<MoreOutlined />} />\r\n          </Dropdown>\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Tenant Management\"\r\n        description=\"Manage all tenants across the platform\"\r\n        breadcrumbs={[\r\n          { label: 'Home', path: '/' },\r\n          { label: 'Super Admin', path: '/super-admin' },\r\n          { label: 'Tenants' }\r\n        ]}\r\n        extra={\r\n          <Space>\r\n            <Button\r\n              icon={<ReloadOutlined spin={isLoading} />}\r\n              onClick={fetchTenants}\r\n              disabled={isLoading}\r\n            >\r\n              Refresh\r\n            </Button>\r\n            <Button\r\n              icon={<ExportOutlined />}\r\n              onClick={() => message.info('Export functionality coming soon')}\r\n            >\r\n              Export\r\n            </Button>\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={handleCreate}\r\n            >\r\n              Create Tenant\r\n            </Button>\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Stats Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Tenants\"\r\n              value={stats.total}\r\n              icon={Building2}\r\n              color=\"primary\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Active Tenants\"\r\n              value={stats.active}\r\n              icon={CheckCircle}\r\n              color=\"success\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Suspended\"\r\n              value={stats.suspended}\r\n              icon={XCircle}\r\n              color=\"error\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Users\"\r\n              value={stats.totalUsers}\r\n              icon={Users}\r\n              color=\"info\"\r\n              loading={isLoading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12} md={8}>\r\n              <Input\r\n                placeholder=\"Search tenants...\"\r\n                prefix={<SearchOutlined />}\r\n                value={searchText}\r\n                onChange={(e) => setSearchText(e.target.value)}\r\n                allowClear\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={12} md={8}>\r\n              <Select\r\n                placeholder=\"Filter by status\"\r\n                style={{ width: '100%' }}\r\n                value={statusFilter || undefined}\r\n                onChange={setStatusFilter}\r\n                allowClear\r\n              >\r\n                <Option value=\"active\">Active</Option>\r\n                <Option value=\"suspended\">Suspended</Option>\r\n                <Option value=\"inactive\">Inactive</Option>\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Tenants Table */}\r\n        <Card \r\n          title={\r\n            <Space>\r\n              <GlobalOutlined />\r\n              <span>Tenants ({filteredTenants.length})</span>\r\n            </Space>\r\n          }\r\n        >\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredTenants}\r\n            rowKey=\"id\"\r\n            loading={isLoading}\r\n            pagination={{\r\n              pageSize: 10,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} tenants`,\r\n            }}\r\n            locale={{\r\n              emptyText: (\r\n                <div style={{ textAlign: 'center', padding: '40px 0' }}>\r\n                  <GlobalOutlined style={{ fontSize: 48, color: '#9CA3AF', marginBottom: 16 }} />\r\n                  <h3 style={{ fontSize: 18, fontWeight: 600, marginBottom: 8 }}>No tenants found</h3>\r\n                  <p style={{ color: '#6B7280', marginBottom: 16 }}>\r\n                    {searchText || statusFilter ? 'Try adjusting your filters' : 'Get started by creating your first tenant'}\r\n                  </p>\r\n                  {!searchText && !statusFilter && (\r\n                    <Button\r\n                      type=\"primary\"\r\n                      icon={<PlusOutlined />}\r\n                      onClick={handleCreate}\r\n                    >\r\n                      Create Tenant\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              ),\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Create/Edit Tenant Modal */}\r\n      <Modal\r\n        title={editingTenant ? 'Edit Tenant' : 'Create New Tenant'}\r\n        open={isModalVisible}\r\n        onCancel={() => {\r\n          setIsModalVisible(false);\r\n          form.resetFields();\r\n        }}\r\n        footer={null}\r\n        width={600}\r\n      >\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          onFinish={handleSubmit}\r\n        >\r\n          <Form.Item\r\n            name=\"name\"\r\n            label=\"Tenant Name\"\r\n            rules={[{ required: true, message: 'Please enter tenant name' }]}\r\n          >\r\n            <Input placeholder=\"Enter tenant name\" prefix={<GlobalOutlined />} />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            name=\"domain\"\r\n            label=\"Domain\"\r\n            rules={[\r\n              { required: true, message: 'Please enter domain' },\r\n              { pattern: /^[a-z0-9-]+$/, message: 'Domain must contain only lowercase letters, numbers, and hyphens' }\r\n            ]}\r\n          >\r\n            <Input placeholder=\"tenant-domain\" addonBefore=\"https://\" addonAfter=\".yourapp.com\" />\r\n          </Form.Item>\r\n\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"status\"\r\n                label=\"Status\"\r\n                rules={[{ required: true, message: 'Please select status' }]}\r\n                initialValue=\"active\"\r\n              >\r\n                <Select>\r\n                  <Option value=\"active\">Active</Option>\r\n                  <Option value=\"suspended\">Suspended</Option>\r\n                  <Option value=\"inactive\">Inactive</Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"maxUsers\"\r\n                label=\"Max Users\"\r\n                rules={[{ required: true, message: 'Please enter max users' }]}\r\n                initialValue={10}\r\n              >\r\n                <Input type=\"number\" min={1} placeholder=\"10\" prefix={<UserOutlined />} />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item\r\n            name=\"description\"\r\n            label=\"Description\"\r\n          >\r\n            <TextArea rows={3} placeholder=\"Enter tenant description\" />\r\n          </Form.Item>\r\n\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"contactEmail\"\r\n                label=\"Contact Email\"\r\n                rules={[{ type: 'email', message: 'Please enter valid email' }]}\r\n              >\r\n                <Input placeholder=\"contact@example.com\" prefix={<MailOutlined />} />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"contactPhone\"\r\n                label=\"Contact Phone\"\r\n              >\r\n                <Input placeholder=\"+1 234 567 8900\" prefix={<PhoneOutlined />} />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item style={{ marginBottom: 0, marginTop: 24 }}>\r\n            <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n              <Button onClick={() => {\r\n                setIsModalVisible(false);\r\n                form.resetFields();\r\n              }}>\r\n                Cancel\r\n              </Button>\r\n              <Button type=\"primary\" htmlType=\"submit\" loading={submitting}>\r\n                {editingTenant ? 'Update Tenant' : 'Create Tenant'}\r\n              </Button>\r\n            </Space>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n\r\n      {/* Tenant Details Modal */}\r\n      <Modal\r\n        title=\"Tenant Details\"\r\n        open={isDetailsModalVisible}\r\n        onCancel={() => setIsDetailsModalVisible(false)}\r\n        footer={[\r\n          <Button key=\"close\" onClick={() => setIsDetailsModalVisible(false)}>\r\n            Close\r\n          </Button>,\r\n          <Button key=\"edit\" type=\"primary\" onClick={() => {\r\n            setIsDetailsModalVisible(false);\r\n            if (viewingTenant) handleEdit(viewingTenant);\r\n          }}>\r\n            Edit Tenant\r\n          </Button>,\r\n        ]}\r\n        width={700}\r\n      >\r\n        {viewingTenant && (\r\n          <Descriptions bordered column={2}>\r\n            <Descriptions.Item label=\"Tenant Name\" span={2}>\r\n              <Space>\r\n                <GlobalOutlined />\r\n                {viewingTenant.name}\r\n              </Space>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Domain\" span={2}>\r\n              {viewingTenant.domain}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Status\">\r\n              <Tag color={viewingTenant.status === 'active' ? 'green' : 'red'}>\r\n                {viewingTenant.status?.toUpperCase()}\r\n              </Tag>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"User Count\">\r\n              <Space>\r\n                <UserOutlined />\r\n                {viewingTenant.userCount || 0} / {viewingTenant.maxUsers || 'Unlimited'}\r\n              </Space>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Description\" span={2}>\r\n              {viewingTenant.description || 'No description'}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Contact Email\">\r\n              {viewingTenant.contactEmail || 'N/A'}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Contact Phone\">\r\n              {viewingTenant.contactPhone || 'N/A'}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Created At\">\r\n              <Space>\r\n                <CalendarOutlined />\r\n                {new Date(viewingTenant.createdAt).toLocaleString()}\r\n              </Space>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Last Active\">\r\n              <Space>\r\n                <ClockCircleOutlined />\r\n                {viewingTenant.lastActive ? new Date(viewingTenant.lastActive).toLocaleString() : 'Never'}\r\n              </Space>\r\n            </Descriptions.Item>\r\n          </Descriptions>\r\n        )}\r\n      </Modal>\r\n\r\n      {/* Tenant Settings Modal */}\r\n      <Modal\r\n        title={`Tenant Settings - ${editingTenant?.name}`}\r\n        open={isSettingsModalVisible}\r\n        onCancel={() => {\r\n          setIsSettingsModalVisible(false);\r\n          settingsForm.resetFields();\r\n        }}\r\n        footer={null}\r\n        width={700}\r\n      >\r\n        <Form\r\n          form={settingsForm}\r\n          layout=\"vertical\"\r\n          onFinish={handleSettingsSubmit}\r\n        >\r\n          <Tabs\r\n            defaultActiveKey=\"general\"\r\n            items={[\r\n              {\r\n                label: 'General',\r\n                key: 'general',\r\n                children: (\r\n                  <>\r\n                    <Form.Item\r\n                      name=\"timezone\"\r\n                      label=\"Timezone\"\r\n                    >\r\n                      <Select placeholder=\"Select timezone\">\r\n                        <Option value=\"UTC\">UTC</Option>\r\n                        <Option value=\"America/New_York\">America/New_York</Option>\r\n                        <Option value=\"America/Los_Angeles\">America/Los_Angeles</Option>\r\n                        <Option value=\"Europe/London\">Europe/London</Option>\r\n                        <Option value=\"Asia/Tokyo\">Asia/Tokyo</Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"dateFormat\"\r\n                      label=\"Date Format\"\r\n                    >\r\n                      <Select placeholder=\"Select date format\">\r\n                        <Option value=\"MM/DD/YYYY\">MM/DD/YYYY</Option>\r\n                        <Option value=\"DD/MM/YYYY\">DD/MM/YYYY</Option>\r\n                        <Option value=\"YYYY-MM-DD\">YYYY-MM-DD</Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"currency\"\r\n                      label=\"Currency\"\r\n                    >\r\n                      <Select placeholder=\"Select currency\">\r\n                        <Option value=\"USD\">USD - US Dollar</Option>\r\n                        <Option value=\"EUR\">EUR - Euro</Option>\r\n                        <Option value=\"GBP\">GBP - British Pound</Option>\r\n                        <Option value=\"JPY\">JPY - Japanese Yen</Option>\r\n                      </Select>\r\n                    </Form.Item>\r\n                  </>\r\n                )\r\n              },\r\n              {\r\n                label: 'Features',\r\n                key: 'features',\r\n                children: (\r\n                  <>\r\n                    <Form.Item\r\n                      name=\"enableTickets\"\r\n                      label=\"Enable Tickets\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"enableContracts\"\r\n                      label=\"Enable Contracts\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"enableReports\"\r\n                      label=\"Enable Reports\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"enableAPI\"\r\n                      label=\"Enable API Access\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n                  </>\r\n                )\r\n              },\r\n              {\r\n                label: 'Security',\r\n                key: 'security',\r\n                children: (\r\n                  <>\r\n                    <Form.Item\r\n                      name=\"requireMFA\"\r\n                      label=\"Require Multi-Factor Authentication\"\r\n                      valuePropName=\"checked\"\r\n                    >\r\n                      <Switch />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"passwordExpiry\"\r\n                      label=\"Password Expiry (days)\"\r\n                    >\r\n                      <Input type=\"number\" min={0} placeholder=\"90\" />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"sessionTimeout\"\r\n                      label=\"Session Timeout (minutes)\"\r\n                    >\r\n                      <Input type=\"number\" min={5} placeholder=\"30\" />\r\n                    </Form.Item>\r\n\r\n                    <Form.Item\r\n                      name=\"ipWhitelist\"\r\n                      label=\"IP Whitelist\"\r\n                    >\r\n                      <TextArea rows={3} placeholder=\"Enter IP addresses (one per line)\" />\r\n                    </Form.Item>\r\n                  </>\r\n                )\r\n              }\r\n            ]}\r\n          />\r\n\r\n          <Form.Item style={{ marginBottom: 0, marginTop: 24 }}>\r\n            <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n              <Button onClick={() => {\r\n                setIsSettingsModalVisible(false);\r\n                settingsForm.resetFields();\r\n              }}>\r\n                Cancel\r\n              </Button>\r\n              <Button type=\"primary\" htmlType=\"submit\" loading={submitting}>\r\n                Save Settings\r\n              </Button>\r\n            </Space>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SuperAdminTenantsPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\super-admin\\views\\SuperAdminUsersPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1567,1570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1567,1570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1624,1627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1624,1627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":97,"column":6,"nodeType":"ArrayExpression","endLine":97,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [isSuperAdmin, loadData]","fix":{"range":[2653,2667],"text":"[isSuperAdmin, loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Super Admin Users Page - Enterprise Ant Design Version\r\n * Cross-tenant user management for super administrators\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Button,\r\n  Input,\r\n  Space,\r\n  Tag,\r\n  Modal,\r\n  Form,\r\n  Row,\r\n  Col,\r\n  Select,\r\n  message,\r\n  Empty,\r\n  Tooltip,\r\n  Badge,\r\n  Dropdown,\r\n  Descriptions,\r\n  type MenuProps\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport {\r\n  UserOutlined,\r\n  PlusOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  SearchOutlined,\r\n  CrownOutlined,\r\n  TeamOutlined,\r\n  MailOutlined,\r\n  PhoneOutlined,\r\n  SafetyOutlined,\r\n  LockOutlined,\r\n  ReloadOutlined,\r\n  ExportOutlined,\r\n  MoreOutlined,\r\n  ClockCircleOutlined,\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  GlobalOutlined\r\n} from '@ant-design/icons';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { User } from '@/types/auth';\r\nimport { Tenant } from '@/types/rbac';\r\n\r\nconst { Option } = Select;\r\n\r\ninterface UserFormData {\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  phone?: string;\r\n  role: string;\r\n  status: string;\r\n  tenantId: string;\r\n}\r\n\r\nconst SuperAdminUsersPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { hasPermission, user: currentUser } = useAuth();\r\n  const userService = useService<any>('userService');\r\n  const tenantService = useService<any>('tenantService');\r\n  const [form] = Form.useForm();\r\n\r\n  // Check super admin permission\r\n  const isSuperAdmin = currentUser?.role === 'super_admin';\r\n\r\n  // State\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [tenants, setTenants] = useState<Tenant[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchText, setSearchText] = useState('');\r\n  const [selectedTenant, setSelectedTenant] = useState<string>('all');\r\n  const [selectedRole, setSelectedRole] = useState<string>('all');\r\n  const [selectedStatus, setSelectedStatus] = useState<string>('all');\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  const [isDetailModalVisible, setIsDetailModalVisible] = useState(false);\r\n  const [editingUser, setEditingUser] = useState<User | null>(null);\r\n  const [viewingUser, setViewingUser] = useState<User | null>(null);\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  // Load data\r\n   \r\n  useEffect(() => {\r\n    if (isSuperAdmin) {\r\n      loadData();\r\n    }\r\n  }, [isSuperAdmin]);\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const [usersData, tenantsData] = await Promise.all([\r\n        userService.getUsers(),\r\n        tenantService.getTenants()\r\n      ]);\r\n      setUsers(usersData);\r\n      setTenants(tenantsData);\r\n    } catch (error) {\r\n      message.error('Failed to load data');\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle create user\r\n  const handleCreate = () => {\r\n    setEditingUser(null);\r\n    form.resetFields();\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle edit user\r\n  const handleEdit = (user: User) => {\r\n    setEditingUser(user);\r\n    form.setFieldsValue({\r\n      firstName: user.firstName,\r\n      lastName: user.lastName,\r\n      email: user.email,\r\n      phone: user.phone,\r\n      role: user.role,\r\n      status: user.status,\r\n      tenantId: user.tenantId\r\n    });\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle view details\r\n  const handleViewDetails = (user: User) => {\r\n    setViewingUser(user);\r\n    setIsDetailModalVisible(true);\r\n  };\r\n\r\n  // Handle delete user\r\n  const handleDelete = async (userId: string) => {\r\n    try {\r\n      await userService.deleteUser(userId);\r\n      message.success('User deleted successfully');\r\n      loadData();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to delete user';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  // Handle reset password\r\n  const handleResetPassword = async (userId: string) => {\r\n    try {\r\n      await userService.resetPassword(userId);\r\n      message.success('Password reset email sent successfully');\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to reset password';\r\n      message.error(errorMessage);\r\n    }\r\n  };\r\n\r\n  // Handle form submit\r\n  const handleSubmit = async (values: UserFormData) => {\r\n    try {\r\n      setSubmitting(true);\r\n      if (editingUser) {\r\n        await userService.updateUser(editingUser.id, values);\r\n        message.success('User updated successfully');\r\n      } else {\r\n        await userService.createUser(values);\r\n        message.success('User created successfully');\r\n      }\r\n      setIsModalVisible(false);\r\n      form.resetFields();\r\n      loadData();\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to save user';\r\n      message.error(errorMessage);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Get role icon\r\n  const getRoleIcon = (role: string) => {\r\n    switch (role) {\r\n      case 'super_admin':\r\n        return <CrownOutlined style={{ color: '#722ed1' }} />;\r\n      case 'admin':\r\n        return <CrownOutlined style={{ color: '#faad14' }} />;\r\n      case 'manager':\r\n        return <SafetyOutlined style={{ color: '#1890ff' }} />;\r\n      default:\r\n        return <UserOutlined style={{ color: '#52c41a' }} />;\r\n    }\r\n  };\r\n\r\n  // Get role color\r\n  const getRoleColor = (role: string) => {\r\n    switch (role) {\r\n      case 'super_admin':\r\n        return 'purple';\r\n      case 'admin':\r\n        return 'gold';\r\n      case 'manager':\r\n        return 'blue';\r\n      case 'agent':\r\n        return 'cyan';\r\n      case 'engineer':\r\n        return 'green';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  // Get status color\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'active':\r\n        return 'success';\r\n      case 'suspended':\r\n        return 'error';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  // Action menu items\r\n  const getActionMenu = (user: User): MenuProps['items'] => [\r\n    {\r\n      key: 'view',\r\n      label: 'View Details',\r\n      icon: <UserOutlined />,\r\n      onClick: () => handleViewDetails(user)\r\n    },\r\n    {\r\n      key: 'edit',\r\n      label: 'Edit User',\r\n      icon: <EditOutlined />,\r\n      onClick: () => handleEdit(user)\r\n    },\r\n    {\r\n      key: 'reset',\r\n      label: 'Reset Password',\r\n      icon: <LockOutlined />,\r\n      onClick: () => {\r\n        Modal.confirm({\r\n          title: 'Reset Password',\r\n          content: `Send password reset email to ${user.email}?`,\r\n          okText: 'Send',\r\n          onOk: () => handleResetPassword(user.id)\r\n        });\r\n      }\r\n    },\r\n    {\r\n      type: 'divider'\r\n    },\r\n    {\r\n      key: 'delete',\r\n      label: 'Delete User',\r\n      icon: <DeleteOutlined />,\r\n      danger: true,\r\n      disabled: user.id === currentUser?.id,\r\n      onClick: () => {\r\n        Modal.confirm({\r\n          title: 'Delete User',\r\n          content: `Are you sure you want to delete ${user.firstName} ${user.lastName}?`,\r\n          okText: 'Delete',\r\n          okType: 'danger',\r\n          onOk: () => handleDelete(user.id)\r\n        });\r\n      }\r\n    }\r\n  ];\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<User> = [\r\n    {\r\n      title: 'User',\r\n      key: 'user',\r\n      fixed: 'left',\r\n      width: 280,\r\n      render: (_, record) => (\r\n        <Space>\r\n          <div\r\n            style={{\r\n              width: 40,\r\n              height: 40,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              color: 'white',\r\n              fontWeight: 600,\r\n              fontSize: 16\r\n            }}\r\n          >\r\n            {record.firstName?.[0]}{record.lastName?.[0]}\r\n          </div>\r\n          <div>\r\n            <div style={{ fontWeight: 500, color: '#2C3E50' }}>\r\n              {record.firstName} {record.lastName}\r\n            </div>\r\n            <div style={{ fontSize: 12, color: '#7A8691' }}>\r\n              <MailOutlined style={{ marginRight: 4 }} />\r\n              {record.email}\r\n            </div>\r\n          </div>\r\n        </Space>\r\n      ),\r\n      filteredValue: searchText ? [searchText] : null,\r\n      onFilter: (value, record) =>\r\n        `${record.firstName} ${record.lastName}`.toLowerCase().includes((value as string).toLowerCase()) ||\r\n        record.email.toLowerCase().includes((value as string).toLowerCase())\r\n    },\r\n    {\r\n      title: 'Tenant',\r\n      dataIndex: 'tenantId',\r\n      key: 'tenantId',\r\n      width: 180,\r\n      render: (tenantId: string) => {\r\n        const tenant = tenants.find(t => t.id === tenantId);\r\n        return (\r\n          <Space>\r\n            <GlobalOutlined style={{ color: '#1890ff' }} />\r\n            <span>{tenant?.name || tenantId}</span>\r\n          </Space>\r\n        );\r\n      },\r\n      filters: tenants.map(t => ({ text: t.name, value: t.id })),\r\n      filteredValue: selectedTenant !== 'all' ? [selectedTenant] : null,\r\n      onFilter: (value, record) => record.tenantId === value\r\n    },\r\n    {\r\n      title: 'Role',\r\n      dataIndex: 'role',\r\n      key: 'role',\r\n      width: 140,\r\n      render: (role: string) => (\r\n        <Tag icon={getRoleIcon(role)} color={getRoleColor(role)}>\r\n          {role.replace('_', ' ').toUpperCase()}\r\n        </Tag>\r\n      ),\r\n      filters: [\r\n        { text: 'Super Admin', value: 'super_admin' },\r\n        { text: 'Admin', value: 'admin' },\r\n        { text: 'Manager', value: 'manager' },\r\n        { text: 'Agent', value: 'agent' },\r\n        { text: 'Engineer', value: 'engineer' },\r\n        { text: 'Customer', value: 'customer' }\r\n      ],\r\n      filteredValue: selectedRole !== 'all' ? [selectedRole] : null,\r\n      onFilter: (value, record) => record.role === value\r\n    },\r\n    {\r\n      title: 'Phone',\r\n      dataIndex: 'phone',\r\n      key: 'phone',\r\n      width: 150,\r\n      render: (phone: string) =>\r\n        phone ? (\r\n          <Space>\r\n            <PhoneOutlined style={{ color: '#1890ff' }} />\r\n            <span>{phone}</span>\r\n          </Space>\r\n        ) : (\r\n          <span style={{ color: '#d9d9d9' }}>-</span>\r\n        )\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 100,\r\n      render: (status: string) => (\r\n        <Tag\r\n          color={getStatusColor(status)}\r\n          icon={status === 'active' ? <CheckCircleOutlined /> : <CloseCircleOutlined />}\r\n        >\r\n          {status.toUpperCase()}\r\n        </Tag>\r\n      ),\r\n      filters: [\r\n        { text: 'Active', value: 'active' },\r\n        { text: 'Inactive', value: 'inactive' },\r\n        { text: 'Suspended', value: 'suspended' }\r\n      ],\r\n      filteredValue: selectedStatus !== 'all' ? [selectedStatus] : null,\r\n      onFilter: (value, record) => record.status === value\r\n    },\r\n    {\r\n      title: 'Last Login',\r\n      dataIndex: 'lastLogin',\r\n      key: 'lastLogin',\r\n      width: 180,\r\n      render: (lastLogin: string) =>\r\n        lastLogin ? (\r\n          <Space>\r\n            <ClockCircleOutlined style={{ color: '#7A8691' }} />\r\n            <span style={{ color: '#7A8691' }}>\r\n              {new Date(lastLogin).toLocaleString()}\r\n            </span>\r\n          </Space>\r\n        ) : (\r\n          <span style={{ color: '#d9d9d9' }}>Never</span>\r\n        )\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      width: 120,\r\n      render: (createdAt: string) => (\r\n        <span style={{ color: '#7A8691' }}>\r\n          {new Date(createdAt).toLocaleDateString()}\r\n        </span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      fixed: 'right',\r\n      width: 100,\r\n      render: (_, record) => (\r\n        <Space>\r\n          <Tooltip title=\"Edit\">\r\n            <Button\r\n              type=\"text\"\r\n              size=\"small\"\r\n              icon={<EditOutlined />}\r\n              onClick={() => handleEdit(record)}\r\n            />\r\n          </Tooltip>\r\n          <Dropdown menu={{ items: getActionMenu(record) }} trigger={['click']}>\r\n            <Button type=\"text\" size=\"small\" icon={<MoreOutlined />} />\r\n          </Dropdown>\r\n        </Space>\r\n      )\r\n    }\r\n  ];\r\n\r\n  // Calculate stats\r\n  const totalUsers = users.length;\r\n  const activeUsers = users.filter(u => u.status === 'active').length;\r\n  const superAdmins = users.filter(u => u.role === 'super_admin').length;\r\n  const suspendedUsers = users.filter(u => u.status === 'suspended').length;\r\n\r\n  // Filtered users\r\n  const filteredUsers = users.filter(user => {\r\n    if (searchText && !(`${user.firstName} ${user.lastName}`.toLowerCase().includes(searchText.toLowerCase()) ||\r\n        user.email.toLowerCase().includes(searchText.toLowerCase()))) {\r\n      return false;\r\n    }\r\n    if (selectedTenant !== 'all' && user.tenantId !== selectedTenant) {\r\n      return false;\r\n    }\r\n    if (selectedRole !== 'all' && user.role !== selectedRole) {\r\n      return false;\r\n    }\r\n    if (selectedStatus !== 'all' && user.status !== selectedStatus) {\r\n      return false;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  // Check if user is super admin\r\n  if (!isSuperAdmin) {\r\n    return (\r\n      <>\r\n        <PageHeader\r\n          title=\"Super Admin Users\"\r\n          description=\"Cross-tenant user management\"\r\n          breadcrumbs={[\r\n            { title: 'Home', path: '/' },\r\n            { title: 'Super Admin', path: '/super-admin' },\r\n            { title: 'Users' }\r\n          ]}\r\n        />\r\n        <div style={{ padding: 24 }}>\r\n          <Card>\r\n            <Empty\r\n              description=\"Super Admin access required\"\r\n              image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n            >\r\n              <Button type=\"primary\" onClick={() => navigate('/')}>\r\n                Go to Dashboard\r\n              </Button>\r\n            </Empty>\r\n          </Card>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Super Admin Users\"\r\n        description=\"Cross-tenant user management\"\r\n        breadcrumbs={[\r\n          { title: 'Home', path: '/' },\r\n          { title: 'Super Admin', path: '/super-admin' },\r\n          { title: 'Users' }\r\n        ]}\r\n        extra={\r\n          <Space>\r\n            <Button icon={<ReloadOutlined />} onClick={loadData}>\r\n              Refresh\r\n            </Button>\r\n            <Button icon={<ExportOutlined />}>Export</Button>\r\n            <Button type=\"primary\" icon={<PlusOutlined />} onClick={handleCreate}>\r\n              Add User\r\n            </Button>\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Users\"\r\n              value={totalUsers}\r\n              icon={<TeamOutlined />}\r\n              color=\"primary\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Active Users\"\r\n              value={activeUsers}\r\n              icon={<UserOutlined />}\r\n              color=\"success\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Super Admins\"\r\n              value={superAdmins}\r\n              icon={<CrownOutlined />}\r\n              color=\"warning\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Suspended\"\r\n              value={suspendedUsers}\r\n              icon={<LockOutlined />}\r\n              color=\"error\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12} md={8} lg={6}>\r\n              <Input\r\n                placeholder=\"Search users...\"\r\n                prefix={<SearchOutlined />}\r\n                value={searchText}\r\n                onChange={(e) => setSearchText(e.target.value)}\r\n                allowClear\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={12} md={8} lg={6}>\r\n              <Select\r\n                style={{ width: '100%' }}\r\n                placeholder=\"Filter by tenant\"\r\n                value={selectedTenant}\r\n                onChange={setSelectedTenant}\r\n              >\r\n                <Option value=\"all\">All Tenants</Option>\r\n                {tenants.map(tenant => (\r\n                  <Option key={tenant.id} value={tenant.id}>\r\n                    {tenant.name}\r\n                  </Option>\r\n                ))}\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={12} md={8} lg={6}>\r\n              <Select\r\n                style={{ width: '100%' }}\r\n                placeholder=\"Filter by role\"\r\n                value={selectedRole}\r\n                onChange={setSelectedRole}\r\n              >\r\n                <Option value=\"all\">All Roles</Option>\r\n                <Option value=\"super_admin\">Super Admin</Option>\r\n                <Option value=\"admin\">Admin</Option>\r\n                <Option value=\"manager\">Manager</Option>\r\n                <Option value=\"agent\">Agent</Option>\r\n                <Option value=\"engineer\">Engineer</Option>\r\n                <Option value=\"customer\">Customer</Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={12} md={8} lg={6}>\r\n              <Select\r\n                style={{ width: '100%' }}\r\n                placeholder=\"Filter by status\"\r\n                value={selectedStatus}\r\n                onChange={setSelectedStatus}\r\n              >\r\n                <Option value=\"all\">All Statuses</Option>\r\n                <Option value=\"active\">Active</Option>\r\n                <Option value=\"inactive\">Inactive</Option>\r\n                <Option value=\"suspended\">Suspended</Option>\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Users Table */}\r\n        <Card>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredUsers}\r\n            rowKey=\"id\"\r\n            loading={loading}\r\n            scroll={{ x: 1600 }}\r\n            pagination={{\r\n              total: filteredUsers.length,\r\n              pageSize: 10,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} users`\r\n            }}\r\n            locale={{\r\n              emptyText: (\r\n                <Empty\r\n                  image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                  description=\"No users found\"\r\n                >\r\n                  <Button type=\"primary\" icon={<PlusOutlined />} onClick={handleCreate}>\r\n                    Add First User\r\n                  </Button>\r\n                </Empty>\r\n              )\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Create/Edit User Modal */}\r\n      <Modal\r\n        title={editingUser ? 'Edit User' : 'Create New User'}\r\n        open={isModalVisible}\r\n        onCancel={() => {\r\n          setIsModalVisible(false);\r\n          form.resetFields();\r\n        }}\r\n        footer={null}\r\n        width={700}\r\n      >\r\n        <Form form={form} layout=\"vertical\" onFinish={handleSubmit}>\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"firstName\"\r\n                label=\"First Name\"\r\n                rules={[\r\n                  { required: true, message: 'Please enter first name' },\r\n                  { min: 2, message: 'First name must be at least 2 characters' }\r\n                ]}\r\n              >\r\n                <Input prefix={<UserOutlined />} placeholder=\"Enter first name\" size=\"large\" />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"lastName\"\r\n                label=\"Last Name\"\r\n                rules={[\r\n                  { required: true, message: 'Please enter last name' },\r\n                  { min: 2, message: 'Last name must be at least 2 characters' }\r\n                ]}\r\n              >\r\n                <Input prefix={<UserOutlined />} placeholder=\"Enter last name\" size=\"large\" />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item\r\n            name=\"email\"\r\n            label=\"Email\"\r\n            rules={[\r\n              { required: true, message: 'Please enter email' },\r\n              { type: 'email', message: 'Please enter a valid email' }\r\n            ]}\r\n          >\r\n            <Input\r\n              prefix={<MailOutlined />}\r\n              placeholder=\"Enter email\"\r\n              size=\"large\"\r\n              disabled={!!editingUser}\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item name=\"phone\" label=\"Phone\">\r\n            <Input prefix={<PhoneOutlined />} placeholder=\"Enter phone number\" size=\"large\" />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            name=\"tenantId\"\r\n            label=\"Tenant\"\r\n            rules={[{ required: true, message: 'Please select tenant' }]}\r\n          >\r\n            <Select\r\n              placeholder=\"Select tenant\"\r\n              size=\"large\"\r\n              showSearch\r\n              optionFilterProp=\"children\"\r\n            >\r\n              {tenants.map(tenant => (\r\n                <Option key={tenant.id} value={tenant.id}>\r\n                  <Space>\r\n                    <GlobalOutlined />\r\n                    {tenant.name}\r\n                  </Space>\r\n                </Option>\r\n              ))}\r\n            </Select>\r\n          </Form.Item>\r\n\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"role\"\r\n                label=\"Role\"\r\n                rules={[{ required: true, message: 'Please select role' }]}\r\n              >\r\n                <Select placeholder=\"Select role\" size=\"large\">\r\n                  <Option value=\"super_admin\">\r\n                    <Space>\r\n                      <CrownOutlined style={{ color: '#722ed1' }} />\r\n                      Super Admin\r\n                    </Space>\r\n                  </Option>\r\n                  <Option value=\"admin\">\r\n                    <Space>\r\n                      <CrownOutlined style={{ color: '#faad14' }} />\r\n                      Admin\r\n                    </Space>\r\n                  </Option>\r\n                  <Option value=\"manager\">\r\n                    <Space>\r\n                      <SafetyOutlined style={{ color: '#1890ff' }} />\r\n                      Manager\r\n                    </Space>\r\n                  </Option>\r\n                  <Option value=\"agent\">\r\n                    <Space>\r\n                      <UserOutlined style={{ color: '#52c41a' }} />\r\n                      Agent\r\n                    </Space>\r\n                  </Option>\r\n                  <Option value=\"engineer\">\r\n                    <Space>\r\n                      <UserOutlined style={{ color: '#52c41a' }} />\r\n                      Engineer\r\n                    </Space>\r\n                  </Option>\r\n                  <Option value=\"customer\">\r\n                    <Space>\r\n                      <UserOutlined style={{ color: '#52c41a' }} />\r\n                      Customer\r\n                    </Space>\r\n                  </Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"status\"\r\n                label=\"Status\"\r\n                rules={[{ required: true, message: 'Please select status' }]}\r\n              >\r\n                <Select placeholder=\"Select status\" size=\"large\">\r\n                  <Option value=\"active\">Active</Option>\r\n                  <Option value=\"inactive\">Inactive</Option>\r\n                  <Option value=\"suspended\">Suspended</Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item style={{ marginBottom: 0, marginTop: 24 }}>\r\n            <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n              <Button\r\n                onClick={() => {\r\n                  setIsModalVisible(false);\r\n                  form.resetFields();\r\n                }}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                htmlType=\"submit\"\r\n                loading={submitting}\r\n                icon={editingUser ? <EditOutlined /> : <PlusOutlined />}\r\n              >\r\n                {editingUser ? 'Update User' : 'Create User'}\r\n              </Button>\r\n            </Space>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n\r\n      {/* User Details Modal */}\r\n      <Modal\r\n        title=\"User Details\"\r\n        open={isDetailModalVisible}\r\n        onCancel={() => setIsDetailModalVisible(false)}\r\n        footer={[\r\n          <Button key=\"close\" onClick={() => setIsDetailModalVisible(false)}>\r\n            Close\r\n          </Button>\r\n        ]}\r\n        width={600}\r\n      >\r\n        {viewingUser && (\r\n          <Descriptions bordered column={1}>\r\n            <Descriptions.Item label=\"Name\">\r\n              {viewingUser.firstName} {viewingUser.lastName}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Email\">{viewingUser.email}</Descriptions.Item>\r\n            <Descriptions.Item label=\"Phone\">{viewingUser.phone || '-'}</Descriptions.Item>\r\n            <Descriptions.Item label=\"Tenant\">\r\n              {tenants.find(t => t.id === viewingUser.tenantId)?.name || viewingUser.tenantId}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Role\">\r\n              <Tag icon={getRoleIcon(viewingUser.role)} color={getRoleColor(viewingUser.role)}>\r\n                {viewingUser.role.replace('_', ' ').toUpperCase()}\r\n              </Tag>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Status\">\r\n              <Tag\r\n                color={getStatusColor(viewingUser.status)}\r\n                icon={viewingUser.status === 'active' ? <CheckCircleOutlined /> : <CloseCircleOutlined />}\r\n              >\r\n                {viewingUser.status.toUpperCase()}\r\n              </Tag>\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Last Login\">\r\n              {viewingUser.lastLogin ? new Date(viewingUser.lastLogin).toLocaleString() : 'Never'}\r\n            </Descriptions.Item>\r\n            <Descriptions.Item label=\"Created\">\r\n              {new Date(viewingUser.createdAt).toLocaleString()}\r\n            </Descriptions.Item>\r\n          </Descriptions>\r\n        )}\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SuperAdminUsersPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\components\\TicketsDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\components\\TicketsFormPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8702,8705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8702,8705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tickets Form Panel - ENTERPRISE EDITION\r\n * Side drawer for creating/editing support tickets with professional enterprise features\r\n * ‚úÖ Auto-generated ticket numbers (TKT-YYYYMM-001 format)\r\n * ‚úÖ Professional SLA and response time tracking\r\n * ‚úÖ Advanced ticket categorization and routing\r\n * ‚úÖ Enterprise-level form organization and validation\r\n * Features:\r\n *   - Auto-generated unique ticket numbers with tenant isolation\r\n *   - Professional SLA/priority cards with response time estimates\r\n *   - Advanced category and department routing\r\n *   - Customer relationship display with linked alert\r\n *   - Intelligent status workflow management\r\n *   - Priority escalation tracking\r\n *   - Assignment and team queue management\r\n *   - Tag suggestions and management\r\n *   - Due date/SLA deadline tracking with alerts\r\n *   - Detailed ticket notes and attachment support\r\n * RBAC Integration: Controls create/edit form permissions\r\n */\r\n\r\nimport React, { useEffect, useCallback, useState, useMemo } from 'react';\r\nimport {\r\n  Drawer,\r\n  Form,\r\n  Input,\r\n  Button,\r\n  Select,\r\n  DatePicker,\r\n  Spin,\r\n  Space,\r\n  Divider,\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Tag,\r\n  Badge,\r\n  Alert,\r\n  Tooltip,\r\n  Statistic,\r\n  Empty,\r\n  message,\r\n} from 'antd';\r\nimport {\r\n  ClockCircleOutlined,\r\n  AlertOutlined,\r\n  CheckCircleOutlined,\r\n  UserOutlined,\r\n  BgColorsOutlined,\r\n  LockOutlined,\r\n  FileTextOutlined,\r\n  LinkOutlined,\r\n} from '@ant-design/icons';\r\nimport { Ticket } from '@/types/crm';\r\nimport { useCreateTicket, useUpdateTicket } from '../hooks/useTickets';\r\nimport dayjs from 'dayjs';\r\n\r\ninterface TicketsFormPanelProps {\r\n  ticket: Ticket | null;\r\n  mode: 'create' | 'edit';\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\n// Enterprise status configuration with SLA definitions\r\nconst STATUSES = [\r\n  { label: 'Open', value: 'open', color: 'warning', icon: 'üìå' },\r\n  { label: 'In Progress', value: 'in_progress', color: 'processing', icon: '‚è≥' },\r\n  { label: 'Waiting Customer', value: 'waiting_customer', color: 'default', icon: '‚è∏' },\r\n  { label: 'Resolved', value: 'resolved', color: 'success', icon: '‚úì' },\r\n  { label: 'Closed', value: 'closed', color: 'default', icon: '‚úï' },\r\n];\r\n\r\n// Priority levels with SLA time expectations\r\nconst PRIORITIES = [\r\n  { \r\n    label: 'Low', \r\n    value: 'low', \r\n    color: 'default', \r\n    responseTime: '24 hours',\r\n    resolutionTime: '7 days'\r\n  },\r\n  { \r\n    label: 'Medium', \r\n    value: 'medium', \r\n    color: 'blue', \r\n    responseTime: '8 hours',\r\n    resolutionTime: '3 days'\r\n  },\r\n  { \r\n    label: 'High', \r\n    value: 'high', \r\n    color: 'orange', \r\n    responseTime: '2 hours',\r\n    resolutionTime: '24 hours'\r\n  },\r\n  { \r\n    label: 'Urgent', \r\n    value: 'urgent', \r\n    color: 'red', \r\n    responseTime: '30 minutes',\r\n    resolutionTime: '4 hours'\r\n  },\r\n];\r\n\r\n// Advanced category routing\r\nconst CATEGORIES = [\r\n  { label: 'Technical Support', value: 'technical_support', department: 'Support Team' },\r\n  { label: 'Billing & Invoicing', value: 'billing', department: 'Finance' },\r\n  { label: 'Feature Request', value: 'feature_request', department: 'Product Team' },\r\n  { label: 'Bug Report', value: 'bug_report', department: 'Engineering' },\r\n  { label: 'Account & Access', value: 'account_issue', department: 'Account Management' },\r\n  { label: 'General Inquiry', value: 'general_inquiry', department: 'Support Team' },\r\n  { label: 'Service Issue', value: 'service_issue', department: 'Operations' },\r\n  { label: 'Complaint', value: 'complaint', department: 'Management' },\r\n];\r\n\r\n// Department queue assignments\r\nconst DEPARTMENTS = [\r\n  { label: 'Support Team', value: 'support_team' },\r\n  { label: 'Finance', value: 'finance' },\r\n  { label: 'Product Team', value: 'product_team' },\r\n  { label: 'Engineering', value: 'engineering' },\r\n  { label: 'Account Management', value: 'account_management' },\r\n  { label: 'Operations', value: 'operations' },\r\n  { label: 'Management', value: 'management' },\r\n];\r\n\r\n// Suggested tags for quick tagging\r\nconst SUGGESTED_TAGS = [\r\n  'urgent', 'followup', 'escalation', 'customer-issue', 'data-issue',\r\n  'performance', 'integration', 'documentation', 'training', 'feedback'\r\n];\r\n\r\nexport const TicketsFormPanel: React.FC<TicketsFormPanelProps> = ({\r\n  ticket,\r\n  mode,\r\n  isOpen,\r\n  onClose,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [selectedPriority, setSelectedPriority] = useState<string | undefined>(ticket?.priority || 'medium');\r\n  const [selectedCategory, setSelectedCategory] = useState<string | undefined>(ticket?.category);\r\n  const [selectedTags, setSelectedTags] = useState<string[]>(ticket?.tags || []);\r\n  const [autoGeneratedTicketNumber, setAutoGeneratedTicketNumber] = useState<string>('');\r\n  const [customerAlert, setCustomerAlert] = useState<string | null>(null);\r\n  \r\n  const createTicket = useCreateTicket();\r\n  const updateTicket = useUpdateTicket();\r\n  const isLoading = createTicket.isPending || updateTicket.isPending;\r\n\r\n  /**\r\n   * Generate auto-incremented ticket number with tenant isolation\r\n   * Format: TKT-YYYYMM-XXXX (e.g., TKT-202501-0001)\r\n   * Enterprise feature: Unique per tenant per month\r\n   */\r\n  const generateTicketNumber = (): string => {\r\n    const now = new Date();\r\n    const year = now.getFullYear();\r\n    const month = String(now.getMonth() + 1).padStart(2, '0');\r\n    const monthKey = `${year}${month}`;\r\n    \r\n    const storageKey = `ticket_sequence_${monthKey}`;\r\n    const currentSequence = parseInt(localStorage.getItem(storageKey) || '0', 10);\r\n    const nextSequence = currentSequence + 1;\r\n    localStorage.setItem(storageKey, String(nextSequence));\r\n    \r\n    const sequenceNum = String(nextSequence).padStart(4, '0');\r\n    return `TKT-${monthKey}-${sequenceNum}`;\r\n  };\r\n\r\n  /**\r\n   * Get SLA information based on priority\r\n   * Returns response time and resolution time expectations\r\n   */\r\n  const getSLAInfo = useMemo(() => {\r\n    const priority = PRIORITIES.find(p => p.value === selectedPriority);\r\n    return priority || PRIORITIES[1]; // Default to Medium\r\n  }, [selectedPriority]);\r\n\r\n  /**\r\n   * Get department based on selected category\r\n   * Auto-routes to appropriate team\r\n   */\r\n  const getAutoAssignedDepartment = useMemo(() => {\r\n    const category = CATEGORIES.find(c => c.value === selectedCategory);\r\n    return category?.department || 'Support Team';\r\n  }, [selectedCategory]);\r\n\r\n  /**\r\n   * Calculate SLA deadline based on priority and current date\r\n   */\r\n  const calculateSLADeadline = useCallback((resolutionHours: number) => {\r\n    return dayjs().add(resolutionHours, 'hours');\r\n  }, []);\r\n\r\n  /**\r\n   * Initialize form with ticket data when opening/editing\r\n   * Generates ticket number for new tickets\r\n   * Properly resets form when drawer closes to prevent instance warning\r\n   */\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      form.resetFields();\r\n      setAutoGeneratedTicketNumber('');\r\n      setSelectedPriority('medium');\r\n      setSelectedCategory(undefined);\r\n      setSelectedTags([]);\r\n      setCustomerAlert(null);\r\n      return;\r\n    }\r\n\r\n    // Generate ticket number for new tickets\r\n    if (mode === 'create' && !autoGeneratedTicketNumber) {\r\n      const newTicketNumber = generateTicketNumber();\r\n      setAutoGeneratedTicketNumber(newTicketNumber);\r\n      form.setFieldValue('ticket_number', newTicketNumber);\r\n    }\r\n\r\n    if (mode === 'edit' && ticket) {\r\n      // Populate form with existing ticket data\r\n      setSelectedPriority(ticket.priority || 'medium');\r\n      setSelectedCategory(ticket.category);\r\n      setSelectedTags(ticket.tags || []);\r\n      \r\n      // Check for customer alerts\r\n      if (ticket.customer_id) {\r\n        setCustomerAlert(`Customer: ${ticket.customer_name || ticket.customer_id}`);\r\n      }\r\n\r\n      form.setFieldsValue({\r\n        ticket_number: ticket.id,\r\n        title: ticket.title,\r\n        description: ticket.description,\r\n        priority: ticket.priority || 'medium',\r\n        status: ticket.status || 'open',\r\n        customer_id: ticket.customer_id,\r\n        assigned_to: ticket.assigned_to,\r\n        category: ticket.category,\r\n        due_date: ticket.due_date ? dayjs(ticket.due_date) : undefined,\r\n        tags: ticket.tags?.join(', '),\r\n      });\r\n    } else if (mode === 'create') {\r\n      form.resetFields();\r\n      setSelectedPriority('medium');\r\n      setSelectedCategory(undefined);\r\n      setSelectedTags([]);\r\n      setCustomerAlert(null);\r\n    }\r\n  }, [mode, ticket, isOpen, form, autoGeneratedTicketNumber]);\r\n\r\n  /**\r\n   * Handle form submission for create/update operations\r\n   * Validates data, calls appropriate mutation, and closes drawer on success\r\n   */\r\n  const handleSubmit = useCallback(\r\n    async (values: any) => {\r\n      try {\r\n        const data = {\r\n          title: values.title,\r\n          description: values.description,\r\n          priority: values.priority,\r\n          status: values.status || 'open',\r\n          customer_id: values.customer_id,\r\n          assigned_to: values.assigned_to,\r\n          category: values.category,\r\n          due_date: values.due_date ? values.due_date.format('YYYY-MM-DD') : undefined,\r\n          tags: values.tags\r\n            ? values.tags\r\n                .split(',')\r\n                .map((tag: string) => tag.trim())\r\n                .filter((tag: string) => tag.length > 0)\r\n            : [],\r\n        };\r\n\r\n        if (mode === 'create') {\r\n          await createTicket.mutateAsync(data);\r\n          message.success('Ticket created successfully');\r\n        } else if (ticket) {\r\n          await updateTicket.mutateAsync({\r\n            id: ticket.id,\r\n            data,\r\n          });\r\n          message.success('Ticket updated successfully');\r\n        }\r\n\r\n        onClose();\r\n        form.resetFields();\r\n      } catch (error) {\r\n        const errorMsg = error instanceof Error ? error.message : 'An error occurred';\r\n        message.error(errorMsg);\r\n        console.error('Error submitting ticket form:', error);\r\n      }\r\n    },\r\n    [mode, ticket, createTicket, updateTicket, form, onClose]\r\n  );\r\n\r\n  /**\r\n   * Handle drawer close event\r\n   * Ensures form is reset and any pending changes are discarded\r\n   */\r\n  const handleDrawerClose = useCallback(() => {\r\n    form.resetFields();\r\n    setAutoGeneratedTicketNumber('');\r\n    setSelectedPriority('medium');\r\n    setSelectedCategory(undefined);\r\n    setSelectedTags([]);\r\n    setCustomerAlert(null);\r\n    onClose();\r\n  }, [form, onClose]);\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>\r\n          <span>{mode === 'create' ? '‚ú® Create New Support Ticket' : 'üìù Edit Support Ticket'}</span>\r\n          {autoGeneratedTicketNumber && (\r\n            <Badge count={autoGeneratedTicketNumber} style={{ backgroundColor: '#1890ff' }} />\r\n          )}\r\n        </div>\r\n      }\r\n      placement=\"right\"\r\n      onClose={handleDrawerClose}\r\n      open={isOpen}\r\n      width={620}\r\n      styles={{ body: { padding: '24px' } }}\r\n      footer={\r\n        <Space style={{ float: 'right' }}>\r\n          <Button onClick={handleDrawerClose} disabled={isLoading}>\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            type=\"primary\"\r\n            loading={isLoading}\r\n            size=\"large\"\r\n            onClick={() => {\r\n              form\r\n                .validateFields()\r\n                .then((values) => {\r\n                  handleSubmit(values);\r\n                })\r\n                .catch((err) => {\r\n                  console.error('Form validation failed:', err);\r\n                });\r\n            }}\r\n          >\r\n            {mode === 'create' ? '‚úì Create Ticket' : '‚úì Update Ticket'}\r\n          </Button>\r\n        </Space>\r\n      }\r\n    >\r\n      <Spin spinning={isLoading}>\r\n        {/* Customer Alert */}\r\n        {customerAlert && (\r\n          <Alert\r\n            message={customerAlert}\r\n            type=\"info\"\r\n            icon={<LinkOutlined />}\r\n            showIcon\r\n            closable\r\n            style={{ marginBottom: 16 }}\r\n          />\r\n        )}\r\n\r\n        {/* SLA & Priority Info Card */}\r\n        <Card\r\n          size=\"small\"\r\n          style={{ marginBottom: 20, backgroundColor: '#fafafa' }}\r\n          title={\r\n            <span>\r\n              <ClockCircleOutlined style={{ marginRight: 8 }} />\r\n              SLA Response Times\r\n            </span>\r\n          }\r\n        >\r\n          <Row gutter={16}>\r\n            <Col xs={12}>\r\n              <Statistic\r\n                title=\"Response Time\"\r\n                value={getSLAInfo.responseTime}\r\n                prefix={<ClockCircleOutlined />}\r\n              />\r\n            </Col>\r\n            <Col xs={12}>\r\n              <Statistic\r\n                title=\"Resolution Time\"\r\n                value={getSLAInfo.resolutionTime}\r\n                prefix={<AlertOutlined />}\r\n              />\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          onFinish={handleSubmit}\r\n          autoComplete=\"off\"\r\n          scrollToFirstError\r\n        >\r\n          {/* Ticket Number - Read Only */}\r\n          {autoGeneratedTicketNumber && (\r\n            <Form.Item\r\n              label={\r\n                <span>\r\n                  <FileTextOutlined style={{ marginRight: 6 }} />\r\n                  Ticket Number\r\n                </span>\r\n              }\r\n              name=\"ticket_number\"\r\n            >\r\n              <Input\r\n                disabled\r\n                prefix={<LockOutlined style={{ color: '#bfbfbf' }} />}\r\n                style={{ color: '#666' }}\r\n              />\r\n            </Form.Item>\r\n          )}\r\n\r\n          <Divider style={{ margin: '16px 0' }}>üìã Ticket Information</Divider>\r\n\r\n          {/* Title */}\r\n          <Form.Item\r\n            label=\"Ticket Title\"\r\n            name=\"title\"\r\n            tooltip=\"Brief summary of the issue (max 255 characters)\"\r\n            rules={[\r\n              { required: true, message: 'Title is required' },\r\n              { max: 255, message: 'Title cannot exceed 255 characters' },\r\n            ]}\r\n          >\r\n            <Input\r\n              placeholder=\"e.g., Cannot login to account\"\r\n              maxLength={255}\r\n              size=\"large\"\r\n              prefix={<FileTextOutlined />}\r\n            />\r\n          </Form.Item>\r\n\r\n          {/* Description */}\r\n          <Form.Item\r\n            label=\"Detailed Description\"\r\n            name=\"description\"\r\n            tooltip=\"Provide detailed information about the issue\"\r\n            rules={[\r\n              { required: true, message: 'Description is required' },\r\n              { min: 10, message: 'Description should be at least 10 characters' },\r\n            ]}\r\n          >\r\n            <Input.TextArea\r\n              placeholder=\"Describe the issue in detail... Include what you've tried, any error messages, and relevant context.\"\r\n              rows={5}\r\n              maxLength={2000}\r\n              showCount\r\n              size=\"large\"\r\n            />\r\n          </Form.Item>\r\n\r\n          <Divider style={{ margin: '16px 0' }}>üéØ Categorization & Routing</Divider>\r\n\r\n          {/* Category & Priority Row */}\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label={\r\n                  <span>\r\n                    <BgColorsOutlined style={{ marginRight: 6 }} />\r\n                    Category\r\n                  </span>\r\n                }\r\n                name=\"category\"\r\n                tooltip=\"Select the category to auto-route to the appropriate team\"\r\n                rules={[{ required: true, message: 'Category is required' }]}\r\n              >\r\n                <Select\r\n                  placeholder=\"Select category\"\r\n                  size=\"large\"\r\n                  onChange={(value) => setSelectedCategory(value)}\r\n                  options={CATEGORIES}\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label={\r\n                  <span>\r\n                    <AlertOutlined style={{ marginRight: 6 }} />\r\n                    Priority\r\n                  </span>\r\n                }\r\n                name=\"priority\"\r\n                tooltip=\"Priority determines response time SLA\"\r\n                rules={[{ required: true, message: 'Priority is required' }]}\r\n              >\r\n                <Select\r\n                  placeholder=\"Select priority\"\r\n                  size=\"large\"\r\n                  onChange={(value) => setSelectedPriority(value)}\r\n                  options={PRIORITIES.map(p => ({\r\n                    label: (\r\n                      <span>\r\n                        <Tag color={p.color} style={{ marginRight: 4 }}>\r\n                          {p.label}\r\n                        </Tag>\r\n                        {p.responseTime}\r\n                      </span>\r\n                    ),\r\n                    value: p.value,\r\n                  }))}\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          {/* Status & Assignment Row */}\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label=\"Status\"\r\n                name=\"status\"\r\n                tooltip=\"Current status of the ticket\"\r\n              >\r\n                <Select\r\n                  placeholder=\"Select status\"\r\n                  size=\"large\"\r\n                  options={STATUSES.map(s => ({\r\n                    label: (\r\n                      <span>\r\n                        <Tag color={s.color}>{s.icon} {s.label}</Tag>\r\n                      </span>\r\n                    ),\r\n                    value: s.value,\r\n                  }))}\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                label={\r\n                  <Tooltip title={`Auto-routed to: ${getAutoAssignedDepartment}`}>\r\n                    <span>\r\n                      <UserOutlined style={{ marginRight: 6 }} />\r\n                      Assigned To\r\n                    </span>\r\n                  </Tooltip>\r\n                }\r\n                name=\"assigned_to\"\r\n                tooltip=\"Team member or queue to handle this ticket\"\r\n              >\r\n                <Input\r\n                  placeholder=\"Enter user ID or select from team\"\r\n                  size=\"large\"\r\n                  prefix={<UserOutlined />}\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Divider style={{ margin: '16px 0' }}>üë§ Customer Information</Divider>\r\n\r\n          {/* Customer ID */}\r\n          <Form.Item\r\n            label=\"Customer\"\r\n            name=\"customer_id\"\r\n            tooltip=\"Link this ticket to a customer\"\r\n            rules={[{ required: true, message: 'Customer is required' }]}\r\n          >\r\n            <Input\r\n              placeholder=\"Enter customer ID or name\"\r\n              size=\"large\"\r\n              prefix={<UserOutlined />}\r\n            />\r\n          </Form.Item>\r\n\r\n          <Divider style={{ margin: '16px 0' }}>üìÖ Timeline & Deadlines</Divider>\r\n\r\n          {/* Due Date */}\r\n          <Form.Item\r\n            label={\r\n              <span>\r\n                <ClockCircleOutlined style={{ marginRight: 6 }} />\r\n                Due Date / SLA Deadline\r\n              </span>\r\n            }\r\n            name=\"due_date\"\r\n            tooltip={`Based on ${getSLAInfo.label} priority: ${getSLAInfo.resolutionTime} to resolve`}\r\n          >\r\n            <DatePicker\r\n              style={{ width: '100%' }}\r\n              size=\"large\"\r\n              format=\"YYYY-MM-DD HH:mm\"\r\n              showTime\r\n              placeholder=\"Select SLA deadline\"\r\n            />\r\n          </Form.Item>\r\n\r\n          <Divider style={{ margin: '16px 0' }}>üè∑Ô∏è Tags & Metadata</Divider>\r\n\r\n          {/* Tags with Suggestions */}\r\n          <Form.Item\r\n            label=\"Tags\"\r\n            name=\"tags\"\r\n            tooltip=\"Add tags for better tracking and filtering (comma-separated)\"\r\n          >\r\n            <Input\r\n              placeholder=\"e.g., urgent, follow-up, escalation (comma-separated)\"\r\n              size=\"large\"\r\n              maxLength={500}\r\n            />\r\n          </Form.Item>\r\n\r\n          {/* Suggested Tags */}\r\n          <div style={{ marginBottom: 16 }}>\r\n            <span style={{ fontSize: 12, color: '#666', fontWeight: 500 }}>Suggested Tags:</span>\r\n            <div style={{ marginTop: 8, display: 'flex', flexWrap: 'wrap', gap: 6 }}>\r\n              {SUGGESTED_TAGS.map((tag) => (\r\n                <Tag\r\n                  key={tag}\r\n                  style={{ cursor: 'pointer', fontSize: 12 }}\r\n                  onClick={() => {\r\n                    const currentTags = form.getFieldValue('tags') || '';\r\n                    const tagsArray = currentTags\r\n                      .split(',')\r\n                      .map((t: string) => t.trim())\r\n                      .filter((t: string) => t.length > 0);\r\n                    \r\n                    if (!tagsArray.includes(tag)) {\r\n                      tagsArray.push(tag);\r\n                      form.setFieldValue('tags', tagsArray.join(', '));\r\n                    }\r\n                  }}\r\n                >\r\n                  + {tag}\r\n                </Tag>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </Form>\r\n\r\n        {/* Footer Info */}\r\n        <div style={{ marginTop: 24, padding: '16px', backgroundColor: '#f5f5f5', borderRadius: 4 }}>\r\n          <p style={{ margin: 0, fontSize: 12, color: '#666' }}>\r\n            üí° <strong>Pro Tips:</strong> Higher priority tickets get faster response times. \r\n            Assign to the correct category to ensure proper routing. Use tags for better organization.\r\n          </p>\r\n        </div>\r\n      </Spin>\r\n    </Drawer>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\components\\TicketsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\hooks\\useTickets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":16,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":16,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tickets Routes\r\n * Route definitions for the tickets module\r\n */\r\n\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components for code splitting\r\nconst TicketsPage = lazy(() => import('./views/TicketsPage').then(m => ({ default: m.TicketsPage })));\r\nconst TicketDetailPage = lazy(() => import('./views/TicketDetailPage').then(m => ({ default: m.TicketDetailPage })));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading tickets...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const ticketsRoutes: RouteObject[] = [\r\n  {\r\n    path: 'tickets',\r\n    element: (\r\n      <RouteWrapper>\r\n        <TicketsPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n  {\r\n    path: 'tickets/:id',\r\n    element: (\r\n      <RouteWrapper>\r\n        <TicketDetailPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];\r\n\r\nexport default ticketsRoutes;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\services\\ticketService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\store\\ticketStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\views\\TicketDetailPage.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadTicketData'. Either include it or remove the dependency array.","line":107,"column":6,"nodeType":"ArrayExpression","endLine":107,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadTicketData]","fix":{"range":[2593,2597],"text":"[id, loadTicketData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Ticket Detail Page\r\n * Comprehensive ticket view with comments, attachments, and activity timeline\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport {\r\n  Card,\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Space,\r\n  Tag,\r\n  Descriptions,\r\n  Timeline,\r\n  Input,\r\n  Upload,\r\n  List,\r\n  Avatar,\r\n  Dropdown,\r\n  Modal,\r\n  Form,\r\n  Select,\r\n  message,\r\n  Spin,\r\n  Empty,\r\n  Divider,\r\n  Typography,\r\n  Badge,\r\n} from 'antd';\r\nimport {\r\n  ArrowLeftOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  MoreOutlined,\r\n  SendOutlined,\r\n  PaperClipOutlined,\r\n  DownloadOutlined,\r\n  ClockCircleOutlined,\r\n  UserOutlined,\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  ExclamationCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport { PageHeader } from '@/components/common';\r\nimport { ticketService } from '@/services/ticketService';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport type { Ticket } from '@/types/crm';\r\n\r\nconst { TextArea } = Input;\r\nconst { Text, Title } = Typography;\r\n\r\ninterface TicketComment {\r\n  id: string;\r\n  ticket_id: string;\r\n  user_id: string;\r\n  user_name: string;\r\n  user_avatar?: string;\r\n  comment: string;\r\n  is_internal: boolean;\r\n  created_at: string;\r\n}\r\n\r\ninterface TicketAttachment {\r\n  id: string;\r\n  ticket_id: string;\r\n  file_name: string;\r\n  file_size: number;\r\n  file_type: string;\r\n  uploaded_by: string;\r\n  uploaded_by_name: string;\r\n  uploaded_at: string;\r\n  url: string;\r\n}\r\n\r\ninterface TicketActivity {\r\n  id: string;\r\n  ticket_id: string;\r\n  user_name: string;\r\n  action: string;\r\n  description: string;\r\n  created_at: string;\r\n  type: 'status' | 'assignment' | 'priority' | 'comment' | 'attachment' | 'created';\r\n}\r\n\r\nexport const TicketDetailPage: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { hasPermission } = useAuth();\r\n  const [form] = Form.useForm();\r\n\r\n  const [ticket, setTicket] = useState<Ticket | null>(null);\r\n  const [comments, setComments] = useState<TicketComment[]>([]);\r\n  const [attachments, setAttachments] = useState<TicketAttachment[]>([]);\r\n  const [activities, setActivities] = useState<TicketActivity[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [submittingComment, setSubmittingComment] = useState(false);\r\n  const [commentText, setCommentText] = useState('');\r\n  const [isInternal, setIsInternal] = useState(false);\r\n  const [editModalVisible, setEditModalVisible] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      loadTicketData();\r\n    }\r\n  }, [id]);\r\n\r\n  const loadTicketData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const ticketData = await ticketService.getTicket(id!);\r\n      setTicket(ticketData);\r\n\r\n      // Load mock comments\r\n      setComments([\r\n        {\r\n          id: '1',\r\n          ticket_id: id!,\r\n          user_id: '1',\r\n          user_name: 'John Admin',\r\n          comment: 'I have reviewed this ticket and assigned it to our technical team for investigation.',\r\n          is_internal: false,\r\n          created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),\r\n        },\r\n        {\r\n          id: '2',\r\n          ticket_id: id!,\r\n          user_id: '3',\r\n          user_name: 'Mike Agent',\r\n          comment: 'Internal note: This appears to be related to the recent server upgrade. Checking logs.',\r\n          is_internal: true,\r\n          created_at: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),\r\n        },\r\n        {\r\n          id: '3',\r\n          ticket_id: id!,\r\n          user_id: '3',\r\n          user_name: 'Mike Agent',\r\n          comment: 'We have identified the root cause and are working on a fix. Expected resolution within 24 hours.',\r\n          is_internal: false,\r\n          created_at: new Date(Date.now() - 30 * 60 * 1000).toISOString(),\r\n        },\r\n      ]);\r\n\r\n      // Load mock attachments\r\n      setAttachments([\r\n        {\r\n          id: '1',\r\n          ticket_id: id!,\r\n          file_name: 'error-screenshot.png',\r\n          file_size: 245678,\r\n          file_type: 'image/png',\r\n          uploaded_by: '1',\r\n          uploaded_by_name: 'John Admin',\r\n          uploaded_at: new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString(),\r\n          url: '#',\r\n        },\r\n        {\r\n          id: '2',\r\n          ticket_id: id!,\r\n          file_name: 'system-logs.txt',\r\n          file_size: 12345,\r\n          file_type: 'text/plain',\r\n          uploaded_by: '3',\r\n          uploaded_by_name: 'Mike Agent',\r\n          uploaded_at: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),\r\n          url: '#',\r\n        },\r\n      ]);\r\n\r\n      // Load mock activities\r\n      setActivities([\r\n        {\r\n          id: '1',\r\n          ticket_id: id!,\r\n          user_name: 'System',\r\n          action: 'created',\r\n          description: 'Ticket created',\r\n          created_at: ticketData.created_at,\r\n          type: 'created',\r\n        },\r\n        {\r\n          id: '2',\r\n          ticket_id: id!,\r\n          user_name: 'John Admin',\r\n          action: 'assigned',\r\n          description: 'Assigned to Mike Agent',\r\n          created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),\r\n          type: 'assignment',\r\n        },\r\n        {\r\n          id: '3',\r\n          ticket_id: id!,\r\n          user_name: 'Mike Agent',\r\n          action: 'status_changed',\r\n          description: 'Status changed from Open to In Progress',\r\n          created_at: new Date(Date.now() - 1.5 * 60 * 60 * 1000).toISOString(),\r\n          type: 'status',\r\n        },\r\n        {\r\n          id: '4',\r\n          ticket_id: id!,\r\n          user_name: 'Mike Agent',\r\n          action: 'priority_changed',\r\n          description: 'Priority changed from Medium to High',\r\n          created_at: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),\r\n          type: 'priority',\r\n        },\r\n      ]);\r\n    } catch (error) {\r\n      message.error('Failed to load ticket details');\r\n      console.error('Error loading ticket:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddComment = async () => {\r\n    if (!commentText.trim()) {\r\n      message.warning('Please enter a comment');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSubmittingComment(true);\r\n      \r\n      // Simulate API call\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n      const newComment: TicketComment = {\r\n        id: Date.now().toString(),\r\n        ticket_id: id!,\r\n        user_id: '1',\r\n        user_name: 'Current User',\r\n        comment: commentText,\r\n        is_internal: isInternal,\r\n        created_at: new Date().toISOString(),\r\n      };\r\n\r\n      setComments([...comments, newComment]);\r\n      setCommentText('');\r\n      setIsInternal(false);\r\n      message.success('Comment added successfully');\r\n\r\n      // Add activity\r\n      const newActivity: TicketActivity = {\r\n        id: Date.now().toString(),\r\n        ticket_id: id!,\r\n        user_name: 'Current User',\r\n        action: 'commented',\r\n        description: isInternal ? 'Added internal note' : 'Added comment',\r\n        created_at: new Date().toISOString(),\r\n        type: 'comment',\r\n      };\r\n      setActivities([...activities, newActivity]);\r\n    } catch (error) {\r\n      message.error('Failed to add comment');\r\n    } finally {\r\n      setSubmittingComment(false);\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (newStatus: string) => {\r\n    try {\r\n      const typedStatus = newStatus as 'open' | 'in_progress' | 'pending' | 'resolved' | 'closed';\r\n      await ticketService.updateTicket(id!, { status: typedStatus });\r\n      setTicket({ ...ticket!, status: typedStatus });\r\n      message.success('Status updated successfully');\r\n\r\n      // Add activity\r\n      const newActivity: TicketActivity = {\r\n        id: Date.now().toString(),\r\n        ticket_id: id!,\r\n        user_name: 'Current User',\r\n        action: 'status_changed',\r\n        description: `Status changed to ${newStatus}`,\r\n        created_at: new Date().toISOString(),\r\n        type: 'status',\r\n      };\r\n      setActivities([...activities, newActivity]);\r\n    } catch (error) {\r\n      message.error('Failed to update status');\r\n    }\r\n  };\r\n\r\n  const handlePriorityChange = async (newPriority: string) => {\r\n    try {\r\n      const typedPriority = newPriority as 'low' | 'medium' | 'high' | 'urgent';\r\n      await ticketService.updateTicket(id!, { priority: typedPriority });\r\n      setTicket({ ...ticket!, priority: typedPriority });\r\n      message.success('Priority updated successfully');\r\n\r\n      // Add activity\r\n      const newActivity: TicketActivity = {\r\n        id: Date.now().toString(),\r\n        ticket_id: id!,\r\n        user_name: 'Current User',\r\n        action: 'priority_changed',\r\n        description: `Priority changed to ${newPriority}`,\r\n        created_at: new Date().toISOString(),\r\n        type: 'priority',\r\n      };\r\n      setActivities([...activities, newActivity]);\r\n    } catch (error) {\r\n      message.error('Failed to update priority');\r\n    }\r\n  };\r\n\r\n  const handleDeleteTicket = () => {\r\n    Modal.confirm({\r\n      title: 'Delete Ticket',\r\n      content: 'Are you sure you want to delete this ticket? This action cannot be undone.',\r\n      okText: 'Delete',\r\n      okType: 'danger',\r\n      onOk: async () => {\r\n        try {\r\n          await ticketService.deleteTicket(id!);\r\n          message.success('Ticket deleted successfully');\r\n          navigate('/tenant/tickets');\r\n        } catch (error) {\r\n          message.error('Failed to delete ticket');\r\n        }\r\n      },\r\n    });\r\n  };\r\n\r\n  const handleFileUpload = async (file: File) => {\r\n    try {\r\n      // Simulate file upload\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n      const newAttachment: TicketAttachment = {\r\n        id: Date.now().toString(),\r\n        ticket_id: id!,\r\n        file_name: file.name,\r\n        file_size: file.size,\r\n        file_type: file.type,\r\n        uploaded_by: '1',\r\n        uploaded_by_name: 'Current User',\r\n        uploaded_at: new Date().toISOString(),\r\n        url: URL.createObjectURL(file),\r\n      };\r\n\r\n      setAttachments([...attachments, newAttachment]);\r\n      message.success('File uploaded successfully');\r\n\r\n      // Add activity\r\n      const newActivity: TicketActivity = {\r\n        id: Date.now().toString(),\r\n        ticket_id: id!,\r\n        user_name: 'Current User',\r\n        action: 'attachment_added',\r\n        description: `Uploaded ${file.name}`,\r\n        created_at: new Date().toISOString(),\r\n        type: 'attachment',\r\n      };\r\n      setActivities([...activities, newActivity]);\r\n    } catch (error) {\r\n      message.error('Failed to upload file');\r\n    }\r\n    return false; // Prevent default upload behavior\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    const colors: Record<string, string> = {\r\n      open: 'blue',\r\n      in_progress: 'orange',\r\n      pending: 'purple',\r\n      resolved: 'green',\r\n      closed: 'default',\r\n    };\r\n    return colors[status] || 'default';\r\n  };\r\n\r\n  const getPriorityColor = (priority: string) => {\r\n    const colors: Record<string, string> = {\r\n      urgent: 'red',\r\n      high: 'orange',\r\n      medium: 'blue',\r\n      low: 'default',\r\n    };\r\n    return colors[priority] || 'default';\r\n  };\r\n\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes < 1024) return bytes + ' B';\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';\r\n    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';\r\n  };\r\n\r\n  const formatTimeAgo = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n    const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n    if (diffMins < 1) return 'Just now';\r\n    if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;\r\n    if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\r\n    return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\r\n  };\r\n\r\n  const getActivityIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'created':\r\n        return <ExclamationCircleOutlined style={{ color: '#1890ff' }} />;\r\n      case 'status':\r\n        return <CheckCircleOutlined style={{ color: '#52c41a' }} />;\r\n      case 'assignment':\r\n        return <UserOutlined style={{ color: '#722ed1' }} />;\r\n      case 'priority':\r\n        return <ExclamationCircleOutlined style={{ color: '#fa8c16' }} />;\r\n      case 'comment':\r\n        return <ClockCircleOutlined style={{ color: '#13c2c2' }} />;\r\n      case 'attachment':\r\n        return <PaperClipOutlined style={{ color: '#eb2f96' }} />;\r\n      default:\r\n        return <ClockCircleOutlined />;\r\n    }\r\n  };\r\n\r\n  const actionMenuItems = [\r\n    {\r\n      key: 'edit',\r\n      label: 'Edit Ticket',\r\n      icon: <EditOutlined />,\r\n      onClick: () => setEditModalVisible(true),\r\n      disabled: !hasPermission('write'),\r\n    },\r\n    {\r\n      key: 'delete',\r\n      label: 'Delete Ticket',\r\n      icon: <DeleteOutlined />,\r\n      onClick: handleDeleteTicket,\r\n      disabled: !hasPermission('delete'),\r\n      danger: true,\r\n    },\r\n  ];\r\n\r\n  if (loading) {\r\n    return (\r\n      <>\r\n        <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '400px' }}>\r\n          <Spin size=\"large\" />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (!ticket) {\r\n    return (\r\n      <>\r\n        <Empty description=\"Ticket not found\" />\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title={`Ticket #${ticket.id}`}\r\n        description={ticket.title}\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/tenant/dashboard' },\r\n            { title: 'Tickets', path: '/tenant/tickets' },\r\n            { title: `#${ticket.id}` },\r\n          ],\r\n        }}\r\n        extra={\r\n          <Space>\r\n            <Button icon={<ArrowLeftOutlined />} onClick={() => navigate('/tenant/tickets')}>\r\n              Back\r\n            </Button>\r\n            <Dropdown menu={{ items: actionMenuItems }} trigger={['click']}>\r\n              <Button icon={<MoreOutlined />}>Actions</Button>\r\n            </Dropdown>\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        <Row gutter={[24, 24]}>\r\n          {/* Main Content */}\r\n          <Col xs={24} lg={16}>\r\n            {/* Ticket Details */}\r\n            <Card title=\"Ticket Details\" style={{ marginBottom: 24 }}>\r\n              <Descriptions column={{ xs: 1, sm: 2 }} bordered>\r\n                <Descriptions.Item label=\"Status\">\r\n                  <Select\r\n                    value={ticket.status}\r\n                    onChange={handleStatusChange}\r\n                    style={{ width: 150 }}\r\n                    disabled={!hasPermission('write')}\r\n                  >\r\n                    <Select.Option value=\"open\">Open</Select.Option>\r\n                    <Select.Option value=\"in_progress\">In Progress</Select.Option>\r\n                    <Select.Option value=\"pending\">Pending</Select.Option>\r\n                    <Select.Option value=\"resolved\">Resolved</Select.Option>\r\n                    <Select.Option value=\"closed\">Closed</Select.Option>\r\n                  </Select>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Priority\">\r\n                  <Select\r\n                    value={ticket.priority}\r\n                    onChange={handlePriorityChange}\r\n                    style={{ width: 150 }}\r\n                    disabled={!hasPermission('write')}\r\n                  >\r\n                    <Select.Option value=\"urgent\">Urgent</Select.Option>\r\n                    <Select.Option value=\"high\">High</Select.Option>\r\n                    <Select.Option value=\"medium\">Medium</Select.Option>\r\n                    <Select.Option value=\"low\">Low</Select.Option>\r\n                  </Select>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Customer\">{ticket.customer_name}</Descriptions.Item>\r\n                <Descriptions.Item label=\"Category\">\r\n                  <Tag>{ticket.category}</Tag>\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Assigned To\">{ticket.assigned_to_name}</Descriptions.Item>\r\n                <Descriptions.Item label=\"Created\">\r\n                  {new Date(ticket.created_at).toLocaleString()}\r\n                </Descriptions.Item>\r\n                <Descriptions.Item label=\"Last Updated\">\r\n                  {new Date(ticket.updated_at).toLocaleString()}\r\n                </Descriptions.Item>\r\n                {ticket.resolved_at && (\r\n                  <Descriptions.Item label=\"Resolved\">\r\n                    {new Date(ticket.resolved_at).toLocaleString()}\r\n                  </Descriptions.Item>\r\n                )}\r\n              </Descriptions>\r\n\r\n              <Divider />\r\n\r\n              <div>\r\n                <Title level={5}>Description</Title>\r\n                <Text>{ticket.description}</Text>\r\n              </div>\r\n            </Card>\r\n\r\n            {/* Comments Section */}\r\n            <Card title=\"Comments\" style={{ marginBottom: 24 }}>\r\n              <List\r\n                dataSource={comments}\r\n                renderItem={(comment) => (\r\n                  <List.Item>\r\n                    <List.Item.Meta\r\n                      avatar={<Avatar icon={<UserOutlined />} />}\r\n                      title={\r\n                        <Space>\r\n                          <Text strong>{comment.user_name}</Text>\r\n                          <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                            {formatTimeAgo(comment.created_at)}\r\n                          </Text>\r\n                          {comment.is_internal && (\r\n                            <Tag color=\"orange\" style={{ fontSize: 11 }}>\r\n                              Internal\r\n                            </Tag>\r\n                          )}\r\n                        </Space>\r\n                      }\r\n                      description={comment.comment}\r\n                    />\r\n                  </List.Item>\r\n                )}\r\n              />\r\n\r\n              <Divider />\r\n\r\n              <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                <TextArea\r\n                  rows={4}\r\n                  placeholder=\"Add a comment...\"\r\n                  value={commentText}\r\n                  onChange={(e) => setCommentText(e.target.value)}\r\n                />\r\n                <Space>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    icon={<SendOutlined />}\r\n                    onClick={handleAddComment}\r\n                    loading={submittingComment}\r\n                  >\r\n                    Add Comment\r\n                  </Button>\r\n                  <Button\r\n                    type={isInternal ? 'default' : 'text'}\r\n                    onClick={() => setIsInternal(!isInternal)}\r\n                  >\r\n                    {isInternal ? 'üîí Internal Note' : 'üëÅÔ∏è Public Comment'}\r\n                  </Button>\r\n                </Space>\r\n              </Space>\r\n            </Card>\r\n\r\n            {/* Attachments Section */}\r\n            <Card\r\n              title=\"Attachments\"\r\n              extra={\r\n                <Upload beforeUpload={handleFileUpload} showUploadList={false}>\r\n                  <Button icon={<PaperClipOutlined />} size=\"small\">\r\n                    Upload\r\n                  </Button>\r\n                </Upload>\r\n              }\r\n            >\r\n              {attachments.length === 0 ? (\r\n                <Empty description=\"No attachments\" />\r\n              ) : (\r\n                <List\r\n                  dataSource={attachments}\r\n                  renderItem={(attachment) => (\r\n                    <List.Item\r\n                      actions={[\r\n                        <Button\r\n                          type=\"link\"\r\n                          icon={<DownloadOutlined />}\r\n                          onClick={() => window.open(attachment.url, '_blank')}\r\n                        >\r\n                          Download\r\n                        </Button>,\r\n                      ]}\r\n                    >\r\n                      <List.Item.Meta\r\n                        avatar={<Avatar icon={<PaperClipOutlined />} />}\r\n                        title={attachment.file_name}\r\n                        description={\r\n                          <Space>\r\n                            <Text type=\"secondary\">{formatFileSize(attachment.file_size)}</Text>\r\n                            <Text type=\"secondary\">‚Ä¢</Text>\r\n                            <Text type=\"secondary\">\r\n                              Uploaded by {attachment.uploaded_by_name}\r\n                            </Text>\r\n                            <Text type=\"secondary\">‚Ä¢</Text>\r\n                            <Text type=\"secondary\">\r\n                              {formatTimeAgo(attachment.uploaded_at)}\r\n                            </Text>\r\n                          </Space>\r\n                        }\r\n                      />\r\n                    </List.Item>\r\n                  )}\r\n                />\r\n              )}\r\n            </Card>\r\n          </Col>\r\n\r\n          {/* Sidebar */}\r\n          <Col xs={24} lg={8}>\r\n            {/* Activity Timeline */}\r\n            <Card title=\"Activity Timeline\">\r\n              <Timeline\r\n                items={activities.map((activity) => ({\r\n                  key: activity.id,\r\n                  dot: getActivityIcon(activity.type),\r\n                  children: (\r\n                    <>\r\n                      <Text strong>{activity.user_name}</Text>\r\n                      <br />\r\n                      <Text type=\"secondary\">{activity.description}</Text>\r\n                      <br />\r\n                      <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                        {formatTimeAgo(activity.created_at)}\r\n                      </Text>\r\n                    </>\r\n                  ),\r\n                }))}\r\n              />\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      </div>\r\n    </>\r\n  );\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\tickets\\views\\TicketsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2275,2278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2275,2278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5831,5834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5831,5834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6535,6538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6535,6538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7889,7892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7889,7892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tickets Page - Modern Architecture\r\n * Enterprise-grade ticket management with Ant Design table and side drawers\r\n */\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport { Table, Button, Space, Input, Select, Row, Col, Tag, Empty, Spin, Popconfirm } from 'antd';\r\nimport { PlusOutlined, DeleteOutlined, EyeOutlined, EditOutlined, SearchOutlined } from '@ant-design/icons';\r\nimport { Ticket } from '@/types/crm';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { TicketsDetailPanel } from '../components/TicketsDetailPanel';\r\nimport { TicketsFormPanel } from '../components/TicketsFormPanel';\r\nimport { useTickets, useTicketStats, useDeleteTicket } from '../hooks/useTickets';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n  AlertCircle,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n} from 'lucide-react';\r\n\r\ntype DrawerMode = 'create' | 'edit' | 'view' | null;\r\n\r\n/**\r\n * Status color mapping for tags\r\n */\r\nconst statusColors: Record<string, string> = {\r\n  open: 'warning',\r\n  in_progress: 'processing',\r\n  resolved: 'success',\r\n  closed: 'default',\r\n  pending: 'warning',\r\n};\r\n\r\n/**\r\n * Priority color mapping for tags\r\n */\r\nconst priorityColors: Record<string, string> = {\r\n  low: 'default',\r\n  medium: 'blue',\r\n  high: 'orange',\r\n  urgent: 'red',\r\n};\r\n\r\n/**\r\n * Status icon mapping\r\n */\r\nconst statusIcons: Record<string, React.ComponentType<React.SVGProps<SVGSVGElement>>> = {\r\n  open: AlertCircle,\r\n  in_progress: Clock,\r\n  resolved: CheckCircle,\r\n  closed: XCircle,\r\n};\r\n\r\nexport const TicketsPage: React.FC = () => {\r\n  const { hasPermission } = useAuth();\r\n  const { data: ticketsData, isLoading: ticketsLoading } = useTickets();\r\n  const { data: statsData, isLoading: statsLoading } = useTicketStats();\r\n  const deleteTicket = useDeleteTicket();\r\n\r\n  // State management\r\n  const [drawerMode, setDrawerMode] = useState<DrawerMode>(null);\r\n  const [selectedTicket, setSelectedTicket] = useState<Ticket | null>(null);\r\n  const [searchText, setSearchText] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<string | undefined>(undefined);\r\n  const [priorityFilter, setPriorityFilter] = useState<string | undefined>(undefined);\r\n  const [sortedInfo, setSortedInfo] = useState<any>(null);\r\n\r\n  // Filtered data based on search and filters\r\n  const filteredTickets = useMemo(() => {\r\n    let result = ticketsData?.data || [];\r\n\r\n    if (searchText) {\r\n      const search = searchText.toLowerCase();\r\n      result = result.filter(\r\n        (ticket) =>\r\n          ticket.title.toLowerCase().includes(search) ||\r\n          ticket.description?.toLowerCase().includes(search) ||\r\n          ticket.customer_name?.toLowerCase().includes(search) ||\r\n          ticket.id.includes(search)\r\n      );\r\n    }\r\n\r\n    if (statusFilter && statusFilter !== 'all') {\r\n      result = result.filter((ticket) => ticket.status === statusFilter);\r\n    }\r\n\r\n    if (priorityFilter && priorityFilter !== 'all') {\r\n      result = result.filter((ticket) => ticket.priority === priorityFilter);\r\n    }\r\n\r\n    return result;\r\n  }, [ticketsData?.data, searchText, statusFilter, priorityFilter]);\r\n\r\n  // Handler functions\r\n  const handleCreateClick = () => {\r\n    setSelectedTicket(null);\r\n    setDrawerMode('create');\r\n  };\r\n\r\n  const handleViewClick = (ticket: Ticket) => {\r\n    setSelectedTicket(ticket);\r\n    setDrawerMode('view');\r\n  };\r\n\r\n  const handleEditClick = (ticket: Ticket) => {\r\n    setSelectedTicket(ticket);\r\n    setDrawerMode('edit');\r\n  };\r\n\r\n  const handleDeleteClick = async (ticket: Ticket) => {\r\n    try {\r\n      await deleteTicket.mutateAsync(ticket.id);\r\n    } catch (error) {\r\n      console.error('Error deleting ticket:', error);\r\n    }\r\n  };\r\n\r\n  const handleDrawerClose = () => {\r\n    setDrawerMode(null);\r\n    setSelectedTicket(null);\r\n  };\r\n\r\n  const handleEditFromDetail = () => {\r\n    setDrawerMode('edit');\r\n  };\r\n\r\n  // Table columns configuration\r\n  const columns = [\r\n    {\r\n      title: 'Ticket ID',\r\n      dataIndex: 'id',\r\n      key: 'id',\r\n      width: 120,\r\n      render: (id: string) => <span style={{ fontFamily: 'monospace', fontSize: 12 }}>{id.substring(0, 8)}</span>,\r\n      sorter: (a: Ticket, b: Ticket) => a.id.localeCompare(b.id),\r\n    },\r\n    {\r\n      title: 'Title',\r\n      dataIndex: 'title',\r\n      key: 'title',\r\n      width: 200,\r\n      render: (text: string, record: Ticket) => (\r\n        <div>\r\n          <div style={{ fontWeight: 500, marginBottom: 4 }}>{text}</div>\r\n          {record.description && (\r\n            <div style={{ fontSize: 12, color: '#666', maxWidth: 300, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\r\n              {record.description}\r\n            </div>\r\n          )}\r\n        </div>\r\n      ),\r\n      sorter: (a: Ticket, b: Ticket) => a.title.localeCompare(b.title),\r\n    },\r\n    {\r\n      title: 'Customer',\r\n      dataIndex: 'customer_name',\r\n      key: 'customer_name',\r\n      width: 150,\r\n      render: (text: string) => text || <span style={{ color: '#999' }}>Unassigned</span>,\r\n      sorter: (a: Ticket, b: Ticket) => (a.customer_name || '').localeCompare(b.customer_name || ''),\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 130,\r\n      render: (status: string) => (\r\n        <Tag color={statusColors[status || 'open']} style={{ fontSize: 12, padding: '4px 12px' }}>\r\n          {(status || 'open').replace('_', ' ').toUpperCase()}\r\n        </Tag>\r\n      ),\r\n      sorter: (a: Ticket, b: Ticket) => (a.status || '').localeCompare(b.status || ''),\r\n      filters: [\r\n        { text: 'Open', value: 'open' },\r\n        { text: 'In Progress', value: 'in_progress' },\r\n        { text: 'Resolved', value: 'resolved' },\r\n        { text: 'Closed', value: 'closed' },\r\n      ],\r\n      onFilter: (value: any, record: Ticket) => record.status === value,\r\n    },\r\n    {\r\n      title: 'Priority',\r\n      dataIndex: 'priority',\r\n      key: 'priority',\r\n      width: 110,\r\n      render: (priority: string) => (\r\n        <Tag color={priorityColors[priority || 'medium']} style={{ fontSize: 12, padding: '4px 12px' }}>\r\n          {(priority || 'medium').toUpperCase()}\r\n        </Tag>\r\n      ),\r\n      sorter: (a: Ticket, b: Ticket) => (a.priority || '').localeCompare(b.priority || ''),\r\n      filters: [\r\n        { text: 'Low', value: 'low' },\r\n        { text: 'Medium', value: 'medium' },\r\n        { text: 'High', value: 'high' },\r\n        { text: 'Urgent', value: 'urgent' },\r\n      ],\r\n      onFilter: (value: any, record: Ticket) => record.priority === value,\r\n    },\r\n    {\r\n      title: 'Assigned To',\r\n      dataIndex: 'assigned_to_name',\r\n      key: 'assigned_to_name',\r\n      width: 130,\r\n      render: (text: string) => text || <span style={{ color: '#999' }}>Unassigned</span>,\r\n      sorter: (a: Ticket, b: Ticket) => (a.assigned_to_name || '').localeCompare(b.assigned_to_name || ''),\r\n    },\r\n    {\r\n      title: 'Due Date',\r\n      dataIndex: 'due_date',\r\n      key: 'due_date',\r\n      width: 130,\r\n      render: (due_date: string | undefined, record: Ticket) => {\r\n        if (!due_date) return <span style={{ color: '#999' }}>‚Äî</span>;\r\n        const isOverdue =\r\n          new Date(due_date) < new Date() && record.status !== 'resolved' && record.status !== 'closed';\r\n        return (\r\n          <span style={{ color: isOverdue ? '#dc2626' : '#000', fontWeight: isOverdue ? 500 : 'normal' }}>\r\n            {dayjs(due_date).format('MMM DD, YYYY')}\r\n          </span>\r\n        );\r\n      },\r\n      sorter: (a: Ticket, b: Ticket) => {\r\n        const dateA = a.due_date ? new Date(a.due_date).getTime() : 0;\r\n        const dateB = b.due_date ? new Date(b.due_date).getTime() : 0;\r\n        return dateA - dateB;\r\n      },\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      width: 120,\r\n      fixed: 'right' as const,\r\n      render: (_: any, record: Ticket) => (\r\n        <Space size=\"small\">\r\n          <Button\r\n            type=\"text\"\r\n            size=\"small\"\r\n            icon={<EyeOutlined />}\r\n            onClick={() => handleViewClick(record)}\r\n            title=\"View\"\r\n          />\r\n          {hasPermission('tickets:update') && (\r\n            <Button\r\n              type=\"text\"\r\n              size=\"small\"\r\n              icon={<EditOutlined />}\r\n              onClick={() => handleEditClick(record)}\r\n              title=\"Edit\"\r\n            />\r\n          )}\r\n          {hasPermission('tickets:delete') && (\r\n            <Popconfirm\r\n              title=\"Delete ticket?\"\r\n              description={`Are you sure you want to delete \"${record.title}\"?`}\r\n              onConfirm={() => handleDeleteClick(record)}\r\n              okText=\"Delete\"\r\n              okType=\"danger\"\r\n              cancelText=\"Cancel\"\r\n            >\r\n              <Button type=\"text\" size=\"small\" danger icon={<DeleteOutlined />} title=\"Delete\" />\r\n            </Popconfirm>\r\n          )}\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Support Tickets\"\r\n        description=\"Manage customer support requests and track resolution progress\"\r\n        breadcrumb={{\r\n          items: [\r\n            { title: 'Home', path: '/tenant/dashboard' },\r\n            { title: 'Support Tickets' },\r\n          ],\r\n        }}\r\n        extra={\r\n          hasPermission('tickets:create') && (\r\n            <Button type=\"primary\" icon={<PlusOutlined />} onClick={handleCreateClick}>\r\n              New Ticket\r\n            </Button>\r\n          )\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics Cards */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Tickets\"\r\n              value={statsData?.total || 0}\r\n              description=\"All support tickets\"\r\n              icon={AlertCircle}\r\n              color=\"primary\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Open Tickets\"\r\n              value={statsData?.openTickets || 0}\r\n              description=\"Awaiting resolution\"\r\n              icon={Clock}\r\n              color=\"warning\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Resolved This Month\"\r\n              value={statsData?.resolvedToday || 0}\r\n              description=\"Closed this month\"\r\n              icon={CheckCircle}\r\n              color=\"success\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Overdue Tickets\"\r\n              value={statsData?.overdueTickets || 0}\r\n              description=\"Past due date\"\r\n              icon={XCircle}\r\n              color=\"error\"\r\n              loading={statsLoading}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={8}>\r\n            <Input\r\n              placeholder=\"Search by title, customer, or ID...\"\r\n              prefix={<SearchOutlined />}\r\n              value={searchText}\r\n              onChange={(e) => setSearchText(e.target.value)}\r\n              allowClear\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={8}>\r\n            <Select\r\n              placeholder=\"Filter by status\"\r\n              allowClear\r\n              value={statusFilter}\r\n              onChange={setStatusFilter}\r\n              style={{ width: '100%' }}\r\n              options={[\r\n                { label: 'All Statuses', value: 'all' },\r\n                { label: 'Open', value: 'open' },\r\n                { label: 'In Progress', value: 'in_progress' },\r\n                { label: 'Resolved', value: 'resolved' },\r\n                { label: 'Closed', value: 'closed' },\r\n              ]}\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={8}>\r\n            <Select\r\n              placeholder=\"Filter by priority\"\r\n              allowClear\r\n              value={priorityFilter}\r\n              onChange={setPriorityFilter}\r\n              style={{ width: '100%' }}\r\n              options={[\r\n                { label: 'All Priorities', value: 'all' },\r\n                { label: 'Low', value: 'low' },\r\n                { label: 'Medium', value: 'medium' },\r\n                { label: 'High', value: 'high' },\r\n                { label: 'Urgent', value: 'urgent' },\r\n              ]}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Table */}\r\n        <Spin spinning={ticketsLoading}>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredTickets}\r\n            rowKey=\"id\"\r\n            pagination={{\r\n              pageSize: 20,\r\n              showSizeChanger: true,\r\n              showQuickJumper: true,\r\n              showTotal: (total) => `Total ${total} tickets`,\r\n              pageSizeOptions: ['10', '20', '50', '100'],\r\n            }}\r\n            scroll={{ x: 1200 }}\r\n            locale={{\r\n              emptyText: (\r\n                <Empty\r\n                  description=\"No tickets found\"\r\n                  style={{ marginTop: 48 }}\r\n                  image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                />\r\n              ),\r\n            }}\r\n            onChange={(_, __, sorter) => setSortedInfo(sorter)}\r\n          />\r\n        </Spin>\r\n      </div>\r\n\r\n      {/* Detail Drawer */}\r\n      <TicketsDetailPanel\r\n        ticket={selectedTicket}\r\n        isOpen={drawerMode === 'view'}\r\n        isLoading={ticketsLoading}\r\n        onClose={handleDrawerClose}\r\n        onEdit={handleEditFromDetail}\r\n      />\r\n\r\n      {/* Form Drawer */}\r\n      <TicketsFormPanel\r\n        ticket={drawerMode === 'edit' ? selectedTicket : null}\r\n        mode={drawerMode === 'create' ? 'create' : 'edit'}\r\n        isOpen={drawerMode === 'create' || drawerMode === 'edit'}\r\n        onClose={handleDrawerClose}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default TicketsPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\components\\UserDetailPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\components\\UserFormPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\routes.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":18,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":18,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * User Management Routes\r\n * Nested routes structure matching navigation config\r\n * Creates routes: /tenant/users/list, /tenant/users/roles, /tenant/users/permissions\r\n */\r\nimport React, { lazy, Suspense } from 'react';\r\nimport { RouteObject, Navigate } from 'react-router-dom';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\n// Lazy load components for code splitting\r\nconst UsersPage = lazy(() => import('./views/UsersPage'));\r\nconst UserManagementPage = lazy(() => import('./views/UserManagementPage'));\r\nconst RoleManagementPage = lazy(() => import('./views/RoleManagementPage'));\r\nconst PermissionMatrixPage = lazy(() => import('./views/PermissionMatrixPage'));\r\n\r\n// Route wrapper with error boundary and suspense\r\nconst RouteWrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\r\n  <ErrorBoundary>\r\n    <Suspense fallback={<LoadingSpinner text=\"Loading...\" />}>\r\n      {children}\r\n    </Suspense>\r\n  </ErrorBoundary>\r\n);\r\n\r\nexport const userManagementRoutes: RouteObject[] = [\r\n  {\r\n    path: 'users',\r\n    children: [\r\n      {\r\n        index: true,\r\n        element: <Navigate to=\"list\" replace />,\r\n      },\r\n      {\r\n        path: 'list',\r\n        element: (\r\n          <RouteWrapper>\r\n            <UsersPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'roles',\r\n        element: (\r\n          <RouteWrapper>\r\n            <RoleManagementPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n      {\r\n        path: 'permissions',\r\n        element: (\r\n          <RouteWrapper>\r\n            <PermissionMatrixPage />\r\n          </RouteWrapper>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  // Keep user-management route for backward compatibility if referenced elsewhere\r\n  {\r\n    path: 'user-management',\r\n    element: (\r\n      <RouteWrapper>\r\n        <UserManagementPage />\r\n      </RouteWrapper>\r\n    ),\r\n  },\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\views\\PermissionMatrixPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1374,1377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1374,1377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, showSystemRoles]","fix":{"range":[1972,1989],"text":"[loadData, showSystemRoles]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Permission Matrix Page - Enterprise Ant Design Version\r\n * Comprehensive permission matrix view with role-permission mapping\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Button,\r\n  Space,\r\n  Tag,\r\n  message,\r\n  Empty,\r\n  Checkbox,\r\n  Row,\r\n  Col,\r\n  Tooltip,\r\n  Badge,\r\n  Divider,\r\n  Alert,\r\n  Switch\r\n} from 'antd';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport {\r\n  SafetyOutlined,\r\n  ExportOutlined,\r\n  ReloadOutlined,\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  LockOutlined,\r\n  UnlockOutlined,\r\n  SaveOutlined,\r\n  InfoCircleOutlined,\r\n  WarningOutlined\r\n} from '@ant-design/icons';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { Role, Permission } from '@/types/rbac';\r\n\r\ninterface PermissionMatrixRow {\r\n  key: string;\r\n  category: string;\r\n  permissionId: string;\r\n  permissionName: string;\r\n  permissionDescription: string;\r\n  [roleId: string]: unknown; // Dynamic role columns\r\n}\r\n\r\nexport const PermissionMatrixPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { hasPermission } = useAuth();\r\n  const rbacService = useService<any>('rbacService');\r\n  const canManageRoles = hasPermission('manage_roles');\r\n\r\n  // State\r\n  const [roles, setRoles] = useState<Role[]>([]);\r\n  const [permissions, setPermissions] = useState<Permission[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [matrixData, setMatrixData] = useState<PermissionMatrixRow[]>([]);\r\n  const [changes, setChanges] = useState<Map<string, Set<string>>>(new Map());\r\n  const [saving, setSaving] = useState(false);\r\n  const [showSystemRoles, setShowSystemRoles] = useState(true);\r\n\r\n  // Load data\r\n   \r\n  useEffect(() => {\r\n    loadData();\r\n  }, [showSystemRoles]);\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const [rolesData, permissionsData] = await Promise.all([\r\n        rbacService.getRoles(),\r\n        rbacService.getPermissions()\r\n      ]);\r\n      \r\n      // Filter roles based on showSystemRoles\r\n      const filteredRoles = showSystemRoles \r\n        ? rolesData \r\n        : rolesData.filter(r => !r.is_system_role);\r\n      \r\n      setRoles(filteredRoles);\r\n      setPermissions(permissionsData);\r\n      buildMatrixData(filteredRoles, permissionsData);\r\n    } catch (error) {\r\n      message.error('Failed to load data');\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Build matrix data\r\n  const buildMatrixData = (rolesData: Role[], permissionsData: Permission[]) => {\r\n    const matrix: PermissionMatrixRow[] = permissionsData.map(permission => {\r\n      const row: PermissionMatrixRow = {\r\n        key: permission.id,\r\n        category: permission.category,\r\n        permissionId: permission.id,\r\n        permissionName: permission.name,\r\n        permissionDescription: permission.description\r\n      };\r\n\r\n      // Add role columns\r\n      rolesData.forEach(role => {\r\n        row[role.id] = role.permissions.includes(permission.id);\r\n      });\r\n\r\n      return row;\r\n    });\r\n\r\n    setMatrixData(matrix);\r\n  };\r\n\r\n  // Handle permission toggle\r\n  const handlePermissionToggle = (permissionId: string, roleId: string, checked: boolean) => {\r\n    if (!canManageRoles) {\r\n      message.warning('You do not have permission to modify roles');\r\n      return;\r\n    }\r\n\r\n    const role = roles.find(r => r.id === roleId);\r\n    if (role?.is_system_role) {\r\n      message.warning('System roles cannot be modified');\r\n      return;\r\n    }\r\n\r\n    // Update matrix data\r\n    setMatrixData(prev =>\r\n      prev.map(row =>\r\n        row.permissionId === permissionId\r\n          ? { ...row, [roleId]: checked }\r\n          : row\r\n      )\r\n    );\r\n\r\n    // Track changes\r\n    setChanges(prev => {\r\n      const newChanges = new Map(prev);\r\n      if (!newChanges.has(roleId)) {\r\n        newChanges.set(roleId, new Set());\r\n      }\r\n      newChanges.get(roleId)!.add(permissionId);\r\n      return newChanges;\r\n    });\r\n  };\r\n\r\n  // Handle save changes\r\n  const handleSaveChanges = async () => {\r\n    if (changes.size === 0) {\r\n      message.info('No changes to save');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setSaving(true);\r\n      \r\n      // Update each modified role\r\n      for (const [roleId, modifiedPermissions] of changes.entries()) {\r\n        const role = roles.find(r => r.id === roleId);\r\n        if (!role || role.is_system_role) continue;\r\n\r\n        // Get current permissions for this role from matrix\r\n        const newPermissions = matrixData\r\n          .filter(row => row[roleId] === true)\r\n          .map(row => row.permissionId);\r\n\r\n        await rbacService.updateRole(roleId, {\r\n          name: role.name,\r\n          description: role.description,\r\n          permissions: newPermissions\r\n        });\r\n      }\r\n\r\n      message.success('Changes saved successfully');\r\n      setChanges(new Map());\r\n      loadData();\r\n    } catch (error: unknown) {\r\n      const error_msg = error instanceof Error ? error.message : 'Failed to save changes';\r\n      message.error(error_msg);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Handle discard changes\r\n  const handleDiscardChanges = () => {\r\n    setChanges(new Map());\r\n    loadData();\r\n    message.info('Changes discarded');\r\n  };\r\n\r\n  // Export matrix\r\n  const handleExport = () => {\r\n    try {\r\n      // Create CSV content\r\n      const headers = ['Permission', 'Category', 'Description', ...roles.map(r => r.name)];\r\n      const rows = matrixData.map(row => [\r\n        row.permissionName,\r\n        row.category,\r\n        row.permissionDescription,\r\n        ...roles.map(role => row[role.id] ? 'Yes' : 'No')\r\n      ]);\r\n\r\n      const csvContent = [\r\n        headers.join(','),\r\n        ...rows.map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n      ].join('\\n');\r\n\r\n      // Download file\r\n      const blob = new Blob([csvContent], { type: 'text/csv' });\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `permission-matrix-${new Date().toISOString().split('T')[0]}.csv`;\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n\r\n      message.success('Permission matrix exported successfully');\r\n    } catch (error) {\r\n      message.error('Failed to export permission matrix');\r\n      console.error('Export error:', error);\r\n    }\r\n  };\r\n\r\n  // Group permissions by category\r\n  const groupedPermissions = permissions.reduce((acc, permission) => {\r\n    if (!acc[permission.category]) {\r\n      acc[permission.category] = [];\r\n    }\r\n    acc[permission.category].push(permission);\r\n    return acc;\r\n  }, {} as Record<string, Permission[]>);\r\n\r\n  // Calculate stats\r\n  const totalPermissions = permissions.length;\r\n  const totalRoles = roles.length;\r\n  const systemRoles = roles.filter(r => r.is_system_role).length;\r\n  const customRoles = roles.filter(r => !r.is_system_role).length;\r\n  const totalAssignments = matrixData.reduce((sum, row) => {\r\n    return sum + roles.filter(role => row[role.id] === true).length;\r\n  }, 0);\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<PermissionMatrixRow> = [\r\n    {\r\n      title: 'Category',\r\n      dataIndex: 'category',\r\n      key: 'category',\r\n      fixed: 'left',\r\n      width: 120,\r\n      render: (category: string) => (\r\n        <Tag color=\"blue\">\r\n          {category.charAt(0).toUpperCase() + category.slice(1)}\r\n        </Tag>\r\n      ),\r\n      filters: Object.keys(groupedPermissions).map(cat => ({\r\n        text: cat.charAt(0).toUpperCase() + cat.slice(1),\r\n        value: cat\r\n      })),\r\n      onFilter: (value, record) => record.category === value\r\n    },\r\n    {\r\n      title: 'Permission',\r\n      dataIndex: 'permissionName',\r\n      key: 'permissionName',\r\n      fixed: 'left',\r\n      width: 200,\r\n      render: (name: string, record) => (\r\n        <Space direction=\"vertical\" size={0}>\r\n          <span style={{ fontWeight: 500, color: '#2C3E50' }}>{name}</span>\r\n          <span style={{ fontSize: 12, color: '#7A8691' }}>\r\n            {record.permissionDescription}\r\n          </span>\r\n        </Space>\r\n      )\r\n    },\r\n    ...roles.map(role => ({\r\n      title: (\r\n        <Space direction=\"vertical\" size={0} style={{ textAlign: 'center' }}>\r\n          <Space>\r\n            {role.is_system_role ? (\r\n              <LockOutlined style={{ color: '#faad14' }} />\r\n            ) : (\r\n              <UnlockOutlined style={{ color: '#52c41a' }} />\r\n            )}\r\n            <span>{role.name}</span>\r\n          </Space>\r\n          {role.is_system_role && (\r\n            <Tag color=\"gold\" style={{ fontSize: 10 }}>System</Tag>\r\n          )}\r\n        </Space>\r\n      ),\r\n      dataIndex: role.id,\r\n      key: role.id,\r\n      width: 150,\r\n      align: 'center' as const,\r\n      render: (hasPermission: boolean, record: PermissionMatrixRow) => {\r\n        const isModified = changes.has(role.id) && changes.get(role.id)!.has(record.permissionId);\r\n        return (\r\n          <Tooltip title={role.is_system_role ? 'System role - cannot modify' : hasPermission ? 'Remove permission' : 'Grant permission'}>\r\n            <Checkbox\r\n              checked={hasPermission}\r\n              onChange={(e) => handlePermissionToggle(record.permissionId, role.id, e.target.checked)}\r\n              disabled={!canManageRoles || role.is_system_role}\r\n              style={{\r\n                backgroundColor: isModified ? '#fff7e6' : 'transparent',\r\n                padding: isModified ? '4px 8px' : 0,\r\n                borderRadius: 4\r\n              }}\r\n            />\r\n          </Tooltip>\r\n        );\r\n      }\r\n    }))\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Permission Matrix\"\r\n        description=\"View and manage role-permission assignments\"\r\n        breadcrumbs={[\r\n          { title: 'Home', path: '/' },\r\n          { title: 'User Management', path: '/user-management' },\r\n          { title: 'Permission Matrix' }\r\n        ]}\r\n        extra={\r\n          <Space>\r\n            <Tooltip title=\"Toggle system roles visibility\">\r\n              <Space>\r\n                <span style={{ fontSize: 12, color: '#7A8691' }}>Show System Roles</span>\r\n                <Switch\r\n                  checked={showSystemRoles}\r\n                  onChange={setShowSystemRoles}\r\n                  size=\"small\"\r\n                />\r\n              </Space>\r\n            </Tooltip>\r\n            <Button\r\n              icon={<ReloadOutlined />}\r\n              onClick={loadData}\r\n            >\r\n              Refresh\r\n            </Button>\r\n            <Button\r\n              icon={<ExportOutlined />}\r\n              onClick={handleExport}\r\n            >\r\n              Export CSV\r\n            </Button>\r\n            {canManageRoles && changes.size > 0 && (\r\n              <>\r\n                <Button\r\n                  onClick={handleDiscardChanges}\r\n                >\r\n                  Discard Changes\r\n                </Button>\r\n                <Button\r\n                  type=\"primary\"\r\n                  icon={<SaveOutlined />}\r\n                  onClick={handleSaveChanges}\r\n                  loading={saving}\r\n                >\r\n                  Save Changes ({changes.size})\r\n                </Button>\r\n              </>\r\n            )}\r\n          </Space>\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Permissions\"\r\n              value={totalPermissions}\r\n              icon={<SafetyOutlined />}\r\n              color=\"primary\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Roles\"\r\n              value={totalRoles}\r\n              icon={<UnlockOutlined />}\r\n              color=\"success\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"System Roles\"\r\n              value={systemRoles}\r\n              icon={<LockOutlined />}\r\n              color=\"warning\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Assignments\"\r\n              value={totalAssignments}\r\n              icon={<CheckCircleOutlined />}\r\n              color=\"info\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Info Alert */}\r\n        {!canManageRoles && (\r\n          <Alert\r\n            message=\"View Only Mode\"\r\n            description=\"You do not have permission to modify role permissions. Contact your administrator for access.\"\r\n            type=\"info\"\r\n            icon={<InfoCircleOutlined />}\r\n            showIcon\r\n            style={{ marginBottom: 16 }}\r\n          />\r\n        )}\r\n\r\n        {/* Changes Alert */}\r\n        {changes.size > 0 && (\r\n          <Alert\r\n            message=\"Unsaved Changes\"\r\n            description={`You have unsaved changes for ${changes.size} role(s). Click \"Save Changes\" to apply or \"Discard Changes\" to revert.`}\r\n            type=\"warning\"\r\n            icon={<WarningOutlined />}\r\n            showIcon\r\n            style={{ marginBottom: 16 }}\r\n          />\r\n        )}\r\n\r\n        {/* Legend */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Space split={<Divider type=\"vertical\" />} wrap>\r\n            <Space>\r\n              <CheckCircleOutlined style={{ color: '#52c41a' }} />\r\n              <span style={{ fontSize: 12, color: '#7A8691' }}>Permission Granted</span>\r\n            </Space>\r\n            <Space>\r\n              <CloseCircleOutlined style={{ color: '#d9d9d9' }} />\r\n              <span style={{ fontSize: 12, color: '#7A8691' }}>Permission Not Granted</span>\r\n            </Space>\r\n            <Space>\r\n              <LockOutlined style={{ color: '#faad14' }} />\r\n              <span style={{ fontSize: 12, color: '#7A8691' }}>System Role (Read-only)</span>\r\n            </Space>\r\n            <Space>\r\n              <UnlockOutlined style={{ color: '#52c41a' }} />\r\n              <span style={{ fontSize: 12, color: '#7A8691' }}>Custom Role (Editable)</span>\r\n            </Space>\r\n            <Space>\r\n              <div style={{ width: 16, height: 16, backgroundColor: '#fff7e6', border: '1px solid #ffd591', borderRadius: 2 }} />\r\n              <span style={{ fontSize: 12, color: '#7A8691' }}>Modified (Unsaved)</span>\r\n            </Space>\r\n          </Space>\r\n        </Card>\r\n\r\n        {/* Permission Matrix Table */}\r\n        <Card>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={matrixData}\r\n            loading={loading}\r\n            scroll={{ x: 800 + (roles.length * 150) }}\r\n            pagination={{\r\n              pageSize: 20,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} permissions`\r\n            }}\r\n            locale={{\r\n              emptyText: (\r\n                <Empty\r\n                  image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                  description=\"No permissions found\"\r\n                >\r\n                  <Button\r\n                    type=\"primary\"\r\n                    icon={<ReloadOutlined />}\r\n                    onClick={loadData}\r\n                  >\r\n                    Reload Data\r\n                  </Button>\r\n                </Empty>\r\n              )\r\n            }}\r\n            bordered\r\n            size=\"small\"\r\n          />\r\n        </Card>\r\n\r\n        {/* Summary by Category */}\r\n        <Card title=\"Permission Summary by Category\" style={{ marginTop: 16 }}>\r\n          <Row gutter={[16, 16]}>\r\n            {Object.entries(groupedPermissions).map(([category, perms]) => (\r\n              <Col xs={24} sm={12} lg={6} key={category}>\r\n                <Card size=\"small\" hoverable>\r\n                  <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                    <Space>\r\n                      <SafetyOutlined style={{ color: '#1890ff' }} />\r\n                      <span style={{ fontWeight: 500 }}>\r\n                        {category.charAt(0).toUpperCase() + category.slice(1)}\r\n                      </span>\r\n                    </Space>\r\n                    <div style={{ fontSize: 24, fontWeight: 600, color: '#2C3E50' }}>\r\n                      {perms.length}\r\n                    </div>\r\n                    <div style={{ fontSize: 12, color: '#7A8691' }}>\r\n                      permissions\r\n                    </div>\r\n                  </Space>\r\n                </Card>\r\n              </Col>\r\n            ))}\r\n          </Row>\r\n        </Card>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PermissionMatrixPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\views\\RoleManagementPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1588,1591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1588,1591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":92,"column":6,"nodeType":"ArrayExpression","endLine":92,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadData]","fix":{"range":[2573,2575],"text":"[loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Role Management Page - Enterprise Ant Design Version\r\n * Comprehensive role management with permission assignment and templates\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Button,\r\n  Input,\r\n  Space,\r\n  Tag,\r\n  Modal,\r\n  Form,\r\n  Row,\r\n  Col,\r\n  Checkbox,\r\n  message,\r\n  Empty,\r\n  Spin,\r\n  Tooltip,\r\n  Badge,\r\n  Dropdown,\r\n  Tabs,\r\n  Descriptions,\r\n  Tree,\r\n  type MenuProps\r\n} from 'antd';\r\nimport type { DataNode } from 'antd/es/tree';\r\nimport {\r\n  SafetyOutlined,\r\n  PlusOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  SearchOutlined,\r\n  CrownOutlined,\r\n  TeamOutlined,\r\n  UserOutlined,\r\n  MoreOutlined,\r\n  CopyOutlined,\r\n  ExportOutlined,\r\n  ReloadOutlined,\r\n  CheckCircleOutlined,\r\n  CloseCircleOutlined,\r\n  LockOutlined,\r\n  UnlockOutlined,\r\n  FileTextOutlined,\r\n  SettingOutlined\r\n} from '@ant-design/icons';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { Role, Permission, RoleTemplate } from '@/types/rbac';\r\n\r\nconst { TextArea } = Input;\r\nconst { TabPane } = Tabs;\r\n\r\ninterface RoleFormData {\r\n  name: string;\r\n  description: string;\r\n  permissions: string[];\r\n}\r\n\r\nexport const RoleManagementPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { hasPermission } = useAuth();\r\n  const rbacService = useService<any>('rbacService');\r\n  const [form] = Form.useForm();\r\n  const [templateForm] = Form.useForm();\r\n\r\n  // State\r\n  const [roles, setRoles] = useState<Role[]>([]);\r\n  const [permissions, setPermissions] = useState<Permission[]>([]);\r\n  const [roleTemplates, setRoleTemplates] = useState<RoleTemplate[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchText, setSearchText] = useState('');\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  const [isTemplateModalVisible, setIsTemplateModalVisible] = useState(false);\r\n  const [editingRole, setEditingRole] = useState<Role | null>(null);\r\n  const [selectedRole, setSelectedRole] = useState<Role | null>(null);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [selectedPermissions, setSelectedPermissions] = useState<string[]>([]);\r\n  const [selectedTemplateId, setSelectedTemplateId] = useState<string | null>(null);\r\n\r\n  // Load data\r\n   \r\n  useEffect(() => {\r\n    loadData();\r\n  }, []);\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const [rolesData, permissionsData, templatesData] = await Promise.all([\r\n        rbacService.getRoles(),\r\n        rbacService.getPermissions(),\r\n        rbacService.getRoleTemplates()\r\n      ]);\r\n      setRoles(rolesData);\r\n      setPermissions(permissionsData);\r\n      setRoleTemplates(templatesData);\r\n    } catch (error) {\r\n      message.error('Failed to load data');\r\n      console.error('Error loading data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle create role\r\n  const handleCreate = () => {\r\n    setEditingRole(null);\r\n    setSelectedPermissions([]);\r\n    form.resetFields();\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle create from template\r\n  const handleCreateFromTemplate = () => {\r\n    templateForm.resetFields();\r\n    setSelectedTemplateId(null);\r\n    setIsTemplateModalVisible(true);\r\n  };\r\n\r\n  // Handle edit role\r\n  const handleEdit = (role: Role) => {\r\n    setEditingRole(role);\r\n    setSelectedPermissions(role.permissions);\r\n    form.setFieldsValue({\r\n      name: role.name,\r\n      description: role.description,\r\n      permissions: role.permissions\r\n    });\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle delete role\r\n  const handleDelete = async (roleId: string) => {\r\n    try {\r\n      await rbacService.deleteRole(roleId);\r\n      message.success('Role deleted successfully');\r\n      loadData();\r\n    } catch (error: unknown) {\r\n      const message_text = error instanceof Error ? error.message : 'Failed to delete role';\r\n      message.error(message_text);\r\n    }\r\n  };\r\n\r\n  // Handle duplicate role\r\n  const handleDuplicate = (role: Role) => {\r\n    setEditingRole(null);\r\n    setSelectedPermissions(role.permissions);\r\n    form.setFieldsValue({\r\n      name: `${role.name} (Copy)`,\r\n      description: role.description,\r\n      permissions: role.permissions\r\n    });\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle form submit\r\n  const handleSubmit = async (values: RoleFormData) => {\r\n    try {\r\n      setSubmitting(true);\r\n      const roleData = {\r\n        ...values,\r\n        permissions: selectedPermissions\r\n      };\r\n\r\n      if (editingRole) {\r\n        await rbacService.updateRole(editingRole.id, roleData);\r\n        message.success('Role updated successfully');\r\n      } else {\r\n        await rbacService.createRole(roleData);\r\n        message.success('Role created successfully');\r\n      }\r\n      setIsModalVisible(false);\r\n      form.resetFields();\r\n      setSelectedPermissions([]);\r\n      loadData();\r\n    } catch (error: unknown) {\r\n      const error_message = error instanceof Error ? error.message : 'Failed to save role';\r\n      message.error(error_message);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Handle template submit\r\n  const handleTemplateSubmit = async (values: Record<string, unknown>) => {\r\n    try {\r\n      setSubmitting(true);\r\n      const template = roleTemplates.find(t => t.id === values.templateId);\r\n      if (!template) {\r\n        message.error('Template not found');\r\n        return;\r\n      }\r\n\r\n      await rbacService.createRole({\r\n        name: values.roleName,\r\n        description: template.description,\r\n        permissions: template.permissions\r\n      });\r\n      message.success('Role created from template successfully');\r\n      setIsTemplateModalVisible(false);\r\n      templateForm.resetFields();\r\n      setSelectedTemplateId(null);\r\n      loadData();\r\n    } catch (error: unknown) {\r\n      const error_msg = error instanceof Error ? error.message : 'Failed to create role from template';\r\n      message.error(error_msg);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Group permissions by category\r\n  const groupedPermissions = permissions.reduce((acc, permission) => {\r\n    if (!acc[permission.category]) {\r\n      acc[permission.category] = [];\r\n    }\r\n    acc[permission.category].push(permission);\r\n    return acc;\r\n  }, {} as Record<string, Permission[]>);\r\n\r\n  // Convert permissions to tree data\r\n  const permissionTreeData: DataNode[] = Object.entries(groupedPermissions).map(([category, perms]) => ({\r\n    title: category.charAt(0).toUpperCase() + category.slice(1),\r\n    key: category,\r\n    children: perms.map(p => ({\r\n      title: (\r\n        <Space>\r\n          <span>{p.name}</span>\r\n          <span style={{ color: '#7A8691', fontSize: 12 }}>({p.description})</span>\r\n        </Space>\r\n      ),\r\n      key: p.id\r\n    }))\r\n  }));\r\n\r\n  // Action menu items\r\n  const getActionMenu = (role: Role): MenuProps['items'] => [\r\n    {\r\n      key: 'edit',\r\n      label: 'Edit Role',\r\n      icon: <EditOutlined />,\r\n      onClick: () => handleEdit(role),\r\n      disabled: role.is_system_role\r\n    },\r\n    {\r\n      key: 'duplicate',\r\n      label: 'Duplicate Role',\r\n      icon: <CopyOutlined />,\r\n      onClick: () => handleDuplicate(role)\r\n    },\r\n    {\r\n      key: 'view',\r\n      label: 'View Details',\r\n      icon: <FileTextOutlined />,\r\n      onClick: () => setSelectedRole(role)\r\n    },\r\n    {\r\n      type: 'divider'\r\n    },\r\n    {\r\n      key: 'delete',\r\n      label: 'Delete Role',\r\n      icon: <DeleteOutlined />,\r\n      danger: true,\r\n      disabled: role.is_system_role,\r\n      onClick: () => {\r\n        Modal.confirm({\r\n          title: 'Delete Role',\r\n          content: `Are you sure you want to delete the role \"${role.name}\"?`,\r\n          okText: 'Delete',\r\n          okType: 'danger',\r\n          onOk: () => handleDelete(role.id)\r\n        });\r\n      }\r\n    }\r\n  ];\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<Role> = [\r\n    {\r\n      title: 'Role Name',\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n      fixed: 'left',\r\n      width: 200,\r\n      render: (name: string, record) => (\r\n        <Space>\r\n          {record.is_system_role ? (\r\n            <LockOutlined style={{ color: '#faad14' }} />\r\n          ) : (\r\n            <UnlockOutlined style={{ color: '#52c41a' }} />\r\n          )}\r\n          <span style={{ fontWeight: 500, color: '#2C3E50' }}>{name}</span>\r\n          {record.is_system_role && (\r\n            <Tag color=\"gold\" style={{ marginLeft: 8 }}>System</Tag>\r\n          )}\r\n        </Space>\r\n      ),\r\n      filteredValue: searchText ? [searchText] : null,\r\n      onFilter: (value, record) =>\r\n        record.name.toLowerCase().includes((value as string).toLowerCase()) ||\r\n        record.description.toLowerCase().includes((value as string).toLowerCase())\r\n    },\r\n    {\r\n      title: 'Description',\r\n      dataIndex: 'description',\r\n      key: 'description',\r\n      width: 300,\r\n      render: (description: string) => (\r\n        <span style={{ color: '#7A8691' }}>{description}</span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Permissions',\r\n      dataIndex: 'permissions',\r\n      key: 'permissions',\r\n      width: 120,\r\n      render: (permissions: string[]) => (\r\n        <Badge\r\n          count={permissions.length}\r\n          style={{ backgroundColor: '#1890ff' }}\r\n          showZero\r\n        />\r\n      )\r\n    },\r\n    {\r\n      title: 'Tenant',\r\n      dataIndex: 'tenant_id',\r\n      key: 'tenant_id',\r\n      width: 150,\r\n      render: (tenantId: string) => (\r\n        <Tag color={tenantId === 'platform' ? 'purple' : 'blue'}>\r\n          {tenantId === 'platform' ? 'Platform' : tenantId}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'created_at',\r\n      key: 'created_at',\r\n      width: 120,\r\n      render: (createdAt: string) => (\r\n        <span style={{ color: '#7A8691' }}>\r\n          {new Date(createdAt).toLocaleDateString()}\r\n        </span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      fixed: 'right',\r\n      width: 100,\r\n      render: (_, record) => (\r\n        <Space>\r\n          {hasPermission('manage_roles') && (\r\n            <>\r\n              <Tooltip title={record.is_system_role ? 'System roles cannot be edited' : 'Edit'}>\r\n                <Button\r\n                  type=\"text\"\r\n                  size=\"small\"\r\n                  icon={<EditOutlined />}\r\n                  onClick={() => handleEdit(record)}\r\n                  disabled={record.is_system_role}\r\n                />\r\n              </Tooltip>\r\n              <Dropdown menu={{ items: getActionMenu(record) }} trigger={['click']}>\r\n                <Button type=\"text\" size=\"small\" icon={<MoreOutlined />} />\r\n              </Dropdown>\r\n            </>\r\n          )}\r\n        </Space>\r\n      )\r\n    }\r\n  ];\r\n\r\n  // Calculate stats\r\n  const totalRoles = roles.length;\r\n  const systemRoles = roles.filter(r => r.is_system_role).length;\r\n  const customRoles = roles.filter(r => !r.is_system_role).length;\r\n  const totalPermissions = permissions.length;\r\n\r\n  // Filtered roles\r\n  const filteredRoles = searchText\r\n    ? roles.filter(role =>\r\n        role.name.toLowerCase().includes(searchText.toLowerCase()) ||\r\n        role.description.toLowerCase().includes(searchText.toLowerCase())\r\n      )\r\n    : roles;\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"Role Management\"\r\n        description=\"Manage roles and assign permissions\"\r\n        breadcrumbs={[\r\n          { title: 'Home', path: '/' },\r\n          { title: 'User Management', path: '/user-management' },\r\n          { title: 'Roles' }\r\n        ]}\r\n        extra={\r\n          hasPermission('manage_roles') ? (\r\n            <Space>\r\n              <Button\r\n                icon={<ReloadOutlined />}\r\n                onClick={loadData}\r\n              >\r\n                Refresh\r\n              </Button>\r\n              <Button\r\n                icon={<FileTextOutlined />}\r\n                onClick={handleCreateFromTemplate}\r\n              >\r\n                From Template\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<PlusOutlined />}\r\n                onClick={handleCreate}\r\n              >\r\n                Create Role\r\n              </Button>\r\n            </Space>\r\n          ) : undefined\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Roles\"\r\n              value={totalRoles}\r\n              icon={<SafetyOutlined />}\r\n              color=\"primary\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"System Roles\"\r\n              value={systemRoles}\r\n              icon={<LockOutlined />}\r\n              color=\"warning\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Custom Roles\"\r\n              value={customRoles}\r\n              icon={<UnlockOutlined />}\r\n              color=\"success\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Permissions\"\r\n              value={totalPermissions}\r\n              icon={<SettingOutlined />}\r\n              color=\"info\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Search */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Input\r\n            placeholder=\"Search roles by name or description...\"\r\n            prefix={<SearchOutlined />}\r\n            value={searchText}\r\n            onChange={(e) => setSearchText(e.target.value)}\r\n            allowClear\r\n            size=\"large\"\r\n          />\r\n        </Card>\r\n\r\n        {/* Roles Table */}\r\n        <Card>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredRoles}\r\n            rowKey=\"id\"\r\n            loading={loading}\r\n            scroll={{ x: 1200 }}\r\n            pagination={{\r\n              total: filteredRoles.length,\r\n              pageSize: 10,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} roles`\r\n            }}\r\n            locale={{\r\n              emptyText: (\r\n                <Empty\r\n                  image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                  description=\"No roles found\"\r\n                >\r\n                  {hasPermission('manage_roles') && (\r\n                    <Button\r\n                      type=\"primary\"\r\n                      icon={<PlusOutlined />}\r\n                      onClick={handleCreate}\r\n                    >\r\n                      Create First Role\r\n                    </Button>\r\n                  )}\r\n                </Empty>\r\n              )\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Create/Edit Role Modal */}\r\n      <Modal\r\n        title={editingRole ? 'Edit Role' : 'Create New Role'}\r\n        open={isModalVisible}\r\n        onCancel={() => {\r\n          setIsModalVisible(false);\r\n          form.resetFields();\r\n          setSelectedPermissions([]);\r\n        }}\r\n        footer={null}\r\n        width={800}\r\n      >\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          onFinish={handleSubmit}\r\n        >\r\n          <Form.Item\r\n            name=\"name\"\r\n            label=\"Role Name\"\r\n            rules={[\r\n              { required: true, message: 'Please enter role name' },\r\n              { min: 3, message: 'Role name must be at least 3 characters' }\r\n            ]}\r\n          >\r\n            <Input\r\n              prefix={<SafetyOutlined />}\r\n              placeholder=\"Enter role name\"\r\n              size=\"large\"\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            name=\"description\"\r\n            label=\"Description\"\r\n            rules={[\r\n              { required: true, message: 'Please enter description' },\r\n              { min: 10, message: 'Description must be at least 10 characters' }\r\n            ]}\r\n          >\r\n            <TextArea\r\n              placeholder=\"Enter role description\"\r\n              rows={3}\r\n              maxLength={500}\r\n              showCount\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            label=\"Permissions\"\r\n            required\r\n          >\r\n            <Card style={{ maxHeight: 400, overflow: 'auto' }}>\r\n              <Tree\r\n                checkable\r\n                defaultExpandAll\r\n                checkedKeys={selectedPermissions}\r\n                onCheck={(checkedKeys) => {\r\n                  const keys = checkedKeys as string[];\r\n                  // Filter out category keys, only keep permission IDs\r\n                  const permissionIds = keys.filter(key =>\r\n                    permissions.some(p => p.id === key)\r\n                  );\r\n                  setSelectedPermissions(permissionIds);\r\n                }}\r\n                treeData={permissionTreeData}\r\n              />\r\n            </Card>\r\n            <div style={{ marginTop: 8, color: '#7A8691' }}>\r\n              Selected: {selectedPermissions.length} permissions\r\n            </div>\r\n          </Form.Item>\r\n\r\n          <Form.Item style={{ marginBottom: 0, marginTop: 24 }}>\r\n            <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n              <Button\r\n                onClick={() => {\r\n                  setIsModalVisible(false);\r\n                  form.resetFields();\r\n                  setSelectedPermissions([]);\r\n                }}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                htmlType=\"submit\"\r\n                loading={submitting}\r\n                icon={editingRole ? <EditOutlined /> : <PlusOutlined />}\r\n                disabled={selectedPermissions.length === 0}\r\n              >\r\n                {editingRole ? 'Update Role' : 'Create Role'}\r\n              </Button>\r\n            </Space>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n\r\n      {/* Create from Template Modal */}\r\n      <Modal\r\n        title=\"Create Role from Template\"\r\n        open={isTemplateModalVisible}\r\n        onCancel={() => {\r\n          setIsTemplateModalVisible(false);\r\n          templateForm.resetFields();\r\n          setSelectedTemplateId(null);\r\n        }}\r\n        footer={null}\r\n        width={600}\r\n      >\r\n        <Form\r\n          form={templateForm}\r\n          layout=\"vertical\"\r\n          onFinish={handleTemplateSubmit}\r\n        >\r\n          <Form.Item\r\n            name=\"templateId\"\r\n            label=\"Select Template\"\r\n            rules={[{ required: true, message: 'Please select a template' }]}\r\n          >\r\n            <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n              {roleTemplates.map(template => (\r\n                <Card\r\n                  key={template.id}\r\n                  hoverable\r\n                  onClick={() => {\r\n                    setSelectedTemplateId(template.id);\r\n                    templateForm.setFieldsValue({ templateId: template.id });\r\n                  }}\r\n                  style={{\r\n                    border: selectedTemplateId === template.id\r\n                      ? '2px solid #1890ff'\r\n                      : '1px solid #d9d9d9'\r\n                  }}\r\n                >\r\n                  <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n                    <Space>\r\n                      <FileTextOutlined style={{ color: '#1890ff' }} />\r\n                      <span style={{ fontWeight: 500 }}>{template.name}</span>\r\n                      {template.is_default && <Tag color=\"blue\">Default</Tag>}\r\n                    </Space>\r\n                    <div style={{ color: '#7A8691', fontSize: 12 }}>\r\n                      {template.description}\r\n                    </div>\r\n                    <div style={{ color: '#9EAAB7', fontSize: 12 }}>\r\n                      {template.permissions.length} permissions ‚Ä¢ {template.category}\r\n                    </div>\r\n                  </Space>\r\n                </Card>\r\n              ))}\r\n            </Space>\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            name=\"roleName\"\r\n            label=\"Role Name\"\r\n            rules={[\r\n              { required: true, message: 'Please enter role name' },\r\n              { min: 3, message: 'Role name must be at least 3 characters' }\r\n            ]}\r\n          >\r\n            <Input\r\n              prefix={<SafetyOutlined />}\r\n              placeholder=\"Enter role name\"\r\n              size=\"large\"\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item style={{ marginBottom: 0, marginTop: 24 }}>\r\n            <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n              <Button\r\n                onClick={() => {\r\n                  setIsTemplateModalVisible(false);\r\n                  templateForm.resetFields();\r\n                  setSelectedTemplateId(null);\r\n                }}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                htmlType=\"submit\"\r\n                loading={submitting}\r\n                icon={<PlusOutlined />}\r\n              >\r\n                Create Role\r\n              </Button>\r\n            </Space>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n\r\n      {/* Role Details Modal */}\r\n      <Modal\r\n        title=\"Role Details\"\r\n        open={!!selectedRole}\r\n        onCancel={() => setSelectedRole(null)}\r\n        footer={[\r\n          <Button key=\"close\" onClick={() => setSelectedRole(null)}>\r\n            Close\r\n          </Button>\r\n        ]}\r\n        width={700}\r\n      >\r\n        {selectedRole && (\r\n          <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\r\n            <Descriptions bordered column={1}>\r\n              <Descriptions.Item label=\"Role Name\">{selectedRole.name}</Descriptions.Item>\r\n              <Descriptions.Item label=\"Description\">{selectedRole.description}</Descriptions.Item>\r\n              <Descriptions.Item label=\"Tenant ID\">{selectedRole.tenant_id}</Descriptions.Item>\r\n              <Descriptions.Item label=\"System Role\">\r\n                {selectedRole.is_system_role ? (\r\n                  <Tag color=\"gold\">Yes</Tag>\r\n                ) : (\r\n                  <Tag color=\"green\">No</Tag>\r\n                )}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Created\">\r\n                {new Date(selectedRole.created_at).toLocaleString()}\r\n              </Descriptions.Item>\r\n              <Descriptions.Item label=\"Updated\">\r\n                {new Date(selectedRole.updated_at).toLocaleString()}\r\n              </Descriptions.Item>\r\n            </Descriptions>\r\n\r\n            <Card title=\"Permissions\" size=\"small\">\r\n              <Space wrap>\r\n                {selectedRole.permissions.map(permId => {\r\n                  const perm = permissions.find(p => p.id === permId);\r\n                  return perm ? (\r\n                    <Tag key={permId} color=\"blue\" icon={<CheckCircleOutlined />}>\r\n                      {perm.name}\r\n                    </Tag>\r\n                  ) : null;\r\n                })}\r\n              </Space>\r\n            </Card>\r\n          </Space>\r\n        )}\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RoleManagementPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\views\\UserManagementPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1582,1585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1582,1585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'loadUsers'. Either include it or remove the dependency array.","line":91,"column":6,"nodeType":"ArrayExpression","endLine":91,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [roleFilter, statusFilter, tenantFilter, searchText, loadUsers]","fix":{"range":[2261,2313],"text":"[roleFilter, statusFilter, tenantFilter, searchText, loadUsers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * User Management Page - Enterprise Ant Design Version\r\n * Comprehensive user management with role assignment and activity tracking\r\n */\r\nimport React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Button,\r\n  Input,\r\n  Select,\r\n  Space,\r\n  Tag,\r\n  Avatar,\r\n  Modal,\r\n  Form,\r\n  Row,\r\n  Col,\r\n  Popconfirm,\r\n  message,\r\n  Empty,\r\n  Spin,\r\n  Tooltip,\r\n  Badge,\r\n  Dropdown,\r\n  type MenuProps\r\n} from 'antd';\r\nimport {\r\n  UserOutlined,\r\n  UserAddOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  SearchOutlined,\r\n  FilterOutlined,\r\n  MailOutlined,\r\n  PhoneOutlined,\r\n  CalendarOutlined,\r\n  ClockCircleOutlined,\r\n  LockOutlined,\r\n  UnlockOutlined,\r\n  MoreOutlined,\r\n  CrownOutlined,\r\n  SafetyOutlined,\r\n  TeamOutlined,\r\n  CustomerServiceOutlined,\r\n  ToolOutlined,\r\n  ExportOutlined,\r\n  ReloadOutlined\r\n} from '@ant-design/icons';\r\nimport type { ColumnsType } from 'antd/es/table';\r\nimport { PageHeader } from '@/components/common/PageHeader';\r\nimport { StatCard } from '@/components/common/StatCard';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport type { User } from '@/types/crm';\r\n\r\nconst { Option } = Select;\r\n\r\ninterface UserFormData {\r\n  email: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  role: string;\r\n  phone?: string;\r\n  status: string;\r\n  tenantId: string;\r\n}\r\n\r\nexport const UserManagementPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { hasPermission } = useAuth();\r\n  const userService = useService<any>('userService');\r\n  const [form] = Form.useForm();\r\n\r\n  // State\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchText, setSearchText] = useState('');\r\n  const [roleFilter, setRoleFilter] = useState<string>('');\r\n  const [statusFilter, setStatusFilter] = useState<string>('');\r\n  const [tenantFilter, setTenantFilter] = useState<string>('');\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  const [editingUser, setEditingUser] = useState<User | null>(null);\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  // Load users\r\n   \r\n  React.useEffect(() => {\r\n    loadUsers();\r\n  }, [roleFilter, statusFilter, tenantFilter, searchText]);\r\n\r\n  const loadUsers = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await userService.getUsers({\r\n        role: roleFilter || undefined,\r\n        status: statusFilter || undefined,\r\n        tenantId: tenantFilter || undefined,\r\n        search: searchText || undefined\r\n      });\r\n      setUsers(data);\r\n    } catch (error) {\r\n      message.error('Failed to load users');\r\n      console.error('Error loading users:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle create user\r\n  const handleCreate = () => {\r\n    setEditingUser(null);\r\n    form.resetFields();\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle edit user\r\n  const handleEdit = (user: User) => {\r\n    setEditingUser(user);\r\n    form.setFieldsValue({\r\n      email: user.email,\r\n      firstName: user.firstName,\r\n      lastName: user.lastName,\r\n      role: user.role,\r\n      phone: user.phone,\r\n      status: user.status,\r\n      tenantId: user.tenantId\r\n    });\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  // Handle delete user\r\n  const handleDelete = async (userId: string) => {\r\n    try {\r\n      await userService.deleteUser(userId);\r\n      message.success('User deleted successfully');\r\n      loadUsers();\r\n    } catch (error: unknown) {\r\n      const error_msg = error instanceof Error ? error.message : 'Failed to delete user';\r\n      message.error(error_msg);\r\n    }\r\n  };\r\n\r\n  // Handle reset password\r\n  const handleResetPassword = async (userId: string) => {\r\n    try {\r\n      await userService.resetPassword(userId);\r\n      message.success('Password reset email sent');\r\n    } catch (error: unknown) {\r\n      const error_msg = error instanceof Error ? error.message : 'Failed to reset password';\r\n      message.error(error_msg);\r\n    }\r\n  };\r\n\r\n  // Handle form submit\r\n  const handleSubmit = async (values: UserFormData) => {\r\n    try {\r\n      setSubmitting(true);\r\n      if (editingUser) {\r\n        await userService.updateUser(editingUser.id, values);\r\n        message.success('User updated successfully');\r\n      } else {\r\n        await userService.createUser(values);\r\n        message.success('User created successfully');\r\n      }\r\n      setIsModalVisible(false);\r\n      form.resetFields();\r\n      loadUsers();\r\n    } catch (error: unknown) {\r\n      const error_msg = error instanceof Error ? error.message : 'Failed to save user';\r\n      message.error(error_msg);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Get role icon\r\n  const getRoleIcon = (role: string) => {\r\n    switch (role.toLowerCase()) {\r\n      case 'admin':\r\n        return <CrownOutlined />;\r\n      case 'manager':\r\n        return <SafetyOutlined />;\r\n      case 'viewer':\r\n        return <UserOutlined />;\r\n      default:\r\n        return <TeamOutlined />;\r\n    }\r\n  };\r\n\r\n  // Get role color\r\n  const getRoleColor = (role: string) => {\r\n    switch (role.toLowerCase()) {\r\n      case 'admin':\r\n        return 'red';\r\n      case 'manager':\r\n        return 'blue';\r\n      case 'viewer':\r\n        return 'default';\r\n      default:\r\n        return 'green';\r\n    }\r\n  };\r\n\r\n  // Get status color\r\n  const getStatusColor = (status: string) => {\r\n    switch (status.toLowerCase()) {\r\n      case 'active':\r\n        return 'success';\r\n      case 'inactive':\r\n        return 'default';\r\n      case 'suspended':\r\n        return 'error';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  // Action menu items\r\n  const getActionMenu = (user: User): MenuProps['items'] => [\r\n    {\r\n      key: 'edit',\r\n      label: 'Edit User',\r\n      icon: <EditOutlined />,\r\n      onClick: () => handleEdit(user)\r\n    },\r\n    {\r\n      key: 'reset',\r\n      label: 'Reset Password',\r\n      icon: <LockOutlined />,\r\n      onClick: () => handleResetPassword(user.id)\r\n    },\r\n    {\r\n      type: 'divider'\r\n    },\r\n    {\r\n      key: 'delete',\r\n      label: 'Delete User',\r\n      icon: <DeleteOutlined />,\r\n      danger: true,\r\n      onClick: () => {\r\n        Modal.confirm({\r\n          title: 'Delete User',\r\n          content: `Are you sure you want to delete ${user.firstName} ${user.lastName}?`,\r\n          okText: 'Delete',\r\n          okType: 'danger',\r\n          onOk: () => handleDelete(user.id)\r\n        });\r\n      }\r\n    }\r\n  ];\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<User> = [\r\n    {\r\n      title: 'User',\r\n      key: 'user',\r\n      fixed: 'left',\r\n      width: 280,\r\n      render: (_, record) => (\r\n        <Space>\r\n          <Avatar\r\n            size={40}\r\n            src={record.avatar}\r\n            icon={<UserOutlined />}\r\n            style={{ backgroundColor: '#1890ff' }}\r\n          />\r\n          <div>\r\n            <div style={{ fontWeight: 500, color: '#2C3E50' }}>\r\n              {record.firstName} {record.lastName}\r\n            </div>\r\n            <div style={{ fontSize: 12, color: '#7A8691' }}>\r\n              <MailOutlined style={{ marginRight: 4 }} />\r\n              {record.email}\r\n            </div>\r\n          </div>\r\n        </Space>\r\n      )\r\n    },\r\n    {\r\n      title: 'Role',\r\n      dataIndex: 'role',\r\n      key: 'role',\r\n      width: 120,\r\n      render: (role: string) => (\r\n        <Tag icon={getRoleIcon(role)} color={getRoleColor(role)}>\r\n          {role}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Tenant',\r\n      dataIndex: 'tenantName',\r\n      key: 'tenantName',\r\n      width: 180,\r\n      render: (tenantName: string) => (\r\n        <span style={{ color: '#2C3E50' }}>{tenantName}</span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Phone',\r\n      dataIndex: 'phone',\r\n      key: 'phone',\r\n      width: 150,\r\n      render: (phone: string) => (\r\n        phone ? (\r\n          <span style={{ color: '#7A8691' }}>\r\n            <PhoneOutlined style={{ marginRight: 4 }} />\r\n            {phone}\r\n          </span>\r\n        ) : (\r\n          <span style={{ color: '#9EAAB7' }}>-</span>\r\n        )\r\n      )\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 100,\r\n      render: (status: string) => (\r\n        <Tag color={getStatusColor(status)}>\r\n          {status.toUpperCase()}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Last Login',\r\n      dataIndex: 'lastLogin',\r\n      key: 'lastLogin',\r\n      width: 180,\r\n      render: (lastLogin: string) => (\r\n        <span style={{ color: '#7A8691' }}>\r\n          <ClockCircleOutlined style={{ marginRight: 4 }} />\r\n          {new Date(lastLogin).toLocaleString()}\r\n        </span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      width: 120,\r\n      render: (createdAt: string) => (\r\n        <span style={{ color: '#7A8691' }}>\r\n          {new Date(createdAt).toLocaleDateString()}\r\n        </span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      fixed: 'right',\r\n      width: 100,\r\n      render: (_, record) => (\r\n        <Space>\r\n          {hasPermission('manage_users') && (\r\n            <>\r\n              <Tooltip title=\"Edit\">\r\n                <Button\r\n                  type=\"text\"\r\n                  size=\"small\"\r\n                  icon={<EditOutlined />}\r\n                  onClick={() => handleEdit(record)}\r\n                />\r\n              </Tooltip>\r\n              <Dropdown menu={{ items: getActionMenu(record) }} trigger={['click']}>\r\n                <Button type=\"text\" size=\"small\" icon={<MoreOutlined />} />\r\n              </Dropdown>\r\n            </>\r\n          )}\r\n        </Space>\r\n      )\r\n    }\r\n  ];\r\n\r\n  // Calculate stats\r\n  const totalUsers = users.length;\r\n  const activeUsers = users.filter(u => u.status === 'active').length;\r\n  const adminUsers = users.filter(u => u.role === 'Admin').length;\r\n  const suspendedUsers = users.filter(u => u.status === 'suspended').length;\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"User Management\"\r\n        description=\"Manage user accounts, roles, and permissions\"\r\n        breadcrumbs={[\r\n          { title: 'Home', path: '/' },\r\n          { title: 'User Management' }\r\n        ]}\r\n        extra={\r\n          hasPermission('manage_users') ? (\r\n            <Space>\r\n              <Button\r\n                icon={<ReloadOutlined />}\r\n                onClick={loadUsers}\r\n              >\r\n                Refresh\r\n              </Button>\r\n              <Button\r\n                icon={<ExportOutlined />}\r\n              >\r\n                Export\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<UserAddOutlined />}\r\n                onClick={handleCreate}\r\n              >\r\n                Add User\r\n              </Button>\r\n            </Space>\r\n          ) : undefined\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Users\"\r\n              value={totalUsers}\r\n              icon={<TeamOutlined />}\r\n              color=\"primary\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Active Users\"\r\n              value={activeUsers}\r\n              icon={<UserOutlined />}\r\n              color=\"success\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Administrators\"\r\n              value={adminUsers}\r\n              icon={<CrownOutlined />}\r\n              color=\"warning\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Suspended\"\r\n              value={suspendedUsers}\r\n              icon={<LockOutlined />}\r\n              color=\"error\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Filters */}\r\n        <Card style={{ marginBottom: 16 }}>\r\n          <Row gutter={[16, 16]}>\r\n            <Col xs={24} md={8}>\r\n              <Input\r\n                placeholder=\"Search by name, email, or tenant...\"\r\n                prefix={<SearchOutlined />}\r\n                value={searchText}\r\n                onChange={(e) => setSearchText(e.target.value)}\r\n                allowClear\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={8} md={5}>\r\n              <Select\r\n                placeholder=\"Filter by Role\"\r\n                style={{ width: '100%' }}\r\n                value={roleFilter || undefined}\r\n                onChange={setRoleFilter}\r\n                allowClear\r\n              >\r\n                <Option value=\"\">All Roles</Option>\r\n                <Option value=\"Admin\">Admin</Option>\r\n                <Option value=\"Manager\">Manager</Option>\r\n                <Option value=\"Viewer\">Viewer</Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={8} md={5}>\r\n              <Select\r\n                placeholder=\"Filter by Status\"\r\n                style={{ width: '100%' }}\r\n                value={statusFilter || undefined}\r\n                onChange={setStatusFilter}\r\n                allowClear\r\n              >\r\n                <Option value=\"\">All Statuses</Option>\r\n                <Option value=\"active\">Active</Option>\r\n                <Option value=\"inactive\">Inactive</Option>\r\n                <Option value=\"suspended\">Suspended</Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={8} md={6}>\r\n              <Select\r\n                placeholder=\"Filter by Tenant\"\r\n                style={{ width: '100%' }}\r\n                value={tenantFilter || undefined}\r\n                onChange={setTenantFilter}\r\n                allowClear\r\n              >\r\n                <Option value=\"\">All Tenants</Option>\r\n                <Option value=\"tenant_1\">Acme Corporation</Option>\r\n                <Option value=\"tenant_2\">TechStart Inc</Option>\r\n                <Option value=\"tenant_3\">Global Solutions Ltd</Option>\r\n                <Option value=\"tenant_4\">Innovation Labs</Option>\r\n                <Option value=\"tenant_5\">Enterprise Systems</Option>\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n        </Card>\r\n\r\n        {/* Users Table */}\r\n        <Card>\r\n          <Table\r\n            columns={columns}\r\n            dataSource={users}\r\n            rowKey=\"id\"\r\n            loading={loading}\r\n            scroll={{ x: 1400 }}\r\n            pagination={{\r\n              total: users.length,\r\n              pageSize: 10,\r\n              showSizeChanger: true,\r\n              showTotal: (total) => `Total ${total} users`\r\n            }}\r\n            locale={{\r\n              emptyText: (\r\n                <Empty\r\n                  image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                  description=\"No users found\"\r\n                >\r\n                  {hasPermission('manage_users') && (\r\n                    <Button\r\n                      type=\"primary\"\r\n                      icon={<UserAddOutlined />}\r\n                      onClick={handleCreate}\r\n                    >\r\n                      Add First User\r\n                    </Button>\r\n                  )}\r\n                </Empty>\r\n              )\r\n            }}\r\n          />\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Create/Edit User Modal */}\r\n      <Modal\r\n        title={editingUser ? 'Edit User' : 'Create New User'}\r\n        open={isModalVisible}\r\n        onCancel={() => {\r\n          setIsModalVisible(false);\r\n          form.resetFields();\r\n        }}\r\n        footer={null}\r\n        width={600}\r\n      >\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          onFinish={handleSubmit}\r\n        >\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"firstName\"\r\n                label=\"First Name\"\r\n                rules={[\r\n                  { required: true, message: 'Please enter first name' },\r\n                  { min: 2, message: 'First name must be at least 2 characters' }\r\n                ]}\r\n              >\r\n                <Input\r\n                  prefix={<UserOutlined />}\r\n                  placeholder=\"Enter first name\"\r\n                  size=\"large\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"lastName\"\r\n                label=\"Last Name\"\r\n                rules={[\r\n                  { required: true, message: 'Please enter last name' },\r\n                  { min: 2, message: 'Last name must be at least 2 characters' }\r\n                ]}\r\n              >\r\n                <Input\r\n                  prefix={<UserOutlined />}\r\n                  placeholder=\"Enter last name\"\r\n                  size=\"large\"\r\n                />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item\r\n            name=\"email\"\r\n            label=\"Email Address\"\r\n            rules={[\r\n              { required: true, message: 'Please enter email' },\r\n              { type: 'email', message: 'Please enter a valid email' }\r\n            ]}\r\n          >\r\n            <Input\r\n              prefix={<MailOutlined />}\r\n              placeholder=\"Enter email address\"\r\n              size=\"large\"\r\n              disabled={!!editingUser}\r\n            />\r\n          </Form.Item>\r\n\r\n          <Form.Item\r\n            name=\"phone\"\r\n            label=\"Phone Number\"\r\n            rules={[\r\n              { pattern: /^[+]?[(]?[0-9]{1,4}[)]?[-\\s.]?[(]?[0-9]{1,4}[)]?[-\\s.]?[0-9]{1,9}$/, message: 'Please enter a valid phone number' }\r\n            ]}\r\n          >\r\n            <Input\r\n              prefix={<PhoneOutlined />}\r\n              placeholder=\"Enter phone number\"\r\n              size=\"large\"\r\n            />\r\n          </Form.Item>\r\n\r\n          <Row gutter={16}>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"role\"\r\n                label=\"Role\"\r\n                rules={[{ required: true, message: 'Please select a role' }]}\r\n              >\r\n                <Select\r\n                  placeholder=\"Select role\"\r\n                  size=\"large\"\r\n                >\r\n                  <Option value=\"Admin\">\r\n                    <Space>\r\n                      <CrownOutlined />\r\n                      Admin\r\n                    </Space>\r\n                  </Option>\r\n                  <Option value=\"Manager\">\r\n                    <Space>\r\n                      <SafetyOutlined />\r\n                      Manager\r\n                    </Space>\r\n                  </Option>\r\n                  <Option value=\"Viewer\">\r\n                    <Space>\r\n                      <UserOutlined />\r\n                      Viewer\r\n                    </Space>\r\n                  </Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item\r\n                name=\"status\"\r\n                label=\"Status\"\r\n                rules={[{ required: true, message: 'Please select a status' }]}\r\n              >\r\n                <Select\r\n                  placeholder=\"Select status\"\r\n                  size=\"large\"\r\n                >\r\n                  <Option value=\"active\">Active</Option>\r\n                  <Option value=\"inactive\">Inactive</Option>\r\n                  <Option value=\"suspended\">Suspended</Option>\r\n                </Select>\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item\r\n            name=\"tenantId\"\r\n            label=\"Tenant\"\r\n            rules={[{ required: true, message: 'Please select a tenant' }]}\r\n          >\r\n            <Select\r\n              placeholder=\"Select tenant\"\r\n              size=\"large\"\r\n              showSearch\r\n              filterOption={(input, option) =>\r\n                (option?.children as string).toLowerCase().includes(input.toLowerCase())\r\n              }\r\n            >\r\n              <Option value=\"tenant_1\">Acme Corporation</Option>\r\n              <Option value=\"tenant_2\">TechStart Inc</Option>\r\n              <Option value=\"tenant_3\">Global Solutions Ltd</Option>\r\n              <Option value=\"tenant_4\">Innovation Labs</Option>\r\n              <Option value=\"tenant_5\">Enterprise Systems</Option>\r\n            </Select>\r\n          </Form.Item>\r\n\r\n          <Form.Item style={{ marginBottom: 0, marginTop: 24 }}>\r\n            <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\r\n              <Button\r\n                onClick={() => {\r\n                  setIsModalVisible(false);\r\n                  form.resetFields();\r\n                }}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                htmlType=\"submit\"\r\n                loading={submitting}\r\n                icon={editingUser ? <EditOutlined /> : <UserAddOutlined />}\r\n              >\r\n                {editingUser ? 'Update User' : 'Create User'}\r\n              </Button>\r\n            </Space>\r\n          </Form.Item>\r\n        </Form>\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default UserManagementPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\features\\user-management\\views\\UsersPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1450,1453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1450,1453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadMetadata' and 'loadUsers'. Either include them or remove the dependency array.","line":85,"column":6,"nodeType":"ArrayExpression","endLine":85,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadMetadata, loadUsers]","fix":{"range":[2336,2338],"text":"[loadMetadata, loadUsers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Users Page - Modular Version\r\n * Enhanced user management with role-based access control\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { \r\n  Row, \r\n  Col, \r\n  Card, \r\n  Button, \r\n  Table, \r\n  Tag, \r\n  Space, \r\n  Spin,\r\n  Alert,\r\n  Modal,\r\n  Avatar,\r\n  Tooltip,\r\n  Dropdown,\r\n  Input,\r\n  message,\r\n  Empty,\r\n  type MenuProps,\r\n  type ColumnsType\r\n} from 'antd';\r\nimport { \r\n  PlusOutlined,\r\n  ReloadOutlined,\r\n  EditOutlined,\r\n  DeleteOutlined,\r\n  MailOutlined,\r\n  PhoneOutlined,\r\n  ClockCircleOutlined,\r\n  LockOutlined,\r\n  MoreOutlined,\r\n  CrownOutlined,\r\n  SafetyOutlined,\r\n  TeamOutlined,\r\n  UserOutlined as UserAntIcon\r\n} from '@ant-design/icons';\r\nimport { \r\n  Users as UsersIcon,\r\n  User,\r\n  UserCheck,\r\n  UserX\r\n} from 'lucide-react';\r\nimport { PageHeader, StatCard } from '@/components/common';\r\nimport { useService } from '@/modules/core/hooks/useService';\r\nimport { User as UserType } from '@/types/crm';\r\nimport { UserDetailPanel } from '../components/UserDetailPanel';\r\nimport { UserFormPanel } from '../components/UserFormPanel';\r\n\r\ninterface UserFormData {\r\n  email: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  role: string;\r\n  phone?: string;\r\n  status: string;\r\n  tenantId: string;\r\n}\r\n\r\nexport const UsersPage: React.FC = () => {\r\n  const { hasPermission, isAuthenticated, isLoading: authLoading } = useAuth();\r\n  const userService = useService<any>('userService');\r\n  \r\n  // State\r\n  const [users, setUsers] = useState<UserType[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [searchText, setSearchText] = useState('');\r\n  const [drawerMode, setDrawerMode] = useState<'create' | 'edit' | 'view' | null>(null);\r\n  const [selectedUser, setSelectedUser] = useState<UserType | null>(null);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [allTenants, setAllTenants] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [allRoles, setAllRoles] = useState<string[]>(['Admin', 'Manager', 'Viewer']);\r\n  const [allStatuses] = useState<string[]>(['active', 'inactive', 'suspended']);\r\n\r\n  // Load users and metadata on component mount\r\n  // Note: Service layer handles authorization via RLS (Supabase) or database rules (mock)\r\n   \r\n  useEffect(() => {\r\n    loadUsers();\r\n    loadMetadata();\r\n  }, []);\r\n\r\n  const loadMetadata = async () => {\r\n    try {\r\n      const tenants = await userService.getTenants();\r\n      const roles = await userService.getRoles();\r\n      setAllTenants(tenants || []);\r\n      setAllRoles(roles || ['Admin', 'Manager', 'Viewer']);\r\n    } catch (error) {\r\n      console.error('Error loading metadata:', error);\r\n    }\r\n  };\r\n\r\n  const loadUsers = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await userService.getUsers();\r\n      setUsers(data || []);\r\n    } catch (error) {\r\n      message.error('Failed to load users');\r\n      console.error('Error loading users:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle create user\r\n  const handleCreate = () => {\r\n    setSelectedUser(null);\r\n    setDrawerMode('create');\r\n  };\r\n\r\n  // Handle view user\r\n  const handleView = (user: UserType) => {\r\n    setSelectedUser(user);\r\n    setDrawerMode('view');\r\n  };\r\n\r\n  // Handle edit user\r\n  const handleEdit = (user: UserType) => {\r\n    setSelectedUser(user);\r\n    setDrawerMode('edit');\r\n  };\r\n\r\n  // Close drawer\r\n  const closeDrawer = () => {\r\n    setDrawerMode(null);\r\n    setSelectedUser(null);\r\n  };\r\n\r\n  // Handle delete user\r\n  const handleDelete = async (userId: string, userName: string) => {\r\n    Modal.confirm({\r\n      title: 'Delete User',\r\n      content: `Are you sure you want to delete ${userName}?`,\r\n      okText: 'Delete',\r\n      okType: 'danger',\r\n      onOk: async () => {\r\n        try {\r\n          await userService.deleteUser(userId);\r\n          message.success('User deleted successfully');\r\n          loadUsers();\r\n        } catch (error: unknown) {\r\n          const error_msg = error instanceof Error ? error.message : 'Failed to delete user';\r\n          message.error(error_msg);\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  // Handle reset password\r\n  const handleResetPassword = async (userId: string) => {\r\n    try {\r\n      await userService.resetPassword(userId);\r\n      message.success('Password reset email sent');\r\n    } catch (error: unknown) {\r\n      const error_msg = error instanceof Error ? error.message : 'Failed to reset password';\r\n      message.error(error_msg);\r\n    }\r\n  };\r\n\r\n  // Handle form save\r\n  const handleFormSave = async (values: UserFormData) => {\r\n    try {\r\n      setIsSaving(true);\r\n      if (drawerMode === 'edit' && selectedUser) {\r\n        await userService.updateUser(selectedUser.id, values);\r\n        message.success('User updated successfully');\r\n      } else if (drawerMode === 'create') {\r\n        await userService.createUser(values);\r\n        message.success('User created successfully');\r\n      }\r\n      closeDrawer();\r\n      loadUsers();\r\n    } catch (error: unknown) {\r\n      const error_msg = error instanceof Error ? error.message : 'Failed to save user';\r\n      message.error(error_msg);\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  // Get role icon\r\n  const getRoleIcon = (role: string) => {\r\n    switch (role.toLowerCase()) {\r\n      case 'admin':\r\n        return <CrownOutlined />;\r\n      case 'manager':\r\n        return <SafetyOutlined />;\r\n      case 'viewer':\r\n        return <UserAntIcon />;\r\n      default:\r\n        return <TeamOutlined />;\r\n    }\r\n  };\r\n\r\n  // Get role color\r\n  const getRoleColor = (role: string) => {\r\n    switch (role.toLowerCase()) {\r\n      case 'admin':\r\n        return 'red';\r\n      case 'manager':\r\n        return 'blue';\r\n      case 'viewer':\r\n        return 'default';\r\n      default:\r\n        return 'green';\r\n    }\r\n  };\r\n\r\n  // Get status color\r\n  const getStatusColor = (status: string) => {\r\n    switch (status.toLowerCase()) {\r\n      case 'active':\r\n        return 'success';\r\n      case 'inactive':\r\n        return 'default';\r\n      case 'suspended':\r\n        return 'error';\r\n      default:\r\n        return 'default';\r\n    }\r\n  };\r\n\r\n  // Action menu items\r\n  const getActionMenu = (user: UserType): MenuProps['items'] => [\r\n    {\r\n      key: 'view',\r\n      label: 'View Profile',\r\n      onClick: () => handleView(user)\r\n    },\r\n    {\r\n      key: 'edit',\r\n      label: 'Edit User',\r\n      icon: <EditOutlined />,\r\n      onClick: () => handleEdit(user),\r\n      disabled: !hasPermission('manage_users')\r\n    },\r\n    {\r\n      key: 'reset',\r\n      label: 'Reset Password',\r\n      icon: <LockOutlined />,\r\n      onClick: () => handleResetPassword(user.id),\r\n      disabled: !hasPermission('manage_users')\r\n    },\r\n    {\r\n      type: 'divider'\r\n    },\r\n    {\r\n      key: 'delete',\r\n      label: 'Delete User',\r\n      icon: <DeleteOutlined />,\r\n      danger: true,\r\n      onClick: () => handleDelete(user.id, `${user.firstName} ${user.lastName}`),\r\n      disabled: !hasPermission('manage_users')\r\n    }\r\n  ];\r\n\r\n  // Filtered users\r\n  const filteredUsers = users.filter(user =>\r\n    user.email.toLowerCase().includes(searchText.toLowerCase()) ||\r\n    user.firstName.toLowerCase().includes(searchText.toLowerCase()) ||\r\n    user.lastName.toLowerCase().includes(searchText.toLowerCase())\r\n  );\r\n\r\n  // Table columns\r\n  const columns: ColumnsType<UserType> = [\r\n    {\r\n      title: 'User',\r\n      key: 'user',\r\n      fixed: 'left',\r\n      width: 280,\r\n      render: (_, record) => (\r\n        <Space>\r\n          <Avatar\r\n            size={40}\r\n            src={record.avatar}\r\n            icon={<UserAntIcon />}\r\n            style={{ backgroundColor: '#1890ff' }}\r\n          />\r\n          <div>\r\n            <div style={{ fontWeight: 500, color: '#2C3E50' }}>\r\n              {record.firstName} {record.lastName}\r\n            </div>\r\n            <div style={{ fontSize: 12, color: '#7A8691' }}>\r\n              <MailOutlined style={{ marginRight: 4 }} />\r\n              {record.email}\r\n            </div>\r\n          </div>\r\n        </Space>\r\n      )\r\n    },\r\n    {\r\n      title: 'Role',\r\n      dataIndex: 'role',\r\n      key: 'role',\r\n      width: 120,\r\n      render: (role: string) => (\r\n        <Tag icon={getRoleIcon(role)} color={getRoleColor(role)}>\r\n          {role}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Tenant',\r\n      dataIndex: 'tenantName',\r\n      key: 'tenantName',\r\n      width: 180,\r\n      render: (tenantName: string) => (\r\n        <span style={{ color: '#2C3E50' }}>{tenantName}</span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Phone',\r\n      dataIndex: 'phone',\r\n      key: 'phone',\r\n      width: 150,\r\n      render: (phone: string) => (\r\n        phone ? (\r\n          <span style={{ color: '#7A8691' }}>\r\n            <PhoneOutlined style={{ marginRight: 4 }} />\r\n            {phone}\r\n          </span>\r\n        ) : (\r\n          <span style={{ color: '#9EAAB7' }}>-</span>\r\n        )\r\n      )\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      width: 100,\r\n      render: (status: string) => (\r\n        <Tag color={getStatusColor(status)}>\r\n          {status.toUpperCase()}\r\n        </Tag>\r\n      )\r\n    },\r\n    {\r\n      title: 'Last Login',\r\n      dataIndex: 'lastLogin',\r\n      key: 'lastLogin',\r\n      width: 180,\r\n      render: (lastLogin: string) => (\r\n        <span style={{ color: '#7A8691' }}>\r\n          <ClockCircleOutlined style={{ marginRight: 4 }} />\r\n          {lastLogin ? new Date(lastLogin).toLocaleString() : 'Never'}\r\n        </span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      width: 120,\r\n      render: (createdAt: string) => (\r\n        <span style={{ color: '#7A8691' }}>\r\n          {new Date(createdAt).toLocaleDateString()}\r\n        </span>\r\n      )\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      fixed: 'right',\r\n      width: 100,\r\n      render: (_, record) => (\r\n        <Space>\r\n          {hasPermission('manage_users') && (\r\n            <>\r\n              <Tooltip title=\"Edit\">\r\n                <Button\r\n                  type=\"text\"\r\n                  size=\"small\"\r\n                  icon={<EditOutlined />}\r\n                  onClick={() => handleEdit(record)}\r\n                />\r\n              </Tooltip>\r\n              <Dropdown menu={{ items: getActionMenu(record) }} trigger={['click']}>\r\n                <Button type=\"text\" size=\"small\" icon={<MoreOutlined />} />\r\n              </Dropdown>\r\n            </>\r\n          )}\r\n        </Space>\r\n      )\r\n    }\r\n  ];\r\n\r\n  // Calculate stats\r\n  const totalUsers = users.length;\r\n  const activeUsers = users.filter(u => u.status === 'active').length;\r\n  const adminUsers = users.filter(u => u.role === 'Admin').length;\r\n  const suspendedUsers = users.filter(u => u.status === 'suspended').length;\r\n\r\n  // Show loading while checking authentication\r\n  if (authLoading) {\r\n    return (\r\n      <div style={{ padding: 24, textAlign: 'center' }}>\r\n        <Spin size=\"large\" tip=\"Loading authentication...\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Check if user is authenticated\r\n  if (!isAuthenticated) {\r\n    return (\r\n      <div style={{ padding: 24 }}>\r\n        <Alert\r\n          message=\"Authentication Required\"\r\n          description=\"Please log in to access user management.\"\r\n          type=\"warning\"\r\n          showIcon\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!hasPermission('manage_users')) {\r\n    return (\r\n      <div style={{ padding: 24 }}>\r\n        <Alert\r\n          message=\"Access Denied\"\r\n          description=\"You don't have permission to access user management.\"\r\n          type=\"error\"\r\n          showIcon\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title=\"User Management\"\r\n        description=\"Manage user accounts and access control\"\r\n        breadcrumbs={[\r\n          { title: 'Home', path: '/' },\r\n          { title: 'User Management' }\r\n        ]}\r\n        extra={\r\n          hasPermission('manage_users') ? (\r\n            <Space>\r\n              <Button\r\n                icon={<ReloadOutlined />}\r\n                onClick={loadUsers}\r\n              >\r\n                Refresh\r\n              </Button>\r\n              <Button\r\n                type=\"primary\"\r\n                icon={<PlusOutlined />}\r\n                onClick={handleCreate}\r\n              >\r\n                Create User\r\n              </Button>\r\n            </Space>\r\n          ) : null\r\n        }\r\n      />\r\n\r\n      <div style={{ padding: 24 }}>\r\n        {/* Statistics */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Total Users\"\r\n              value={totalUsers}\r\n              icon={<UsersIcon />}\r\n              color=\"primary\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Active Users\"\r\n              value={activeUsers}\r\n              icon={<UserCheck />}\r\n              color=\"success\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Admin Users\"\r\n              value={adminUsers}\r\n              icon={<CrownOutlined />}\r\n              color=\"warning\"\r\n            />\r\n          </Col>\r\n          <Col xs={24} sm={12} lg={6}>\r\n            <StatCard\r\n              title=\"Suspended\"\r\n              value={suspendedUsers}\r\n              icon={<UserX />}\r\n              color=\"error\"\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        {/* Users Table */}\r\n        <Card\r\n          title=\"Users\"\r\n          extra={\r\n            <Space>\r\n              <Input.Search\r\n                placeholder=\"Search by name or email...\"\r\n                allowClear\r\n                style={{ width: 250 }}\r\n                value={searchText}\r\n                onChange={(e) => setSearchText(e.target.value)}\r\n              />\r\n            </Space>\r\n          }\r\n        >\r\n          <Spin spinning={loading} tip=\"Loading users...\">\r\n            {filteredUsers.length === 0 && !loading ? (\r\n              <Empty\r\n                description=\"No users found\"\r\n                style={{ padding: '40px 0' }}\r\n              />\r\n            ) : (\r\n              <Table\r\n                columns={columns}\r\n                dataSource={filteredUsers}\r\n                rowKey=\"id\"\r\n                loading={loading}\r\n                pagination={{\r\n                  pageSize: 10,\r\n                  showSizeChanger: true,\r\n                  showTotal: (total) => `Total ${total} users`\r\n                }}\r\n                scroll={{ x: 1200 }}\r\n              />\r\n            )}\r\n          </Spin>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* User Detail Drawer */}\r\n      {drawerMode === 'view' && selectedUser && (\r\n        <UserDetailPanel\r\n          user={selectedUser}\r\n          open={true}\r\n          onClose={closeDrawer}\r\n          onEdit={handleEdit}\r\n        />\r\n      )}\r\n\r\n      {/* User Form Drawer - Create/Edit */}\r\n      {(drawerMode === 'create' || drawerMode === 'edit') && (\r\n        <UserFormPanel\r\n          open={true}\r\n          mode={drawerMode}\r\n          user={selectedUser}\r\n          onClose={closeDrawer}\r\n          onSave={handleFormSave}\r\n          loading={isSaving}\r\n          allRoles={allRoles}\r\n          allTenants={allTenants}\r\n          allStatuses={allStatuses}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default UsersPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\routing\\LazyRoute.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":37,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":37,"endColumn":32},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":61,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":61,"endColumn":29},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":69,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":69,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Lazy Route Component\r\n * Handles lazy loading of route components with loading states\r\n */\r\n\r\nimport React, { Suspense } from 'react';\r\nimport { ErrorBoundary } from '@/modules/core/components/ErrorBoundary';\r\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\r\n\r\ninterface LazyRouteProps {\r\n  children: React.ReactNode;\r\n  fallback?: React.ReactNode;\r\n  errorFallback?: React.ReactNode;\r\n}\r\n\r\nexport const LazyRoute: React.FC<LazyRouteProps> = ({\r\n  children,\r\n  fallback,\r\n  errorFallback,\r\n}) => {\r\n  const defaultFallback = (\r\n    <div className=\"min-h-screen flex items-center justify-center\">\r\n      <LoadingSpinner size=\"lg\" text=\"Loading page...\" />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <ErrorBoundary fallback={errorFallback}>\r\n      <Suspense fallback={fallback || defaultFallback}>\r\n        {children}\r\n      </Suspense>\r\n    </ErrorBoundary>\r\n  );\r\n};\r\n\r\n// HOC for creating lazy routes\r\nexport function createLazyRoute<P extends object>(\r\n  importFn: () => Promise<{ default: React.ComponentType<P> }>,\r\n  options?: {\r\n    fallback?: React.ReactNode;\r\n    errorFallback?: React.ReactNode;\r\n  }\r\n) {\r\n  const LazyComponent = React.lazy(importFn);\r\n  \r\n  const WrappedComponent = (props: P) => (\r\n    <LazyRoute \r\n      fallback={options?.fallback}\r\n      errorFallback={options?.errorFallback}\r\n    >\r\n      <LazyComponent {...props} />\r\n    </LazyRoute>\r\n  );\r\n\r\n  WrappedComponent.displayName = `LazyRoute(${LazyComponent.displayName || 'Component'})`;\r\n  \r\n  return WrappedComponent;\r\n}\r\n\r\n// Preload function for route components\r\nexport function preloadRoute(importFn: () => Promise<Record<string, unknown>>): void {\r\n  // Preload the component\r\n  importFn().catch(error => {\r\n    console.warn('Failed to preload route component:', error);\r\n  });\r\n}\r\n\r\n// Route preloader hook\r\nexport function useRoutePreloader() {\r\n  const preloadRoutes = React.useCallback((routes: Array<() => Promise<Record<string, unknown>>>) => {\r\n    routes.forEach(route => {\r\n      preloadRoute(route);\r\n    });\r\n  }, []);\r\n\r\n  return { preloadRoutes };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\routing\\ModularRouter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\routing\\RouteGuard.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":63,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":63,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Route Guard Component\n * Handles route protection and permission checking\n */\n\nimport React from 'react';\nimport { Navigate, useLocation } from 'react-router-dom';\nimport { useAuth } from '@/modules/core/store';\nimport { LoadingSpinner } from '@/modules/core/components/LoadingSpinner';\n\ninterface RouteGuardProps {\n  children: React.ReactNode;\n  permissions?: string[];\n  roles?: string[];\n  requireAuth?: boolean;\n  fallbackPath?: string;\n}\n\nexport const RouteGuard: React.FC<RouteGuardProps> = ({\n  children,\n  permissions = [],\n  roles = [],\n  requireAuth = true,\n  fallbackPath = '/login',\n}) => {\n  const location = useLocation();\n  const { isAuthenticated, isLoading, user, hasRole, hasPermission } = useAuth();\n\n  // Show loading while checking authentication\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <LoadingSpinner size=\"lg\" text=\"Checking authentication...\" />\n      </div>\n    );\n  }\n\n  // Redirect to login if authentication is required but user is not authenticated\n  if (requireAuth && !isAuthenticated) {\n    return <Navigate to={fallbackPath} state={{ from: location }} replace />;\n  }\n\n  // Check role requirements\n  if (roles.length > 0 && user) {\n    const hasRequiredRole = roles.some(role => hasRole(role));\n    if (!hasRequiredRole) {\n      return <Navigate to=\"/unauthorized\" replace />;\n    }\n  }\n\n  // Check permission requirements\n  if (permissions.length > 0 && user) {\n    const hasRequiredPermission = permissions.some(permission => hasPermission(permission));\n    if (!hasRequiredPermission) {\n      return <Navigate to=\"/unauthorized\" replace />;\n    }\n  }\n\n  return <>{children}</>;\n};\n\n// HOC for route protection\nexport function withRouteGuard<P extends object>(\n  Component: React.ComponentType<P>,\n  guardProps?: Omit<RouteGuardProps, 'children'>\n) {\n  const WrappedComponent = (props: P) => (\n    <RouteGuard {...guardProps}>\n      <Component {...props} />\n    </RouteGuard>\n  );\n\n  WrappedComponent.displayName = `withRouteGuard(${Component.displayName || Component.name})`;\n  \n  return WrappedComponent;\n}\n\n// Specific guards for common use cases\nexport const AdminRouteGuard: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n  <RouteGuard roles={['admin', 'super_admin']}>\n    {children}\n  </RouteGuard>\n);\n\nexport const SuperAdminRouteGuard: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n  <RouteGuard roles={['super_admin']}>\n    {children}\n  </RouteGuard>\n);\n\nexport const ManagerRouteGuard: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n  <RouteGuard roles={['manager', 'admin', 'super_admin']}>\n    {children}\n  </RouteGuard>\n);\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\shared\\components\\DataTable.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6430,6433],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6430,6433],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\shared\\hooks\\useDataTable.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'data' logical expression could make the dependencies of useCallback Hook (at line 122) change on every render. To fix this, wrap the initialization of 'data' in its own useMemo() Hook.","line":79,"column":9,"nodeType":"VariableDeclarator","endLine":79,"endColumn":36},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'data' logical expression could make the dependencies of useMemo Hook (at line 163) change on every render. To fix this, wrap the initialization of 'data' in its own useMemo() Hook.","line":79,"column":9,"nodeType":"VariableDeclarator","endLine":79,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Data Table Hook\r\n * Provides state management and functionality for data tables\r\n */\r\n\r\nimport { useState, useMemo, useCallback } from 'react';\r\nimport { useQuery } from '@/modules/core/hooks/useQuery';\r\nimport { FilterOptions, PaginatedResponse } from '@/modules/core/types';\r\n\r\nexport interface UseDataTableOptions<T> {\r\n  queryKey: string[];\r\n  queryFn: (params: FilterOptions) => Promise<PaginatedResponse<T>>;\r\n  initialPageSize?: number;\r\n  initialSortBy?: string;\r\n  initialSortOrder?: 'asc' | 'desc';\r\n  initialFilters?: Record<string, unknown>;\r\n  enableSelection?: boolean;\r\n  enableSearch?: boolean;\r\n  searchDebounceMs?: number;\r\n}\r\n\r\nexport function useDataTable<T extends Record<string, unknown>>({\r\n  queryKey,\r\n  queryFn,\r\n  initialPageSize = 20,\r\n  initialSortBy,\r\n  initialSortOrder = 'asc',\r\n  initialFilters = {},\r\n  enableSelection = false,\r\n  enableSearch = true,\r\n  searchDebounceMs = 300,\r\n}: UseDataTableOptions<T>) {\r\n  // State\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(initialPageSize);\r\n  const [sortBy, setSortBy] = useState(initialSortBy);\r\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>(initialSortOrder);\r\n  const [filters, setFilters] = useState(initialFilters);\r\n  const [search, setSearch] = useState('');\r\n  const [selectedRowKeys, setSelectedRowKeys] = useState<string[]>([]);\r\n  const [selectedRows, setSelectedRows] = useState<T[]>([]);\r\n\r\n  // Debounced search\r\n  const [debouncedSearch, setDebouncedSearch] = useState(search);\r\n  \r\n  React.useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedSearch(search);\r\n    }, searchDebounceMs);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [search, searchDebounceMs]);\r\n\r\n  // Query parameters\r\n  const queryParams = useMemo(() => ({\r\n    page,\r\n    pageSize,\r\n    sortBy,\r\n    sortOrder,\r\n    search: enableSearch ? debouncedSearch : undefined,\r\n    filters,\r\n  }), [page, pageSize, sortBy, sortOrder, debouncedSearch, filters, enableSearch]);\r\n\r\n  // Data query\r\n  const {\r\n    data: response,\r\n    isLoading,\r\n    error,\r\n    refetch,\r\n  } = useQuery(\r\n    [...queryKey, queryParams],\r\n    () => queryFn(queryParams),\r\n    {\r\n      keepPreviousData: true,\r\n      staleTime: 5 * 60 * 1000, // 5 minutes\r\n    }\r\n  );\r\n\r\n  const data = response?.data || [];\r\n  const total = response?.total || 0;\r\n  const totalPages = response?.totalPages || 0;\r\n\r\n  // Handlers\r\n  const handlePageChange = useCallback((newPage: number, newPageSize: number) => {\r\n    setPage(newPage);\r\n    if (newPageSize !== pageSize) {\r\n      setPageSize(newPageSize);\r\n      setPage(1); // Reset to first page when page size changes\r\n    }\r\n  }, [pageSize]);\r\n\r\n  const handleSortChange = useCallback((newSortBy: string, newSortOrder: 'asc' | 'desc') => {\r\n    setSortBy(newSortBy);\r\n    setSortOrder(newSortOrder);\r\n    setPage(1); // Reset to first page when sorting changes\r\n  }, []);\r\n\r\n  const handleFilterChange = useCallback((newFilters: Record<string, unknown>) => {\r\n    setFilters(newFilters);\r\n    setPage(1); // Reset to first page when filters change\r\n  }, []);\r\n\r\n  const handleSearchChange = useCallback((newSearch: string) => {\r\n    setSearch(newSearch);\r\n    setPage(1); // Reset to first page when search changes\r\n  }, []);\r\n\r\n  const handleSelectionChange = useCallback((newSelectedRowKeys: string[], newSelectedRows: T[]) => {\r\n    setSelectedRowKeys(newSelectedRowKeys);\r\n    setSelectedRows(newSelectedRows);\r\n  }, []);\r\n\r\n  const clearSelection = useCallback(() => {\r\n    setSelectedRowKeys([]);\r\n    setSelectedRows([]);\r\n  }, []);\r\n\r\n  const selectAll = useCallback(() => {\r\n    const allKeys = data.map((item, index) => item.id || index.toString());\r\n    setSelectedRowKeys(allKeys);\r\n    setSelectedRows(data);\r\n  }, [data]);\r\n\r\n  const resetFilters = useCallback(() => {\r\n    setFilters(initialFilters);\r\n    setSearch('');\r\n    setSortBy(initialSortBy);\r\n    setSortOrder(initialSortOrder);\r\n    setPage(1);\r\n  }, [initialFilters, initialSortBy, initialSortOrder]);\r\n\r\n  const refresh = useCallback(() => {\r\n    refetch();\r\n  }, [refetch]);\r\n\r\n  // Table configuration\r\n  const tableProps = useMemo(() => ({\r\n    data,\r\n    loading: isLoading,\r\n    pagination: {\r\n      current: page,\r\n      pageSize,\r\n      total,\r\n      onChange: handlePageChange,\r\n    },\r\n    sorting: sortBy ? {\r\n      sortBy,\r\n      sortOrder,\r\n      onChange: handleSortChange,\r\n    } : undefined,\r\n    filtering: {\r\n      filters,\r\n      onChange: handleFilterChange,\r\n    },\r\n    search: enableSearch ? {\r\n      value: search,\r\n      onChange: handleSearchChange,\r\n    } : undefined,\r\n    selection: enableSelection ? {\r\n      selectedRowKeys,\r\n      onChange: handleSelectionChange,\r\n    } : undefined,\r\n  }), [\r\n    data,\r\n    isLoading,\r\n    page,\r\n    pageSize,\r\n    total,\r\n    sortBy,\r\n    sortOrder,\r\n    filters,\r\n    search,\r\n    selectedRowKeys,\r\n    enableSearch,\r\n    enableSelection,\r\n    handlePageChange,\r\n    handleSortChange,\r\n    handleFilterChange,\r\n    handleSearchChange,\r\n    handleSelectionChange,\r\n  ]);\r\n\r\n  return {\r\n    // Data\r\n    data,\r\n    total,\r\n    totalPages,\r\n    isLoading,\r\n    error,\r\n\r\n    // State\r\n    page,\r\n    pageSize,\r\n    sortBy,\r\n    sortOrder,\r\n    filters,\r\n    search,\r\n    selectedRowKeys,\r\n    selectedRows,\r\n\r\n    // Handlers\r\n    setPage,\r\n    setPageSize,\r\n    setSortBy,\r\n    setSortOrder,\r\n    setFilters,\r\n    setSearch,\r\n    handlePageChange,\r\n    handleSortChange,\r\n    handleFilterChange,\r\n    handleSearchChange,\r\n    handleSelectionChange,\r\n\r\n    // Actions\r\n    clearSelection,\r\n    selectAll,\r\n    resetFilters,\r\n    refresh,\r\n\r\n    // Table props\r\n    tableProps,\r\n  };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\modules\\test-modular.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'runTests'. Either include it or remove the dependency array.","line":72,"column":6,"nodeType":"ArrayExpression","endLine":72,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [runTests]","fix":{"range":[2507,2509],"text":"[runTests]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Modular Architecture Test\n * Simple test to validate the new modular architecture\n */\n\nimport React from 'react';\nimport { moduleRegistry } from './ModuleRegistry';\nimport { serviceContainer } from './core/services/ServiceContainer';\nimport { useStore } from './core/store';\n\nconst ModularArchitectureTest: React.FC = () => {\n  const [testResults, setTestResults] = React.useState<string[]>([]);\n  const { user, isAuthenticated } = useStore();\n\n  const runTests = async () => {\n    const results: string[] = [];\n\n    try {\n      // Test 1: Module Registry\n      const modules = moduleRegistry.getModuleNames();\n      results.push(`‚úÖ Module Registry: ${modules.length} modules registered (${modules.join(', ')})`);\n\n      // Test 2: Service Container\n      const services = serviceContainer.getRegisteredServices();\n      results.push(`‚úÖ Service Container: ${services.length} services registered (${services.join(', ')})`);\n\n      // Test 3: Store\n      results.push(`‚úÖ Store: ${isAuthenticated ? 'User authenticated' : 'User not authenticated'}`);\n\n      // Test 4: Module Initialization\n      const initializedModules = moduleRegistry.getInitializedModules();\n      results.push(`‚úÖ Initialized Modules: ${initializedModules.length} modules (${initializedModules.join(', ')})`);\n\n      // Test 5: Customer Module\n      if (moduleRegistry.has('customers')) {\n        results.push('‚úÖ Customer Module: Available');\n        \n        if (serviceContainer.has('customerService')) {\n          results.push('‚úÖ Customer Service: Registered');\n        } else {\n          results.push('‚ùå Customer Service: Not registered');\n        }\n      } else {\n        results.push('‚ùå Customer Module: Not available');\n      }\n\n      // Test 6: Sales Module\n      if (moduleRegistry.has('sales')) {\n        results.push('‚úÖ Sales Module: Available');\n        \n        if (serviceContainer.has('salesService')) {\n          results.push('‚úÖ Sales Service: Registered');\n        } else {\n          results.push('‚ùå Sales Service: Not registered');\n        }\n      } else {\n        results.push('‚ùå Sales Module: Not available');\n      }\n\n      results.push('üéâ All tests completed!');\n    } catch (error) {\n      results.push(`‚ùå Test failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n\n    setTestResults(results);\n  };\n\n  React.useEffect(() => {\n    // Run tests after a short delay to allow modules to initialize\n    const timer = setTimeout(runTests, 1000);\n    return () => clearTimeout(timer);\n  }, []);\n\n  return (\n    <div className=\"p-8 max-w-4xl mx-auto\">\n      <h1 className=\"text-3xl font-bold mb-6\">Modular Architecture Test</h1>\n      \n      <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">Test Results</h2>\n        \n        {testResults.length === 0 ? (\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\"></div>\n            <span>Running tests...</span>\n          </div>\n        ) : (\n          <div className=\"space-y-2\">\n            {testResults.map((result, index) => (\n              <div\n                key={index}\n                className={`p-2 rounded ${\n                  result.startsWith('‚úÖ') \n                    ? 'bg-green-50 text-green-800' \n                    : result.startsWith('‚ùå')\n                    ? 'bg-red-50 text-red-800'\n                    : result.startsWith('üéâ')\n                    ? 'bg-blue-50 text-blue-800'\n                    : 'bg-gray-50 text-gray-800'\n                }`}\n              >\n                {result}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">Architecture Overview</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <h3 className=\"font-medium mb-2\">Registered Modules</h3>\n            <ul className=\"text-sm text-gray-600 space-y-1\">\n              {moduleRegistry.getModuleNames().map(name => (\n                <li key={name} className=\"flex items-center space-x-2\">\n                  <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\n                  <span>{name}</span>\n                </li>\n              ))}\n            </ul>\n          </div>\n          \n          <div>\n            <h3 className=\"font-medium mb-2\">Registered Services</h3>\n            <ul className=\"text-sm text-gray-600 space-y-1\">\n              {serviceContainer.getRegisteredServices().map(name => (\n                <li key={name} className=\"flex items-center space-x-2\">\n                  <span className=\"w-2 h-2 bg-blue-500 rounded-full\"></span>\n                  <span>{name}</span>\n                </li>\n              ))}\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow-md p-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">Actions</h2>\n        <div className=\"space-x-4\">\n          <button\n            onClick={runTests}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n          >\n            Re-run Tests\n          </button>\n          \n          <button\n            onClick={() => {\n              console.log('Module Registry:', moduleRegistry);\n              console.log('Service Container:', serviceContainer);\n              console.log('Store State:', useStore.getState());\n            }}\n            className=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700\"\n          >\n            Log to Console\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ModularArchitectureTest;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\polyfills.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\providers\\SessionProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\__tests__\\salesService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[599,602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[599,602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[793,796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[793,796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1132,1135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1132,1135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1360,1363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1360,1363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1766,1769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1766,1769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2046,2049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2046,2049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2380,2383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2380,2383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2649,2652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2649,2652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2942,2945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2942,2945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3227,3230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3227,3230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3518,3521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3518,3521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3656,3659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3656,3659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3914,3917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3914,3917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4052,4055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4052,4055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4261,4264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4261,4264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4643,4646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4643,4646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5152,5155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5152,5155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5690,5693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5690,5693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6250,6253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6250,6253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6364,6367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6364,6367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6742,6745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6742,6745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7038,7041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7038,7041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7135,7138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7135,7138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7477,7480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7477,7480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7849,7852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7849,7852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8128,8131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8128,8131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8464,8467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8464,8467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":269,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8719,8722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8719,8722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8837,8840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8837,8840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9020,9023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9020,9023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9322,9325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9322,9325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":304,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9734,9737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9734,9737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10035,10038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10035,10038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":325,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10363,10366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10363,10366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10650,10653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10650,10653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":348,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11053,11056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11053,11056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":362,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11451,11454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11451,11454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11868,11871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11868,11871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":38,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach } from 'vitest';\r\nimport { mockSalesService } from '@/services/salesService';\r\n\r\n/**\r\n * Mock Sales Service Unit Tests\r\n * Tests all 14 backend methods for correct functionality and data consistency\r\n */\r\n\r\ndescribe('Mock Sales Service', () => {\r\n  const mockCustomerId = 'customer_1';\r\n  const mockTenantId = 'tenant_1';\r\n\r\n  beforeEach(() => {\r\n    process.env.VITE_API_MODE = 'mock';\r\n  });\r\n\r\n  // Core CRUD Methods\r\n\r\n  describe('getSales', () => {\r\n    it('should return array of sales', async () => {\r\n      const result = await (mockSalesService as any).getSales();\r\n      expect(Array.isArray(result)).toBe(true);\r\n    });\r\n\r\n    it('should return objects with required fields', async () => {\r\n      const result = await (mockSalesService as any).getSales();\r\n      if (result.length > 0) {\r\n        const sale = result[0];\r\n        expect(sale).toHaveProperty('id');\r\n        expect(sale).toHaveProperty('title');\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('getSale', () => {\r\n    it('should return a single sale by id', async () => {\r\n      const result = await (mockSalesService as any).getSale('sale_1');\r\n      expect(result).toBeDefined();\r\n      expect(result.id).toBe('sale_1');\r\n    });\r\n\r\n    it('should return null for non-existent sale', async () => {\r\n      const result = await (mockSalesService as any).getSale('non_existent');\r\n      expect(result === null || result === undefined).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('createSale', () => {\r\n    it('should create a new sale', async () => {\r\n      const newSale = {\r\n        title: 'New Deal',\r\n        customerId: mockCustomerId,\r\n        value: 50000,\r\n        tenantId: mockTenantId,\r\n      };\r\n\r\n      const result = await (mockSalesService as any).createSale(newSale);\r\n      expect(result).toBeDefined();\r\n      expect(result.id).toBeDefined();\r\n      expect(result.title).toBe('New Deal');\r\n    });\r\n\r\n    it('should return object with createdAt timestamp', async () => {\r\n      const result = await (mockSalesService as any).createSale({\r\n        title: 'Test Deal',\r\n        customerId: mockCustomerId,\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(result.createdAt).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('updateSale', () => {\r\n    it('should update an existing sale', async () => {\r\n      const result = await (mockSalesService as any).updateSale('sale_1', {\r\n        status: 'closed',\r\n      });\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.status).toBe('closed');\r\n    });\r\n\r\n    it('should preserve unmodified fields', async () => {\r\n      const result = await (mockSalesService as any).updateSale('sale_1', {\r\n        value: 75000,\r\n      });\r\n\r\n      expect(result.id).toBe('sale_1');\r\n      expect(result.value).toBe(75000);\r\n    });\r\n  });\r\n\r\n  describe('deleteSale', () => {\r\n    it('should delete a sale', async () => {\r\n      const result = await (mockSalesService as any).deleteSale('sale_1');\r\n      expect(result.success).toBe(true);\r\n    });\r\n  });\r\n\r\n  // Advanced Methods - Multi-Tenant\r\n\r\n  describe('getDealsByCustomer', () => {\r\n    it('should return deals for specific customer', async () => {\r\n      const result = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId: mockCustomerId,\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(Array.isArray(result)).toBe(true);\r\n    });\r\n\r\n    it('should only return deals for specified customer', async () => {\r\n      const result = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId: mockCustomerId,\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      result.forEach((deal: any) => {\r\n        expect(deal.customerId).toBe(mockCustomerId);\r\n        expect(deal.tenantId).toBe(mockTenantId);\r\n      });\r\n    });\r\n\r\n    it('should only return deals for specified tenant', async () => {\r\n      const result = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId: mockCustomerId,\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      result.forEach((deal: any) => {\r\n        expect(deal.tenantId).toBe(mockTenantId);\r\n      });\r\n    });\r\n\r\n    it('should return empty array for non-existent customer', async () => {\r\n      const result = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId: 'non_existent_customer',\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(Array.isArray(result)).toBe(true);\r\n      expect(result.length).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('getSalesStats', () => {\r\n    it('should return object with required stats fields', async () => {\r\n      const result = await (mockSalesService as any).getSalesStats({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(result).toHaveProperty('totalDeals');\r\n      expect(result).toHaveProperty('closedDeals');\r\n      expect(result).toHaveProperty('totalRevenue');\r\n      expect(result).toHaveProperty('averageDealValue');\r\n      expect(result).toHaveProperty('conversionRate');\r\n      expect(result).toHaveProperty('pipelineValue');\r\n    });\r\n\r\n    it('should return numeric values', async () => {\r\n      const result = await (mockSalesService as any).getSalesStats({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(typeof result.totalDeals).toBe('number');\r\n      expect(typeof result.closedDeals).toBe('number');\r\n      expect(typeof result.totalRevenue).toBe('number');\r\n      expect(typeof result.averageDealValue).toBe('number');\r\n      expect(typeof result.conversionRate).toBe('number');\r\n      expect(typeof result.pipelineValue).toBe('number');\r\n    });\r\n\r\n    it('should return non-negative values', async () => {\r\n      const result = await (mockSalesService as any).getSalesStats({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(result.totalDeals).toBeGreaterThanOrEqual(0);\r\n      expect(result.closedDeals).toBeGreaterThanOrEqual(0);\r\n      expect(result.totalRevenue).toBeGreaterThanOrEqual(0);\r\n      expect(result.averageDealValue).toBeGreaterThanOrEqual(0);\r\n      expect(result.conversionRate).toBeGreaterThanOrEqual(0);\r\n      expect(result.pipelineValue).toBeGreaterThanOrEqual(0);\r\n    });\r\n\r\n    it('should respect tenant_id filter', async () => {\r\n      const stats1 = await (mockSalesService as any).getSalesStats({\r\n        tenantId: 'tenant_1',\r\n      });\r\n\r\n      const stats2 = await (mockSalesService as any).getSalesStats({\r\n        tenantId: 'tenant_2',\r\n      });\r\n\r\n      // Both should be valid stats objects\r\n      expect(stats1).toHaveProperty('totalDeals');\r\n      expect(stats2).toHaveProperty('totalDeals');\r\n    });\r\n  });\r\n\r\n  describe('getDealStages', () => {\r\n    it('should return array of deal stages', async () => {\r\n      const result = await (mockSalesService as any).getDealStages({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(Array.isArray(result)).toBe(true);\r\n      expect(result.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should return stages with required properties', async () => {\r\n      const result = await (mockSalesService as any).getDealStages({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      result.forEach((stage: any) => {\r\n        expect(stage).toHaveProperty('id');\r\n        expect(stage).toHaveProperty('name');\r\n        expect(stage).toHaveProperty('color');\r\n        expect(stage).toHaveProperty('probability');\r\n      });\r\n    });\r\n\r\n    it('should return stages in probability order', async () => {\r\n      const result = await (mockSalesService as any).getDealStages({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      for (let i = 0; i < result.length - 1; i++) {\r\n        expect(result[i].probability).toBeLessThanOrEqual(result[i + 1].probability);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('updateDealStage', () => {\r\n    it('should update deal stage', async () => {\r\n      const result = await (mockSalesService as any).updateDealStage({\r\n        dealId: 'deal_1',\r\n        stageId: 'stage_2',\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('should return updated deal', async () => {\r\n      const result = await (mockSalesService as any).updateDealStage({\r\n        dealId: 'deal_1',\r\n        stageId: 'stage_3',\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(result).toHaveProperty('deal');\r\n    });\r\n  });\r\n\r\n  describe('searchDeals', () => {\r\n    it('should return array of search results', async () => {\r\n      const result = await (mockSalesService as any).searchDeals({\r\n        tenantId: mockTenantId,\r\n        query: 'test',\r\n      });\r\n\r\n      expect(Array.isArray(result)).toBe(true);\r\n    });\r\n\r\n    it('should respect tenant_id filter', async () => {\r\n      const result = await (mockSalesService as any).searchDeals({\r\n        tenantId: mockTenantId,\r\n        query: 'deal',\r\n      });\r\n\r\n      result.forEach((deal: any) => {\r\n        expect(deal.tenantId).toBe(mockTenantId);\r\n      });\r\n    });\r\n\r\n    it('should handle empty query', async () => {\r\n      const result = await (mockSalesService as any).searchDeals({\r\n        tenantId: mockTenantId,\r\n        query: '',\r\n      });\r\n\r\n      expect(Array.isArray(result)).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('bulkUpdateDeals', () => {\r\n    it('should return success/failure counts', async () => {\r\n      const result = await (mockSalesService as any).bulkUpdateDeals({\r\n        tenantId: mockTenantId,\r\n        deals: [\r\n          { id: 'deal_1', status: 'closed' },\r\n          { id: 'deal_2', status: 'closed' },\r\n        ],\r\n      });\r\n\r\n      expect(result).toHaveProperty('successCount');\r\n      expect(result).toHaveProperty('failureCount');\r\n    });\r\n\r\n    it('should handle empty array', async () => {\r\n      const result = await (mockSalesService as any).bulkUpdateDeals({\r\n        tenantId: mockTenantId,\r\n        deals: [],\r\n      });\r\n\r\n      expect(result.successCount).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('bulkDeleteDeals', () => {\r\n    it('should return success/failure counts', async () => {\r\n      const result = await (mockSalesService as any).bulkDeleteDeals({\r\n        tenantId: mockTenantId,\r\n        dealIds: ['deal_1', 'deal_2'],\r\n      });\r\n\r\n      expect(result).toHaveProperty('successCount');\r\n      expect(result).toHaveProperty('failureCount');\r\n    });\r\n\r\n    it('should handle empty array', async () => {\r\n      const result = await (mockSalesService as any).bulkDeleteDeals({\r\n        tenantId: mockTenantId,\r\n        dealIds: [],\r\n      });\r\n\r\n      expect(result.successCount).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('exportDeals', () => {\r\n    it('should return CSV string', async () => {\r\n      const result = await (mockSalesService as any).exportDeals({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      expect(typeof result).toBe('string');\r\n      expect(result.includes('id') || result.includes('title')).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('importDeals', () => {\r\n    it('should return import result with counts', async () => {\r\n      const csv = 'id,title\\ndeal_1,Test Deal';\r\n      const result = await (mockSalesService as any).importDeals({\r\n        tenantId: mockTenantId,\r\n        csvData: csv,\r\n      });\r\n\r\n      expect(result).toHaveProperty('importedCount');\r\n      expect(result).toHaveProperty('failedCount');\r\n    });\r\n  });\r\n\r\n  // DTO Consistency Tests\r\n\r\n  describe('DTO Consistency', () => {\r\n    it('should use camelCase field names in stats', async () => {\r\n      const stats = await (mockSalesService as any).getSalesStats({\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      const keys = Object.keys(stats);\r\n      keys.forEach((key) => {\r\n        expect(key).toMatch(/^[a-z]/); // Should start with lowercase\r\n        expect(key).not.toContain('_'); // Should not have snake_case\r\n      });\r\n    });\r\n\r\n    it('should use camelCase field names in deals', async () => {\r\n      const deals = await (mockSalesService as any).getDealsByCustomer({\r\n        customerId: mockCustomerId,\r\n        tenantId: mockTenantId,\r\n      });\r\n\r\n      if (deals.length > 0) {\r\n        const deal = deals[0];\r\n        Object.keys(deal).forEach((key) => {\r\n          // Deal fields should use camelCase\r\n          if (!key.includes('_')) {\r\n            expect(key).toMatch(/^[a-zA-Z]/);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\__tests__\\salesServiceFactory.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[819,822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[819,822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1303,1306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1303,1306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1517,1520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1517,1520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1725,1728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1725,1728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1999,2002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1999,2002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2399,2402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2399,2402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3248,3251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3248,3251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3541,3544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3541,3544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3901,3904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3901,3904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4088,4091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4088,4091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4366,4369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4366,4369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach } from 'vitest';\r\nimport { salesService } from '@/services/serviceFactory';\r\n\r\n/**\r\n * Sales Service Factory Tests\r\n * Validates that the factory pattern correctly routes between mock and Supabase implementations\r\n */\r\n\r\ndescribe('Sales Service Factory', () => {\r\n  beforeEach(() => {\r\n    process.env.VITE_API_MODE = 'mock';\r\n  });\r\n\r\n  describe('Service Availability', () => {\r\n    it('should provide a sales service instance', () => {\r\n      expect(salesService).toBeDefined();\r\n      expect(typeof salesService).toBe('object');\r\n    });\r\n\r\n    it('should have all required core methods', () => {\r\n      const coreMethods = ['getSales', 'getSale', 'createSale', 'updateSale', 'deleteSale'];\r\n\r\n      coreMethods.forEach((method) => {\r\n        expect(typeof (salesService as any)[method]).toBe('function');\r\n      });\r\n    });\r\n\r\n    it('should have all required advanced methods', () => {\r\n      const advancedMethods = [\r\n        'getDealsByCustomer',\r\n        'getSalesStats',\r\n        'getDealStages',\r\n        'updateDealStage',\r\n        'bulkUpdateDeals',\r\n        'bulkDeleteDeals',\r\n        'searchDeals',\r\n        'exportDeals',\r\n        'importDeals',\r\n      ];\r\n\r\n      advancedMethods.forEach((method) => {\r\n        expect(typeof (salesService as any)[method]).toBe('function');\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Method Signatures', () => {\r\n    it('should support getSales with no parameters', async () => {\r\n      const sales = await (salesService as any).getSales();\r\n      expect(Array.isArray(sales)).toBe(true);\r\n    });\r\n\r\n    it('should support getDealsByCustomer with customerId and tenantId', async () => {\r\n      const deals = await (salesService as any).getDealsByCustomer({\r\n        customerId: 'customer_1',\r\n        tenantId: 'tenant_1',\r\n      });\r\n      expect(Array.isArray(deals)).toBe(true);\r\n    });\r\n\r\n    it('should support getSalesStats with tenantId', async () => {\r\n      const stats = await (salesService as any).getSalesStats({\r\n        tenantId: 'tenant_1',\r\n      });\r\n      expect(stats).toHaveProperty('totalDeals');\r\n      expect(stats).toHaveProperty('closedDeals');\r\n      expect(stats).toHaveProperty('totalRevenue');\r\n      expect(stats).toHaveProperty('averageDealValue');\r\n    });\r\n\r\n    it('should support getDealStages with tenantId', async () => {\r\n      const stages = await (salesService as any).getDealStages({\r\n        tenantId: 'tenant_1',\r\n      });\r\n      expect(Array.isArray(stages)).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('API Mode Routing', () => {\r\n    it('should use mock service when VITE_API_MODE is \"mock\"', () => {\r\n      process.env.VITE_API_MODE = 'mock';\r\n      expect(salesService).toBeDefined();\r\n    });\r\n\r\n    it('should use supabase service when VITE_API_MODE is \"supabase\"', () => {\r\n      process.env.VITE_API_MODE = 'supabase';\r\n      expect(salesService).toBeDefined();\r\n    });\r\n\r\n    it('should default to mock service for unknown mode', () => {\r\n      process.env.VITE_API_MODE = 'unknown_mode';\r\n      expect(salesService).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('Error Handling', () => {\r\n    it('should handle missing tenantId gracefully', async () => {\r\n      try {\r\n        await (salesService as any).getDealsByCustomer({\r\n          customerId: 'customer_1',\r\n          // tenantId missing\r\n        });\r\n      } catch (error) {\r\n        expect(error).toBeDefined();\r\n      }\r\n    });\r\n\r\n    it('should handle invalid parameters', async () => {\r\n      try {\r\n        await (salesService as any).getDealsByCustomer({\r\n          customerId: null,\r\n          tenantId: 'tenant_1',\r\n        });\r\n      } catch (error) {\r\n        // Error expected\r\n        expect(error).toBeDefined();\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Response Types', () => {\r\n    it('should return array from getSales', async () => {\r\n      const result = await (salesService as any).getSales();\r\n      expect(Array.isArray(result)).toBe(true);\r\n    });\r\n\r\n    it('should return object from getSalesStats', async () => {\r\n      const result = await (salesService as any).getSalesStats({\r\n        tenantId: 'tenant_1',\r\n      });\r\n      expect(typeof result).toBe('object');\r\n      expect(!Array.isArray(result)).toBe(true);\r\n    });\r\n\r\n    it('should return array from getDealStages', async () => {\r\n      const result = await (salesService as any).getDealStages({\r\n        tenantId: 'tenant_1',\r\n      });\r\n      expect(Array.isArray(result)).toBe(true);\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\api\\apiServiceFactory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\api\\baseApiService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\api\\interfaces\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\api\\supabase\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\api\\supabase\\rbacService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":451,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":451,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12384,12387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12384,12387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase RBAC (Role-Based Access Control) Service\r\n * Handles role and permission management via Supabase PostgreSQL\r\n */\r\n\r\nimport { supabase } from '@/services/database';\r\nimport { Permission, Role, UserRole, AuditLog, RoleTemplate, PermissionMatrix } from '@/types/rbac';\r\nimport { User } from '@/types/auth';\r\nimport { authService } from '@/services/authService';\r\n\r\nclass SupabaseRBACService {\r\n  private permissionsTable = 'permissions';\r\n  private rolesTable = 'roles';\r\n  private userRolesTable = 'user_roles';\r\n  private roleTemplatesTable = 'role_templates';\r\n  private auditLogsTable = 'audit_logs';\r\n\r\n  /**\r\n   * Get all permissions\r\n   */\r\n  async getPermissions(): Promise<Permission[]> {\r\n    const { data, error } = await supabase\r\n      .from(this.permissionsTable)\r\n      .select('*')\r\n      .order('category', { ascending: true })\r\n      .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching permissions:', error);\r\n      // Return default permissions as fallback\r\n      return this.getDefaultPermissions();\r\n    }\r\n\r\n    return data || [];\r\n  }\r\n\r\n  /**\r\n   * Get all roles, optionally filtered by tenant\r\n   */\r\n  async getRoles(tenantId?: string): Promise<Role[]> {\r\n    const currentUser = authService.getCurrentUser();\r\n    if (!currentUser) return [];\r\n\r\n    let query = supabase\r\n      .from(this.rolesTable)\r\n      .select('*')\r\n      .order('name', { ascending: true });\r\n\r\n    // If user is super_admin, allow fetching any tenant's roles\r\n    // Otherwise, only return roles for their tenant\r\n    // Note: User object uses camelCase (tenantId), not snake_case (tenant_id)\r\n    const userTenantId = tenantId || currentUser.tenantId;\r\n    \r\n    if (currentUser.role !== 'super_admin' && userTenantId) {\r\n      console.log('[RBAC] Filtering roles by tenant_id:', userTenantId);\r\n      query = query.eq('tenant_id', userTenantId);\r\n    } else if (currentUser.role === 'super_admin') {\r\n      console.log('[RBAC] Super admin - fetching all roles');\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error('[RBAC] Error fetching roles:', error);\r\n      return [];\r\n    }\r\n\r\n    console.log('[RBAC] Roles fetched:', data?.length || 0);\r\n    return data || [];\r\n  }\r\n\r\n  /**\r\n   * Create a new role\r\n   */\r\n  async createRole(roleData: Omit<Role, 'id' | 'created_at' | 'updated_at'>): Promise<Role> {\r\n    const newRole = {\r\n      ...roleData,\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    const { data, error } = await supabase\r\n      .from(this.rolesTable)\r\n      .insert(newRole)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('Error creating role:', error);\r\n      throw new Error(`Failed to create role: ${error.message}`);\r\n    }\r\n\r\n    // Log the action\r\n    await this.logAction('role_created', 'role', data.id, { role_name: data.name });\r\n\r\n    return data as Role;\r\n  }\r\n\r\n  /**\r\n   * Update a role\r\n   */\r\n  async updateRole(roleId: string, updates: Partial<Role>): Promise<Role> {\r\n    const updateData = {\r\n      ...updates,\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    const { data, error } = await supabase\r\n      .from(this.rolesTable)\r\n      .update(updateData)\r\n      .eq('id', roleId)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('Error updating role:', error);\r\n      throw new Error(`Failed to update role: ${error.message}`);\r\n    }\r\n\r\n    if (!data) {\r\n      throw new Error('Role not found');\r\n    }\r\n\r\n    // Log the action\r\n    await this.logAction('role_updated', 'role', roleId, updates);\r\n\r\n    return data as Role;\r\n  }\r\n\r\n  /**\r\n   * Delete a role\r\n   */\r\n  async deleteRole(roleId: string): Promise<void> {\r\n    // Check if it's a system role\r\n    const { data: role, error: fetchError } = await supabase\r\n      .from(this.rolesTable)\r\n      .select('is_system_role, name')\r\n      .eq('id', roleId)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      throw new Error('Role not found');\r\n    }\r\n\r\n    if (role.is_system_role) {\r\n      throw new Error('Cannot delete system role');\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from(this.rolesTable)\r\n      .delete()\r\n      .eq('id', roleId);\r\n\r\n    if (error) {\r\n      console.error('Error deleting role:', error);\r\n      throw new Error(`Failed to delete role: ${error.message}`);\r\n    }\r\n\r\n    // Log the action\r\n    await this.logAction('role_deleted', 'role', roleId, { role_name: role.name });\r\n  }\r\n\r\n  /**\r\n   * Assign a role to a user\r\n   */\r\n  async assignUserRole(userId: string, roleId: string): Promise<void> {\r\n    // Check if assignment already exists\r\n    const { data: existing } = await supabase\r\n      .from(this.userRolesTable)\r\n      .select('id')\r\n      .eq('user_id', userId)\r\n      .eq('role_id', roleId)\r\n      .single();\r\n\r\n    if (existing) {\r\n      return; // Already assigned\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from(this.userRolesTable)\r\n      .insert({\r\n        user_id: userId,\r\n        role_id: roleId,\r\n        assigned_at: new Date().toISOString(),\r\n      });\r\n\r\n    if (error) {\r\n      console.error('Error assigning role:', error);\r\n      throw new Error(`Failed to assign role: ${error.message}`);\r\n    }\r\n\r\n    // Log the action\r\n    await this.logAction('role_assigned', 'user', userId, { role_id: roleId });\r\n  }\r\n\r\n  /**\r\n   * Remove a role from a user\r\n   */\r\n  async removeUserRole(userId: string, roleId: string): Promise<void> {\r\n    const { error } = await supabase\r\n      .from(this.userRolesTable)\r\n      .delete()\r\n      .eq('user_id', userId)\r\n      .eq('role_id', roleId);\r\n\r\n    if (error) {\r\n      console.error('Error removing role:', error);\r\n      throw new Error(`Failed to remove role: ${error.message}`);\r\n    }\r\n\r\n    // Log the action\r\n    await this.logAction('role_removed', 'user', userId, { role_id: roleId });\r\n  }\r\n\r\n  /**\r\n   * Get permission matrix (roles vs permissions)\r\n   */\r\n  async getPermissionMatrix(tenantId?: string): Promise<PermissionMatrix> {\r\n    const roles = await this.getRoles(tenantId);\r\n    const permissions = await this.getPermissions();\r\n\r\n    const matrix: Record<string, Record<string, boolean>> = {};\r\n\r\n    roles.forEach(role => {\r\n      matrix[role.id] = {};\r\n      permissions.forEach(permission => {\r\n        matrix[role.id][permission.id] = role.permissions.includes(permission.id);\r\n      });\r\n    });\r\n\r\n    return {\r\n      roles,\r\n      permissions,\r\n      matrix\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get role templates\r\n   */\r\n  async getRoleTemplates(): Promise<RoleTemplate[]> {\r\n    const { data, error } = await supabase\r\n      .from(this.roleTemplatesTable)\r\n      .select('*')\r\n      .eq('is_default', true)\r\n      .order('category', { ascending: true })\r\n      .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching role templates:', error);\r\n      return [];\r\n    }\r\n\r\n    return data || [];\r\n  }\r\n\r\n  /**\r\n   * Create a role from template\r\n   */\r\n  async createRoleFromTemplate(templateId: string, roleName: string, tenantId: string): Promise<Role> {\r\n    const { data: template, error: fetchError } = await supabase\r\n      .from(this.roleTemplatesTable)\r\n      .select('*')\r\n      .eq('id', templateId)\r\n      .single();\r\n\r\n    if (fetchError || !template) {\r\n      throw new Error('Template not found');\r\n    }\r\n\r\n    return this.createRole({\r\n      name: roleName,\r\n      description: template.description,\r\n      tenant_id: tenantId,\r\n      permissions: [...template.permissions],\r\n      is_system_role: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get audit logs\r\n   */\r\n  async getAuditLogs(filters?: {\r\n    user_id?: string;\r\n    action?: string;\r\n    resource?: string;\r\n    tenant_id?: string;\r\n    start_date?: string;\r\n    end_date?: string;\r\n  }): Promise<AuditLog[]> {\r\n    let query = supabase\r\n      .from(this.auditLogsTable)\r\n      .select('*')\r\n      .order('timestamp', { ascending: false });\r\n\r\n    if (filters) {\r\n      if (filters.user_id) {\r\n        query = query.eq('user_id', filters.user_id);\r\n      }\r\n      if (filters.action) {\r\n        query = query.eq('action', filters.action);\r\n      }\r\n      if (filters.resource) {\r\n        query = query.eq('resource', filters.resource);\r\n      }\r\n      if (filters.tenant_id) {\r\n        query = query.eq('tenant_id', filters.tenant_id);\r\n      }\r\n      if (filters.start_date) {\r\n        query = query.gte('timestamp', filters.start_date);\r\n      }\r\n      if (filters.end_date) {\r\n        query = query.lte('timestamp', filters.end_date);\r\n      }\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error('Error fetching audit logs:', error);\r\n      return [];\r\n    }\r\n\r\n    return data || [];\r\n  }\r\n\r\n  /**\r\n   * Log an action to audit logs\r\n   */\r\n  async logAction(action: string, resource: string, resourceId?: string, details?: Record<string, unknown>): Promise<void> {\r\n    const currentUser = authService.getCurrentUser();\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      await supabase\r\n        .from(this.auditLogsTable)\r\n        .insert({\r\n          user_id: currentUser.id,\r\n          action,\r\n          resource,\r\n          resource_id: resourceId,\r\n          details: details || {},\r\n          ip_address: this.getClientIp(),\r\n          user_agent: navigator.userAgent,\r\n          tenant_id: currentUser.tenantId,  // Fixed: use camelCase tenantId from User object\r\n          timestamp: new Date().toISOString()\r\n        });\r\n    } catch (err) {\r\n      console.error('[RBAC] Error logging action:', err);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get users with a specific role\r\n   */\r\n  async getUsersByRole(roleId: string): Promise<User[]> {\r\n    const { data: userRoles, error: roleError } = await supabase\r\n      .from(this.userRolesTable)\r\n      .select('user_id')\r\n      .eq('role_id', roleId);\r\n\r\n    if (roleError) {\r\n      console.error('Error fetching user roles:', roleError);\r\n      return [];\r\n    }\r\n\r\n    if (!userRoles || userRoles.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    const userIds = userRoles.map(ur => ur.user_id);\r\n\r\n    const { data: users, error: usersError } = await supabase\r\n      .from('users')\r\n      .select('*')\r\n      .in('id', userIds);\r\n\r\n    if (usersError) {\r\n      console.error('Error fetching users:', usersError);\r\n      return [];\r\n    }\r\n\r\n    return users || [];\r\n  }\r\n\r\n  /**\r\n   * Bulk assign role to multiple users\r\n   */\r\n  async bulkAssignRole(userIds: string[], roleId: string): Promise<void> {\r\n    const assignments = userIds.map(userId => ({\r\n      user_id: userId,\r\n      role_id: roleId,\r\n      assigned_at: new Date().toISOString()\r\n    }));\r\n\r\n    const { error } = await supabase\r\n      .from(this.userRolesTable)\r\n      .insert(assignments);\r\n\r\n    if (error) {\r\n      console.error('Error bulk assigning role:', error);\r\n      throw new Error(`Failed to bulk assign role: ${error.message}`);\r\n    }\r\n\r\n    // Log the action\r\n    await this.logAction('roles_bulk_assigned', 'users', undefined, { \r\n      user_count: userIds.length, \r\n      role_id: roleId \r\n    });\r\n  }\r\n\r\n  /**\r\n   * Bulk remove role from multiple users\r\n   */\r\n  async bulkRemoveRole(userIds: string[], roleId: string): Promise<void> {\r\n    const { error } = await supabase\r\n      .from(this.userRolesTable)\r\n      .delete()\r\n      .eq('role_id', roleId)\r\n      .in('user_id', userIds);\r\n\r\n    if (error) {\r\n      console.error('Error bulk removing role:', error);\r\n      throw new Error(`Failed to bulk remove role: ${error.message}`);\r\n    }\r\n\r\n    // Log the action\r\n    await this.logAction('roles_bulk_removed', 'users', undefined, { \r\n      user_count: userIds.length, \r\n      role_id: roleId \r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get permissions grouped by category\r\n   */\r\n  getPermissionsByCategory(): Record<string, Permission[]> {\r\n    // This is a synchronous method that would need to cache permissions\r\n    // For now, return empty object - should be called after getPermissions()\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Validate role permissions (overloaded method)\r\n   * Accepts either:\r\n   * 1. An action string + optional context (for module-specific RBAC checks)\r\n   * 2. An array of permission IDs (for traditional permission validation)\r\n   */\r\n  async validateRolePermissions(\r\n    actionOrPermissions: string | string[],\r\n    context?: Record<string, any>\r\n  ): Promise<boolean | { valid: boolean; invalid: string[] }> {\r\n    // If second parameter exists or first param looks like an action, treat as action check\r\n    if (context || typeof actionOrPermissions === 'string') {\r\n      // Action-based permission check\r\n      const currentUser = authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('[validateRolePermissions] No user found');\r\n        return false;\r\n      }\r\n      \r\n      const action = actionOrPermissions as string;\r\n      \r\n      // Map action to required permission\r\n      const permissionRequired = this.mapActionToPermission(action);\r\n      \r\n      if (!permissionRequired) {\r\n        console.warn(`[validateRolePermissions] Unable to map action \"${action}\" to permission`);\r\n        return true; // Graceful degradation\r\n      }\r\n      \r\n      try {\r\n        // Get user's roles for their tenant\r\n        const { data: userRoles, error: roleError } = await supabase\r\n          .from('user_roles')\r\n          .select('role_id')\r\n          .eq('user_id', currentUser.id)\r\n          .eq('tenant_id', currentUser.tenant_id);\r\n        \r\n        if (roleError) {\r\n          console.warn('[validateRolePermissions] Error fetching user roles:', roleError);\r\n          return true; // Graceful degradation\r\n        }\r\n        \r\n        if (!userRoles || userRoles.length === 0) {\r\n          console.warn('[validateRolePermissions] User has no roles assigned');\r\n          return false;\r\n        }\r\n        \r\n        // Get the role IDs\r\n        const roleIds = userRoles.map(ur => ur.role_id);\r\n        \r\n        // Fetch roles to get their permissions\r\n        const { data: roles, error: fetchRolesError } = await supabase\r\n          .from('roles')\r\n          .select('id, permissions')\r\n          .in('id', roleIds)\r\n          .eq('tenant_id', currentUser.tenant_id);\r\n        \r\n        if (fetchRolesError) {\r\n          console.warn('[validateRolePermissions] Error fetching roles:', fetchRolesError);\r\n          return true; // Graceful degradation\r\n        }\r\n        \r\n        // Check if any of the user's roles have the required permission\r\n        const hasPermission = roles?.some(role => {\r\n          const permissions = Array.isArray(role.permissions) ? role.permissions : [];\r\n          return permissions.includes(permissionRequired);\r\n        });\r\n        \r\n        if (hasPermission) {\r\n          console.log(`[validateRolePermissions] User has permission \"${permissionRequired}\" for action \"${action}\"`);\r\n        } else {\r\n          console.warn(`[validateRolePermissions] User does not have permission \"${permissionRequired}\" for action \"${action}\"`);\r\n        }\r\n        \r\n        return hasPermission || false;\r\n      } catch (error) {\r\n        console.error('[validateRolePermissions] Error validating permissions:', error);\r\n        return true; // Graceful degradation\r\n      }\r\n    }\r\n    \r\n    // Permission array validation (original behavior)\r\n    const permissions = Array.isArray(actionOrPermissions) ? actionOrPermissions : [actionOrPermissions];\r\n    \r\n    // Handle case where permissions might not be an array\r\n    if (!Array.isArray(permissions)) {\r\n      return {\r\n        valid: false,\r\n        invalid: [String(permissions)]\r\n      };\r\n    }\r\n\r\n    const allPermissions = await this.getPermissions();\r\n    const validPermissionIds = allPermissions.map(p => p.id);\r\n    const invalid = permissions.filter(p => !validPermissionIds.includes(p));\r\n\r\n    return {\r\n      valid: invalid.length === 0,\r\n      invalid\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Map action string to required permission\r\n   * Converts action format like \"product_sales:create\" to \"manage_product_sales\"\r\n   */\r\n  private mapActionToPermission(action: string): string | null {\r\n    // Action format: \"resource(:or_subresource):operation\"\r\n    // e.g., \"product_sales:create\" -> \"manage_product_sales\"\r\n    const parts = action.split(':');\r\n    if (parts.length < 2) return null;\r\n    \r\n    const resource = parts[0];\r\n    const operation = parts[1];\r\n    \r\n    // For most operations, we need the \"manage_resource\" permission\r\n    switch (operation) {\r\n      case 'create':\r\n      case 'edit':\r\n      case 'delete':\r\n      case 'change_status':\r\n      case 'approve':\r\n      case 'reject':\r\n      case 'bulk_delete':\r\n      case 'bulk_update_status':\r\n      case 'create_with_contract':\r\n      case 'edit_fields':\r\n      case 'export':\r\n      case 'view_audit':\r\n      case 'bulk_export':\r\n        return `manage_${resource}`;\r\n      \r\n      case 'view':\r\n      case 'view_details':\r\n        return `manage_${resource}`;\r\n      \r\n      default:\r\n        return `manage_${resource}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper method to get client IP (returns placeholder in browser)\r\n   */\r\n  private getClientIp(): string {\r\n    // In a browser environment, we can't get the real IP\r\n    // The server should capture this from the request\r\n    return 'browser-client';\r\n  }\r\n\r\n  /**\r\n   * Get default permissions as fallback\r\n   */\r\n  private getDefaultPermissions(): Permission[] {\r\n    return [\r\n      // Core permissions\r\n      { id: 'read', name: 'Read', description: 'View and read data', category: 'core', resource: '*', action: 'read' },\r\n      { id: 'write', name: 'Write', description: 'Create and edit data', category: 'core', resource: '*', action: 'write' },\r\n      { id: 'delete', name: 'Delete', description: 'Delete data', category: 'core', resource: '*', action: 'delete' },\r\n\r\n      // Module permissions\r\n      { id: 'manage_customers', name: 'Manage Customers', description: 'Manage customer data', category: 'module', resource: 'customers', action: 'manage' },\r\n      { id: 'manage_sales', name: 'Manage Sales', description: 'Manage sales processes', category: 'module', resource: 'sales', action: 'manage' },\r\n      { id: 'manage_tickets', name: 'Manage Tickets', description: 'Manage support tickets', category: 'module', resource: 'tickets', action: 'manage' },\r\n      { id: 'manage_complaints', name: 'Manage Complaints', description: 'Handle complaints', category: 'module', resource: 'complaints', action: 'manage' },\r\n      { id: 'manage_contracts', name: 'Manage Contracts', description: 'Manage contracts', category: 'module', resource: 'contracts', action: 'manage' },\r\n      { id: 'manage_products', name: 'Manage Products', description: 'Manage products', category: 'module', resource: 'products', action: 'manage' },\r\n\r\n      // Administrative permissions\r\n      { id: 'manage_users', name: 'Manage Users', description: 'Manage user accounts', category: 'administrative', resource: 'users', action: 'manage' },\r\n      { id: 'manage_roles', name: 'Manage Roles', description: 'Manage roles', category: 'administrative', resource: 'roles', action: 'manage' },\r\n      { id: 'view_analytics', name: 'View Analytics', description: 'Access analytics', category: 'administrative', resource: 'analytics', action: 'view' },\r\n      { id: 'manage_settings', name: 'Manage Settings', description: 'Configure settings', category: 'administrative', resource: 'settings', action: 'manage' },\r\n\r\n      // System permissions\r\n      { id: 'super_admin', name: 'Super Admin', description: 'Full system access', category: 'system', resource: 'system', action: 'admin' },\r\n    ];\r\n  }\r\n}\r\n\r\nexport const supabaseRbacService = new SupabaseRBACService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\api\\supabase\\salesService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[419,422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[419,422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[586,589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[586,589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2490,2493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2490,2493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":370,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12726,12729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12726,12729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12883,12886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12883,12886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":432,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14748,14751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14748,14751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":433,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":433,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14826,14829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14826,14829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":434,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":434,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14903,14906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14903,14906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":435,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":435,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14983,14986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14983,14986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":441,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15207,15210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15207,15210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":443,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":443,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15339,15342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15339,15342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":445,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":445,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15479,15482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15479,15482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":447,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":447,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15688,15691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15688,15691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":694,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":694,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22946,22949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22946,22949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Sales Service\r\n * Handles sales deals and pipeline operations via Supabase PostgreSQL\r\n */\r\n\r\nimport { supabase } from '@/services/database';\r\nimport { Deal } from '@/types/crm';\r\nimport { authService } from '@/services/authService';\r\n\r\nclass SupabaseSalesService {\r\n  private table = 'sales';\r\n\r\n  /**\r\n   * Transform database snake_case to TypeScript camelCase\r\n   */\r\n  private toTypeScript(dbDeal: any): Deal {\r\n    // Transform sale_items array to SaleItem interface format\r\n    const items = Array.isArray(dbDeal.sale_items)\r\n      ? dbDeal.sale_items.map((item: any) => ({\r\n          id: item.id,\r\n          sale_id: item.sale_id,\r\n          product_id: item.product_id,\r\n          product_name: item.product_name,\r\n          product_description: item.product_description,\r\n          quantity: Number(item.quantity) || 0,\r\n          unit_price: Number(item.unit_price) || 0,\r\n          discount: Number(item.discount) || 0,\r\n          tax: Number(item.tax) || 0,\r\n          line_total: Number(item.line_total) || 0,\r\n        }))\r\n      : [];\r\n\r\n    return {\r\n      id: dbDeal.id,\r\n      sale_number: dbDeal.sale_number,\r\n      title: dbDeal.title,\r\n      description: dbDeal.description,\r\n      customer_id: dbDeal.customer_id,\r\n      customer_name: dbDeal.customer_name,\r\n      value: Number(dbDeal.value) || 0,\r\n      amount: Number(dbDeal.amount) || Number(dbDeal.value) || 0, // Alias for value\r\n      currency: dbDeal.currency || 'USD',\r\n      probability: Number(dbDeal.probability) || 50,\r\n      weighted_amount: dbDeal.weighted_amount,\r\n      stage: dbDeal.stage,\r\n      status: dbDeal.status,\r\n      source: dbDeal.source,\r\n      campaign: dbDeal.campaign,\r\n      expected_close_date: dbDeal.expected_close_date || '',\r\n      actual_close_date: dbDeal.actual_close_date || '',\r\n      last_activity_date: dbDeal.last_activity_date,\r\n      next_activity_date: dbDeal.next_activity_date,\r\n      assigned_to: dbDeal.assigned_to || '',\r\n      assigned_to_name: dbDeal.assigned_to_name || '',\r\n      notes: dbDeal.notes || '',\r\n      tags: Array.isArray(dbDeal.tags) ? dbDeal.tags : [],\r\n      competitor_info: dbDeal.competitor_info,\r\n      items: items,\r\n      tenant_id: dbDeal.tenant_id,\r\n      created_at: dbDeal.created_at,\r\n      updated_at: dbDeal.updated_at,\r\n      created_by: dbDeal.created_by\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Transform TypeScript camelCase to database snake_case\r\n   */\r\n  private toDatabase(deal: Partial<Deal>): any {\r\n    const dbDeal: any = {};\r\n    if (deal.id !== undefined) dbDeal.id = deal.id;\r\n    if (deal.sale_number !== undefined) dbDeal.sale_number = deal.sale_number;\r\n    if (deal.title !== undefined) dbDeal.title = deal.title;\r\n    if (deal.description !== undefined) dbDeal.description = deal.description;\r\n    if (deal.customer_id !== undefined) dbDeal.customer_id = deal.customer_id;\r\n    if (deal.customer_name !== undefined) dbDeal.customer_name = deal.customer_name;\r\n    if (deal.value !== undefined) dbDeal.value = deal.value;\r\n    if (deal.amount !== undefined && deal.value === undefined) dbDeal.value = deal.amount; // Map amount to value\r\n    if (deal.amount !== undefined) dbDeal.amount = deal.amount;\r\n    if (deal.currency !== undefined) dbDeal.currency = deal.currency;\r\n    if (deal.probability !== undefined) dbDeal.probability = deal.probability;\r\n    if (deal.weighted_amount !== undefined) dbDeal.weighted_amount = deal.weighted_amount;\r\n    if (deal.stage !== undefined) dbDeal.stage = deal.stage;\r\n    if (deal.status !== undefined) dbDeal.status = deal.status;\r\n    if (deal.source !== undefined) dbDeal.source = deal.source;\r\n    if (deal.campaign !== undefined) dbDeal.campaign = deal.campaign;\r\n    if (deal.expected_close_date !== undefined) dbDeal.expected_close_date = deal.expected_close_date;\r\n    if (deal.actual_close_date !== undefined) dbDeal.actual_close_date = deal.actual_close_date;\r\n    if (deal.last_activity_date !== undefined) dbDeal.last_activity_date = deal.last_activity_date;\r\n    if (deal.next_activity_date !== undefined) dbDeal.next_activity_date = deal.next_activity_date;\r\n    if (deal.assigned_to !== undefined) dbDeal.assigned_to = deal.assigned_to;\r\n    if (deal.assigned_to_name !== undefined) dbDeal.assigned_to_name = deal.assigned_to_name;\r\n    if (deal.notes !== undefined) dbDeal.notes = deal.notes;\r\n    if (deal.tags !== undefined) dbDeal.tags = deal.tags;\r\n    if (deal.competitor_info !== undefined) dbDeal.competitor_info = deal.competitor_info;\r\n    if (deal.tenant_id !== undefined) dbDeal.tenant_id = deal.tenant_id;\r\n    if (deal.created_by !== undefined) dbDeal.created_by = deal.created_by;\r\n    return dbDeal;\r\n  }\r\n\r\n  /**\r\n   * Get all deals for the current tenant (with role-based filtering)\r\n   */\r\n  async getDeals(filters?: {\r\n    stage?: string;\r\n    assigned_to?: string;\r\n    customer_id?: string;\r\n    search?: string;\r\n  }): Promise<Deal[]> {\r\n    try {\r\n      console.log('[Supabase Sales Service] üì• getDeals() called with filters:', filters);\r\n      \r\n      const user = authService.getCurrentUser();\r\n      console.log('[Supabase Sales Service] üë§ Current user:', user);\r\n      \r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      let query = supabase\r\n        .from(this.table)\r\n        .select('*, sale_items(*)')\r\n        .eq('tenant_id', user.tenant_id);\r\n\r\n      console.log('[Supabase Sales Service] üîç Querying table:', this.table, 'for tenant:', user.tenant_id);\r\n\r\n      // Apply role-based filtering for agents\r\n      if (user.role === 'agent') {\r\n        query = query.eq('assigned_to', user.id);\r\n        console.log('[Supabase Sales Service] üéØ Filtering for agent:', user.id);\r\n      }\r\n\r\n      // Apply stage filter\r\n      if (filters?.stage) {\r\n        query = query.eq('stage', filters.stage);\r\n        console.log('[Supabase Sales Service] üìä Filtering by stage:', filters.stage);\r\n      }\r\n\r\n      // Apply assigned_to filter\r\n      if (filters?.assigned_to) {\r\n        query = query.eq('assigned_to', filters.assigned_to);\r\n        console.log('[Supabase Sales Service] üë• Filtering by assigned_to:', filters.assigned_to);\r\n      }\r\n\r\n      // Apply customer_id filter\r\n      if (filters?.customer_id) {\r\n        query = query.eq('customer_id', filters.customer_id);\r\n        console.log('[Supabase Sales Service] üè¢ Filtering by customer_id:', filters.customer_id);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      console.log('[Supabase Sales Service] üì¶ Query result - Data count:', data?.length || 0, 'Error:', error);\r\n      console.log('[Supabase Sales Service] üìã Raw data:', data);\r\n\r\n      if (error) throw error;\r\n\r\n      // Apply search filter (client-side)\r\n      let deals = data || [];\r\n      if (filters?.search) {\r\n        const search = filters.search.toLowerCase();\r\n        deals = deals.filter(d =>\r\n          d.title?.toLowerCase().includes(search) ||\r\n          d.customer_name?.toLowerCase().includes(search) ||\r\n          d.description?.toLowerCase().includes(search)\r\n        );\r\n        console.log('[Supabase Sales Service] üîé After search filter:', deals.length, 'deals');\r\n      }\r\n\r\n      const transformed = deals.map(d => this.toTypeScript(d));\r\n      console.log('[Supabase Sales Service] ‚úÖ Returning', transformed.length, 'deals:', transformed);\r\n      \r\n      return transformed;\r\n    } catch (error) {\r\n      console.error('[Supabase Sales Service] ‚ùå Error fetching deals:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a single deal by ID\r\n   */\r\n  async getDeal(id: string): Promise<Deal> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      const { data, error } = await supabase\r\n        .from(this.table)\r\n        .select('*, sale_items(*)')\r\n        .eq('id', id)\r\n        .eq('tenant_id', user.tenant_id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      if (!data) throw new Error('Deal not found');\r\n\r\n      // Check permissions for agents\r\n      if (user.role === 'agent' && data.assigned_to !== user.id) {\r\n        throw new Error('Access denied');\r\n      }\r\n\r\n      console.log('[Supabase Sales Service] üì¶ Fetched deal with items:', {\r\n        dealId: data.id,\r\n        itemsCount: data.sale_items?.length || 0,\r\n        items: data.sale_items\r\n      });\r\n\r\n      return this.toTypeScript(data);\r\n    } catch (error) {\r\n      console.error('[Supabase] Error fetching deal:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new deal\r\n   */\r\n  async createDeal(dealData: Omit<Deal, 'id' | 'tenant_id' | 'created_at' | 'updated_at'>): Promise<Deal> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      if (!authService.hasPermission('write')) {\r\n        throw new Error('Insufficient permissions');\r\n      }\r\n\r\n      const newDeal = {\r\n        ...this.toDatabase(dealData),\r\n        tenant_id: user.tenant_id,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      const { data, error } = await supabase\r\n        .from(this.table)\r\n        .insert([newDeal])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return this.toTypeScript(data);\r\n    } catch (error) {\r\n      console.error('[Supabase] Error creating deal:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing deal\r\n   */\r\n  async updateDeal(id: string, updates: Partial<Deal>): Promise<Deal> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      if (!authService.hasPermission('write')) {\r\n        throw new Error('Insufficient permissions');\r\n      }\r\n\r\n      // Verify ownership for agents\r\n      const { data: existingDeal, error: fetchError } = await supabase\r\n        .from(this.table)\r\n        .select('*')\r\n        .eq('id', id)\r\n        .eq('tenant_id', user.tenant_id)\r\n        .single();\r\n\r\n      if (fetchError || !existingDeal) throw new Error('Deal not found');\r\n\r\n      if (user.role === 'agent' && existingDeal.assigned_to !== user.id) {\r\n        throw new Error('Access denied');\r\n      }\r\n\r\n      const dbUpdates = {\r\n        ...this.toDatabase(updates),\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      const { data, error } = await supabase\r\n        .from(this.table)\r\n        .update(dbUpdates)\r\n        .eq('id', id)\r\n        .eq('tenant_id', user.tenant_id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return this.toTypeScript(data);\r\n    } catch (error) {\r\n      console.error('[Supabase] Error updating deal:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a deal\r\n   */\r\n  async deleteDeal(id: string): Promise<void> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      if (!authService.hasPermission('delete')) {\r\n        throw new Error('Insufficient permissions');\r\n      }\r\n\r\n      // Verify ownership for agents\r\n      const { data: existingDeal, error: fetchError } = await supabase\r\n        .from(this.table)\r\n        .select('*')\r\n        .eq('id', id)\r\n        .eq('tenant_id', user.tenant_id)\r\n        .single();\r\n\r\n      if (fetchError || !existingDeal) throw new Error('Deal not found');\r\n\r\n      if (user.role === 'agent' && existingDeal.assigned_to !== user.id) {\r\n        throw new Error('Access denied');\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from(this.table)\r\n        .delete()\r\n        .eq('id', id)\r\n        .eq('tenant_id', user.tenant_id);\r\n\r\n      if (error) throw error;\r\n    } catch (error) {\r\n      console.error('[Supabase] Error deleting deal:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all pipeline stages\r\n   */\r\n  async getStages(): Promise<string[]> {\r\n    return ['lead', 'qualified', 'proposal', 'negotiation', 'closed_won', 'closed_lost'];\r\n  }\r\n\r\n  /**\r\n   * Get pipeline statistics\r\n   */\r\n  async getPipelineStats(): Promise<{\r\n    stage: string;\r\n    count: number;\r\n    value: number;\r\n  }[]> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      let query = supabase\r\n        .from(this.table)\r\n        .select('*')\r\n        .eq('tenant_id', user.tenant_id);\r\n\r\n      // Apply role-based filtering for agents\r\n      if (user.role === 'agent') {\r\n        query = query.eq('assigned_to', user.id);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      const deals = data || [];\r\n      const stages = await this.getStages();\r\n\r\n      return stages.map(stage => {\r\n        const stageDeals = deals.filter((d: any) => d.stage === stage);\r\n        return {\r\n          stage,\r\n          count: stageDeals.length,\r\n          value: stageDeals.reduce((sum: number, deal: any) => sum + (deal.value || 0), 0)\r\n        };\r\n      });\r\n    } catch (error) {\r\n      console.error('[Supabase] Error fetching pipeline stats:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // ============================================================\r\n  // Interface compliance methods - aliases for existing methods\r\n  // ============================================================\r\n\r\n  async getSales(filters?: Record<string, unknown>): Promise<Deal[]> {\r\n    return this.getDeals(filters);\r\n  }\r\n\r\n  async getSale(id: string): Promise<Deal> {\r\n    return this.getDeal(id);\r\n  }\r\n\r\n  async createSale(data: Record<string, unknown>): Promise<Deal> {\r\n    return this.createDeal(data as Omit<Deal, 'id' | 'tenant_id' | 'created_at' | 'updated_at'>);\r\n  }\r\n\r\n  async updateSale(id: string, data: Record<string, unknown>): Promise<Deal> {\r\n    return this.updateDeal(id, data as Partial<Deal>);\r\n  }\r\n\r\n  async deleteSale(id: string): Promise<void> {\r\n    return this.deleteDeal(id);\r\n  }\r\n\r\n  async getPipelineStages(): Promise<Array<{ id: string; name: string; order: number }>> {\r\n    const stages = await this.getStages();\r\n    return stages.map(stage => ({ id: stage, name: stage, order: stages.indexOf(stage) }));\r\n  }\r\n\r\n  async getSalesAnalytics(period?: string): Promise<Record<string, unknown>> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      let query = supabase\r\n        .from(this.table)\r\n        .select('*')\r\n        .eq('tenant_id', user.tenant_id);\r\n\r\n      // Apply role-based filtering for agents\r\n      if (user.role === 'agent') {\r\n        query = query.eq('assigned_to', user.id);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      const deals = data || [];\r\n      const totalValue = deals.reduce((sum: number, deal: any) => sum + (deal.value || 0), 0);\r\n      const wonDeals = deals.filter((d: any) => d.stage === 'closed_won');\r\n      const lostDeals = deals.filter((d: any) => d.stage === 'closed_lost');\r\n      const activeDeals = deals.filter((d: any) => !['closed_won', 'closed_lost'].includes(d.stage));\r\n\r\n      return {\r\n        totalDeals: deals.length,\r\n        totalValue,\r\n        wonDeals: wonDeals.length,\r\n        wonValue: wonDeals.reduce((sum: number, deal: any) => sum + (deal.value || 0), 0),\r\n        lostDeals: lostDeals.length,\r\n        lostValue: lostDeals.reduce((sum: number, deal: any) => sum + (deal.value || 0), 0),\r\n        activeDeals: activeDeals.length,\r\n        activeValue: activeDeals.reduce((sum: number, deal: any) => sum + (deal.value || 0), 0),\r\n        conversionRate: deals.length > 0 ? (wonDeals.length / deals.length) * 100 : 0,\r\n        averageDealSize: wonDeals.length > 0 ? wonDeals.reduce((sum: number, deal: any) => sum + (deal.value || 0), 0) / wonDeals.length : 0\r\n      };\r\n    } catch (error) {\r\n      console.error('[Supabase] Error fetching sales analytics:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // ============================================================\r\n  // Missing methods for hook compliance\r\n  // ============================================================\r\n\r\n  async getDealsByCustomer(customerId: string, filters?: Record<string, unknown>): Promise<{ data: Deal[], page: number, pageSize: number, total: number, totalPages: number }> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      let query = supabase\r\n        .from(this.table)\r\n        .select('*, sale_items(*)')\r\n        .eq('tenant_id', user.tenant_id)\r\n        .eq('customer_id', customerId);\r\n\r\n      // Apply role-based filtering for agents\r\n      if (user.role === 'agent') {\r\n        query = query.eq('assigned_to', user.id);\r\n      }\r\n\r\n      const { data, error, count } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      const deals = (data || []).map(d => this.toTypeScript(d));\r\n      return {\r\n        data: deals,\r\n        page: 1,\r\n        pageSize: deals.length,\r\n        total: count || deals.length,\r\n        totalPages: 1\r\n      };\r\n    } catch (error) {\r\n      console.error('[Supabase] Error fetching deals by customer:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async getSalesStats(): Promise<Record<string, unknown>> {\r\n    return this.getSalesAnalytics();\r\n  }\r\n\r\n  async getDealStages(): Promise<string[]> {\r\n    return this.getStages();\r\n  }\r\n\r\n  async updateDealStage(id: string, stage: string): Promise<Deal> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      if (!authService.hasPermission('write')) {\r\n        throw new Error('Insufficient permissions');\r\n      }\r\n\r\n      // Verify ownership for agents\r\n      const { data: existingDeal, error: fetchError } = await supabase\r\n        .from(this.table)\r\n        .select('*')\r\n        .eq('id', id)\r\n        .eq('tenant_id', user.tenant_id)\r\n        .single();\r\n\r\n      if (fetchError || !existingDeal) throw new Error('Deal not found');\r\n\r\n      if (user.role === 'agent' && existingDeal.assigned_to !== user.id) {\r\n        throw new Error('Access denied');\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from(this.table)\r\n        .update({\r\n          stage,\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', id)\r\n        .eq('tenant_id', user.tenant_id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return this.toTypeScript(data);\r\n    } catch (error) {\r\n      console.error('[Supabase] Error updating deal stage:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async bulkUpdateDeals(ids: string[], updates: Record<string, unknown>): Promise<Deal[]> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      if (!authService.hasPermission('write')) {\r\n        throw new Error('Insufficient permissions');\r\n      }\r\n\r\n      const dbUpdates = {\r\n        ...this.toDatabase(updates as Partial<Deal>),\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      const { data, error } = await supabase\r\n        .from(this.table)\r\n        .update(dbUpdates)\r\n        .in('id', ids)\r\n        .eq('tenant_id', user.tenant_id)\r\n        .select();\r\n\r\n      if (error) throw error;\r\n\r\n      return (data || []).map(d => this.toTypeScript(d));\r\n    } catch (error) {\r\n      console.error('[Supabase] Error bulk updating deals:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async bulkDeleteDeals(ids: string[]): Promise<void> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      if (!authService.hasPermission('delete')) {\r\n        throw new Error('Insufficient permissions');\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from(this.table)\r\n        .delete()\r\n        .in('id', ids)\r\n        .eq('tenant_id', user.tenant_id);\r\n\r\n      if (error) throw error;\r\n    } catch (error) {\r\n      console.error('[Supabase] Error bulk deleting deals:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async searchDeals(query: string): Promise<Deal[]> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      const searchQuery = query.toLowerCase();\r\n\r\n      let q = supabase\r\n        .from(this.table)\r\n        .select('*, sale_items(*)')\r\n        .eq('tenant_id', user.tenant_id);\r\n\r\n      // Apply role-based filtering for agents\r\n      if (user.role === 'agent') {\r\n        q = q.eq('assigned_to', user.id);\r\n      }\r\n\r\n      const { data, error } = await q;\r\n\r\n      if (error) throw error;\r\n\r\n      const deals = (data || []).map(d => this.toTypeScript(d));\r\n      \r\n      // Client-side search across title, customer_name, and description\r\n      return deals.filter(d =>\r\n        d.title.toLowerCase().includes(searchQuery) ||\r\n        d.customer_name?.toLowerCase().includes(searchQuery) ||\r\n        d.description.toLowerCase().includes(searchQuery)\r\n      );\r\n    } catch (error) {\r\n      console.error('[Supabase] Error searching deals:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async exportDeals(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      let query = supabase\r\n        .from(this.table)\r\n        .select('*')\r\n        .eq('tenant_id', user.tenant_id);\r\n\r\n      // Apply role-based filtering for agents\r\n      if (user.role === 'agent') {\r\n        query = query.eq('assigned_to', user.id);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      const deals = (data || []).map(d => this.toTypeScript(d));\r\n\r\n      if (format === 'csv') {\r\n        const headers = ['ID', 'Title', 'Customer', 'Value', 'Stage', 'Status', 'Probability', 'Assigned To'];\r\n        const rows = deals.map(d => [\r\n          d.id,\r\n          d.title,\r\n          d.customer_name,\r\n          d.value,\r\n          d.stage,\r\n          d.status,\r\n          d.probability,\r\n          d.assigned_to_name\r\n        ]);\r\n\r\n        const csvContent = [\r\n          headers.join(','),\r\n          ...rows.map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n        ].join('\\n');\r\n\r\n        return csvContent;\r\n      } else {\r\n        return JSON.stringify(deals, null, 2);\r\n      }\r\n    } catch (error) {\r\n      console.error('[Supabase] Error exporting deals:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async importDeals(csv: string): Promise<{ success: number; errors: string[] }> {\r\n    try {\r\n      const user = authService.getCurrentUser();\r\n      if (!user) throw new Error('Unauthorized');\r\n\r\n      if (!authService.hasPermission('write')) {\r\n        throw new Error('Insufficient permissions');\r\n      }\r\n\r\n      const errors: string[] = [];\r\n      let success = 0;\r\n      const lines = csv.trim().split('\\n');\r\n      \r\n      // Skip header\r\n      const dataLines = lines.slice(1);\r\n      const dealsToInsert: any[] = [];\r\n\r\n      for (let i = 0; i < dataLines.length; i++) {\r\n        try {\r\n          const values = dataLines[i].split(',').map(v => v.trim().replace(/^\"|\"$/g, ''));\r\n          const [, title, customerName, value, stage, status, probability, assignedToName] = values;\r\n\r\n          if (!title || !customerName) {\r\n            errors.push(`Row ${i + 2}: Missing required fields (title or customer)`);\r\n            continue;\r\n          }\r\n\r\n          dealsToInsert.push({\r\n            title,\r\n            customer_id: 'imported',\r\n            customer_name: customerName,\r\n            value: parseInt(value) || 0,\r\n            amount: parseInt(value) || 0,\r\n            currency: 'USD',\r\n            stage: stage || 'lead',\r\n            status: status || 'open',\r\n            probability: parseInt(probability) || 50,\r\n            expected_close_date: '',\r\n            actual_close_date: '',\r\n            last_activity_date: new Date().toISOString(),\r\n            next_activity_date: '',\r\n            description: '',\r\n            source: 'import',\r\n            campaign: '',\r\n            notes: `Imported from CSV on ${new Date().toLocaleDateString()}`,\r\n            assigned_to: user.id,\r\n            assigned_to_name: assignedToName || 'Unassigned',\r\n            tags: ['imported'],\r\n            tenant_id: user.tenant_id,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n            created_by: user.id\r\n          });\r\n        } catch (error) {\r\n          errors.push(`Row ${i + 2}: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n        }\r\n      }\r\n\r\n      if (dealsToInsert.length > 0) {\r\n        const { error } = await supabase\r\n          .from(this.table)\r\n          .insert(dealsToInsert);\r\n\r\n        if (error) throw error;\r\n        success = dealsToInsert.length;\r\n      }\r\n\r\n      return { success, errors };\r\n    } catch (error) {\r\n      console.error('[Supabase] Error importing deals:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nexport const supabaseSalesService = new SupabaseSalesService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\api\\supabase\\userService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[484,487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[484,487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1237,1240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1237,1240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1262,1265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1262,1265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase User Service\r\n * Handles user management operations via Supabase PostgreSQL\r\n */\r\n\r\nimport { supabase } from '@/services/database';\r\nimport { User } from '@/types/auth';\r\nimport { authService } from '@/services/authService';\r\n\r\nclass SupabaseUserService {\r\n  private table = 'users';\r\n  private rolesTable = 'roles';\r\n  private userRolesTable = 'user_roles';\r\n\r\n  /**\r\n   * Transform database snake_case to TypeScript camelCase\r\n   */\r\n  private toTypeScript(dbUser: any): User {\r\n    return {\r\n      id: dbUser.id,\r\n      email: dbUser.email,\r\n      name: dbUser.name,\r\n      firstName: dbUser.first_name,\r\n      lastName: dbUser.last_name,\r\n      role: dbUser.role,\r\n      status: dbUser.status,\r\n      tenantId: dbUser.tenant_id,\r\n      avatar: dbUser.avatar_url,\r\n      phone: dbUser.phone,\r\n      mobile: dbUser.mobile,\r\n      company_name: dbUser.company_name,\r\n      department: dbUser.department,\r\n      position: dbUser.position,\r\n      createdAt: dbUser.created_at,\r\n      updatedAt: dbUser.updated_at,\r\n      lastLogin: dbUser.last_login,\r\n      createdBy: dbUser.created_by,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Transform TypeScript camelCase to database snake_case\r\n   */\r\n  private toDatabase(user: Partial<User>): any {\r\n    const dbUser: any = {};\r\n    if (user.id !== undefined) dbUser.id = user.id;\r\n    if (user.email !== undefined) dbUser.email = user.email;\r\n    if (user.name !== undefined) dbUser.name = user.name;\r\n    if (user.firstName !== undefined) dbUser.first_name = user.firstName;\r\n    if (user.lastName !== undefined) dbUser.last_name = user.lastName;\r\n    if (user.role !== undefined) dbUser.role = user.role;\r\n    if (user.status !== undefined) dbUser.status = user.status;\r\n    if (user.tenantId !== undefined) dbUser.tenant_id = user.tenantId;\r\n    if (user.avatar !== undefined) dbUser.avatar_url = user.avatar;\r\n    if (user.phone !== undefined) dbUser.phone = user.phone;\r\n    if (user.mobile !== undefined) dbUser.mobile = user.mobile;\r\n    if (user.company_name !== undefined) dbUser.company_name = user.company_name;\r\n    if (user.department !== undefined) dbUser.department = user.department;\r\n    if (user.position !== undefined) dbUser.position = user.position;\r\n    return dbUser;\r\n  }\r\n\r\n  /**\r\n   * Get all users with optional filters\r\n   */\r\n  async getUsers(filters?: {\r\n    role?: string;\r\n    status?: string;\r\n    tenantId?: string;\r\n    search?: string;\r\n  }): Promise<User[]> {\r\n    // Authorization handled by database RLS (Row-Level Security)\r\n    // Supabase RLS policies ensure users can only access their own tenant data\r\n\r\n    let query = supabase\r\n      .from(this.table)\r\n      .select('*')\r\n      .order('created_at', { ascending: false });\r\n\r\n    // Apply filters\r\n    if (filters) {\r\n      if (filters.role) {\r\n        query = query.eq('role', filters.role);\r\n      }\r\n      if (filters.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n      if (filters.tenantId) {\r\n        query = query.eq('tenant_id', filters.tenantId);\r\n      }\r\n      if (filters.search) {\r\n        const search = filters.search.toLowerCase();\r\n        query = query.or(\r\n          `first_name.ilike.%${search}%,last_name.ilike.%${search}%,email.ilike.%${search}%,company_name.ilike.%${search}%`\r\n        );\r\n      }\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n      console.error('Error fetching users:', error);\r\n      throw new Error(`Failed to fetch users: ${error.message}`);\r\n    }\r\n\r\n    return (data || []).map(dbUser => this.toTypeScript(dbUser));\r\n  }\r\n\r\n  /**\r\n   * Get a single user by ID\r\n   */\r\n  async getUser(id: string): Promise<User> {\r\n    // Authorization handled by database RLS (Row-Level Security)\r\n    // Supabase RLS policies ensure users can only access their own tenant data\r\n\r\n    const { data, error } = await supabase\r\n      .from(this.table)\r\n      .select('*')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('Error fetching user:', error);\r\n      throw new Error(`Failed to fetch user: ${error.message}`);\r\n    }\r\n\r\n    if (!data) {\r\n      throw new Error('User not found');\r\n    }\r\n\r\n    return this.toTypeScript(data);\r\n  }\r\n\r\n  /**\r\n   * Create a new user\r\n   */\r\n  async createUser(userData: Omit<User, 'id' | 'createdAt' | 'lastLogin'>): Promise<User> {\r\n    // Authorization handled by database RLS (Row-Level Security)\r\n    // Supabase RLS policies ensure users can only access their own tenant data\r\n\r\n    // Check if email already exists\r\n    const { data: existingUser, error: checkError } = await supabase\r\n      .from(this.table)\r\n      .select('id')\r\n      .eq('email', userData.email)\r\n      .single();\r\n\r\n    if (checkError && checkError.code !== 'PGRST116') {\r\n      throw new Error('Error checking email uniqueness');\r\n    }\r\n\r\n    if (existingUser) {\r\n      throw new Error('Email already exists');\r\n    }\r\n\r\n    const dbUser = this.toDatabase(userData);\r\n    dbUser.created_at = new Date().toISOString();\r\n    dbUser.last_login = new Date().toISOString();\r\n\r\n    const { data, error } = await supabase\r\n      .from(this.table)\r\n      .insert(dbUser)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('Error creating user:', error);\r\n      throw new Error(`Failed to create user: ${error.message}`);\r\n    }\r\n\r\n    return this.toTypeScript(data);\r\n  }\r\n\r\n  /**\r\n   * Update a user\r\n   */\r\n  async updateUser(id: string, updates: Partial<User>): Promise<User> {\r\n    // Authorization handled by database RLS (Row-Level Security)\r\n    // Supabase RLS policies ensure users can only access their own tenant data\r\n\r\n    // Check if email already exists (if email is being updated)\r\n    if (updates.email) {\r\n      const { data: existingUser, error: checkError } = await supabase\r\n        .from(this.table)\r\n        .select('id')\r\n        .eq('email', updates.email)\r\n        .neq('id', id)\r\n        .single();\r\n\r\n      if (checkError && checkError.code !== 'PGRST116') {\r\n        throw new Error('Error checking email uniqueness');\r\n      }\r\n\r\n      if (existingUser) {\r\n        throw new Error('Email already exists');\r\n      }\r\n    }\r\n\r\n    const dbUpdates = this.toDatabase(updates);\r\n\r\n    const { data, error } = await supabase\r\n      .from(this.table)\r\n      .update(dbUpdates)\r\n      .eq('id', id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('Error updating user:', error);\r\n      throw new Error(`Failed to update user: ${error.message}`);\r\n    }\r\n\r\n    if (!data) {\r\n      throw new Error('User not found');\r\n    }\r\n\r\n    return this.toTypeScript(data);\r\n  }\r\n\r\n  /**\r\n   * Delete a user\r\n   */\r\n  async deleteUser(id: string): Promise<void> {\r\n    // Authorization handled by database RLS (Row-Level Security)\r\n    // Supabase RLS policies ensure users can only access their own tenant data\r\n\r\n    const { error } = await supabase\r\n      .from(this.table)\r\n      .delete()\r\n      .eq('id', id);\r\n\r\n    if (error) {\r\n      console.error('Error deleting user:', error);\r\n      throw new Error(`Failed to delete user: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset a user's password\r\n   */\r\n  async resetPassword(id: string): Promise<void> {\r\n    // Authorization handled by database RLS (Row-Level Security)\r\n    // Supabase RLS policies ensure users can only access their own tenant data\r\n\r\n    const { data: user, error: fetchError } = await supabase\r\n      .from(this.table)\r\n      .select('email')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError || !user) {\r\n      throw new Error('User not found');\r\n    }\r\n\r\n    // In a real implementation, this would trigger a password reset email via Supabase Auth\r\n    // For now, we'll log the action\r\n    console.log(`Password reset email triggered for ${user.email}`);\r\n\r\n    // Log the action\r\n    await this.logPasswordReset(id);\r\n  }\r\n\r\n  /**\r\n   * Get available roles\r\n   */\r\n  async getRoles(): Promise<string[]> {\r\n    const { data, error } = await supabase\r\n      .from(this.rolesTable)\r\n      .select('name')\r\n      .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching roles:', error);\r\n      return ['Admin', 'Manager', 'Viewer'];\r\n    }\r\n\r\n    return data?.map(r => r.name) || ['Admin', 'Manager', 'Viewer'];\r\n  }\r\n\r\n  /**\r\n   * Get available permissions\r\n   */\r\n  async getPermissions(): Promise<string[]> {\r\n    return [\r\n      'read',\r\n      'write',\r\n      'delete',\r\n      'admin',\r\n      'user_management',\r\n      'customer_management',\r\n      'sales_management',\r\n      'ticket_management',\r\n      'contract_management',\r\n      'report_access',\r\n      'export_data',\r\n      'import_data',\r\n      'system_settings'\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Get available statuses\r\n   */\r\n  async getStatuses(): Promise<string[]> {\r\n    return ['active', 'inactive', 'suspended'];\r\n  }\r\n\r\n  /**\r\n   * Get available tenants\r\n   */\r\n  async getTenants(): Promise<Array<{ id: string; name: string }>> {\r\n    const { data, error } = await supabase\r\n      .from('tenants')\r\n      .select('id, name')\r\n      .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n      console.error('Error fetching tenants:', error);\r\n      return [];\r\n    }\r\n\r\n    return data || [];\r\n  }\r\n\r\n  /**\r\n   * Helper method to log password reset actions\r\n   */\r\n  private async logPasswordReset(userId: string): Promise<void> {\r\n    const currentUser = authService.getCurrentUser();\r\n    if (!currentUser) return;\r\n\r\n    try {\r\n      await supabase\r\n        .from('audit_logs')\r\n        .insert({\r\n          user_id: currentUser.id,\r\n          action: 'password_reset',\r\n          resource: 'user',\r\n          resource_id: userId,\r\n          details: { reset_by: currentUser.id },\r\n          tenant_id: currentUser.tenantId,  // Fixed: use camelCase tenantId from User object\r\n          timestamp: new Date().toISOString(),\r\n        });\r\n    } catch (err) {\r\n      console.error('Error logging password reset:', err);\r\n    }\r\n  }\r\n}\r\n\r\nexport const supabaseUserService = new SupabaseUserService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\auditService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\authService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\companyService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\complaintService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\configurationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\contractService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13353,13356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13353,13356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Contract,\r\n  ContractTemplate,\r\n  ContractFormData,\r\n  ContractFilters,\r\n  ContractAnalytics,\r\n  RenewalReminder,\r\n  DigitalSignature,\r\n  ApprovalRecord,\r\n  ContractParty,\r\n  ComplianceItem,\r\n  ContractVersion,\r\n  ApprovalData,\r\n  RejectionData,\r\n  AuditTrailEntry,\r\n  AuditTrailFilters,\r\n  ApprovalWorkflowStep,\r\n  ContractAttachmentDetail,\r\n  AttachmentUploadData\r\n} from '@/types/contracts';\r\nimport { authService } from './authService';\r\n\r\nclass ContractService {\r\n  private baseUrl = '/api/contracts';\r\n\r\n  // Mock contract templates\r\n  private mockTemplates: ContractTemplate[] = [\r\n    {\r\n      id: '1',\r\n      name: 'Service Agreement Template',\r\n      type: 'service_agreement',\r\n      content: `SERVICE AGREEMENT\r\n\r\nThis Service Agreement (\"Agreement\") is entered into on {{startDate}} between {{clientName}} (\"Client\") and {{providerName}} (\"Provider\").\r\n\r\n1. SERVICES\r\nProvider agrees to provide the following services: {{serviceDescription}}\r\n\r\n2. TERM\r\nThis agreement shall commence on {{startDate}} and continue until {{endDate}}.\r\n\r\n3. COMPENSATION\r\nClient agrees to pay Provider {{contractValue}} {{currency}} for the services described herein.\r\n\r\n4. PAYMENT TERMS\r\n{{paymentTerms}}\r\n\r\n5. TERMINATION\r\nEither party may terminate this agreement with {{terminationNotice}} days written notice.\r\n\r\nIN WITNESS WHEREOF, the parties have executed this Agreement as of the date first written above.\r\n\r\nClient: _________________________ Date: _________\r\n{{clientName}}\r\n\r\nProvider: _________________________ Date: _________\r\n{{providerName}}`,\r\n      fields: [\r\n        { id: '1', name: 'clientName', label: 'Client Name', type: 'text', required: true },\r\n        { id: '2', name: 'providerName', label: 'Provider Name', type: 'text', required: true },\r\n        { id: '3', name: 'serviceDescription', label: 'Service Description', type: 'textarea', required: true },\r\n        { id: '4', name: 'contractValue', label: 'Contract Value', type: 'number', required: true },\r\n        { id: '5', name: 'currency', label: 'Currency', type: 'select', required: true, options: ['USD', 'EUR', 'GBP'] },\r\n        { id: '6', name: 'paymentTerms', label: 'Payment Terms', type: 'textarea', required: true },\r\n        { id: '7', name: 'terminationNotice', label: 'Termination Notice (days)', type: 'number', required: true, defaultValue: '30' }\r\n      ],\r\n      is_active: true,\r\n      category: 'Business',\r\n      description: 'Standard service agreement template for professional services',\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: '2',\r\n      name: 'Non-Disclosure Agreement',\r\n      type: 'nda',\r\n      content: `NON-DISCLOSURE AGREEMENT\r\n\r\nThis Non-Disclosure Agreement (\"Agreement\") is entered into on {{startDate}} between {{disclosingParty}} (\"Disclosing Party\") and {{receivingParty}} (\"Receiving Party\").\r\n\r\n1. CONFIDENTIAL INFORMATION\r\nFor purposes of this Agreement, \"Confidential Information\" means {{confidentialDefinition}}\r\n\r\n2. OBLIGATIONS\r\nReceiving Party agrees to:\r\n- Hold all Confidential Information in strict confidence\r\n- Not disclose Confidential Information to third parties\r\n- Use Confidential Information solely for {{purpose}}\r\n\r\n3. TERM\r\nThis Agreement shall remain in effect for {{duration}} years from the date of execution.\r\n\r\n4. RETURN OF INFORMATION\r\nUpon termination, Receiving Party shall return or destroy all Confidential Information.\r\n\r\nIN WITNESS WHEREOF, the parties have executed this Agreement.\r\n\r\nDisclosing Party: _________________________ Date: _________\r\n{{disclosingParty}}\r\n\r\nReceiving Party: _________________________ Date: _________\r\n{{receivingParty}}`,\r\n      fields: [\r\n        { id: '1', name: 'disclosingParty', label: 'Disclosing Party', type: 'text', required: true },\r\n        { id: '2', name: 'receivingParty', label: 'Receiving Party', type: 'text', required: true },\r\n        { id: '3', name: 'confidentialDefinition', label: 'Confidential Information Definition', type: 'textarea', required: true },\r\n        { id: '4', name: 'purpose', label: 'Purpose of Disclosure', type: 'textarea', required: true },\r\n        { id: '5', name: 'duration', label: 'Duration (years)', type: 'number', required: true, defaultValue: '2' }\r\n      ],\r\n      is_active: true,\r\n      category: 'Legal',\r\n      description: 'Standard non-disclosure agreement for confidential information protection',\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: '3',\r\n      name: 'Purchase Order Agreement',\r\n      type: 'purchase_order',\r\n      content: `PURCHASE ORDER AGREEMENT\r\n\r\nPurchase Order Number: {{poNumber}}\r\nDate: {{startDate}}\r\n\r\nVendor: {{vendorName}}\r\nBuyer: {{buyerName}}\r\n\r\n1. PRODUCTS/SERVICES\r\n{{itemDescription}}\r\n\r\n2. PRICING\r\nTotal Amount: {{contractValue}} {{currency}}\r\n\r\n3. DELIVERY\r\nDelivery Date: {{deliveryDate}}\r\nDelivery Address: {{deliveryAddress}}\r\n\r\n4. PAYMENT TERMS\r\n{{paymentTerms}}\r\n\r\n5. WARRANTIES\r\n{{warranties}}\r\n\r\nAuthorized Signature: _________________________ Date: _________\r\n{{buyerName}}`,\r\n      fields: [\r\n        { id: '1', name: 'poNumber', label: 'PO Number', type: 'text', required: true },\r\n        { id: '2', name: 'vendorName', label: 'Vendor Name', type: 'text', required: true },\r\n        { id: '3', name: 'buyerName', label: 'Buyer Name', type: 'text', required: true },\r\n        { id: '4', name: 'itemDescription', label: 'Items/Services Description', type: 'textarea', required: true },\r\n        { id: '5', name: 'contractValue', label: 'Total Amount', type: 'number', required: true },\r\n        { id: '6', name: 'currency', label: 'Currency', type: 'select', required: true, options: ['USD', 'EUR', 'GBP'] },\r\n        { id: '7', name: 'deliveryDate', label: 'Delivery Date', type: 'date', required: true },\r\n        { id: '8', name: 'deliveryAddress', label: 'Delivery Address', type: 'textarea', required: true },\r\n        { id: '9', name: 'paymentTerms', label: 'Payment Terms', type: 'textarea', required: true },\r\n        { id: '10', name: 'warranties', label: 'Warranties', type: 'textarea', required: false }\r\n      ],\r\n      is_active: true,\r\n      category: 'Procurement',\r\n      description: 'Standard purchase order agreement for goods and services',\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    }\r\n  ];\r\n\r\n  // Mock contracts data\r\n  private mockContracts: Contract[] = [\r\n    {\r\n      id: '1',\r\n      title: 'Enterprise Software License Agreement',\r\n      type: 'service_agreement',\r\n      status: 'active',\r\n      parties: [\r\n        {\r\n          id: '1',\r\n          name: 'TechCorp Solutions',\r\n          email: 'legal@techcorp.com',\r\n          role: 'client',\r\n          signature_required: true,\r\n          signed_at: '2024-01-15T10:00:00Z',\r\n          signature_url: '/signatures/techcorp-signature.png'\r\n        },\r\n        {\r\n          id: '2',\r\n          name: 'Our Company',\r\n          email: 'contracts@ourcompany.com',\r\n          role: 'vendor',\r\n          signature_required: true,\r\n          signed_at: '2024-01-15T10:30:00Z',\r\n          signature_url: '/signatures/ourcompany-signature.png'\r\n        }\r\n      ],\r\n      value: 150000,\r\n      total_value: 150000,\r\n      currency: 'USD',\r\n      start_date: '2024-01-15',\r\n      end_date: '2025-01-15',\r\n      auto_renew: true,\r\n      renewal_terms: 'Automatic renewal for 1 year unless terminated with 60 days notice',\r\n      approval_stage: 'approved',\r\n      signed_date: '2024-01-15T10:30:00Z',\r\n      created_by: '1',\r\n      assigned_to: '2',\r\n      tenant_id: 'tenant_1',\r\n      content: 'Full enterprise software license agreement content...',\r\n      template_id: '1',\r\n      version: 1,\r\n      tags: ['enterprise', 'software', 'annual'],\r\n      priority: 'high',\r\n      reminder_days: [90, 60, 30],\r\n      next_reminder_date: '2024-10-15',\r\n      compliance_status: 'compliant',\r\n      attachments: [],\r\n      approval_history: [\r\n        {\r\n          id: '1',\r\n          stage: 'legal_review',\r\n          approver: '3',\r\n          approver_name: 'Legal Team',\r\n          status: 'approved',\r\n          comments: 'Terms reviewed and approved',\r\n          timestamp: '2024-01-10T14:00:00Z'\r\n        },\r\n        {\r\n          id: '2',\r\n          stage: 'finance_review',\r\n          approver: '4',\r\n          approver_name: 'Finance Team',\r\n          status: 'approved',\r\n          comments: 'Budget approved',\r\n          timestamp: '2024-01-12T16:00:00Z'\r\n        }\r\n      ],\r\n      signature_status: {\r\n        total_required: 2,\r\n        completed: 2,\r\n        pending: [],\r\n        last_signed_at: '2024-01-15T10:30:00Z'\r\n      },\r\n      created_at: '2024-01-05T09:00:00Z',\r\n      updated_at: '2024-01-15T10:30:00Z'\r\n    },\r\n    {\r\n      id: '2',\r\n      title: 'Manufacturing Partnership NDA',\r\n      type: 'nda',\r\n      status: 'pending_approval',\r\n      parties: [\r\n        {\r\n          id: '1',\r\n          name: 'Global Manufacturing Inc',\r\n          email: 'legal@globalmanuf.com',\r\n          role: 'partner',\r\n          signature_required: true\r\n        },\r\n        {\r\n          id: '2',\r\n          name: 'Our Company',\r\n          email: 'contracts@ourcompany.com',\r\n          role: 'internal',\r\n          signature_required: true\r\n        }\r\n      ],\r\n      value: 0,\r\n      total_value: 0,\r\n      currency: 'USD',\r\n      start_date: '2024-02-01',\r\n      end_date: '2026-02-01',\r\n      auto_renew: false,\r\n      renewal_terms: 'Manual renewal required',\r\n      approval_stage: 'legal_review',\r\n      created_by: '2',\r\n      assigned_to: '3',\r\n      tenant_id: 'tenant_1',\r\n      content: 'Non-disclosure agreement for manufacturing partnership...',\r\n      template_id: '2',\r\n      version: 1,\r\n      tags: ['nda', 'manufacturing', 'partnership'],\r\n      priority: 'medium',\r\n      reminder_days: [30, 7],\r\n      compliance_status: 'pending_review',\r\n      attachments: [],\r\n      approval_history: [\r\n        {\r\n          id: '1',\r\n          stage: 'legal_review',\r\n          approver: '3',\r\n          approver_name: 'Legal Team',\r\n          status: 'pending',\r\n          timestamp: '2024-01-25T10:00:00Z'\r\n        }\r\n      ],\r\n      signature_status: {\r\n        total_required: 2,\r\n        completed: 0,\r\n        pending: ['legal@globalmanuf.com', 'contracts@ourcompany.com']\r\n      },\r\n      created_at: '2024-01-25T09:00:00Z',\r\n      updated_at: '2024-01-25T09:00:00Z'\r\n    },\r\n    {\r\n      id: '3',\r\n      title: 'Office Equipment Purchase Order',\r\n      type: 'purchase_order',\r\n      status: 'draft',\r\n      parties: [\r\n        {\r\n          id: '1',\r\n          name: 'Office Supplies Co',\r\n          email: 'sales@officesupplies.com',\r\n          role: 'vendor',\r\n          signature_required: true\r\n        }\r\n      ],\r\n      value: 25000,\r\n      total_value: 25000,\r\n      currency: 'USD',\r\n      start_date: '2024-02-15',\r\n      end_date: '2024-03-15',\r\n      auto_renew: false,\r\n      renewal_terms: 'One-time purchase',\r\n      approval_stage: 'draft',\r\n      created_by: '3',\r\n      assigned_to: '3',\r\n      tenant_id: 'tenant_1',\r\n      content: 'Purchase order for office equipment and supplies...',\r\n      template_id: '3',\r\n      version: 1,\r\n      tags: ['purchase', 'office', 'equipment'],\r\n      priority: 'low',\r\n      reminder_days: [7],\r\n      compliance_status: 'pending_review',\r\n      attachments: [],\r\n      approval_history: [],\r\n      signature_status: {\r\n        total_required: 1,\r\n        completed: 0,\r\n        pending: ['sales@officesupplies.com']\r\n      },\r\n      created_at: '2024-01-28T14:00:00Z',\r\n      updated_at: '2024-01-28T14:00:00Z'\r\n    },\r\n    {\r\n      id: '4',\r\n      title: 'Consulting Services Agreement',\r\n      type: 'service_agreement',\r\n      status: 'expired',\r\n      parties: [\r\n        {\r\n          id: '1',\r\n          name: 'StartupXYZ',\r\n          email: 'legal@startupxyz.com',\r\n          role: 'client',\r\n          signature_required: true,\r\n          signed_at: '2023-06-01T10:00:00Z',\r\n          signature_url: '/signatures/startupxyz-signature.png'\r\n        }\r\n      ],\r\n      value: 50000,\r\n      total_value: 50000,\r\n      currency: 'USD',\r\n      start_date: '2023-06-01',\r\n      end_date: '2024-01-01',\r\n      auto_renew: false,\r\n      renewal_terms: 'Manual renewal required',\r\n      approval_stage: 'approved',\r\n      signed_date: '2023-06-01T10:00:00Z',\r\n      created_by: '2',\r\n      assigned_to: '2',\r\n      tenant_id: 'tenant_1',\r\n      content: 'Consulting services agreement content...',\r\n      template_id: '1',\r\n      version: 1,\r\n      tags: ['consulting', 'startup', 'expired'],\r\n      priority: 'medium',\r\n      reminder_days: [30, 7],\r\n      compliance_status: 'compliant',\r\n      attachments: [],\r\n      approval_history: [\r\n        {\r\n          id: '1',\r\n          stage: 'manager_review',\r\n          approver: '2',\r\n          approver_name: 'Project Manager',\r\n          status: 'approved',\r\n          timestamp: '2023-05-25T10:00:00Z'\r\n        }\r\n      ],\r\n      signature_status: {\r\n        total_required: 1,\r\n        completed: 1,\r\n        pending: [],\r\n        last_signed_at: '2023-06-01T10:00:00Z'\r\n      },\r\n      created_at: '2023-05-20T09:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    }\r\n  ];\r\n\r\n  async getContracts(filters?: ContractFilters & { page?: number; pageSize?: number }): Promise<any> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    const page = filters?.page || 1;\r\n    const pageSize = filters?.pageSize || 20;\r\n\r\n    let contracts = this.mockContracts.filter(c => c.tenant_id === user.tenant_id);\r\n\r\n    // Apply role-based filtering\r\n    if (user.role === 'agent') {\r\n      contracts = contracts.filter(c => c.assigned_to === user.id || c.created_by === user.id);\r\n    }\r\n\r\n    // Apply filters\r\n    if (filters) {\r\n      if (filters.status) {\r\n        contracts = contracts.filter(c => c.status === filters.status);\r\n      }\r\n      if (filters.type) {\r\n        contracts = contracts.filter(c => c.type === filters.type);\r\n      }\r\n      if (filters.customer_id) {\r\n        contracts = contracts.filter(c => c.customer_id === filters.customer_id);\r\n      }\r\n      if (filters.assigned_to) {\r\n        contracts = contracts.filter(c => c.assigned_to === filters.assigned_to);\r\n      }\r\n      if (filters.priority) {\r\n        contracts = contracts.filter(c => c.priority === filters.priority);\r\n      }\r\n      if (filters.auto_renew !== undefined) {\r\n        contracts = contracts.filter(c => c.auto_renew === filters.auto_renew);\r\n      }\r\n      if (filters.compliance_status) {\r\n        contracts = contracts.filter(c => c.compliance_status === filters.compliance_status);\r\n      }\r\n      if (filters.date_from && filters.date_to) {\r\n        contracts = contracts.filter(c => {\r\n          const startDate = new Date(c.start_date);\r\n          const filterStart = new Date(filters.date_from!);\r\n          const filterEnd = new Date(filters.date_to!);\r\n          return startDate >= filterStart && startDate <= filterEnd;\r\n        });\r\n      }\r\n      if (filters.value_min !== undefined && filters.value_max !== undefined) {\r\n        contracts = contracts.filter(c => \r\n          c.value >= filters.value_min! && c.value <= filters.value_max!\r\n        );\r\n      }\r\n      if (filters.tags && filters.tags.length > 0) {\r\n        contracts = contracts.filter(c => \r\n          filters.tags!.some(tag => c.tags.includes(tag))\r\n        );\r\n      }\r\n      if (filters.expiring_soon) {\r\n        const now = new Date();\r\n        const thirtyDaysLater = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n        contracts = contracts.filter(c => {\r\n          const endDate = new Date(c.end_date);\r\n          return endDate > now && endDate <= thirtyDaysLater;\r\n        });\r\n      }\r\n      if (filters.search) {\r\n        const search = filters.search.toLowerCase();\r\n        contracts = contracts.filter(c => \r\n          c.title.toLowerCase().includes(search) ||\r\n          c.content?.toLowerCase().includes(search) ||\r\n          c.parties.some(p => p.name.toLowerCase().includes(search)) ||\r\n          c.tags.some(tag => tag.toLowerCase().includes(search))\r\n        );\r\n      }\r\n    }\r\n\r\n    // Apply pagination\r\n    const total = contracts.length;\r\n    const totalPages = Math.ceil(total / pageSize);\r\n    const offset = (page - 1) * pageSize;\r\n    const paginatedContracts = contracts.slice(offset, offset + pageSize);\r\n\r\n    // Return paginated response\r\n    return {\r\n      data: paginatedContracts,\r\n      page,\r\n      pageSize,\r\n      total,\r\n      totalPages,\r\n    };\r\n  }\r\n\r\n  async getContract(id: string): Promise<Contract> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    const contract = this.mockContracts.find(c => \r\n      c.id === id && c.tenant_id === user.tenant_id\r\n    );\r\n\r\n    if (!contract) {\r\n      throw new Error('Contract not found');\r\n    }\r\n\r\n    // Check permissions\r\n    if (user.role === 'agent' && contract.assigned_to !== user.id && contract.created_by !== user.id) {\r\n      throw new Error('Access denied');\r\n    }\r\n\r\n    return contract;\r\n  }\r\n\r\n  async createContract(contractData: Omit<Contract, 'id' | 'tenant_id' | 'created_at' | 'updated_at' | 'version' | 'approvalHistory' | 'signatureStatus'>): Promise<Contract> {\r\n    await new Promise(resolve => setTimeout(resolve, 800));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    if (!authService.hasPermission('write')) {\r\n      throw new Error('Insufficient permissions');\r\n    }\r\n\r\n    const newContract: Contract = {\r\n      ...contractData,\r\n      id: Date.now().toString(),\r\n      tenant_id: user.tenant_id,\r\n      version: 1,\r\n      approval_history: [],\r\n      signature_status: {\r\n        total_required: contractData.parties.filter(p => p.signature_required).length,\r\n        completed: 0,\r\n        pending: contractData.parties.filter(p => p.signature_required).map(p => p.email)\r\n      },\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    this.mockContracts.push(newContract);\r\n    return newContract;\r\n  }\r\n\r\n  async updateContract(id: string, updates: Partial<Contract>): Promise<Contract> {\r\n    await new Promise(resolve => setTimeout(resolve, 600));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    if (!authService.hasPermission('write')) {\r\n      throw new Error('Insufficient permissions');\r\n    }\r\n\r\n    const contractIndex = this.mockContracts.findIndex(c => \r\n      c.id === id && c.tenant_id === user.tenant_id\r\n    );\r\n\r\n    if (contractIndex === -1) {\r\n      throw new Error('Contract not found');\r\n    }\r\n\r\n    // Check permissions\r\n    if (user.role === 'agent' && \r\n        this.mockContracts[contractIndex].assigned_to !== user.id && \r\n        this.mockContracts[contractIndex].created_by !== user.id) {\r\n      throw new Error('Access denied');\r\n    }\r\n\r\n    this.mockContracts[contractIndex] = {\r\n      ...this.mockContracts[contractIndex],\r\n      ...updates,\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    return this.mockContracts[contractIndex];\r\n  }\r\n\r\n  async deleteContract(id: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 400));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    if (!authService.hasPermission('delete')) {\r\n      throw new Error('Insufficient permissions');\r\n    }\r\n\r\n    const contractIndex = this.mockContracts.findIndex(c => \r\n      c.id === id && c.tenant_id === user.tenant_id\r\n    );\r\n\r\n    if (contractIndex === -1) {\r\n      throw new Error('Contract not found');\r\n    }\r\n\r\n    this.mockContracts.splice(contractIndex, 1);\r\n  }\r\n\r\n  async getTemplates(): Promise<ContractTemplate[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    return this.mockTemplates.filter(t => t.is_active);\r\n  }\r\n\r\n  async getTemplate(id: string): Promise<ContractTemplate> {\r\n    await new Promise(resolve => setTimeout(resolve, 200));\r\n    \r\n    const template = this.mockTemplates.find(t => t.id === id);\r\n    if (!template) {\r\n      throw new Error('Template not found');\r\n    }\r\n    \r\n    return template;\r\n  }\r\n\r\n  async approveContract(id: string, stage: string, comments?: string): Promise<Contract> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    const contract = await this.getContract(id);\r\n    \r\n    const approvalRecord: ApprovalRecord = {\r\n      id: Date.now().toString(),\r\n      stage,\r\n      approver: user.id,\r\n      approver_name: user.name,\r\n      status: 'approved',\r\n      comments,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    const updatedContract = await this.updateContract(id, {\r\n      approval_history: [...contract.approval_history, approvalRecord],\r\n      approval_stage: stage === 'final_approval' ? 'approved' : 'pending_approval',\r\n      status: stage === 'final_approval' ? 'active' : contract.status\r\n    });\r\n\r\n    return updatedContract;\r\n  }\r\n\r\n  async rejectContract(id: string, stage: string, comments: string): Promise<Contract> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    const contract = await this.getContract(id);\r\n    \r\n    const approvalRecord: ApprovalRecord = {\r\n      id: Date.now().toString(),\r\n      stage,\r\n      approver: user.id,\r\n      approver_name: user.name,\r\n      status: 'rejected',\r\n      comments,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    const updatedContract = await this.updateContract(id, {\r\n      approval_history: [...contract.approval_history, approvalRecord],\r\n      approval_stage: 'rejected',\r\n      status: 'draft'\r\n    });\r\n\r\n    return updatedContract;\r\n  }\r\n\r\n  async requestSignature(contractId: string, signerEmail: string): Promise<DigitalSignature> {\r\n    await new Promise(resolve => setTimeout(resolve, 600));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    const signature: DigitalSignature = {\r\n      id: Date.now().toString(),\r\n      contract_id: contractId,\r\n      signer_id: 'external',\r\n      signer_name: 'External Signer',\r\n      signer_email: signerEmail,\r\n      signature_url: '',\r\n      ip_address: '192.168.1.1',\r\n      timestamp: new Date().toISOString(),\r\n      status: 'pending',\r\n      verification_code: Math.random().toString(36).substring(2, 8).toUpperCase()\r\n    };\r\n\r\n    return signature;\r\n  }\r\n\r\n  async getAnalytics(): Promise<ContractAnalytics> {\r\n    await new Promise(resolve => setTimeout(resolve, 400));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    let contracts = this.mockContracts.filter(c => c.tenant_id === user.tenant_id);\r\n\r\n    // Apply role-based filtering\r\n    if (user.role === 'agent') {\r\n      contracts = contracts.filter(c => c.assigned_to === user.id || c.created_by === user.id);\r\n    }\r\n\r\n    const total_contracts = contracts.length;\r\n    const active_contracts = contracts.filter(c => c.status === 'active').length;\r\n    const pending_approvals = contracts.filter(c => c.status === 'pending_approval').length;\r\n    const expiring_contracts = contracts.filter(c => {\r\n      const endDate = new Date(c.end_date);\r\n      const now = new Date();\r\n      const diffTime = endDate.getTime() - now.getTime();\r\n      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n      return diffDays <= 30 && diffDays > 0;\r\n    }).length;\r\n\r\n    const total_value = contracts.reduce((sum, c) => sum + c.value, 0);\r\n    const average_approval_time = 3.5; // Mock average in days\r\n    const renewal_rate = 85; // Mock percentage\r\n    const compliance_rate = 92; // Mock percentage\r\n\r\n    const status_distribution = [\r\n      { status: 'active', count: active_contracts, percentage: (active_contracts / total_contracts) * 100 },\r\n      { status: 'draft', count: contracts.filter(c => c.status === 'draft').length, percentage: (contracts.filter(c => c.status === 'draft').length / total_contracts) * 100 },\r\n      { status: 'pending_approval', count: pending_approvals, percentage: (pending_approvals / total_contracts) * 100 },\r\n      { status: 'expired', count: contracts.filter(c => c.status === 'expired').length, percentage: (contracts.filter(c => c.status === 'expired').length / total_contracts) * 100 }\r\n    ];\r\n\r\n    const type_distribution = [\r\n      { type: 'service_agreement', count: contracts.filter(c => c.type === 'service_agreement').length, value: contracts.filter(c => c.type === 'service_agreement').reduce((sum, c) => sum + c.value, 0) },\r\n      { type: 'nda', count: contracts.filter(c => c.type === 'nda').length, value: contracts.filter(c => c.type === 'nda').reduce((sum, c) => sum + c.value, 0) },\r\n      { type: 'purchase_order', count: contracts.filter(c => c.type === 'purchase_order').length, value: contracts.filter(c => c.type === 'purchase_order').reduce((sum, c) => sum + c.value, 0) }\r\n    ];\r\n\r\n    const monthly_stats = [\r\n      { month: 'Jan 2024', created: 2, signed: 1, expired: 0, value: 175000 },\r\n      { month: 'Feb 2024', created: 1, signed: 0, expired: 1, value: 25000 },\r\n      { month: 'Mar 2024', created: 0, signed: 1, expired: 0, value: 0 }\r\n    ];\r\n\r\n    return {\r\n      total_contracts,\r\n      active_contracts,\r\n      pending_approvals,\r\n      expiring_contracts,\r\n      total_value,\r\n      average_approval_time,\r\n      renewal_rate,\r\n      compliance_rate,\r\n      monthly_stats,\r\n      status_distribution,\r\n      type_distribution\r\n    };\r\n  }\r\n\r\n\r\n\r\n  async toggleAutoRenewal(contractId: string, autoRenew: boolean): Promise<Contract> {\r\n    return this.updateContract(contractId, { auto_renew: autoRenew });\r\n  }\r\n\r\n  async getContractTypes(): Promise<string[]> {\r\n    return ['service_agreement', 'nda', 'purchase_order', 'employment', 'custom'];\r\n  }\r\n\r\n  async getContractStatuses(): Promise<string[]> {\r\n    return ['draft', 'pending_approval', 'active', 'renewed', 'expired'];\r\n  }\r\n\r\n  async getPriorities(): Promise<string[]> {\r\n    return ['low', 'medium', 'high', 'urgent'];\r\n  }\r\n\r\n  async getComplianceStatuses(): Promise<string[]> {\r\n    return ['compliant', 'non_compliant', 'pending_review'];\r\n  }\r\n\r\n  // Interface compliance methods - aliases for existing methods\r\n  async getContractAnalytics(): Promise<Record<string, unknown>> {\r\n    return this.getAnalytics();\r\n  }\r\n\r\n  // Template Management Methods\r\n  async createTemplate(templateData: Omit<ContractTemplate, 'id' | 'created_at' | 'updated_at'>): Promise<ContractTemplate> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const newTemplate: ContractTemplate = {\r\n      ...templateData,\r\n      id: Date.now().toString(),\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    this.mockTemplates.push(newTemplate);\r\n    return newTemplate;\r\n  }\r\n\r\n  async updateTemplate(id: string, templateData: Partial<ContractTemplate>): Promise<ContractTemplate> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const index = this.mockTemplates.findIndex(t => t.id === id);\r\n    if (index === -1) {\r\n      throw new Error('Template not found');\r\n    }\r\n\r\n    this.mockTemplates[index] = {\r\n      ...this.mockTemplates[index],\r\n      ...templateData,\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    return this.mockTemplates[index];\r\n  }\r\n\r\n  async deleteTemplate(id: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    const index = this.mockTemplates.findIndex(t => t.id === id);\r\n    if (index === -1) {\r\n      throw new Error('Template not found');\r\n    }\r\n\r\n    this.mockTemplates.splice(index, 1);\r\n  }\r\n\r\n  // Digital Signature Methods\r\n  async getSignatures(contractId: string): Promise<DigitalSignature[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock signatures data\r\n    return [\r\n      {\r\n        id: '1',\r\n        contract_id: contractId,\r\n        signer_id: 'user1',\r\n        signer_name: 'John Doe',\r\n        signer_email: 'john@example.com',\r\n        signature_url: '/signatures/signature1.png',\r\n        ip_address: '192.168.1.100',\r\n        timestamp: new Date().toISOString(),\r\n        status: 'completed',\r\n        verification_code: 'ABC123'\r\n      }\r\n    ];\r\n  }\r\n\r\n  async signContract(contractId: string, signatureData: { signature: string; comments?: string }): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 800));\r\n    // Mock implementation\r\n  }\r\n\r\n  async resendSignatureRequest(signatureId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    // Mock implementation\r\n  }\r\n\r\n  async cancelSignatureRequest(signatureId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    // Mock implementation\r\n  }\r\n\r\n  // Document Generation Methods\r\n  async generateContractPreview(templateId: string, variables: Record<string, string>): Promise<string> {\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n    const template = await this.getTemplate(templateId);\r\n    let content = template.content;\r\n\r\n    // Replace variables\r\n    Object.entries(variables).forEach(([key, value]) => {\r\n      const regex = new RegExp(`{{${key}}}`, 'g');\r\n      content = content.replace(regex, value);\r\n    });\r\n\r\n    return content;\r\n  }\r\n\r\n  async generateContractDocument(contractId: string, templateId: string, variables: Record<string, string>): Promise<string> {\r\n    await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n    // Mock PDF generation\r\n    const documentUrl = `/api/contracts/${contractId}/document.pdf`;\r\n    return documentUrl;\r\n  }\r\n\r\n  async getContractDocument(contractId: string): Promise<{ url: string } | null> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock existing document check\r\n    return Math.random() > 0.5 ? { url: `/api/contracts/${contractId}/document.pdf` } : null;\r\n  }\r\n\r\n  // Contract Versioning Methods\r\n  async getContractVersions(contractId: string): Promise<Record<string, unknown>[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock versions data\r\n    return [\r\n      {\r\n        id: '1',\r\n        version: 1,\r\n        title: 'Initial Contract',\r\n        description: 'First version of the contract',\r\n        changes: 'Initial contract creation',\r\n        created_by: 'user1',\r\n        created_by_name: 'John Doe',\r\n        created_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),\r\n        status: 'archived',\r\n        document_url: `/api/contracts/${contractId}/v1.pdf`,\r\n        is_current_version: false\r\n      },\r\n      {\r\n        id: '2',\r\n        version: 2,\r\n        title: 'Updated Terms',\r\n        description: 'Updated payment terms and conditions',\r\n        changes: 'Modified payment schedule and added new clauses',\r\n        created_by: 'user2',\r\n        created_by_name: 'Jane Smith',\r\n        created_at: new Date().toISOString(),\r\n        status: 'active',\r\n        document_url: `/api/contracts/${contractId}/v2.pdf`,\r\n        is_current_version: true\r\n      }\r\n    ];\r\n  }\r\n\r\n  async createContractVersion(versionData: Omit<ContractVersion, 'id' | 'created_at'>): Promise<ContractVersion> {\r\n    await new Promise(resolve => setTimeout(resolve, 800));\r\n    // Mock implementation\r\n    return {\r\n      id: Date.now().toString(),\r\n      version: 3,\r\n      ...versionData,\r\n      created_at: new Date().toISOString(),\r\n      status: 'draft',\r\n      is_current_version: false\r\n    };\r\n  }\r\n\r\n  async activateContractVersion(contractId: string, versionId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    // Mock implementation\r\n  }\r\n\r\n  async archiveContractVersion(versionId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    // Mock implementation\r\n  }\r\n\r\n  // Compliance Tracking Methods\r\n  async getComplianceItems(contractId: string): Promise<ComplianceItem[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock compliance items\r\n    return [\r\n      {\r\n        id: '1',\r\n        title: 'GDPR Compliance Review',\r\n        description: 'Ensure contract complies with GDPR requirements',\r\n        category: 'regulatory',\r\n        status: 'compliant',\r\n        priority: 'high',\r\n        due_date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n        assigned_to: 'user1',\r\n        assigned_to_name: 'Legal Team',\r\n        evidence: 'GDPR compliance checklist completed',\r\n        notes: 'All data processing clauses reviewed and approved',\r\n        created_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        created_by: 'user2',\r\n        created_by_name: 'Jane Smith'\r\n      },\r\n      {\r\n        id: '2',\r\n        title: 'Financial Audit Requirements',\r\n        description: 'Verify financial terms meet audit standards',\r\n        category: 'financial',\r\n        status: 'pending_review',\r\n        priority: 'medium',\r\n        due_date: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n        assigned_to: 'user3',\r\n        assigned_to_name: 'Finance Team',\r\n        evidence: '',\r\n        notes: 'Waiting for finance team review',\r\n        created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        created_by: 'user1',\r\n        created_by_name: 'John Doe'\r\n      }\r\n    ];\r\n  }\r\n\r\n  async createComplianceItem(itemData: Omit<ComplianceItem, 'id' | 'created_at' | 'updated_at' | 'created_by' | 'created_by_name'>): Promise<ComplianceItem> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const user = authService.getCurrentUser();\r\n    return {\r\n      id: Date.now().toString(),\r\n      ...itemData,\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString(),\r\n      created_by: user?.id || '',\r\n      created_by_name: user?.name || ''\r\n    };\r\n  }\r\n\r\n  async updateComplianceItem(itemId: string, itemData: Partial<Omit<ComplianceItem, 'id' | 'created_at' | 'created_by' | 'created_by_name'>>): Promise<ComplianceItem> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    // Mock implementation\r\n    return {\r\n      id: itemId,\r\n      title: itemData.title || '',\r\n      description: itemData.description || '',\r\n      category: itemData.category || 'other',\r\n      status: itemData.status || 'pending_review',\r\n      priority: itemData.priority || 'medium',\r\n      due_date: itemData.due_date || new Date().toISOString(),\r\n      assigned_to: itemData.assigned_to || '',\r\n      assigned_to_name: itemData.assigned_to_name || '',\r\n      evidence: itemData.evidence || '',\r\n      notes: itemData.notes || '',\r\n      updated_at: new Date().toISOString(),\r\n      created_at: new Date().toISOString(),\r\n      created_by: '',\r\n      created_by_name: ''\r\n    };\r\n  }\r\n\r\n  async deleteComplianceItem(itemId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    // Mock implementation\r\n  }\r\n\r\n  // Renewal Management Methods\r\n  async getRenewalReminders(contractId: string): Promise<RenewalReminder[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock renewal reminders\r\n    return [\r\n      {\r\n        id: '1',\r\n        contract_id: contractId,\r\n        contract_title: 'Sample Contract',\r\n        reminder_date: new Date().toISOString(),\r\n        days_until_expiry: 30,\r\n        status: 'pending',\r\n        recipients: ['manager@company.com', 'legal@company.com'],\r\n        message: 'Contract renewal required in 30 days',\r\n        created_at: new Date().toISOString()\r\n      },\r\n      {\r\n        id: '2',\r\n        contract_id: contractId,\r\n        contract_title: 'Sample Contract',\r\n        reminder_date: new Date().toISOString(),\r\n        days_until_expiry: 7,\r\n        status: 'sent',\r\n        recipients: ['manager@company.com'],\r\n        message: 'Urgent: Contract expires in 7 days',\r\n        created_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()\r\n      }\r\n    ];\r\n  }\r\n\r\n  async createRenewalReminder(contractId: string, reminderData: Omit<RenewalReminder, 'id' | 'created_at'>): Promise<RenewalReminder> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    return {\r\n      id: Date.now().toString(),\r\n      contract_id: contractId,\r\n      ...reminderData,\r\n      created_at: new Date().toISOString()\r\n    };\r\n  }\r\n\r\n  async deleteRenewalReminder(reminderId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    // Mock implementation\r\n  }\r\n\r\n  async renewContract(contractId: string, renewalData: Partial<Contract>): Promise<Contract> {\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n    // Mock contract renewal\r\n    return {\r\n      id: Date.now().toString(),\r\n      title: renewalData.title || '',\r\n      description: renewalData.description,\r\n      type: renewalData.type || 'service_agreement',\r\n      status: 'active',\r\n      customer_id: renewalData.customer_id || '',\r\n      parties: renewalData.parties || [],\r\n      value: renewalData.value || 0,\r\n      total_value: renewalData.total_value || renewalData.value || 0,\r\n      currency: renewalData.currency || 'USD',\r\n      start_date: renewalData.start_date || new Date().toISOString().split('T')[0],\r\n      end_date: renewalData.end_date || '',\r\n      auto_renew: renewalData.auto_renew || false,\r\n      approval_history: renewalData.approval_history || [],\r\n      compliance_status: renewalData.compliance_status || 'pending_review',\r\n      created_by: renewalData.created_by || '',\r\n      tags: renewalData.tags || [],\r\n      priority: renewalData.priority || 'medium',\r\n      reminder_days: renewalData.reminder_days || [],\r\n      signature_status: renewalData.signature_status || { total_required: 0, completed: 0, pending: [] },\r\n      attachments: renewalData.attachments || [],\r\n      tenant_id: renewalData.tenant_id || '',\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString(),\r\n      version: renewalData.version || 1\r\n    };\r\n  }\r\n\r\n  // Audit Trail Methods\r\n  async getAuditTrail(contractId: string, filters: AuditTrailFilters = {}): Promise<AuditTrailEntry[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock audit trail data\r\n    const mockEntries: AuditTrailEntry[] = [\r\n      {\r\n        id: '1',\r\n        action: 'Contract Created',\r\n        action_type: 'create',\r\n        description: 'Contract was created with initial terms',\r\n        user_id: 'user1',\r\n        user_name: 'John Doe',\r\n        user_role: 'Contract Manager',\r\n        timestamp: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),\r\n        ip_address: '192.168.1.100',\r\n        user_agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\r\n        changes: [\r\n          { field: 'title', old_value: null, new_value: 'Service Agreement' },\r\n          { field: 'value', old_value: null, new_value: 50000 }\r\n        ]\r\n      },\r\n      {\r\n        id: '2',\r\n        action: 'Contract Updated',\r\n        action_type: 'update',\r\n        description: 'Payment terms were modified',\r\n        user_id: 'user2',\r\n        user_name: 'Jane Smith',\r\n        user_role: 'Legal Advisor',\r\n        timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),\r\n        ip_address: '192.168.1.101',\r\n        changes: [\r\n          { field: 'payment_terms', old_value: 'Net 30', new_value: 'Net 15' }\r\n        ]\r\n      },\r\n      {\r\n        id: '3',\r\n        action: 'Contract Signed',\r\n        action_type: 'sign',\r\n        description: 'Contract was digitally signed by customer',\r\n        user_id: 'customer1',\r\n        user_name: 'Customer Rep',\r\n        user_role: 'Customer',\r\n        timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),\r\n        ip_address: '203.0.113.1'\r\n      }\r\n    ];\r\n\r\n    // Apply filters\r\n    let filteredEntries = mockEntries;\r\n\r\n    if (filters.action_type) {\r\n      filteredEntries = filteredEntries.filter(e => e.action_type === filters.action_type as AuditTrailEntry['action_type']);\r\n    }\r\n\r\n    if (filters.search_term) {\r\n      filteredEntries = filteredEntries.filter(e =>\r\n        e.action.toLowerCase().includes(filters.search_term!.toLowerCase()) ||\r\n        e.description.toLowerCase().includes(filters.search_term!.toLowerCase())\r\n      );\r\n    }\r\n\r\n    return filteredEntries;\r\n  }\r\n\r\n  async exportAuditTrail(contractId: string, filters: AuditTrailFilters = {}): Promise<string> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    const entries = await this.getAuditTrail(contractId, filters);\r\n\r\n    // Generate CSV content\r\n    const headers = ['Timestamp', 'Action', 'User', 'Role', 'Description', 'IP Address'];\r\n    const csvContent = [\r\n      headers.join(','),\r\n      ...entries.map(entry => [\r\n        entry.timestamp,\r\n        entry.action,\r\n        entry.user_name,\r\n        entry.user_role,\r\n        `\"${entry.description}\"`,\r\n        entry.ip_address || ''\r\n      ].join(','))\r\n    ].join('\\r\\n');\r\n\r\n    return csvContent;\r\n  }\r\n\r\n  // Approval Workflow Methods\r\n  async getApprovalWorkflow(contractId: string): Promise<ApprovalWorkflowStep[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock approval workflow\r\n    return [\r\n      {\r\n        id: '1',\r\n        stepNumber: 1,\r\n        title: 'Legal Review',\r\n        description: 'Review contract for legal compliance',\r\n        approverRole: 'Legal Team',\r\n        approverName: 'Legal Department',\r\n        approverId: 'legal1',\r\n        status: 'approved',\r\n        isRequired: true,\r\n        approvedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),\r\n        comments: 'Legal terms reviewed and approved',\r\n        canApprove: false\r\n      },\r\n      {\r\n        id: '2',\r\n        stepNumber: 2,\r\n        title: 'Financial Approval',\r\n        description: 'Approve contract value and payment terms',\r\n        approverRole: 'Finance Manager',\r\n        approverName: 'Finance Team',\r\n        approverId: 'finance1',\r\n        status: 'pending',\r\n        isRequired: true,\r\n        canApprove: true\r\n      },\r\n      {\r\n        id: '3',\r\n        stepNumber: 3,\r\n        title: 'Executive Approval',\r\n        description: 'Final executive approval for high-value contracts',\r\n        approverRole: 'Executive',\r\n        approverName: 'CEO',\r\n        approverId: 'exec1',\r\n        status: 'pending',\r\n        isRequired: false,\r\n        canApprove: false\r\n      }\r\n    ];\r\n  }\r\n\r\n  async getApprovalRecords(contractId: string): Promise<ApprovalRecord[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock approval records\r\n    return [\r\n      {\r\n        id: '1',\r\n        stage: 'Legal Review',\r\n        approver: 'legal1',\r\n        approverName: 'Legal Department',\r\n        status: 'approved',\r\n        comments: 'All legal requirements met. Contract approved.',\r\n        timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()\r\n      }\r\n    ];\r\n  }\r\n\r\n  async approveContractStep(contractId: string, stepId: string, approvalData: ApprovalData): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    // Mock implementation\r\n  }\r\n\r\n  async rejectContractStep(contractId: string, stepId: string, rejectionData: RejectionData): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    // Mock implementation\r\n  }\r\n\r\n  async requestContractApproval(contractId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    // Mock implementation\r\n  }\r\n\r\n  // Attachment Management Methods\r\n  async getContractAttachments(contractId: string): Promise<ContractAttachmentDetail[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    // Mock attachments\r\n    return [\r\n      {\r\n        id: '1',\r\n        fileName: 'contract_v1.pdf',\r\n        originalName: 'Service Agreement v1.pdf',\r\n        fileSize: 2048576, // 2MB\r\n        fileType: 'application/pdf',\r\n        category: 'contract_document',\r\n        description: 'Main contract document',\r\n        uploadedBy: 'user1',\r\n        uploadedByName: 'John Doe',\r\n        uploadedAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),\r\n        downloadUrl: `/api/contracts/${contractId}/attachments/contract_v1.pdf`,\r\n        previewUrl: `/api/contracts/${contractId}/attachments/contract_v1.pdf/preview`,\r\n        isPublic: false,\r\n        version: 1\r\n      },\r\n      {\r\n        id: '2',\r\n        fileName: 'supporting_docs.zip',\r\n        originalName: 'Supporting Documents.zip',\r\n        fileSize: 5242880, // 5MB\r\n        fileType: 'application/zip',\r\n        category: 'supporting_document',\r\n        description: 'Additional supporting documentation',\r\n        uploadedBy: 'user2',\r\n        uploadedByName: 'Jane Smith',\r\n        uploadedAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),\r\n        downloadUrl: `/api/contracts/${contractId}/attachments/supporting_docs.zip`,\r\n        isPublic: true\r\n      }\r\n    ];\r\n  }\r\n\r\n  async uploadContractAttachment(contractId: string, attachmentData: AttachmentUploadData): Promise<ContractAttachmentDetail[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n    // Mock file upload\r\n    return attachmentData.files.map((file: File) => ({\r\n      id: Date.now().toString() + Math.random(),\r\n      fileName: file.name.replace(/[^a-zA-Z0-9.-]/g, '_'),\r\n      originalName: file.name,\r\n      fileSize: file.size,\r\n      fileType: file.type,\r\n      category: attachmentData.category,\r\n      description: attachmentData.description,\r\n      uploadedBy: 'current_user',\r\n      uploadedByName: 'Current User',\r\n      uploadedAt: new Date().toISOString(),\r\n      downloadUrl: `/api/contracts/${contractId}/attachments/${file.name}`,\r\n      isPublic: attachmentData.isPublic\r\n    }));\r\n  }\r\n\r\n  async deleteContractAttachment(attachmentId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    // Mock implementation\r\n  }\r\n\r\n  /**\r\n   * Get contract statistics\r\n   * Returns aggregated stats for dashboard/state card display\r\n   */\r\n  async getContractStats(filters?: ContractFilters): Promise<{\r\n    total: number;\r\n    active: number;\r\n    expiring: number;\r\n    totalValue: number;\r\n    byStatus: Record<string, number>;\r\n    byType: Record<string, number>;\r\n  }> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n    const user = authService.getCurrentUser();\r\n    if (!user) throw new Error('Unauthorized');\r\n\r\n    // Get contracts using the paginated getContracts method\r\n    const contractsResponse = await this.getContracts(filters);\r\n    const contracts = contractsResponse.data || [];\r\n    \r\n    // Get expiring contracts\r\n    const expiringContracts = contracts.filter(c => {\r\n      const endDate = new Date(c.end_date);\r\n      const now = new Date();\r\n      const threshold = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n      return endDate <= threshold && endDate >= now;\r\n    });\r\n\r\n    // Build statistics\r\n    const stats = {\r\n      total: contracts.length,\r\n      active: contracts.filter((c) => c.status === 'active').length,\r\n      expiring: expiringContracts.length,\r\n      totalValue: contracts.reduce((sum, c) => sum + (c.value || 0), 0),\r\n      byStatus: {} as Record<string, number>,\r\n      byType: {} as Record<string, number>,\r\n    };\r\n\r\n    // Count by status and type\r\n    contracts.forEach((c) => {\r\n      stats.byStatus[c.status] = (stats.byStatus[c.status] || 0) + 1;\r\n      stats.byType[c.type] = (stats.byType[c.type] || 0) + 1;\r\n    });\r\n\r\n    return stats;\r\n  }\r\n}\r\n\r\nexport const contractService = new ContractService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\customerService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\dashboardService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\errorHandler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\fileService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6587,6590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6587,6590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8470,8473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8470,8473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8812,8815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8812,8815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Index - Central Service Layer Hub\r\n * \r\n * PHASE 4: UNIFIED MULTI-BACKEND SERVICE LAYER\r\n * ============================================\r\n * \r\n * ARCHITECTURE:\r\n * =============\r\n * This file provides a unified interface for all services in the application\r\n * with seamless switching between TWO backend systems:\r\n * \r\n * 1. MOCK/STATIC DATA (src/services/*Service.ts)\r\n *    - Development and testing with static data\r\n *    - Set: VITE_API_MODE=mock or VITE_USE_MOCK_API=true\r\n * \r\n * 2. SUPABASE POSTGRESQL (src/services/supabase/*Service.ts - Phase 3)\r\n *    - Modern PostgreSQL with real-time capabilities\r\n *    - Multi-tenant with Row-Level Security\r\n *    - Set: VITE_API_MODE=supabase\r\n *    - Requires: Supabase local/cloud setup\r\n * \r\n * NOTE: .NET Core Backend (.NET) was planned but never implemented.\r\n *       Legacy placeholder files archived to: MARK_FOR_DELETE/legacy_services_real/\r\n * \r\n * SWITCHING BACKENDS:\r\n * ===================\r\n * 1. GLOBAL MODE - All services use same backend:\r\n *    Set in .env: VITE_API_MODE=mock|real|supabase\r\n * \r\n * 2. PER-SERVICE OVERRIDE - Mix backends as needed:\r\n *    Set in .env: \r\n *      VITE_API_MODE=real\r\n *      VITE_CUSTOMER_BACKEND=supabase  # Use Supabase for customers only\r\n *      VITE_SALES_BACKEND=supabase     # Use Supabase for sales only\r\n * \r\n * BACKWARD COMPATIBILITY:\r\n * ======================\r\n * Legacy VITE_USE_MOCK_API=true|false still works\r\n * But VITE_API_MODE takes precedence if set\r\n * \r\n * USAGE:\r\n * ======\r\n * Always import from this file:\r\n *   import { customerService, salesService, ticketService } from '@/services';\r\n * \r\n * Or use Phase 4 custom hooks (recommended):\r\n *   import { useSupabaseCustomers, useSupabaseSales } from '@/hooks';\r\n * \r\n * HOW IT WORKS:\r\n * =============\r\n * 1. src/config/apiConfig.ts determines current mode: getApiMode()\r\n * 2. src/services/api/apiServiceFactory.ts routes requests to correct backend\r\n * 3. Services are automatically selected based on configuration\r\n * 4. Data transformations handled here for consistency\r\n * \r\n * SERVICE STRUCTURE:\r\n * ==================\r\n * ‚îú‚îÄ‚îÄ Mock Services: src/services/*Service.ts\r\n * ‚îú‚îÄ‚îÄ Supabase Services: src/services/supabase/*Service.ts (Phase 3)\r\n * ‚îú‚îÄ‚îÄ Interfaces: src/services/api/apiServiceFactory.ts\r\n * ‚îú‚îÄ‚îÄ Configuration: src/config/apiConfig.ts\r\n * ‚îú‚îÄ‚îÄ Custom Hooks: src/hooks/useSupabase*.ts (Phase 4)\r\n * ‚îî‚îÄ‚îÄ Archived Services: MARK_FOR_DELETE/legacy_services_real/ (unmaintained)\r\n * \r\n * PHASE 4 FEATURES:\r\n * =================\r\n * ‚úÖ Seamless backend switching without code changes\r\n * ‚úÖ Per-service backend override capability\r\n * ‚úÖ Custom React hooks for component integration\r\n * ‚úÖ Real-time data synchronization (Supabase)\r\n * ‚úÖ Backward compatible with existing code\r\n * ‚úÖ Type-safe service interfaces\r\n * ‚úÖ Automatic environment detection and logging\r\n */\r\n\r\nimport { \r\n  getAuthService,\r\n  getCustomerService,\r\n  getSalesService,\r\n  getTicketService,\r\n  getContractService,\r\n  getUserService,\r\n  getDashboardService,\r\n  getNotificationService,\r\n  getFileService,\r\n  getAuditService,\r\n  apiServiceFactory,\r\n  ICustomerService,\r\n  ISalesService,\r\n  ITicketService,\r\n  IUserService,\r\n  IContractService,\r\n  INotificationService\r\n} from './api/apiServiceFactory';\r\nimport { productSaleService as factoryProductSaleService, jobWorkService as factoryJobWorkService, notificationService as factoryNotificationService, tenantService as factoryTenantService } from './serviceFactory';\r\nimport { Customer, CustomerTag, Sale, Deal, Ticket } from '@/types/crm';\r\nimport { User } from '@/types/auth';\r\nimport { \r\n  CustomerResponse,\r\n  SaleResponse,\r\n  TicketResponse,\r\n  UserResponse\r\n} from './api/interfaces';\r\nimport type { Contract as UiContract, ContractAnalytics as UiContractAnalytics } from '@/types/contracts';\r\nimport type { ContractResponse } from './api/interfaces';\r\nimport { baseApiService } from './api/baseApiService';\r\nimport apiConfig from '@/config/apiConfig';\r\nimport { uiNotificationService } from './uiNotificationService';\r\n\r\n// Type alias for UI user representation\r\ntype UiUser = User;\r\n\r\n// Export service instances - lazy load to avoid initialization issues\r\nexport const authService = {\r\n  login: (credentials: Record<string, unknown>) => getAuthService().login(credentials),\r\n  logout: () => getAuthService().logout(),\r\n  getCurrentUser: () => getAuthService().getCurrentUser(),\r\n  getToken: () => getAuthService().getToken(),\r\n  isAuthenticated: () => getAuthService().isAuthenticated(),\r\n  hasRole: (role: string) => getAuthService().hasRole(role),\r\n  hasPermission: (permission: string) => getAuthService().hasPermission(permission),\r\n  refreshToken: () => getAuthService().refreshToken(),\r\n} as unknown as ReturnType<typeof getAuthService>;\r\n\r\n// Enhanced mappers: Real -> unified UI shapes\r\nconst mapCustomer = (c: CustomerResponse): Customer => {\r\n  const customer = c as Record<string, unknown>;\r\n  return {\r\n    id: c.id,\r\n    company_name: c.companyName,\r\n    contact_name: c.contactName,\r\n    email: c.email,\r\n    phone: c.phone || '',\r\n    mobile: String(customer.mobile || ''),\r\n    website: String(customer.website || ''),\r\n    address: c.address || '',\r\n    city: c.city || '',\r\n    country: c.country || '',\r\n    industry: c.industry || '',\r\n    size: String(c.size || 'small'),\r\n    status: String(c.status || 'active'),\r\n    customer_type: String(customer.customerType || 'business'),\r\n    credit_limit: Number(customer.creditLimit) || 0,\r\n    payment_terms: String(customer.paymentTerms || ''),\r\n    tax_id: String(customer.taxId || ''),\r\n    annual_revenue: Number(customer.annualRevenue) || 0,\r\n    total_sales_amount: Number(customer.totalSalesAmount) || 0,\r\n    total_orders: Number(customer.totalOrders) || 0,\r\n    average_order_value: Number(customer.averageOrderValue) || 0,\r\n    last_purchase_date: String(customer.lastPurchaseDate || ''),\r\n    tags: (c.tags || []) as CustomerTag[],\r\n    notes: c.notes,\r\n    assigned_to: c.assignedTo || '',\r\n    source: String(customer.source || ''),\r\n    rating: String(customer.rating || ''),\r\n    last_contact_date: String(customer.lastContactDate || ''),\r\n    next_follow_up_date: String(customer.nextFollowUpDate || ''),\r\n    tenant_id: c.tenantId,\r\n    created_at: c.createdAt,\r\n    updated_at: c.updatedAt,\r\n    created_by: String(customer.createdBy || '')\r\n  };\r\n};\r\n\r\nconst stageMapToUi: Record<string, string> = {\r\n  prospect: 'lead',\r\n  qualified: 'qualified',\r\n  proposal: 'proposal',\r\n  negotiation: 'negotiation',\r\n  won: 'closed_won',\r\n  lost: 'closed_lost'\r\n};\r\n\r\nconst mapSale = (s: any): Sale => {\r\n  const saleData = s as Record<string, unknown>;\r\n  \r\n  // Handle both SaleResponse (camelCase) and Supabase Sale (snake_case) formats\r\n  const expectedCloseDate = (s.expectedCloseDate || s.expected_close_date || '') as string;\r\n  const actualCloseDate = (s.actualCloseDate || s.actual_close_date || '') as string;\r\n  \r\n  return {\r\n    id: s.id,\r\n    sale_number: s.id, // Use ID as sale number for now\r\n    title: s.title,\r\n    description: s.description || '',\r\n    customer_id: s.customer?.id || s.customer_id || '',\r\n    customer_name: s.customer?.companyName || s.customer?.company_name || String(saleData.customer_name || ''),\r\n    value: s.value || Number(saleData.value) || 0,\r\n    amount: s.value || s.amount || Number(saleData.value) || 0,\r\n    currency: 'USD',\r\n    probability: s.probability || Number(saleData.probability) || 50,\r\n    weighted_amount: (s.value || Number(saleData.value) || 0) * ((s.probability || Number(saleData.probability) || 50) / 100),\r\n    stage: (stageMapToUi[(s.stage || '').toLowerCase()] || 'lead') as Sale['stage'],\r\n    status: s.status || (s.stage === 'won' ? 'won' : s.stage === 'lost' ? 'lost' : 'open'),\r\n    source: String(saleData.source || ''),\r\n    campaign: String(saleData.campaign || ''),\r\n    expected_close_date: expectedCloseDate,\r\n    actual_close_date: actualCloseDate,\r\n    last_activity_date: String(saleData.last_activity_date || ''),\r\n    next_activity_date: String(saleData.next_activity_date || ''),\r\n    assigned_to: s.assignedTo || s.assigned_to || '',\r\n    assigned_to_name: s.assignedUser?.name || s.assigned_to_name || '',\r\n    notes: s.notes || '',\r\n    tags: Array.isArray(saleData.tags) ? (saleData.tags as string[]) : [],\r\n    competitor_info: String(saleData.competitor_info || ''),\r\n    // Handle both products array (camelCase) and items array (snake_case)\r\n    items: (s.products?.map((p: any) => ({\r\n      id: p.id,\r\n      sale_id: s.id,\r\n      product_id: p.productId,\r\n      product_name: p.productName,\r\n      product_description: '',\r\n      quantity: p.quantity,\r\n      unit_price: p.unitPrice,\r\n      discount: 0,\r\n      tax: 0,\r\n      line_total: p.totalPrice\r\n    })) || (Array.isArray(saleData.items) ? (saleData.items as any[]).map(item => ({\r\n      id: item.id || '',\r\n      sale_id: item.sale_id || s.id,\r\n      product_id: item.product_id || '',\r\n      product_name: item.product_name || '',\r\n      product_description: item.product_description || '',\r\n      quantity: Number(item.quantity) || 0,\r\n      unit_price: Number(item.unit_price) || 0,\r\n      discount: Number(item.discount) || 0,\r\n      tax: Number(item.tax) || 0,\r\n      line_total: Number(item.line_total) || 0,\r\n    })) : [])) || [],\r\n    tenant_id: s.tenantId || s.tenant_id || '',\r\n    created_at: s.createdAt || s.created_at || new Date().toISOString(),\r\n    updated_at: s.updatedAt || s.updated_at || new Date().toISOString(),\r\n    created_by: String(saleData.created_by || '')\r\n  };\r\n};\r\n\r\nconst mapTicket = (t: TicketResponse): Ticket => ({\r\n  id: t.id,\r\n  ticket_number: t.id, // Use ID as ticket number for now\r\n  title: t.title,\r\n  description: t.description,\r\n\r\n  // Customer Relationship\r\n  customer_id: t.customer?.id || undefined,\r\n  customer_name: t.customer?.companyName,\r\n  customer_email: t.customer?.contactName, // Assuming contactName contains email\r\n  customer_phone: '',\r\n\r\n  // Status and Classification\r\n  status: (String(t.status) || 'open') as Ticket['status'],\r\n  priority: (String(t.priority) || 'medium') as Ticket['priority'],\r\n  category: (String(t.category) || 'general') as Ticket['category'],\r\n  sub_category: '',\r\n  source: '',\r\n\r\n  // Assignment and Reporting\r\n  assigned_to: t.assignedTo || undefined,\r\n  assigned_to_name: t.assignedUser?.name,\r\n  reported_by: '',\r\n  reported_by_name: '',\r\n\r\n  // Dates and SLA\r\n  due_date: t.dueDate || undefined,\r\n  resolved_at: t.resolvedAt || undefined,\r\n  closed_at: undefined,\r\n  first_response_date: undefined,\r\n\r\n  // Time Tracking\r\n  estimated_hours: undefined,\r\n  actual_hours: undefined,\r\n  first_response_time: undefined,\r\n  resolution_time: undefined,\r\n  is_sla_breached: false,\r\n\r\n  // Resolution and Notes\r\n  resolution: '',\r\n  tags: t.tags?.map(tag => tag.name) || [],\r\n\r\n  // Relationships\r\n  comments: t.comments?.map(c => ({\r\n    id: c.id,\r\n    ticket_id: t.id,\r\n    content: c.content,\r\n    author_id: c.author.id,\r\n    author_name: c.author.name,\r\n    author_role: '',\r\n    created_at: c.createdAt,\r\n    updated_at: c.createdAt,\r\n    parent_id: undefined,\r\n    replies: []\r\n  })) || [],\r\n  attachments: t.attachments?.map(a => ({\r\n    id: a.id,\r\n    ticket_id: t.id,\r\n    filename: a.filename,\r\n    original_filename: a.filename,\r\n    file_path: '',\r\n    file_url: a.url,\r\n    content_type: '',\r\n    file_size: a.size,\r\n    uploaded_by: '',\r\n    uploaded_by_name: '',\r\n    created_at: t.createdAt\r\n  })) || [],\r\n\r\n  // System Information\r\n  tenant_id: t.tenantId,\r\n  created_at: t.createdAt,\r\n  updated_at: t.updatedAt,\r\n  created_by: ''\r\n});\r\n\r\nconst mapUser = (u: UserResponse): UiUser => {\r\n  const [firstName, ...rest] = (u.name || '').split(' ');\r\n  const user = u as Record<string, unknown>;\r\n  return {\r\n    id: u.id,\r\n    email: u.email,\r\n    firstName: firstName || '',\r\n    lastName: rest.join(' '),\r\n    role: (String(u.role) || 'Viewer') as User['role'],\r\n    status: (String(user.status) || 'active') as User['status'],\r\n    tenantId: u.tenantId,\r\n    tenantName: '',\r\n    lastLogin: u.lastLogin || '',\r\n    createdAt: u.createdAt || '',\r\n    avatar: u.avatar,\r\n    phone: ''\r\n  };\r\n};\r\n\r\n// Customer service wrapper\r\nexport const customerService = {\r\n  async getCustomers(filters?: Record<string, unknown>): Promise<Customer[]> {\r\n    const base: ICustomerService = getCustomerService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.getCustomers(filters) as Promise<Customer[]>;\r\n    const res: CustomerResponse[] = await base.getCustomers(filters) as CustomerResponse[];\r\n    return res.map(mapCustomer);\r\n  },\r\n  async getCustomer(id: string): Promise<Customer> {\r\n    const base: ICustomerService = getCustomerService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.getCustomer(id) as Promise<Customer>;\r\n    const c: CustomerResponse = await base.getCustomer(id) as CustomerResponse;\r\n    return mapCustomer(c);\r\n  },\r\n  async createCustomer(data: Partial<Customer>): Promise<Customer> {\r\n    const base: ICustomerService = getCustomerService();\r\n    const req = {\r\n      companyName: data.company_name,\r\n      contactName: data.contact_name,\r\n      email: data.email,\r\n      phone: data.phone,\r\n      address: data.address,\r\n      city: data.city,\r\n      country: data.country,\r\n      industry: data.industry,\r\n      size: data.size,\r\n      status: data.status,\r\n      notes: data.notes,\r\n      assignedTo: data.assigned_to\r\n    };\r\n    if (apiServiceFactory.isUsingMockApi()) return base.createCustomer(req) as Promise<Customer>;\r\n    const c: CustomerResponse = await base.createCustomer(req) as CustomerResponse;\r\n    return mapCustomer(c);\r\n  },\r\n  async updateCustomer(id: string, data: Partial<Customer>): Promise<Customer> {\r\n    const base: ICustomerService = getCustomerService();\r\n    const req = {\r\n      companyName: data.company_name,\r\n      contactName: data.contact_name,\r\n      email: data.email,\r\n      phone: data.phone,\r\n      address: data.address,\r\n      city: data.city,\r\n      country: data.country,\r\n      industry: data.industry,\r\n      size: data.size,\r\n      status: data.status,\r\n      notes: data.notes,\r\n      assignedTo: data.assigned_to\r\n    };\r\n    if (apiServiceFactory.isUsingMockApi()) return base.updateCustomer(id, req) as Promise<Customer>;\r\n    const c: CustomerResponse = await base.updateCustomer(id, req) as CustomerResponse;\r\n    return mapCustomer(c);\r\n  },\r\n  async deleteCustomer(id: string): Promise<void> {\r\n    const base: ICustomerService = getCustomerService();\r\n    return base.deleteCustomer(id);\r\n  },\r\n  async getTags(): Promise<CustomerTag[]> {\r\n    const base: ICustomerService = getCustomerService();\r\n    return base.getTags() as Promise<CustomerTag[]>;\r\n  },\r\n  async createTag(name: string, color: string): Promise<CustomerTag> {\r\n    const base: ICustomerService = getCustomerService();\r\n    if (base.createTag) return base.createTag(name, color) as Promise<CustomerTag>;\r\n    // Fallback no-op\r\n    return { id: Date.now().toString(), name, color };\r\n  },\r\n  async getIndustries(): Promise<string[]> { return ['Technology','Manufacturing','Software','Retail','Healthcare','Finance','Education','Other']; },\r\n  async getSizes(): Promise<string[]> { return ['startup','small','medium','enterprise']; },\r\n  async exportCustomers(format: 'csv'|'json' = 'csv'): Promise<string> {\r\n    const list = await this.getCustomers();\r\n    if (format === 'json') return JSON.stringify(list, null, 2);\r\n    const headers = ['Company Name','Contact Name','Email','Phone','Address','City','Country','Industry','Size','Status','Created At'];\r\n    const rows = list.map(c => [c.company_name,c.contact_name,c.email,c.phone,c.address,c.city,c.country,c.industry,c.size,c.status,new Date(c.created_at).toLocaleDateString()]);\r\n    return [headers, ...rows].map(r => r.map(v => `\"${v ?? ''}\"`).join(',')).join('\\r\\n');\r\n  },\r\n  async importCustomers(csv: string): Promise<{ success: number; errors: string[] }> {\r\n    // Fallback stub\r\n    return { success: 0, errors: [] };\r\n  }\r\n};\r\n\r\n// Sales service wrapper (normalizes to Deal API)\r\nexport const salesService = {\r\n  async getDeals(filters?: Record<string, unknown>): Promise<Deal[]> {\r\n    const base: ISalesService = getSalesService();\r\n    if (apiServiceFactory.isUsingMockApi() && 'getDeals' in base) return (base as Record<string, unknown>).getDeals?.(filters) as Promise<Deal[]>;\r\n    const res: SaleResponse[] = await base.getSales(filters) as SaleResponse[];\r\n    return res.map(mapSale);\r\n  },\r\n  async getDeal(id: string): Promise<Deal> {\r\n    const base: ISalesService = getSalesService();\r\n    if (apiServiceFactory.isUsingMockApi() && 'getDeal' in base) return (base as Record<string, unknown>).getDeal?.(id) as Promise<Deal>;\r\n    const res: SaleResponse = await base.getSale(id) as SaleResponse;\r\n    return mapSale(res);\r\n  },\r\n  async createDeal(data: Record<string, unknown>): Promise<Deal> {\r\n    const base: ISalesService = getSalesService();\r\n    if (apiServiceFactory.isUsingMockApi() && 'createDeal' in base) return (base as Record<string, unknown>).createDeal?.(data) as Promise<Deal>;\r\n    const res: SaleResponse = await base.createSale(data) as SaleResponse;\r\n    return mapSale(res);\r\n  },\r\n  async updateDeal(id: string, data: Record<string, unknown>): Promise<Deal> {\r\n    const base: ISalesService = getSalesService();\r\n    if (apiServiceFactory.isUsingMockApi() && 'updateDeal' in base) return (base as Record<string, unknown>).updateDeal?.(id, data) as Promise<Deal>;\r\n    const res: SaleResponse = await base.updateSale(id, data) as SaleResponse;\r\n    return mapSale(res);\r\n  },\r\n  async deleteDeal(id: string): Promise<void> {\r\n    const base: ISalesService = getSalesService();\r\n    if (apiServiceFactory.isUsingMockApi() && 'deleteDeal' in base) return (base as Record<string, unknown>).deleteDeal?.(id) as Promise<void>;\r\n    return base.deleteSale(id);\r\n  }\r\n};\r\n\r\n// Ticket service wrapper\r\nexport const ticketService = {\r\n  async getTickets(filters?: Record<string, unknown>): Promise<Ticket[]> {\r\n    const base: ITicketService = getTicketService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.getTickets(filters) as Promise<Ticket[]>;\r\n    const res: TicketResponse[] = await base.getTickets(filters) as TicketResponse[];\r\n    return res.map(mapTicket);\r\n  },\r\n  async deleteTicket(id: string): Promise<void> {\r\n    const base: ITicketService = getTicketService();\r\n    return base.deleteTicket(id);\r\n  }\r\n};\r\n\r\n// Contract service: passthrough (mock-heavy features); keep direct for now\r\n\r\n// Product Sale Service - Routes to Supabase or Mock based on VITE_API_MODE\r\nexport const productSaleService = factoryProductSaleService;\r\n\r\n// User service wrapper\r\nexport const userService = {\r\n  async getUsers(filters?: Record<string, unknown>): Promise<UiUser[]> {\r\n    const base: IUserService = getUserService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.getUsers(filters) as Promise<UiUser[]>;\r\n    const res: UserResponse[] = await base.getUsers(filters) as UserResponse[];\r\n    return res.map(mapUser);\r\n  },\r\n  async updateUser(id: string, updates: Partial<UiUser>): Promise<UiUser> {\r\n    const base: IUserService = getUserService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.updateUser(id, updates as Record<string, unknown>) as Promise<UiUser>;\r\n    const req = {\r\n      name: `${updates.firstName ?? ''} ${updates.lastName ?? ''}`.trim() || undefined,\r\n      email: updates.email,\r\n      role: updates.role,\r\n      avatar: updates.avatar\r\n    };\r\n    return base.updateUser(id, req) as Promise<UiUser>;\r\n  },\r\n  async createUser(data: Omit<UiUser,'id'|'createdAt'|'lastLogin'>): Promise<UiUser> {\r\n    const base: IUserService = getUserService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.createUser(data as Record<string, unknown>) as Promise<UiUser>;\r\n    const req = {\r\n      name: `${data.firstName} ${data.lastName}`.trim(),\r\n      email: data.email,\r\n      role: data.role,\r\n      avatar: data.avatar\r\n    };\r\n    return base.createUser(req) as Promise<UiUser>;\r\n  },\r\n  async deleteUser(id: string): Promise<void> {\r\n    const base: IUserService = getUserService();\r\n    return base.deleteUser(id);\r\n  },\r\n  async resetPassword(id: string): Promise<void> {\r\n    const base: IUserService = getUserService();\r\n    if ('resetPassword' in base) return (base as Record<string, unknown>).resetPassword?.(id) as Promise<void>;\r\n    // Stub\r\n    return;\r\n  },\r\n  async getTenants(): Promise<Array<{ id: string; name: string }>> {\r\n    const base: IUserService = getUserService();\r\n    if ('getTenants' in base) return (base as Record<string, unknown>).getTenants?.() as Promise<Array<{ id: string; name: string }>>;\r\n    // Stub a couple of tenants\r\n    return [\r\n      { id: 'techcorp', name: 'TechCorp Solutions' },\r\n      { id: 'innovatecorp', name: 'InnovateCorp' }\r\n    ];\r\n  }\r\n};\r\n// Lazy load dashboard service\r\nexport const dashboardService = {\r\n  getMetrics: () => getDashboardService().getMetrics(),\r\n  getAnalytics: (period?: string) => getDashboardService().getAnalytics(period),\r\n  getRecentActivity: () => getDashboardService().getRecentActivity(),\r\n  getWidgetData: (widgetType: string) => getDashboardService().getWidgetData(widgetType),\r\n} as unknown as ReturnType<typeof getDashboardService>;\r\n\r\n// Lazy load file service\r\nexport const fileService = {\r\n  uploadFile: (file: File, options?: Record<string, unknown>) => getFileService().uploadFile(file, options),\r\n  downloadFile: (id: string) => getFileService().downloadFile(id),\r\n  deleteFile: (id: string) => getFileService().deleteFile(id),\r\n  getFileMetadata: (id: string) => getFileService().getFileMetadata(id),\r\n} as unknown as ReturnType<typeof getFileService>;\r\n\r\n// Lazy load audit service\r\nexport const auditService = {\r\n  getAuditLogs: (filters?: Record<string, unknown>) => getAuditService().getAuditLogs(filters),\r\n  exportAuditLogs: (filters?: Record<string, unknown>) => getAuditService().exportAuditLogs(filters),\r\n  searchAuditLogs: (query: string) => getAuditService().searchAuditLogs(query),\r\n} as unknown as ReturnType<typeof getAuditService>;\r\n\r\n// Export productService from factory (supports mock/supabase/real backends)\r\nimport { productService as factoryProductService } from './serviceFactory';\r\nexport const productService = factoryProductService;\r\n\r\n// Export jobWorkService from factory (supports mock/supabase/real backends)\r\nexport const jobWorkService = factoryJobWorkService;\r\n\r\n// Import and export serviceContractService (factory-routed for Supabase/Mock switching)\r\nimport { serviceContractService as factoryServiceContractService } from './serviceFactory';\r\nexport const serviceContractService = factoryServiceContractService;\r\n\r\n// Import and export companyService (factory-routed for Supabase/Mock switching)\r\nimport { companyService as factoryCompanyService } from './serviceFactory';\r\nexport const companyService = factoryCompanyService;\r\n\r\n// Contract service wrapper\r\nconst mapContractTypeToUi = (t?: string): UiContract['type'] => {\r\n  const v = (t || '').toLowerCase();\r\n  if (v === 'service') return 'service_agreement';\r\n  if (v === 'product') return 'purchase_order';\r\n  if (v === 'nda') return 'nda';\r\n  if (v === 'employment') return 'employment';\r\n  return 'custom';\r\n};\r\n\r\nconst mapStatusToUi = (s?: string): UiContract['status'] => {\r\n  const v = (s || '').toLowerCase();\r\n  if (v === 'draft') return 'draft';\r\n  if (v === 'active') return 'active';\r\n  if (v === 'expired' || v === 'terminated') return 'expired';\r\n  if (v === 'renewed') return 'renewed';\r\n  return 'draft';\r\n};\r\n\r\nconst mapContract = (c: ContractResponse): UiContract => {\r\n  const contract = c as Record<string, unknown>;\r\n  return {\r\n    id: c.id,\r\n    title: c.title,\r\n    type: mapContractTypeToUi(c.type),\r\n    status: mapStatusToUi(c.status),\r\n    parties: [],\r\n    value: c.value,\r\n    currency: 'USD',\r\n    startDate: c.startDate,\r\n    endDate: c.endDate,\r\n    autoRenew: false,\r\n    renewalTerms: '',\r\n    approvalStage: 'draft',\r\n    signedDate: contract.signedDate as string | undefined,\r\n    createdBy: '',\r\n    assignedTo: '',\r\n    tenant_id: c.tenantId,\r\n    content: '',\r\n    templateId: undefined,\r\n    version: 1,\r\n    tags: [],\r\n    priority: 'medium',\r\n    reminderDays: [],\r\n    nextReminderDate: contract.nextRenewalDate as string | undefined,\r\n    complianceStatus: 'pending_review',\r\n    attachments: [],\r\n    approvalHistory: [],\r\n    signatureStatus: { totalRequired: 0, completed: 0, pending: [] },\r\n    created_at: c.createdAt,\r\n    updated_at: c.updatedAt\r\n  };\r\n};\r\n\r\nexport const contractService = {\r\n  async getContracts(filters?: Record<string, unknown>): Promise<UiContract[]> {\r\n    const base: IContractService = getContractService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.getContracts(filters) as Promise<UiContract[]>;\r\n    const res: ContractResponse[] = await base.getContracts(filters) as ContractResponse[];\r\n    return res.map(mapContract);\r\n  },\r\n  async getContract(id: string): Promise<UiContract> {\r\n    const base: IContractService = getContractService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.getContract(id) as Promise<UiContract>;\r\n    const c: ContractResponse = await base.getContract(id) as ContractResponse;\r\n    return mapContract(c);\r\n  },\r\n  async deleteContract(id: string): Promise<void> {\r\n    const base: IContractService = getContractService();\r\n    return base.deleteContract(id);\r\n  },\r\n  async createContract(data: Partial<UiContract>): Promise<UiContract> {\r\n    const base: IContractService = getContractService();\r\n    const req: Record<string, unknown> = {\r\n      title: data.title,\r\n      customerId: (data as Record<string, unknown>).customerId || '',\r\n      type: (data?.type === 'purchase_order' ? 'product' : 'service'),\r\n      value: data?.value || 0,\r\n      startDate: data?.startDate || new Date().toISOString().slice(0,10),\r\n      endDate: data?.endDate || new Date().toISOString().slice(0,10),\r\n      status: 'draft',\r\n      terms: data?.renewalTerms || ''\r\n    };\r\n    if (apiServiceFactory.isUsingMockApi()) return base.createContract(req) as Promise<UiContract>;\r\n    const c: ContractResponse = await base.createContract(req) as ContractResponse;\r\n    return mapContract(c);\r\n  },\r\n  async updateContract(id: string, data: Partial<UiContract>): Promise<UiContract> {\r\n    const base: IContractService = getContractService();\r\n    const req: Record<string, unknown> = {\r\n      title: data.title,\r\n      type: (data?.type === 'purchase_order' ? 'product' : 'service'),\r\n      value: data?.value,\r\n      startDate: data?.startDate,\r\n      endDate: data?.endDate,\r\n      status: data?.status,\r\n      terms: data?.renewalTerms\r\n    };\r\n    if (apiServiceFactory.isUsingMockApi()) return base.updateContract(id, req) as Promise<UiContract>;\r\n    const c: ContractResponse = await base.updateContract(id, req) as ContractResponse;\r\n    return mapContract(c);\r\n  },\r\n  async approveContract(id: string, stage: string, comments?: string): Promise<void> {\r\n    const base: IContractService = getContractService();\r\n    if (apiServiceFactory.isUsingMockApi()) {\r\n      const mock = base as Record<string, unknown>;\r\n      return mock.approveContract?.(id, stage, comments) as Promise<void>;\r\n    }\r\n    // Real fallback: set status to active\r\n    await base.updateContract(id, { status: 'active' });\r\n  },\r\n  async toggleAutoRenewal(id: string, autoRenew: boolean): Promise<void> {\r\n    const base: IContractService = getContractService();\r\n    if (apiServiceFactory.isUsingMockApi()) {\r\n      const mock = base as Record<string, unknown>;\r\n      return mock.toggleAutoRenewal?.(id, autoRenew) as Promise<void>;\r\n    }\r\n    // No direct endpoint; best effort no-op for now\r\n    return;\r\n  },\r\n  async getAnalytics(): Promise<UiContractAnalytics> {\r\n    const base: IContractService = getContractService();\r\n    if (apiServiceFactory.isUsingMockApi()) {\r\n      const mock = base as Record<string, unknown>;\r\n      return mock.getAnalytics?.() as Promise<UiContractAnalytics>;\r\n    }\r\n    const real = await base.getContractAnalytics() as Record<string, unknown>;\r\n    const byStatus = (real.byStatus || []) as Array<Record<string, unknown>>;\r\n    const totalContracts = byStatus.reduce((sum: number, s: Record<string, unknown>) => sum + (Number(s.count) || 0), 0);\r\n    const monthlyRevenue = (real.monthlyRevenue || []) as Array<Record<string, unknown>>;\r\n    const byType = (real.byType || []) as Array<Record<string, unknown>>;\r\n    return {\r\n      totalContracts: totalContracts || 0,\r\n      activeContracts: Number(real.activeContracts) || 0,\r\n      pendingApprovals: 0,\r\n      expiringContracts: Number(real.expiringContracts) || 0,\r\n      totalValue: Number(real.totalValue) || 0,\r\n      averageApprovalTime: 0,\r\n      renewalRate: Number(real.renewalRate) || 0,\r\n      complianceRate: 95,\r\n      monthlyStats: monthlyRevenue.map((m: Record<string, unknown>) => ({ month: String(m.month), created: 0, signed: 0, expired: 0, value: Number(m.revenue) })),\r\n      statusDistribution: byStatus.map((s: Record<string, unknown>) => ({ status: String(s.status), count: Number(s.count), percentage: 0 })),\r\n      typeDistribution: byType.map((t: Record<string, unknown>) => ({ type: String(t.type), count: Number(t.count), value: Number(t.value) }))\r\n    };\r\n  }\r\n};\r\n\r\n// Notification API service wrapper (for managing notification queue, not for UI notifications)\r\nexport const notificationApiService = {\r\n  async getNotificationStats(): Promise<import('@/types/notifications').NotificationStats> {\r\n    const base: INotificationService = getNotificationService();\r\n    if (apiServiceFactory.isUsingMockApi()) return base.getNotifications() as Promise<import('@/types/notifications').NotificationStats>;\r\n    return base.getNotifications() as Promise<import('@/types/notifications').NotificationStats>;\r\n  },\r\n  async getQueueStatus(): Promise<{ pending: number; processing: number; sent: number; failed: number }> {\r\n    const base: INotificationService = getNotificationService();\r\n    if (apiServiceFactory.isUsingMockApi()) return { pending: 0, processing: 0, sent: 0, failed: 0 };\r\n    const queue = await base.getNotifications() as Array<Record<string, unknown>>;\r\n    const counts: Record<string, number> = { pending: 0, processing: 0, sent: 0, failed: 0 };\r\n    queue.forEach((q: Record<string, unknown>) => { \r\n      const status = String(q.status || 'pending');\r\n      counts[status] = (counts[status] || 0) + 1; \r\n    });\r\n    return counts as { pending: number; processing: number; sent: number; failed: number };\r\n  },\r\n  async processQueue(): Promise<void> {\r\n    if (apiServiceFactory.isUsingMockApi()) {\r\n      const base: INotificationService = getNotificationService();\r\n      const mock = base as Record<string, unknown>;\r\n      return mock.processQueue?.() as Promise<void>;\r\n    }\r\n    await baseApiService.post(`${apiConfig.endpoints.notifications.queue}/process`);\r\n  },\r\n  async retryFailedNotifications(): Promise<void> {\r\n    const base: INotificationService = getNotificationService();\r\n    if (apiServiceFactory.isUsingMockApi()) {\r\n      const mock = base as Record<string, unknown>;\r\n      return mock.retryFailedNotifications?.() as Promise<void>;\r\n    }\r\n    const queue = await base.getNotifications() as Array<Record<string, unknown>>;\r\n    const failed = queue.filter((x: Record<string, unknown>) => x.status === 'failed');\r\n    const baseMock = base as Record<string, unknown>;\r\n    for (const q of failed) {\r\n      await (baseMock.retryNotification as (id: string) => Promise<void>)((q.notification as Record<string, unknown>)?.id || q.id);\r\n    }\r\n  },\r\n  async getNotificationQueue(): Promise<import('@/types/notifications').NotificationQueue[]> {\r\n    const base: INotificationService = getNotificationService();\r\n    if (apiServiceFactory.isUsingMockApi()) {\r\n      const mock = base as Record<string, unknown>;\r\n      if (mock.getNotificationQueue) return mock.getNotificationQueue() as Promise<import('@/types/notifications').NotificationQueue[]>;\r\n    }\r\n    // Fetch from real API\r\n    const resp = await baseApiService.get<Array<Record<string, unknown>>>(`${apiConfig.endpoints.notifications.base}/queue`);\r\n    const list = (resp.data || []);\r\n    return list.map((q: Record<string, unknown>) => {\r\n      const notification = q.notification as Record<string, unknown> | undefined;\r\n      const channels = notification?.channels as unknown[] | undefined;\r\n      const recipients = notification?.recipients as Array<Record<string, unknown>> | undefined;\r\n      return {\r\n        id: String(q.id),\r\n        template_id: String(notification?.id || ''),\r\n        recipient_id: String(recipients?.[0]?.userId || ''),\r\n        channel: (channels?.[0] || 'push') as 'email'|'sms'|'push'|'in_app',\r\n        status: String(q.status),\r\n        priority: 'normal' as const,\r\n        scheduled_at: String(q.scheduledAt),\r\n        sent_at: String(q.sentAt),\r\n        delivered_at: undefined,\r\n        failed_at: q.status === 'failed' ? String(q.sentAt) : undefined,\r\n        retry_count: Number(q.attempts) || 0,\r\n        max_retries: 3,\r\n        error_message: String(q.error),\r\n        template_variables: {},\r\n        external_id: undefined,\r\n        created_at: String(notification?.createdAt || new Date().toISOString()),\r\n        updated_at: String(notification?.createdAt || new Date().toISOString())\r\n      };\r\n    });\r\n  },\r\n  async retryQueueItem(queueId: string): Promise<void> {\r\n    if (apiServiceFactory.isUsingMockApi()) return; // mock handled elsewhere\r\n    await baseApiService.post(`${apiConfig.endpoints.notifications.base}/queue/${queueId}/retry`);\r\n  },\r\n  async cancelQueueItem(queueId: string): Promise<void> {\r\n    if (apiServiceFactory.isUsingMockApi()) return; // mock handled elsewhere\r\n    await baseApiService.post(`${apiConfig.endpoints.notifications.base}/queue/${queueId}/cancel`);\r\n  },\r\n  async sendTemplateNotification(templateId: string, data: { recipients: string[]; channels: Array<'email'|'sms'|'push'|'in_app'>; variables?: Record<string, unknown>; scheduledAt?: string; }): Promise<Record<string, unknown>> {\r\n    const base: INotificationService = getNotificationService();\r\n    if (apiServiceFactory.isUsingMockApi()) {\r\n      const mock = base as Record<string, unknown>;\r\n      if (mock.sendTemplateNotification) return mock.sendTemplateNotification(templateId, data) as Promise<Record<string, unknown>>;\r\n    }\r\n    const resp = await baseApiService.post(`${apiConfig.endpoints.notifications.templates}/${templateId}/send`, data);\r\n    return resp.data as Record<string, unknown>;\r\n  },\r\n  // passthrough common methods\r\n  async getNotifications(filters?: Record<string, unknown>) { \r\n    const base: INotificationService = getNotificationService(); \r\n    return base.getNotifications(filters); \r\n  },\r\n  async createNotification(data: Record<string, unknown>) { \r\n    const base: INotificationService = getNotificationService(); \r\n    return base.createNotification(data); \r\n  },\r\n  async getTemplates() { \r\n    const base: INotificationService = getNotificationService(); \r\n    return base.getTemplates(); \r\n  }\r\n};\r\n\r\n// Export factory for advanced usage\r\nexport { apiServiceFactory };\r\n\r\n// Export service factory methods\r\nexport {\r\n  getAuthService,\r\n  getCustomerService,\r\n  getSalesService,\r\n  getTicketService,\r\n  getContractService,\r\n  getUserService,\r\n  getDashboardService,\r\n  getNotificationService,\r\n  getFileService,\r\n  getAuditService,\r\n};\r\n\r\n// Export service interfaces for type checking\r\nexport type {\r\n  IAuthService,\r\n  ICustomerService,\r\n  ISalesService,\r\n  ITicketService,\r\n  IContractService,\r\n  IUserService,\r\n  IDashboardService,\r\n  INotificationService,\r\n  IFileService,\r\n  IAuditService,\r\n} from './api/apiServiceFactory';\r\n\r\n// Export API configuration\r\nexport { apiConfig, isUsingMockApi } from '../config/apiConfig';\r\n\r\n// Export base API service for direct usage\r\nexport { baseApiService } from './api/baseApiService';\r\n\r\n// Export API interfaces\r\nexport * from './api/interfaces';\r\n\r\n/**\r\n * Utility function to switch API mode at runtime\r\n */\r\nexport function switchApiMode(useMock: boolean): void {\r\n  apiServiceFactory.switchApiMode(useMock);\r\n  \r\n  // Update environment variable for consistency\r\n  if (typeof window !== 'undefined') {\r\n    // Note: This won't actually change the import.meta.env value,\r\n    // but the factory will use its internal state\r\n    console.log(`API mode switched to: ${useMock ? 'Mock' : 'Real'}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Get current API mode\r\n */\r\nexport function getCurrentApiMode(): 'mock' | 'real' {\r\n  return apiServiceFactory.isUsingMockApi() ? 'mock' : 'real';\r\n}\r\n\r\n/**\r\n * Get service health status\r\n */\r\nexport function getServiceHealth(): {\r\n  mode: 'mock' | 'real';\r\n  services: Record<string, boolean>;\r\n  lastCheck: string;\r\n} {\r\n  const services = apiServiceFactory.getServiceInstances();\r\n  \r\n  return {\r\n    mode: getCurrentApiMode(),\r\n    services: Object.keys(services).reduce((acc, key) => {\r\n      acc[key] = services[key] !== null;\r\n      return acc;\r\n    }, {} as Record<string, boolean>),\r\n    lastCheck: new Date().toISOString(),\r\n  };\r\n}\r\n\r\n// Named exports for individual services\r\n// Export the UI notification service\r\nexport { uiNotificationService };\r\n// Export the data notification service from factory\r\nexport { notificationService } from './serviceFactory';\r\n// Export the tenant service from factory\r\nexport { tenantService } from './serviceFactory';\r\n\r\n// Default export for convenience\r\nexport default {\r\n  auth: authService,\r\n  customer: customerService,\r\n  sales: salesService,\r\n  ticket: ticketService,\r\n  contract: contractService,\r\n  productSale: productSaleService,\r\n  user: userService,\r\n  dashboard: dashboardService,\r\n  notification: factoryNotificationService,  // Data notification service from factory\r\n  uiNotification: uiNotificationService,      // UI notification (messages/alerts)\r\n  tenant: factoryTenantService,               // Tenant service from factory\r\n  file: fileService,\r\n  audit: auditService,\r\n  factory: apiServiceFactory,\r\n  switchApiMode,\r\n  getCurrentApiMode,\r\n  getServiceHealth,\r\n};\r\n\r\n// Export testing and validation utilities\r\nexport * from './serviceIntegrationTest';\r\nexport * from './testUtils';\r\nexport * from './validationScript';\r\nexport * from './errorHandler';\r\nexport * from './serviceLogger';\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\jobWorkService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\logsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\notificationService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[349,352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[349,352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Mock Notification Service\r\n * Handles user notifications, preferences, and alerts (Mock Implementation)\r\n */\r\n\r\nimport { authService } from './authService';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  user_id: string;\r\n  type: 'info' | 'warning' | 'error' | 'success';\r\n  title: string;\r\n  message: string;\r\n  data?: Record<string, any>;\r\n  is_read?: boolean;\r\n  read?: boolean;\r\n  read_at?: string;\r\n  action_url?: string;\r\n  action_label?: string;\r\n  category?: string;\r\n  tenant_id: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface NotificationPreferences {\r\n  email: boolean;\r\n  sms: boolean;\r\n  push: boolean;\r\n  in_app: boolean;\r\n  categories?: Record<string, {\r\n    email: boolean;\r\n    sms: boolean;\r\n    push: boolean;\r\n    in_app: boolean;\r\n  }>;\r\n}\r\n\r\nexport interface NotificationFilters {\r\n  search?: string;\r\n  is_read?: boolean;\r\n  category?: string;\r\n  userId?: string;\r\n  read?: boolean;\r\n}\r\n\r\nclass MockNotificationService {\r\n  private mockNotifications: Notification[] = [\r\n    {\r\n      id: '1',\r\n      user_id: 'user_1',\r\n      type: 'success',\r\n      title: 'Welcome Back',\r\n      message: 'You have successfully logged in',\r\n      category: 'system',\r\n      is_read: false,\r\n      read: false,\r\n      tenant_id: 'tenant_1',\r\n      created_at: new Date(Date.now() - 1000 * 60 * 5).toISOString(), // 5 minutes ago\r\n      updated_at: new Date(Date.now() - 1000 * 60 * 5).toISOString(),\r\n    },\r\n    {\r\n      id: '2',\r\n      user_id: 'user_1',\r\n      type: 'info',\r\n      title: 'New Customer Added',\r\n      message: 'Customer TechCorp Solutions has been added to your list',\r\n      category: 'customer',\r\n      is_read: false,\r\n      read: false,\r\n      tenant_id: 'tenant_1',\r\n      created_at: new Date(Date.now() - 1000 * 60 * 15).toISOString(), // 15 minutes ago\r\n      updated_at: new Date(Date.now() - 1000 * 60 * 15).toISOString(),\r\n    },\r\n    {\r\n      id: '3',\r\n      user_id: 'user_1',\r\n      type: 'warning',\r\n      title: 'Order Pending Review',\r\n      message: 'Order #12345 is waiting for your approval',\r\n      category: 'order',\r\n      is_read: false,\r\n      read: false,\r\n      action_url: '/orders/12345',\r\n      action_label: 'Review Order',\r\n      tenant_id: 'tenant_1',\r\n      created_at: new Date(Date.now() - 1000 * 60 * 30).toISOString(), // 30 minutes ago\r\n      updated_at: new Date(Date.now() - 1000 * 60 * 30).toISOString(),\r\n    },\r\n    {\r\n      id: '4',\r\n      user_id: 'user_1',\r\n      type: 'error',\r\n      title: 'Payment Failed',\r\n      message: 'Payment for invoice #INV-001 failed. Please retry.',\r\n      category: 'payment',\r\n      is_read: true,\r\n      read: true,\r\n      read_at: new Date(Date.now() - 1000 * 60 * 45).toISOString(),\r\n      tenant_id: 'tenant_1',\r\n      created_at: new Date(Date.now() - 1000 * 60 * 60).toISOString(), // 1 hour ago\r\n      updated_at: new Date(Date.now() - 1000 * 60 * 60).toISOString(),\r\n    },\r\n    {\r\n      id: '5',\r\n      user_id: 'user_1',\r\n      type: 'info',\r\n      title: 'Report Generated',\r\n      message: 'Your monthly sales report has been generated',\r\n      category: 'report',\r\n      is_read: true,\r\n      read: true,\r\n      read_at: new Date(Date.now() - 1000 * 60 * 120).toISOString(),\r\n      tenant_id: 'tenant_1',\r\n      created_at: new Date(Date.now() - 1000 * 60 * 120).toISOString(), // 2 hours ago\r\n      updated_at: new Date(Date.now() - 1000 * 60 * 120).toISOString(),\r\n    },\r\n  ];\r\n\r\n  private mockPreferences: NotificationPreferences = {\r\n    email: true,\r\n    sms: false,\r\n    push: true,\r\n    in_app: true,\r\n    categories: {\r\n      customer: { email: true, sms: false, push: true, in_app: true },\r\n      order: { email: true, sms: true, push: true, in_app: true },\r\n      payment: { email: true, sms: true, push: true, in_app: true },\r\n      system: { email: false, sms: false, push: true, in_app: true },\r\n      report: { email: true, sms: false, push: false, in_app: true },\r\n    },\r\n  };\r\n\r\n  private unsubscribeCallbacks: Array<(notification: Notification) => void> = [];\r\n\r\n  /**\r\n   * Get notifications for current user with optional filters\r\n   */\r\n  async getNotifications(filters?: NotificationFilters): Promise<Notification[]> {\r\n    try {\r\n      let result = [...this.mockNotifications];\r\n\r\n      // Apply search filter\r\n      if (filters?.search) {\r\n        const searchLower = filters.search.toLowerCase();\r\n        result = result.filter(n =>\r\n          n.title.toLowerCase().includes(searchLower) ||\r\n          n.message.toLowerCase().includes(searchLower)\r\n        );\r\n      }\r\n\r\n      // Apply read filter\r\n      if (filters?.is_read !== undefined) {\r\n        result = result.filter(n => (n.read || n.is_read) === filters.is_read);\r\n      } else if (filters?.read !== undefined) {\r\n        result = result.filter(n => (n.read || n.is_read) === filters.read);\r\n      }\r\n\r\n      // Apply category filter\r\n      if (filters?.category) {\r\n        result = result.filter(n => n.category === filters.category);\r\n      }\r\n\r\n      // Sort by created_at descending\r\n      result.sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime());\r\n\r\n      return result;\r\n    } catch (error) {\r\n      console.error('Error fetching notifications:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get notification preferences for current user\r\n   */\r\n  async getNotificationPreferences(): Promise<NotificationPreferences> {\r\n    try {\r\n      return this.mockPreferences;\r\n    } catch (error) {\r\n      console.error('Error fetching notification preferences:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update notification preferences\r\n   */\r\n  async updateNotificationPreferences(preferences: Partial<NotificationPreferences>): Promise<void> {\r\n    try {\r\n      this.mockPreferences = {\r\n        ...this.mockPreferences,\r\n        ...preferences,\r\n      };\r\n    } catch (error) {\r\n      console.error('Error updating notification preferences:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark a notification as read\r\n   */\r\n  async markAsRead(id: string): Promise<Notification> {\r\n    try {\r\n      const notification = this.mockNotifications.find(n => n.id === id);\r\n      if (notification) {\r\n        notification.read = true;\r\n        notification.is_read = true;\r\n        notification.read_at = new Date().toISOString();\r\n        notification.updated_at = new Date().toISOString();\r\n      }\r\n      return notification || {} as Notification;\r\n    } catch (error) {\r\n      console.error('Error marking notification as read:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark all notifications as read\r\n   */\r\n  async markAllAsRead(): Promise<number> {\r\n    try {\r\n      let count = 0;\r\n      this.mockNotifications.forEach(n => {\r\n        if (!n.read && !n.is_read) {\r\n          n.read = true;\r\n          n.is_read = true;\r\n          n.read_at = new Date().toISOString();\r\n          n.updated_at = new Date().toISOString();\r\n          count++;\r\n        }\r\n      });\r\n      return count;\r\n    } catch (error) {\r\n      console.error('Error marking all notifications as read:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a notification\r\n   */\r\n  async deleteNotification(id: string): Promise<void> {\r\n    try {\r\n      const index = this.mockNotifications.findIndex(n => n.id === id);\r\n      if (index > -1) {\r\n        this.mockNotifications.splice(index, 1);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting notification:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all notifications for current user\r\n   */\r\n  async clearAllNotifications(): Promise<number> {\r\n    try {\r\n      const count = this.mockNotifications.length;\r\n      this.mockNotifications = [];\r\n      return count;\r\n    } catch (error) {\r\n      console.error('Error clearing notifications:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to new notifications\r\n   * In mock mode, simulates periodic checks or manual triggers\r\n   */\r\n  subscribeToNotifications(callback: (notification: Notification) => void): () => void {\r\n    // Store callback\r\n    this.unsubscribeCallbacks.push(callback);\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n      const index = this.unsubscribeCallbacks.indexOf(callback);\r\n      if (index > -1) {\r\n        this.unsubscribeCallbacks.splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Simulate receiving a new notification (for testing/demo purposes)\r\n   */\r\n  simulateNewNotification(notification: Partial<Notification>): void {\r\n    const newNotification: Notification = {\r\n      id: Date.now().toString(),\r\n      user_id: 'user_1',\r\n      type: (notification.type || 'info') as Notification['type'],\r\n      title: notification.title || 'New Notification',\r\n      message: notification.message || '',\r\n      category: notification.category || 'system',\r\n      is_read: false,\r\n      read: false,\r\n      tenant_id: 'tenant_1',\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString(),\r\n      ...notification,\r\n    };\r\n\r\n    // Add to list\r\n    this.mockNotifications.unshift(newNotification);\r\n\r\n    // Notify all subscribers\r\n    this.unsubscribeCallbacks.forEach(cb => cb(newNotification));\r\n  }\r\n\r\n  /**\r\n   * Get unread count\r\n   */\r\n  async getUnreadCount(): Promise<number> {\r\n    try {\r\n      return this.mockNotifications.filter(n => !n.read && !n.is_read).length;\r\n    } catch (error) {\r\n      console.error('Error getting unread count:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get notification statistics\r\n   */\r\n  async getNotificationStats(): Promise<{\r\n    total: number;\r\n    unread: number;\r\n    byType: Record<string, number>;\r\n    byCategory: Record<string, number>;\r\n  }> {\r\n    try {\r\n      const stats = {\r\n        total: this.mockNotifications.length,\r\n        unread: this.mockNotifications.filter(n => !n.read && !n.is_read).length,\r\n        byType: {} as Record<string, number>,\r\n        byCategory: {} as Record<string, number>,\r\n      };\r\n\r\n      this.mockNotifications.forEach(n => {\r\n        stats.byType[n.type] = (stats.byType[n.type] || 0) + 1;\r\n        if (n.category) {\r\n          stats.byCategory[n.category] = (stats.byCategory[n.category] || 0) + 1;\r\n        }\r\n      });\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      console.error('Error getting notification stats:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generic notify method - creates and broadcasts a notification\r\n   * Used by toast hooks for unified notifications\r\n   */\r\n  notify(options: {\r\n    type: 'success' | 'info' | 'warning' | 'error';\r\n    message: string;\r\n    description?: string;\r\n    duration?: number;\r\n    category?: string;\r\n  }): void {\r\n    try {\r\n      const notification: Notification = {\r\n        id: Date.now().toString(),\r\n        user_id: 'user_1',\r\n        type: options.type,\r\n        title: options.message,\r\n        message: options.description || '',\r\n        category: options.category || 'system',\r\n        is_read: false,\r\n        read: false,\r\n        tenant_id: 'tenant_1',\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n      };\r\n\r\n      // Add to notifications list\r\n      this.mockNotifications.unshift(notification);\r\n\r\n      // Keep only last 100 notifications\r\n      if (this.mockNotifications.length > 100) {\r\n        this.mockNotifications = this.mockNotifications.slice(0, 100);\r\n      }\r\n\r\n      // Notify subscribers\r\n      this.unsubscribeCallbacks.forEach(cb => cb(notification));\r\n    } catch (error) {\r\n      console.error('Error in notify method:', error);\r\n    }\r\n  }\r\n}\r\n\r\nexport const notificationService = new MockNotificationService();\r\n\r\nexport default notificationService;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\pdfTemplateService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\performanceMonitoring.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[271,274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[271,274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Performance Monitoring Module for Sales Service\r\n * Tracks operation duration, identifies slow operations, and generates metrics\r\n */\r\n\r\nexport interface PerformanceMetric {\r\n  name: string;\r\n  duration: number;\r\n  timestamp: number;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface PerformanceStats {\r\n  count: number;\r\n  average: number;\r\n  min: number;\r\n  max: number;\r\n  p95: number;\r\n  p99: number;\r\n}\r\n\r\nclass PerformanceMonitor {\r\n  private metrics: PerformanceMetric[] = [];\r\n  private readonly maxMetrics = 1000;\r\n  private readonly slowOperationThreshold = 500; // milliseconds\r\n\r\n  /**\r\n   * Start measuring an operation\r\n   * @param name - Name of the operation to measure\r\n   * @returns Function to call when operation completes\r\n   */\r\n  startMeasure(name: string): () => void {\r\n    const startTime = performance.now();\r\n    const startMark = `${name}_start_${Date.now()}`;\r\n    performance.mark(startMark);\r\n\r\n    return () => {\r\n      const endTime = performance.now();\r\n      const endMark = `${name}_end_${Date.now()}`;\r\n      performance.mark(endMark);\r\n\r\n      const duration = endTime - startTime;\r\n\r\n      try {\r\n        performance.measure(name, startMark, endMark);\r\n      } catch {\r\n        // Ignore if measure fails (can happen if marks are not unique)\r\n      }\r\n\r\n      this.recordMetric({\r\n        name,\r\n        duration,\r\n        timestamp: Date.now(),\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Record a performance metric\r\n   * @param metric - The metric to record\r\n   */\r\n  recordMetric(metric: PerformanceMetric): void {\r\n    this.metrics.push(metric);\r\n\r\n    // Keep array size manageable\r\n    if (this.metrics.length > this.maxMetrics) {\r\n      this.metrics = this.metrics.slice(-this.maxMetrics);\r\n    }\r\n\r\n    // Log slow operations\r\n    if (metric.duration > this.slowOperationThreshold) {\r\n      console.warn(\r\n        `[Performance Warning] Slow operation: ${metric.name} took ${metric.duration.toFixed(2)}ms`\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all metrics or filtered by name\r\n   * @param filterName - Optional name filter (substring match)\r\n   * @returns Array of metrics\r\n   */\r\n  getMetrics(filterName?: string): PerformanceMetric[] {\r\n    if (!filterName) return this.metrics;\r\n    return this.metrics.filter((m) => m.name.includes(filterName));\r\n  }\r\n\r\n  /**\r\n   * Get statistics for metrics matching a name pattern\r\n   * @param filterName - Optional name filter\r\n   * @returns Performance statistics or null if no metrics found\r\n   */\r\n  getStats(filterName?: string): PerformanceStats | null {\r\n    const metrics = this.getMetrics(filterName);\r\n    if (metrics.length === 0) return null;\r\n\r\n    const durations = metrics.map((m) => m.duration);\r\n    const sum = durations.reduce((a, b) => a + b, 0);\r\n\r\n    return {\r\n      count: metrics.length,\r\n      average: sum / metrics.length,\r\n      min: Math.min(...durations),\r\n      max: Math.max(...durations),\r\n      p95: this.calculatePercentile(durations, 95),\r\n      p99: this.calculatePercentile(durations, 99),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate percentile value from array of numbers\r\n   * @param arr - Array of numbers\r\n   * @param percentile - Percentile to calculate (0-100)\r\n   * @returns Percentile value\r\n   */\r\n  private calculatePercentile(arr: number[], percentile: number): number {\r\n    const sorted = [...arr].sort((a, b) => a - b);\r\n    const index = Math.ceil((percentile / 100) * sorted.length) - 1;\r\n    return Math.max(0, sorted[index] || 0);\r\n  }\r\n\r\n  /**\r\n   * Clear all recorded metrics\r\n   */\r\n  clearMetrics(): void {\r\n    this.metrics = [];\r\n  }\r\n\r\n  /**\r\n   * Get summary of all metrics grouped by operation name\r\n   */\r\n  getSummary(): Record<string, PerformanceStats | null> {\r\n    const operationNames = new Set(this.metrics.map((m) => m.name));\r\n    const summary: Record<string, PerformanceStats | null> = {};\r\n\r\n    operationNames.forEach((name) => {\r\n      summary[name] = this.getStats(name);\r\n    });\r\n\r\n    return summary;\r\n  }\r\n\r\n  /**\r\n   * Log summary of all metrics to console\r\n   */\r\n  logSummary(): void {\r\n    const summary = this.getSummary();\r\n    console.group('[Performance Summary]');\r\n    Object.entries(summary).forEach(([name, stats]) => {\r\n      if (stats) {\r\n        console.log(\r\n          `${name}: avg=${stats.average.toFixed(2)}ms, min=${stats.min.toFixed(2)}ms, max=${stats.max.toFixed(2)}ms, p95=${stats.p95.toFixed(2)}ms, p99=${stats.p99.toFixed(2)}ms (n=${stats.count})`\r\n        );\r\n      }\r\n    });\r\n    console.groupEnd();\r\n  }\r\n}\r\n\r\nexport const performanceMonitor = new PerformanceMonitor();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\performanceWrapper.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[479,482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[479,482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[497,500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[497,500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[574,577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[574,577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1117,1120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1117,1120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1135,1138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1135,1138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1198,1201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1198,1201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1316,1319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1316,1319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1670,1673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1670,1673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1680,1683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1680,1683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1750,1753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1750,1753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Performance Tracking Wrapper for Service Methods\r\n * Wraps async functions to automatically measure execution time\r\n */\r\n\r\nimport { performanceMonitor } from './performanceMonitoring';\r\n\r\n/**\r\n * Wrap an async function with performance tracking\r\n * @param fn - The async function to wrap\r\n * @param operationName - Name of the operation for metrics\r\n * @returns Wrapped function with performance tracking\r\n */\r\nexport function withPerformanceTracking<T extends (...args: any[]) => Promise<any>>(\r\n  fn: T,\r\n  operationName: string\r\n): T {\r\n  return (async (...args: any[]) => {\r\n    const endMeasure = performanceMonitor.startMeasure(operationName);\r\n\r\n    try {\r\n      const result = await fn(...args);\r\n      return result;\r\n    } finally {\r\n      endMeasure();\r\n    }\r\n  }) as T;\r\n}\r\n\r\n/**\r\n * Wrap an object of async methods with performance tracking\r\n * @param obj - Object containing async methods\r\n * @param prefix - Prefix for operation names\r\n * @returns Object with all methods wrapped with performance tracking\r\n */\r\nexport function withPerformanceTrackingObject<T extends Record<string, (...args: any[]) => Promise<any>>>(\r\n  obj: T,\r\n  prefix: string\r\n): T {\r\n  const wrapped: any = {};\r\n\r\n  Object.entries(obj).forEach(([key, method]) => {\r\n    wrapped[key] = withPerformanceTracking(method as any, `${prefix}:${key}`);\r\n  });\r\n\r\n  return wrapped as T;\r\n}\r\n\r\n/**\r\n * Wrap synchronous function with performance tracking\r\n * @param fn - The sync function to wrap\r\n * @param operationName - Name of the operation for metrics\r\n * @returns Wrapped function with performance tracking\r\n */\r\nexport function withPerformanceTrackingSync<T extends (...args: any[]) => any>(\r\n  fn: T,\r\n  operationName: string\r\n): T {\r\n  return ((...args: any[]) => {\r\n    const endMeasure = performanceMonitor.startMeasure(operationName);\r\n\r\n    try {\r\n      return fn(...args);\r\n    } finally {\r\n      endMeasure();\r\n    }\r\n  }) as T;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\productSaleService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":546,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":546,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19783,19786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19783,19786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { \r\n  ProductSale, \r\n  ProductSaleFormData, \r\n  ProductSaleFilters, \r\n  ProductSalesResponse,\r\n  FileAttachment\r\n} from '@/types/productSales';\r\nimport type { ProductSalesAnalyticsDTO } from '@/types/dtos/productSalesDtos';\r\nimport { pdfTemplateService } from './pdfTemplateService';\r\nimport { PDFGenerationResponse } from '@/types/pdfTemplates';\r\n\r\nimport { authService } from './authService';\r\n\r\n// Mock data for development - TENANT-AWARE (Aligned with seed.sql data)\r\n// These UUIDs match the seed.sql sample data for consistency\r\nconst mockProductSalesBase: ProductSale[] = [\r\n  {\r\n    id: 'd50e8400-e29b-41d4-a716-446655440001',\r\n    customer_id: 'a50e8400-e29b-41d4-a716-446655440001',\r\n    customer_name: 'ABC Manufacturing',\r\n    product_id: '950e8400-e29b-41d4-a716-446655440003',\r\n    product_name: 'Hydraulic Press Machine',\r\n    units: 1.00,\r\n    cost_per_unit: 75000.00,\r\n    total_cost: 75000.00,\r\n    delivery_date: '2024-09-01',\r\n    warranty_expiry: '2025-09-01',\r\n    status: 'new',\r\n    notes: 'Heavy machinery delivery with installation service included.',\r\n    attachments: [],\r\n    service_contract_id: 'c50e8400-e29b-41d4-a716-446655440001',\r\n    tenant_id: '550e8400-e29b-41d4-a716-446655440001', // Acme Corporation\r\n    created_at: '2024-06-15T10:30:00Z',\r\n    updated_at: '2024-06-15T10:30:00Z',\r\n    created_by: 'a3c91c65-343d-4ff4-b9ab-f36adb371495'\r\n  },\r\n  {\r\n    id: 'd50e8400-e29b-41d4-a716-446655440002',\r\n    customer_id: 'a50e8400-e29b-41d4-a716-446655440002',\r\n    customer_name: 'XYZ Logistics',\r\n    product_id: '950e8400-e29b-41d4-a716-446655440002',\r\n    product_name: 'Sensor Array Kit',\r\n    units: 2.00,\r\n    cost_per_unit: 3500.00,\r\n    total_cost: 7000.00,\r\n    delivery_date: '2024-08-01',\r\n    warranty_expiry: '2025-08-01',\r\n    status: 'new',\r\n    notes: 'IoT sensor kit for warehouse monitoring.',\r\n    attachments: [],\r\n    service_contract_id: 'c50e8400-e29b-41d4-a716-446655440002',\r\n    tenant_id: '550e8400-e29b-41d4-a716-446655440001', // Acme Corporation\r\n    created_at: '2024-06-10T14:20:00Z',\r\n    updated_at: '2024-06-10T14:20:00Z',\r\n    created_by: 'd078f352-e074-4b26-bd3d-94d5751aa50c'\r\n  },\r\n  {\r\n    id: 'd50e8400-e29b-41d4-a716-446655440003',\r\n    customer_id: 'a50e8400-e29b-41d4-a716-446655440004',\r\n    customer_name: 'Innovation Labs',\r\n    product_id: '950e8400-e29b-41d4-a716-446655440005',\r\n    product_name: 'Enterprise CRM License',\r\n    units: 1.00,\r\n    cost_per_unit: 15000.00,\r\n    total_cost: 15000.00,\r\n    delivery_date: '2024-06-01',\r\n    warranty_expiry: '2025-06-01',\r\n    status: 'expired',\r\n    notes: 'CRM software license for startup. Renewal due soon.',\r\n    attachments: [],\r\n    service_contract_id: 'c50e8400-e29b-41d4-a716-446655440003',\r\n    tenant_id: '550e8400-e29b-41d4-a716-446655440002', // Tech Solutions Inc\r\n    created_at: '2024-06-01T10:00:00Z',\r\n    updated_at: '2024-06-01T10:00:00Z',\r\n    created_by: 'e7bf21ab-b09f-450c-a389-081c1f8179b4'\r\n  }\r\n];\r\n\r\nclass ProductSaleService {\r\n  private baseUrl = '/api/product-sale';\r\n\r\n  /**\r\n   * Get tenant ID from context or fallback to auth service\r\n   * Ensures tenant isolation for multi-tenant security\r\n   */\r\n  private getTenantId(tenantId?: string): string {\r\n    if (tenantId) return tenantId;\r\n    \r\n    const user = authService.getCurrentUser();\r\n    if (user && (user as Record<string, unknown>).tenant_id) {\r\n      return (user as Record<string, unknown>).tenant_id as string;\r\n    }\r\n    \r\n    throw new Error('Unauthorized: Unable to determine tenant context');\r\n  }\r\n\r\n  // Get all product sales with filtering and pagination\r\n  async getProductSales(\r\n    filters: ProductSaleFilters = {},\r\n    page: number = 1,\r\n    limit: number = 10,\r\n    tenantId?: string\r\n  ): Promise<ProductSalesResponse> {\r\n    try {\r\n      // Simulate API delay\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n      // Get current tenant and validate authorization\r\n      const finalTenantId = this.getTenantId(tenantId);\r\n\r\n      // Filter by tenant first for security\r\n      let filteredSales = mockProductSalesBase.filter(sale => sale.tenant_id === finalTenantId);\r\n\r\n      // Apply filters\r\n      if (filters.search) {\r\n        const searchLower = filters.search.toLowerCase();\r\n        filteredSales = filteredSales.filter(sale =>\r\n          sale.customer_name?.toLowerCase().includes(searchLower) ||\r\n          sale.product_name?.toLowerCase().includes(searchLower) ||\r\n          sale.notes.toLowerCase().includes(searchLower)\r\n        );\r\n      }\r\n\r\n      if (filters.customer_id) {\r\n        filteredSales = filteredSales.filter(sale => sale.customer_id === filters.customer_id);\r\n      }\r\n\r\n      if (filters.product_id) {\r\n        filteredSales = filteredSales.filter(sale => sale.product_id === filters.product_id);\r\n      }\r\n\r\n      if (filters.status) {\r\n        filteredSales = filteredSales.filter(sale => sale.status === filters.status);\r\n      }\r\n\r\n      if (filters.date_from) {\r\n        filteredSales = filteredSales.filter(sale => sale.delivery_date >= filters.date_from!);\r\n      }\r\n\r\n      if (filters.date_to) {\r\n        filteredSales = filteredSales.filter(sale => sale.delivery_date <= filters.date_to!);\r\n      }\r\n\r\n      if (filters.min_amount) {\r\n        filteredSales = filteredSales.filter(sale => sale.total_cost >= filters.min_amount!);\r\n      }\r\n\r\n      if (filters.max_amount) {\r\n        filteredSales = filteredSales.filter(sale => sale.total_cost <= filters.max_amount!);\r\n      }\r\n\r\n      if (filters.sale_id) {\r\n        const saleIdLower = filters.sale_id.toLowerCase();\r\n        filteredSales = filteredSales.filter(sale => sale.id.toLowerCase().includes(saleIdLower));\r\n      }\r\n\r\n      if (filters.customer_name) {\r\n        const customerLower = filters.customer_name.toLowerCase();\r\n        filteredSales = filteredSales.filter(sale => \r\n          sale.customer_name?.toLowerCase().includes(customerLower)\r\n        );\r\n      }\r\n\r\n      if (filters.product_name) {\r\n        const productLower = filters.product_name.toLowerCase();\r\n        filteredSales = filteredSales.filter(sale => \r\n          sale.product_name?.toLowerCase().includes(productLower)\r\n        );\r\n      }\r\n\r\n      if (filters.notes) {\r\n        const notesLower = filters.notes.toLowerCase();\r\n        filteredSales = filteredSales.filter(sale => \r\n          sale.notes.toLowerCase().includes(notesLower)\r\n        );\r\n      }\r\n\r\n      if (filters.min_price) {\r\n        filteredSales = filteredSales.filter(sale => sale.total_cost >= filters.min_price!);\r\n      }\r\n\r\n      if (filters.max_price) {\r\n        filteredSales = filteredSales.filter(sale => sale.total_cost <= filters.max_price!);\r\n      }\r\n\r\n      if (filters.warranty_status) {\r\n        const now = new Date();\r\n        filteredSales = filteredSales.filter(sale => {\r\n          const warrantyDate = new Date(sale.warranty_expiry);\r\n          const thirtyDaysFromNow = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n          \r\n          if (filters.warranty_status === 'active') {\r\n            return warrantyDate > now;\r\n          } else if (filters.warranty_status === 'expiring_soon') {\r\n            return warrantyDate > now && warrantyDate <= thirtyDaysFromNow;\r\n          } else if (filters.warranty_status === 'expired') {\r\n            return warrantyDate <= now;\r\n          }\r\n          return true;\r\n        });\r\n      }\r\n\r\n      if (filters.start_date) {\r\n        filteredSales = filteredSales.filter(sale => sale.delivery_date >= filters.start_date!);\r\n      }\r\n\r\n      if (filters.end_date) {\r\n        filteredSales = filteredSales.filter(sale => sale.delivery_date <= filters.end_date!);\r\n      }\r\n\r\n      // Pagination\r\n      const total = filteredSales.length;\r\n      const totalPages = Math.ceil(total / limit);\r\n      const startIndex = (page - 1) * limit;\r\n      const endIndex = startIndex + limit;\r\n      const data = filteredSales.slice(startIndex, endIndex);\r\n\r\n      return {\r\n        data,\r\n        total,\r\n        page,\r\n        limit,\r\n        totalPages\r\n      };\r\n    } catch (error) {\r\n      console.error('Error fetching product sales:', error);\r\n      throw new Error('Failed to fetch product sales');\r\n    }\r\n  }\r\n\r\n  // Get single product sale by ID\r\n  async getProductSaleById(id: string, tenantId?: string): Promise<ProductSale> {\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n      // Get current tenant and validate authorization\r\n      const finalTenantId = this.getTenantId(tenantId);\r\n\r\n      const sale = mockProductSalesBase.find(\r\n        s => s.id === id && s.tenant_id === finalTenantId\r\n      );\r\n      \r\n      if (!sale) {\r\n        throw new Error('Product sale not found');\r\n      }\r\n\r\n      return sale;\r\n    } catch (error) {\r\n      console.error('Error fetching product sale:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Create new product sale\r\n  async createProductSale(data: ProductSaleFormData, tenantId?: string): Promise<ProductSale> {\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 800));\r\n\r\n      // Get current tenant and validate authorization\r\n      const finalTenantId = this.getTenantId(tenantId);\r\n      const user = authService.getCurrentUser() as Record<string, unknown>;\r\n\r\n      // Calculate warranty expiry (delivery date + 1 year)\r\n      const deliveryDate = new Date(data.delivery_date);\r\n      const warrantyExpiry = new Date(deliveryDate);\r\n      warrantyExpiry.setFullYear(warrantyExpiry.getFullYear() + 1);\r\n\r\n      // Determine status based on warranty expiry\r\n      const now = new Date();\r\n      let status: 'new' | 'renewed' | 'expired' = 'new';\r\n      if (warrantyExpiry < now) {\r\n        status = 'expired';\r\n      }\r\n\r\n      const newSale: ProductSale = {\r\n        id: `ps-${Date.now()}`,\r\n        customer_id: data.customer_id,\r\n        customer_name: 'Customer Name', // Would be fetched from customer service\r\n        product_id: data.product_id,\r\n        product_name: 'Product Name', // Would be fetched from product service\r\n        units: data.units,\r\n        cost_per_unit: data.cost_per_unit,\r\n        total_cost: data.units * data.cost_per_unit,\r\n        delivery_date: data.delivery_date,\r\n        warranty_expiry: warrantyExpiry.toISOString().split('T')[0],\r\n        status,\r\n        notes: data.notes,\r\n        attachments: [], // File uploads would be handled separately\r\n        tenant_id: finalTenantId,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        created_by: (user?.id as string) || 'system'\r\n      };\r\n\r\n      // Add to mock data\r\n      mockProductSalesBase.unshift(newSale);\r\n\r\n      // Auto-generate service contract\r\n      await this.createServiceContract(newSale);\r\n\r\n      return newSale;\r\n    } catch (error) {\r\n      console.error('Error creating product sale:', error);\r\n      throw new Error('Failed to create product sale');\r\n    }\r\n  }\r\n\r\n  // Update existing product sale\r\n  async updateProductSale(id: string, data: Partial<ProductSaleFormData>, tenantId?: string): Promise<ProductSale> {\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 600));\r\n\r\n      // Get current tenant and validate authorization\r\n      const finalTenantId = this.getTenantId(tenantId);\r\n\r\n      const index = mockProductSalesBase.findIndex(\r\n        s => s.id === id && s.tenant_id === finalTenantId\r\n      );\r\n      \r\n      if (index === -1) {\r\n        throw new Error('Product sale not found');\r\n      }\r\n\r\n      const existingSale = mockProductSalesBase[index];\r\n      const updatedSale: ProductSale = {\r\n        ...existingSale,\r\n        ...data,\r\n        total_cost: data.units && data.cost_per_unit \r\n          ? data.units * data.cost_per_unit \r\n          : existingSale.total_cost,\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      // Recalculate warranty expiry if delivery date changed\r\n      if (data.delivery_date) {\r\n        const deliveryDate = new Date(data.delivery_date);\r\n        const warrantyExpiry = new Date(deliveryDate);\r\n        warrantyExpiry.setFullYear(warrantyExpiry.getFullYear() + 1);\r\n        updatedSale.warranty_expiry = warrantyExpiry.toISOString().split('T')[0];\r\n\r\n        // Update status based on new warranty expiry\r\n        const now = new Date();\r\n        if (warrantyExpiry < now) {\r\n          updatedSale.status = 'expired';\r\n        } else {\r\n          updatedSale.status = 'new';\r\n        }\r\n      }\r\n\r\n      mockProductSalesBase[index] = updatedSale;\r\n      return updatedSale;\r\n    } catch (error) {\r\n      console.error('Error updating product sale:', error);\r\n      throw new Error('Failed to update product sale');\r\n    }\r\n  }\r\n\r\n  // Delete product sale\r\n  async deleteProductSale(id: string, tenantId?: string): Promise<void> {\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 400));\r\n\r\n      // Get current tenant and validate authorization\r\n      const finalTenantId = this.getTenantId(tenantId);\r\n\r\n      const index = mockProductSalesBase.findIndex(\r\n        s => s.id === id && s.tenant_id === finalTenantId\r\n      );\r\n      \r\n      if (index === -1) {\r\n        throw new Error('Product sale not found');\r\n      }\r\n\r\n      mockProductSalesBase.splice(index, 1);\r\n    } catch (error) {\r\n      console.error('Error deleting product sale:', error);\r\n      throw new Error('Failed to delete product sale');\r\n    }\r\n  }\r\n\r\n  // Get product sales analytics\r\n  async getProductSalesAnalytics(tenantId?: string): Promise<ProductSalesAnalyticsDTO> {\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 600));\r\n\r\n      // Get current tenant and validate authorization\r\n      const finalTenantId = this.getTenantId(tenantId);\r\n\r\n      // Filter by tenant\r\n      const tenantSales = mockProductSalesBase.filter(sale => sale.tenant_id === finalTenantId);\r\n      \r\n      const totalSales = tenantSales.length;\r\n      const totalRevenue = tenantSales.reduce((sum, sale) => sum + sale.total_cost, 0);\r\n      const averageDealSize = totalSales > 0 ? totalRevenue / totalSales : 0;\r\n\r\n      // Mock monthly data\r\n      const salesByMonth = [\r\n        { month: '2024-01', sales_count: 5, revenue: 25000 },\r\n        { month: '2024-02', sales_count: 8, revenue: 42000 },\r\n        { month: '2024-03', sales_count: 12, revenue: 68000 },\r\n        { month: '2024-04', sales_count: 15, revenue: 85000 },\r\n        { month: '2024-05', sales_count: 18, revenue: 95000 },\r\n        { month: '2024-06', sales_count: 22, revenue: 125000 }\r\n      ];\r\n\r\n      // Top products\r\n      const topProducts = [\r\n        { product_id: 'prod-001', product_name: 'Enterprise CRM Suite', total_sales: 15, total_revenue: 125000, units_sold: 45 },\r\n        { product_id: 'prod-002', product_name: 'Analytics Dashboard Pro', total_sales: 8, total_revenue: 65000, units_sold: 28 },\r\n        { product_id: 'prod-003', product_name: 'Security Module', total_sales: 5, total_revenue: 35000, units_sold: 15 }\r\n      ];\r\n\r\n      // Top customers\r\n      const topCustomers = [\r\n        { customer_id: 'cust-001', customer_name: 'Acme Corporation', total_sales: 3, total_revenue: 45000, last_purchase: '2024-06-15' },\r\n        { customer_id: 'cust-002', customer_name: 'TechStart Inc', total_sales: 2, total_revenue: 28000, last_purchase: '2024-06-10' },\r\n        { customer_id: 'cust-003', customer_name: 'Global Enterprises', total_sales: 4, total_revenue: 85000, last_purchase: '2024-06-20' }\r\n      ];\r\n\r\n      // Status distribution\r\n      const statusCounts = tenantSales.reduce((acc, sale) => {\r\n        acc[sale.status] = (acc[sale.status] || 0) + 1;\r\n        return acc;\r\n      }, {} as Record<string, number>);\r\n\r\n      const statusDistribution = Object.entries(statusCounts).map(([status, count]) => ({\r\n        status,\r\n        count,\r\n        percentage: totalSales > 0 ? (count / totalSales) * 100 : 0\r\n      }));\r\n\r\n      // Warranty expiring soon (within 30 days)\r\n      const thirtyDaysFromNow = new Date();\r\n      thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\r\n      \r\n      const warrantyExpiringSoon = tenantSales.filter(sale => {\r\n        const warrantyDate = new Date(sale.warranty_expiry);\r\n        return warrantyDate <= thirtyDaysFromNow && warrantyDate >= new Date();\r\n      });\r\n\r\n      return {\r\n        totalSales: totalSales,\r\n        totalRevenue: totalRevenue,\r\n        averageSaleValue: averageDealSize,\r\n        completedSales: totalSales,\r\n        pendingSales: 0,\r\n        totalQuantity: tenantSales.reduce((sum, sale) => sum + sale.units, 0),\r\n        revenueByMonth: Object.fromEntries(\r\n          salesByMonth.map(m => [m.month, m.revenue])\r\n        ),\r\n        topProducts: topProducts.map(p => ({\r\n          productId: p.product_id,\r\n          productName: p.product_name,\r\n          quantity: p.units_sold,\r\n          revenue: p.total_revenue,\r\n        })),\r\n        topCustomers: topCustomers.map(c => ({\r\n          customerId: c.customer_id,\r\n          customerName: c.customer_name,\r\n          totalSales: c.total_sales,\r\n          revenue: c.total_revenue,\r\n        })),\r\n        byStatus: statusDistribution,\r\n        lastUpdated: new Date().toISOString(),\r\n      } as ProductSalesAnalyticsDTO;\r\n    } catch (error) {\r\n      console.error('Error fetching analytics:', error);\r\n      throw new Error('Failed to fetch analytics');\r\n    }\r\n  }\r\n\r\n  // Upload file attachment\r\n  async uploadAttachment(saleId: string, file: File): Promise<FileAttachment> {\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n      const attachment: FileAttachment = {\r\n        id: `att-${Date.now()}`,\r\n        name: file.name,\r\n        size: file.size,\r\n        type: file.type,\r\n        url: `/api/files/att-${Date.now()}`,\r\n        uploaded_at: new Date().toISOString()\r\n      };\r\n\r\n      // Add attachment to the sale\r\n      const sale = mockProductSales.find(s => s.id === saleId);\r\n      if (sale) {\r\n        sale.attachments.push(attachment);\r\n      }\r\n\r\n      return attachment;\r\n    } catch (error) {\r\n      console.error('Error uploading attachment:', error);\r\n      throw new Error('Failed to upload attachment');\r\n    }\r\n  }\r\n\r\n  // Delete file attachment\r\n  async deleteAttachment(saleId: string, attachmentId: string): Promise<void> {\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n      const sale = mockProductSales.find(s => s.id === saleId);\r\n      if (sale) {\r\n        const index = sale.attachments.findIndex(att => att.id === attachmentId);\r\n        if (index !== -1) {\r\n          sale.attachments.splice(index, 1);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting attachment:', error);\r\n      throw new Error('Failed to delete attachment');\r\n    }\r\n  }\r\n\r\n  // Generate PDF for product sale\r\n  async generatePdf(saleId: string): Promise<PDFGenerationResponse> {\r\n    try {\r\n      const sale = mockProductSales.find(s => s.id === saleId);\r\n      if (!sale) {\r\n        throw new Error('Product sale not found');\r\n      }\r\n\r\n      const pdfData = await pdfTemplateService.generatePdf(sale);\r\n      return pdfData;\r\n    } catch (error) {\r\n      console.error('Error generating PDF:', error);\r\n      throw new Error('Failed to generate PDF');\r\n    }\r\n  }\r\n\r\n  // Generate PDF for product sales report\r\n  async generateReportPdf(filters: ProductSaleFilters): Promise<PDFGenerationResponse> {\r\n    try {\r\n      const sales = await this.getProductSales(filters);\r\n      const pdfData = await pdfTemplateService.generateReportPdf(sales);\r\n      return pdfData;\r\n    } catch (error) {\r\n      console.error('Error generating report PDF:', error);\r\n      throw new Error('Failed to generate report PDF');\r\n    }\r\n  }\r\n\r\n  // Generate service contract from product sale\r\n  async generateServiceContract(saleId: string): Promise<any> {\r\n    try {\r\n      const sale = await this.getProductSaleById(saleId);\r\n      \r\n      // Generate contract number\r\n      const currentYear = new Date().getFullYear();\r\n      const randomSuffix = Math.floor(Math.random() * 10000).toString().padStart(4, '0');\r\n      const contractNumber = `SC-${currentYear}-${randomSuffix}`;\r\n      \r\n      // Create service contract data\r\n      const serviceContractData = {\r\n        product_sale_id: sale.id,\r\n        contract_number: contractNumber,\r\n        customer_id: sale.customer_id,\r\n        customer_name: sale.customer_name,\r\n        product_id: sale.product_id,\r\n        product_name: sale.product_name,\r\n        start_date: sale.delivery_date,\r\n        end_date: sale.warranty_expiry,\r\n        status: 'active',\r\n        contract_value: sale.total_cost,\r\n        annual_value: sale.total_cost,\r\n        terms: 'Standard service contract terms. Service provider will provide technical support and maintenance.',\r\n        warranty_period: 12,\r\n        service_level: 'standard' as const,\r\n        auto_renewal: true,\r\n        renewal_notice_period: 60,\r\n        tenant_id: sale.tenant_id,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        created_by: sale.created_by\r\n      };\r\n      \r\n      // In production, this would be saved to the database\r\n      console.log('Generated service contract:', serviceContractData);\r\n      \r\n      return serviceContractData;\r\n    } catch (error) {\r\n      console.error('Error generating service contract:', error);\r\n      throw new Error('Failed to generate service contract');\r\n    }\r\n  }\r\n\r\n  // Private method to auto-create service contract\r\n  private async createServiceContract(productSale: ProductSale): Promise<void> {\r\n    try {\r\n      // Auto-generate service contract when product sale is created\r\n      await this.generateServiceContract(productSale.id);\r\n    } catch (error) {\r\n      console.error('Error creating service contract:', error);\r\n      // Don't throw error here as it shouldn't block the product sale creation\r\n    }\r\n  }\r\n\r\n  // Generate Contract PDF for product sale\r\n  async generateContractPDF(saleId: string): Promise<PDFGenerationResponse> {\r\n    try {\r\n      const sale = await this.getProductSaleById(saleId);\r\n      const templates = await pdfTemplateService.getTemplates();\r\n      const contractTemplate = templates.find(t => t.type === 'contract' && t.isDefault);\r\n      \r\n      if (!contractTemplate) {\r\n        throw new Error('No default contract template found');\r\n      }\r\n\r\n      return await pdfTemplateService.generatePDF({\r\n        templateId: contractTemplate.id,\r\n        data: {\r\n          customerName: sale.customer_name,\r\n          companyName: 'Your Company Name',\r\n          deliveryDate: sale.delivery_date,\r\n          totalAmount: `$${sale.total_cost.toFixed(2)}`,\r\n          productName: sale.product_name,\r\n          warrantyPeriod: '1 Year',\r\n          contractNumber: `CNT-${sale.id}`\r\n        },\r\n        fileName: `contract_${sale.id}.pdf`\r\n      });\r\n    } catch (error) {\r\n      console.error('Error generating contract PDF:', error);\r\n      throw new Error('Failed to generate contract PDF');\r\n    }\r\n  }\r\n\r\n  // Generate Receipt PDF for product sale\r\n  async generateReceiptPDF(saleId: string): Promise<PDFGenerationResponse> {\r\n    try {\r\n      const sale = await this.getProductSaleById(saleId);\r\n      const templates = await pdfTemplateService.getTemplates();\r\n      const receiptTemplate = templates.find(t => t.type === 'receipt' && t.isDefault);\r\n      \r\n      if (!receiptTemplate) {\r\n        throw new Error('No default receipt template found');\r\n      }\r\n\r\n      return await pdfTemplateService.generatePDF({\r\n        templateId: receiptTemplate.id,\r\n        data: {\r\n          customerName: sale.customer_name,\r\n          companyName: 'Your Company Name',\r\n          deliveryDate: sale.delivery_date,\r\n          totalAmount: `$${sale.total_cost.toFixed(2)}`,\r\n          productName: sale.product_name,\r\n          quantity: sale.units.toString(),\r\n          unitPrice: `$${sale.cost_per_unit.toFixed(2)}`,\r\n          receiptNumber: `RCP-${sale.id}`\r\n        },\r\n        fileName: `receipt_${sale.id}.pdf`\r\n      });\r\n    } catch (error) {\r\n      console.error('Error generating receipt PDF:', error);\r\n      throw new Error('Failed to generate receipt PDF');\r\n    }\r\n  }\r\n}\r\n\r\nexport const productSaleService = new ProductSaleService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\productService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\pushService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\rbacService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17033,17036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17033,17036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Permission, Role, UserRole, AuditLog, RoleTemplate, PermissionMatrix } from '@/types/rbac';\r\nimport { User } from '@/types/auth';\r\nimport { authService } from './authService';\r\n\r\nclass RBACService {\r\n  private baseUrl = '/api/rbac';\r\n\r\n  // Mock permissions data\r\n  private mockPermissions: Permission[] = [\r\n    // Core permissions\r\n    { id: 'read', name: 'Read', description: 'View and read data', category: 'core', resource: '*', action: 'read' },\r\n    { id: 'write', name: 'Write', description: 'Create and edit data', category: 'core', resource: '*', action: 'write' },\r\n    { id: 'delete', name: 'Delete', description: 'Delete data', category: 'core', resource: '*', action: 'delete' },\r\n    \r\n    // Module permissions\r\n    { id: 'manage_customers', name: 'Manage Customers', description: 'Manage customer data and relationships', category: 'module', resource: 'customers', action: 'manage' },\r\n    { id: 'manage_sales', name: 'Manage Sales', description: 'Manage sales processes and deals', category: 'module', resource: 'sales', action: 'manage' },\r\n    { id: 'manage_tickets', name: 'Manage Tickets', description: 'Manage support tickets and issues', category: 'module', resource: 'tickets', action: 'manage' },\r\n    { id: 'manage_complaints', name: 'Manage Complaints', description: 'Handle customer complaints', category: 'module', resource: 'complaints', action: 'manage' },\r\n    { id: 'manage_contracts', name: 'Manage Contracts', description: 'Manage service contracts and agreements', category: 'module', resource: 'contracts', action: 'manage' },\r\n    { id: 'manage_service_contracts', name: 'Manage Service Contracts', description: 'Manage service contracts and agreements', category: 'module', resource: 'service_contracts', action: 'manage' },\r\n    { id: 'manage_products', name: 'Manage Products', description: 'Manage product catalog and inventory', category: 'module', resource: 'products', action: 'manage' },\r\n    { id: 'manage_product_sales', name: 'Manage Product Sales', description: 'Manage product sales and transactions', category: 'module', resource: 'product_sales', action: 'manage' },\r\n    { id: 'manage_job_works', name: 'Manage Job Works', description: 'Manage job work orders and tasks', category: 'module', resource: 'job_works', action: 'manage' },\r\n    \r\n    // Administrative permissions\r\n    { id: 'manage_users', name: 'Manage Users', description: 'Manage user accounts and access', category: 'administrative', resource: 'users', action: 'manage' },\r\n    { id: 'manage_roles', name: 'Manage Roles', description: 'Manage roles and permissions', category: 'administrative', resource: 'roles', action: 'manage' },\r\n    { id: 'view_analytics', name: 'View Analytics', description: 'Access analytics and reports', category: 'administrative', resource: 'analytics', action: 'view' },\r\n    { id: 'manage_settings', name: 'Manage Settings', description: 'Configure system settings', category: 'administrative', resource: 'settings', action: 'manage' },\r\n    { id: 'manage_companies', name: 'Manage Companies', description: 'Manage company information', category: 'administrative', resource: 'companies', action: 'manage' },\r\n    \r\n    // System permissions\r\n    { id: 'platform_admin', name: 'Platform Admin', description: 'Platform administration access', category: 'system', resource: 'platform', action: 'admin' },\r\n    { id: 'super_admin', name: 'Super Admin', description: 'Full system administration', category: 'system', resource: 'system', action: 'admin' },\r\n    { id: 'manage_tenants', name: 'Manage Tenants', description: 'Manage tenant accounts', category: 'system', resource: 'tenants', action: 'manage' },\r\n    { id: 'system_monitoring', name: 'System Monitoring', description: 'Monitor system health and performance', category: 'system', resource: 'system', action: 'monitor' }\r\n  ];\r\n\r\n  // Mock roles data\r\n  private mockRoles: Role[] = [\r\n    {\r\n      id: 'super_admin_role',\r\n      name: 'Super Administrator',\r\n      description: 'Full platform administration with all permissions',\r\n      tenant_id: 'platform',\r\n      permissions: ['read', 'write', 'delete', 'manage_customers', 'manage_sales', 'manage_tickets', 'manage_complaints', 'manage_contracts', 'manage_service_contracts', 'manage_products', 'manage_product_sales', 'manage_job_works', 'manage_users', 'manage_roles', 'view_analytics', 'manage_settings', 'manage_companies', 'platform_admin', 'super_admin', 'manage_tenants', 'system_monitoring'],\r\n      is_system_role: true,\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: 'admin_role',\r\n      name: 'Administrator',\r\n      description: 'Tenant administrator with full tenant permissions',\r\n      tenant_id: 'techcorp',\r\n      permissions: ['read', 'write', 'delete', 'manage_customers', 'manage_sales', 'manage_tickets', 'manage_complaints', 'manage_contracts', 'manage_service_contracts', 'manage_products', 'manage_product_sales', 'manage_job_works', 'manage_users', 'manage_roles', 'view_analytics', 'manage_settings', 'manage_companies'],\r\n      is_system_role: true,\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: 'manager_role',\r\n      name: 'Manager',\r\n      description: 'Business operations manager with analytics access',\r\n      tenant_id: 'techcorp',\r\n      permissions: ['read', 'write', 'manage_customers', 'manage_sales', 'manage_tickets', 'manage_complaints', 'manage_contracts', 'manage_service_contracts', 'manage_products', 'manage_product_sales', 'view_analytics'],\r\n      is_system_role: true,\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: 'agent_role',\r\n      name: 'Agent',\r\n      description: 'Customer service agent with basic operations',\r\n      tenant_id: 'techcorp',\r\n      permissions: ['read', 'write', 'manage_customers', 'manage_tickets', 'manage_complaints'],\r\n      is_system_role: true,\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: 'engineer_role',\r\n      name: 'Engineer',\r\n      description: 'Technical engineer with product and job work access',\r\n      tenant_id: 'techcorp',\r\n      permissions: ['read', 'write', 'manage_products', 'manage_product_sales', 'manage_job_works', 'manage_tickets'],\r\n      is_system_role: true,\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: 'customer_role',\r\n      name: 'Customer',\r\n      description: 'Customer with read-only access to own data',\r\n      tenant_id: 'techcorp',\r\n      permissions: ['read'],\r\n      is_system_role: true,\r\n      created_at: '2024-01-01T00:00:00Z',\r\n      updated_at: '2024-01-01T00:00:00Z'\r\n    }\r\n  ];\r\n\r\n  // Mock role templates\r\n  private mockRoleTemplates: RoleTemplate[] = [\r\n    {\r\n      id: 'business_admin',\r\n      name: 'Business Administrator',\r\n      description: 'Complete business operations management',\r\n      permissions: ['read', 'write', 'delete', 'manage_customers', 'manage_sales', 'manage_contracts', 'manage_service_contracts', 'manage_products', 'manage_product_sales', 'view_analytics', 'manage_companies'],\r\n      is_default: true,\r\n      category: 'business'\r\n    },\r\n    {\r\n      id: 'sales_manager',\r\n      name: 'Sales Manager',\r\n      description: 'Sales operations and customer management',\r\n      permissions: ['read', 'write', 'manage_customers', 'manage_sales', 'manage_contracts', 'manage_service_contracts', 'manage_products', 'manage_product_sales', 'view_analytics'],\r\n      is_default: true,\r\n      category: 'business'\r\n    },\r\n    {\r\n      id: 'support_agent',\r\n      name: 'Support Agent',\r\n      description: 'Customer support and ticket management',\r\n      permissions: ['read', 'write', 'manage_customers', 'manage_tickets', 'manage_complaints'],\r\n      is_default: true,\r\n      category: 'business'\r\n    },\r\n    {\r\n      id: 'technical_lead',\r\n      name: 'Technical Lead',\r\n      description: 'Technical operations and product management',\r\n      permissions: ['read', 'write', 'manage_products', 'manage_product_sales', 'manage_job_works', 'manage_tickets'],\r\n      is_default: true,\r\n      category: 'technical'\r\n    },\r\n    {\r\n      id: 'system_admin',\r\n      name: 'System Administrator',\r\n      description: 'System administration and user management',\r\n      permissions: ['read', 'write', 'delete', 'manage_users', 'manage_roles', 'manage_settings'],\r\n      is_default: true,\r\n      category: 'administrative'\r\n    }\r\n  ];\r\n\r\n  // Mock audit logs\r\n  private mockAuditLogs: AuditLog[] = [\r\n    {\r\n      id: 'audit_1',\r\n      user_id: 'admin_techcorp_1',\r\n      action: 'role_assigned',\r\n      resource: 'user',\r\n      resource_id: 'agent_techcorp_1',\r\n      details: { old_role: 'customer', new_role: 'agent', assigned_by: 'admin_techcorp_1' },\r\n      ip_address: '192.168.1.100',\r\n      user_agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\r\n      tenant_id: 'techcorp',\r\n      timestamp: new Date(Date.now() - 86400000).toISOString()\r\n    },\r\n    {\r\n      id: 'audit_2',\r\n      user_id: 'manager_techcorp_1',\r\n      action: 'permission_granted',\r\n      resource: 'role',\r\n      resource_id: 'custom_role_1',\r\n      details: { permission: 'view_analytics', granted_by: 'admin_techcorp_1' },\r\n      ip_address: '192.168.1.101',\r\n      user_agent: 'Mozilla/5.0 (macOS; Intel Mac OS X 10_15_7) AppleWebKit/537.36',\r\n      tenant_id: 'techcorp',\r\n      timestamp: new Date(Date.now() - 172800000).toISOString()\r\n    }\r\n  ];\r\n\r\n  async getPermissions(): Promise<Permission[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    return this.mockPermissions;\r\n  }\r\n\r\n  async getRoles(tenantId?: string): Promise<Role[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    \r\n    const currentUser = authService.getCurrentUser();\r\n    if (!currentUser) return [];\r\n\r\n    if (currentUser.role === 'super_admin') {\r\n      return tenantId ? this.mockRoles.filter(r => r.tenant_id === tenantId) : this.mockRoles;\r\n    }\r\n\r\n    return this.mockRoles.filter(r => r.tenant_id === currentUser.tenant_id);\r\n  }\r\n\r\n  async createRole(roleData: Omit<Role, 'id' | 'created_at' | 'updated_at'>): Promise<Role> {\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n    \r\n    const newRole: Role = {\r\n      ...roleData,\r\n      id: `role_${Date.now()}`,\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    this.mockRoles.push(newRole);\r\n    return newRole;\r\n  }\r\n\r\n  async updateRole(roleId: string, updates: Partial<Role>): Promise<Role> {\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n    \r\n    const roleIndex = this.mockRoles.findIndex(r => r.id === roleId);\r\n    if (roleIndex === -1) throw new Error('Role not found');\r\n\r\n    this.mockRoles[roleIndex] = {\r\n      ...this.mockRoles[roleIndex],\r\n      ...updates,\r\n      updated_at: new Date().toISOString()\r\n    };\r\n\r\n    return this.mockRoles[roleIndex];\r\n  }\r\n\r\n  async deleteRole(roleId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    \r\n    const roleIndex = this.mockRoles.findIndex(r => r.id === roleId);\r\n    if (roleIndex === -1) throw new Error('Role not found');\r\n\r\n    if (this.mockRoles[roleIndex].is_system_role) {\r\n      throw new Error('Cannot delete system role');\r\n    }\r\n\r\n    this.mockRoles.splice(roleIndex, 1);\r\n  }\r\n\r\n  async assignUserRole(userId: string, roleId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    \r\n    // In a real implementation, this would update the user's role in the database\r\n    // For now, we'll just simulate the operation\r\n    console.log(`Assigned role ${roleId} to user ${userId}`);\r\n  }\r\n\r\n  async removeUserRole(userId: string, roleId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    \r\n    console.log(`Removed role ${roleId} from user ${userId}`);\r\n  }\r\n\r\n  async getPermissionMatrix(tenantId?: string): Promise<PermissionMatrix> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    \r\n    const roles = await this.getRoles(tenantId);\r\n    const permissions = this.mockPermissions;\r\n    \r\n    const matrix: Record<string, Record<string, boolean>> = {};\r\n    \r\n    roles.forEach(role => {\r\n      matrix[role.id] = {};\r\n      permissions.forEach(permission => {\r\n        matrix[role.id][permission.id] = role.permissions.includes(permission.id);\r\n      });\r\n    });\r\n\r\n    return {\r\n      roles,\r\n      permissions,\r\n      matrix\r\n    };\r\n  }\r\n\r\n  async getRoleTemplates(): Promise<RoleTemplate[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    return this.mockRoleTemplates;\r\n  }\r\n\r\n  async createRoleFromTemplate(templateId: string, roleName: string, tenantId: string): Promise<Role> {\r\n    const template = this.mockRoleTemplates.find(t => t.id === templateId);\r\n    if (!template) throw new Error('Template not found');\r\n\r\n    return this.createRole({\r\n      name: roleName,\r\n      description: template.description,\r\n      tenant_id: tenantId,\r\n      permissions: [...template.permissions],\r\n      is_system_role: false\r\n    });\r\n  }\r\n\r\n  async getAuditLogs(filters?: {\r\n    user_id?: string;\r\n    action?: string;\r\n    resource?: string;\r\n    tenant_id?: string;\r\n    start_date?: string;\r\n    end_date?: string;\r\n  }): Promise<AuditLog[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n    \r\n    let logs = [...this.mockAuditLogs];\r\n    \r\n    if (filters) {\r\n      if (filters.user_id) {\r\n        logs = logs.filter(log => log.user_id === filters.user_id);\r\n      }\r\n      if (filters.action) {\r\n        logs = logs.filter(log => log.action === filters.action);\r\n      }\r\n      if (filters.resource) {\r\n        logs = logs.filter(log => log.resource === filters.resource);\r\n      }\r\n      if (filters.tenant_id) {\r\n        logs = logs.filter(log => log.tenant_id === filters.tenant_id);\r\n      }\r\n      if (filters.start_date) {\r\n        logs = logs.filter(log => log.timestamp >= filters.start_date!);\r\n      }\r\n      if (filters.end_date) {\r\n        logs = logs.filter(log => log.timestamp <= filters.end_date!);\r\n      }\r\n    }\r\n\r\n    return logs.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\r\n  }\r\n\r\n  async logAction(action: string, resource: string, resourceId?: string, details?: Record<string, unknown>): Promise<void> {\r\n    const currentUser = authService.getCurrentUser();\r\n    if (!currentUser) return;\r\n\r\n    const auditLog: AuditLog = {\r\n      id: `audit_${Date.now()}`,\r\n      user_id: currentUser.id,\r\n      action,\r\n      resource,\r\n      resource_id: resourceId,\r\n      details: details || {},\r\n      ip_address: '192.168.1.1', // In real implementation, get from request\r\n      user_agent: navigator.userAgent,\r\n      tenant_id: currentUser.tenant_id,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n\r\n    this.mockAuditLogs.unshift(auditLog);\r\n  }\r\n\r\n  async getUsersByRole(roleId: string): Promise<User[]> {\r\n    await new Promise(resolve => setTimeout(resolve, 300));\r\n    \r\n    // In a real implementation, this would query users with the specific role\r\n    // For now, we'll return mock data based on role names\r\n    const role = this.mockRoles.find(r => r.id === roleId);\r\n    if (!role) return [];\r\n\r\n    const users = authService.getTenantUsers();\r\n    return users.filter(user => {\r\n      // Simple mapping based on role names\r\n      const roleNameMap: Record<string, string> = {\r\n        'admin_role': 'admin',\r\n        'manager_role': 'manager',\r\n        'agent_role': 'agent',\r\n        'engineer_role': 'engineer',\r\n        'customer_role': 'customer'\r\n      };\r\n      return user.role === roleNameMap[roleId];\r\n    });\r\n  }\r\n\r\n  async bulkAssignRole(userIds: string[], roleId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n    \r\n    for (const userId of userIds) {\r\n      await this.assignUserRole(userId, roleId);\r\n    }\r\n  }\r\n\r\n  async bulkRemoveRole(userIds: string[], roleId: string): Promise<void> {\r\n    await new Promise(resolve => setTimeout(resolve, 1000));\r\n    \r\n    for (const userId of userIds) {\r\n      await this.removeUserRole(userId, roleId);\r\n    }\r\n  }\r\n\r\n  getPermissionsByCategory(): Record<string, Permission[]> {\r\n    return this.mockPermissions.reduce((acc, permission) => {\r\n      if (!acc[permission.category]) {\r\n        acc[permission.category] = [];\r\n      }\r\n      acc[permission.category].push(permission);\r\n      return acc;\r\n    }, {} as Record<string, Permission[]>);\r\n  }\r\n\r\n  /**\r\n   * Check if action is permitted (overloaded method signature)\r\n   * Accepts either:\r\n   * 1. An action string + optional context (for module-specific RBAC checks)\r\n   * 2. An array of permission IDs (for traditional permission validation)\r\n   */\r\n  validateRolePermissions(actionOrPermissions: string | string[], context?: Record<string, any>): boolean | { valid: boolean; invalid: string[] } {\r\n    // If second parameter exists or first param looks like an action, treat as action check\r\n    if (context || typeof actionOrPermissions === 'string') {\r\n      // Action-based permission check\r\n      const currentUser = authService.getCurrentUser();\r\n      if (!currentUser) {\r\n        console.warn('[validateRolePermissions] No user found');\r\n        return false;\r\n      }\r\n      \r\n      const action = actionOrPermissions as string;\r\n      \r\n      // Map action to required permission\r\n      // Actions follow pattern: \"resource:operation\" or \"resource_subresource:operation\"\r\n      // e.g., \"product_sales:create\" -> \"manage_product_sales\"\r\n      const permissionRequired = this.mapActionToPermission(action);\r\n      \r\n      if (!permissionRequired) {\r\n        console.warn(`[validateRolePermissions] Unable to map action \"${action}\" to permission`);\r\n        // If mapping fails, allow access (graceful degradation)\r\n        return true;\r\n      }\r\n      \r\n      // Check if user has the required permission using authService's hasPermission\r\n      // which properly checks the user's role and permissions\r\n      const hasPermission = authService.hasPermission(permissionRequired);\r\n      \r\n      if (!hasPermission) {\r\n        console.warn(`[validateRolePermissions] User does not have permission \"${permissionRequired}\" for action \"${action}\"`);\r\n      } else {\r\n        console.log(`[validateRolePermissions] User has permission \"${permissionRequired}\" for action \"${action}\"`);\r\n      }\r\n      \r\n      return hasPermission;\r\n    }\r\n    \r\n    // Permission array validation (original behavior)\r\n    const permissions = Array.isArray(actionOrPermissions) ? actionOrPermissions : [actionOrPermissions];\r\n    const validPermissions = this.mockPermissions.map(p => p.id);\r\n    const invalid = permissions.filter(p => !validPermissions.includes(p));\r\n    \r\n    return {\r\n      valid: invalid.length === 0,\r\n      invalid\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Map action string to required permission\r\n   * Converts action format like \"product_sales:create\" to \"manage_product_sales\"\r\n   */\r\n  private mapActionToPermission(action: string): string | null {\r\n    // Action format: \"resource(:or_subresource):operation\"\r\n    // e.g., \"product_sales:create\" -> \"manage_product_sales\"\r\n    const parts = action.split(':');\r\n    if (parts.length < 2) return null;\r\n    \r\n    const resource = parts[0];\r\n    const operation = parts[1];\r\n    \r\n    // For most operations, we need the \"manage_resource\" permission\r\n    // Special cases can be added here as needed\r\n    switch (operation) {\r\n      case 'create':\r\n      case 'edit':\r\n      case 'delete':\r\n      case 'change_status':\r\n      case 'approve':\r\n      case 'reject':\r\n      case 'bulk_delete':\r\n      case 'bulk_update_status':\r\n      case 'create_with_contract':\r\n      case 'edit_fields':\r\n      case 'export':\r\n      case 'view_audit':\r\n      case 'bulk_export':\r\n        // All these operations require the \"manage_resource\" permission\r\n        return `manage_${resource}`;\r\n      \r\n      case 'view':\r\n      case 'view_details':\r\n        // View operations can work with either \"read\" or \"manage_resource\"\r\n        return `manage_${resource}`;\r\n      \r\n      default:\r\n        return `manage_${resource}`;\r\n    }\r\n  }\r\n}\r\n\r\nexport const rbacService = new RBACService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\salesService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\schedulerService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\serviceContractService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11874,11877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11874,11877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11916,11919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11916,11919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":389,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":389,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13853,13856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13853,13856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":391,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":391,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13917,13920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13917,13920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":394,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14052,14055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14052,14055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":461,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16283,16286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16283,16286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":520,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":520,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18234,18237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18234,18237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":523,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":523,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18345,18348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18345,18348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":590,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":590,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20627,20630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20627,20630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":591,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":591,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20666,20669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20666,20669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Contract Mock Service\r\n * Provides mock data and business logic for service contracts (development mode)\r\n * \r\n * Synchronization: Must match exactly with:\r\n * - Supabase service: src/services/supabase/serviceContractService.ts\r\n * - Types: src/types/serviceContract.ts\r\n * - Validation: Applied in both mock and supabase\r\n * \r\n * Last Updated: 2025-01-30\r\n * Version: 1.0.0\r\n */\r\n\r\nimport {\r\n  ServiceContractType,\r\n  ServiceContractDocumentType,\r\n  ServiceDeliveryMilestoneType,\r\n  ServiceContractIssueType,\r\n  ServiceContractActivityLogType,\r\n  ServiceContractCreateInput,\r\n  ServiceContractUpdateInput,\r\n  ServiceContractFilters,\r\n  ServiceContractStats,\r\n  ServiceContractDocumentCreateInput,\r\n  ServiceDeliveryMilestoneCreateInput,\r\n  ServiceContractIssueCreateInput,\r\n} from '@/types/serviceContract';\r\nimport { PaginatedResponse } from '@/modules/core/types';\r\n\r\n/**\r\n * Mock data for service contracts\r\n * These match the database schema exactly\r\n */\r\nconst mockServiceContracts: ServiceContractType[] = [\r\n  {\r\n    id: '1',\r\n    contractNumber: 'SVC-2025-001',\r\n    title: 'Premium 24/7 Support Package',\r\n    description: 'Comprehensive support services including email, phone, and chat support',\r\n    customerId: 'cust-1',\r\n    customerName: 'Acme Corporation',\r\n    productId: 'prod-1',\r\n    productName: 'Enterprise Support Suite',\r\n    serviceType: 'support',\r\n    status: 'active',\r\n    priority: 'high',\r\n    value: 24000.00,\r\n    currency: 'USD',\r\n    billingFrequency: 'monthly',\r\n    paymentTerms: 'Net 30',\r\n    slaTerms: '24/7 support with 4-hour response time for critical issues, 8-hour for high priority',\r\n    renewalTerms: 'Automatic renewal for 12 months at same terms',\r\n    serviceScope: 'Unlimited support tickets, dedicated account manager, quarterly business reviews',\r\n    exclusions: 'Custom development, emergency on-site support beyond 20 hours/month',\r\n    startDate: '2024-01-01',\r\n    endDate: '2025-12-31',\r\n    estimatedCompletionDate: '2025-12-31',\r\n    autoRenew: true,\r\n    renewalPeriodMonths: 12,\r\n    lastRenewalDate: '2024-01-01',\r\n    nextRenewalDate: '2025-01-01',\r\n    deliverySchedule: 'Ongoing, 24/7 availability',\r\n    scheduledHoursPerWeek: 168,\r\n    timeZone: 'America/New_York',\r\n    assignedToUserId: 'user-1',\r\n    assignedToName: 'John Smith',\r\n    secondaryContactId: 'user-2',\r\n    secondaryContactName: 'Jane Doe',\r\n    approvalStatus: 'approved',\r\n    approvedByUserId: 'user-3',\r\n    approvedAt: '2024-01-05',\r\n    complianceNotes: 'Fully compliant with ISO 27001 standards',\r\n    tags: ['support', 'critical', 'enterprise'],\r\n    customFields: { slaMetric: '99.9% uptime', supportTier: 'platinum' },\r\n    createdBy: 'user-1',\r\n    createdAt: '2024-01-01T00:00:00Z',\r\n    updatedBy: 'user-1',\r\n    updatedAt: '2024-01-05T10:30:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n  {\r\n    id: '2',\r\n    contractNumber: 'SVC-2025-002',\r\n    title: 'Software Maintenance & Updates',\r\n    description: 'Monthly software updates, patches, and maintenance services',\r\n    customerId: 'cust-2',\r\n    customerName: 'Tech Solutions Inc',\r\n    productId: 'prod-2',\r\n    productName: 'Business Intelligence Platform',\r\n    serviceType: 'maintenance',\r\n    status: 'active',\r\n    priority: 'medium',\r\n    value: 12000.00,\r\n    currency: 'USD',\r\n    billingFrequency: 'quarterly',\r\n    paymentTerms: 'Net 45',\r\n    slaTerms: 'Updates deployed within 5 business days of release, emergency patches within 24 hours',\r\n    renewalTerms: 'Auto-renewal annually unless cancelled 30 days prior',\r\n    serviceScope: 'Software updates, security patches, bug fixes, performance optimization',\r\n    exclusions: 'Custom features, training, data migration',\r\n    startDate: '2024-02-01',\r\n    endDate: '2025-01-31',\r\n    estimatedCompletionDate: '2025-01-31',\r\n    autoRenew: true,\r\n    renewalPeriodMonths: 12,\r\n    lastRenewalDate: '2024-02-01',\r\n    nextRenewalDate: '2025-02-01',\r\n    deliverySchedule: 'Monthly maintenance windows on 2nd Tuesday of each month',\r\n    scheduledHoursPerWeek: 40,\r\n    timeZone: 'America/Chicago',\r\n    assignedToUserId: 'user-2',\r\n    assignedToName: 'Jane Doe',\r\n    approvalStatus: 'approved',\r\n    approvedByUserId: 'user-3',\r\n    approvedAt: '2024-02-02',\r\n    complianceNotes: 'Meets HIPAA and SOC 2 compliance requirements',\r\n    tags: ['maintenance', 'critical', 'production'],\r\n    customFields: { deploymentWindow: 'Tuesday 2am EST', rollbackPlan: 'automated' },\r\n    createdBy: 'user-2',\r\n    createdAt: '2024-02-01T00:00:00Z',\r\n    updatedBy: 'user-2',\r\n    updatedAt: '2024-02-05T14:20:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n  {\r\n    id: '3',\r\n    contractNumber: 'SVC-2025-003',\r\n    title: 'IT Consulting Services',\r\n    description: 'Strategic IT consulting and technology advisory services',\r\n    customerId: 'cust-3',\r\n    customerName: 'Global Enterprises Ltd',\r\n    productId: 'prod-3',\r\n    productName: 'Digital Transformation Package',\r\n    serviceType: 'consulting',\r\n    status: 'pending_approval',\r\n    priority: 'high',\r\n    value: 50000.00,\r\n    currency: 'USD',\r\n    billingFrequency: 'one_time',\r\n    paymentTerms: 'Net 60 - 50% upfront, 50% upon completion',\r\n    slaTerms: 'Consulting team available 40 hours/week, response within 24 hours',\r\n    renewalTerms: 'Not applicable - one-time engagement',\r\n    serviceScope: 'Architecture review, technology assessment, implementation roadmap, training',\r\n    exclusions: 'Hands-on implementation, staff augmentation, third-party software licenses',\r\n    startDate: '2025-03-01',\r\n    endDate: '2025-06-30',\r\n    estimatedCompletionDate: '2025-06-30',\r\n    autoRenew: false,\r\n    renewalPeriodMonths: undefined,\r\n    deliverySchedule: 'Phased delivery: Week 1-2 Assessment, Week 3-6 Roadmap Development, Week 7-16 Implementation Support',\r\n    scheduledHoursPerWeek: 40,\r\n    timeZone: 'America/Los_Angeles',\r\n    assignedToUserId: 'user-3',\r\n    assignedToName: 'Mike Johnson',\r\n    secondaryContactId: 'user-4',\r\n    secondaryContactName: 'Sarah Williams',\r\n    approvalStatus: 'pending',\r\n    complianceNotes: 'Pending security assessment and legal review',\r\n    tags: ['consulting', 'strategic', 'high-value'],\r\n    customFields: { projectManager: 'Mike Johnson', budget: '50000', riskLevel: 'medium' },\r\n    createdBy: 'user-3',\r\n    createdAt: '2025-02-01T00:00:00Z',\r\n    updatedBy: 'user-3',\r\n    updatedAt: '2025-02-15T09:45:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n];\r\n\r\nconst mockDocuments: ServiceContractDocumentType[] = [\r\n  {\r\n    id: 'doc-1',\r\n    serviceContractId: '1',\r\n    fileName: 'Support_SLA_Agreement.pdf',\r\n    fileType: 'pdf',\r\n    fileSize: 245000,\r\n    filePath: '/contracts/SVC-2025-001/Support_SLA_Agreement.pdf',\r\n    documentType: 'sla_document',\r\n    uploadedByUserId: 'user-1',\r\n    uploadedByName: 'John Smith',\r\n    description: 'Official SLA document signed by both parties',\r\n    tags: ['sla', 'official', 'signed'],\r\n    isActive: true,\r\n    versionNumber: 1,\r\n    createdAt: '2024-01-05T10:00:00Z',\r\n    updatedAt: '2024-01-05T10:00:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n  {\r\n    id: 'doc-2',\r\n    serviceContractId: '1',\r\n    fileName: 'Service_Schedule_2024.xlsx',\r\n    fileType: 'xlsx',\r\n    fileSize: 156000,\r\n    filePath: '/contracts/SVC-2025-001/Service_Schedule_2024.xlsx',\r\n    documentType: 'schedule',\r\n    uploadedByUserId: 'user-2',\r\n    uploadedByName: 'Jane Doe',\r\n    description: 'Detailed service delivery schedule with milestones',\r\n    tags: ['schedule', 'delivery', 'milestones'],\r\n    isActive: true,\r\n    versionNumber: 2,\r\n    createdAt: '2024-01-10T14:30:00Z',\r\n    updatedAt: '2024-01-15T09:00:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n];\r\n\r\nconst mockMilestones: ServiceDeliveryMilestoneType[] = [\r\n  {\r\n    id: 'milestone-1',\r\n    serviceContractId: '1',\r\n    milestoneName: 'Support Team Onboarding',\r\n    description: 'Initial setup and team training',\r\n    sequenceNumber: 1,\r\n    plannedDate: '2024-01-10',\r\n    actualDate: '2024-01-12',\r\n    deliverableDescription: 'Trained support team and documentation',\r\n    acceptanceCriteria: 'All team members passed certification',\r\n    status: 'completed',\r\n    completionPercentage: 100,\r\n    assignedToUserId: 'user-1',\r\n    assignedToName: 'John Smith',\r\n    notes: 'Completed ahead of schedule',\r\n    createdAt: '2024-01-05T10:00:00Z',\r\n    updatedAt: '2024-01-12T15:30:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n  {\r\n    id: 'milestone-2',\r\n    serviceContractId: '1',\r\n    milestoneName: 'Q1 Business Review',\r\n    description: 'Quarterly performance review and planning',\r\n    sequenceNumber: 2,\r\n    plannedDate: '2024-03-31',\r\n    deliverableDescription: 'Performance report and Q2 action plan',\r\n    acceptanceCriteria: 'Report delivered, action items documented',\r\n    status: 'pending',\r\n    completionPercentage: 0,\r\n    assignedToUserId: 'user-2',\r\n    assignedToName: 'Jane Doe',\r\n    notes: 'Scheduled for Q1 end',\r\n    dependencies: ['milestone-1'],\r\n    createdAt: '2024-01-05T10:00:00Z',\r\n    updatedAt: '2024-01-05T10:00:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n];\r\n\r\nconst mockIssues: ServiceContractIssueType[] = [\r\n  {\r\n    id: 'issue-1',\r\n    serviceContractId: '2',\r\n    issueTitle: 'Delayed Patch Deployment',\r\n    issueDescription: 'February security patch not deployed within SLA window',\r\n    severity: 'high',\r\n    category: 'sla_breach',\r\n    status: 'resolved',\r\n    resolutionNotes: 'Patch deployed with corrective action implemented',\r\n    resolutionDate: '2024-02-15',\r\n    assignedToUserId: 'user-3',\r\n    assignedToName: 'Mike Johnson',\r\n    reportedDate: '2024-02-13',\r\n    targetResolutionDate: '2024-02-15',\r\n    impactDescription: 'Systems were at risk for 48 hours',\r\n    createdAt: '2024-02-13T08:00:00Z',\r\n    updatedAt: '2024-02-15T16:45:00Z',\r\n    tenantId: 'tenant-1',\r\n  },\r\n];\r\n\r\n/**\r\n * Service Contract Service (Mock Implementation)\r\n */\r\nexport const mockServiceContractService = {\r\n  /**\r\n   * Get service contracts with filtering and pagination\r\n   */\r\n  async getServiceContracts(filters: ServiceContractFilters = {}): Promise<PaginatedResponse<ServiceContractType>> {\r\n    try {\r\n      let filtered = [...mockServiceContracts];\r\n\r\n      // Apply filters\r\n      if (filters.search) {\r\n        const search = filters.search.toLowerCase();\r\n        filtered = filtered.filter(\r\n          (c) =>\r\n            c.contractNumber.toLowerCase().includes(search) ||\r\n            c.title.toLowerCase().includes(search) ||\r\n            c.customerName.toLowerCase().includes(search) ||\r\n            c.description?.toLowerCase().includes(search)\r\n        );\r\n      }\r\n\r\n      if (filters.status) {\r\n        filtered = filtered.filter((c) => c.status === filters.status);\r\n      }\r\n\r\n      if (filters.serviceType) {\r\n        filtered = filtered.filter((c) => c.serviceType === filters.serviceType);\r\n      }\r\n\r\n      if (filters.customerId) {\r\n        filtered = filtered.filter((c) => c.customerId === filters.customerId);\r\n      }\r\n\r\n      if (filters.assignedTo) {\r\n        filtered = filtered.filter((c) => c.assignedToUserId === filters.assignedTo);\r\n      }\r\n\r\n      if (filters.priority) {\r\n        filtered = filtered.filter((c) => c.priority === filters.priority);\r\n      }\r\n\r\n      if (filters.approvalStatus) {\r\n        filtered = filtered.filter((c) => c.approvalStatus === filters.approvalStatus);\r\n      }\r\n\r\n      if (filters.dateRange) {\r\n        filtered = filtered.filter((c) => {\r\n          const startDate = new Date(c.startDate);\r\n          const rangeStart = new Date(filters.dateRange!.start);\r\n          const rangeEnd = new Date(filters.dateRange!.end);\r\n          return startDate >= rangeStart && startDate <= rangeEnd;\r\n        });\r\n      }\r\n\r\n      // Apply sorting\r\n      const sortBy = filters.sortBy || 'createdAt';\r\n      const sortOrder = filters.sortOrder || 'desc';\r\n      filtered.sort((a, b) => {\r\n        const aVal = (a as any)[sortBy];\r\n        const bVal = (b as any)[sortBy];\r\n        const comparison = aVal > bVal ? 1 : aVal < bVal ? -1 : 0;\r\n        return sortOrder === 'asc' ? comparison : -comparison;\r\n      });\r\n\r\n      // Apply pagination\r\n      const page = filters.page || 1;\r\n      const pageSize = filters.pageSize || 20;\r\n      const startIndex = (page - 1) * pageSize;\r\n      const endIndex = startIndex + pageSize;\r\n\r\n      return {\r\n        data: filtered.slice(startIndex, endIndex),\r\n        total: filtered.length,\r\n        page,\r\n        pageSize,\r\n        totalPages: Math.ceil(filtered.length / pageSize),\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to fetch service contracts', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get single service contract\r\n   */\r\n  async getServiceContract(id: string): Promise<ServiceContractType> {\r\n    const contract = mockServiceContracts.find((c) => c.id === id);\r\n    if (!contract) {\r\n      throw new Error(`Service contract ${id} not found`);\r\n    }\r\n    return contract;\r\n  },\r\n\r\n  /**\r\n   * Create service contract\r\n   */\r\n  async createServiceContract(data: ServiceContractCreateInput): Promise<ServiceContractType> {\r\n    // Validate required fields\r\n    if (!data.title || !data.customerId || !data.serviceType) {\r\n      throw new Error('Required fields missing: title, customerId, serviceType');\r\n    }\r\n\r\n    if (data.value < 0 || data.value > 999999.99) {\r\n      throw new Error('Value must be between 0 and 999999.99');\r\n    }\r\n\r\n    const newContract: ServiceContractType = {\r\n      id: Math.random().toString(36).substr(2, 9),\r\n      contractNumber: `SVC-${new Date().getFullYear()}-${String(mockServiceContracts.length + 1).padStart(3, '0')}`,\r\n      title: data.title,\r\n      description: data.description,\r\n      customerId: data.customerId,\r\n      customerName: data.customerName,\r\n      productId: data.productId,\r\n      productName: data.productName,\r\n      serviceType: data.serviceType as any,\r\n      status: 'draft',\r\n      priority: (data.priority as any) || 'medium',\r\n      value: data.value,\r\n      currency: data.currency || 'USD',\r\n      billingFrequency: data.billingFrequency as any,\r\n      paymentTerms: data.paymentTerms,\r\n      slaTerms: data.slaTerms,\r\n      renewalTerms: data.renewalTerms,\r\n      serviceScope: data.serviceScope,\r\n      exclusions: data.exclusions,\r\n      startDate: data.startDate,\r\n      endDate: data.endDate,\r\n      estimatedCompletionDate: data.estimatedCompletionDate,\r\n      autoRenew: data.autoRenew || false,\r\n      renewalPeriodMonths: data.renewalPeriodMonths,\r\n      deliverySchedule: data.deliverySchedule,\r\n      scheduledHoursPerWeek: data.scheduledHoursPerWeek,\r\n      timeZone: data.timeZone,\r\n      assignedToUserId: data.assignedToUserId,\r\n      assignedToName: data.assignedToName,\r\n      secondaryContactId: data.secondaryContactId,\r\n      secondaryContactName: data.secondaryContactName,\r\n      tags: data.tags,\r\n      customFields: data.customFields,\r\n      createdBy: 'current_user',\r\n      createdAt: new Date().toISOString(),\r\n      updatedBy: 'current_user',\r\n      updatedAt: new Date().toISOString(),\r\n      tenantId: 'tenant-1',\r\n    };\r\n\r\n    mockServiceContracts.push(newContract);\r\n    return newContract;\r\n  },\r\n\r\n  /**\r\n   * Update service contract\r\n   */\r\n  async updateServiceContract(id: string, data: ServiceContractUpdateInput): Promise<ServiceContractType> {\r\n    const index = mockServiceContracts.findIndex((c) => c.id === id);\r\n    if (index === -1) {\r\n      throw new Error(`Service contract ${id} not found`);\r\n    }\r\n\r\n    const contract = mockServiceContracts[index];\r\n    const updated: ServiceContractType = {\r\n      ...contract,\r\n      ...data,\r\n      updatedAt: new Date().toISOString(),\r\n      updatedBy: 'current_user',\r\n    };\r\n\r\n    mockServiceContracts[index] = updated;\r\n    return updated;\r\n  },\r\n\r\n  /**\r\n   * Delete service contract\r\n   */\r\n  async deleteServiceContract(id: string): Promise<void> {\r\n    const index = mockServiceContracts.findIndex((c) => c.id === id);\r\n    if (index === -1) {\r\n      throw new Error(`Service contract ${id} not found`);\r\n    }\r\n    mockServiceContracts.splice(index, 1);\r\n  },\r\n\r\n  /**\r\n   * Update service contract status\r\n   */\r\n  async updateServiceContractStatus(id: string, status: string): Promise<ServiceContractType> {\r\n    return this.updateServiceContract(id, { status: status as any });\r\n  },\r\n\r\n  /**\r\n   * Get service contract statistics\r\n   */\r\n  async getServiceContractStats(): Promise<ServiceContractStats> {\r\n    const contracts = mockServiceContracts;\r\n\r\n    const stats: ServiceContractStats = {\r\n      total: contracts.length,\r\n      byStatus: {},\r\n      byServiceType: {},\r\n      activeContracts: 0,\r\n      pendingApprovalContracts: 0,\r\n      expiredContracts: 0,\r\n      totalValue: 0,\r\n      averageValue: 0,\r\n      totalDocuments: mockDocuments.length,\r\n      openIssues: mockIssues.filter((i) => i.status === 'open').length,\r\n      upcomingMilestones: mockMilestones.filter((m) => m.status === 'pending').length,\r\n    };\r\n\r\n    contracts.forEach((c) => {\r\n      // Status stats\r\n      stats.byStatus[c.status] = (stats.byStatus[c.status] || 0) + 1;\r\n\r\n      // Service type stats\r\n      stats.byServiceType[c.serviceType] = (stats.byServiceType[c.serviceType] || 0) + 1;\r\n\r\n      // Specific counts\r\n      if (c.status === 'active') stats.activeContracts++;\r\n      if (c.status === 'pending_approval') stats.pendingApprovalContracts++;\r\n      if (c.status === 'expired') stats.expiredContracts++;\r\n\r\n      // Value calculations\r\n      stats.totalValue += c.value;\r\n    });\r\n\r\n    stats.averageValue = contracts.length > 0 ? stats.totalValue / contracts.length : 0;\r\n\r\n    return stats;\r\n  },\r\n\r\n  /**\r\n   * Get service contract documents\r\n   */\r\n  async getServiceContractDocuments(contractId: string): Promise<ServiceContractDocumentType[]> {\r\n    return mockDocuments.filter((d) => d.serviceContractId === contractId);\r\n  },\r\n\r\n  /**\r\n   * Add document to service contract\r\n   */\r\n  async addServiceContractDocument(data: ServiceContractDocumentCreateInput): Promise<ServiceContractDocumentType> {\r\n    const doc: ServiceContractDocumentType = {\r\n      id: Math.random().toString(36).substr(2, 9),\r\n      serviceContractId: data.serviceContractId,\r\n      fileName: data.fileName,\r\n      fileType: data.fileType as any,\r\n      fileSize: data.fileSize,\r\n      filePath: data.filePath,\r\n      documentType: data.documentType as any,\r\n      uploadedByUserId: 'current_user',\r\n      uploadedByName: 'Current User',\r\n      description: data.description,\r\n      tags: data.tags,\r\n      isActive: true,\r\n      versionNumber: 1,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n      tenantId: 'tenant-1',\r\n    };\r\n\r\n    mockDocuments.push(doc);\r\n    return doc;\r\n  },\r\n\r\n  /**\r\n   * Get service delivery milestones\r\n   */\r\n  async getServiceDeliveryMilestones(contractId: string): Promise<ServiceDeliveryMilestoneType[]> {\r\n    return mockMilestones.filter((m) => m.serviceContractId === contractId);\r\n  },\r\n\r\n  /**\r\n   * Add milestone to service contract\r\n   */\r\n  async addServiceDeliveryMilestone(data: ServiceDeliveryMilestoneCreateInput): Promise<ServiceDeliveryMilestoneType> {\r\n    const milestone: ServiceDeliveryMilestoneType = {\r\n      id: Math.random().toString(36).substr(2, 9),\r\n      serviceContractId: data.serviceContractId,\r\n      milestoneName: data.milestoneName,\r\n      description: data.description,\r\n      sequenceNumber: data.sequenceNumber,\r\n      plannedDate: data.plannedDate,\r\n      deliverableDescription: data.deliverableDescription,\r\n      acceptanceCriteria: data.acceptanceCriteria,\r\n      status: 'pending',\r\n      completionPercentage: 0,\r\n      assignedToUserId: data.assignedToUserId,\r\n      assignedToName: data.assignedToName,\r\n      notes: data.notes,\r\n      dependencies: data.dependencies,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n      tenantId: 'tenant-1',\r\n    };\r\n\r\n    mockMilestones.push(milestone);\r\n    return milestone;\r\n  },\r\n\r\n  /**\r\n   * Get service contract issues\r\n   */\r\n  async getServiceContractIssues(contractId: string): Promise<ServiceContractIssueType[]> {\r\n    return mockIssues.filter((i) => i.serviceContractId === contractId);\r\n  },\r\n\r\n  /**\r\n   * Add issue to service contract\r\n   */\r\n  async addServiceContractIssue(data: ServiceContractIssueCreateInput): Promise<ServiceContractIssueType> {\r\n    const issue: ServiceContractIssueType = {\r\n      id: Math.random().toString(36).substr(2, 9),\r\n      serviceContractId: data.serviceContractId,\r\n      issueTitle: data.issueTitle,\r\n      issueDescription: data.issueDescription,\r\n      severity: data.severity as any,\r\n      category: data.category as any,\r\n      status: 'open',\r\n      assignedToUserId: data.assignedToUserId,\r\n      assignedToName: data.assignedToName,\r\n      reportedDate: new Date().toISOString().split('T')[0],\r\n      targetResolutionDate: data.targetResolutionDate,\r\n      impactDescription: data.impactDescription,\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n      tenantId: 'tenant-1',\r\n    };\r\n\r\n    mockIssues.push(issue);\r\n    return issue;\r\n  },\r\n\r\n  /**\r\n   * Export service contracts\r\n   */\r\n  async exportServiceContracts(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    if (format === 'json') {\r\n      return JSON.stringify(mockServiceContracts, null, 2);\r\n    }\r\n\r\n    // CSV format\r\n    const headers = [\r\n      'ID',\r\n      'Contract Number',\r\n      'Title',\r\n      'Customer',\r\n      'Service Type',\r\n      'Status',\r\n      'Value',\r\n      'Start Date',\r\n      'End Date',\r\n      'Assigned To',\r\n    ];\r\n    const rows = mockServiceContracts.map((c) => [\r\n      c.id,\r\n      c.contractNumber,\r\n      c.title,\r\n      c.customerName,\r\n      c.serviceType,\r\n      c.status,\r\n      c.value,\r\n      c.startDate,\r\n      c.endDate,\r\n      c.assignedToName || '',\r\n    ]);\r\n\r\n    const csv = [headers, ...rows].map((row) => row.map((cell) => `\"${cell}\"`).join(',')).join('\\r\\n');\r\n\r\n    return csv;\r\n  },\r\n\r\n  /**\r\n   * Bulk update service contracts\r\n   */\r\n  async bulkUpdateServiceContracts(ids: string[], updates: ServiceContractUpdateInput): Promise<ServiceContractType[]> {\r\n    return ids.map((id) => {\r\n      const index = mockServiceContracts.findIndex((c) => c.id === id);\r\n      if (index !== -1) {\r\n        mockServiceContracts[index] = {\r\n          ...mockServiceContracts[index],\r\n          ...updates,\r\n          updatedAt: new Date().toISOString(),\r\n        };\r\n      }\r\n      return mockServiceContracts[index];\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Bulk delete service contracts\r\n   */\r\n  async bulkDeleteServiceContracts(ids: string[]): Promise<void> {\r\n    ids.forEach((id) => {\r\n      const index = mockServiceContracts.findIndex((c) => c.id === id);\r\n      if (index !== -1) {\r\n        mockServiceContracts.splice(index, 1);\r\n      }\r\n    });\r\n  },\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\serviceFactory.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":418,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14746,14749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14746,14749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Factory\r\n * Switches between mock and Supabase service implementations\r\n * based on environment configuration\r\n */\r\n\r\nimport { mockServiceContractService } from './serviceContractService'; // Mock implementation\r\nimport { supabaseServiceContractService } from './supabase/serviceContractService'; // Supabase implementation\r\nimport { supabaseContractService } from './supabase/contractService'; // Supabase contract service (Contract module)\r\nimport { supabaseProductSaleService } from './supabase/productSaleService';\r\nimport { supabaseSalesService } from './api/supabase/salesService';\r\nimport { supabaseCustomerService } from './supabase/customerService';\r\nimport { supabaseJobWorkService } from './supabase/jobWorkService';\r\nimport { supabaseProductService } from './supabase/productService';\r\nimport { supabaseCompanyService } from './supabase/companyService';\r\nimport { supabaseUserService } from './api/supabase/userService';\r\nimport { supabaseRbacService } from './api/supabase/rbacService';\r\nimport { supabaseNotificationService } from './supabase/notificationService';\r\nimport { supabaseTenantService } from './supabase/tenantService';\r\nimport { supabaseTicketService } from './supabase/ticketService';\r\nimport { productSaleService as mockProductSaleService } from './productSaleService';\r\nimport { salesService as mockSalesService } from './salesService';\r\nimport { contractService as mockContractService } from './contractService'; // Mock contract service (Contract module)\r\nimport { customerService as mockCustomerService } from './customerService';\r\nimport { jobWorkService as mockJobWorkService } from './jobWorkService';\r\nimport { productService as mockProductService } from './productService';\r\nimport { companyService as mockCompanyService } from './companyService';\r\nimport { userService as mockUserService } from './userService';\r\nimport { rbacService as mockRbacService } from './rbacService';\r\nimport { notificationService as mockNotificationService } from './notificationService';\r\nimport { tenantService as mockTenantService } from './tenantService';\r\nimport { ticketService as mockTicketService } from './ticketService';\r\n\r\ntype ApiMode = 'mock' | 'supabase' | 'real';\r\n\r\nclass ServiceFactory {\r\n  private apiMode: ApiMode;\r\n\r\n  constructor() {\r\n    // Determine API mode from environment\r\n    this.apiMode = (import.meta.env.VITE_API_MODE as ApiMode) || 'mock';\r\n    \r\n    console.log(`üì¶ Service Factory initialized with mode: ${this.apiMode}`);\r\n    \r\n    if (this.apiMode === 'supabase') {\r\n      console.log('‚úÖ Using Supabase backend');\r\n    } else if (this.apiMode === 'real') {\r\n      console.log('‚úÖ Using Real API backend');\r\n    } else {\r\n      console.log('‚úÖ Using Mock data backend');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get API mode\r\n   */\r\n  getApiMode(): ApiMode {\r\n    return this.apiMode;\r\n  }\r\n\r\n  /**\r\n   * Set API mode (for testing/switching)\r\n   */\r\n  setApiMode(mode: ApiMode): void {\r\n    this.apiMode = mode;\r\n    console.log(`üîÑ API mode switched to: ${mode}`);\r\n  }\r\n\r\n  /**\r\n   * Get Service Contract Service\r\n   */\r\n  getServiceContractService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseServiceContractService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to mock');\r\n        return mockServiceContractService;\r\n      case 'mock':\r\n      default:\r\n        return mockServiceContractService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Product Sale Service\r\n   */\r\n  getProductSaleService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseProductSaleService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseProductSaleService;\r\n      case 'mock':\r\n      default:\r\n        return mockProductSaleService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Sales Service (for deal management)\r\n   */\r\n  getSalesService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseSalesService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseSalesService;\r\n      case 'mock':\r\n      default:\r\n        return mockSalesService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Customer Service\r\n   */\r\n  getCustomerService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseCustomerService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseCustomerService;\r\n      case 'mock':\r\n      default:\r\n        return mockCustomerService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Job Work Service\r\n   */\r\n  getJobWorkService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseJobWorkService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseJobWorkService;\r\n      case 'mock':\r\n      default:\r\n        return mockJobWorkService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Product Service\r\n   */\r\n  getProductService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseProductService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseProductService;\r\n      case 'mock':\r\n      default:\r\n        return mockProductService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Company Service\r\n   */\r\n  getCompanyService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseCompanyService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseCompanyService;\r\n      case 'mock':\r\n      default:\r\n        return mockCompanyService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get User Service\r\n   */\r\n  getUserService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseUserService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseUserService;\r\n      case 'mock':\r\n      default:\r\n        return mockUserService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get RBAC Service\r\n   */\r\n  getRbacService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseRbacService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseRbacService;\r\n      case 'mock':\r\n      default:\r\n        return mockRbacService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Notification Service\r\n   */\r\n  getNotificationService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseNotificationService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseNotificationService;\r\n      case 'mock':\r\n      default:\r\n        return mockNotificationService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Tenant Service\r\n   */\r\n  getTenantService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseTenantService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseTenantService;\r\n      case 'mock':\r\n      default:\r\n        return mockTenantService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Ticket Service\r\n   */\r\n  getTicketService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseTicketService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseTicketService;\r\n      case 'mock':\r\n      default:\r\n        return mockTicketService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Contract Service (Contract module - not Service Contract)\r\n   * ‚ö†Ô∏è IMPORTANT: This is for the Contracts module (/src/modules/features/contracts/)\r\n   * For Service Contracts, use getServiceContractService() instead\r\n   */\r\n  getContractService() {\r\n    switch (this.apiMode) {\r\n      case 'supabase':\r\n        return supabaseContractService;\r\n      case 'real':\r\n        // TODO: Implement real API service\r\n        console.warn('Real API service not yet implemented, falling back to Supabase');\r\n        return supabaseContractService;\r\n      case 'mock':\r\n      default:\r\n        return mockContractService;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Service (generic method for future extensibility)\r\n   */\r\n  getService(serviceName: string) {\r\n    switch (serviceName.toLowerCase()) {\r\n      case 'contract':\r\n      case 'contracts':\r\n        return this.getContractService();\r\n      case 'servicecontract':\r\n      case 'service_contract':\r\n        return this.getServiceContractService();\r\n      case 'productsale':\r\n      case 'product_sale':\r\n        return this.getProductSaleService();\r\n      case 'sales':\r\n      case 'sale':\r\n        return this.getSalesService();\r\n      case 'customer':\r\n        return this.getCustomerService();\r\n      case 'jobwork':\r\n      case 'job_work':\r\n        return this.getJobWorkService();\r\n      case 'product':\r\n      case 'products':\r\n        return this.getProductService();\r\n      case 'company':\r\n      case 'companies':\r\n        return this.getCompanyService();\r\n      case 'user':\r\n      case 'users':\r\n        return this.getUserService();\r\n      case 'rbac':\r\n      case 'role_based_access_control':\r\n        return this.getRbacService();\r\n      case 'notification':\r\n      case 'notifications':\r\n        return this.getNotificationService();\r\n      case 'tenant':\r\n      case 'tenants':\r\n        return this.getTenantService();\r\n      case 'ticket':\r\n      case 'tickets':\r\n        return this.getTicketService();\r\n      // Add other services as needed\r\n      default:\r\n        throw new Error(`Unknown service: ${serviceName}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if using real backend\r\n   */\r\n  isUsingRealBackend(): boolean {\r\n    return this.apiMode !== 'mock';\r\n  }\r\n\r\n  /**\r\n   * Check if using Supabase\r\n   */\r\n  isUsingSupabase(): boolean {\r\n    return this.apiMode === 'supabase';\r\n  }\r\n\r\n  /**\r\n   * Get backend info for debugging\r\n   */\r\n  getBackendInfo() {\r\n    return {\r\n      mode: this.apiMode,\r\n      supabaseUrl: this.apiMode === 'supabase' ? import.meta.env.VITE_SUPABASE_URL : undefined,\r\n      apiBaseUrl: this.apiMode === 'real' ? import.meta.env.VITE_API_BASE_URL : undefined,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const serviceFactory = new ServiceFactory();\r\n\r\n// Export for convenience - Service Contract Service (Service Contracts module)\r\nexport const serviceContractService = {\r\n  get instance() {\r\n    return serviceFactory.getServiceContractService();\r\n  },\r\n  getServiceContracts: (...args: Parameters<typeof supabaseServiceContractService.getServiceContracts>) =>\r\n    serviceFactory.getServiceContractService().getServiceContracts(...args),\r\n  getServiceContract: (...args: Parameters<typeof supabaseServiceContractService.getServiceContract>) =>\r\n    serviceFactory.getServiceContractService().getServiceContract(...args),\r\n  createServiceContract: (...args: Parameters<typeof supabaseServiceContractService.createServiceContract>) =>\r\n    serviceFactory.getServiceContractService().createServiceContract(...args),\r\n  updateServiceContract: (...args: Parameters<typeof supabaseServiceContractService.updateServiceContract>) =>\r\n    serviceFactory.getServiceContractService().updateServiceContract(...args),\r\n  renewServiceContract: (...args: Parameters<typeof supabaseServiceContractService.renewServiceContract>) =>\r\n    serviceFactory.getServiceContractService().renewServiceContract(...args),\r\n  cancelServiceContract: (...args: Parameters<typeof supabaseServiceContractService.cancelServiceContract>) =>\r\n    serviceFactory.getServiceContractService().cancelServiceContract(...args),\r\n  getServiceContractByProductSaleId: (...args: Parameters<typeof supabaseServiceContractService.getServiceContractByProductSaleId>) =>\r\n    serviceFactory.getServiceContractService().getServiceContractByProductSaleId(...args),\r\n  getContractTemplates: (...args: Parameters<typeof supabaseServiceContractService.getContractTemplates>) =>\r\n    serviceFactory.getServiceContractService().getContractTemplates(...args),\r\n  generateContractPDF: (...args: Parameters<typeof supabaseServiceContractService.generateContractPDF>) =>\r\n    serviceFactory.getServiceContractService().generateContractPDF(...args),\r\n  getExpiringContracts: (...args: Parameters<typeof supabaseServiceContractService.getExpiringContracts>) =>\r\n    serviceFactory.getServiceContractService().getExpiringContracts(...args),\r\n};\r\n\r\n// Export for convenience - Contract Service (Contracts module - NOT Service Contracts)\r\n// ‚ö†Ô∏è IMPORTANT: This is for the Contracts module (/src/modules/features/contracts/)\r\n// For Service Contracts, use serviceContractService instead\r\nexport const contractService = {\r\n  get instance() {\r\n    return serviceFactory.getContractService();\r\n  },\r\n  getContracts: (...args: Parameters<typeof supabaseContractService.getContracts>) =>\r\n    serviceFactory.getContractService().getContracts(...args),\r\n  getContract: (...args: Parameters<typeof supabaseContractService.getContract>) =>\r\n    serviceFactory.getContractService().getContract(...args),\r\n  createContract: (...args: Parameters<typeof supabaseContractService.createContract>) =>\r\n    serviceFactory.getContractService().createContract(...args),\r\n  updateContract: (...args: Parameters<typeof supabaseContractService.updateContract>) =>\r\n    serviceFactory.getContractService().updateContract(...args),\r\n  deleteContract: (...args: Parameters<typeof supabaseContractService.deleteContract>) =>\r\n    serviceFactory.getContractService().deleteContract(...args),\r\n  getContractStats: (...args: Parameters<typeof supabaseContractService.getContractStats>) =>\r\n    serviceFactory.getContractService().getContractStats(...args),\r\n  getExpiringContracts: (...args: Parameters<typeof supabaseContractService.getExpiringContracts>) =>\r\n    serviceFactory.getContractService().getExpiringContracts(...args),\r\n  getContractsByCustomer: (customerId: string, filters?: any) =>\r\n    serviceFactory.getContractService().getContractsByCustomer(customerId, filters),\r\n};\r\n\r\n// Export for convenience - Product Sale Service\r\nexport const productSaleService = {\r\n  get instance() {\r\n    return serviceFactory.getProductSaleService();\r\n  },\r\n  getProductSales: (...args: Parameters<typeof supabaseProductSaleService.getProductSales>) =>\r\n    serviceFactory.getProductSaleService().getProductSales(...args),\r\n  getProductSaleById: (...args: Parameters<typeof supabaseProductSaleService.getProductSaleById>) =>\r\n    serviceFactory.getProductSaleService().getProductSaleById(...args),\r\n  createProductSale: (...args: Parameters<typeof supabaseProductSaleService.createProductSale>) =>\r\n    serviceFactory.getProductSaleService().createProductSale(...args),\r\n  updateProductSale: (...args: Parameters<typeof supabaseProductSaleService.updateProductSale>) =>\r\n    serviceFactory.getProductSaleService().updateProductSale(...args),\r\n  deleteProductSale: (...args: Parameters<typeof supabaseProductSaleService.deleteProductSale>) =>\r\n    serviceFactory.getProductSaleService().deleteProductSale(...args),\r\n  getProductSalesAnalytics: (...args: Parameters<typeof supabaseProductSaleService.getProductSalesAnalytics>) =>\r\n    serviceFactory.getProductSaleService().getProductSalesAnalytics(...args),\r\n  uploadAttachment: (...args: Parameters<typeof supabaseProductSaleService.uploadAttachment>) =>\r\n    serviceFactory.getProductSaleService().uploadAttachment(...args),\r\n};\r\n\r\n// Export for convenience - Sales Service (Deal Management)\r\nexport const salesService = {\r\n  get instance() {\r\n    return serviceFactory.getSalesService();\r\n  },\r\n  getDeals: (...args: Parameters<typeof supabaseSalesService.getDeals>) =>\r\n    serviceFactory.getSalesService().getDeals(...args),\r\n  getDeal: (...args: Parameters<typeof supabaseSalesService.getDeal>) =>\r\n    serviceFactory.getSalesService().getDeal(...args),\r\n  createDeal: (...args: Parameters<typeof supabaseSalesService.createDeal>) =>\r\n    serviceFactory.getSalesService().createDeal(...args),\r\n  updateDeal: (...args: Parameters<typeof supabaseSalesService.updateDeal>) =>\r\n    serviceFactory.getSalesService().updateDeal(...args),\r\n  deleteDeal: (...args: Parameters<typeof supabaseSalesService.deleteDeal>) =>\r\n    serviceFactory.getSalesService().deleteDeal(...args),\r\n  getDealsByCustomer: (...args: Parameters<typeof supabaseSalesService.getDealsByCustomer>) =>\r\n    serviceFactory.getSalesService().getDealsByCustomer(...args),\r\n  getSalesStats: (...args: Parameters<typeof supabaseSalesService.getSalesStats>) =>\r\n    serviceFactory.getSalesService().getSalesStats(...args),\r\n  getDealStages: (...args: Parameters<typeof supabaseSalesService.getDealStages>) =>\r\n    serviceFactory.getSalesService().getDealStages(...args),\r\n  updateDealStage: (...args: Parameters<typeof supabaseSalesService.updateDealStage>) =>\r\n    serviceFactory.getSalesService().updateDealStage(...args),\r\n  bulkUpdateDeals: (...args: Parameters<typeof supabaseSalesService.bulkUpdateDeals>) =>\r\n    serviceFactory.getSalesService().bulkUpdateDeals(...args),\r\n  bulkDeleteDeals: (...args: Parameters<typeof supabaseSalesService.bulkDeleteDeals>) =>\r\n    serviceFactory.getSalesService().bulkDeleteDeals(...args),\r\n  searchDeals: (...args: Parameters<typeof supabaseSalesService.searchDeals>) =>\r\n    serviceFactory.getSalesService().searchDeals(...args),\r\n  exportDeals: (...args: Parameters<typeof supabaseSalesService.exportDeals>) =>\r\n    serviceFactory.getSalesService().exportDeals(...args),\r\n  importDeals: (...args: Parameters<typeof supabaseSalesService.importDeals>) =>\r\n    serviceFactory.getSalesService().importDeals(...args),\r\n};\r\n\r\n// Export for convenience - Customer Service\r\nexport const customerService = {\r\n  get instance() {\r\n    return serviceFactory.getCustomerService();\r\n  },\r\n  getCustomers: (...args: Parameters<typeof supabaseCustomerService.getCustomers>) =>\r\n    serviceFactory.getCustomerService().getCustomers(...args),\r\n  getCustomer: (...args: Parameters<typeof supabaseCustomerService.getCustomer>) =>\r\n    serviceFactory.getCustomerService().getCustomer(...args),\r\n  createCustomer: (...args: Parameters<typeof supabaseCustomerService.createCustomer>) =>\r\n    serviceFactory.getCustomerService().createCustomer(...args),\r\n  updateCustomer: (...args: Parameters<typeof supabaseCustomerService.updateCustomer>) =>\r\n    serviceFactory.getCustomerService().updateCustomer(...args),\r\n  deleteCustomer: (...args: Parameters<typeof supabaseCustomerService.deleteCustomer>) =>\r\n    serviceFactory.getCustomerService().deleteCustomer(...args),\r\n  bulkDeleteCustomers: (...args: Parameters<typeof supabaseCustomerService.bulkDeleteCustomers>) =>\r\n    serviceFactory.getCustomerService().bulkDeleteCustomers(...args),\r\n  bulkUpdateCustomers: (...args: Parameters<typeof supabaseCustomerService.bulkUpdateCustomers>) =>\r\n    serviceFactory.getCustomerService().bulkUpdateCustomers(...args),\r\n  getTags: (...args: Parameters<typeof supabaseCustomerService.getTags>) =>\r\n    serviceFactory.getCustomerService().getTags(...args),\r\n  createTag: (...args: Parameters<typeof supabaseCustomerService.createTag>) =>\r\n    serviceFactory.getCustomerService().createTag(...args),\r\n  exportCustomers: (...args: Parameters<typeof supabaseCustomerService.exportCustomers>) =>\r\n    serviceFactory.getCustomerService().exportCustomers(...args),\r\n  importCustomers: (...args: Parameters<typeof supabaseCustomerService.importCustomers>) =>\r\n    serviceFactory.getCustomerService().importCustomers(...args),\r\n  getIndustries: (...args: Parameters<typeof supabaseCustomerService.getIndustries>) =>\r\n    serviceFactory.getCustomerService().getIndustries(...args),\r\n  getSizes: (...args: Parameters<typeof supabaseCustomerService.getSizes>) =>\r\n    serviceFactory.getCustomerService().getSizes(...args),\r\n  getCustomerStats: (...args: Parameters<typeof supabaseCustomerService.getCustomerStats>) =>\r\n    serviceFactory.getCustomerService().getCustomerStats(...args),\r\n  searchCustomers: (...args: Parameters<typeof supabaseCustomerService.searchCustomers>) =>\r\n    serviceFactory.getCustomerService().searchCustomers(...args),\r\n};\r\n\r\n// Export for convenience - Job Work Service\r\nexport const jobWorkService = {\r\n  get instance() {\r\n    return serviceFactory.getJobWorkService();\r\n  },\r\n  getJobWorks: (...args: Parameters<typeof supabaseJobWorkService.getJobWorks>) =>\r\n    serviceFactory.getJobWorkService().getJobWorks(...args),\r\n  getJobWork: (...args: Parameters<typeof supabaseJobWorkService.getJobWork>) =>\r\n    serviceFactory.getJobWorkService().getJobWork(...args),\r\n  createJobWork: (...args: Parameters<typeof supabaseJobWorkService.createJobWork>) =>\r\n    serviceFactory.getJobWorkService().createJobWork(...args),\r\n  updateJobWork: (...args: Parameters<typeof supabaseJobWorkService.updateJobWork>) =>\r\n    serviceFactory.getJobWorkService().updateJobWork(...args),\r\n  deleteJobWork: (...args: Parameters<typeof supabaseJobWorkService.deleteJobWork>) =>\r\n    serviceFactory.getJobWorkService().deleteJobWork(...args),\r\n  getJobWorkStats: (...args: Parameters<typeof supabaseJobWorkService.getJobWorkStats>) =>\r\n    serviceFactory.getJobWorkService().getJobWorkStats(...args),\r\n};\r\n\r\n// Export for convenience - Product Service\r\nexport const productService = {\r\n  get instance() {\r\n    return serviceFactory.getProductService();\r\n  },\r\n  getProducts: (...args: Parameters<typeof supabaseProductService.getProducts>) =>\r\n    serviceFactory.getProductService().getProducts(...args),\r\n  getProduct: (...args: Parameters<typeof supabaseProductService.getProduct>) =>\r\n    serviceFactory.getProductService().getProduct(...args),\r\n  createProduct: (...args: Parameters<typeof supabaseProductService.createProduct>) =>\r\n    serviceFactory.getProductService().createProduct(...args),\r\n  updateProduct: (...args: Parameters<typeof supabaseProductService.updateProduct>) =>\r\n    serviceFactory.getProductService().updateProduct(...args),\r\n  deleteProduct: (...args: Parameters<typeof supabaseProductService.deleteProduct>) =>\r\n    serviceFactory.getProductService().deleteProduct(...args),\r\n  searchProducts: (...args: Parameters<typeof supabaseProductService.searchProducts>) =>\r\n    serviceFactory.getProductService().searchProducts(...args),\r\n  getLowStockProducts: (...args: Parameters<typeof supabaseProductService.getLowStockProducts>) =>\r\n    serviceFactory.getProductService().getLowStockProducts(...args),\r\n  updateStock: (...args: Parameters<typeof supabaseProductService.updateStock>) =>\r\n    serviceFactory.getProductService().updateStock(...args),\r\n  getProductStats: (...args: Parameters<typeof supabaseProductService.getProductStats>) =>\r\n    serviceFactory.getProductService().getProductStats(...args),\r\n  subscribeToProducts: (...args: Parameters<typeof supabaseProductService.subscribeToProducts>) =>\r\n    serviceFactory.getProductService().subscribeToProducts(...args),\r\n};\r\n\r\n// Export for convenience - Company Service\r\nexport const companyService = {\r\n  get instance() {\r\n    return serviceFactory.getCompanyService();\r\n  },\r\n  getCompanies: (...args: Parameters<typeof supabaseCompanyService.getCompanies>) =>\r\n    serviceFactory.getCompanyService().getCompanies(...args),\r\n  getCompany: (...args: Parameters<typeof supabaseCompanyService.getCompany>) =>\r\n    serviceFactory.getCompanyService().getCompany(...args),\r\n  getCompanyByDomain: (...args: Parameters<typeof supabaseCompanyService.getCompanyByDomain>) =>\r\n    serviceFactory.getCompanyService().getCompanyByDomain(...args),\r\n  createCompany: (...args: Parameters<typeof supabaseCompanyService.createCompany>) =>\r\n    serviceFactory.getCompanyService().createCompany(...args),\r\n  updateCompany: (...args: Parameters<typeof supabaseCompanyService.updateCompany>) =>\r\n    serviceFactory.getCompanyService().updateCompany(...args),\r\n  deleteCompany: (...args: Parameters<typeof supabaseCompanyService.deleteCompany>) =>\r\n    serviceFactory.getCompanyService().deleteCompany(...args),\r\n  searchCompanies: (...args: Parameters<typeof supabaseCompanyService.searchCompanies>) =>\r\n    serviceFactory.getCompanyService().searchCompanies(...args),\r\n  updateSubscription: (...args: Parameters<typeof supabaseCompanyService.updateSubscription>) =>\r\n    serviceFactory.getCompanyService().updateSubscription(...args),\r\n  getCompanyStats: (...args: Parameters<typeof supabaseCompanyService.getCompanyStats>) =>\r\n    serviceFactory.getCompanyService().getCompanyStats(...args),\r\n  subscribeToCompanies: (...args: Parameters<typeof supabaseCompanyService.subscribeToCompanies>) =>\r\n    serviceFactory.getCompanyService().subscribeToCompanies(...args),\r\n};\r\n\r\n// Export for convenience - User Service\r\nexport const userService = {\r\n  get instance() {\r\n    return serviceFactory.getUserService();\r\n  },\r\n  getUsers: (...args: Parameters<typeof mockUserService.getUsers>) =>\r\n    serviceFactory.getUserService().getUsers(...args),\r\n  getUser: (...args: Parameters<typeof mockUserService.getUser>) =>\r\n    serviceFactory.getUserService().getUser(...args),\r\n  createUser: (...args: Parameters<typeof mockUserService.createUser>) =>\r\n    serviceFactory.getUserService().createUser(...args),\r\n  updateUser: (...args: Parameters<typeof mockUserService.updateUser>) =>\r\n    serviceFactory.getUserService().updateUser(...args),\r\n  deleteUser: (...args: Parameters<typeof mockUserService.deleteUser>) =>\r\n    serviceFactory.getUserService().deleteUser(...args),\r\n  resetPassword: (...args: Parameters<typeof mockUserService.resetPassword>) =>\r\n    serviceFactory.getUserService().resetPassword(...args),\r\n  getRoles: (...args: Parameters<typeof mockUserService.getRoles>) =>\r\n    serviceFactory.getUserService().getRoles(...args),\r\n  getPermissions: (...args: Parameters<typeof mockUserService.getPermissions>) =>\r\n    serviceFactory.getUserService().getPermissions(...args),\r\n  getStatuses: (...args: Parameters<typeof mockUserService.getStatuses>) =>\r\n    serviceFactory.getUserService().getStatuses(...args),\r\n  getTenants: (...args: Parameters<typeof mockUserService.getTenants>) =>\r\n    serviceFactory.getUserService().getTenants(...args),\r\n};\r\n\r\n// Export for convenience - RBAC Service\r\nexport const rbacService = {\r\n  get instance() {\r\n    return serviceFactory.getRbacService();\r\n  },\r\n  getPermissions: (...args: Parameters<typeof mockRbacService.getPermissions>) =>\r\n    serviceFactory.getRbacService().getPermissions(...args),\r\n  getRoles: (...args: Parameters<typeof mockRbacService.getRoles>) =>\r\n    serviceFactory.getRbacService().getRoles(...args),\r\n  createRole: (...args: Parameters<typeof mockRbacService.createRole>) =>\r\n    serviceFactory.getRbacService().createRole(...args),\r\n  updateRole: (...args: Parameters<typeof mockRbacService.updateRole>) =>\r\n    serviceFactory.getRbacService().updateRole(...args),\r\n  deleteRole: (...args: Parameters<typeof mockRbacService.deleteRole>) =>\r\n    serviceFactory.getRbacService().deleteRole(...args),\r\n  assignUserRole: (...args: Parameters<typeof mockRbacService.assignUserRole>) =>\r\n    serviceFactory.getRbacService().assignUserRole(...args),\r\n  removeUserRole: (...args: Parameters<typeof mockRbacService.removeUserRole>) =>\r\n    serviceFactory.getRbacService().removeUserRole(...args),\r\n  getPermissionMatrix: (...args: Parameters<typeof mockRbacService.getPermissionMatrix>) =>\r\n    serviceFactory.getRbacService().getPermissionMatrix(...args),\r\n  getRoleTemplates: (...args: Parameters<typeof mockRbacService.getRoleTemplates>) =>\r\n    serviceFactory.getRbacService().getRoleTemplates(...args),\r\n  createRoleFromTemplate: (...args: Parameters<typeof mockRbacService.createRoleFromTemplate>) =>\r\n    serviceFactory.getRbacService().createRoleFromTemplate(...args),\r\n  getAuditLogs: (...args: Parameters<typeof mockRbacService.getAuditLogs>) =>\r\n    serviceFactory.getRbacService().getAuditLogs(...args),\r\n  logAction: (...args: Parameters<typeof mockRbacService.logAction>) =>\r\n    serviceFactory.getRbacService().logAction(...args),\r\n  getUsersByRole: (...args: Parameters<typeof mockRbacService.getUsersByRole>) =>\r\n    serviceFactory.getRbacService().getUsersByRole(...args),\r\n  bulkAssignRole: (...args: Parameters<typeof mockRbacService.bulkAssignRole>) =>\r\n    serviceFactory.getRbacService().bulkAssignRole(...args),\r\n  bulkRemoveRole: (...args: Parameters<typeof mockRbacService.bulkRemoveRole>) =>\r\n    serviceFactory.getRbacService().bulkRemoveRole(...args),\r\n  validateRolePermissions: (...args: Parameters<typeof mockRbacService.validateRolePermissions>) =>\r\n    serviceFactory.getRbacService().validateRolePermissions(...args),\r\n};\r\n\r\n// Export for convenience - Notification Service\r\nexport const notificationService = {\r\n  get instance() {\r\n    return serviceFactory.getNotificationService();\r\n  },\r\n  getNotifications: (...args: Parameters<typeof mockNotificationService.getNotifications>) =>\r\n    serviceFactory.getNotificationService().getNotifications(...args),\r\n  getNotificationPreferences: (...args: Parameters<typeof mockNotificationService.getNotificationPreferences>) =>\r\n    serviceFactory.getNotificationService().getNotificationPreferences(...args),\r\n  updateNotificationPreferences: (...args: Parameters<typeof mockNotificationService.updateNotificationPreferences>) =>\r\n    serviceFactory.getNotificationService().updateNotificationPreferences(...args),\r\n  markAsRead: (...args: Parameters<typeof mockNotificationService.markAsRead>) =>\r\n    serviceFactory.getNotificationService().markAsRead(...args),\r\n  markAllAsRead: (...args: Parameters<typeof mockNotificationService.markAllAsRead>) =>\r\n    serviceFactory.getNotificationService().markAllAsRead(...args),\r\n  deleteNotification: (...args: Parameters<typeof mockNotificationService.deleteNotification>) =>\r\n    serviceFactory.getNotificationService().deleteNotification(...args),\r\n  clearAllNotifications: (...args: Parameters<typeof mockNotificationService.clearAllNotifications>) =>\r\n    serviceFactory.getNotificationService().clearAllNotifications(...args),\r\n  subscribeToNotifications: (...args: Parameters<typeof mockNotificationService.subscribeToNotifications>) =>\r\n    serviceFactory.getNotificationService().subscribeToNotifications(...args),\r\n  getUnreadCount: (...args: Parameters<typeof mockNotificationService.getUnreadCount>) =>\r\n    serviceFactory.getNotificationService().getUnreadCount(...args),\r\n  getNotificationStats: (...args: Parameters<typeof mockNotificationService.getNotificationStats>) =>\r\n    serviceFactory.getNotificationService().getNotificationStats(...args),\r\n};\r\n\r\n// Export for convenience - Tenant Service\r\nexport const tenantService = {\r\n  get instance() {\r\n    return serviceFactory.getTenantService();\r\n  },\r\n  getTenants: (...args: Parameters<typeof mockTenantService.getTenants>) =>\r\n    serviceFactory.getTenantService().getTenants(...args),\r\n  getTenant: (...args: Parameters<typeof mockTenantService.getTenant>) =>\r\n    serviceFactory.getTenantService().getTenant(...args),\r\n  getCurrentTenant: (...args: Parameters<typeof mockTenantService.getCurrentTenant>) =>\r\n    serviceFactory.getTenantService().getCurrentTenant(...args),\r\n  updateTenantSettings: (...args: Parameters<typeof mockTenantService.updateTenantSettings>) =>\r\n    serviceFactory.getTenantService().updateTenantSettings(...args),\r\n  getTenantUsers: (...args: Parameters<typeof mockTenantService.getTenantUsers>) =>\r\n    serviceFactory.getTenantService().getTenantUsers(...args),\r\n  addUserToTenant: (...args: Parameters<typeof mockTenantService.addUserToTenant>) =>\r\n    serviceFactory.getTenantService().addUserToTenant(...args),\r\n  removeUserFromTenant: (...args: Parameters<typeof mockTenantService.removeUserFromTenant>) =>\r\n    serviceFactory.getTenantService().removeUserFromTenant(...args),\r\n  updateUserRole: (...args: Parameters<typeof mockTenantService.updateUserRole>) =>\r\n    serviceFactory.getTenantService().updateUserRole(...args),\r\n  getTenantUsage: (...args: Parameters<typeof mockTenantService.getTenantUsage>) =>\r\n    serviceFactory.getTenantService().getTenantUsage(...args),\r\n  getTenantAnalytics: (...args: Parameters<typeof mockTenantService.getTenantAnalytics>) =>\r\n    serviceFactory.getTenantService().getTenantAnalytics(...args),\r\n  createTenant: (...args: Parameters<typeof mockTenantService.createTenant>) =>\r\n    serviceFactory.getTenantService().createTenant(...args),\r\n  updateTenantStatus: (...args: Parameters<typeof mockTenantService.updateTenantStatus>) =>\r\n    serviceFactory.getTenantService().updateTenantStatus(...args),\r\n  deleteTenant: (...args: Parameters<typeof mockTenantService.deleteTenant>) =>\r\n    serviceFactory.getTenantService().deleteTenant(...args),\r\n  getTenantBranding: (...args: Parameters<typeof mockTenantService.getTenantBranding>) =>\r\n    serviceFactory.getTenantService().getTenantBranding(...args),\r\n  updateTenantBranding: (...args: Parameters<typeof mockTenantService.updateTenantBranding>) =>\r\n    serviceFactory.getTenantService().updateTenantBranding(...args),\r\n  getTenantFeatures: (...args: Parameters<typeof mockTenantService.getTenantFeatures>) =>\r\n    serviceFactory.getTenantService().getTenantFeatures(...args),\r\n  updateTenantFeatures: (...args: Parameters<typeof mockTenantService.updateTenantFeatures>) =>\r\n    serviceFactory.getTenantService().updateTenantFeatures(...args),\r\n};\r\n\r\n// Export for convenience - Ticket Service\r\nexport const ticketService = {\r\n  get instance() {\r\n    return serviceFactory.getTicketService();\r\n  },\r\n  getTickets: (...args: Parameters<typeof mockTicketService.getTickets>) =>\r\n    serviceFactory.getTicketService().getTickets(...args),\r\n  getTicket: (...args: Parameters<typeof mockTicketService.getTicket>) =>\r\n    serviceFactory.getTicketService().getTicket(...args),\r\n  createTicket: (...args: Parameters<typeof mockTicketService.createTicket>) =>\r\n    serviceFactory.getTicketService().createTicket(...args),\r\n  updateTicket: (...args: Parameters<typeof mockTicketService.updateTicket>) =>\r\n    serviceFactory.getTicketService().updateTicket(...args),\r\n  deleteTicket: (...args: Parameters<typeof mockTicketService.deleteTicket>) =>\r\n    serviceFactory.getTicketService().deleteTicket(...args),\r\n  getStatuses: (...args: Parameters<typeof mockTicketService.getStatuses>) =>\r\n    serviceFactory.getTicketService().getStatuses(...args),\r\n  getPriorities: (...args: Parameters<typeof mockTicketService.getPriorities>) =>\r\n    serviceFactory.getTicketService().getPriorities(...args),\r\n  getCategories: (...args: Parameters<typeof mockTicketService.getCategories>) =>\r\n    serviceFactory.getTicketService().getCategories(...args),\r\n  getTicketStats: (...args: Parameters<typeof mockTicketService.getTicketStats>) =>\r\n    serviceFactory.getTicketService().getTicketStats(...args),\r\n  getTicketCategories: (...args: Parameters<typeof mockTicketService.getTicketCategories>) =>\r\n    serviceFactory.getTicketService().getTicketCategories(...args),\r\n  getTicketPriorities: (...args: Parameters<typeof mockTicketService.getTicketPriorities>) =>\r\n    serviceFactory.getTicketService().getTicketPriorities(...args),\r\n};\r\n\r\nexport type { ApiMode };","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\serviceIntegrationTest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\serviceLogger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\sessionConfigService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\authService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5199,5202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5199,5202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":208,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5606,5609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5606,5609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7822,7825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7822,7825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":321,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8458,8461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8458,8461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8846,8849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8846,8849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":354,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9289,9292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9289,9292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9803,9806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9803,9806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":460,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":460,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12012,12015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12012,12015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":678,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":678,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19400,19403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19400,19403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":740,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":740,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21619,21622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21619,21622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Authentication Service\r\n * Handles user authentication, JWT tokens, role-based access\r\n * Extends BaseSupabaseService for common database operations\r\n */\r\n\r\nimport { BaseSupabaseService, QueryOptions } from './baseService';\r\nimport { getSupabaseClient } from './client';\r\nimport { User } from '@/types/auth';\r\n\r\nexport interface AuthResponse {\r\n  user: User;\r\n  session: {\r\n    access_token: string;\r\n    refresh_token: string;\r\n    expires_in: number;\r\n  };\r\n}\r\n\r\nexport class SupabaseAuthService extends BaseSupabaseService {\r\n  constructor() {\r\n    super('users', true);\r\n  }\r\n\r\n  /**\r\n   * Authenticate user with email/password\r\n   */\r\n  async login(credentials: Record<string, unknown>): Promise<Record<string, unknown>> {\r\n    try {\r\n      const email = credentials.email as string;\r\n      const password = credentials.password as string;\r\n      \r\n      console.log('[SUPABASE_AUTH] Starting login for:', email);\r\n\r\n      const client = getSupabaseClient();\r\n      const { data, error } = await client.auth.signInWithPassword({\r\n        email,\r\n        password,\r\n      });\r\n\r\n      if (error) {\r\n        console.error('[SUPABASE_AUTH] Auth error:', error.message);\r\n        throw error;\r\n      }\r\n\r\n      if (!data.session) {\r\n        throw new Error('No session returned from Supabase');\r\n      }\r\n\r\n      console.log('[SUPABASE_AUTH] Auth successful, user ID:', data.session.user.id);\r\n\r\n      // Fetch user details from users table\r\n      const user = await this.getUserByEmail(email);\r\n      if (!user) throw new Error('User not found in database');\r\n\r\n      console.log('[SUPABASE_AUTH] User found:', user.email);\r\n\r\n      // Store BOTH the session object and auth data\r\n      const session = {\r\n        access_token: data.session.access_token,\r\n        refresh_token: data.session.refresh_token,\r\n        expires_in: data.session.expires_in || 3600,\r\n        user: data.session.user,\r\n      };\r\n\r\n      this.storeAuthData(session, user);\r\n\r\n      console.log('[SUPABASE_AUTH] Login successful, session stored');\r\n\r\n      return {\r\n        user,\r\n        session: {\r\n          access_token: session.access_token,\r\n          refresh_token: session.refresh_token,\r\n          expires_in: session.expires_in,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      console.error('[SUPABASE_AUTH] Login failed:', error);\r\n      this.logError('Login failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register new user\r\n   */\r\n  async register(\r\n    email: string,\r\n    password: string,\r\n    userData: {\r\n      firstName: string;\r\n      lastName: string;\r\n      tenantId: string;\r\n      role: 'admin' | 'manager' | 'agent' | 'engineer' | 'customer';\r\n    }\r\n  ): Promise<AuthResponse> {\r\n    try {\r\n      this.log('Registering new user', { email });\r\n\r\n      const client = getSupabaseClient();\r\n\r\n      // Create auth user\r\n      const { data: authData, error: authError } = await client.auth.signUp({\r\n        email,\r\n        password,\r\n      });\r\n\r\n      if (authError) throw authError;\r\n\r\n      // Create user record in database\r\n      const { data: user, error: dbError } = await client\r\n        .from('users')\r\n        .insert([\r\n          {\r\n            id: authData.user?.id,\r\n            email,\r\n            firstName: userData.firstName,\r\n            lastName: userData.lastName,\r\n            tenantId: userData.tenantId,\r\n            role: userData.role,\r\n            status: 'active',\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (dbError) throw dbError;\r\n\r\n      this.log('User registered successfully', { email });\r\n\r\n      return {\r\n        user: this.mapUserResponse(user),\r\n        session: {\r\n          access_token: authData.session?.access_token || '',\r\n          refresh_token: authData.session?.refresh_token || '',\r\n          expires_in: authData.session?.expires_in || 3600,\r\n        },\r\n      };\r\n    } catch (error) {\r\n      this.logError('Registration failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Logout user\r\n   */\r\n  async logout(): Promise<void> {\r\n    try {\r\n      this.log('Logging out user');\r\n\r\n      const client = getSupabaseClient();\r\n      const { error } = await client.auth.signOut();\r\n\r\n      if (error) throw error;\r\n\r\n      // Clear auth data from localStorage\r\n      this.clearAuthData();\r\n\r\n      this.log('User logged out successfully');\r\n    } catch (error) {\r\n      this.logError('Logout failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user (synchronous - from localStorage)\r\n   * Used by AuthContext and other sync code paths\r\n   */\r\n  getCurrentUser(): User | null {\r\n    try {\r\n      const userStr = localStorage.getItem('sb_current_user');\r\n      if (!userStr) return null;\r\n      return JSON.parse(userStr) as User;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user (async - from Supabase session)\r\n   * More reliable for actual server-side user data\r\n   */\r\n  async getCurrentUserAsync(): Promise<User | null> {\r\n    try {\r\n      const client = getSupabaseClient();\r\n      const { data } = await client.auth.getSession();\r\n\r\n      if (!data.session) return null;\r\n\r\n      const user = await this.getById<any>(data.session.user.id);\r\n      return user ? this.mapUserResponse(user) : null;\r\n    } catch (error) {\r\n      this.logError('Error getting current user', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get user by email\r\n   */\r\n  async getUserByEmail(email: string): Promise<User | null> {\r\n    try {\r\n      this.log('Fetching user by email', { email });\r\n\r\n      const users = await this.getAll<any>({\r\n        filters: { email },\r\n      });\r\n\r\n      if (users.length === 0) return null;\r\n\r\n      return this.mapUserResponse(users[0]);\r\n    } catch (error) {\r\n      this.logError('Error fetching user by email', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh authentication token\r\n   */\r\n  async refreshToken(): Promise<string> {\r\n    try {\r\n      this.log('Refreshing authentication token');\r\n\r\n      const client = getSupabaseClient();\r\n      const { data, error } = await client.auth.refreshSession();\r\n\r\n      if (error) throw error;\r\n\r\n      const user = await this.getCurrentUser();\r\n      if (!user) throw new Error('User not found');\r\n\r\n      const token = data.session?.access_token || '';\r\n      \r\n      // Store new token\r\n      this.storeAuthData(token, user);\r\n\r\n      this.log('Token refreshed successfully');\r\n\r\n      return token;\r\n    } catch (error) {\r\n      this.logError('Token refresh failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change user password\r\n   */\r\n  async changePassword(oldPassword: string, newPassword: string): Promise<void> {\r\n    try {\r\n      this.log('Changing user password');\r\n\r\n      const client = getSupabaseClient();\r\n      const { error } = await client.auth.updateUser({\r\n        password: newPassword,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Password changed successfully');\r\n    } catch (error) {\r\n      this.logError('Password change failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Request password reset\r\n   */\r\n  async requestPasswordReset(email: string): Promise<void> {\r\n    try {\r\n      this.log('Requesting password reset', { email });\r\n\r\n      const client = getSupabaseClient();\r\n      const { error } = await client.auth.resetPasswordForEmail(email);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Password reset email sent');\r\n    } catch (error) {\r\n      this.logError('Password reset request failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update user profile\r\n   */\r\n  async updateProfile(userId: string, updates: Partial<User>): Promise<User> {\r\n    try {\r\n      this.log('Updating user profile', { userId });\r\n\r\n      const updated = await this.update<any>(userId, {\r\n        firstName: updates.firstName,\r\n        lastName: updates.lastName,\r\n        avatar: updates.avatar,\r\n        phone: updates.phone,\r\n        updated_at: new Date().toISOString(),\r\n      });\r\n\r\n      this.log('Profile updated successfully', { userId });\r\n\r\n      return this.mapUserResponse(updated);\r\n    } catch (error) {\r\n      this.logError('Profile update failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all users (admin only)\r\n   */\r\n  async getAllUsers(options?: QueryOptions): Promise<User[]> {\r\n    try {\r\n      this.log('Fetching all users');\r\n\r\n      const users = await this.getAll<any>(options);\r\n      return users.map((user) => this.mapUserResponse(user));\r\n    } catch (error) {\r\n      this.logError('Error fetching users', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get users by role\r\n   */\r\n  async getUsersByRole(role: string): Promise<User[]> {\r\n    try {\r\n      this.log('Fetching users by role', { role });\r\n\r\n      const users = await this.getAll<any>({\r\n        filters: { role },\r\n      });\r\n\r\n      return users.map((user) => this.mapUserResponse(user));\r\n    } catch (error) {\r\n      this.logError('Error fetching users by role', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get users by tenant\r\n   */\r\n  async getUsersByTenant(tenantId: string): Promise<User[]> {\r\n    try {\r\n      this.log('Fetching users by tenant', { tenantId });\r\n\r\n      const users = await this.getAll<any>({\r\n        filters: { tenantId },\r\n      });\r\n\r\n      return users.map((user) => this.mapUserResponse(user));\r\n    } catch (error) {\r\n      this.logError('Error fetching users by tenant', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deactivate user\r\n   */\r\n  async deactivateUser(userId: string): Promise<void> {\r\n    try {\r\n      this.log('Deactivating user', { userId });\r\n\r\n      await this.update(userId, {\r\n        status: 'inactive',\r\n        updated_at: new Date().toISOString(),\r\n      } as any);\r\n\r\n      this.log('User deactivated successfully', { userId });\r\n    } catch (error) {\r\n      this.logError('User deactivation failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current authentication token (synchronous - from storage)\r\n   */\r\n  getToken(): string | null {\r\n    try {\r\n      // Try to get token from localStorage (set during login)\r\n      const token = localStorage.getItem('sb_access_token');\r\n      return token || null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if user is authenticated\r\n   */\r\n  isAuthenticated(): boolean {\r\n    const token = this.getToken();\r\n    return !!token;\r\n  }\r\n\r\n  /**\r\n   * Check if user has a specific role\r\n   */\r\n  hasRole(role: string): boolean {\r\n    try {\r\n      const userStr = localStorage.getItem('sb_current_user');\r\n      if (!userStr) return false;\r\n      \r\n      const user = JSON.parse(userStr) as User;\r\n      \r\n      // Super admin has access to all roles\r\n      if (user.role === 'super_admin') return true;\r\n      \r\n      return user.role === role;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cache for user permissions (to avoid repeated DB queries)\r\n   */\r\n  private permissionCache: Map<string, Set<string>> = new Map();\r\n\r\n  /**\r\n   * Load user permissions from database dynamically\r\n   */\r\n  private async loadUserPermissions(userId: string): Promise<Set<string>> {\r\n    // Check cache first\r\n    if (this.permissionCache.has(userId)) {\r\n      return this.permissionCache.get(userId) || new Set();\r\n    }\r\n\r\n    try {\r\n      const client = getSupabaseClient();\r\n\r\n      // Get user with their role\r\n      const { data: user } = await client\r\n        .from('users')\r\n        .select('id, role, tenant_id')\r\n        .eq('id', userId)\r\n        .single();\r\n\r\n      if (!user) return new Set();\r\n\r\n      // Get permissions for user's role\r\n      const { data: rolePermissions } = await client\r\n        .from('role_permissions')\r\n        .select('permission:permissions(name)')\r\n        .eq('role_id', user.role)\r\n        .eq('granted_at', user.tenant_id);\r\n\r\n      const permissions = new Set<string>();\r\n\r\n      if (rolePermissions) {\r\n        rolePermissions.forEach((rp: any) => {\r\n          if (rp.permission?.name) {\r\n            permissions.add(rp.permission.name);\r\n          }\r\n        });\r\n      }\r\n\r\n      // Cache the permissions\r\n      this.permissionCache.set(userId, permissions);\r\n\r\n      return permissions;\r\n    } catch (error) {\r\n      this.logError('Error loading user permissions', error);\r\n      return new Set();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear permission cache (useful after role changes)\r\n   */\r\n  clearPermissionCache(userId?: string): void {\r\n    if (userId) {\r\n      this.permissionCache.delete(userId);\r\n    } else {\r\n      this.permissionCache.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if user has a specific permission (synchronous with fallback)\r\n   * Supports both generic permissions (manage_customers, read, write, delete)\r\n   * and resource-specific permissions (customers:update, customers:delete, customers:create)\r\n   */\r\n  hasPermission(permission: string): boolean {\r\n    try {\r\n      const userStr = localStorage.getItem('sb_current_user');\r\n      if (!userStr) {\r\n        console.warn('[Supabase hasPermission] No user found');\r\n        return false;\r\n      }\r\n      \r\n      const user = JSON.parse(userStr) as User;\r\n      \r\n      // Super admin has all permissions\r\n      if (user.role === 'super_admin') {\r\n        console.log('[Supabase hasPermission] User is super_admin, granting all permissions');\r\n        return true;\r\n      }\r\n      \r\n      // Define role-based permissions (fallback when DB not available)\r\n      const rolePermissions: Record<string, string[]> = {\r\n        super_admin: ['*'],\r\n        admin: [\r\n          'read', 'write', 'delete',  // Generic permissions\r\n          'view_dashboard',\r\n          'manage_users',\r\n          'manage_customers',\r\n          'manage_sales',\r\n          'manage_tickets',\r\n          'manage_contracts',\r\n          'manage_service_contracts',\r\n          'manage_products',\r\n          'manage_product_sales',\r\n          'manage_complaints',\r\n          'view_reports',\r\n          'export_data',\r\n        ],\r\n        manager: [\r\n          'read', 'write',  // Generic permissions\r\n          'view_dashboard',\r\n          'view_customers',\r\n          'create_customers',\r\n          'edit_customers',\r\n          'view_sales',\r\n          'create_sales',\r\n          'edit_sales',\r\n          'view_tickets',\r\n          'create_tickets',\r\n          'edit_tickets',\r\n          'view_contracts',\r\n          'manage_service_contracts',\r\n          'manage_product_sales',\r\n          'manage_complaints',\r\n        ],\r\n        agent: [\r\n          'read', 'write',  // Generic permissions\r\n          'view_dashboard',\r\n          'view_customers',\r\n          'create_customers',\r\n          'view_sales',\r\n          'create_sales',\r\n          'view_tickets',\r\n          'create_tickets',\r\n          'edit_tickets',\r\n          'manage_complaints',\r\n        ],\r\n        engineer: [\r\n          'read', 'write',  // Generic permissions\r\n          'view_dashboard',\r\n          'view_tickets',\r\n          'edit_tickets',\r\n          'view_customers',\r\n          'manage_product_sales',\r\n        ],\r\n        customer: [\r\n          'read',  // Generic read permission\r\n          'view_dashboard',\r\n          'view_own_tickets',\r\n          'create_tickets',\r\n        ],\r\n        viewer: [\r\n          'read',  // Generic read permission\r\n          'view_dashboard',\r\n          'view_customers',\r\n          'view_sales',\r\n          'view_tickets',\r\n          'view_contracts',\r\n        ],\r\n      };\r\n      \r\n      const userPermissions = rolePermissions[user.role] || [];\r\n      console.log(`[Supabase hasPermission] Checking permission \"${permission}\" for user role \"${user.role}\". User permissions:`, userPermissions);\r\n      \r\n      // Check for wildcard permission (super admin)\r\n      if (userPermissions.includes('*')) {\r\n        console.log(`[Supabase hasPermission] User has wildcard permission, granting access`);\r\n        return true;\r\n      }\r\n      \r\n      // Check if user has specific permission (direct match)\r\n      if (userPermissions.includes(permission)) {\r\n        console.log(`[Supabase hasPermission] Direct match found for \"${permission}\"`);\r\n        return true;\r\n      }\r\n\r\n      // Handle resource-specific permission format (e.g., \"customers:read\", \"customers.update\", \"customers:delete\")\r\n      // Parse the permission string to extract resource and action\r\n      const separator = permission.includes(':') ? ':' : '.';\r\n      const [resource, action] = permission.split(separator);\r\n      \r\n      if (resource && action) {\r\n        // Map action to generic permission\r\n        const actionPermissionMap: Record<string, string> = {\r\n          'read': 'read',\r\n          'create': 'write',\r\n          'update': 'write',\r\n          'delete': 'delete',\r\n          'manage': `manage_${resource}`\r\n        };\r\n\r\n        const mappedPermission = actionPermissionMap[action];\r\n        console.log(`[Supabase hasPermission] Parsed: resource=\"${resource}\", action=\"${action}\", mappedPermission=\"${mappedPermission}\"`);\r\n        \r\n        // Check if user has the generic permission\r\n        if (mappedPermission && userPermissions.includes(mappedPermission)) {\r\n          console.log(`[Supabase hasPermission] User has mapped permission \"${mappedPermission}\", granting access`);\r\n          return true;\r\n        }\r\n\r\n        // Check if user has the resource-specific manage permission\r\n        const managePermission = `manage_${resource}`;\r\n        if (userPermissions.includes(managePermission)) {\r\n          // User can manage this resource, so they can do most operations\r\n          console.log(`[Supabase hasPermission] User has manage permission \"${managePermission}\", granting access`);\r\n          return true;\r\n        }\r\n      }\r\n\r\n      console.warn(`[Supabase hasPermission] No matching permission found for \"${permission}\"`);\r\n      return false;\r\n    } catch (error) {\r\n      console.error('[Supabase hasPermission] Error:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if user has permission (async version - loads from database)\r\n   * Use this for critical permission checks that need real-time accuracy\r\n   */\r\n  async hasPermissionAsync(permission: string): Promise<boolean> {\r\n    try {\r\n      const user = this.getCurrentUser();\r\n      if (!user) return false;\r\n\r\n      // Super admin has all permissions\r\n      if (user.role === 'super_admin') return true;\r\n\r\n      // Load permissions from database\r\n      const permissions = await this.loadUserPermissions(user.id);\r\n      return permissions.has(permission) || permissions.has('*');\r\n    } catch (error) {\r\n      this.logError('Error checking permission (async)', error);\r\n      // Fallback to synchronous check\r\n      return this.hasPermission(permission);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all permissions for current user (from database)\r\n   */\r\n  async getCurrentUserPermissions(): Promise<string[]> {\r\n    try {\r\n      const user = this.getCurrentUser();\r\n      if (!user) return [];\r\n\r\n      const permissions = await this.loadUserPermissions(user.id);\r\n      return Array.from(permissions);\r\n    } catch (error) {\r\n      this.logError('Error getting user permissions', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Store token and user in localStorage (called after successful login)\r\n   * Also includes tenant_id for RLS enforcement\r\n   */\r\n  private storeAuthData(session: any, user: User): void {\r\n    try {\r\n      // Store session for Supabase auth restoration\r\n      localStorage.setItem('supabase_session', JSON.stringify(session));\r\n      \r\n      // Store individual tokens and user for compatibility\r\n      localStorage.setItem('sb_access_token', session.access_token);\r\n      localStorage.setItem('sb_current_user', JSON.stringify(user));\r\n      localStorage.setItem('crm_auth_token', session.access_token);\r\n      localStorage.setItem('crm_user', JSON.stringify(user));\r\n      \r\n      // Store tenant_id separately for RLS policy enforcement\r\n      if (user.tenantId) {\r\n        localStorage.setItem('sb_tenant_id', user.tenantId);\r\n        localStorage.setItem('crm_tenant_id', user.tenantId);\r\n        console.log('[SUPABASE_AUTH] Tenant ID stored:', user.tenantId);\r\n      } else {\r\n        console.warn('[SUPABASE_AUTH] WARNING: No tenantId found in user object!', user);\r\n      }\r\n      \r\n      console.log('[SUPABASE_AUTH] Auth data stored in localStorage');\r\n    } catch (error) {\r\n      this.logError('Failed to store auth data', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user's tenant ID (for multi-tenant isolation)\r\n   */\r\n  getCurrentTenantId(): string | null {\r\n    try {\r\n      const user = this.getCurrentUser();\r\n      return user?.tenantId || localStorage.getItem('sb_tenant_id');\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear auth data from storage (called during logout)\r\n   */\r\n  private clearAuthData(): void {\r\n    try {\r\n      // Clear all auth storage keys\r\n      localStorage.removeItem('supabase_session');\r\n      localStorage.removeItem('sb_access_token');\r\n      localStorage.removeItem('sb_current_user');\r\n      localStorage.removeItem('sb_tenant_id');\r\n      localStorage.removeItem('crm_auth_token');\r\n      localStorage.removeItem('crm_user');\r\n      localStorage.removeItem('crm_tenant_id');\r\n      \r\n      console.log('[SUPABASE_AUTH] Auth data cleared from localStorage');\r\n    } catch (error) {\r\n      this.logError('Failed to clear auth data', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Map database user response to UI User type\r\n   * Converts snake_case database fields to camelCase\r\n   */\r\n  private mapUserResponse(dbUser: any): User {\r\n    // Handle both camelCase (from cache) and snake_case (from database)\r\n    const tenantId = dbUser.tenantId || dbUser.tenant_id;\r\n    const firstName = dbUser.firstName || dbUser.first_name || '';\r\n    const lastName = dbUser.lastName || dbUser.last_name || '';\r\n    const tenantName = dbUser.tenantName || dbUser.tenant_name || '';\r\n    const lastLogin = dbUser.lastLogin || dbUser.last_login || '';\r\n    const createdAt = dbUser.createdAt || dbUser.created_at || new Date().toISOString();\r\n\r\n    console.log('[SUPABASE_AUTH] Mapping user - tenantId:', tenantId, 'from:', { dbUser });\r\n\r\n    return {\r\n      id: dbUser.id,\r\n      email: dbUser.email,\r\n      firstName,\r\n      lastName,\r\n      role: (dbUser.role || 'viewer') as User['role'],\r\n      status: (dbUser.status || 'active') as User['status'],\r\n      tenantId,\r\n      tenantName,\r\n      lastLogin,\r\n      createdAt,\r\n      avatar: dbUser.avatar || '',\r\n      phone: dbUser.phone || '',\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseAuthService = new SupabaseAuthService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\baseService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[559,562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[559,562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1374,1377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1374,1377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1694,1697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1694,1697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6385,6388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6385,6388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7088,7091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7088,7091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":295,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7557,7560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7557,7560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":362,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9259,9262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9259,9262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":398,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":398,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10220,10223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10220,10223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Base Supabase Service Class\r\n * Provides common functionality for all Supabase services:\r\n * - CRUD operations\r\n * - Real-time subscriptions\r\n * - Pagination and filtering\r\n * - Error handling and logging\r\n * - Data transformation\r\n */\r\n\r\nimport { SupabaseClient, PostgrestFilterBuilder } from '@supabase/supabase-js';\r\nimport { getSupabaseClient } from './client';\r\n\r\nexport interface PaginationOptions {\r\n  page?: number;\r\n  pageSize?: number;\r\n  offset?: number;\r\n  limit?: number;\r\n}\r\n\r\nexport interface QueryOptions {\r\n  filters?: Record<string, any>;\r\n  sort?: { field: string; ascending?: boolean }[];\r\n  pagination?: PaginationOptions;\r\n  select?: string;\r\n}\r\n\r\nexport interface SubscriptionOptions {\r\n  event: 'INSERT' | 'UPDATE' | 'DELETE' | '*';\r\n  schema?: string;\r\n  table: string;\r\n  filter?: string;\r\n}\r\n\r\n/**\r\n * Base service class for all Supabase services\r\n * Extends this class to inherit common Supabase functionality\r\n */\r\nexport abstract class BaseSupabaseService {\r\n  protected client: SupabaseClient;\r\n  protected tableName: string;\r\n  protected logEnabled: boolean;\r\n\r\n  constructor(tableName: string, logEnabled: boolean = true) {\r\n    this.client = getSupabaseClient();\r\n    this.tableName = tableName;\r\n    this.logEnabled = logEnabled;\r\n  }\r\n\r\n  /**\r\n   * Log messages with service prefix\r\n   */\r\n  protected log(message: string, data?: any): void {\r\n    if (!this.logEnabled) return;\r\n    \r\n    const prefix = `[${this.tableName}]`;\r\n    if (data) {\r\n      console.log(prefix, message, data);\r\n    } else {\r\n      console.log(prefix, message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log errors with service prefix\r\n   */\r\n  protected logError(message: string, error?: any): void {\r\n    const prefix = `[${this.tableName}]`;\r\n    console.error(prefix, message, error);\r\n  }\r\n\r\n  /**\r\n   * Create a new record\r\n   */\r\n  async create<T>(data: Omit<T, 'id' | 'created_at' | 'updated_at'>): Promise<T> {\r\n    try {\r\n      this.log('Creating record', data);\r\n\r\n      const { data: result, error } = await this.client\r\n        .from(this.tableName)\r\n        .insert([data])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Record created', result);\r\n      return result;\r\n    } catch (error) {\r\n      this.logError('Error creating record', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create multiple records\r\n   */\r\n  async createBatch<T>(items: Omit<T, 'id' | 'created_at' | 'updated_at'>[]): Promise<T[]> {\r\n    try {\r\n      this.log('Creating batch', { count: items.length });\r\n\r\n      const { data: result, error } = await this.client\r\n        .from(this.tableName)\r\n        .insert(items)\r\n        .select();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Batch created', { count: result?.length });\r\n      return result || [];\r\n    } catch (error) {\r\n      this.logError('Error creating batch', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Read a single record by ID\r\n   */\r\n  async getById<T>(id: string | number): Promise<T | null> {\r\n    try {\r\n      this.log('Fetching record', { id });\r\n\r\n      const { data, error } = await this.client\r\n        .from(this.tableName)\r\n        .select()\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') {\r\n        throw error;\r\n      }\r\n\r\n      return data || null;\r\n    } catch (error) {\r\n      this.logError('Error fetching record', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Read all records with optional filtering and pagination\r\n   */\r\n  async getAll<T>(options?: QueryOptions): Promise<T[]> {\r\n    try {\r\n      this.log('Fetching all records', options);\r\n\r\n      let query = this.client.from(this.tableName).select(options?.select || '*');\r\n\r\n      // Apply filters\r\n      if (options?.filters) {\r\n        for (const [field, value] of Object.entries(options.filters)) {\r\n          if (Array.isArray(value)) {\r\n            query = query.in(field, value);\r\n          } else {\r\n            query = query.eq(field, value);\r\n          }\r\n        }\r\n      }\r\n\r\n      // Apply sorting\r\n      if (options?.sort && options.sort.length > 0) {\r\n        for (const sort of options.sort) {\r\n          query = query.order(sort.field, { ascending: sort.ascending !== false });\r\n        }\r\n      }\r\n\r\n      // Apply pagination\r\n      if (options?.pagination) {\r\n        const { page, pageSize, offset, limit } = options.pagination;\r\n        const pageNum = page || 0;\r\n        const size = pageSize || limit || 10;\r\n        const start = offset || pageNum * size;\r\n\r\n        query = query.range(start, start + size - 1);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Records fetched', { count: data?.length });\r\n      return data || [];\r\n    } catch (error) {\r\n      this.logError('Error fetching records', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a record\r\n   */\r\n  async update<T>(id: string | number, updates: Partial<T>): Promise<T> {\r\n    try {\r\n      this.log('Updating record', { id, updates });\r\n\r\n      const { data, error } = await this.client\r\n        .from(this.tableName)\r\n        .update(updates)\r\n        .eq('id', id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Record updated', data);\r\n      return data;\r\n    } catch (error) {\r\n      this.logError('Error updating record', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update multiple records\r\n   */\r\n  async updateBatch<T>(\r\n    ids: (string | number)[],\r\n    updates: Partial<T>\r\n  ): Promise<T[]> {\r\n    try {\r\n      this.log('Updating batch', { ids, updates });\r\n\r\n      const { data, error } = await this.client\r\n        .from(this.tableName)\r\n        .update(updates)\r\n        .in('id', ids)\r\n        .select();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Batch updated', { count: data?.length });\r\n      return data || [];\r\n    } catch (error) {\r\n      this.logError('Error updating batch', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a record (soft delete by default)\r\n   */\r\n  async delete(id: string | number, softDelete: boolean = true): Promise<void> {\r\n    try {\r\n      this.log('Deleting record', { id, softDelete });\r\n\r\n      if (softDelete) {\r\n        // Soft delete - mark as deleted\r\n        await this.update(id, { deleted_at: new Date().toISOString() } as any);\r\n      } else {\r\n        // Hard delete - permanently remove\r\n        const { error } = await this.client\r\n          .from(this.tableName)\r\n          .delete()\r\n          .eq('id', id);\r\n\r\n        if (error) throw error;\r\n      }\r\n\r\n      this.log('Record deleted', { id });\r\n    } catch (error) {\r\n      this.logError('Error deleting record', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete multiple records\r\n   */\r\n  async deleteBatch(ids: (string | number)[], softDelete: boolean = true): Promise<void> {\r\n    try {\r\n      this.log('Deleting batch', { ids, softDelete });\r\n\r\n      if (softDelete) {\r\n        await this.updateBatch(ids, { deleted_at: new Date().toISOString() } as any);\r\n      } else {\r\n        const { error } = await this.client\r\n          .from(this.tableName)\r\n          .delete()\r\n          .in('id', ids);\r\n\r\n        if (error) throw error;\r\n      }\r\n\r\n      this.log('Batch deleted', { count: ids.length });\r\n    } catch (error) {\r\n      this.logError('Error deleting batch', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get count of records with optional filtering\r\n   */\r\n  async getCount(filters?: Record<string, any>): Promise<number> {\r\n    try {\r\n      let query = this.client.from(this.tableName).select('*', { count: 'exact', head: true });\r\n\r\n      if (filters) {\r\n        for (const [field, value] of Object.entries(filters)) {\r\n          query = query.eq(field, value);\r\n        }\r\n      }\r\n\r\n      const { count, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      return count || 0;\r\n    } catch (error) {\r\n      this.logError('Error getting count', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search records by multiple fields\r\n   */\r\n  async search<T>(\r\n    searchTerm: string,\r\n    searchFields: string[],\r\n    options?: QueryOptions\r\n  ): Promise<T[]> {\r\n    try {\r\n      this.log('Searching records', { searchTerm, searchFields });\r\n\r\n      let query = this.client\r\n        .from(this.tableName)\r\n        .select(options?.select || '*');\r\n\r\n      // Use full-text search or ILIKE for pattern matching\r\n      const filters = searchFields\r\n        .map((field) => `${field}.ilike.%${searchTerm}%`)\r\n        .join(',');\r\n\r\n      query = query.or(filters);\r\n\r\n      // Apply additional options\r\n      if (options?.filters) {\r\n        for (const [field, value] of Object.entries(options.filters)) {\r\n          query = query.eq(field, value);\r\n        }\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Search completed', { count: data?.length });\r\n      return data || [];\r\n    } catch (error) {\r\n      this.logError('Error searching records', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time changes\r\n   */\r\n  subscribeToChanges<T>(\r\n    options: SubscriptionOptions,\r\n    callback: (payload: any) => void\r\n  ): () => void {\r\n    try {\r\n      this.log('Subscribing to changes', options);\r\n\r\n      const channel = this.client\r\n        .channel(`public:${options.table}`)\r\n        .on(\r\n          'postgres_changes',\r\n          {\r\n            event: options.event,\r\n            schema: options.schema || 'public',\r\n            table: options.table,\r\n            filter: options.filter,\r\n          },\r\n          (payload) => {\r\n            this.log('Change received', payload);\r\n            callback(payload);\r\n          }\r\n        )\r\n        .subscribe();\r\n\r\n      // Return unsubscribe function\r\n      return () => {\r\n        this.log('Unsubscribing from changes', options);\r\n        this.client.removeChannel(channel);\r\n      };\r\n    } catch (error) {\r\n      this.logError('Error subscribing to changes', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute raw SQL query (for complex operations)\r\n   */\r\n  async query<T>(sql: string, params?: any[]): Promise<T[]> {\r\n    try {\r\n      this.log('Executing query', { sql });\r\n\r\n      const { data, error } = await this.client.rpc('query', { sql, params });\r\n\r\n      if (error) throw error;\r\n\r\n      return data || [];\r\n    } catch (error) {\r\n      this.logError('Error executing query', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Begin transaction (for multiple operations)\r\n   */\r\n  async transaction<T>(callback: (client: SupabaseClient) => Promise<T>): Promise<T> {\r\n    try {\r\n      this.log('Starting transaction');\r\n      const result = await callback(this.client);\r\n      this.log('Transaction completed');\r\n      return result;\r\n    } catch (error) {\r\n      this.logError('Transaction failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nexport default BaseSupabaseService;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1108,1111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1108,1111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1122,1125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1122,1125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2856,2859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2856,2859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3028,3031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3028,3031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3190,3193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3190,3193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3360,3363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3360,3363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4092,4095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4092,4095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4696,4699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4696,4699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5811,5814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5811,5814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6616,6619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6616,6619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7217,7220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7217,7220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8167,8170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8167,8170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9415,9418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9415,9418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9429,9432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9429,9432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Client Initialization\r\n * Central point for all Supabase database operations\r\n * \r\n * IMPORTANT: Uses singleton pattern with initialization guard to prevent\r\n * multiple GoTrueClient instances. This is critical for:\r\n * - React.StrictMode (which double-invokes in development)\r\n * - Hot module reloading during development\r\n * - Concurrent module loading\r\n */\r\n\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport type { SupabaseClient } from '@supabase/supabase-js';\r\n\r\n// Environment variables from .env\r\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\r\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\r\nconst supabaseServiceKey = import.meta.env.VITE_SUPABASE_SERVICE_KEY;\r\n\r\n// Validate configuration\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  console.error('‚ùå Supabase configuration missing. Check VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in .env');\r\n}\r\n\r\n// EXTRA SAFETY: Suppress development warnings from libraries\r\n// This ensures we only see meaningful warnings in development\r\nconst originalWarn = console.warn;\r\nconst warnFilter = (message: any, ...args: any[]) => {\r\n  // Suppress the Multiple GoTrueClient instances warning (Supabase)\r\n  if (\r\n    typeof message === 'string' &&\r\n    message.includes('Multiple GoTrueClient instances detected')\r\n  ) {\r\n    return; // Don't log this warning\r\n  }\r\n  // Suppress React Router Future Flag warnings (we already opted-in via future flags)\r\n  if (\r\n    typeof message === 'string' &&\r\n    message.includes('React Router will begin wrapping state updates in `React.startTransition`')\r\n  ) {\r\n    return; // Don't log this warning - we've already opted in\r\n  }\r\n  // Log all other warnings normally\r\n  return originalWarn.call(console, message, ...args);\r\n};\r\nconsole.warn = warnFilter;\r\n\r\n/**\r\n * SUPER BULLETPROOF Singleton Pattern - Final Solution\r\n * \r\n * PROBLEM: React.StrictMode resets module-level variables, causing:\r\n * 1. Multiple GoTrueClient instances to be created\r\n * 2. Warning: \"Multiple GoTrueClient instances detected in the same browser context\"\r\n * 3. Multiple instances trying to access the same localStorage key\r\n * \r\n * SOLUTION: Store initialization state in window object (persistent across \r\n * module reloads and React re-renders). This ensures:\r\n * - Only ONE createClient() call ever happens\r\n * - New module executions check window state first\r\n * - Old instances are properly detected and reused\r\n */\r\n\r\n// Module-level cache (may be reset by React.StrictMode)\r\nlet _clientInstance: SupabaseClient | null = null;\r\nlet _adminInstance: SupabaseClient | null = null;\r\n\r\n// CRITICAL: Use window for persistent initialization flags\r\n// These survive module reloads, HMR, and React.StrictMode double-invocations\r\nconst getClientInitFlag = (): boolean => {\r\n  if (typeof window !== 'undefined') {\r\n    return (window as any).__SUPABASE_CLIENT_INITIALIZED__ === true;\r\n  }\r\n  return false;\r\n};\r\n\r\nconst setClientInitFlag = (): void => {\r\n  if (typeof window !== 'undefined') {\r\n    (window as any).__SUPABASE_CLIENT_INITIALIZED__ = true;\r\n  }\r\n};\r\n\r\nconst getAdminInitFlag = (): boolean => {\r\n  if (typeof window !== 'undefined') {\r\n    return (window as any).__SUPABASE_ADMIN_INITIALIZED__ === true;\r\n  }\r\n  return false;\r\n};\r\n\r\nconst setAdminInitFlag = (): void => {\r\n  if (typeof window !== 'undefined') {\r\n    (window as any).__SUPABASE_ADMIN_INITIALIZED__ = true;\r\n  }\r\n};\r\n\r\n/**\r\n * Get or create the main Supabase client (singleton)\r\n * \r\n * INITIALIZATION SEQUENCE:\r\n * 1. Check if already initialized via window flag (survives React.StrictMode)\r\n * 2. If yes, return cached instance from window\r\n * 3. If no, set flag BEFORE creating to block concurrent creation attempts\r\n * 4. Cache instance on both window and module level\r\n * \r\n * This ensures createClient() is called EXACTLY ONCE across all module reloads\r\n */\r\nconst initializeClientSingleton = (): SupabaseClient => {\r\n  // STEP 1: Check window cache first (persistent across module reloads and React.StrictMode)\r\n  if (typeof window !== 'undefined') {\r\n    const cachedClient = (window as any).__SUPABASE_CLIENT__;\r\n    if (cachedClient) {\r\n      _clientInstance = cachedClient;\r\n      return cachedClient;\r\n    }\r\n  }\r\n\r\n  // STEP 2: Check module-level cache (fast path for same module execution)\r\n  if (_clientInstance !== null) {\r\n    return _clientInstance;\r\n  }\r\n\r\n  // STEP 3: Check persistent initialization flag\r\n  // If flag is true, another execution is creating the client or already created it\r\n  if (getClientInitFlag()) {\r\n    // Wait for instance to appear in window cache (already being created)\r\n    if (typeof window !== 'undefined') {\r\n      const windowClient = (window as any).__SUPABASE_CLIENT__;\r\n      if (windowClient) {\r\n        _clientInstance = windowClient;\r\n        return windowClient;\r\n      }\r\n    }\r\n    // Should not reach here, but return module cache if available\r\n    return _clientInstance!;\r\n  }\r\n\r\n  // STEP 4: CRITICAL - Set initialization flag BEFORE calling createClient()\r\n  // This blocks any concurrent execution from also calling createClient()\r\n  setClientInitFlag();\r\n  \r\n  console.log('üîß Initializing Supabase client singleton (first access)...');\r\n  \r\n  // STEP 5: Create the client (this is now guaranteed to be called only once)\r\n  _clientInstance = createClient(\r\n    supabaseUrl,\r\n    supabaseAnonKey,\r\n    {\r\n      auth: {\r\n        persistSession: true,\r\n        autoRefreshToken: true,\r\n        detectSessionInUrl: true,\r\n        storage: typeof window !== 'undefined' ? window.localStorage : undefined,\r\n      },\r\n      realtime: {\r\n        params: {\r\n          eventsPerSecond: 10,\r\n        },\r\n      },\r\n    }\r\n  );\r\n\r\n  // STEP 6: Cache on window for all future module reloads to retrieve\r\n  if (typeof window !== 'undefined') {\r\n    (window as any).__SUPABASE_CLIENT__ = _clientInstance;\r\n  }\r\n\r\n  return _clientInstance;\r\n};\r\n\r\n/**\r\n * Get or create the admin Supabase client (singleton)\r\n * \r\n * INITIALIZATION SEQUENCE (same as client, but for admin/service role):\r\n * 1. Check if already initialized via window flag (survives React.StrictMode)\r\n * 2. If yes, return cached instance from window\r\n * 3. If no, set flag BEFORE creating to block concurrent creation attempts\r\n * 4. Cache instance on both window and module level\r\n * \r\n * This ensures createClient() is called EXACTLY ONCE across all module reloads\r\n */\r\nconst initializeAdminSingleton = (): SupabaseClient => {\r\n  // STEP 1: Check window cache first (persistent across module reloads and React.StrictMode)\r\n  if (typeof window !== 'undefined') {\r\n    const cachedAdmin = (window as any).__SUPABASE_ADMIN__;\r\n    if (cachedAdmin) {\r\n      _adminInstance = cachedAdmin;\r\n      return cachedAdmin;\r\n    }\r\n  }\r\n\r\n  // STEP 2: Check module-level cache (fast path for same module execution)\r\n  if (_adminInstance !== null) {\r\n    return _adminInstance;\r\n  }\r\n\r\n  // STEP 3: Check persistent initialization flag\r\n  // If flag is true, another execution is creating the admin client or already created it\r\n  if (getAdminInitFlag()) {\r\n    // Wait for instance to appear in window cache (already being created)\r\n    if (typeof window !== 'undefined') {\r\n      const windowAdmin = (window as any).__SUPABASE_ADMIN__;\r\n      if (windowAdmin) {\r\n        _adminInstance = windowAdmin;\r\n        return windowAdmin;\r\n      }\r\n    }\r\n    // Should not reach here, but return module cache if available\r\n    return _adminInstance!;\r\n  }\r\n\r\n  // STEP 4: CRITICAL - Set initialization flag BEFORE calling createClient()\r\n  // This blocks any concurrent execution from also calling createClient()\r\n  setAdminInitFlag();\r\n  \r\n  console.log('üîß Initializing Supabase admin client singleton (first access)...');\r\n  \r\n  // STEP 5: Create the admin client (this is now guaranteed to be called only once)\r\n  _adminInstance = createClient(\r\n    supabaseUrl,\r\n    supabaseServiceKey,\r\n    {\r\n      auth: {\r\n        persistSession: false,\r\n        autoRefreshToken: false,\r\n        detectSessionInUrl: false,\r\n      },\r\n    }\r\n  );\r\n\r\n  // STEP 6: Cache on window for all future module reloads to retrieve\r\n  if (typeof window !== 'undefined') {\r\n    (window as any).__SUPABASE_ADMIN__ = _adminInstance;\r\n  }\r\n\r\n  return _adminInstance;\r\n};\r\n\r\n/**\r\n * Main Supabase client for authenticated requests\r\n * Uses ANON_KEY for row-level security\r\n * Initialized on first module load\r\n */\r\nexport const supabaseClient: SupabaseClient = initializeClientSingleton();\r\n\r\n/**\r\n * Service role client for admin operations  \r\n * Should only be used on backend (Edge Functions, API routes)\r\n * DO NOT expose this key to frontend\r\n * Initialized on first module load\r\n */\r\nexport const supabaseAdmin: SupabaseClient = initializeAdminSingleton();\r\n\r\n/**\r\n * Get current session user\r\n */\r\nexport const getCurrentUser = async () => {\r\n  try {\r\n    const { data: { user } } = await supabaseClient.auth.getUser();\r\n    return user;\r\n  } catch (error) {\r\n    console.error('Error getting current user:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Get current session\r\n */\r\nexport const getCurrentSession = async () => {\r\n  try {\r\n    const { data: { session } } = await supabaseClient.auth.getSession();\r\n    return session;\r\n  } catch (error) {\r\n    console.error('Error getting session:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Subscribe to auth state changes\r\n */\r\nexport const onAuthStateChange = (callback: (user: any, session: any) => void) => {\r\n  return supabaseClient.auth.onAuthStateChange((event, session) => {\r\n    callback(session?.user, session);\r\n  });\r\n};\r\n\r\n/**\r\n * Logout\r\n */\r\nexport const logout = async () => {\r\n  try {\r\n    const { error } = await supabaseClient.auth.signOut();\r\n    if (error) throw error;\r\n  } catch (error) {\r\n    console.error('Error logging out:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Get Supabase client instance\r\n */\r\nexport const getSupabaseClient = (): SupabaseClient => {\r\n  return supabaseClient;\r\n};\r\n\r\n/**\r\n * Check if client is properly configured\r\n */\r\nexport const isSupabaseConfigured = (): boolean => {\r\n  return !!(supabaseUrl && supabaseAnonKey);\r\n};\r\n\r\n/**\r\n * Get connection status\r\n */\r\nexport const getConnectionStatus = async (): Promise<'connected' | 'disconnected'> => {\r\n  try {\r\n    const { data } = await supabaseClient.from('tenants').select('id').limit(1);\r\n    return data !== null ? 'connected' : 'disconnected';\r\n  } catch {\r\n    return 'disconnected';\r\n  }\r\n};\r\n\r\nexport default supabaseClient;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\companyService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[812,815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[812,815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7788,7791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7788,7791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9029,9032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9029,9032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":341,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9301,9304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9301,9304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Company Service\r\n * Handles company/organization management across the platform\r\n * Extends BaseSupabaseService for common database operations\r\n */\r\n\r\nimport { BaseSupabaseService } from './baseService';\r\nimport { getSupabaseClient } from './client';\r\n\r\nexport interface Company {\r\n  id: string;\r\n  name: string;\r\n  domain?: string;\r\n  description?: string;\r\n  logo_url?: string;\r\n  website?: string;\r\n  industry?: string;\r\n  size?: string;\r\n  address?: string;\r\n  city?: string;\r\n  country?: string;\r\n  phone?: string;\r\n  email?: string;\r\n  tax_id?: string;\r\n  registration_number?: string;\r\n  status: 'active' | 'inactive' | 'suspended';\r\n  plan?: 'free' | 'pro' | 'enterprise';\r\n  subscription_status?: 'active' | 'inactive' | 'trial';\r\n  trial_ends_at?: string;\r\n  metadata?: Record<string, any>;\r\n  tenant_id?: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CompanyFilters {\r\n  status?: string;\r\n  plan?: string;\r\n  industry?: string;\r\n  search?: string;\r\n}\r\n\r\nexport class SupabaseCompanyService extends BaseSupabaseService {\r\n  constructor() {\r\n    super('companies', true);\r\n  }\r\n\r\n  /**\r\n   * Get all companies\r\n   */\r\n  async getCompanies(filters?: CompanyFilters): Promise<Company[]> {\r\n    try {\r\n      this.log('Fetching companies', filters);\r\n\r\n      let query = getSupabaseClient().from('companies').select('*');\r\n\r\n      // Apply filters\r\n      if (filters?.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n      if (filters?.plan) {\r\n        query = query.eq('plan', filters.plan);\r\n      }\r\n      if (filters?.industry) {\r\n        query = query.eq('industry', filters.industry);\r\n      }\r\n\r\n      // Exclude deleted records\r\n      query = query.is('deleted_at', null);\r\n\r\n      const { data, error } = await query.order('name');\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Companies fetched', { count: data?.length });\r\n      return data?.map((c) => this.mapCompanyResponse(c)) || [];\r\n    } catch (error) {\r\n      this.logError('Error fetching companies', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get company by ID\r\n   */\r\n  async getCompany(id: string): Promise<Company | null> {\r\n    try {\r\n      this.log('Fetching company', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('companies')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data ? this.mapCompanyResponse(data) : null;\r\n    } catch (error) {\r\n      this.logError('Error fetching company', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get company by domain\r\n   */\r\n  async getCompanyByDomain(domain: string): Promise<Company | null> {\r\n    try {\r\n      this.log('Fetching company by domain', { domain });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('companies')\r\n        .select('*')\r\n        .eq('domain', domain)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data ? this.mapCompanyResponse(data) : null;\r\n    } catch (error) {\r\n      this.logError('Error fetching company by domain', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new company\r\n   */\r\n  async createCompany(data: Partial<Company>): Promise<Company> {\r\n    try {\r\n      this.log('Creating company', { name: data.name });\r\n\r\n      const { data: created, error } = await getSupabaseClient()\r\n        .from('companies')\r\n        .insert([\r\n          {\r\n            name: data.name,\r\n            domain: data.domain,\r\n            description: data.description,\r\n            logo_url: data.logo_url,\r\n            website: data.website,\r\n            industry: data.industry,\r\n            size: data.size,\r\n            address: data.address,\r\n            city: data.city,\r\n            country: data.country,\r\n            phone: data.phone,\r\n            email: data.email,\r\n            tax_id: data.tax_id,\r\n            registration_number: data.registration_number,\r\n            status: data.status || 'active',\r\n            plan: data.plan || 'pro',\r\n            subscription_status: data.subscription_status || 'active',\r\n            trial_ends_at: data.trial_ends_at,\r\n            metadata: data.metadata,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Company created successfully', { id: created.id });\r\n      return this.mapCompanyResponse(created);\r\n    } catch (error) {\r\n      this.logError('Error creating company', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update company\r\n   */\r\n  async updateCompany(id: string, updates: Partial<Company>): Promise<Company> {\r\n    try {\r\n      this.log('Updating company', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('companies')\r\n        .update({\r\n          name: updates.name,\r\n          domain: updates.domain,\r\n          description: updates.description,\r\n          logo_url: updates.logo_url,\r\n          website: updates.website,\r\n          industry: updates.industry,\r\n          size: updates.size,\r\n          address: updates.address,\r\n          city: updates.city,\r\n          country: updates.country,\r\n          phone: updates.phone,\r\n          email: updates.email,\r\n          tax_id: updates.tax_id,\r\n          registration_number: updates.registration_number,\r\n          status: updates.status,\r\n          plan: updates.plan,\r\n          subscription_status: updates.subscription_status,\r\n          trial_ends_at: updates.trial_ends_at,\r\n          metadata: updates.metadata,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Company updated successfully', { id });\r\n      return this.mapCompanyResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error updating company', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete company (soft delete)\r\n   */\r\n  async deleteCompany(id: string): Promise<void> {\r\n    try {\r\n      this.log('Deleting company', { id });\r\n\r\n      const { error } = await getSupabaseClient()\r\n        .from('companies')\r\n        .update({ deleted_at: new Date().toISOString() })\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Company deleted successfully', { id });\r\n    } catch (error) {\r\n      this.logError('Error deleting company', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search companies\r\n   */\r\n  async searchCompanies(searchTerm: string): Promise<Company[]> {\r\n    try {\r\n      this.log('Searching companies', { searchTerm });\r\n\r\n      let query = getSupabaseClient()\r\n        .from('companies')\r\n        .select('*')\r\n        .or(`name.ilike.%${searchTerm}%,domain.ilike.%${searchTerm}%`);\r\n\r\n      query = query.is('deleted_at', null);\r\n\r\n      const { data, error } = await query.order('name');\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Search completed', { count: data?.length });\r\n      return data?.map((c) => this.mapCompanyResponse(c)) || [];\r\n    } catch (error) {\r\n      this.logError('Error searching companies', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update company subscription\r\n   */\r\n  async updateSubscription(\r\n    id: string,\r\n    plan: 'free' | 'pro' | 'enterprise',\r\n    status: 'active' | 'inactive' | 'trial'\r\n  ): Promise<Company> {\r\n    try {\r\n      this.log('Updating company subscription', { id, plan, status });\r\n\r\n      return this.updateCompany(id, {\r\n        plan,\r\n        subscription_status: status,\r\n        updated_at: new Date().toISOString(),\r\n      } as any);\r\n    } catch (error) {\r\n      this.logError('Error updating subscription', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get company statistics\r\n   */\r\n  async getCompanyStats(): Promise<{\r\n    total: number;\r\n    active: number;\r\n    suspended: number;\r\n    byPlan: Record<string, number>;\r\n    byStatus: Record<string, number>;\r\n  }> {\r\n    try {\r\n      this.log('Fetching company statistics');\r\n\r\n      const companies = await this.getCompanies();\r\n\r\n      const stats = {\r\n        total: companies.length,\r\n        active: companies.filter((c) => c.status === 'active').length,\r\n        suspended: companies.filter((c) => c.status === 'suspended').length,\r\n        byPlan: {} as Record<string, number>,\r\n        byStatus: {} as Record<string, number>,\r\n      };\r\n\r\n      companies.forEach((c) => {\r\n        if (c.plan) {\r\n          stats.byPlan[c.plan] = (stats.byPlan[c.plan] || 0) + 1;\r\n        }\r\n        stats.byStatus[c.status] = (stats.byStatus[c.status] || 0) + 1;\r\n      });\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      this.logError('Error fetching company statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to company changes\r\n   */\r\n  subscribeToCompanies(callback: (payload: any) => void): () => void {\r\n    return this.subscribeToChanges(\r\n      {\r\n        event: '*',\r\n        table: 'companies',\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Map database company response to Company type\r\n   */\r\n  private mapCompanyResponse(dbCompany: any): Company {\r\n    return {\r\n      id: dbCompany.id,\r\n      name: dbCompany.name,\r\n      domain: dbCompany.domain || '',\r\n      description: dbCompany.description || '',\r\n      logo_url: dbCompany.logo_url || '',\r\n      website: dbCompany.website || '',\r\n      industry: dbCompany.industry || '',\r\n      size: dbCompany.size || '',\r\n      address: dbCompany.address || '',\r\n      city: dbCompany.city || '',\r\n      country: dbCompany.country || '',\r\n      phone: dbCompany.phone || '',\r\n      email: dbCompany.email || '',\r\n      tax_id: dbCompany.tax_id || '',\r\n      registration_number: dbCompany.registration_number || '',\r\n      status: (dbCompany.status || 'active') as Company['status'],\r\n      plan: (dbCompany.plan || 'pro') as Company['plan'],\r\n      subscription_status: (dbCompany.subscription_status || 'active') as Company['subscription_status'],\r\n      trial_ends_at: dbCompany.trial_ends_at,\r\n      metadata: dbCompany.metadata,\r\n      tenant_id: dbCompany.tenant_id,\r\n      created_at: dbCompany.created_at,\r\n      updated_at: dbCompany.updated_at,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseCompanyService = new SupabaseCompanyService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\contractService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12198,12201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12198,12201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":409,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":409,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13015,13018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13015,13018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":440,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":440,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13730,13733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13730,13733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":509,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":509,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15688,15691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15688,15691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":524,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":524,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16016,16019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16016,16019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":543,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":543,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16725,16728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16725,16728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":579,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":579,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18012,18015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18012,18015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":618,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19642,19645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19642,19645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Contract Service\r\n * Handles contract management, templates, versions, approvals\r\n * Extends BaseSupabaseService for common database operations\r\n */\r\n\r\nimport { BaseSupabaseService } from './baseService';\r\nimport { getSupabaseClient } from './client';\r\nimport { Contract } from '@/types/contracts';\r\n\r\nexport interface ContractFilters {\r\n  status?: string;\r\n  type?: string;\r\n  customer_id?: string;\r\n  assigned_to?: string;\r\n  priority?: string;\r\n  search?: string;\r\n  date_from?: string;\r\n  date_to?: string;\r\n  expiring_soon?: boolean;\r\n  auto_renew?: boolean;\r\n  tags?: string[];\r\n  compliance_status?: string;\r\n  value_min?: number;\r\n  value_max?: number;\r\n}\r\n\r\nexport class SupabaseContractService extends BaseSupabaseService {\r\n  constructor() {\r\n    super('contracts', true);\r\n  }\r\n\r\n  /**\r\n   * Get all contracts with optional filtering and pagination\r\n   * Returns paginated response with data array\r\n   */\r\n  async getContracts(filters?: ContractFilters & { page?: number; pageSize?: number }): Promise<any> {\r\n    try {\r\n      this.log('Fetching contracts', filters);\r\n\r\n      const page = filters?.page || 1;\r\n      const pageSize = filters?.pageSize || 20;\r\n      const offset = (page - 1) * pageSize;\r\n\r\n      let query = getSupabaseClient()\r\n        .from('contracts')\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          template:contract_templates(*),\r\n          parties:contract_parties(*),\r\n          approval_history:contract_approval_records(*),\r\n          attachments:contract_attachments(*)`\r\n        );\r\n\r\n      // Apply filters\r\n      if (filters?.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n      if (filters?.type) {\r\n        query = query.eq('type', filters.type);\r\n      }\r\n      if (filters?.customer_id) {\r\n        query = query.eq('customer_id', filters.customer_id);\r\n      }\r\n      if (filters?.assigned_to) {\r\n        query = query.eq('assigned_to', filters.assigned_to);\r\n      }\r\n      if (filters?.priority) {\r\n        query = query.eq('priority', filters.priority);\r\n      }\r\n      if (filters?.compliance_status) {\r\n        query = query.eq('compliance_status', filters.compliance_status);\r\n      }\r\n      if (filters?.auto_renew !== undefined) {\r\n        query = query.eq('auto_renew', filters.auto_renew);\r\n      }\r\n      if (filters?.tags && filters.tags.length > 0) {\r\n        query = query.contains('tags', filters.tags);\r\n      }\r\n\r\n      // Date range filters\r\n      if (filters?.date_from) {\r\n        query = query.gte('start_date', filters.date_from);\r\n      }\r\n      if (filters?.date_to) {\r\n        query = query.lte('end_date', filters.date_to);\r\n      }\r\n\r\n      // Value range filters\r\n      if (filters?.value_min !== undefined) {\r\n        query = query.gte('value', filters.value_min);\r\n      }\r\n      if (filters?.value_max !== undefined) {\r\n        query = query.lte('value', filters.value_max);\r\n      }\r\n\r\n      // Exclude deleted records\r\n      query = query.is('deleted_at', null);\r\n\r\n      // Get total count first for pagination\r\n      const { count } = await query;\r\n\r\n      // Apply ordering and pagination\r\n      const { data, error } = await query\r\n        .order('created_at', { ascending: false })\r\n        .range(offset, offset + pageSize - 1);\r\n\r\n      if (error) throw error;\r\n\r\n      // Post-process for expiring_soon filter (30-day window)\r\n      let results = data?.map((c) => this.mapContractResponse(c)) || [];\r\n      if (filters?.expiring_soon) {\r\n        const now = new Date();\r\n        const threshold = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\r\n        results = results.filter((c) => {\r\n          if (!c.end_date) return false;\r\n          const endDate = new Date(c.end_date);\r\n          return endDate <= threshold && endDate >= now;\r\n        });\r\n      }\r\n\r\n      // Search filter (full-text search)\r\n      if (filters?.search) {\r\n        const searchLower = filters.search.toLowerCase();\r\n        results = results.filter((c) =>\r\n          c.title.toLowerCase().includes(searchLower) ||\r\n          c.description?.toLowerCase().includes(searchLower) ||\r\n          c.contract_number?.toLowerCase().includes(searchLower) ||\r\n          c.customer_name?.toLowerCase().includes(searchLower)\r\n        );\r\n      }\r\n\r\n      const total = count || 0;\r\n      const totalPages = Math.ceil(total / pageSize);\r\n\r\n      this.log('Contracts fetched', { count: results?.length, total, page, pageSize });\r\n\r\n      // Return paginated response matching PaginatedResponse<Contract> interface\r\n      return {\r\n        data: results,\r\n        page,\r\n        pageSize,\r\n        total,\r\n        totalPages,\r\n      };\r\n    } catch (error) {\r\n      this.logError('Error fetching contracts', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get contract by ID\r\n   */\r\n  async getContract(id: string): Promise<Contract | null> {\r\n    try {\r\n      this.log('Fetching contract', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('contracts')\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          template:contract_templates(*),\r\n          parties:contract_parties(*),\r\n          approvals:contract_approval_records(*)`\r\n        )\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data ? this.mapContractResponse(data) : null;\r\n    } catch (error) {\r\n      this.logError('Error fetching contract', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new contract\r\n   */\r\n  async createContract(data: Partial<Contract>): Promise<Contract> {\r\n    try {\r\n      this.log('Creating contract', { customer_id: data.customer_id });\r\n\r\n      const { data: created, error } = await getSupabaseClient()\r\n        .from('contracts')\r\n        .insert([\r\n          {\r\n            contract_number: data.contract_number,\r\n            title: data.title,\r\n            description: data.description,\r\n            customer_id: data.customer_id,\r\n            customer_contact: data.customer_contact,\r\n            deal_id: data.deal_id,\r\n            deal_title: data.deal_title,\r\n            type: data.type || 'service_agreement',\r\n            status: data.status || 'draft',\r\n            start_date: data.start_date,\r\n            end_date: data.end_date,\r\n            signed_date: data.signed_date,\r\n            next_renewal_date: data.next_renewal_date,\r\n            auto_renew: data.auto_renew ?? false,\r\n            renewal_period_months: data.renewal_period_months,\r\n            renewal_terms: data.renewal_terms,\r\n            terms: data.terms,\r\n            value: data.value || 0,\r\n            currency: data.currency || 'USD',\r\n            payment_terms: data.payment_terms,\r\n            delivery_terms: data.delivery_terms,\r\n            template_id: data.template_id,\r\n            content: data.content,\r\n            document_path: data.document_path,\r\n            document_url: data.document_url,\r\n            version: data.version || 1,\r\n            approval_stage: data.approval_stage,\r\n            compliance_status: data.compliance_status || 'pending_review',\r\n            created_by: data.created_by,\r\n            assigned_to: data.assigned_to,\r\n            assigned_to_name: data.assigned_to_name,\r\n            tags: data.tags || [],\r\n            priority: data.priority || 'medium',\r\n            reminder_days: data.reminder_days || [],\r\n            next_reminder_date: data.next_reminder_date,\r\n            notes: data.notes,\r\n            signed_by_customer: data.signed_by_customer,\r\n            signed_by_company: data.signed_by_company,\r\n            tenant_id: data.tenant_id,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          template:contract_templates(*),\r\n          parties:contract_parties(*),\r\n          approval_history:contract_approval_records(*),\r\n          attachments:contract_attachments(*)`\r\n        )\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Contract created successfully', { id: created.id });\r\n      return this.mapContractResponse(created);\r\n    } catch (error) {\r\n      this.logError('Error creating contract', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update contract\r\n   */\r\n  async updateContract(id: string, updates: Partial<Contract>): Promise<Contract> {\r\n    try {\r\n      this.log('Updating contract', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('contracts')\r\n        .update({\r\n          title: updates.title,\r\n          description: updates.description,\r\n          customer_contact: updates.customer_contact,\r\n          deal_id: updates.deal_id,\r\n          deal_title: updates.deal_title,\r\n          type: updates.type,\r\n          status: updates.status,\r\n          start_date: updates.start_date,\r\n          end_date: updates.end_date,\r\n          signed_date: updates.signed_date,\r\n          next_renewal_date: updates.next_renewal_date,\r\n          auto_renew: updates.auto_renew,\r\n          renewal_period_months: updates.renewal_period_months,\r\n          renewal_terms: updates.renewal_terms,\r\n          terms: updates.terms,\r\n          value: updates.value,\r\n          currency: updates.currency,\r\n          payment_terms: updates.payment_terms,\r\n          delivery_terms: updates.delivery_terms,\r\n          content: updates.content,\r\n          document_path: updates.document_path,\r\n          document_url: updates.document_url,\r\n          version: updates.version,\r\n          approval_stage: updates.approval_stage,\r\n          compliance_status: updates.compliance_status,\r\n          assigned_to: updates.assigned_to,\r\n          assigned_to_name: updates.assigned_to_name,\r\n          tags: updates.tags,\r\n          priority: updates.priority,\r\n          reminder_days: updates.reminder_days,\r\n          next_reminder_date: updates.next_reminder_date,\r\n          notes: updates.notes,\r\n          signed_by_customer: updates.signed_by_customer,\r\n          signed_by_company: updates.signed_by_company,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id)\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          template:contract_templates(*),\r\n          parties:contract_parties(*),\r\n          approval_history:contract_approval_records(*),\r\n          attachments:contract_attachments(*)`\r\n        )\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Contract updated successfully', { id });\r\n      return this.mapContractResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error updating contract', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete contract (soft delete)\r\n   */\r\n  async deleteContract(id: string): Promise<void> {\r\n    try {\r\n      this.log('Deleting contract', { id });\r\n\r\n      const { error } = await getSupabaseClient()\r\n        .from('contracts')\r\n        .update({ deleted_at: new Date().toISOString() })\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Contract deleted successfully', { id });\r\n    } catch (error) {\r\n      this.logError('Error deleting contract', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get contracts expiring soon\r\n   */\r\n  async getExpiringContracts(filters?: ContractFilters, daysThreshold: number = 30): Promise<Contract[]> {\r\n    try {\r\n      this.log('Fetching expiring contracts', { filters, daysThreshold });\r\n\r\n      const now = new Date();\r\n      const threshold = new Date(now.getTime() + daysThreshold * 24 * 60 * 60 * 1000);\r\n\r\n      // Use expiring_soon filter\r\n      const expiringFilters: ContractFilters = {\r\n        ...filters,\r\n        expiring_soon: true,\r\n      };\r\n\r\n      const contracts = await this.getContracts(expiringFilters);\r\n\r\n      return contracts;\r\n    } catch (error) {\r\n      this.logError('Error fetching expiring contracts', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Request contract approval\r\n   */\r\n  async requestApproval(\r\n    contractId: string,\r\n    approverId: string,\r\n    comments?: string\r\n  ): Promise<any> {\r\n    try {\r\n      this.log('Requesting contract approval', { contractId, approverId });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('contract_approvals')\r\n        .insert([\r\n          {\r\n            contract_id: contractId,\r\n            approver_id: approverId,\r\n            status: 'pending',\r\n            comments,\r\n            created_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Approval requested successfully');\r\n      return data;\r\n    } catch (error) {\r\n      this.logError('Error requesting approval', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Approve contract\r\n   */\r\n  async approveContract(\r\n    approvalId: string,\r\n    comments?: string\r\n  ): Promise<any> {\r\n    try {\r\n      this.log('Approving contract', { approvalId });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('contract_approvals')\r\n        .update({\r\n          status: 'approved',\r\n          comments,\r\n          approved_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', approvalId)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Contract approved successfully');\r\n      return data;\r\n    } catch (error) {\r\n      this.logError('Error approving contract', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reject contract\r\n   */\r\n  async rejectContract(\r\n    approvalId: string,\r\n    comments?: string\r\n  ): Promise<any> {\r\n    try {\r\n      this.log('Rejecting contract', { approvalId });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('contract_approvals')\r\n        .update({\r\n          status: 'rejected',\r\n          comments,\r\n          rejected_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', approvalId)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Contract rejected successfully');\r\n      return data;\r\n    } catch (error) {\r\n      this.logError('Error rejecting contract', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get contract statistics\r\n   */\r\n  async getContractStats(filters?: ContractFilters): Promise<{\r\n    total: number;\r\n    active: number;\r\n    expiring: number;\r\n    totalValue: number;\r\n    byStatus: Record<string, number>;\r\n    byType: Record<string, number>;\r\n  }> {\r\n    try {\r\n      this.log('Fetching contract statistics', { filters });\r\n\r\n      const contractsResponse = await this.getContracts(filters);\r\n      const contracts = contractsResponse.data || [];\r\n      const expiringContracts = await this.getExpiringContracts(filters);\r\n\r\n      const stats = {\r\n        total: contracts.length,\r\n        active: contracts.filter((c) => c.status === 'active').length,\r\n        expiring: expiringContracts.length,\r\n        totalValue: contracts.reduce((sum, c) => sum + (c.value || 0), 0),\r\n        byStatus: {} as Record<string, number>,\r\n        byType: {} as Record<string, number>,\r\n      };\r\n\r\n      contracts.forEach((c) => {\r\n        stats.byStatus[c.status] = (stats.byStatus[c.status] || 0) + 1;\r\n        stats.byType[c.type] = (stats.byType[c.type] || 0) + 1;\r\n      });\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      this.logError('Error fetching contract statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to contract changes\r\n   */\r\n  subscribeToContracts(\r\n    tenantId: string,\r\n    callback: (payload: any) => void\r\n  ): () => void {\r\n    return this.subscribeToChanges(\r\n      {\r\n        event: '*',\r\n        table: 'contracts',\r\n        filter: `tenant_id=eq.${tenantId}`,\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Map database contract response to UI Contract type\r\n   */\r\n  private mapContractResponse(dbContract: any): Contract {\r\n    return {\r\n      id: dbContract.id,\r\n      contract_number: dbContract.contract_number,\r\n      title: dbContract.title,\r\n      description: dbContract.description || '',\r\n      type: (dbContract.type || 'service_agreement') as Contract['type'],\r\n      status: (dbContract.status || 'draft') as Contract['status'],\r\n\r\n      // Customer Relationship\r\n      customer_id: dbContract.customer_id,\r\n      customer_name: dbContract.customer?.company_name || '',\r\n      customer_contact: dbContract.customer_contact,\r\n\r\n      // Deal Relationship\r\n      deal_id: dbContract.deal_id,\r\n      deal_title: dbContract.deal_title,\r\n\r\n      // Parties\r\n      parties: (dbContract.parties || []).map((p: any) => ({\r\n        id: p.id,\r\n        name: p.name,\r\n        email: p.email,\r\n        phone: p.phone,\r\n        company: p.company,\r\n        role: p.role,\r\n        is_primary: p.is_primary,\r\n        customer_id: p.customer_id,\r\n        signature_required: p.signature_required,\r\n        signed_at: p.signed_at,\r\n        signature_url: p.signature_url,\r\n        signature_status: p.signature_status,\r\n      })),\r\n\r\n      // Financial\r\n      value: dbContract.value || 0,\r\n      total_value: dbContract.value || 0, // Alias for backend compatibility\r\n      currency: dbContract.currency || 'USD',\r\n      payment_terms: dbContract.payment_terms,\r\n      delivery_terms: dbContract.delivery_terms,\r\n\r\n      // Dates and Timeline\r\n      start_date: dbContract.start_date,\r\n      end_date: dbContract.end_date,\r\n      signed_date: dbContract.signed_date,\r\n      next_renewal_date: dbContract.next_renewal_date,\r\n\r\n      // Renewal and Terms\r\n      auto_renew: dbContract.auto_renew ?? false,\r\n      renewal_period_months: dbContract.renewal_period_months,\r\n      renewal_terms: dbContract.renewal_terms,\r\n      terms: dbContract.terms,\r\n\r\n      // Approval and Workflow\r\n      approval_stage: dbContract.approval_stage,\r\n      approval_history: (dbContract.approval_history || []).map((record: any) => ({\r\n        id: record.id,\r\n        stage: record.stage,\r\n        approver: record.approver,\r\n        approver_name: record.approver_name,\r\n        status: record.status,\r\n        comments: record.comments,\r\n        timestamp: record.timestamp,\r\n      })),\r\n      compliance_status: (dbContract.compliance_status || 'pending_review') as Contract['compliance_status'],\r\n\r\n      // Assignment and Management\r\n      created_by: dbContract.created_by || '',\r\n      assigned_to: dbContract.assigned_to,\r\n      assigned_to_name: dbContract.assigned_to_name,\r\n\r\n      // Document Management\r\n      content: dbContract.content || '',\r\n      template_id: dbContract.template_id,\r\n      document_path: dbContract.document_path,\r\n      document_url: dbContract.document_url,\r\n      version: dbContract.version || 1,\r\n\r\n      // Organization and Tracking\r\n      tags: dbContract.tags || [],\r\n      priority: (dbContract.priority || 'medium') as Contract['priority'],\r\n      reminder_days: dbContract.reminder_days || [],\r\n      next_reminder_date: dbContract.next_reminder_date,\r\n      notes: dbContract.notes,\r\n\r\n      // Signatures and Attachments\r\n      signature_status: {\r\n        total_required: dbContract.signature_status?.total_required || 0,\r\n        completed: dbContract.signature_status?.completed || 0,\r\n        pending: dbContract.signature_status?.pending || [],\r\n        last_signed_at: dbContract.signature_status?.last_signed_at,\r\n      },\r\n      signed_by_customer: dbContract.signed_by_customer,\r\n      signed_by_company: dbContract.signed_by_company,\r\n      attachments: (dbContract.attachments || []).map((att: any) => ({\r\n        id: att.id,\r\n        name: att.name,\r\n        url: att.url,\r\n        type: att.type,\r\n        size: att.size,\r\n        uploaded_at: att.uploaded_at,\r\n        uploaded_by: att.uploaded_by,\r\n      })),\r\n\r\n      // System Information\r\n      tenant_id: dbContract.tenant_id,\r\n      created_at: dbContract.created_at,\r\n      updated_at: dbContract.updated_at,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseContractService = new SupabaseContractService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\customerService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6720,6723],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6720,6723],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6758,6761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6758,6761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6803,6806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6803,6806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9264,9267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9264,9267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9302,9305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9302,9305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":312,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9347,9350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9347,9350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":673,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":673,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20635,20638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20635,20638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":677,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":677,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20806,20809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20806,20809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":678,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":678,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20858,20861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20858,20861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":679,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":679,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20897,20900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20897,20900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Customer, CustomerTag } from '@/types/crm';\r\nimport { supabaseClient } from './client';\r\nimport { multiTenantService } from './multiTenantService';\r\nimport { \r\n  addTenantFilter, \r\n  handleSupabaseError,\r\n  retryQuery \r\n} from './queryBuilders';\r\n\r\nclass SupabaseCustomerService {\r\n  /**\r\n   * Get all customers with filtering\r\n   */\r\n  async getCustomers(filters?: {\r\n    status?: string;\r\n    industry?: string;\r\n    size?: string;\r\n    assigned_to?: string;\r\n    search?: string;\r\n    tags?: string[];\r\n  }): Promise<Customer[]> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n      const userId = multiTenantService.getCurrentUserId();\r\n\r\n      console.log('[SupabaseCustomerService] getCustomers called with tenantId:', tenantId, 'filters:', filters);\r\n\r\n      let query = supabaseClient\r\n        .from('customers')\r\n        .select(`\r\n          *,\r\n          customer_tag_mapping (\r\n            tag_id,\r\n            customer_tags (\r\n              id,\r\n              name,\r\n              color\r\n            )\r\n          )\r\n        `);\r\n\r\n      // Apply tenant filter\r\n      query = addTenantFilter(query, tenantId);\r\n\r\n      // Apply status filter\r\n      if (filters?.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n\r\n      // Apply industry filter\r\n      if (filters?.industry) {\r\n        query = query.eq('industry', filters.industry);\r\n      }\r\n\r\n      // Apply size filter\r\n      if (filters?.size) {\r\n        query = query.eq('size', filters.size);\r\n      }\r\n\r\n      // Apply assigned_to filter (role-based for agents)\r\n      if (filters?.assigned_to) {\r\n        query = query.eq('assigned_to', filters.assigned_to);\r\n      }\r\n\r\n      // Apply search filter\r\n      if (filters?.search) {\r\n        const searchLower = filters.search.toLowerCase();\r\n        query = query.or(\r\n          `company_name.ilike.%${searchLower}%,contact_name.ilike.%${searchLower}%,email.ilike.%${searchLower}%,city.ilike.%${searchLower}%,country.ilike.%${searchLower}%`\r\n        );\r\n      }\r\n\r\n      console.log('[SupabaseCustomerService] Executing Supabase query...');\r\n      const { data, error } = await retryQuery(async () => query);\r\n\r\n      console.log('[SupabaseCustomerService] Query result - data rows:', data?.length || 0, 'error:', error);\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n\r\n      // Map database rows to Customer interface\r\n      const mappedCustomers = (data || []).map(row => this.mapToCustomer(row));\r\n\r\n      console.log('[SupabaseCustomerService] Mapped customers count:', mappedCustomers.length);\r\n\r\n      // Filter by tags if provided\r\n      if (filters?.tags && filters.tags.length > 0) {\r\n        const filtered = mappedCustomers.filter(customer =>\r\n          filters.tags!.some(tagId => \r\n            customer.tags.some(tag => tag.id === tagId)\r\n          )\r\n        );\r\n        console.log('[SupabaseCustomerService] After tag filter count:', filtered.length);\r\n        return filtered;\r\n      }\r\n\r\n      console.log('[SupabaseCustomerService] Returning customers:', mappedCustomers.length);\r\n      return mappedCustomers;\r\n    } catch (error) {\r\n      console.error('[SupabaseCustomerService] Error fetching customers:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to fetch customers');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get single customer by ID\r\n   */\r\n  async getCustomer(id: string): Promise<Customer> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      const { data, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customers')\r\n          .select(`\r\n            *,\r\n            customer_tag_mapping (\r\n              tag_id,\r\n              customer_tags (\r\n                id,\r\n                name,\r\n                color\r\n              )\r\n            )\r\n          `)\r\n          .eq('id', id)\r\n          .eq('tenant_id', tenantId)\r\n          .single()\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n      if (!data) throw new Error('Customer not found');\r\n\r\n      return this.mapToCustomer(data);\r\n    } catch (error) {\r\n      console.error('Error fetching customer:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to fetch customer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new customer\r\n   */\r\n  async createCustomer(\r\n    customerData: Omit<Customer, 'id' | 'tenant_id' | 'created_at' | 'updated_at'>\r\n  ): Promise<Customer> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n      const userId = multiTenantService.getCurrentUserId();\r\n\r\n      const insertData = {\r\n        company_name: customerData.company_name,\r\n        contact_name: customerData.contact_name,\r\n        email: customerData.email,\r\n        phone: customerData.phone,\r\n        address: customerData.address,\r\n        city: customerData.city,\r\n        country: customerData.country,\r\n        industry: customerData.industry,\r\n        size: customerData.size,\r\n        status: customerData.status,\r\n        notes: customerData.notes,\r\n        assigned_to: customerData.assigned_to || userId,\r\n        tenant_id: tenantId,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      const { data, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customers')\r\n          .insert([insertData])\r\n          .select(`\r\n            *,\r\n            customer_tag_mapping (\r\n              tag_id,\r\n              customer_tags (\r\n                id,\r\n                name,\r\n                color\r\n              )\r\n            )\r\n          `)\r\n          .single()\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n      if (!data) throw new Error('Failed to create customer');\r\n\r\n      return this.mapToCustomer(data);\r\n    } catch (error) {\r\n      console.error('Error creating customer:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to create customer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update existing customer\r\n   */\r\n  async updateCustomer(id: string, updates: Partial<Customer>): Promise<Customer> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      // Validate ownership\r\n      const { data: existing, error: fetchError } = await supabaseClient\r\n        .from('customers')\r\n        .select('id')\r\n        .eq('id', id)\r\n        .eq('tenant_id', tenantId)\r\n        .single();\r\n\r\n      if (fetchError || !existing) throw new Error('Customer not found');\r\n\r\n      const updateData = {\r\n        ...updates,\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      // Remove fields that shouldn't be updated\r\n      delete (updateData as any).id;\r\n      delete (updateData as any).tenant_id;\r\n      delete (updateData as any).created_at;\r\n\r\n      const { data, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customers')\r\n          .update(updateData)\r\n          .eq('id', id)\r\n          .eq('tenant_id', tenantId)\r\n          .select(`\r\n            *,\r\n            customer_tag_mapping (\r\n              tag_id,\r\n              customer_tags (\r\n                id,\r\n                name,\r\n                color\r\n              )\r\n            )\r\n          `)\r\n          .single()\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n      if (!data) throw new Error('Failed to update customer');\r\n\r\n      return this.mapToCustomer(data);\r\n    } catch (error) {\r\n      console.error('Error updating customer:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to update customer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete customer\r\n   */\r\n  async deleteCustomer(id: string): Promise<void> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      const { error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customers')\r\n          .delete()\r\n          .eq('id', id)\r\n          .eq('tenant_id', tenantId)\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n    } catch (error) {\r\n      console.error('Error deleting customer:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to delete customer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bulk delete customers\r\n   */\r\n  async bulkDeleteCustomers(ids: string[]): Promise<void> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      const { error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customers')\r\n          .delete()\r\n          .eq('tenant_id', tenantId)\r\n          .in('id', ids)\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n    } catch (error) {\r\n      console.error('Error bulk deleting customers:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to delete customers');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bulk update customers\r\n   */\r\n  async bulkUpdateCustomers(ids: string[], updates: Partial<Customer>): Promise<void> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      const updateData = {\r\n        ...updates,\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      // Remove fields that shouldn't be updated\r\n      delete (updateData as any).id;\r\n      delete (updateData as any).tenant_id;\r\n      delete (updateData as any).created_at;\r\n\r\n      const { error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customers')\r\n          .update(updateData)\r\n          .eq('tenant_id', tenantId)\r\n          .in('id', ids)\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n    } catch (error) {\r\n      console.error('Error bulk updating customers:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to update customers');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all customer tags\r\n   */\r\n  async getTags(): Promise<CustomerTag[]> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      const { data, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customer_tags')\r\n          .select('*')\r\n          .eq('tenant_id', tenantId)\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n\r\n      return (data || []).map(row => ({\r\n        id: row.id,\r\n        name: row.name,\r\n        color: row.color\r\n      }));\r\n    } catch (error) {\r\n      console.error('Error fetching tags:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to fetch tags');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new customer tag\r\n   */\r\n  async createTag(name: string, color: string): Promise<CustomerTag> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      const { data, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customer_tags')\r\n          .insert([\r\n            {\r\n              name,\r\n              color,\r\n              tenant_id: tenantId,\r\n              created_at: new Date().toISOString()\r\n            }\r\n          ])\r\n          .select()\r\n          .single()\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n      if (!data) throw new Error('Failed to create tag');\r\n\r\n      return {\r\n        id: data.id,\r\n        name: data.name,\r\n        color: data.color\r\n      };\r\n    } catch (error) {\r\n      console.error('Error creating tag:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to create tag');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a tag to a customer\r\n   */\r\n  async addTagToCustomer(customerId: string, tagId: string): Promise<void> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      // Verify customer exists and belongs to tenant\r\n      const { data: customer, error: customerError } = await supabaseClient\r\n        .from('customers')\r\n        .select('id')\r\n        .eq('id', customerId)\r\n        .eq('tenant_id', tenantId)\r\n        .single();\r\n\r\n      if (customerError || !customer) throw new Error('Customer not found');\r\n\r\n      // Insert tag mapping\r\n      const { error } = await supabaseClient\r\n        .from('customer_tag_mapping')\r\n        .insert([{ customer_id: customerId, tag_id: tagId }]);\r\n\r\n      // Ignore duplicate key errors (tag already linked)\r\n      if (error && !error.message.includes('duplicate')) {\r\n        throw handleSupabaseError(error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error adding tag to customer:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to add tag');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a tag from a customer\r\n   */\r\n  async removeTagFromCustomer(customerId: string, tagId: string): Promise<void> {\r\n    try {\r\n      const { error } = await supabaseClient\r\n        .from('customer_tag_mapping')\r\n        .delete()\r\n        .eq('customer_id', customerId)\r\n        .eq('tag_id', tagId);\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n    } catch (error) {\r\n      console.error('Error removing tag from customer:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to remove tag');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set tags for a customer (replaces all existing tags)\r\n   */\r\n  async setCustomerTags(customerId: string, tagIds: string[]): Promise<void> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      // Verify customer exists and belongs to tenant\r\n      const { data: customer, error: customerError } = await supabaseClient\r\n        .from('customers')\r\n        .select('id')\r\n        .eq('id', customerId)\r\n        .eq('tenant_id', tenantId)\r\n        .single();\r\n\r\n      if (customerError || !customer) throw new Error('Customer not found');\r\n\r\n      // Delete existing tag mappings\r\n      const { error: deleteError } = await supabaseClient\r\n        .from('customer_tag_mapping')\r\n        .delete()\r\n        .eq('customer_id', customerId);\r\n\r\n      if (deleteError) throw handleSupabaseError(deleteError);\r\n\r\n      // Insert new tag mappings\r\n      if (tagIds.length > 0) {\r\n        const mappings = tagIds.map(tagId => ({\r\n          customer_id: customerId,\r\n          tag_id: tagId\r\n        }));\r\n\r\n        const { error: insertError } = await supabaseClient\r\n          .from('customer_tag_mapping')\r\n          .insert(mappings);\r\n\r\n        if (insertError) throw handleSupabaseError(insertError);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error setting customer tags:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to set tags');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export customers as CSV or JSON\r\n   */\r\n  async exportCustomers(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    try {\r\n      const customers = await this.getCustomers();\r\n\r\n      if (format === 'csv') {\r\n        const headers = [\r\n          'Company Name', 'Contact Name', 'Email', 'Phone', 'Address',\r\n          'City', 'Country', 'Industry', 'Size', 'Status', 'Tags', 'Notes', 'Created At'\r\n        ];\r\n\r\n        const csvData = customers.map(c => [\r\n          c.company_name,\r\n          c.contact_name,\r\n          c.email,\r\n          c.phone,\r\n          c.address,\r\n          c.city,\r\n          c.country,\r\n          c.industry,\r\n          c.size,\r\n          c.status,\r\n          c.tags.map(t => t.name).join('; '),\r\n          c.notes || '',\r\n          new Date(c.created_at).toLocaleDateString()\r\n        ]);\r\n\r\n        return [headers, ...csvData].map(row =>\r\n          row.map(field => `\"${field}\"`).join(',')\r\n        ).join('\\r\\n');\r\n      } else {\r\n        return JSON.stringify(customers, null, 2);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error exporting customers:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to export customers');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Import customers from CSV\r\n   */\r\n  async importCustomers(csvData: string): Promise<{ success: number; errors: string[] }> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n      const userId = multiTenantService.getCurrentUserId();\r\n\r\n      const lines = csvData.split('\\r\\n').filter(line => line.trim());\r\n      const headers = lines[0].split(',').map(h => h.replace(/\"/g, '').trim());\r\n      const dataLines = lines.slice(1);\r\n\r\n      let success = 0;\r\n      const errors: string[] = [];\r\n\r\n      for (let i = 0; i < dataLines.length; i++) {\r\n        try {\r\n          const values = dataLines[i].split(',').map(v => v.replace(/\"/g, '').trim());\r\n\r\n          if (values.length !== headers.length) {\r\n            errors.push(`Row ${i + 2}: Invalid number of columns`);\r\n            continue;\r\n          }\r\n\r\n          // Extract values\r\n          const email = values[headers.indexOf('Email')] || values[2];\r\n          if (!email || !email.includes('@')) {\r\n            errors.push(`Row ${i + 2}: Invalid email address`);\r\n            continue;\r\n          }\r\n\r\n          const customerData = {\r\n            company_name: values[headers.indexOf('Company Name')] || values[0],\r\n            contact_name: values[headers.indexOf('Contact Name')] || values[1],\r\n            email,\r\n            phone: values[headers.indexOf('Phone')] || values[3],\r\n            address: values[headers.indexOf('Address')] || values[4],\r\n            city: values[headers.indexOf('City')] || values[5],\r\n            country: values[headers.indexOf('Country')] || values[6],\r\n            industry: values[headers.indexOf('Industry')] || values[7],\r\n            size: values[headers.indexOf('Size')] || 'small',\r\n            status: 'active',\r\n            tenant_id: tenantId,\r\n            assigned_to: userId,\r\n            notes: values[headers.indexOf('Notes')] || '',\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString()\r\n          };\r\n\r\n          const { error } = await supabase\r\n            .from('customers')\r\n            .insert([customerData]);\r\n\r\n          if (error) throw error;\r\n          success++;\r\n        } catch (error) {\r\n          errors.push(`Row ${i + 2}: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n        }\r\n      }\r\n\r\n      return { success, errors };\r\n    } catch (error) {\r\n      console.error('Error importing customers:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to import customers');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get list of industries\r\n   */\r\n  async getIndustries(): Promise<string[]> {\r\n    return [\r\n      'Technology',\r\n      'Manufacturing',\r\n      'Software',\r\n      'Retail',\r\n      'Healthcare',\r\n      'Finance',\r\n      'Education',\r\n      'Other'\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Get list of company sizes\r\n   */\r\n  async getSizes(): Promise<string[]> {\r\n    return ['startup', 'small', 'medium', 'enterprise'];\r\n  }\r\n\r\n  /**\r\n   * Get customer statistics\r\n   */\r\n  async getCustomerStats(): Promise<{\r\n    totalCustomers: number;\r\n    activeCustomers: number;\r\n    prospectCustomers: number;\r\n    inactiveCustomers: number;\r\n    byIndustry: Record<string, number>;\r\n    bySize: Record<string, number>;\r\n    byStatus: Record<string, number>;\r\n  }> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      // Fetch all customers for the tenant\r\n      const { data, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('customers')\r\n          .select('id, status, industry, size')\r\n          .eq('tenant_id', tenantId)\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n\r\n      const customers = data || [];\r\n\r\n      // Calculate statistics\r\n      const byStatus: Record<string, number> = {};\r\n      const byIndustry: Record<string, number> = {};\r\n      const bySize: Record<string, number> = {};\r\n\r\n      customers.forEach(customer => {\r\n        byStatus[customer.status] = (byStatus[customer.status] || 0) + 1;\r\n        byIndustry[customer.industry] = (byIndustry[customer.industry] || 0) + 1;\r\n        bySize[customer.size] = (bySize[customer.size] || 0) + 1;\r\n      });\r\n\r\n      return {\r\n        totalCustomers: customers.length,\r\n        activeCustomers: customers.filter(c => c.status === 'active').length,\r\n        prospectCustomers: customers.filter(c => c.status === 'prospect').length,\r\n        inactiveCustomers: customers.filter(c => c.status === 'inactive').length,\r\n        byIndustry,\r\n        bySize,\r\n        byStatus\r\n      };\r\n    } catch (error) {\r\n      console.error('[SupabaseCustomerService] Error fetching customer stats:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to fetch customer statistics');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Map database row to Customer interface\r\n   */\r\n  private mapToCustomer(row: any): Customer {\r\n    // Extract tags from the junction table\r\n    const tagMappings = row.customer_tag_mapping || [];\r\n    const tags = tagMappings\r\n      .map((mapping: any) => mapping.customer_tags)\r\n      .filter((tag: any) => tag != null)\r\n      .map((tag: any) => ({\r\n        id: tag.id,\r\n        name: tag.name,\r\n        color: tag.color\r\n      }));\r\n\r\n    return {\r\n      id: row.id,\r\n      company_name: row.company_name,\r\n      contact_name: row.contact_name,\r\n      email: row.email,\r\n      phone: row.phone,\r\n      address: row.address,\r\n      city: row.city,\r\n      country: row.country,\r\n      industry: row.industry,\r\n      size: row.size,\r\n      status: row.status,\r\n      tags,\r\n      notes: row.notes,\r\n      tenant_id: row.tenant_id,\r\n      created_at: row.created_at,\r\n      updated_at: row.updated_at,\r\n      assigned_to: row.assigned_to\r\n    };\r\n  }\r\n}\r\n\r\nexport { SupabaseCustomerService };\r\nexport const supabaseCustomerService = new SupabaseCustomerService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\jobWorkService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":321,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10374,10377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10374,10377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Job Work Service\r\n * Handles job work management - engineering/service job assignments\r\n * Integrates with tenant context for multi-tenant support\r\n */\r\n\r\nimport { BaseSupabaseService } from './baseService';\r\nimport { getSupabaseClient } from './client';\r\nimport { JobWork, JobWorkFilters, JobWorkStats, JobWorkFormData, JobWorkUpdateData } from '@/types/jobWork';\r\nimport { multiTenantService } from './multiTenantService';\r\n\r\nexport class SupabaseJobWorkService extends BaseSupabaseService {\r\n  constructor() {\r\n    super('job_works', true);\r\n  }\r\n\r\n  /**\r\n   * Get all job works with optional filtering and tenant context\r\n   */\r\n  async getJobWorks(filters?: JobWorkFilters): Promise<JobWork[]> {\r\n    try {\r\n      this.log('Fetching job works', filters);\r\n\r\n      const tenant = multiTenantService.getCurrentTenant();\r\n      if (!tenant?.tenantId) {\r\n        this.logError('No tenant context available');\r\n        throw new Error('Unauthorized');\r\n      }\r\n\r\n      let query = getSupabaseClient()\r\n        .from('job_works')\r\n        .select('*')\r\n        .eq('tenant_id', tenant.tenantId)\r\n        .is('deleted_at', null);\r\n\r\n      // Apply role-based filtering\r\n      if (tenant?.role === 'engineer') {\r\n        query = query.eq('receiver_engineer_id', tenant.userId);\r\n      }\r\n\r\n      // Apply filters\r\n      if (filters?.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n      if (filters?.customer_id) {\r\n        query = query.eq('customer_id', filters.customer_id);\r\n      }\r\n      if (filters?.product_id) {\r\n        query = query.eq('product_id', filters.product_id);\r\n      }\r\n      if (filters?.receiver_engineer) {\r\n        query = query.eq('receiver_engineer_id', filters.receiver_engineer);\r\n      }\r\n      if (filters?.search) {\r\n        const search = `%${filters.search}%`;\r\n        query = query.or(\r\n          `job_ref_id.ilike.${search},customer_name.ilike.${search},product_name.ilike.${search},comments.ilike.${search}`\r\n        );\r\n      }\r\n      if (filters?.date_from) {\r\n        query = query.gte('created_at', filters.date_from);\r\n      }\r\n      if (filters?.date_to) {\r\n        query = query.lte('created_at', filters.date_to);\r\n      }\r\n\r\n      const { data, error } = await query.order('created_at', {\r\n        ascending: false,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Job works fetched', { count: data?.length });\r\n      return (data || []).map(jw => this.mapJobWorkResponse(jw));\r\n    } catch (error) {\r\n      this.logError('Error fetching job works', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get single job work by ID with tenant context\r\n   */\r\n  async getJobWork(id: string): Promise<JobWork> {\r\n    try {\r\n      this.log('Fetching job work', { id });\r\n\r\n      const tenant = multiTenantService.getCurrentTenant();\r\n      if (!tenant?.tenantId) {\r\n        throw new Error('Unauthorized');\r\n      }\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('job_works')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .eq('tenant_id', tenant.tenantId)\r\n        .is('deleted_at', null)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n      if (!data) throw new Error('Job work not found');\r\n\r\n      // Check permissions for engineers\r\n      if (tenant?.role === 'engineer' && data.receiver_engineer_id !== tenant.userId) {\r\n        throw new Error('Access denied');\r\n      }\r\n\r\n      return this.mapJobWorkResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error fetching job work', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new job work with tenant context\r\n   */\r\n  async createJobWork(jobWorkData: JobWorkFormData): Promise<JobWork> {\r\n    try {\r\n      this.log('Creating job work', jobWorkData);\r\n\r\n      const tenant = multiTenantService.getCurrentTenant();\r\n      if (!tenant?.tenantId) {\r\n        throw new Error('Unauthorized');\r\n      }\r\n\r\n      // Generate unique job_ref_id (in production, this would use a sequence or trigger)\r\n      const now = new Date();\r\n      const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');\r\n      const randomPart = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n      const job_ref_id = `JW-${dateStr}-${randomPart}`;\r\n\r\n      const newJobWork = {\r\n        job_ref_id,\r\n        customer_id: jobWorkData.customer_id,\r\n        product_id: jobWorkData.product_id,\r\n        pieces: jobWorkData.pieces,\r\n        size: jobWorkData.size,\r\n        default_price: jobWorkData.default_price || 0,\r\n        manual_price: jobWorkData.manual_price,\r\n        final_price: jobWorkData.final_price || 0,\r\n        receiver_engineer_id: jobWorkData.receiver_engineer_id,\r\n        comments: jobWorkData.comments,\r\n        status: 'pending',\r\n        tenant_id: tenant.tenantId,\r\n        created_by: tenant.userId,\r\n      };\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('job_works')\r\n        .insert([newJobWork])\r\n        .select('*')\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Job work created', { id: data?.id });\r\n      return this.mapJobWorkResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error creating job work', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update job work with tenant context\r\n   */\r\n  async updateJobWork(id: string, updates: JobWorkUpdateData): Promise<JobWork> {\r\n    try {\r\n      this.log('Updating job work', { id, updates });\r\n\r\n      const tenant = multiTenantService.getCurrentTenant();\r\n      if (!tenant?.tenantId) {\r\n        throw new Error('Unauthorized');\r\n      }\r\n\r\n      // Get current job work to check permissions\r\n      const { data: currentJobWork, error: fetchError } = await getSupabaseClient()\r\n        .from('job_works')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .eq('tenant_id', tenant.tenantId)\r\n        .is('deleted_at', null)\r\n        .single();\r\n\r\n      if (fetchError) throw fetchError;\r\n      if (!currentJobWork) throw new Error('Job work not found');\r\n\r\n      // Check permissions for engineers\r\n      if (tenant?.role === 'engineer' && currentJobWork.receiver_engineer_id !== tenant.userId) {\r\n        throw new Error('Access denied');\r\n      }\r\n\r\n      // Auto-set completion/delivery timestamps\r\n      const updateData = { ...updates };\r\n      if (updates.status === 'completed' && currentJobWork.status !== 'completed') {\r\n        updateData.completed_at = new Date().toISOString();\r\n      }\r\n      if (updates.status === 'delivered' && currentJobWork.status !== 'delivered') {\r\n        updateData.delivered_at = new Date().toISOString();\r\n      }\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('job_works')\r\n        .update(updateData)\r\n        .eq('id', id)\r\n        .eq('tenant_id', tenant.tenantId)\r\n        .select('*')\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Job work updated', { id });\r\n      return this.mapJobWorkResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error updating job work', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete job work with soft delete (tenant context)\r\n   */\r\n  async deleteJobWork(id: string): Promise<void> {\r\n    try {\r\n      this.log('Deleting job work', { id });\r\n\r\n      const tenant = multiTenantService.getCurrentTenant();\r\n      if (!tenant?.tenantId) {\r\n        throw new Error('Unauthorized');\r\n      }\r\n\r\n      // Get current job work to check permissions\r\n      const { data: currentJobWork, error: fetchError } = await getSupabaseClient()\r\n        .from('job_works')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .eq('tenant_id', tenant.tenantId)\r\n        .is('deleted_at', null)\r\n        .single();\r\n\r\n      if (fetchError) throw fetchError;\r\n      if (!currentJobWork) throw new Error('Job work not found');\r\n\r\n      // Check permissions for engineers\r\n      if (tenant?.role === 'engineer' && currentJobWork.receiver_engineer_id !== tenant.userId) {\r\n        throw new Error('Access denied');\r\n      }\r\n\r\n      // Soft delete\r\n      const { error } = await getSupabaseClient()\r\n        .from('job_works')\r\n        .update({ deleted_at: new Date().toISOString() })\r\n        .eq('id', id)\r\n        .eq('tenant_id', tenant.tenantId);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Job work deleted', { id });\r\n    } catch (error) {\r\n      this.logError('Error deleting job work', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get job work statistics with tenant context\r\n   */\r\n  async getJobWorkStats(): Promise<JobWorkStats> {\r\n    try {\r\n      this.log('Fetching job work statistics');\r\n\r\n      const tenant = multiTenantService.getCurrentTenant();\r\n      if (!tenant?.tenantId) {\r\n        throw new Error('Unauthorized');\r\n      }\r\n\r\n      let query = getSupabaseClient()\r\n        .from('job_works')\r\n        .select('*')\r\n        .eq('tenant_id', tenant.tenantId)\r\n        .is('deleted_at', null);\r\n\r\n      // Apply role-based filtering\r\n      if (tenant?.role === 'engineer') {\r\n        query = query.eq('receiver_engineer_id', tenant.userId);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      const jobWorks = data || [];\r\n      const stats: JobWorkStats = {\r\n        total: jobWorks.length,\r\n        pending: jobWorks.filter(jw => jw.status === 'pending').length,\r\n        in_progress: jobWorks.filter(jw => jw.status === 'in_progress').length,\r\n        completed: jobWorks.filter(jw => jw.status === 'completed').length,\r\n        delivered: jobWorks.filter(jw => jw.status === 'delivered').length,\r\n        total_value: jobWorks.reduce((sum, jw) => sum + (parseFloat(jw.final_price) || 0), 0),\r\n        avg_pieces_per_job: jobWorks.length > 0 \r\n          ? Math.round(jobWorks.reduce((sum, jw) => sum + (parseFloat(jw.pieces) || 0), 0) / jobWorks.length) \r\n          : 0,\r\n        avg_job_value: jobWorks.length > 0 \r\n          ? Math.round(jobWorks.reduce((sum, jw) => sum + (parseFloat(jw.final_price) || 0), 0) / jobWorks.length) \r\n          : 0\r\n      };\r\n\r\n      this.log('Job work statistics calculated', stats);\r\n      return stats;\r\n    } catch (error) {\r\n      this.logError('Error fetching job work statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Map Supabase response to JobWork type\r\n   */\r\n  private mapJobWorkResponse(data: any): JobWork {\r\n    return {\r\n      id: data.id,\r\n      job_ref_id: data.job_ref_id,\r\n      customer_id: data.customer_id,\r\n      customer_name: data.customer_name,\r\n      customer_short_name: data.customer_short_name,\r\n      product_id: data.product_id,\r\n      product_name: data.product_name,\r\n      pieces: parseFloat(data.pieces),\r\n      size: data.size,\r\n      default_price: parseFloat(data.default_price),\r\n      manual_price: data.manual_price ? parseFloat(data.manual_price) : undefined,\r\n      final_price: parseFloat(data.final_price),\r\n      receiver_engineer_id: data.receiver_engineer_id,\r\n      receiver_engineer_name: data.receiver_engineer_name,\r\n      comments: data.comments,\r\n      status: data.status,\r\n      tenant_id: data.tenant_id,\r\n      created_at: data.created_at,\r\n      updated_at: data.updated_at,\r\n      completed_at: data.completed_at,\r\n      delivered_at: data.delivered_at,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseJobWorkService = new SupabaseJobWorkService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\multiTenantService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4573,4576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4573,4576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Multi-Tenant Service\r\n * Manages tenant context and data isolation\r\n */\r\n\r\nimport { supabaseClient } from './client';\r\n\r\ninterface TenantContext {\r\n  tenantId: string;\r\n  tenantName?: string;\r\n  userId: string;\r\n  role?: string;\r\n}\r\n\r\nclass MultiTenantService {\r\n  private currentTenant: TenantContext | null = null;\r\n  private tenantListeners: Set<(tenant: TenantContext | null) => void> = new Set();\r\n\r\n  /**\r\n   * Initialize tenant context from session\r\n   */\r\n  async initializeTenantContext(userId: string): Promise<TenantContext | null> {\r\n    try {\r\n      // Get user's basic info (avoid relationship queries due to RLS)\r\n      const { data: user, error: userError } = await supabaseClient\r\n        .from('users')\r\n        .select('id, role, tenant_id')\r\n        .eq('id', userId)\r\n        .single();\r\n\r\n      if (userError && userError.code !== 'PGRST116') { // PGRST116 = no rows found\r\n        throw userError;\r\n      }\r\n\r\n      if (!user) {\r\n        console.warn('User not found');\r\n        return null;\r\n      }\r\n\r\n      // Fetch tenant info separately\r\n      let tenantName: string | undefined;\r\n      try {\r\n        const { data: tenant } = await supabaseClient\r\n          .from('tenants')\r\n          .select('id, name')\r\n          .eq('id', user.tenant_id)\r\n          .single();\r\n        \r\n        tenantName = tenant?.name;\r\n      } catch (tenantError) {\r\n        console.warn('Could not fetch tenant details:', tenantError);\r\n      }\r\n\r\n      const tenantContext: TenantContext = {\r\n        tenantId: user.tenant_id,\r\n        tenantName,\r\n        userId,\r\n        role: user.role,\r\n      };\r\n\r\n      this.setCurrentTenant(tenantContext);\r\n      return tenantContext;\r\n    } catch (error) {\r\n      console.error('Error initializing tenant context:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set current tenant context\r\n   */\r\n  setCurrentTenant(tenant: TenantContext | null): void {\r\n    this.currentTenant = tenant;\r\n    this.notifyListeners();\r\n  }\r\n\r\n  /**\r\n   * Get current tenant ID (enforces tenant isolation for admins)\r\n   */\r\n  getCurrentTenantId(): string {\r\n    if (!this.currentTenant) {\r\n      throw new Error('Tenant context not initialized');\r\n    }\r\n    \r\n    // Ensure admin can only access their own tenant\r\n    this.enforceAdminTenantIsolation();\r\n    \r\n    return this.currentTenant.tenantId;\r\n  }\r\n\r\n  /**\r\n   * Enforce tenant isolation for admin users\r\n   * Admins should only see data from their own tenant, not all tenants\r\n   */\r\n  private enforceAdminTenantIsolation(): void {\r\n    if (!this.currentTenant) return;\r\n\r\n    // Get tenant ID from localStorage (set during login)\r\n    try {\r\n      const storedTenantId = localStorage.getItem('sb_tenant_id');\r\n      const currentTenantId = this.currentTenant.tenantId;\r\n\r\n      // If tenant IDs don't match, something is wrong - clear tenant context\r\n      if (storedTenantId && storedTenantId !== currentTenantId) {\r\n        console.warn(\r\n          `[SECURITY] Tenant mismatch detected: stored=${storedTenantId}, current=${currentTenantId}. Enforcing isolation.`\r\n        );\r\n        // Keep the stored tenant ID (which came from user's record)\r\n        this.currentTenant.tenantId = storedTenantId;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error enforcing tenant isolation:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current tenant (enforces tenant isolation for admins)\r\n   */\r\n  getCurrentTenant(): TenantContext | null {\r\n    if (this.currentTenant) {\r\n      this.enforceAdminTenantIsolation();\r\n    }\r\n    return this.currentTenant;\r\n  }\r\n\r\n  /**\r\n   * Get current user ID\r\n   */\r\n  getCurrentUserId(): string {\r\n    if (!this.currentTenant) {\r\n      throw new Error('Tenant context not initialized');\r\n    }\r\n    return this.currentTenant.userId;\r\n  }\r\n\r\n  /**\r\n   * Check if user has specific role\r\n   */\r\n  hasRole(requiredRole: string): boolean {\r\n    if (!this.currentTenant) {\r\n      return false;\r\n    }\r\n    return this.currentTenant.role === requiredRole;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to tenant changes\r\n   */\r\n  subscribe(callback: (tenant: TenantContext | null) => void): () => void {\r\n    this.tenantListeners.add(callback);\r\n    \r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.tenantListeners.delete(callback);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Notify all listeners of tenant change\r\n   */\r\n  private notifyListeners(): void {\r\n    this.tenantListeners.forEach(callback => {\r\n      callback(this.currentTenant);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get all tenants for current user\r\n   */\r\n  async getUserTenants(): Promise<any[]> {\r\n    try {\r\n      const currentUserId = this.getCurrentUserId();\r\n      \r\n      // Get user's tenant_id\r\n      const { data: user, error: userError } = await supabaseClient\r\n        .from('users')\r\n        .select('tenant_id')\r\n        .eq('id', currentUserId)\r\n        .single();\r\n\r\n      if (userError) throw userError;\r\n      if (!user?.tenant_id) return [];\r\n\r\n      // Fetch tenant details\r\n      const { data: tenant, error: tenantError } = await supabaseClient\r\n        .from('tenants')\r\n        .select('id, name, created_at')\r\n        .eq('id', user.tenant_id)\r\n        .single();\r\n\r\n      if (tenantError) throw tenantError;\r\n      return tenant ? [tenant] : [];\r\n    } catch (error) {\r\n      console.error('Error fetching user tenants:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Switch to different tenant\r\n   */\r\n  async switchTenant(tenantId: string): Promise<boolean> {\r\n    try {\r\n      // Verify user has access to this tenant\r\n      const currentUserId = this.currentTenant?.userId;\r\n      if (!currentUserId) {\r\n        console.warn('No current user context');\r\n        return false;\r\n      }\r\n\r\n      // Verify user has access to this tenant (basic check)\r\n      const { data: user, error } = await supabaseClient\r\n        .from('users')\r\n        .select('id, role, tenant_id')\r\n        .eq('id', currentUserId)\r\n        .eq('tenant_id', tenantId)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') {\r\n        throw error;\r\n      }\r\n\r\n      if (!user) {\r\n        console.warn('User does not have access to this tenant');\r\n        return false;\r\n      }\r\n\r\n      // Fetch tenant info separately\r\n      let tenantName: string | undefined;\r\n      try {\r\n        const { data: tenant } = await supabaseClient\r\n          .from('tenants')\r\n          .select('id, name')\r\n          .eq('id', tenantId)\r\n          .single();\r\n        \r\n        tenantName = tenant?.name;\r\n      } catch (tenantError) {\r\n        console.warn('Could not fetch tenant details:', tenantError);\r\n      }\r\n\r\n      const tenantContext: TenantContext = {\r\n        tenantId: user.tenant_id,\r\n        tenantName,\r\n        userId: currentUserId,\r\n        role: user.role,\r\n      };\r\n\r\n      this.setCurrentTenant(tenantContext);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error switching tenant:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear tenant context (on logout)\r\n   */\r\n  clearTenantContext(): void {\r\n    this.setCurrentTenant(null);\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const multiTenantService = new MultiTenantService();\r\n\r\n// Export type\r\nexport type { TenantContext };","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\notificationService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[449,452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[449,452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":408,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":408,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11354,11357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11354,11357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":426,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11953,11956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11953,11956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":466,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":466,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13119,13122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13119,13122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":477,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13529,13532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13529,13532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":539,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":539,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15610,15613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15610,15613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":564,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":564,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16362,16365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16362,16365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":581,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":581,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16732,16735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16732,16735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":589,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":589,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16960,16963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16960,16963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Notification Service\r\n * Handles user notifications, preferences, and alerts\r\n * Extends BaseSupabaseService for common database operations\r\n */\r\n\r\nimport { BaseSupabaseService } from './baseService';\r\nimport { getSupabaseClient } from './client';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  user_id: string;\r\n  type: 'info' | 'warning' | 'error' | 'success';\r\n  title: string;\r\n  message: string;\r\n  data?: Record<string, any>;\r\n  read: boolean;\r\n  read_at?: string;\r\n  action_url?: string;\r\n  action_label?: string;\r\n  category?: string;\r\n  is_read?: boolean;\r\n  tenant_id: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface NotificationPreference {\r\n  id: string;\r\n  user_id: string;\r\n  notification_type: string;\r\n  channel: 'email' | 'in_app' | 'sms' | 'push';\r\n  enabled: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface NotificationFilters {\r\n  userId?: string;\r\n  type?: string;\r\n  read?: boolean;\r\n  tenantId?: string;\r\n}\r\n\r\nexport class SupabaseNotificationService extends BaseSupabaseService {\r\n  constructor() {\r\n    super('notifications', true);\r\n  }\r\n\r\n  /**\r\n   * Get notifications for a user\r\n   */\r\n  async getNotifications(filters?: NotificationFilters): Promise<Notification[]> {\r\n    try {\r\n      this.log('Fetching notifications', filters);\r\n\r\n      let query = getSupabaseClient()\r\n        .from('notifications')\r\n        .select('*');\r\n\r\n      // Apply filters\r\n      if (filters?.userId) {\r\n        query = query.eq('user_id', filters.userId);\r\n      }\r\n      if (filters?.type) {\r\n        query = query.eq('type', filters.type);\r\n      }\r\n      if (filters?.tenantId) {\r\n        query = query.eq('tenant_id', filters.tenantId);\r\n      }\r\n      if (filters?.read !== undefined) {\r\n        query = query.eq('read', filters.read);\r\n      }\r\n\r\n      const { data, error } = await query.order('created_at', {\r\n        ascending: false,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Notifications fetched', { count: data?.length });\r\n      return data?.map((n) => this.mapNotificationResponse(n)) || [];\r\n    } catch (error) {\r\n      this.logError('Error fetching notifications', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get unread notifications for a user\r\n   */\r\n  async getUnreadNotifications(userId: string): Promise<Notification[]> {\r\n    try {\r\n      this.log('Fetching unread notifications', { userId });\r\n\r\n      return this.getNotifications({\r\n        userId,\r\n        read: false,\r\n      });\r\n    } catch (error) {\r\n      this.logError('Error fetching unread notifications', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get notification by ID\r\n   */\r\n  async getNotification(id: string): Promise<Notification | null> {\r\n    try {\r\n      this.log('Fetching notification', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('notifications')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data ? this.mapNotificationResponse(data) : null;\r\n    } catch (error) {\r\n      this.logError('Error fetching notification', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create notification\r\n   */\r\n  async createNotification(data: Partial<Notification>): Promise<Notification> {\r\n    try {\r\n      this.log('Creating notification', { user_id: data.user_id });\r\n\r\n      const { data: created, error } = await getSupabaseClient()\r\n        .from('notifications')\r\n        .insert([\r\n          {\r\n            user_id: data.user_id,\r\n            recipient_id: data.user_id, // Ensure both are set for backward compatibility\r\n            type: data.type || 'info',\r\n            title: data.title,\r\n            message: data.message,\r\n            data: data.data,\r\n            is_read: false, // Use is_read only - primary field for read status\r\n            action_url: data.action_url,\r\n            action_label: data.action_label,\r\n            category: data.category,\r\n            tenant_id: data.tenant_id,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Notification created successfully', { id: created.id });\r\n      return this.mapNotificationResponse(created);\r\n    } catch (error) {\r\n      this.logError('Error creating notification', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create multiple notifications\r\n   */\r\n  async createNotifications(notifications: Partial<Notification>[]): Promise<Notification[]> {\r\n    try {\r\n      this.log('Creating multiple notifications', { count: notifications.length });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('notifications')\r\n        .insert(\r\n          notifications.map((n) => ({\r\n            user_id: n.user_id,\r\n            recipient_id: n.user_id, // Ensure both are set for backward compatibility\r\n            type: n.type || 'info',\r\n            title: n.title,\r\n            message: n.message,\r\n            data: n.data,\r\n            is_read: false, // Use is_read only - primary field for read status\r\n            action_url: n.action_url,\r\n            action_label: n.action_label,\r\n            category: n.category,\r\n            tenant_id: n.tenant_id,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          }))\r\n        )\r\n        .select();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Notifications created successfully', { count: data?.length });\r\n      return data?.map((n) => this.mapNotificationResponse(n)) || [];\r\n    } catch (error) {\r\n      this.logError('Error creating notifications', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark notification as read\r\n   */\r\n  async markAsRead(id: string): Promise<Notification> {\r\n    try {\r\n      this.log('Marking notification as read', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('notifications')\r\n        .update({\r\n          read: true,\r\n          read_at: new Date().toISOString(),\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Notification marked as read', { id });\r\n      return this.mapNotificationResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error marking notification as read', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark all notifications as read for a user\r\n   */\r\n  async markAllAsRead(userId: string): Promise<number> {\r\n    try {\r\n      this.log('Marking all notifications as read', { userId });\r\n\r\n      const { error, count } = await getSupabaseClient()\r\n        .from('notifications')\r\n        .update({\r\n          read: true,\r\n          read_at: new Date().toISOString(),\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('user_id', userId)\r\n        .eq('read', false);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('All notifications marked as read', { count });\r\n      return count || 0;\r\n    } catch (error) {\r\n      this.logError('Error marking all notifications as read', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete notification\r\n   */\r\n  async deleteNotification(id: string): Promise<void> {\r\n    try {\r\n      this.log('Deleting notification', { id });\r\n\r\n      const { error } = await getSupabaseClient()\r\n        .from('notifications')\r\n        .delete()\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Notification deleted successfully', { id });\r\n    } catch (error) {\r\n      this.logError('Error deleting notification', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all notifications for a user\r\n   */\r\n  async clearAllNotifications(userId: string): Promise<number> {\r\n    try {\r\n      this.log('Clearing all notifications', { userId });\r\n\r\n      const { error, count } = await getSupabaseClient()\r\n        .from('notifications')\r\n        .delete()\r\n        .eq('user_id', userId);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('All notifications cleared', { count });\r\n      return count || 0;\r\n    } catch (error) {\r\n      this.logError('Error clearing all notifications', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get notification preferences for a user\r\n   */\r\n  async getPreferences(userId: string): Promise<NotificationPreference[]> {\r\n    try {\r\n      this.log('Fetching notification preferences', { userId });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('notification_preferences')\r\n        .select('*')\r\n        .eq('user_id', userId);\r\n\r\n      if (error) throw error;\r\n\r\n      return data || [];\r\n    } catch (error) {\r\n      this.logError('Error fetching preferences', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update notification preference\r\n   */\r\n  async updatePreference(\r\n    userId: string,\r\n    type: string,\r\n    channel: 'email' | 'in_app' | 'sms' | 'push',\r\n    enabled: boolean\r\n  ): Promise<NotificationPreference> {\r\n    try {\r\n      this.log('Updating notification preference', { userId, type, channel });\r\n\r\n      // Try to update existing preference\r\n      let result = await getSupabaseClient()\r\n        .from('notification_preferences')\r\n        .update({ enabled, updated_at: new Date().toISOString() })\r\n        .eq('user_id', userId)\r\n        .eq('notification_type', type)\r\n        .eq('channel', channel)\r\n        .select()\r\n        .single();\r\n\r\n      // If no existing preference, create one\r\n      if (!result.data) {\r\n        result = await getSupabaseClient()\r\n          .from('notification_preferences')\r\n          .insert([\r\n            {\r\n              user_id: userId,\r\n              notification_type: type,\r\n              channel,\r\n              enabled,\r\n              created_at: new Date().toISOString(),\r\n              updated_at: new Date().toISOString(),\r\n            },\r\n          ])\r\n          .select()\r\n          .single();\r\n      }\r\n\r\n      if (result.error) throw result.error;\r\n\r\n      this.log('Preference updated successfully');\r\n      return result.data;\r\n    } catch (error) {\r\n      this.logError('Error updating preference', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get notification statistics\r\n   */\r\n  async getStats(userId: string): Promise<{\r\n    total: number;\r\n    unread: number;\r\n    byType: Record<string, number>;\r\n  }> {\r\n    try {\r\n      this.log('Fetching notification statistics', { userId });\r\n\r\n      const notifications = await this.getNotifications({ userId });\r\n\r\n      const stats = {\r\n        total: notifications.length,\r\n        unread: notifications.filter((n) => !n.read).length,\r\n        byType: {} as Record<string, number>,\r\n      };\r\n\r\n      notifications.forEach((n) => {\r\n        stats.byType[n.type] = (stats.byType[n.type] || 0) + 1;\r\n      });\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      this.logError('Error fetching notification statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get aggregated notification preferences for current user\r\n   * Returns preferences in the format expected by NotificationsPage\r\n   */\r\n  async getNotificationPreferences(): Promise<any> {\r\n    try {\r\n      this.log('Fetching aggregated notification preferences');\r\n\r\n      // Get current user from auth context\r\n      const { data: { user }, error: authError } = await getSupabaseClient().auth.getUser();\r\n      if (authError || !user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n\r\n      const preferences = await this.getPreferences(user.id);\r\n\r\n      // Aggregate preferences into the expected format\r\n      const aggregated = {\r\n        email: true,\r\n        sms: false,\r\n        push: true,\r\n        in_app: true,\r\n        categories: {} as Record<string, any>,\r\n      };\r\n\r\n      // Group preferences by notification type\r\n      const typeMap: Record<string, Record<string, boolean>> = {};\r\n\r\n      preferences.forEach((pref) => {\r\n        if (!typeMap[pref.notification_type]) {\r\n          typeMap[pref.notification_type] = {};\r\n        }\r\n        typeMap[pref.notification_type][pref.channel] = pref.enabled;\r\n      });\r\n\r\n      // Build categories from aggregated preferences\r\n      Object.entries(typeMap).forEach(([type, channels]) => {\r\n        aggregated.categories[type] = {\r\n          email: channels.email ?? true,\r\n          sms: channels.sms ?? false,\r\n          push: channels.push ?? true,\r\n          in_app: channels.in_app ?? true,\r\n        };\r\n      });\r\n\r\n      return aggregated;\r\n    } catch (error) {\r\n      this.logError('Error fetching aggregated notification preferences', error);\r\n      // Return defaults on error\r\n      return {\r\n        email: true,\r\n        sms: false,\r\n        push: true,\r\n        in_app: true,\r\n        categories: {},\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update notification preferences for current user\r\n   */\r\n  async updateNotificationPreferences(preferences: Partial<any>): Promise<void> {\r\n    try {\r\n      this.log('Updating notification preferences', preferences);\r\n\r\n      // Get current user from auth context\r\n      const { data: { user }, error: authError } = await getSupabaseClient().auth.getUser();\r\n      if (authError || !user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n\r\n      // Update global preferences\r\n      const updates: Array<Promise<any>> = [];\r\n\r\n      if (preferences.email !== undefined) {\r\n        updates.push(\r\n          this.updatePreference(user.id, 'all', 'email', preferences.email)\r\n        );\r\n      }\r\n      if (preferences.sms !== undefined) {\r\n        updates.push(\r\n          this.updatePreference(user.id, 'all', 'sms', preferences.sms)\r\n        );\r\n      }\r\n      if (preferences.push !== undefined) {\r\n        updates.push(\r\n          this.updatePreference(user.id, 'all', 'push', preferences.push)\r\n        );\r\n      }\r\n      if (preferences.in_app !== undefined) {\r\n        updates.push(\r\n          this.updatePreference(user.id, 'all', 'in_app', preferences.in_app)\r\n        );\r\n      }\r\n\r\n      // Update category preferences\r\n      if (preferences.categories) {\r\n        Object.entries(preferences.categories).forEach(([category, channels]) => {\r\n          const channelsObj = channels as Record<string, boolean>;\r\n          if (channelsObj.email !== undefined) {\r\n            updates.push(\r\n              this.updatePreference(user.id, category, 'email', channelsObj.email)\r\n            );\r\n          }\r\n          if (channelsObj.sms !== undefined) {\r\n            updates.push(\r\n              this.updatePreference(user.id, category, 'sms', channelsObj.sms)\r\n            );\r\n          }\r\n          if (channelsObj.push !== undefined) {\r\n            updates.push(\r\n              this.updatePreference(user.id, category, 'push', channelsObj.push)\r\n            );\r\n          }\r\n          if (channelsObj.in_app !== undefined) {\r\n            updates.push(\r\n              this.updatePreference(user.id, category, 'in_app', channelsObj.in_app)\r\n            );\r\n          }\r\n        });\r\n      }\r\n\r\n      await Promise.all(updates);\r\n      this.log('Notification preferences updated successfully');\r\n    } catch (error) {\r\n      this.logError('Error updating notification preferences', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to notifications for current user\r\n   * Automatically gets user ID from auth context\r\n   */\r\n  subscribeToNotifications(callback: (notification: any) => void): () => void {\r\n    let unsubscribeFn: (() => void) | null = null;\r\n\r\n    // Get current user and subscribe\r\n    getSupabaseClient().auth.getUser().then(({ data: { user } }) => {\r\n      if (user) {\r\n        unsubscribeFn = this.subscribeToChangesForUser(user.id, callback);\r\n      }\r\n    }).catch((error) => {\r\n      this.logError('Error getting current user for notification subscription', error);\r\n    });\r\n\r\n    // Return unsubscribe function that will be set when subscription is ready\r\n    return () => {\r\n      if (unsubscribeFn) {\r\n        unsubscribeFn();\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Subscribe to notifications for a specific user\r\n   */\r\n  private subscribeToChangesForUser(\r\n    userId: string,\r\n    callback: (payload: any) => void\r\n  ): () => void {\r\n    return this.subscribeToChanges(\r\n      {\r\n        event: '*',\r\n        table: 'notifications',\r\n        filter: `user_id=eq.${userId}`,\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to notifications for a user (legacy method)\r\n   */\r\n  subscribeToNotificationsForUser(\r\n    userId: string,\r\n    callback: (payload: any) => void\r\n  ): () => void {\r\n    return this.subscribeToChangesForUser(userId, callback);\r\n  }\r\n\r\n  /**\r\n   * Map database notification response to Notification type\r\n   */\r\n  private mapNotificationResponse(dbNotification: any): Notification {\r\n    // Handle both old schema (is_read, recipient_id) and new schema (read, user_id)\r\n    const read = dbNotification.read !== undefined ? dbNotification.read : (dbNotification.is_read || false);\r\n    const userId = dbNotification.user_id || dbNotification.recipient_id;\r\n    \r\n    return {\r\n      id: dbNotification.id,\r\n      user_id: userId,\r\n      type: (dbNotification.type || 'info') as Notification['type'],\r\n      title: dbNotification.title,\r\n      message: dbNotification.message,\r\n      data: dbNotification.data || {},\r\n      read: read,\r\n      is_read: read,\r\n      read_at: dbNotification.read_at,\r\n      action_url: dbNotification.action_url,\r\n      action_label: dbNotification.action_label,\r\n      category: dbNotification.category || dbNotification.notification_type || 'system',\r\n      tenant_id: dbNotification.tenant_id,\r\n      created_at: dbNotification.created_at,\r\n      updated_at: dbNotification.updated_at,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseNotificationService = new SupabaseNotificationService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\productSaleService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7469,7472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7469,7472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":508,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":508,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16718,16721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16718,16721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { \r\n  ProductSale, \r\n  ProductSaleFormData, \r\n  ProductSaleFilters, \r\n  ProductSalesResponse,\r\n  FileAttachment\r\n} from '@/types/productSales';\r\nimport type { ProductSalesAnalyticsDTO } from '@/types/dtos/productSalesDtos';\r\nimport { supabaseClient } from './client';\r\nimport { multiTenantService } from './multiTenantService';\r\nimport { \r\n  addTenantFilter, \r\n  applyPagination, \r\n  applySorting, \r\n  handleSupabaseError,\r\n  retryQuery \r\n} from './queryBuilders';\r\n\r\nclass SupabaseProductSaleService {\r\n  /**\r\n   * Get all product sales with filtering and pagination\r\n   */\r\n  async getProductSales(\r\n    filters: ProductSaleFilters = {},\r\n    page: number = 1,\r\n    limit: number = 10\r\n  ): Promise<ProductSalesResponse> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n      let query = supabaseClient.from('product_sales').select('*', { count: 'exact' });\r\n\r\n      // Apply tenant filter\r\n      query = addTenantFilter(query, tenantId);\r\n\r\n      // Apply filters\r\n      if (filters.search) {\r\n        const searchLower = filters.search.toLowerCase();\r\n        query = query.or(\r\n          `customer_name.ilike.%${searchLower}%,product_name.ilike.%${searchLower}%,notes.ilike.%${searchLower}%`\r\n        );\r\n      }\r\n\r\n      if (filters.customer_id) {\r\n        query = query.eq('customer_id', filters.customer_id);\r\n      }\r\n\r\n      if (filters.product_id) {\r\n        query = query.eq('product_id', filters.product_id);\r\n      }\r\n\r\n      if (filters.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n\r\n      if (filters.date_from) {\r\n        query = query.gte('delivery_date', filters.date_from);\r\n      }\r\n\r\n      if (filters.date_to) {\r\n        query = query.lte('delivery_date', filters.date_to);\r\n      }\r\n\r\n      if (filters.min_amount) {\r\n        query = query.gte('total_cost', filters.min_amount);\r\n      }\r\n\r\n      if (filters.max_amount) {\r\n        query = query.lte('total_cost', filters.max_amount);\r\n      }\r\n\r\n      if (filters.sale_id) {\r\n        query = query.ilike('id', `%${filters.sale_id}%`);\r\n      }\r\n\r\n      if (filters.customer_name) {\r\n        query = query.ilike('customer_name', `%${filters.customer_name}%`);\r\n      }\r\n\r\n      if (filters.product_name) {\r\n        query = query.ilike('product_name', `%${filters.product_name}%`);\r\n      }\r\n\r\n      if (filters.notes) {\r\n        query = query.ilike('notes', `%${filters.notes}%`);\r\n      }\r\n\r\n      if (filters.warranty_status) {\r\n        const now = new Date().toISOString().split('T')[0];\r\n        const thirtyDaysFromNow = new Date(new Date().getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];\r\n        \r\n        if (filters.warranty_status === 'active') {\r\n          query = query.gt('warranty_expiry', now);\r\n        } else if (filters.warranty_status === 'expiring_soon') {\r\n          query = query.lte('warranty_expiry', thirtyDaysFromNow);\r\n          query = query.gt('warranty_expiry', now);\r\n        } else if (filters.warranty_status === 'expired') {\r\n          query = query.lte('warranty_expiry', now);\r\n        }\r\n      }\r\n\r\n      if (filters.start_date) {\r\n        query = query.gte('delivery_date', filters.start_date);\r\n      }\r\n\r\n      if (filters.end_date) {\r\n        query = query.lte('delivery_date', filters.end_date);\r\n      }\r\n\r\n      if (filters.min_price) {\r\n        query = query.gte('total_cost', filters.min_price);\r\n      }\r\n\r\n      if (filters.max_price) {\r\n        query = query.lte('total_cost', filters.max_price);\r\n      }\r\n\r\n      // Apply pagination and sorting\r\n      query = applyPagination(query, page, limit);\r\n      query = applySorting(query, 'created_at', 'desc');\r\n\r\n      const { data, error, count } = await retryQuery(async () => \r\n        query\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n\r\n      // Map database rows to ProductSale interface\r\n      const mappedData = (data || []).map(row => this.mapToProductSale(row));\r\n\r\n      return {\r\n        data: mappedData,\r\n        total: count || 0,\r\n        page,\r\n        limit,\r\n        totalPages: Math.ceil((count || 0) / limit)\r\n      };\r\n    } catch (error) {\r\n      console.error('Error fetching product sales:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to fetch product sales');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get single product sale by ID\r\n   */\r\n  async getProductSaleById(id: string): Promise<ProductSale> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n      \r\n      const { data, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('product_sales')\r\n          .select('*')\r\n          .eq('id', id)\r\n          .eq('tenant_id', tenantId)\r\n          .single()\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n      if (!data) throw new Error('Product sale not found');\r\n\r\n      return this.mapToProductSale(data);\r\n    } catch (error) {\r\n      console.error('Error fetching product sale:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to fetch product sale');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new product sale\r\n   */\r\n  async createProductSale(data: ProductSaleFormData): Promise<ProductSale> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n      const userId = multiTenantService.getCurrentUserId();\r\n\r\n      // Calculate warranty expiry\r\n      const deliveryDate = new Date(data.delivery_date);\r\n      const warrantyExpiry = new Date(deliveryDate);\r\n      warrantyExpiry.setFullYear(warrantyExpiry.getFullYear() + 1);\r\n\r\n      // Determine status\r\n      const now = new Date();\r\n      let status: 'new' | 'renewed' | 'expired' = 'new';\r\n      if (warrantyExpiry < now) {\r\n        status = 'expired';\r\n      }\r\n\r\n      const insertData = {\r\n        customer_id: data.customer_id,\r\n        product_id: data.product_id,\r\n        units: data.units,\r\n        cost_per_unit: data.cost_per_unit,\r\n        total_cost: data.units * data.cost_per_unit,\r\n        delivery_date: data.delivery_date,\r\n        warranty_expiry: warrantyExpiry.toISOString().split('T')[0],\r\n        status,\r\n        notes: data.notes,\r\n        tenant_id: tenantId,\r\n        created_by: userId,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      const { data: insertedData, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('product_sales')\r\n          .insert([insertData])\r\n          .select()\r\n          .single()\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n      if (!insertedData) throw new Error('Failed to create product sale');\r\n\r\n      return this.mapToProductSale(insertedData);\r\n    } catch (error) {\r\n      console.error('Error creating product sale:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to create product sale');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update existing product sale\r\n   */\r\n  async updateProductSale(id: string, data: Partial<ProductSaleFormData>): Promise<ProductSale> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      // Validate ownership\r\n      const { data: existing, error: fetchError } = await supabaseClient\r\n        .from('product_sales')\r\n        .select('id')\r\n        .eq('id', id)\r\n        .eq('tenant_id', tenantId)\r\n        .single();\r\n\r\n      if (fetchError || !existing) throw new Error('Product sale not found');\r\n\r\n      const updateData: any = {\r\n        ...data,\r\n        updated_at: new Date().toISOString()\r\n      };\r\n\r\n      // Recalculate total cost and warranty if necessary\r\n      if (data.units || data.cost_per_unit) {\r\n        const { data: current } = await supabaseClient\r\n          .from('product_sales')\r\n          .select('units, cost_per_unit')\r\n          .eq('id', id)\r\n          .single();\r\n\r\n        if (current) {\r\n          const units = data.units ?? current.units;\r\n          const costPerUnit = data.cost_per_unit ?? current.cost_per_unit;\r\n          updateData.total_cost = units * costPerUnit;\r\n        }\r\n      }\r\n\r\n      if (data.delivery_date) {\r\n        const deliveryDate = new Date(data.delivery_date);\r\n        const warrantyExpiry = new Date(deliveryDate);\r\n        warrantyExpiry.setFullYear(warrantyExpiry.getFullYear() + 1);\r\n        updateData.warranty_expiry = warrantyExpiry.toISOString().split('T')[0];\r\n\r\n        // Update status based on warranty expiry\r\n        const now = new Date();\r\n        updateData.status = warrantyExpiry < now ? 'expired' : 'new';\r\n      }\r\n\r\n      const { data: updatedData, error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('product_sales')\r\n          .update(updateData)\r\n          .eq('id', id)\r\n          .eq('tenant_id', tenantId)\r\n          .select()\r\n          .single()\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n      if (!updatedData) throw new Error('Failed to update product sale');\r\n\r\n      return this.mapToProductSale(updatedData);\r\n    } catch (error) {\r\n      console.error('Error updating product sale:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to update product sale');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete product sale\r\n   */\r\n  async deleteProductSale(id: string): Promise<void> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n\r\n      const { error } = await retryQuery(async () =>\r\n        supabaseClient\r\n          .from('product_sales')\r\n          .delete()\r\n          .eq('id', id)\r\n          .eq('tenant_id', tenantId)\r\n      );\r\n\r\n      if (error) throw handleSupabaseError(error);\r\n    } catch (error) {\r\n      console.error('Error deleting product sale:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to delete product sale');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get product sales analytics\r\n   */\r\n  async getProductSalesAnalytics(tenantId?: string): Promise<ProductSalesAnalyticsDTO> {\r\n    try {\r\n      const finalTenantId = tenantId || multiTenantService.getCurrentTenantId();\r\n\r\n      // Get all product sales\r\n      const { data: sales, error: salesError } = await supabaseClient\r\n        .from('product_sales')\r\n        .select('*')\r\n        .eq('tenant_id', finalTenantId);\r\n\r\n      if (salesError) throw handleSupabaseError(salesError);\r\n\r\n      const mappedSales = (sales || []).map(s => this.mapToProductSale(s));\r\n\r\n      if (mappedSales.length === 0) {\r\n        return {\r\n          totalSales: 0,\r\n          totalRevenue: 0,\r\n          averageSaleValue: 0,\r\n          completedSales: 0,\r\n          pendingSales: 0,\r\n          totalQuantity: 0,\r\n          revenueByMonth: {},\r\n          topProducts: [],\r\n          topCustomers: [],\r\n          byStatus: [],\r\n          lastUpdated: new Date().toISOString(),\r\n        };\r\n      }\r\n\r\n      const totalSales = mappedSales.length;\r\n      const totalRevenue = mappedSales.reduce((sum, sale) => sum + sale.total_cost, 0);\r\n      const averageDealSize = totalRevenue / totalSales;\r\n\r\n      // Calculate sales by month\r\n      const salesByMonthMap = new Map<string, { count: number; revenue: number }>();\r\n      mappedSales.forEach(sale => {\r\n        const month = sale.delivery_date.substring(0, 7);\r\n        const existing = salesByMonthMap.get(month) || { count: 0, revenue: 0 };\r\n        salesByMonthMap.set(month, {\r\n          count: existing.count + 1,\r\n          revenue: existing.revenue + sale.total_cost\r\n        });\r\n      });\r\n\r\n      const salesByMonthArray = Array.from(salesByMonthMap.entries())\r\n        .sort(([a], [b]) => a.localeCompare(b));\r\n      \r\n      const revenueByMonth = Object.fromEntries(\r\n        salesByMonthArray.map(([month, data]) => [month, data.revenue])\r\n      );\r\n\r\n      // Top products\r\n      const productMap = new Map<string, { count: number; revenue: number; units: number }>();\r\n      mappedSales.forEach(sale => {\r\n        const key = `${sale.product_id}|${sale.product_name}`;\r\n        const existing = productMap.get(key) || { count: 0, revenue: 0, units: 0 };\r\n        productMap.set(key, {\r\n          count: existing.count + 1,\r\n          revenue: existing.revenue + sale.total_cost,\r\n          units: existing.units + sale.units\r\n        });\r\n      });\r\n\r\n      const topProducts = Array.from(productMap.entries())\r\n        .sort((a, b) => b[1].revenue - a[1].revenue)\r\n        .slice(0, 10)\r\n        .map(([key, data]) => {\r\n          const [productId, productName] = key.split('|');\r\n          return {\r\n            productId: productId,\r\n            productName: productName,\r\n            quantity: data.units,\r\n            revenue: data.revenue,\r\n          };\r\n        });\r\n\r\n      // Top customers\r\n      const customerMap = new Map<string, { count: number; revenue: number; lastPurchase: string }>();\r\n      mappedSales.forEach(sale => {\r\n        const key = `${sale.customer_id}|${sale.customer_name}`;\r\n        const existing = customerMap.get(key) || { count: 0, revenue: 0, lastPurchase: '' };\r\n        customerMap.set(key, {\r\n          count: existing.count + 1,\r\n          revenue: existing.revenue + sale.total_cost,\r\n          lastPurchase: sale.delivery_date > existing.lastPurchase ? sale.delivery_date : existing.lastPurchase\r\n        });\r\n      });\r\n\r\n      const topCustomers = Array.from(customerMap.entries())\r\n        .sort((a, b) => b[1].revenue - a[1].revenue)\r\n        .slice(0, 10)\r\n        .map(([key, data]) => {\r\n          const [customerId, customerName] = key.split('|');\r\n          return {\r\n            customerId: customerId,\r\n            customerName: customerName,\r\n            totalSales: data.count,\r\n            revenue: data.revenue,\r\n          };\r\n        });\r\n\r\n      // Status distribution\r\n      const statusCounts = mappedSales.reduce((acc, sale) => {\r\n        acc[sale.status] = (acc[sale.status] || 0) + 1;\r\n        return acc;\r\n      }, {} as Record<string, number>);\r\n\r\n      const statusDistribution = Object.entries(statusCounts).map(([status, count]) => ({\r\n        status,\r\n        count,\r\n        percentage: (count / totalSales) * 100\r\n      }));\r\n\r\n      // Warranty expiring soon (30 days)\r\n      const thirtyDaysFromNow = new Date();\r\n      thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\r\n      const now = new Date();\r\n\r\n      const warrantyExpiringSoon = mappedSales.filter(sale => {\r\n        const warrantyDate = new Date(sale.warranty_expiry);\r\n        return warrantyDate <= thirtyDaysFromNow && warrantyDate >= now;\r\n      });\r\n\r\n      return {\r\n        totalSales: totalSales,\r\n        totalRevenue: totalRevenue,\r\n        averageSaleValue: averageDealSize,\r\n        completedSales: totalSales,\r\n        pendingSales: 0,\r\n        totalQuantity: mappedSales.reduce((sum, sale) => sum + sale.units, 0),\r\n        revenueByMonth: revenueByMonth,\r\n        topProducts: topProducts,\r\n        topCustomers: topCustomers,\r\n        byStatus: statusDistribution,\r\n        lastUpdated: new Date().toISOString(),\r\n      } as ProductSalesAnalyticsDTO;\r\n    } catch (error) {\r\n      console.error('Error fetching analytics:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to fetch analytics');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Upload file attachment\r\n   */\r\n  async uploadAttachment(saleId: string, file: File): Promise<FileAttachment> {\r\n    try {\r\n      const tenantId = multiTenantService.getCurrentTenantId();\r\n      \r\n      // Verify product sale exists\r\n      const { data: sale, error: saleError } = await supabaseClient\r\n        .from('product_sales')\r\n        .select('id')\r\n        .eq('id', saleId)\r\n        .eq('tenant_id', tenantId)\r\n        .single();\r\n\r\n      if (saleError || !sale) throw new Error('Product sale not found');\r\n\r\n      // Upload file to storage\r\n      const filePath = `${tenantId}/${saleId}/${Date.now()}-${file.name}`;\r\n      const { error: uploadError } = await supabaseClient.storage\r\n        .from('product-sale-attachments')\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw handleSupabaseError(uploadError);\r\n\r\n      // Get public URL\r\n      const { data } = supabaseClient.storage\r\n        .from('product-sale-attachments')\r\n        .getPublicUrl(filePath);\r\n\r\n      const attachment: FileAttachment = {\r\n        id: `att-${Date.now()}`,\r\n        name: file.name,\r\n        size: file.size,\r\n        type: file.type,\r\n        url: data.publicUrl,\r\n        uploaded_at: new Date().toISOString()\r\n      };\r\n\r\n      return attachment;\r\n    } catch (error) {\r\n      console.error('Error uploading attachment:', error);\r\n      throw error instanceof Error ? error : new Error('Failed to upload attachment');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Map database row to ProductSale interface\r\n   */\r\n  private mapToProductSale(row: any): ProductSale {\r\n    return {\r\n      id: row.id,\r\n      customer_id: row.customer_id,\r\n      customer_name: row.customer_name || '',\r\n      product_id: row.product_id,\r\n      product_name: row.product_name || '',\r\n      units: row.units,\r\n      cost_per_unit: row.cost_per_unit,\r\n      total_cost: row.total_cost,\r\n      delivery_date: row.delivery_date,\r\n      warranty_expiry: row.warranty_expiry,\r\n      status: row.status,\r\n      notes: row.notes || '',\r\n      attachments: row.attachments || [],\r\n      service_contract_id: row.service_contract_id,\r\n      tenant_id: row.tenant_id,\r\n      created_at: row.created_at,\r\n      updated_at: row.updated_at,\r\n      created_by: row.created_by\r\n    };\r\n  }\r\n}\r\n\r\nexport { SupabaseProductSaleService };\r\nexport const supabaseProductSaleService = new SupabaseProductSaleService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\productService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[684,687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[684,687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7824,7827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7824,7827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":322,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8922,8925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8922,8925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":372,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10241,10244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10241,10244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":405,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10998,11001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10998,11001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Product Service\r\n * Handles product catalog, categories, specifications\r\n * Extends BaseSupabaseService for common database operations\r\n */\r\n\r\nimport { BaseSupabaseService } from './baseService';\r\nimport { getSupabaseClient, supabaseClient } from './client';\r\nimport { multiTenantService } from './multiTenantService';\r\n\r\nexport interface Product {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  category_id?: string;\r\n  sku: string;\r\n  price: number;\r\n  cost?: number;\r\n  currency: string;\r\n  stock_quantity: number;\r\n  reorder_level?: number;\r\n  status: 'active' | 'inactive' | 'discontinued';\r\n  image_url?: string;\r\n  specifications?: Record<string, any>;\r\n  tags?: string[];\r\n  tenant_id: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface ProductFilters {\r\n  status?: string;\r\n  categoryId?: string;\r\n  tenantId?: string;\r\n  search?: string;\r\n}\r\n\r\nexport class SupabaseProductService extends BaseSupabaseService {\r\n  constructor() {\r\n    super('products', true);\r\n  }\r\n\r\n  /**\r\n   * Get all products with optional filtering\r\n   */\r\n  async getProducts(filters?: ProductFilters): Promise<Product[]> {\r\n    try {\r\n      this.log('Fetching products', filters);\r\n\r\n      const tenant = await this.ensureTenantContext();\r\n\r\n      const client = getSupabaseClient();\r\n\r\n      let query = client\r\n        .from('products')\r\n        .select(\r\n          `*,\r\n          category:product_categories(*)`\r\n        );\r\n\r\n      // Apply filters\r\n      if (filters?.tenantId) {\r\n        query = query.eq('tenant_id', filters.tenantId);\r\n      } else {\r\n        query = query.eq('tenant_id', tenant.tenantId);\r\n      }\r\n      if (filters?.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n      if (filters?.categoryId) {\r\n        query = query.eq('category_id', filters.categoryId);\r\n      }\r\n\r\n      // Exclude deleted records\r\n      query = query.is('deleted_at', null);\r\n\r\n      const { data, error } = await query.order('name');\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Products fetched', { count: data?.length });\r\n      return data?.map((p) => this.mapProductResponse(p)) || [];\r\n    } catch (error) {\r\n      this.logError('Error fetching products', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get product by ID\r\n   */\r\n  async getProduct(id: string): Promise<Product | null> {\r\n    try {\r\n      this.log('Fetching product', { id });\r\n\r\n      await this.ensureTenantContext();\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('products')\r\n        .select(\r\n          `*,\r\n          category:product_categories(*)`\r\n        )\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data ? this.mapProductResponse(data) : null;\r\n    } catch (error) {\r\n      this.logError('Error fetching product', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new product\r\n   */\r\n  async createProduct(data: Partial<Product>): Promise<Product> {\r\n    try {\r\n      this.log('Creating product', { name: data.name });\r\n\r\n      const tenant = await this.ensureTenantContext();\r\n\r\n      const { data: created, error } = await getSupabaseClient()\r\n        .from('products')\r\n        .insert([\r\n          {\r\n            name: data.name,\r\n            description: data.description,\r\n            category_id: data.category_id,\r\n            sku: data.sku,\r\n            price: data.price || 0,\r\n            cost: data.cost,\r\n            currency: data.currency || 'USD',\r\n            stock_quantity: data.stock_quantity || 0,\r\n            reorder_level: data.reorder_level,\r\n            status: data.status || 'active',\r\n            image_url: data.image_url,\r\n            specifications: data.specifications,\r\n            tags: data.tags,\r\n            tenant_id: data.tenant_id || tenant.tenantId,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select(\r\n          `*,\r\n          category:product_categories(*)`\r\n        )\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Product created successfully', { id: created.id });\r\n      return this.mapProductResponse(created);\r\n    } catch (error) {\r\n      this.logError('Error creating product', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update product\r\n   */\r\n  async updateProduct(id: string, updates: Partial<Product>): Promise<Product> {\r\n    try {\r\n      this.log('Updating product', { id });\r\n\r\n      const tenant = await this.ensureTenantContext();\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('products')\r\n        .update({\r\n          name: updates.name,\r\n          description: updates.description,\r\n          category_id: updates.category_id,\r\n          sku: updates.sku,\r\n          price: updates.price,\r\n          cost: updates.cost,\r\n          currency: updates.currency,\r\n          stock_quantity: updates.stock_quantity,\r\n          reorder_level: updates.reorder_level,\r\n          status: updates.status,\r\n          image_url: updates.image_url,\r\n          specifications: updates.specifications,\r\n          tags: updates.tags,\r\n          tenant_id: updates.tenant_id || tenant.tenantId,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id)\r\n        .select(\r\n          `*,\r\n          category:product_categories(*)`\r\n        )\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Product updated successfully', { id });\r\n      return this.mapProductResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error updating product', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete product (soft delete)\r\n   */\r\n  async deleteProduct(id: string): Promise<void> {\r\n    try {\r\n      this.log('Deleting product', { id });\r\n\r\n      await this.ensureTenantContext();\r\n\r\n      const { error } = await getSupabaseClient()\r\n        .from('products')\r\n        .update({ deleted_at: new Date().toISOString() })\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Product deleted successfully', { id });\r\n    } catch (error) {\r\n      this.logError('Error deleting product', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search products by name or SKU\r\n   */\r\n  async searchProducts(\r\n    searchTerm: string,\r\n    tenantId?: string\r\n  ): Promise<Product[]> {\r\n    try {\r\n      this.log('Searching products', { searchTerm });\r\n\r\n      let query = getSupabaseClient()\r\n        .from('products')\r\n        .select(\r\n          `*,\r\n          category:product_categories(*)`\r\n        )\r\n        .or(`name.ilike.%${searchTerm}%,sku.ilike.%${searchTerm}%`);\r\n\r\n      if (tenantId) {\r\n        query = query.eq('tenant_id', tenantId);\r\n      }\r\n\r\n      query = query.is('deleted_at', null);\r\n\r\n      const { data, error } = await query.order('name');\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Search completed', { count: data?.length });\r\n      return data?.map((p) => this.mapProductResponse(p)) || [];\r\n    } catch (error) {\r\n      this.logError('Error searching products', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get low stock products\r\n   */\r\n  async getLowStockProducts(tenantId: string): Promise<Product[]> {\r\n    try {\r\n      this.log('Fetching low stock products', { tenantId });\r\n\r\n      const query = getSupabaseClient()\r\n        .from('products')\r\n        .select(\r\n          `*,\r\n          category:product_categories(*)`\r\n        )\r\n        .eq('tenant_id', tenantId)\r\n        .eq('status', 'active')\r\n        .is('deleted_at', null);\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      // Filter products where stock is below reorder level\r\n      const lowStock = data?.filter((p: any) => {\r\n        const reorderLevel = p.reorder_level || 0;\r\n        return p.stock_quantity <= reorderLevel;\r\n      }) || [];\r\n\r\n      this.log('Low stock products fetched', { count: lowStock.length });\r\n      return lowStock.map((p) => this.mapProductResponse(p));\r\n    } catch (error) {\r\n      this.logError('Error fetching low stock products', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update product stock\r\n   */\r\n  async updateStock(id: string, quantity: number, action: 'add' | 'subtract' | 'set'): Promise<Product> {\r\n    try {\r\n      this.log('Updating product stock', { id, quantity, action });\r\n\r\n      // First get current stock\r\n      const product = await this.getProduct(id);\r\n      if (!product) throw new Error('Product not found');\r\n\r\n      let newStock = product.stock_quantity;\r\n      if (action === 'add') {\r\n        newStock += quantity;\r\n      } else if (action === 'subtract') {\r\n        newStock = Math.max(0, newStock - quantity);\r\n      } else {\r\n        newStock = quantity;\r\n      }\r\n\r\n      return this.updateProduct(id, { stock_quantity: newStock } as any);\r\n    } catch (error) {\r\n      this.logError('Error updating product stock', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get product statistics\r\n   */\r\n  async getProductStats(tenantId: string): Promise<{\r\n    total: number;\r\n    active: number;\r\n    discontinued: number;\r\n    totalInventoryValue: number;\r\n    averagePrice: number;\r\n  }> {\r\n    try {\r\n      this.log('Fetching product statistics', { tenantId });\r\n\r\n      const products = await this.getProducts({ tenantId });\r\n\r\n      const stats = {\r\n        total: products.length,\r\n        active: products.filter((p) => p.status === 'active').length,\r\n        discontinued: products.filter((p) => p.status === 'discontinued').length,\r\n        totalInventoryValue: 0,\r\n        averagePrice: 0,\r\n      };\r\n\r\n      if (products.length > 0) {\r\n        stats.totalInventoryValue = products.reduce(\r\n          (sum, p) => sum + p.price * p.stock_quantity,\r\n          0\r\n        );\r\n        stats.averagePrice = products.reduce((sum, p) => sum + p.price, 0) / products.length;\r\n      }\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      this.logError('Error fetching product statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to product changes\r\n   */\r\n  subscribeToProducts(\r\n    tenantId: string,\r\n    callback: (payload: any) => void\r\n  ): () => void {\r\n    return this.subscribeToChanges(\r\n      {\r\n        event: '*',\r\n        table: 'products',\r\n        filter: `tenant_id=eq.${tenantId}`,\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  private async ensureTenantContext() {\r\n    const tenant = multiTenantService.getCurrentTenant();\r\n    if (!tenant?.tenantId) {\r\n      this.logError('No tenant context available');\r\n      throw new Error('Unauthorized');\r\n    }\r\n\r\n    await supabaseClient.auth.updateUser({\r\n      data: {\r\n        tenant_id: tenant.tenantId,\r\n        role: tenant.role,\r\n        user_id: tenant.userId,\r\n      },\r\n    });\r\n\r\n    return tenant;\r\n  }\r\n\r\n  /**\r\n   * Map database product response to Product type\r\n   */\r\n  private mapProductResponse(dbProduct: any): Product {\r\n    return {\r\n      id: dbProduct.id,\r\n      name: dbProduct.name,\r\n      description: dbProduct.description || '',\r\n      category_id: dbProduct.category_id,\r\n      sku: dbProduct.sku,\r\n      price: dbProduct.price || 0,\r\n      cost: dbProduct.cost,\r\n      currency: dbProduct.currency || 'USD',\r\n      stock_quantity: dbProduct.stock_quantity || 0,\r\n      reorder_level: dbProduct.reorder_level,\r\n      status: (dbProduct.status || 'active') as Product['status'],\r\n      image_url: dbProduct.image_url || '',\r\n      specifications: dbProduct.specifications,\r\n      tags: dbProduct.tags || [],\r\n      tenant_id: dbProduct.tenant_id,\r\n      created_at: dbProduct.created_at,\r\n      updated_at: dbProduct.updated_at,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseProductService = new SupabaseProductService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\queryBuilders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[373,376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[373,376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[378,381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[378,381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[383,386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[383,386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[652,655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[652,655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[657,660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[657,660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[662,665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[662,665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[941,944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[941,944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[946,949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[946,949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[951,954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[951,954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1204,1207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1204,1207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1209,1212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1209,1212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1214,1217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1214,1217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1462,1465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1462,1465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1572,1575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1572,1575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1672,1675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1672,1675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1764,1767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1764,1767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1852,1855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1852,1855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1996,1999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1996,1999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2001,2004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2001,2004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2006,2009],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2006,2009],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2249,2252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2249,2252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2359,2362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2359,2362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2466,2469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2466,2469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2559,2562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2559,2562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2648,2651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2648,2651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2783,2786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2783,2786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2788,2791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2788,2791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2793,2796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2793,2796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2983,2986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2983,2986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3070,3073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3070,3073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3151,3154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3151,3154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3294,3297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3294,3297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5704,5707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5704,5707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5709,5712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5709,5712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5714,5717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5714,5717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5790,5793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5790,5793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5795,5798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5795,5798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5800,5803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5800,5803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6029,6032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6029,6032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":39,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Query Builders for Supabase Operations\r\n * Provides common query patterns with type safety\r\n */\r\n\r\nimport type { PostgrestQueryBuilder, PostgrestFilterBuilder } from '@supabase/postgrest-js';\r\nimport { multiTenantService } from './multiTenantService';\r\n\r\n/**\r\n * Add tenant filter to any query\r\n */\r\nexport function addTenantFilter<T extends PostgrestFilterBuilder<any, any, any>>(\r\n  query: T,\r\n  tenantId?: string\r\n): T {\r\n  const id = tenantId || multiTenantService.getCurrentTenantId();\r\n  return query.eq('tenant_id', id) as T;\r\n}\r\n\r\n/**\r\n * Apply pagination to query\r\n */\r\nexport function applyPagination<T extends PostgrestFilterBuilder<any, any, any>>(\r\n  query: T,\r\n  page: number = 1,\r\n  pageSize: number = 10\r\n): T {\r\n  const offset = (page - 1) * pageSize;\r\n  return query.range(offset, offset + pageSize - 1) as T;\r\n}\r\n\r\n/**\r\n * Apply sorting to query\r\n */\r\nexport function applySorting<T extends PostgrestFilterBuilder<any, any, any>>(\r\n  query: T,\r\n  sortBy: string,\r\n  ascending: boolean = true\r\n): T {\r\n  return query.order(sortBy, { ascending }) as T;\r\n}\r\n\r\n/**\r\n * Build service contracts query\r\n */\r\nexport function buildServiceContractQuery(\r\n  query: PostgrestFilterBuilder<any, any, any>,\r\n  filters?: {\r\n    status?: string;\r\n    customerName?: string;\r\n    serviceLevel?: string;\r\n    expiryFrom?: string;\r\n    expiryTo?: string;\r\n  }\r\n) {\r\n  let q = query;\r\n\r\n  if (filters?.status) {\r\n    q = q.eq('status', filters.status) as any;\r\n  }\r\n\r\n  if (filters?.customerName) {\r\n    q = q.ilike('customer_name', `%${filters.customerName}%`) as any;\r\n  }\r\n\r\n  if (filters?.serviceLevel) {\r\n    q = q.eq('service_level', filters.serviceLevel) as any;\r\n  }\r\n\r\n  if (filters?.expiryFrom) {\r\n    q = q.gte('end_date', filters.expiryFrom) as any;\r\n  }\r\n\r\n  if (filters?.expiryTo) {\r\n    q = q.lte('end_date', filters.expiryTo) as any;\r\n  }\r\n\r\n  return q;\r\n}\r\n\r\n/**\r\n * Build product sales query\r\n */\r\nexport function buildProductSalesQuery(\r\n  query: PostgrestFilterBuilder<any, any, any>,\r\n  filters?: {\r\n    status?: string;\r\n    customerName?: string;\r\n    productName?: string;\r\n    dateFrom?: string;\r\n    dateTo?: string;\r\n  }\r\n) {\r\n  let q = query;\r\n\r\n  if (filters?.status) {\r\n    q = q.eq('status', filters.status) as any;\r\n  }\r\n\r\n  if (filters?.customerName) {\r\n    q = q.ilike('customer_name', `%${filters.customerName}%`) as any;\r\n  }\r\n\r\n  if (filters?.productName) {\r\n    q = q.ilike('product_name', `%${filters.productName}%`) as any;\r\n  }\r\n\r\n  if (filters?.dateFrom) {\r\n    q = q.gte('delivery_date', filters.dateFrom) as any;\r\n  }\r\n\r\n  if (filters?.dateTo) {\r\n    q = q.lte('delivery_date', filters.dateTo) as any;\r\n  }\r\n\r\n  return q;\r\n}\r\n\r\n/**\r\n * Build customer query\r\n */\r\nexport function buildCustomerQuery(\r\n  query: PostgrestFilterBuilder<any, any, any>,\r\n  filters?: {\r\n    name?: string;\r\n    industry?: string;\r\n    status?: string;\r\n  }\r\n) {\r\n  let q = query;\r\n\r\n  if (filters?.name) {\r\n    q = q.ilike('name', `%${filters.name}%`) as any;\r\n  }\r\n\r\n  if (filters?.industry) {\r\n    q = q.eq('industry', filters.industry) as any;\r\n  }\r\n\r\n  if (filters?.status) {\r\n    q = q.eq('status', filters.status) as any;\r\n  }\r\n\r\n  return q;\r\n}\r\n\r\n/**\r\n * Handle database error and return user-friendly message\r\n */\r\nexport function handleSupabaseError(error: any): string {\r\n  if (!error) return 'Unknown error occurred';\r\n  \r\n  if (typeof error === 'string') return error;\r\n  \r\n  if (error.message) {\r\n    // Handle specific error messages\r\n    if (error.message.includes('duplicate')) {\r\n      return 'This record already exists';\r\n    }\r\n    if (error.message.includes('not found')) {\r\n      return 'Record not found';\r\n    }\r\n    if (error.message.includes('permission')) {\r\n      return 'You do not have permission to perform this action';\r\n    }\r\n    return error.message;\r\n  }\r\n  \r\n  return 'An error occurred while processing your request';\r\n}\r\n\r\n/**\r\n * Retry logic for failed queries\r\n */\r\nexport async function retryQuery<T>(\r\n  operation: () => Promise<T>,\r\n  maxRetries: number = 3,\r\n  delayMs: number = 1000\r\n): Promise<T> {\r\n  let lastError: Error | null = null;\r\n\r\n  for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n    try {\r\n      return await operation();\r\n    } catch (error) {\r\n      lastError = error as Error;\r\n      \r\n      // Don't retry for specific errors\r\n      if (error instanceof Error && error.message.includes('permission')) {\r\n        throw error;\r\n      }\r\n\r\n      if (attempt < maxRetries) {\r\n        await new Promise(resolve => setTimeout(resolve, delayMs * attempt));\r\n      }\r\n    }\r\n  }\r\n\r\n  throw lastError || new Error('Query failed after retries');\r\n}\r\n\r\n/**\r\n * Build real-time subscription filter\r\n */\r\nexport function buildRealtimeFilter(\r\n  table: string,\r\n  tenantId?: string\r\n): {\r\n  event: '*' | 'INSERT' | 'UPDATE' | 'DELETE';\r\n  schema: string;\r\n  table: string;\r\n  filter: string;\r\n} {\r\n  const id = tenantId || multiTenantService.getCurrentTenantId();\r\n\r\n  return {\r\n    event: '*',\r\n    schema: 'public',\r\n    table,\r\n    filter: `tenant_id=eq.${id}`,\r\n  };\r\n}\r\n\r\n/**\r\n * Count records query\r\n */\r\nexport async function countRecords(\r\n  table: string,\r\n  tenantId?: string\r\n): Promise<number> {\r\n  const { supabaseClient } = await import('./client');\r\n  const id = tenantId || multiTenantService.getCurrentTenantId();\r\n\r\n  const { count, error } = await supabaseClient\r\n    .from(table)\r\n    .select('*', { count: 'exact', head: true })\r\n    .eq('tenant_id', id);\r\n\r\n  if (error) {\r\n    throw new Error(`Failed to count records: ${error.message}`);\r\n  }\r\n\r\n  return count || 0;\r\n}\r\n\r\n/**\r\n * Search records across multiple fields\r\n */\r\nexport function buildSearchQuery(\r\n  query: PostgrestFilterBuilder<any, any, any>,\r\n  searchTerm: string,\r\n  fields: string[]\r\n): PostgrestFilterBuilder<any, any, any> {\r\n  if (!searchTerm) return query;\r\n\r\n  // Build OR condition for multiple fields\r\n  const searchFilters = fields\r\n    .map(field => `${field}.ilike.%${searchTerm}%`)\r\n    .join(',');\r\n\r\n  return query.or(searchFilters) as any;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\salesService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1239,1242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1239,1242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5987,5990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5987,5990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7915,7918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7915,7918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":379,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":379,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13030,13033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13030,13033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":608,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":608,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20014,20017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20014,20017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":628,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":628,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20530,20533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20530,20533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":643,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":643,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20900,20903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20900,20903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":686,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":686,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22960,22963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22960,22963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Sales Service\r\n * Handles sales pipeline, deals, sales items\r\n * Extends BaseSupabaseService for common database operations\r\n */\r\n\r\nimport { BaseSupabaseService } from './baseService';\r\nimport { getSupabaseClient } from './client';\r\nimport { Sale, Deal } from '@/types/crm';\r\nimport { SupabaseNotificationService, Notification } from './notificationService';\r\n\r\nexport interface SalesFilters {\r\n  status?: string;\r\n  stage?: string;\r\n  assignedTo?: string;\r\n  customerId?: string;\r\n  tenantId?: string;\r\n  dateRange?: { from: string; to: string };\r\n}\r\n\r\nexport class SupabaseSalesService extends BaseSupabaseService {\r\n  private notificationService: SupabaseNotificationService;\r\n\r\n  constructor() {\r\n    super('sales', true);\r\n    this.notificationService = new SupabaseNotificationService();\r\n  }\r\n\r\n  /**\r\n   * Helper method to get current user's tenant_id\r\n   */\r\n  private async getCurrentUserTenantId(): Promise<string | null> {\r\n    try {\r\n      const supabase = getSupabaseClient();\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      \r\n      if (user) {\r\n        // Try JWT claims first\r\n        const tenantFromJwt = (user.user_metadata?.tenant_id || \r\n                              (user as any).app_metadata?.tenant_id);\r\n        if (tenantFromJwt) return tenantFromJwt;\r\n        \r\n        // Fall back to users table\r\n        const { data: userData } = await supabase\r\n          .from('users')\r\n          .select('tenant_id')\r\n          .eq('id', user.id)\r\n          .single();\r\n        return userData?.tenant_id || null;\r\n      }\r\n      return null;\r\n    } catch (error) {\r\n      console.error('Error getting current user tenant:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper method to get current user ID\r\n   */\r\n  private async getCurrentUserId(): Promise<string | null> {\r\n    try {\r\n      const supabase = getSupabaseClient();\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      return user?.id || null;\r\n    } catch (error) {\r\n      console.error('Error getting current user:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a notification for a sales operation\r\n   */\r\n  private async createSalesNotification(\r\n    type: 'info' | 'success' | 'warning' | 'error',\r\n    title: string,\r\n    message: string,\r\n    saleId?: string\r\n  ): Promise<void> {\r\n    try {\r\n      const userId = await this.getCurrentUserId();\r\n      const tenantId = await this.getCurrentUserTenantId();\r\n      \r\n      if (!userId || !tenantId) {\r\n        this.log('Skipping notification: missing user or tenant', { userId, tenantId });\r\n        return;\r\n      }\r\n\r\n      await this.notificationService.createNotification({\r\n        user_id: userId,\r\n        type,\r\n        title,\r\n        message,\r\n        category: 'sales',\r\n        action_url: saleId ? `/sales/${saleId}` : undefined,\r\n        action_label: saleId ? 'View Sale' : undefined,\r\n        tenant_id: tenantId,\r\n      } as Partial<Notification>);\r\n\r\n      this.log('Sales notification created', { type, title });\r\n    } catch (error) {\r\n      this.logError('Failed to create sales notification', error);\r\n      // Don't throw - continue even if notification fails\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all sales with optional filtering\r\n   */\r\n  async getSales(filters?: SalesFilters): Promise<Sale[]> {\r\n    try {\r\n      this.log('Fetching sales', filters);\r\n\r\n      // Fetch sales without complex relationships (avoid Supabase RLS issues with multiple foreign keys)\r\n      let query = getSupabaseClient()\r\n        .from('sales')\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          items:sale_items(*)`\r\n        );\r\n\r\n      // Apply filters\r\n      if (filters?.tenantId) {\r\n        query = query.eq('tenant_id', filters.tenantId);\r\n      }\r\n      if (filters?.stage) {\r\n        query = query.eq('stage', filters.stage);\r\n      }\r\n      if (filters?.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n      if (filters?.assignedTo) {\r\n        query = query.eq('assigned_to', filters.assignedTo);\r\n      }\r\n      if (filters?.customerId) {\r\n        query = query.eq('customer_id', filters.customerId);\r\n      }\r\n\r\n      // Exclude deleted records\r\n      query = query.is('deleted_at', null);\r\n\r\n      const { data, error } = await query.order('created_at', {\r\n        ascending: false,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Sales fetched', { count: data?.length });\r\n      return data?.map((s) => this.mapSaleResponse(s)) || [];\r\n    } catch (error) {\r\n      this.logError('Error fetching sales', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get sale by ID\r\n   */\r\n  async getSale(id: string): Promise<Sale | null> {\r\n    try {\r\n      this.log('Fetching sale', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('sales')\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          items:sale_items(*)`\r\n        )\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data ? this.mapSaleResponse(data) : null;\r\n    } catch (error) {\r\n      this.logError('Error fetching sale', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new sale\r\n   */\r\n  async createSale(data: Partial<Sale>): Promise<Sale> {\r\n    try {\r\n      this.log('Creating sale', { customer_id: data.customer_id });\r\n\r\n      // Extract items if provided\r\n      const items = data.items;\r\n\r\n      // Get current user's tenant_id for RLS compliance\r\n      const supabase = getSupabaseClient();\r\n      let tenantId = data.tenant_id;\r\n      \r\n      if (!tenantId) {\r\n        // Get current user's tenant from auth session\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (user) {\r\n          // Try to get tenant_id from JWT claims first\r\n          const tenantFromJwt = (user.user_metadata?.tenant_id || \r\n                                 (user as any).app_metadata?.tenant_id);\r\n          if (tenantFromJwt) {\r\n            tenantId = tenantFromJwt;\r\n          } else {\r\n            // Fall back to querying users table\r\n            const { data: userData } = await supabase\r\n              .from('users')\r\n              .select('tenant_id')\r\n              .eq('id', user.id)\r\n              .single();\r\n            tenantId = userData?.tenant_id;\r\n          }\r\n        }\r\n        \r\n        if (!tenantId) {\r\n          throw new Error('Cannot determine tenant_id for current user');\r\n        }\r\n      }\r\n\r\n      const { data: created, error } = await getSupabaseClient()\r\n        .from('sales')\r\n        .insert([\r\n          {\r\n            sale_number: data.sale_number,\r\n            title: data.title,\r\n            description: data.description,\r\n            customer_id: data.customer_id,\r\n            value: data.value || 0,\r\n            amount: data.amount || 0,\r\n            probability: data.probability || 50,\r\n            stage: data.stage || 'lead',\r\n            status: data.status || 'open',\r\n            expected_close_date: data.expected_close_date,\r\n            actual_close_date: data.actual_close_date,\r\n            assigned_to: data.assigned_to,\r\n            notes: data.notes,\r\n            source: data.source,\r\n            campaign: data.campaign,\r\n            tags: data.tags,\r\n            tenant_id: tenantId,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          items:sale_items(*)`\r\n        )\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      // Handle sale items if provided\r\n      if (items && Array.isArray(items) && items.length > 0 && created) {\r\n        console.log('‚è≥ [SUPABASE] Creating sale items for new sale...');\r\n        try {\r\n          const itemsToInsert = items.map((item: any) => ({\r\n            sale_id: created.id,\r\n            product_id: item.product_id || null,\r\n            product_name: item.product_name,\r\n            product_description: item.product_description || null,\r\n            quantity: item.quantity,\r\n            unit_price: item.unit_price,\r\n            discount: item.discount || 0,\r\n            tax: item.tax || 0,\r\n            line_total: item.line_total,\r\n          }));\r\n\r\n          const { error: insertError } = await getSupabaseClient()\r\n            .from('sale_items')\r\n            .insert(itemsToInsert);\r\n\r\n          if (insertError) {\r\n            console.warn('‚ö†Ô∏è [SUPABASE] Warning: Could not insert items:', insertError.message);\r\n          } else {\r\n            console.log('üîÑ [SUPABASE] Created sale items:', itemsToInsert.length);\r\n          }\r\n        } catch (itemError) {\r\n          console.warn('‚ö†Ô∏è [SUPABASE] Warning: Error creating items, continuing:', itemError);\r\n        }\r\n      }\r\n\r\n      this.log('Sale created successfully', { id: created.id });\r\n      \r\n      // Create notification for sale creation\r\n      const mappedSale = this.mapSaleResponse(created);\r\n      await this.createSalesNotification(\r\n        'success',\r\n        'Sale Created',\r\n        `New sale \"${data.title || 'Untitled'}\" has been created successfully`,\r\n        created.id\r\n      );\r\n      \r\n      return mappedSale;\r\n    } catch (error) {\r\n      this.logError('Error creating sale', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update sale\r\n   * Sanitizes data to exclude undefined/null/empty values to prevent \"invalid input syntax for type uuid\" errors\r\n   */\r\n  async updateSale(id: string, updates: Partial<Sale>): Promise<Sale> {\r\n    try {\r\n      this.log('Updating sale', { id, updatesKeys: Object.keys(updates) });\r\n\r\n      // Helper to check if a value is valid (not undefined, null, or empty string)\r\n      const isValidValue = (val: unknown): boolean => {\r\n        return val !== undefined && val !== null && val !== '';\r\n      };\r\n\r\n      // Build update object, excluding invalid values to prevent PostgreSQL UUID errors\r\n      const updatePayload: Record<string, unknown> = {\r\n        updated_at: new Date().toISOString(),\r\n      };\r\n\r\n      // Only include fields that have actual values\r\n      if (isValidValue(updates.title)) updatePayload.title = updates.title;\r\n      if (isValidValue(updates.description)) updatePayload.description = updates.description;\r\n      if (isValidValue(updates.value)) updatePayload.value = updates.value;\r\n      if (isValidValue(updates.probability)) updatePayload.probability = updates.probability;\r\n      if (isValidValue(updates.stage)) updatePayload.stage = updates.stage;\r\n      if (isValidValue(updates.status)) updatePayload.status = updates.status;\r\n      if (isValidValue(updates.expected_close_date)) updatePayload.expected_close_date = updates.expected_close_date;\r\n      if (isValidValue(updates.actual_close_date)) updatePayload.actual_close_date = updates.actual_close_date;\r\n      if (isValidValue(updates.assigned_to)) updatePayload.assigned_to = updates.assigned_to;\r\n      if (isValidValue(updates.notes)) updatePayload.notes = updates.notes;\r\n      if (isValidValue(updates.customer_id)) updatePayload.customer_id = updates.customer_id;\r\n      if (isValidValue(updates.source)) updatePayload.source = updates.source;\r\n      if (isValidValue(updates.campaign)) updatePayload.campaign = updates.campaign;\r\n      if (isValidValue(updates.tags)) updatePayload.tags = updates.tags;\r\n\r\n      this.log('Update payload prepared', updatePayload);\r\n      console.log('üîÑ [SUPABASE] Making updateSale request:', { id, payload: updatePayload });\r\n\r\n      // STEP 1: Do the update (simpler query, less likely to hang)\r\n      console.log('‚è≥ [SUPABASE] Executing update operation...');\r\n      const { error: updateError } = await getSupabaseClient()\r\n        .from('sales')\r\n        .update(updatePayload)\r\n        .eq('id', id);\r\n\r\n      console.log('üîÑ [SUPABASE] Update operation response:', { updateError });\r\n\r\n      if (updateError) {\r\n        console.error('‚ùå [SUPABASE] Update error detail:', {\r\n          message: updateError.message,\r\n          code: updateError.code,\r\n          details: updateError.details,\r\n          hint: updateError.hint,\r\n          fullError: updateError\r\n        });\r\n        throw updateError;\r\n      }\r\n\r\n      // STEP 1.5: Handle sale items update if provided\r\n      if (updates.items && Array.isArray(updates.items) && updates.items.length > 0) {\r\n        console.log('‚è≥ [SUPABASE] Updating sale items...');\r\n        try {\r\n          // Delete existing items for this sale\r\n          const { error: deleteError } = await getSupabaseClient()\r\n            .from('sale_items')\r\n            .delete()\r\n            .eq('sale_id', id);\r\n\r\n          if (deleteError) {\r\n            console.warn('‚ö†Ô∏è [SUPABASE] Warning: Could not delete old items:', deleteError.message);\r\n          } else {\r\n            console.log('üîÑ [SUPABASE] Deleted existing sale items');\r\n          }\r\n\r\n          // Insert new items\r\n          const itemsToInsert = updates.items.map((item: any) => ({\r\n            sale_id: id,\r\n            product_id: item.product_id || null,\r\n            product_name: item.product_name,\r\n            product_description: item.product_description || null,\r\n            quantity: item.quantity,\r\n            unit_price: item.unit_price,\r\n            discount: item.discount || 0,\r\n            tax: item.tax || 0,\r\n            line_total: item.line_total,\r\n          }));\r\n\r\n          const { error: insertError } = await getSupabaseClient()\r\n            .from('sale_items')\r\n            .insert(itemsToInsert);\r\n\r\n          if (insertError) {\r\n            console.warn('‚ö†Ô∏è [SUPABASE] Warning: Could not insert new items:', insertError.message);\r\n          } else {\r\n            console.log('üîÑ [SUPABASE] Inserted new sale items:', itemsToInsert.length);\r\n          }\r\n        } catch (itemError) {\r\n          console.warn('‚ö†Ô∏è [SUPABASE] Warning: Error handling sale items, continuing:', itemError);\r\n        }\r\n      } else if (updates.items !== undefined && (!Array.isArray(updates.items) || updates.items.length === 0)) {\r\n        // If items is explicitly provided but empty, delete all items for this sale\r\n        console.log('‚è≥ [SUPABASE] Clearing sale items...');\r\n        try {\r\n          const { error: deleteError } = await getSupabaseClient()\r\n            .from('sale_items')\r\n            .delete()\r\n            .eq('sale_id', id);\r\n\r\n          if (!deleteError) {\r\n            console.log('üîÑ [SUPABASE] Cleared sale items');\r\n          }\r\n        } catch (itemError) {\r\n          console.warn('‚ö†Ô∏è [SUPABASE] Warning: Error clearing items:', itemError);\r\n        }\r\n      }\r\n\r\n      // STEP 2: Fetch the updated record separately (more reliable)\r\n      console.log('‚è≥ [SUPABASE] Fetching updated record...');\r\n      const { data, error: fetchError } = await getSupabaseClient()\r\n        .from('sales')\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          items:sale_items(*)`\r\n        )\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      console.log('üîÑ [SUPABASE] Fetch response:', { data, error: fetchError });\r\n\r\n      if (fetchError) {\r\n        console.error('‚ùå [SUPABASE] Fetch error detail:', {\r\n          message: fetchError.message,\r\n          code: fetchError.code,\r\n          details: fetchError.details,\r\n          hint: fetchError.hint,\r\n          fullError: fetchError\r\n        });\r\n        throw fetchError;\r\n      }\r\n\r\n      if (!data) {\r\n        console.warn('‚ö†Ô∏è [SUPABASE] Fetch returned no data');\r\n        throw new Error('Fetch returned no data after update');\r\n      }\r\n\r\n      this.log('Sale updated successfully', { id, returnedId: data.id });\r\n      \r\n      // Create notification for sale update\r\n      const mappedSale = this.mapSaleResponse(data);\r\n      const updateSummary = Object.entries(updates)\r\n        .filter(([_, v]) => v !== undefined && v !== null)\r\n        .map(([k]) => k)\r\n        .join(', ');\r\n      \r\n      await this.createSalesNotification(\r\n        'info',\r\n        'Sale Updated',\r\n        `Sale \"${data.title || 'Untitled'}\" has been updated${updateSummary ? ': ' + updateSummary : ''}`,\r\n        data.id\r\n      );\r\n      \r\n      return mappedSale;\r\n    } catch (error) {\r\n      this.logError('Error updating sale', error);\r\n      console.error('‚ùå [SUPABASE] UpdateSale exception:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete sale (soft delete)\r\n   */\r\n  async deleteSale(id: string): Promise<void> {\r\n    try {\r\n      this.log('Deleting sale', { id });\r\n\r\n      // Fetch sale before deletion to get its title for notification\r\n      const sale = await this.getSale(id);\r\n      const saleTitle = sale?.title || 'Untitled';\r\n\r\n      const { error } = await getSupabaseClient()\r\n        .from('sales')\r\n        .update({ deleted_at: new Date().toISOString() })\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Sale deleted successfully', { id });\r\n\r\n      // Create notification for sale deletion\r\n      await this.createSalesNotification(\r\n        'warning',\r\n        'Sale Deleted',\r\n        `Sale \"${saleTitle}\" has been deleted`\r\n      );\r\n    } catch (error) {\r\n      this.logError('Error deleting sale', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get sales by stage for pipeline view\r\n   */\r\n  async getSalesByStage(tenantId: string): Promise<Record<string, Sale[]>> {\r\n    try {\r\n      this.log('Fetching sales by stage', { tenantId });\r\n\r\n      const sales = await this.getSales({ tenantId });\r\n\r\n      const grouped: Record<string, Sale[]> = {\r\n        lead: [],\r\n        qualified: [],\r\n        proposal: [],\r\n        negotiation: [],\r\n        closed_won: [],\r\n        closed_lost: [],\r\n      };\r\n\r\n      sales.forEach((sale) => {\r\n        const stage = (sale.stage || 'lead') as keyof typeof grouped;\r\n        if (grouped[stage]) {\r\n          grouped[stage].push(sale);\r\n        }\r\n      });\r\n\r\n      return grouped;\r\n    } catch (error) {\r\n      this.logError('Error fetching sales by stage', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get sales statistics and KPIs\r\n   */\r\n  async getSalesStats(tenantId: string): Promise<{\r\n    total: number;\r\n    totalValue: number;\r\n    avgValue: number;\r\n    byStage: Record<string, { count: number; value: number }>;\r\n    closedWon: number;\r\n    closedLost: number;\r\n    conversionRate: number;\r\n  }> {\r\n    try {\r\n      this.log('Fetching sales statistics', { tenantId });\r\n\r\n      const sales = await this.getSales({ tenantId });\r\n\r\n      const stats = {\r\n        total: sales.length,\r\n        totalValue: 0,\r\n        avgValue: 0,\r\n        byStage: {} as Record<string, { count: number; value: number }>,\r\n        closedWon: 0,\r\n        closedLost: 0,\r\n        conversionRate: 0,\r\n      };\r\n\r\n      sales.forEach((s) => {\r\n        stats.totalValue += s.value || 0;\r\n\r\n        const stage = s.stage || 'lead';\r\n        if (!stats.byStage[stage]) {\r\n          stats.byStage[stage] = { count: 0, value: 0 };\r\n        }\r\n        stats.byStage[stage].count++;\r\n        stats.byStage[stage].value += s.value || 0;\r\n\r\n        if (s.status === 'won') stats.closedWon++;\r\n        if (s.status === 'lost') stats.closedLost++;\r\n      });\r\n\r\n      if (sales.length > 0) {\r\n        stats.avgValue = stats.totalValue / sales.length;\r\n      }\r\n\r\n      const qualified =\r\n        (stats.byStage['qualified']?.count || 0) + stats.closedWon;\r\n      stats.conversionRate = qualified > 0 ? stats.closedWon / qualified : 0;\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      this.logError('Error fetching sales statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update sale stage (move through pipeline)\r\n   */\r\n  async updateStage(\r\n    id: string,\r\n    newStage: string,\r\n    notes?: string\r\n  ): Promise<Sale> {\r\n    try {\r\n      this.log('Updating sale stage', { id, newStage });\r\n\r\n      const updatedSale = await this.updateSale(id, {\r\n        stage: newStage as Sale['stage'],\r\n        notes: notes || undefined,\r\n      } as any);\r\n\r\n      // Create a more specific notification for stage changes\r\n      await this.createSalesNotification(\r\n        'success',\r\n        'Sale Stage Updated',\r\n        `Sale \"${updatedSale.title || 'Untitled'}\" has moved to ${newStage}`,\r\n        id\r\n      );\r\n\r\n      return updatedSale;\r\n    } catch (error) {\r\n      this.logError('Error updating sale stage', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to sales changes\r\n   */\r\n  subscribeToSales(tenantId: string, callback: (payload: any) => void): () => void {\r\n    return this.subscribeToChanges(\r\n      {\r\n        event: '*',\r\n        table: 'sales',\r\n        filter: `tenant_id=eq.${tenantId}`,\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Map database sale response to UI Sale type\r\n   * Ensures all fields are safely accessed with proper defaults\r\n   */\r\n  private mapSaleResponse(dbSale: any): Sale {\r\n    // Safely extract customer name from relationship or fallback to stored value\r\n    let customerName = '';\r\n    if (dbSale.customer && typeof dbSale.customer === 'object') {\r\n      customerName = dbSale.customer.company_name || dbSale.customer.contact_name || '';\r\n    } else if (typeof dbSale.customer_name === 'string') {\r\n      customerName = dbSale.customer_name;\r\n    }\r\n\r\n    // Safely extract assigned_to_name\r\n    let assignedToName = '';\r\n    if (dbSale.assigned_user && typeof dbSale.assigned_user === 'object') {\r\n      assignedToName = dbSale.assigned_user.display_name || dbSale.assigned_user.email || '';\r\n    } else if (typeof dbSale.assigned_to_name === 'string') {\r\n      assignedToName = dbSale.assigned_to_name;\r\n    }\r\n\r\n    return {\r\n      id: dbSale.id || '',\r\n      sale_number: dbSale.sale_number || '',\r\n      title: dbSale.title || 'Untitled Deal',\r\n      description: dbSale.description || '',\r\n      customer_id: dbSale.customer_id || '',\r\n      customer_name: customerName,\r\n      value: Number(dbSale.value) || 0,\r\n      amount: Number(dbSale.amount || dbSale.value) || 0,\r\n      currency: dbSale.currency || 'USD',\r\n      probability: Number(dbSale.probability) || 50,\r\n      weighted_amount: (Number(dbSale.value) || 0) * ((Number(dbSale.probability) || 50) / 100),\r\n      stage: (dbSale.stage || 'lead') as Sale['stage'],\r\n      status: (dbSale.status || 'open') as Sale['status'],\r\n      source: dbSale.source || '',\r\n      campaign: dbSale.campaign || '',\r\n      expected_close_date: dbSale.expected_close_date || '',\r\n      actual_close_date: dbSale.actual_close_date || '',\r\n      last_activity_date: dbSale.last_activity_date || '',\r\n      next_activity_date: dbSale.next_activity_date || '',\r\n      assigned_to: dbSale.assigned_to || '',\r\n      assigned_to_name: assignedToName,\r\n      notes: dbSale.notes || '',\r\n      tags: Array.isArray(dbSale.tags) ? dbSale.tags : [],\r\n      competitor_info: dbSale.competitor_info || '',\r\n      items: Array.isArray(dbSale.items)\r\n        ? dbSale.items.map((item: any) => ({\r\n            id: item.id || '',\r\n            sale_id: item.sale_id || '',\r\n            product_id: item.product_id || '',\r\n            product_name: item.product_name || '',\r\n            product_description: item.product_description || '',\r\n            quantity: Number(item.quantity) || 0,\r\n            unit_price: Number(item.unit_price) || 0,\r\n            discount: Number(item.discount) || 0,\r\n            tax: Number(item.tax) || 0,\r\n            line_total: Number(item.line_total) || Number(item.quantity || 0) * Number(item.unit_price || 0),\r\n          }))\r\n        : [],\r\n      tenant_id: dbSale.tenant_id || '',\r\n      created_at: dbSale.created_at || new Date().toISOString(),\r\n      updated_at: dbSale.updated_at || new Date().toISOString(),\r\n      created_by: dbSale.created_by || '',\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseSalesService = new SupabaseSalesService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\serviceContractService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[972,975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[972,975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2699,2702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2699,2702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3371,3374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3371,3374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4143,4146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4143,4146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10334,10337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10334,10337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":386,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":386,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12830,12833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12830,12833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":428,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14096,14099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14096,14099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":635,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":635,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20721,20724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20721,20724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Contract Supabase Service\r\n * Production implementation using Supabase PostgreSQL\r\n * \r\n * Synchronization: Must match exactly with:\r\n * - Mock service: src/services/serviceContractService.ts\r\n * - Types: src/types/serviceContract.ts\r\n * \r\n * Last Updated: 2025-01-30\r\n * Version: 1.0.0\r\n */\r\n\r\nimport { supabaseClient } from './client';\r\nimport {\r\n  ServiceContractType,\r\n  ServiceContractDocumentType,\r\n  ServiceDeliveryMilestoneType,\r\n  ServiceContractIssueType,\r\n  ServiceContractCreateInput,\r\n  ServiceContractUpdateInput,\r\n  ServiceContractFilters,\r\n  ServiceContractStats,\r\n  ServiceContractDocumentCreateInput,\r\n  ServiceDeliveryMilestoneCreateInput,\r\n  ServiceContractIssueCreateInput,\r\n} from '@/types/serviceContract';\r\nimport { PaginatedResponse } from '@/modules/core/types';\r\n\r\n/**\r\n * Centralized row mapper for database‚ÜíTypeScript field mapping\r\n * CRITICAL: Keep synchronized with database schema\r\n */\r\nfunction mapServiceContractRow(row: any): ServiceContractType {\r\n  return {\r\n    id: row.id,\r\n    contractNumber: row.contract_number,\r\n    title: row.title,\r\n    description: row.description,\r\n    customerId: row.customer_id,\r\n    customerName: row.customer_name,\r\n    productId: row.product_id,\r\n    productName: row.product_name,\r\n    serviceType: row.service_type,\r\n    status: row.status,\r\n    priority: row.priority,\r\n    value: parseFloat(row.value),\r\n    currency: row.currency,\r\n    billingFrequency: row.billing_frequency,\r\n    paymentTerms: row.payment_terms,\r\n    slaTerms: row.sla_terms,\r\n    renewalTerms: row.renewal_terms,\r\n    serviceScope: row.service_scope,\r\n    exclusions: row.exclusions,\r\n    startDate: row.start_date,\r\n    endDate: row.end_date,\r\n    estimatedCompletionDate: row.estimated_completion_date,\r\n    autoRenew: row.auto_renew,\r\n    renewalPeriodMonths: row.renewal_period_months,\r\n    lastRenewalDate: row.last_renewal_date,\r\n    nextRenewalDate: row.next_renewal_date,\r\n    deliverySchedule: row.delivery_schedule,\r\n    scheduledHoursPerWeek: row.scheduled_hours_per_week,\r\n    timeZone: row.time_zone,\r\n    assignedToUserId: row.assigned_to_user_id,\r\n    assignedToName: row.assigned_to_name,\r\n    secondaryContactId: row.secondary_contact_id,\r\n    secondaryContactName: row.secondary_contact_name,\r\n    approvalStatus: row.approval_status,\r\n    approvedByUserId: row.approved_by_user_id,\r\n    approvedAt: row.approved_at,\r\n    complianceNotes: row.compliance_notes,\r\n    tags: row.tags,\r\n    customFields: row.custom_fields,\r\n    createdBy: row.created_by,\r\n    createdAt: row.created_at,\r\n    updatedBy: row.updated_by,\r\n    updatedAt: row.updated_at,\r\n    tenantId: row.tenant_id,\r\n  };\r\n}\r\n\r\nfunction mapDocumentRow(row: any): ServiceContractDocumentType {\r\n  return {\r\n    id: row.id,\r\n    serviceContractId: row.service_contract_id,\r\n    fileName: row.file_name,\r\n    fileType: row.file_type,\r\n    fileSize: row.file_size,\r\n    filePath: row.file_path,\r\n    documentType: row.document_type,\r\n    uploadedByUserId: row.uploaded_by_user_id,\r\n    uploadedByName: row.uploaded_by_name,\r\n    description: row.description,\r\n    tags: row.tags,\r\n    isActive: row.is_active,\r\n    versionNumber: row.version_number,\r\n    parentDocumentId: row.parent_document_id,\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at,\r\n    tenantId: row.tenant_id,\r\n  };\r\n}\r\n\r\nfunction mapMilestoneRow(row: any): ServiceDeliveryMilestoneType {\r\n  return {\r\n    id: row.id,\r\n    serviceContractId: row.service_contract_id,\r\n    milestoneName: row.milestone_name,\r\n    description: row.description,\r\n    sequenceNumber: row.sequence_number,\r\n    plannedDate: row.planned_date,\r\n    actualDate: row.actual_date,\r\n    deliverableDescription: row.deliverable_description,\r\n    acceptanceCriteria: row.acceptance_criteria,\r\n    status: row.status,\r\n    completionPercentage: row.completion_percentage,\r\n    assignedToUserId: row.assigned_to_user_id,\r\n    assignedToName: row.assigned_to_name,\r\n    notes: row.notes,\r\n    dependencies: row.dependencies,\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at,\r\n    tenantId: row.tenant_id,\r\n  };\r\n}\r\n\r\nfunction mapIssueRow(row: any): ServiceContractIssueType {\r\n  return {\r\n    id: row.id,\r\n    serviceContractId: row.service_contract_id,\r\n    issueTitle: row.issue_title,\r\n    issueDescription: row.issue_description,\r\n    severity: row.severity,\r\n    category: row.category,\r\n    status: row.status,\r\n    resolutionNotes: row.resolution_notes,\r\n    resolutionDate: row.resolution_date,\r\n    assignedToUserId: row.assigned_to_user_id,\r\n    assignedToName: row.assigned_to_name,\r\n    reportedDate: row.reported_date,\r\n    targetResolutionDate: row.target_resolution_date,\r\n    impactDescription: row.impact_description,\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at,\r\n    tenantId: row.tenant_id,\r\n  };\r\n}\r\n\r\n/**\r\n * Service Contract Supabase Service\r\n */\r\nexport const supabaseServiceContractService = {\r\n  /**\r\n   * Get service contracts with filtering and pagination\r\n   */\r\n  async getServiceContracts(filters: ServiceContractFilters = {}): Promise<PaginatedResponse<ServiceContractType>> {\r\n    try {\r\n      let query = supabaseClient.from('service_contracts').select('*', { count: 'exact' });\r\n\r\n      // Apply filters\r\n      if (filters.search) {\r\n        const search = filters.search;\r\n        query = query.or(\r\n          `contract_number.ilike.%${search}%,title.ilike.%${search}%,customer_name.ilike.%${search}%,description.ilike.%${search}%`\r\n        );\r\n      }\r\n\r\n      if (filters.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n\r\n      if (filters.serviceType) {\r\n        query = query.eq('service_type', filters.serviceType);\r\n      }\r\n\r\n      if (filters.customerId) {\r\n        query = query.eq('customer_id', filters.customerId);\r\n      }\r\n\r\n      if (filters.assignedTo) {\r\n        query = query.eq('assigned_to_user_id', filters.assignedTo);\r\n      }\r\n\r\n      if (filters.priority) {\r\n        query = query.eq('priority', filters.priority);\r\n      }\r\n\r\n      if (filters.approvalStatus) {\r\n        query = query.eq('approval_status', filters.approvalStatus);\r\n      }\r\n\r\n      if (filters.dateRange) {\r\n        query = query\r\n          .gte('start_date', filters.dateRange.start)\r\n          .lte('start_date', filters.dateRange.end);\r\n      }\r\n\r\n      // Apply sorting\r\n      const sortBy = filters.sortBy || 'created_at';\r\n      const sortOrder = filters.sortOrder === 'asc' ? { ascending: true } : { ascending: false };\r\n      query = query.order(sortBy, sortOrder);\r\n\r\n      // Apply pagination\r\n      const page = filters.page || 1;\r\n      const pageSize = filters.pageSize || 20;\r\n      const startIndex = (page - 1) * pageSize;\r\n\r\n      query = query.range(startIndex, startIndex + pageSize - 1);\r\n\r\n      const { data, error, count } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      return {\r\n        data: (data || []).map(mapServiceContractRow),\r\n        total: count || 0,\r\n        page,\r\n        pageSize,\r\n        totalPages: Math.ceil((count || 0) / pageSize),\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to fetch service contracts', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get single service contract\r\n   */\r\n  async getServiceContract(id: string): Promise<ServiceContractType> {\r\n    try {\r\n      const { data, error } = await supabaseClient\r\n        .from('service_contracts')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      if (!data) throw new Error(`Service contract ${id} not found`);\r\n\r\n      return mapServiceContractRow(data);\r\n    } catch (error) {\r\n      console.error(`Failed to fetch service contract ${id}`, error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Create service contract\r\n   */\r\n  async createServiceContract(data: ServiceContractCreateInput): Promise<ServiceContractType> {\r\n    try {\r\n      // Validate required fields\r\n      if (!data.title || !data.customerId || !data.serviceType) {\r\n        throw new Error('Required fields missing: title, customerId, serviceType');\r\n      }\r\n\r\n      const { data: result, error } = await supabaseClient\r\n        .from('service_contracts')\r\n        .insert([\r\n          {\r\n            contract_number: `SVC-${new Date().getFullYear()}-${String(Math.random()).slice(2, 5)}`,\r\n            title: data.title,\r\n            description: data.description,\r\n            customer_id: data.customerId,\r\n            customer_name: data.customerName,\r\n            product_id: data.productId,\r\n            product_name: data.productName,\r\n            service_type: data.serviceType,\r\n            status: 'draft',\r\n            priority: data.priority || 'medium',\r\n            value: data.value,\r\n            currency: data.currency || 'USD',\r\n            billing_frequency: data.billingFrequency,\r\n            payment_terms: data.paymentTerms,\r\n            sla_terms: data.slaTerms,\r\n            renewal_terms: data.renewalTerms,\r\n            service_scope: data.serviceScope,\r\n            exclusions: data.exclusions,\r\n            start_date: data.startDate,\r\n            end_date: data.endDate,\r\n            estimated_completion_date: data.estimatedCompletionDate,\r\n            auto_renew: data.autoRenew || false,\r\n            renewal_period_months: data.renewalPeriodMonths,\r\n            delivery_schedule: data.deliverySchedule,\r\n            scheduled_hours_per_week: data.scheduledHoursPerWeek,\r\n            time_zone: data.timeZone,\r\n            assigned_to_user_id: data.assignedToUserId,\r\n            assigned_to_name: data.assignedToName,\r\n            secondary_contact_id: data.secondaryContactId,\r\n            secondary_contact_name: data.secondaryContactName,\r\n            tags: data.tags,\r\n            custom_fields: data.customFields,\r\n            created_by: (await supabaseClient.auth.getUser()).data.user?.id,\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return mapServiceContractRow(result);\r\n    } catch (error) {\r\n      console.error('Failed to create service contract', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update service contract\r\n   */\r\n  async updateServiceContract(id: string, data: ServiceContractUpdateInput): Promise<ServiceContractType> {\r\n    try {\r\n      const updateData: any = {};\r\n      const fieldMap: Record<string, string> = {\r\n        title: 'title',\r\n        description: 'description',\r\n        status: 'status',\r\n        priority: 'priority',\r\n        value: 'value',\r\n        currency: 'currency',\r\n        billingFrequency: 'billing_frequency',\r\n        paymentTerms: 'payment_terms',\r\n        slaTerms: 'sla_terms',\r\n        renewalTerms: 'renewal_terms',\r\n        serviceScope: 'service_scope',\r\n        exclusions: 'exclusions',\r\n        startDate: 'start_date',\r\n        endDate: 'end_date',\r\n        estimatedCompletionDate: 'estimated_completion_date',\r\n        autoRenew: 'auto_renew',\r\n        renewalPeriodMonths: 'renewal_period_months',\r\n        deliverySchedule: 'delivery_schedule',\r\n        scheduledHoursPerWeek: 'scheduled_hours_per_week',\r\n        timeZone: 'time_zone',\r\n        assignedToUserId: 'assigned_to_user_id',\r\n        assignedToName: 'assigned_to_name',\r\n        secondaryContactId: 'secondary_contact_id',\r\n        secondaryContactName: 'secondary_contact_name',\r\n        approvalStatus: 'approval_status',\r\n        complianceNotes: 'compliance_notes',\r\n        tags: 'tags',\r\n        customFields: 'custom_fields',\r\n      };\r\n\r\n      Object.entries(data).forEach(([key, value]) => {\r\n        if (value !== undefined && fieldMap[key]) {\r\n          updateData[fieldMap[key]] = value;\r\n        }\r\n      });\r\n\r\n      updateData.updated_by = (await supabaseClient.auth.getUser()).data.user?.id;\r\n      updateData.updated_at = new Date().toISOString();\r\n\r\n      const { data: result, error } = await supabaseClient\r\n        .from('service_contracts')\r\n        .update(updateData)\r\n        .eq('id', id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return mapServiceContractRow(result);\r\n    } catch (error) {\r\n      console.error(`Failed to update service contract ${id}`, error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Delete service contract\r\n   */\r\n  async deleteServiceContract(id: string): Promise<void> {\r\n    try {\r\n      const { error } = await supabaseClient.from('service_contracts').delete().eq('id', id);\r\n      if (error) throw error;\r\n    } catch (error) {\r\n      console.error(`Failed to delete service contract ${id}`, error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update service contract status\r\n   */\r\n  async updateServiceContractStatus(id: string, status: string): Promise<ServiceContractType> {\r\n    return this.updateServiceContract(id, { status: status as any });\r\n  },\r\n\r\n  /**\r\n   * Get service contract statistics\r\n   */\r\n  async getServiceContractStats(): Promise<ServiceContractStats> {\r\n    try {\r\n      const { data: contracts, error } = await supabaseClient\r\n        .from('service_contracts')\r\n        .select('id, status, service_type, value');\r\n\r\n      if (error) throw error;\r\n\r\n      const { data: documents } = await supabaseClient\r\n        .from('service_contract_documents')\r\n        .select('id', { count: 'exact' });\r\n\r\n      const { data: issues } = await supabaseClient\r\n        .from('service_contract_issues')\r\n        .select('id')\r\n        .eq('status', 'open');\r\n\r\n      const { data: milestones } = await supabaseClient\r\n        .from('service_delivery_milestones')\r\n        .select('id')\r\n        .eq('status', 'pending');\r\n\r\n      const stats: ServiceContractStats = {\r\n        total: contracts?.length || 0,\r\n        byStatus: {},\r\n        byServiceType: {},\r\n        activeContracts: 0,\r\n        pendingApprovalContracts: 0,\r\n        expiredContracts: 0,\r\n        totalValue: 0,\r\n        averageValue: 0,\r\n        totalDocuments: documents?.length || 0,\r\n        openIssues: issues?.length || 0,\r\n        upcomingMilestones: milestones?.length || 0,\r\n      };\r\n\r\n      contracts?.forEach((c: any) => {\r\n        stats.byStatus[c.status] = (stats.byStatus[c.status] || 0) + 1;\r\n        stats.byServiceType[c.service_type] = (stats.byServiceType[c.service_type] || 0) + 1;\r\n\r\n        if (c.status === 'active') stats.activeContracts++;\r\n        if (c.status === 'pending_approval') stats.pendingApprovalContracts++;\r\n        if (c.status === 'expired') stats.expiredContracts++;\r\n\r\n        stats.totalValue += parseFloat(c.value) || 0;\r\n      });\r\n\r\n      stats.averageValue = stats.total > 0 ? stats.totalValue / stats.total : 0;\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      console.error('Failed to fetch service contract statistics', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get service contract documents\r\n   */\r\n  async getServiceContractDocuments(contractId: string): Promise<ServiceContractDocumentType[]> {\r\n    try {\r\n      const { data, error } = await supabaseClient\r\n        .from('service_contract_documents')\r\n        .select('*')\r\n        .eq('service_contract_id', contractId)\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return (data || []).map(mapDocumentRow);\r\n    } catch (error) {\r\n      console.error(`Failed to fetch documents for contract ${contractId}`, error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Add document to service contract\r\n   */\r\n  async addServiceContractDocument(data: ServiceContractDocumentCreateInput): Promise<ServiceContractDocumentType> {\r\n    try {\r\n      const { data: result, error } = await supabaseClient\r\n        .from('service_contract_documents')\r\n        .insert([\r\n          {\r\n            service_contract_id: data.serviceContractId,\r\n            file_name: data.fileName,\r\n            file_type: data.fileType,\r\n            file_size: data.fileSize,\r\n            file_path: data.filePath,\r\n            document_type: data.documentType,\r\n            description: data.description,\r\n            tags: data.tags,\r\n            is_active: true,\r\n            version_number: 1,\r\n            uploaded_by_user_id: (await supabaseClient.auth.getUser()).data.user?.id,\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return mapDocumentRow(result);\r\n    } catch (error) {\r\n      console.error('Failed to add document', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get service delivery milestones\r\n   */\r\n  async getServiceDeliveryMilestones(contractId: string): Promise<ServiceDeliveryMilestoneType[]> {\r\n    try {\r\n      const { data, error } = await supabaseClient\r\n        .from('service_delivery_milestones')\r\n        .select('*')\r\n        .eq('service_contract_id', contractId)\r\n        .order('sequence_number', { ascending: true });\r\n\r\n      if (error) throw error;\r\n      return (data || []).map(mapMilestoneRow);\r\n    } catch (error) {\r\n      console.error(`Failed to fetch milestones for contract ${contractId}`, error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Add milestone to service contract\r\n   */\r\n  async addServiceDeliveryMilestone(data: ServiceDeliveryMilestoneCreateInput): Promise<ServiceDeliveryMilestoneType> {\r\n    try {\r\n      const { data: result, error } = await supabaseClient\r\n        .from('service_delivery_milestones')\r\n        .insert([\r\n          {\r\n            service_contract_id: data.serviceContractId,\r\n            milestone_name: data.milestoneName,\r\n            description: data.description,\r\n            sequence_number: data.sequenceNumber,\r\n            planned_date: data.plannedDate,\r\n            deliverable_description: data.deliverableDescription,\r\n            acceptance_criteria: data.acceptanceCriteria,\r\n            status: 'pending',\r\n            completion_percentage: 0,\r\n            assigned_to_user_id: data.assignedToUserId,\r\n            assigned_to_name: data.assignedToName,\r\n            notes: data.notes,\r\n            dependencies: data.dependencies,\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return mapMilestoneRow(result);\r\n    } catch (error) {\r\n      console.error('Failed to add milestone', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get service contract issues\r\n   */\r\n  async getServiceContractIssues(contractId: string): Promise<ServiceContractIssueType[]> {\r\n    try {\r\n      const { data, error } = await supabaseClient\r\n        .from('service_contract_issues')\r\n        .select('*')\r\n        .eq('service_contract_id', contractId)\r\n        .order('severity', { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return (data || []).map(mapIssueRow);\r\n    } catch (error) {\r\n      console.error(`Failed to fetch issues for contract ${contractId}`, error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Add issue to service contract\r\n   */\r\n  async addServiceContractIssue(data: ServiceContractIssueCreateInput): Promise<ServiceContractIssueType> {\r\n    try {\r\n      const { data: result, error } = await supabaseClient\r\n        .from('service_contract_issues')\r\n        .insert([\r\n          {\r\n            service_contract_id: data.serviceContractId,\r\n            issue_title: data.issueTitle,\r\n            issue_description: data.issueDescription,\r\n            severity: data.severity,\r\n            category: data.category,\r\n            status: 'open',\r\n            assigned_to_user_id: data.assignedToUserId,\r\n            assigned_to_name: data.assignedToName,\r\n            reported_date: new Date().toISOString().split('T')[0],\r\n            target_resolution_date: data.targetResolutionDate,\r\n            impact_description: data.impactDescription,\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return mapIssueRow(result);\r\n    } catch (error) {\r\n      console.error('Failed to add issue', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Export service contracts\r\n   */\r\n  async exportServiceContracts(format: 'csv' | 'json' = 'csv'): Promise<string> {\r\n    try {\r\n      const { data: contracts, error } = await supabaseClient\r\n        .from('service_contracts')\r\n        .select('*')\r\n        .limit(10000);\r\n\r\n      if (error) throw error;\r\n\r\n      if (format === 'json') {\r\n        return JSON.stringify((contracts || []).map(mapServiceContractRow), null, 2);\r\n      }\r\n\r\n      // CSV format\r\n      const headers = [\r\n        'ID',\r\n        'Contract Number',\r\n        'Title',\r\n        'Customer',\r\n        'Service Type',\r\n        'Status',\r\n        'Value',\r\n        'Start Date',\r\n        'End Date',\r\n        'Assigned To',\r\n      ];\r\n      const rows = (contracts || []).map((c: any) => [\r\n        c.id,\r\n        c.contract_number,\r\n        c.title,\r\n        c.customer_name,\r\n        c.service_type,\r\n        c.status,\r\n        c.value,\r\n        c.start_date,\r\n        c.end_date,\r\n        c.assigned_to_name || '',\r\n      ]);\r\n\r\n      const csv = [headers, ...rows].map((row) => row.map((cell) => `\"${cell}\"`).join(',')).join('\\r\\n');\r\n\r\n      return csv;\r\n    } catch (error) {\r\n      console.error('Failed to export service contracts', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Bulk update service contracts\r\n   */\r\n  async bulkUpdateServiceContracts(\r\n    ids: string[],\r\n    updates: ServiceContractUpdateInput\r\n  ): Promise<ServiceContractType[]> {\r\n    try {\r\n      const promises = ids.map((id) => this.updateServiceContract(id, updates));\r\n      return await Promise.all(promises);\r\n    } catch (error) {\r\n      console.error('Failed to bulk update service contracts', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Bulk delete service contracts\r\n   */\r\n  async bulkDeleteServiceContracts(ids: string[]): Promise<void> {\r\n    try {\r\n      const { error } = await supabaseClient.from('service_contracts').delete().in('id', ids);\r\n      if (error) throw error;\r\n    } catch (error) {\r\n      console.error('Failed to bulk delete service contracts', error);\r\n      throw error;\r\n    }\r\n  },\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\tenantService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\supabase\\ticketService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6383,6386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6383,6386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7151,7154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7151,7154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":362,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10184,10187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10184,10187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10502,10505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10502,10505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Supabase Ticket Service\r\n * Handles support tickets, comments, attachments\r\n * Extends BaseSupabaseService for common database operations\r\n */\r\n\r\nimport { BaseSupabaseService } from './baseService';\r\nimport { getSupabaseClient } from './client';\r\nimport { Ticket } from '@/types/crm';\r\n\r\nexport interface TicketFilters {\r\n  status?: string;\r\n  priority?: string;\r\n  assignedTo?: string;\r\n  customerId?: string;\r\n  tenantId?: string;\r\n  search?: string;\r\n}\r\n\r\nexport class SupabaseTicketService extends BaseSupabaseService {\r\n  constructor() {\r\n    super('tickets', true);\r\n  }\r\n\r\n  /**\r\n   * Get all tickets with optional filtering\r\n   */\r\n  async getTickets(filters?: TicketFilters): Promise<Ticket[]> {\r\n    try {\r\n      this.log('Fetching tickets', filters);\r\n\r\n      let query = getSupabaseClient()\r\n        .from('tickets')\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          assigned_user:assigned_to(id, first_name, last_name, email),\r\n          comments:ticket_comments(*),\r\n          attachments:ticket_attachments(*)`\r\n        );\r\n\r\n      // Apply filters\r\n      if (filters?.tenantId) {\r\n        query = query.eq('tenant_id', filters.tenantId);\r\n      }\r\n      if (filters?.status) {\r\n        query = query.eq('status', filters.status);\r\n      }\r\n      if (filters?.priority) {\r\n        query = query.eq('priority', filters.priority);\r\n      }\r\n      if (filters?.assignedTo) {\r\n        query = query.eq('assigned_to', filters.assignedTo);\r\n      }\r\n      if (filters?.customerId) {\r\n        query = query.eq('customer_id', filters.customerId);\r\n      }\r\n\r\n      // Exclude deleted records\r\n      query = query.is('deleted_at', null);\r\n\r\n      const { data, error } = await query.order('created_at', {\r\n        ascending: false,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Tickets fetched', { count: data?.length });\r\n      return data?.map((t) => this.mapTicketResponse(t)) || [];\r\n    } catch (error) {\r\n      this.logError('Error fetching tickets', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get ticket by ID\r\n   */\r\n  async getTicket(id: string): Promise<Ticket | null> {\r\n    try {\r\n      this.log('Fetching ticket', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('tickets')\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          assigned_user:assigned_to(id, first_name, last_name, email),\r\n          comments:ticket_comments(*),\r\n          attachments:ticket_attachments(*)`\r\n        )\r\n        .eq('id', id)\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') throw error;\r\n\r\n      return data ? this.mapTicketResponse(data) : null;\r\n    } catch (error) {\r\n      this.logError('Error fetching ticket', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create new ticket\r\n   */\r\n  async createTicket(data: Partial<Ticket>): Promise<Ticket> {\r\n    try {\r\n      this.log('Creating ticket', { customer_id: data.customer_id });\r\n\r\n      const { data: created, error } = await getSupabaseClient()\r\n        .from('tickets')\r\n        .insert([\r\n          {\r\n            ticket_number: data.ticket_number,\r\n            title: data.title,\r\n            description: data.description,\r\n            customer_id: data.customer_id,\r\n            status: data.status || 'open',\r\n            priority: data.priority || 'medium',\r\n            category: data.category || 'general',\r\n            sub_category: data.sub_category,\r\n            assigned_to: data.assigned_to,\r\n            due_date: data.due_date,\r\n            estimated_hours: data.estimated_hours,\r\n            resolution: data.resolution,\r\n            tenant_id: data.tenant_id,\r\n            created_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          assigned_user:assigned_to(id, first_name, last_name, email),\r\n          comments:ticket_comments(*),\r\n          attachments:ticket_attachments(*)`\r\n        )\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Ticket created successfully', { id: created.id });\r\n      return this.mapTicketResponse(created);\r\n    } catch (error) {\r\n      this.logError('Error creating ticket', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update ticket\r\n   */\r\n  async updateTicket(id: string, updates: Partial<Ticket>): Promise<Ticket> {\r\n    try {\r\n      this.log('Updating ticket', { id });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('tickets')\r\n        .update({\r\n          title: updates.title,\r\n          description: updates.description,\r\n          status: updates.status,\r\n          priority: updates.priority,\r\n          category: updates.category,\r\n          sub_category: updates.sub_category,\r\n          assigned_to: updates.assigned_to,\r\n          due_date: updates.due_date,\r\n          resolved_at: updates.resolved_at,\r\n          closed_at: updates.closed_at,\r\n          estimated_hours: updates.estimated_hours,\r\n          actual_hours: updates.actual_hours,\r\n          resolution: updates.resolution,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', id)\r\n        .select(\r\n          `*,\r\n          customer:customers(*),\r\n          assigned_user:assigned_to(id, first_name, last_name, email),\r\n          comments:ticket_comments(*),\r\n          attachments:ticket_attachments(*)`\r\n        )\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Ticket updated successfully', { id });\r\n      return this.mapTicketResponse(data);\r\n    } catch (error) {\r\n      this.logError('Error updating ticket', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete ticket (soft delete)\r\n   */\r\n  async deleteTicket(id: string): Promise<void> {\r\n    try {\r\n      this.log('Deleting ticket', { id });\r\n\r\n      const { error } = await getSupabaseClient()\r\n        .from('tickets')\r\n        .update({ deleted_at: new Date().toISOString() })\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Ticket deleted successfully', { id });\r\n    } catch (error) {\r\n      this.logError('Error deleting ticket', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add comment to ticket\r\n   */\r\n  async addComment(ticketId: string, content: string, userId: string): Promise<any> {\r\n    try {\r\n      this.log('Adding comment to ticket', { ticketId });\r\n\r\n      const { data, error } = await getSupabaseClient()\r\n        .from('ticket_comments')\r\n        .insert([\r\n          {\r\n            ticket_id: ticketId,\r\n            content,\r\n            author_id: userId,\r\n            created_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      this.log('Comment added successfully');\r\n      return data;\r\n    } catch (error) {\r\n      this.logError('Error adding comment', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Upload ticket attachment\r\n   */\r\n  async uploadAttachment(\r\n    ticketId: string,\r\n    file: File,\r\n    uploadedBy: string\r\n  ): Promise<any> {\r\n    try {\r\n      this.log('Uploading attachment', { ticketId, filename: file.name });\r\n\r\n      const client = getSupabaseClient();\r\n      const filePath = `tickets/${ticketId}/${Date.now()}-${file.name}`;\r\n\r\n      // Upload file to storage\r\n      const { error: uploadError } = await client.storage\r\n        .from('attachments')\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      // Create attachment record\r\n      const { data, error: dbError } = await client\r\n        .from('ticket_attachments')\r\n        .insert([\r\n          {\r\n            ticket_id: ticketId,\r\n            filename: file.name,\r\n            file_path: filePath,\r\n            file_size: file.size,\r\n            content_type: file.type,\r\n            uploaded_by: uploadedBy,\r\n            created_at: new Date().toISOString(),\r\n          },\r\n        ])\r\n        .select()\r\n        .single();\r\n\r\n      if (dbError) throw dbError;\r\n\r\n      this.log('Attachment uploaded successfully');\r\n      return data;\r\n    } catch (error) {\r\n      this.logError('Error uploading attachment', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get ticket statistics and SLA metrics\r\n   */\r\n  async getTicketStats(tenantId: string): Promise<{\r\n    total: number;\r\n    open: number;\r\n    closed: number;\r\n    avgResolutionTime: number;\r\n    slaBreach: number;\r\n    byPriority: Record<string, number>;\r\n    byStatus: Record<string, number>;\r\n  }> {\r\n    try {\r\n      this.log('Fetching ticket statistics', { tenantId });\r\n\r\n      const tickets = await this.getTickets({ tenantId });\r\n\r\n      const stats = {\r\n        total: tickets.length,\r\n        open: 0,\r\n        closed: 0,\r\n        avgResolutionTime: 0,\r\n        slaBreach: 0,\r\n        byPriority: {} as Record<string, number>,\r\n        byStatus: {} as Record<string, number>,\r\n      };\r\n\r\n      let totalResolutionTime = 0;\r\n      let resolutionCount = 0;\r\n\r\n      tickets.forEach((t) => {\r\n        // Count by status\r\n        stats.byStatus[t.status] = (stats.byStatus[t.status] || 0) + 1;\r\n        if (t.status === 'open') stats.open++;\r\n        if (t.status === 'closed') stats.closed++;\r\n\r\n        // Count by priority\r\n        stats.byPriority[t.priority] = (stats.byPriority[t.priority] || 0) + 1;\r\n\r\n        // Count SLA breaches\r\n        if (t.is_sla_breached) stats.slaBreach++;\r\n\r\n        // Calculate average resolution time\r\n        if (t.resolved_at) {\r\n          const created = new Date(t.created_at).getTime();\r\n          const resolved = new Date(t.resolved_at).getTime();\r\n          totalResolutionTime += resolved - created;\r\n          resolutionCount++;\r\n        }\r\n      });\r\n\r\n      if (resolutionCount > 0) {\r\n        stats.avgResolutionTime = totalResolutionTime / resolutionCount;\r\n      }\r\n\r\n      return stats;\r\n    } catch (error) {\r\n      this.logError('Error fetching ticket statistics', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to ticket changes\r\n   */\r\n  subscribeToTickets(\r\n    tenantId: string,\r\n    callback: (payload: any) => void\r\n  ): () => void {\r\n    return this.subscribeToChanges(\r\n      {\r\n        event: '*',\r\n        table: 'tickets',\r\n        filter: `tenant_id=eq.${tenantId}`,\r\n      },\r\n      callback\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Map database ticket response to UI Ticket type\r\n   */\r\n  private mapTicketResponse(dbTicket: any): Ticket {\r\n    return {\r\n      id: dbTicket.id,\r\n      ticket_number: dbTicket.ticket_number,\r\n      title: dbTicket.title,\r\n      description: dbTicket.description || '',\r\n      customer_id: dbTicket.customer_id,\r\n      customer_name: dbTicket.customer?.company_name || '',\r\n      customer_email: dbTicket.customer?.email || '',\r\n      customer_phone: dbTicket.customer?.phone || '',\r\n      status: (dbTicket.status || 'open') as Ticket['status'],\r\n      priority: (dbTicket.priority || 'medium') as Ticket['priority'],\r\n      category: (dbTicket.category || 'general') as Ticket['category'],\r\n      sub_category: dbTicket.sub_category || '',\r\n      source: dbTicket.source || '',\r\n      assigned_to: dbTicket.assigned_to,\r\n      assigned_to_name: dbTicket.assigned_user?.first_name\r\n        ? `${dbTicket.assigned_user.first_name} ${dbTicket.assigned_user.last_name}`\r\n        : '',\r\n      reported_by: dbTicket.reported_by || '',\r\n      reported_by_name: dbTicket.reported_by_name || '',\r\n      due_date: dbTicket.due_date,\r\n      resolved_at: dbTicket.resolved_at,\r\n      closed_at: dbTicket.closed_at,\r\n      first_response_date: dbTicket.first_response_date,\r\n      estimated_hours: dbTicket.estimated_hours,\r\n      actual_hours: dbTicket.actual_hours,\r\n      first_response_time: dbTicket.first_response_time,\r\n      resolution_time: dbTicket.resolution_time,\r\n      is_sla_breached: dbTicket.is_sla_breached || false,\r\n      resolution: dbTicket.resolution || '',\r\n      tags: dbTicket.tags || [],\r\n      comments: dbTicket.comments || [],\r\n      attachments: dbTicket.attachments || [],\r\n      tenant_id: dbTicket.tenant_id,\r\n      created_at: dbTicket.created_at,\r\n      updated_at: dbTicket.updated_at,\r\n      created_by: dbTicket.created_by || '',\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const supabaseTicketService = new SupabaseTicketService();","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\superAdminService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\templateService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\tenantService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\testUtils.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[378,381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[378,381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[525,528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[525,528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[900,903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[900,903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3110,3113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3110,3113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5684,5687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5684,5687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8247,8250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8247,8250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10386,10389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10386,10389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":449,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14038,14041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14038,14041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":484,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14891,14894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14891,14894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":486,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14952,14955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14952,14955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":486,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14974,14977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14974,14977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":487,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15018,15021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15018,15021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":532,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":532,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16099,16102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16099,16102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":534,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16141,16144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16141,16144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\ticketService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\uiNotificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\userService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\validationScript.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5681,5684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5681,5684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\services\\whatsAppService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\test\\mocks\\handlers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1268,1271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1268,1271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1513,1516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1513,1516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3033,3036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3033,3036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3340,3343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3340,3343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { http, HttpResponse } from 'msw';\r\n\r\n/**\r\n * MSW (Mock Service Worker) handlers for API mocking in tests\r\n * These handlers intercept fetch/axios calls and return mock responses\r\n */\r\n\r\nexport const handlers = [\r\n  // Sales endpoints\r\n  http.get('/api/sales', () => {\r\n    return HttpResponse.json([\r\n      {\r\n        id: 'deal_1',\r\n        customerId: 'customer_1',\r\n        title: 'Enterprise Deal',\r\n        status: 'negotiation',\r\n        value: 250000,\r\n        probability: 70,\r\n        expectedCloseDate: '2025-03-15',\r\n        tenantId: 'tenant_1',\r\n      },\r\n      {\r\n        id: 'deal_2',\r\n        customerId: 'customer_2',\r\n        title: 'SMB Deal',\r\n        status: 'proposal',\r\n        value: 50000,\r\n        probability: 40,\r\n        expectedCloseDate: '2025-02-28',\r\n        tenantId: 'tenant_1',\r\n      },\r\n    ]);\r\n  }),\r\n\r\n  http.get('/api/sales/:id', ({ params }) => {\r\n    return HttpResponse.json({\r\n      id: params.id,\r\n      customerId: 'customer_1',\r\n      title: 'Test Deal',\r\n      status: 'negotiation',\r\n      value: 100000,\r\n      probability: 60,\r\n      expectedCloseDate: '2025-03-15',\r\n      tenantId: 'tenant_1',\r\n    });\r\n  }),\r\n\r\n  http.post('/api/sales', async ({ request }) => {\r\n    const body = await request.json() as any;\r\n    return HttpResponse.json({\r\n      id: `deal_${Date.now()}`,\r\n      ...body,\r\n      createdAt: new Date().toISOString(),\r\n    });\r\n  }),\r\n\r\n  http.put('/api/sales/:id', async ({ request }) => {\r\n    const body = await request.json() as any;\r\n    return HttpResponse.json({\r\n      id: 'deal_1',\r\n      ...body,\r\n      updatedAt: new Date().toISOString(),\r\n    });\r\n  }),\r\n\r\n  http.delete('/api/sales/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  // Sales stats endpoint\r\n  http.get('/api/sales/stats', () => {\r\n    return HttpResponse.json({\r\n      totalDeals: 150,\r\n      closedDeals: 45,\r\n      totalRevenue: 1500000,\r\n      averageDealValue: 10000,\r\n      conversionRate: 30,\r\n      pipelineValue: 3000000,\r\n    });\r\n  }),\r\n\r\n  // Deal stages endpoint\r\n  http.get('/api/sales/stages', () => {\r\n    return HttpResponse.json([\r\n      { id: 'stage_1', name: 'Lead', color: '#E8F4F8', probability: 10 },\r\n      { id: 'stage_2', name: 'Qualification', color: '#D0E8F2', probability: 25 },\r\n      { id: 'stage_3', name: 'Proposal', color: '#B8DDE8', probability: 50 },\r\n      { id: 'stage_4', name: 'Negotiation', color: '#80C8E0', probability: 75 },\r\n      { id: 'stage_5', name: 'Closed Won', color: '#3DBF6B', probability: 100 },\r\n    ]);\r\n  }),\r\n\r\n  // Search deals endpoint\r\n  http.get('/api/sales/search', ({ request }) => {\r\n    const url = new URL(request.url);\r\n    const query = url.searchParams.get('q');\r\n\r\n    return HttpResponse.json([\r\n      {\r\n        id: 'deal_search_1',\r\n        title: `Result for \"${query}\"`,\r\n        value: 50000,\r\n        status: 'proposal',\r\n      },\r\n    ]);\r\n  }),\r\n\r\n  // Bulk operations\r\n  http.put('/api/sales/bulk', async ({ request }) => {\r\n    const body = await request.json() as any;\r\n    const dealCount = Array.isArray(body.deals) ? body.deals.length : 0;\r\n\r\n    return HttpResponse.json({\r\n      successCount: dealCount,\r\n      failureCount: 0,\r\n      errors: [],\r\n    });\r\n  }),\r\n\r\n  http.delete('/api/sales/bulk', async ({ request }) => {\r\n    const body = await request.json() as any;\r\n    const dealCount = Array.isArray(body.ids) ? body.ids.length : 0;\r\n\r\n    return HttpResponse.json({\r\n      successCount: dealCount,\r\n      failureCount: 0,\r\n      errors: [],\r\n    });\r\n  }),\r\n\r\n  // Export/Import endpoints\r\n  http.get('/api/sales/export', () => {\r\n    return HttpResponse.text('id,title,value,status\\ndeal_1,Test Deal,100000,closed');\r\n  }),\r\n\r\n  http.post('/api/sales/import', async ({ request }) => {\r\n    const formData = await request.formData();\r\n    return HttpResponse.json({\r\n      importedCount: 10,\r\n      failedCount: 0,\r\n      errors: [],\r\n    });\r\n  }),\r\n];","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\test\\mocks\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\test\\setup.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1001,1004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1001,1004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1142,1145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1142,1145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@testing-library/jest-dom';\r\nimport { expect, afterEach, vi, beforeAll, afterAll } from 'vitest';\r\nimport { cleanup } from '@testing-library/react';\r\n\r\n// Setup environment variables for testing\r\nprocess.env.VITE_API_MODE = 'mock';\r\nprocess.env.VITE_SUPABASE_URL = 'http://localhost:54321';\r\nprocess.env.VITE_SUPABASE_ANON_KEY = 'test-key';\r\n\r\n// Cleanup after each test\r\nafterEach(() => {\r\n  cleanup();\r\n});\r\n\r\n// Mock window.matchMedia\r\nObject.defineProperty(window, 'matchMedia', {\r\n  writable: true,\r\n  value: vi.fn().mockImplementation((query) => ({\r\n    matches: false,\r\n    media: query,\r\n    onchange: null,\r\n    addListener: vi.fn(),\r\n    removeListener: vi.fn(),\r\n    addEventListener: vi.fn(),\r\n    removeEventListener: vi.fn(),\r\n    dispatchEvent: vi.fn(),\r\n  })),\r\n});\r\n\r\n// Mock IntersectionObserver\r\nglobal.IntersectionObserver = class IntersectionObserver {\r\n  constructor() {}\r\n  disconnect() {}\r\n  observe() {}\r\n  takeRecords() {\r\n    return [];\r\n  }\r\n  unobserve() {}\r\n} as any;\r\n\r\n// Suppress console errors in tests (optional)\r\nconst originalError = console.error;\r\nbeforeAll(() => {\r\n  console.error = (...args: any[]) => {\r\n    if (\r\n      typeof args[0] === 'string' &&\r\n      args[0].includes('Warning: ReactDOM.render')\r\n    ) {\r\n      return;\r\n    }\r\n    originalError.call(console, ...args);\r\n  };\r\n});\r\n\r\nafterAll(() => {\r\n  console.error = originalError;\r\n});","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\theme\\antdTheme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\complaints.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\contracts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\crm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\dtos\\commonDtos.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[911,914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[911,914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1191,1194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1191,1194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4855,4858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4855,4858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4870,4873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4870,4873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Common DTO Types\r\n * Shared DTOs and interfaces used across all services\r\n * Ensures consistent data structures for all API responses\r\n */\r\n\r\n/**\r\n * Standard paginated response format\r\n * Used by all list endpoints for consistency\r\n */\r\nexport interface PaginatedResponseDTO<T> {\r\n  /** Array of data items */\r\n  data: T[];\r\n  \r\n  /** Current page number (1-indexed) */\r\n  page: number;\r\n  \r\n  /** Number of items per page */\r\n  pageSize: number;\r\n  \r\n  /** Total number of items across all pages */\r\n  total: number;\r\n  \r\n  /** Total number of pages */\r\n  totalPages: number;\r\n  \r\n  /** Whether there's a next page */\r\n  hasNextPage: boolean;\r\n  \r\n  /** Whether there's a previous page */\r\n  hasPreviousPage: boolean;\r\n}\r\n\r\n/**\r\n * Standard stats/metrics response format\r\n * Used by all statistics endpoints\r\n */\r\nexport interface StatsResponseDTO {\r\n  [key: string]: number | string | Record<string, any>;\r\n}\r\n\r\n/**\r\n * Standard error response format\r\n */\r\nexport interface ApiErrorDTO {\r\n  /** Error code (e.g., 'VALIDATION_ERROR', 'NOT_FOUND') */\r\n  code: string;\r\n  \r\n  /** User-friendly error message */\r\n  message: string;\r\n  \r\n  /** Additional error details */\r\n  details?: any;\r\n  \r\n  /** Timestamp when error occurred */\r\n  timestamp: string;\r\n  \r\n  /** HTTP status code */\r\n  statusCode?: number;\r\n}\r\n\r\n/**\r\n * Filter base interface for common filtering parameters\r\n */\r\nexport interface BaseFiltersDTO {\r\n  /** Search query string */\r\n  search?: string;\r\n  \r\n  /** Tenant ID for multi-tenant filtering */\r\n  tenantId?: string;\r\n  \r\n  /** Date range filtering */\r\n  dateRange?: {\r\n    from: string;\r\n    to: string;\r\n  };\r\n  \r\n  /** Sort field */\r\n  sortBy?: string;\r\n  \r\n  /** Sort direction: 'asc' or 'desc' */\r\n  sortDirection?: 'asc' | 'desc';\r\n  \r\n  /** Page number for pagination */\r\n  page?: number;\r\n  \r\n  /** Items per page */\r\n  pageSize?: number;\r\n}\r\n\r\n/**\r\n * Audit metadata included in all records\r\n */\r\nexport interface AuditMetadataDTO {\r\n  /** Record creation timestamp (ISO 8601) */\r\n  createdAt: string;\r\n  \r\n  /** User ID who created the record */\r\n  createdBy: string;\r\n  \r\n  /** Record last update timestamp (ISO 8601) */\r\n  updatedAt: string;\r\n  \r\n  /** User ID who last updated the record */\r\n  updatedBy: string;\r\n  \r\n  /** Soft delete timestamp (null if not deleted) */\r\n  deletedAt?: string | null;\r\n  \r\n  /** User ID who deleted the record */\r\n  deletedBy?: string;\r\n  \r\n  /** Version number for optimistic concurrency control */\r\n  version: number;\r\n}\r\n\r\n/**\r\n * Status enumeration - used consistently across modules\r\n */\r\nexport type EntityStatus = 'active' | 'inactive' | 'pending' | 'archived' | 'suspended';\r\n\r\n/**\r\n * Priority enumeration - used for prioritization across modules\r\n */\r\nexport type PriorityLevel = 'low' | 'medium' | 'high' | 'critical';\r\n\r\n/**\r\n * Success response wrapper\r\n */\r\nexport interface SuccessResponseDTO<T> {\r\n  /** Success flag */\r\n  success: true;\r\n  \r\n  /** Response data */\r\n  data: T;\r\n  \r\n  /** Optional message */\r\n  message?: string;\r\n}\r\n\r\n/**\r\n * Error response wrapper\r\n */\r\nexport interface ErrorResponseDTO {\r\n  /** Success flag */\r\n  success: false;\r\n  \r\n  /** Error details */\r\n  error: ApiErrorDTO;\r\n}\r\n\r\n/**\r\n * Generic response type\r\n */\r\nexport type ApiResponseDTO<T> = SuccessResponseDTO<T> | ErrorResponseDTO;\r\n\r\n/**\r\n * Multi-select option for dropdowns and filters\r\n */\r\nexport interface SelectOptionDTO {\r\n  label: string;\r\n  value: string | number;\r\n  disabled?: boolean;\r\n}\r\n\r\n/**\r\n * Key-value metric for charts and analytics\r\n */\r\nexport interface MetricDTO {\r\n  label: string;\r\n  value: number;\r\n  percentage?: number;\r\n  trend?: 'up' | 'down' | 'neutral';\r\n  trendValue?: number;\r\n}\r\n\r\n/**\r\n * Chart data for analytics\r\n */\r\nexport interface ChartDataDTO {\r\n  labels: string[];\r\n  datasets: {\r\n    label: string;\r\n    data: number[];\r\n    backgroundColor?: string;\r\n    borderColor?: string;\r\n  }[];\r\n}\r\n\r\n/**\r\n * Time series data point\r\n */\r\nexport interface TimeSeriesDataDTO {\r\n  timestamp: string;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * Distribution data (for pie charts, etc.)\r\n */\r\nexport interface DistributionDTO {\r\n  [key: string]: number;\r\n}\r\n\r\n/**\r\n * User basic info - used in audit trails and assignments\r\n */\r\nexport interface UserBasicDTO {\r\n  id: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  profileImageUrl?: string;\r\n}\r\n\r\n/**\r\n * Attachment/File info\r\n */\r\nexport interface AttachmentDTO {\r\n  id: string;\r\n  fileName: string;\r\n  fileUrl: string;\r\n  fileType: string;\r\n  fileSize: number;\r\n  uploadedAt: string;\r\n  uploadedBy: string;\r\n}\r\n\r\n/**\r\n * Activity/Event log entry\r\n */\r\nexport interface ActivityLogDTO {\r\n  id: string;\r\n  entityType: string;\r\n  entityId: string;\r\n  action: 'create' | 'update' | 'delete' | 'view' | 'download';\r\n  description: string;\r\n  changedFields?: Record<string, { oldValue: any; newValue: any }>;\r\n  performedBy: UserBasicDTO;\r\n  performedAt: string;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\dtos\\customerDtos.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\dtos\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\dtos\\productSalesDtos.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3073,3076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3073,3076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5537,5540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5537,5540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5930,5933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5930,5933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Sales Service DTOs\r\n * Standardized data transfer objects for product sales operations\r\n * Ensures consistent field naming across mock and Supabase implementations\r\n */\r\n\r\nimport { AuditMetadataDTO, PaginatedResponseDTO, DistributionDTO, PriorityLevel, AttachmentDTO } from './commonDtos';\r\n\r\n/**\r\n * Product Sale Status Enumeration\r\n */\r\nexport type ProductSaleStatus = 'draft' | 'pending' | 'confirmed' | 'delivered' | 'invoiced' | 'paid' | 'cancelled';\r\n\r\n/**\r\n * Product Sale Item DTO\r\n * Individual item/line in a product sale\r\n */\r\nexport interface ProductSaleItemDTO {\r\n  id: string;\r\n  productId: string;\r\n  productName: string;\r\n  quantity: number;\r\n  unitPrice: number;\r\n  discount?: number;\r\n  tax?: number;\r\n  totalAmount: number;\r\n  description?: string;\r\n  serialNumber?: string;\r\n  warrantyExpiry?: string;\r\n}\r\n\r\n/**\r\n * Product Sale DTO\r\n * Complete product sale transaction information\r\n * \r\n * STANDARDIZED FIELD NAMES:\r\n * - totalSales (not: total, count)\r\n * - completedSales (not: completed, done)\r\n * - totalCost (not: amount, price)\r\n * - itemCount (not: items_count, num_items)\r\n */\r\nexport interface ProductSaleDTO {\r\n  /** Unique product sale identifier */\r\n  id: string;\r\n  \r\n  /** Sale date (ISO 8601) */\r\n  saleDate: string;\r\n  \r\n  /** Associated customer ID */\r\n  customerId: string;\r\n  \r\n  /** Customer name (denormalized) */\r\n  customerName: string;\r\n  \r\n  /** Customer email (denormalized) */\r\n  customerEmail?: string;\r\n  \r\n  /** Sale status */\r\n  status: ProductSaleStatus;\r\n  \r\n  /** List of items in this sale */\r\n  items: ProductSaleItemDTO[];\r\n  \r\n  /** Total number of items */\r\n  itemCount: number;\r\n  \r\n  /** Total sale amount (before tax and discount) */\r\n  subtotal: number;\r\n  \r\n  /** Discount amount */\r\n  discountAmount?: number;\r\n  \r\n  /** Discount percentage */\r\n  discountPercentage?: number;\r\n  \r\n  /** Tax amount */\r\n  taxAmount?: number;\r\n  \r\n  /** Total cost including tax */\r\n  totalCost: number;\r\n  \r\n  /** Currency code (ISO 4217) */\r\n  currency?: string;\r\n  \r\n  /** Payment method: cash, card, check, transfer, etc. */\r\n  paymentMethod?: string;\r\n  \r\n  /** Expected delivery date */\r\n  deliveryDate?: string;\r\n  \r\n  /** Actual delivery date */\r\n  actualDeliveryDate?: string;\r\n  \r\n  /** Delivery address */\r\n  deliveryAddress?: string;\r\n  \r\n  /** Delivery city */\r\n  deliveryCity?: string;\r\n  \r\n  /** Delivery state */\r\n  deliveryState?: string;\r\n  \r\n  /** Delivery country */\r\n  deliveryCountry?: string;\r\n  \r\n  /** Warranty expiry date */\r\n  warrantyExpiry?: string;\r\n  \r\n  /** Sale notes */\r\n  notes?: string;\r\n  \r\n  /** Invoice number/reference */\r\n  invoiceNumber?: string;\r\n  \r\n  /** Invoice date */\r\n  invoiceDate?: string;\r\n  \r\n  /** Invoice PDF URL */\r\n  invoicePdfUrl?: string;\r\n  \r\n  /** Sales representative ID */\r\n  salesRep?: string;\r\n  \r\n  /** Tags for categorization */\r\n  tags?: string[];\r\n  \r\n  /** Attachments */\r\n  attachments?: AttachmentDTO[];\r\n  \r\n  /** Contract generated from this sale */\r\n  contractId?: string;\r\n  \r\n  /** Custom fields */\r\n  customFields?: Record<string, any>;\r\n  \r\n  /** Tenant ID for multi-tenant support */\r\n  tenantId: string;\r\n  \r\n  /** Audit metadata */\r\n  audit: AuditMetadataDTO;\r\n}\r\n\r\n/**\r\n * Product Sales Analytics DTO\r\n * Key metrics and analytics for product sales\r\n * \r\n * STANDARDIZED FIELD NAMES:\r\n * - totalSales (not: total, count)\r\n * - completedSales (not: completed, done)\r\n * - pendingSales (not: pending, incomplete)\r\n * - totalRevenue (not: revenue, total_amount)\r\n * - averageSaleValue (not: avg_value, average_amount)\r\n */\r\nexport interface ProductSalesAnalyticsDTO {\r\n  /** Total number of sales */\r\n  totalSales: number;\r\n  \r\n  /** Number of completed sales */\r\n  completedSales: number;\r\n  \r\n  /** Number of pending sales */\r\n  pendingSales: number;\r\n  \r\n  /** Number of cancelled sales */\r\n  cancelledSales?: number;\r\n  \r\n  /** Total revenue from all sales */\r\n  totalRevenue: number;\r\n  \r\n  /** Average sale value */\r\n  averageSaleValue: number;\r\n  \r\n  /** Total quantity of items sold */\r\n  totalQuantity: number;\r\n  \r\n  /** New sales this month */\r\n  newSalesThisMonth?: number;\r\n  \r\n  /** Revenue this month */\r\n  revenueThisMonth?: number;\r\n  \r\n  /** Month-over-month growth percentage */\r\n  monthlyGrowth?: number;\r\n  \r\n  /** Sales by status distribution */\r\n  byStatus: DistributionDTO;\r\n  \r\n  /** Top selling products */\r\n  topProducts?: Array<{\r\n    productId: string;\r\n    productName: string;\r\n    quantity: number;\r\n    revenue: number;\r\n  }>;\r\n  \r\n  /** Sales by customer (top customers) */\r\n  topCustomers?: Array<{\r\n    customerId: string;\r\n    customerName: string;\r\n    totalSales: number;\r\n    revenue: number;\r\n  }>;\r\n  \r\n  /** Revenue by month (last 12 months) */\r\n  revenueByMonth?: Record<string, number>;\r\n  \r\n  /** Sales by product category */\r\n  byProductCategory?: DistributionDTO;\r\n  \r\n  /** Delivery performance */\r\n  onTimeDeliveryRate?: number;\r\n  \r\n  /** Average delivery time (days) */\r\n  averageDeliveryDays?: number;\r\n  \r\n  /** Last updated timestamp */\r\n  lastUpdated: string;\r\n}\r\n\r\n/**\r\n * Create Product Sale Request DTO\r\n */\r\nexport interface CreateProductSaleDTO {\r\n  saleDate?: string;\r\n  customerId: string;\r\n  items: Omit<ProductSaleItemDTO, 'id'>[];\r\n  discountAmount?: number;\r\n  discountPercentage?: number;\r\n  paymentMethod?: string;\r\n  deliveryDate?: string;\r\n  deliveryAddress?: string;\r\n  deliveryCity?: string;\r\n  deliveryState?: string;\r\n  deliveryCountry?: string;\r\n  notes?: string;\r\n  tags?: string[];\r\n  customFields?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Update Product Sale Request DTO\r\n */\r\nexport interface UpdateProductSaleDTO {\r\n  status?: ProductSaleStatus;\r\n  items?: Omit<ProductSaleItemDTO, 'id'>[];\r\n  discountAmount?: number;\r\n  discountPercentage?: number;\r\n  deliveryDate?: string;\r\n  actualDeliveryDate?: string;\r\n  deliveryAddress?: string;\r\n  notes?: string;\r\n  tags?: string[];\r\n  customFields?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Product Sale Filters DTO\r\n */\r\nexport interface ProductSaleFiltersDTO {\r\n  search?: string;\r\n  customerId?: string;\r\n  status?: ProductSaleStatus | ProductSaleStatus[];\r\n  minAmount?: number;\r\n  maxAmount?: number;\r\n  dateRange?: {\r\n    from: string;\r\n    to: string;\r\n  };\r\n  deliveryDateRange?: {\r\n    from: string;\r\n    to: string;\r\n  };\r\n  warrantyStatus?: 'active' | 'expiring_soon' | 'expired';\r\n  paymentMethod?: string;\r\n  productId?: string;\r\n  tags?: string[];\r\n  tenantId?: string;\r\n  page?: number;\r\n  pageSize?: number;\r\n  sortBy?: 'saleDate' | 'totalCost' | 'status' | 'createdAt';\r\n  sortDirection?: 'asc' | 'desc';\r\n}\r\n\r\n/**\r\n * Product Sale List Response DTO\r\n */\r\nexport type ProductSaleListResponseDTO = PaginatedResponseDTO<ProductSaleDTO>;\r\n\r\n/**\r\n * Bulk Product Sale Update DTO\r\n */\r\nexport interface BulkProductSaleUpdateDTO {\r\n  saleIds: string[];\r\n  status?: ProductSaleStatus;\r\n  tags?: string[];\r\n}\r\n\r\n/**\r\n * Bulk Product Sale Delete DTO\r\n */\r\nexport interface BulkProductSaleDeleteDTO {\r\n  saleIds: string[];\r\n  reason?: string;\r\n}\r\n\r\n/**\r\n * Invoice Generation DTO\r\n */\r\nexport interface GenerateInvoiceDTO {\r\n  productSaleId: string;\r\n  invoiceNumber?: string;\r\n  invoiceDate?: string;\r\n  format?: 'pdf' | 'html' | 'json';\r\n}\r\n\r\n/**\r\n * Sales Report DTO\r\n */\r\nexport interface SalesReportDTO {\r\n  period: string; // 'daily', 'weekly', 'monthly', 'quarterly', 'yearly'\r\n  startDate: string;\r\n  endDate: string;\r\n  totalSales: number;\r\n  totalRevenue: number;\r\n  averageOrderValue: number;\r\n  topProducts: ProductSaleDTO[];\r\n  topCustomers: CustomerSalesSummaryDTO[];\r\n  trends: TrendDataDTO[];\r\n}\r\n\r\n/**\r\n * Trend Data DTO\r\n */\r\nexport interface TrendDataDTO {\r\n  date: string;\r\n  sales: number;\r\n  revenue: number;\r\n  quantity: number;\r\n}\r\n\r\n/**\r\n * Customer Sales Summary DTO\r\n */\r\nexport interface CustomerSalesSummaryDTO {\r\n  customerId: string;\r\n  customerName: string;\r\n  totalSales: number;\r\n  totalRevenue: number;\r\n  averageOrderValue: number;\r\n  lastPurchaseDate?: string;\r\n}\r\n\r\n/**\r\n * Payment Reconciliation DTO\r\n */\r\nexport interface PaymentReconciliationDTO {\r\n  productSaleId: string;\r\n  expectedAmount: number;\r\n  receivedAmount: number;\r\n  paymentStatus: 'pending' | 'partial' | 'complete' | 'overdue';\r\n  lastPaymentDate?: string;\r\n  dueDate?: string;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\dtos\\salesDtos.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\dtos\\ticketDtos.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\global.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\jobWork.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\logs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\masters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\pdfTemplates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\productSales.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\rbac.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\serviceContract.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2222,2225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2222,2225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5338,5341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5338,5341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6441,6444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6441,6444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7239,7242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7239,7242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Contract Types\r\n * Complete TypeScript type definitions for the Service Contract module\r\n * \r\n * Synchronization: These types must align exactly with:\r\n * - Database schema: supabase/migrations/20250130000018_*.sql\r\n * - Mock service: src/services/serviceContractService.ts\r\n * - Supabase service: src/services/supabase/serviceContractService.ts\r\n * \r\n * Last Updated: 2025-01-30\r\n * Version: 1.0.0\r\n */\r\n\r\nimport { z } from 'zod';\r\n\r\n/**\r\n * ============================================================\r\n * Core Service Contract Type\r\n * ============================================================\r\n * Matches database table: service_contracts\r\n */\r\nexport interface ServiceContractType {\r\n  // Identification\r\n  id: string;\r\n  contractNumber: string;\r\n  title: string;\r\n  description?: string;\r\n\r\n  // Related Entities\r\n  customerId: string;\r\n  customerName: string;\r\n  productId?: string;\r\n  productName?: string;\r\n\r\n  // Service Details\r\n  serviceType: 'support' | 'maintenance' | 'consulting' | 'training' | 'hosting' | 'custom';\r\n  status: 'draft' | 'pending_approval' | 'active' | 'on_hold' | 'completed' | 'cancelled' | 'expired';\r\n  priority: 'low' | 'medium' | 'high' | 'urgent';\r\n\r\n  // Financial\r\n  value: number;\r\n  currency: string;\r\n  billingFrequency?: 'monthly' | 'quarterly' | 'annually' | 'one_time';\r\n  paymentTerms?: string;\r\n\r\n  // Service Delivery Terms\r\n  slaTerms?: string;\r\n  renewalTerms?: string;\r\n  serviceScope?: string;\r\n  exclusions?: string;\r\n\r\n  // Dates\r\n  startDate: string;\r\n  endDate: string;\r\n  estimatedCompletionDate?: string;\r\n\r\n  // Renewal\r\n  autoRenew: boolean;\r\n  renewalPeriodMonths?: number;\r\n  lastRenewalDate?: string;\r\n  nextRenewalDate?: string;\r\n\r\n  // Scheduling\r\n  deliverySchedule?: string;\r\n  scheduledHoursPerWeek?: number;\r\n  timeZone?: string;\r\n\r\n  // Assignment\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  secondaryContactId?: string;\r\n  secondaryContactName?: string;\r\n\r\n  // Approval & Compliance\r\n  approvalStatus?: 'approved' | 'rejected' | 'pending' | 'in_review';\r\n  approvedByUserId?: string;\r\n  approvedAt?: string;\r\n  complianceNotes?: string;\r\n\r\n  // Organization\r\n  tags?: string[];\r\n  customFields?: Record<string, any>;\r\n\r\n  // Audit\r\n  createdBy: string;\r\n  createdAt: string;\r\n  updatedBy?: string;\r\n  updatedAt: string;\r\n  deletedAt?: string;\r\n  tenantId: string;\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Service Contract Document Type\r\n * ============================================================\r\n * Matches database table: service_contract_documents\r\n */\r\nexport interface ServiceContractDocumentType {\r\n  id: string;\r\n  serviceContractId: string;\r\n  fileName: string;\r\n  fileType: 'pdf' | 'doc' | 'docx' | 'xlsx' | 'xls' | 'pptx' | 'txt' | 'jpg' | 'png' | 'gif' | 'other';\r\n  fileSize: number;\r\n  filePath: string;\r\n  documentType: 'sla_document' | 'schedule' | 'attachment' | 'email' | 'signed_contract' | 'amendment' | 'other';\r\n  uploadedByUserId?: string;\r\n  uploadedByName?: string;\r\n  description?: string;\r\n  tags?: string[];\r\n  isActive: boolean;\r\n  versionNumber: number;\r\n  parentDocumentId?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  deletedAt?: string;\r\n  tenantId: string;\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Service Delivery Milestone Type\r\n * ============================================================\r\n * Matches database table: service_delivery_milestones\r\n */\r\nexport interface ServiceDeliveryMilestoneType {\r\n  id: string;\r\n  serviceContractId: string;\r\n  milestoneName: string;\r\n  description?: string;\r\n  sequenceNumber: number;\r\n  plannedDate?: string;\r\n  actualDate?: string;\r\n  deliverableDescription?: string;\r\n  acceptanceCriteria?: string;\r\n  status: 'pending' | 'in_progress' | 'completed' | 'delayed' | 'cancelled';\r\n  completionPercentage: number;\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  notes?: string;\r\n  dependencies?: string[];\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  tenantId: string;\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Service Contract Issue Type\r\n * ============================================================\r\n * Matches database table: service_contract_issues\r\n */\r\nexport interface ServiceContractIssueType {\r\n  id: string;\r\n  serviceContractId: string;\r\n  issueTitle: string;\r\n  issueDescription?: string;\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  category: 'sla_breach' | 'resource' | 'schedule' | 'scope' | 'budget' | 'other';\r\n  status: 'open' | 'in_progress' | 'resolved' | 'closed' | 'cancelled';\r\n  resolutionNotes?: string;\r\n  resolutionDate?: string;\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  reportedDate: string;\r\n  targetResolutionDate?: string;\r\n  impactDescription?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  tenantId: string;\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Service Contract Activity Log Type\r\n * ============================================================\r\n * Matches database table: service_contract_activity_log\r\n */\r\nexport interface ServiceContractActivityLogType {\r\n  id: string;\r\n  serviceContractId: string;\r\n  activityType: string;\r\n  activityDescription?: string;\r\n  changes?: Record<string, any>;\r\n  userId?: string;\r\n  userName?: string;\r\n  activityDate: string;\r\n  tenantId: string;\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Input Types for CRUD Operations\r\n * ============================================================\r\n */\r\n\r\nexport interface ServiceContractCreateInput {\r\n  title: string;\r\n  description?: string;\r\n  customerId: string;\r\n  customerName: string;\r\n  productId?: string;\r\n  productName?: string;\r\n  serviceType: string;\r\n  priority?: string;\r\n  value: number;\r\n  currency?: string;\r\n  billingFrequency?: string;\r\n  paymentTerms?: string;\r\n  slaTerms?: string;\r\n  renewalTerms?: string;\r\n  serviceScope?: string;\r\n  exclusions?: string;\r\n  startDate: string;\r\n  endDate: string;\r\n  estimatedCompletionDate?: string;\r\n  autoRenew?: boolean;\r\n  renewalPeriodMonths?: number;\r\n  deliverySchedule?: string;\r\n  scheduledHoursPerWeek?: number;\r\n  timeZone?: string;\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  secondaryContactId?: string;\r\n  secondaryContactName?: string;\r\n  tags?: string[];\r\n  customFields?: Record<string, any>;\r\n}\r\n\r\nexport interface ServiceContractUpdateInput {\r\n  title?: string;\r\n  description?: string;\r\n  status?: string;\r\n  priority?: string;\r\n  value?: number;\r\n  currency?: string;\r\n  billingFrequency?: string;\r\n  paymentTerms?: string;\r\n  slaTerms?: string;\r\n  renewalTerms?: string;\r\n  serviceScope?: string;\r\n  exclusions?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  estimatedCompletionDate?: string;\r\n  autoRenew?: boolean;\r\n  renewalPeriodMonths?: number;\r\n  deliverySchedule?: string;\r\n  scheduledHoursPerWeek?: number;\r\n  timeZone?: string;\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  secondaryContactId?: string;\r\n  secondaryContactName?: string;\r\n  approvalStatus?: string;\r\n  complianceNotes?: string;\r\n  tags?: string[];\r\n  customFields?: Record<string, any>;\r\n}\r\n\r\nexport interface ServiceContractDocumentCreateInput {\r\n  serviceContractId: string;\r\n  fileName: string;\r\n  fileType: string;\r\n  fileSize: number;\r\n  filePath: string;\r\n  documentType: string;\r\n  description?: string;\r\n  tags?: string[];\r\n}\r\n\r\nexport interface ServiceDeliveryMilestoneCreateInput {\r\n  serviceContractId: string;\r\n  milestoneName: string;\r\n  description?: string;\r\n  sequenceNumber: number;\r\n  plannedDate?: string;\r\n  deliverableDescription?: string;\r\n  acceptanceCriteria?: string;\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  notes?: string;\r\n  dependencies?: string[];\r\n}\r\n\r\nexport interface ServiceContractIssueCreateInput {\r\n  serviceContractId: string;\r\n  issueTitle: string;\r\n  issueDescription?: string;\r\n  severity: string;\r\n  category: string;\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  targetResolutionDate?: string;\r\n  impactDescription?: string;\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Filter Types\r\n * ============================================================\r\n */\r\n\r\nexport interface ServiceContractFilters {\r\n  search?: string;\r\n  status?: string;\r\n  serviceType?: string;\r\n  customerId?: string;\r\n  customerName?: string;\r\n  assignedTo?: string;\r\n  priority?: string;\r\n  approvalStatus?: string;\r\n  dateRange?: { start: string; end: string };\r\n  page?: number;\r\n  pageSize?: number;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Statistics Types\r\n * ============================================================\r\n */\r\n\r\nexport interface ServiceContractStats {\r\n  total: number;\r\n  byStatus: Record<string, number>;\r\n  byServiceType: Record<string, number>;\r\n  activeContracts: number;\r\n  pendingApprovalContracts: number;\r\n  expiredContracts: number;\r\n  totalValue: number;\r\n  averageValue: number;\r\n  totalDocuments: number;\r\n  openIssues: number;\r\n  upcomingMilestones: number;\r\n}\r\n\r\nexport interface ServiceContractDashboardData {\r\n  stats: ServiceContractStats;\r\n  recentContracts: ServiceContractType[];\r\n  upcomingRenewals: ServiceContractType[];\r\n  pendingApprovals: ServiceContractType[];\r\n  openIssues: ServiceContractIssueType[];\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Wizard Form Step Types\r\n * ============================================================\r\n * For multi-step form navigation\r\n */\r\n\r\nexport interface ServiceContractWizardStep {\r\n  stepNumber: number;\r\n  title: string;\r\n  description: string;\r\n  requiredFields: string[];\r\n  isComplete: boolean;\r\n}\r\n\r\nexport interface ServiceContractWizardData {\r\n  // Step 1: Basic Information\r\n  title?: string;\r\n  description?: string;\r\n  customerId?: string;\r\n  customerName?: string;\r\n  productId?: string;\r\n  productName?: string;\r\n  serviceType?: string;\r\n\r\n  // Step 2: Service Details\r\n  slaTerms?: string;\r\n  serviceScope?: string;\r\n  exclusions?: string;\r\n\r\n  // Step 3: Financial Terms\r\n  value?: number;\r\n  currency?: string;\r\n  billingFrequency?: string;\r\n  paymentTerms?: string;\r\n\r\n  // Step 4: Dates & Renewal\r\n  startDate?: string;\r\n  endDate?: string;\r\n  autoRenew?: boolean;\r\n  renewalPeriodMonths?: number;\r\n\r\n  // Step 5: Team & Assignment\r\n  assignedToUserId?: string;\r\n  assignedToName?: string;\r\n  secondaryContactId?: string;\r\n  secondaryContactName?: string;\r\n\r\n  // Step 6: Scheduling\r\n  deliverySchedule?: string;\r\n  scheduledHoursPerWeek?: number;\r\n  timeZone?: string;\r\n\r\n  // Step 7: Documents\r\n  documents?: File[];\r\n\r\n  // Step 8: Review\r\n  ready?: boolean;\r\n}\r\n\r\n/**\r\n * ============================================================\r\n * Validation Schemas using Zod\r\n * ============================================================\r\n * These schemas enforce database constraints at the application layer\r\n */\r\n\r\nexport const ServiceContractCreateSchema = z.object({\r\n  title: z.string().min(1).max(255),\r\n  description: z.string().max(5000).optional(),\r\n  customerId: z.string().uuid(),\r\n  customerName: z.string().min(1).max(255),\r\n  productId: z.string().uuid().optional(),\r\n  productName: z.string().max(255).optional(),\r\n  serviceType: z.enum(['support', 'maintenance', 'consulting', 'training', 'hosting', 'custom']),\r\n  priority: z.enum(['low', 'medium', 'high', 'urgent']).default('medium'),\r\n  value: z.number().min(0).max(999999.99),\r\n  currency: z.string().max(3).default('USD'),\r\n  billingFrequency: z.enum(['monthly', 'quarterly', 'annually', 'one_time']).optional(),\r\n  paymentTerms: z.string().optional(),\r\n  slaTerms: z.string().optional(),\r\n  renewalTerms: z.string().optional(),\r\n  serviceScope: z.string().optional(),\r\n  exclusions: z.string().optional(),\r\n  startDate: z.string().datetime(),\r\n  endDate: z.string().datetime(),\r\n  estimatedCompletionDate: z.string().datetime().optional(),\r\n  autoRenew: z.boolean().default(false),\r\n  renewalPeriodMonths: z.number().int().min(1).max(360).optional(),\r\n  deliverySchedule: z.string().optional(),\r\n  scheduledHoursPerWeek: z.number().int().min(1).max(168).optional(),\r\n  timeZone: z.string().max(50).optional(),\r\n  assignedToUserId: z.string().uuid().optional(),\r\n  assignedToName: z.string().max(255).optional(),\r\n  secondaryContactId: z.string().uuid().optional(),\r\n  secondaryContactName: z.string().max(255).optional(),\r\n  tags: z.string().array().optional(),\r\n  customFields: z.record(z.any()).optional(),\r\n});\r\n\r\nexport const ServiceContractUpdateSchema = ServiceContractCreateSchema.partial();\r\n\r\nexport type ServiceContractCreate = z.infer<typeof ServiceContractCreateSchema>;\r\nexport type ServiceContractUpdate = z.infer<typeof ServiceContractUpdateSchema>;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\superAdmin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\types\\toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\accessibility.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\codeQuality.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\contractGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\dataModelIntegrationTest.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[622,625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[622,625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[638,641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[638,641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\extensionErrorHandler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\fileValidator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\httpInterceptor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\navigationFilter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\navigationFilterTests.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9717,9720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9717,9720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Navigation Filter Unit Tests\r\n * \r\n * Comprehensive test suite for permission-based navigation filtering.\r\n * Tests all filtering scenarios including:\r\n * - Permission-based filtering\r\n * - Role-based filtering\r\n * - Nested item filtering\r\n * - Dynamic section visibility\r\n * - Breadcrumb generation\r\n * \r\n * Run with: npm test -- navigationFilterTests\r\n * \r\n * @see src/utils/navigationFilter.ts\r\n */\r\n\r\nimport {\r\n  isItemVisible,\r\n  hasVisibleChildren,\r\n  filterNavigationItems,\r\n  createNavigationFilterContext,\r\n  getPermissionAwareBreadcrumbs,\r\n  getAllVisibleItems,\r\n  canAccessNavigationItem,\r\n  NavigationFilterContext,\r\n} from './navigationFilter';\r\nimport { navigationConfig } from '@/config/navigationPermissions';\r\n\r\n/**\r\n * Test suite runner\r\n * Output results to console\r\n */\r\nexport class NavigationFilterTestSuite {\r\n  private results: Array<{ name: string; passed: boolean; message?: string }> = [];\r\n\r\n  /**\r\n   * Run all tests and output results\r\n   */\r\n  async runAllTests(): Promise<boolean> {\r\n    console.log('üß™ Starting Navigation Filter Tests...\\n');\r\n\r\n    this.testPermissionFiltering();\r\n    this.testRoleBasedFiltering();\r\n    this.testNestedItemFiltering();\r\n    this.testDynamicSectionVisibility();\r\n    this.testBreadcrumbGeneration();\r\n    this.testVisibleItemsCollection();\r\n    this.testNavigationItemAccess();\r\n\r\n    this.printResults();\r\n    return this.results.every((r) => r.passed);\r\n  }\r\n\r\n  /**\r\n   * Test permission-based filtering\r\n   */\r\n  private testPermissionFiltering(): void {\r\n    const context = createNavigationFilterContext('admin', [\r\n      'read',\r\n      'manage_customers',\r\n      'manage_users',\r\n    ]);\r\n\r\n    const result = isItemVisible(navigationConfig[0], context); // Dashboard (read permission)\r\n    this.recordResult(\r\n      'Permission Filtering: Dashboard visible with read permission',\r\n      result === true\r\n    );\r\n\r\n    const noPermContext = createNavigationFilterContext('customer', ['read']);\r\n    const noPermResult = isItemVisible(navigationConfig[8], noPermContext); // Job Works (no permission)\r\n    this.recordResult(\r\n      'Permission Filtering: Job Works hidden without manage_job_works',\r\n      noPermResult === false\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Test role-based filtering\r\n   */\r\n  private testRoleBasedFiltering(): void {\r\n    const adminContext = createNavigationFilterContext('admin', ['manage_users']);\r\n    const adminItem = navigationConfig.find((item) => item.key === '/tenant/users');\r\n\r\n    const adminResult = adminItem ? isItemVisible(adminItem, adminContext) : false;\r\n    this.recordResult('Role Filtering: Admin can see User Management', adminResult === true);\r\n\r\n    const agentContext = createNavigationFilterContext('agent', ['read', 'write']);\r\n    const agentResult = adminItem ? isItemVisible(adminItem, agentContext) : false;\r\n    this.recordResult('Role Filtering: Agent cannot see User Management', agentResult === false);\r\n  }\r\n\r\n  /**\r\n   * Test nested item filtering\r\n   */\r\n  private testNestedItemFiltering(): void {\r\n    const context = createNavigationFilterContext('admin', [\r\n      'manage_users',\r\n      'manage_roles',\r\n    ]);\r\n\r\n    const userManagementItem = navigationConfig.find((item) => item.key === '/tenant/users');\r\n\r\n    if (userManagementItem && userManagementItem.children) {\r\n      const visibleChildren = userManagementItem.children.filter((child) =>\r\n        isItemVisible(child, context)\r\n      );\r\n\r\n      this.recordResult(\r\n        'Nested Filtering: Admin sees all User Management children',\r\n        visibleChildren.length > 0\r\n      );\r\n    }\r\n\r\n    const limitedContext = createNavigationFilterContext('agent', ['read']);\r\n    if (userManagementItem) {\r\n      const limitedResult = isItemVisible(userManagementItem, limitedContext);\r\n      this.recordResult(\r\n        'Nested Filtering: Agent cannot see User Management submenu',\r\n        limitedResult === false\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test dynamic section visibility\r\n   */\r\n  private testDynamicSectionVisibility(): void {\r\n    const adminContext = createNavigationFilterContext('admin', [\r\n      'manage_users',\r\n      'manage_settings',\r\n      'manage_companies',\r\n    ]);\r\n\r\n    const filtered = filterNavigationItems(navigationConfig, adminContext);\r\n    const adminSection = filtered.find((item) => item.key === 'admin-section');\r\n\r\n    this.recordResult(\r\n      'Dynamic Section: Administration section visible for admin',\r\n      adminSection !== undefined && adminSection.isVisible === true\r\n    );\r\n\r\n    const agentContext = createNavigationFilterContext('agent', ['read']);\r\n    const agentFiltered = filterNavigationItems(navigationConfig, agentContext);\r\n    const agentAdminSection = agentFiltered.find((item) => item.key === 'admin-section');\r\n\r\n    this.recordResult(\r\n      'Dynamic Section: Administration section hidden for agent',\r\n      agentAdminSection === undefined\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Test breadcrumb generation\r\n   */\r\n  private testBreadcrumbGeneration(): void {\r\n    const context = createNavigationFilterContext('admin', [\r\n      'read',\r\n      'manage_users',\r\n      'manage_roles',\r\n    ]);\r\n\r\n    const breadcrumbs = getPermissionAwareBreadcrumbs(\r\n      '/tenant/users',\r\n      navigationConfig,\r\n      context\r\n    );\r\n\r\n    this.recordResult(\r\n      'Breadcrumbs: Contains home item',\r\n      breadcrumbs.length > 0 && breadcrumbs[0].key === 'home'\r\n    );\r\n\r\n    this.recordResult(\r\n      'Breadcrumbs: Includes accessible items only',\r\n      breadcrumbs.every((item) => !item.key.includes('restricted'))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Test visible items collection\r\n   */\r\n  private testVisibleItemsCollection(): void {\r\n    const adminContext = createNavigationFilterContext('admin', [\r\n      'read',\r\n      'write',\r\n      'manage_customers',\r\n      'manage_users',\r\n      'manage_settings',\r\n    ]);\r\n\r\n    const visibleItems = getAllVisibleItems(navigationConfig, adminContext);\r\n\r\n    this.recordResult(\r\n      'Visible Items: Collection includes accessible items',\r\n      visibleItems.length > 0\r\n    );\r\n\r\n    const hasUserManagement = visibleItems.some((item) => item.key === '/tenant/users');\r\n    this.recordResult('Visible Items: Includes User Management for admin', hasUserManagement);\r\n\r\n    const superAdminContext = createNavigationFilterContext('super_admin', [\r\n      'super_admin',\r\n      'manage_tenants',\r\n    ]);\r\n    const superAdminItems = getAllVisibleItems(navigationConfig, superAdminContext);\r\n\r\n    this.recordResult(\r\n      'Visible Items: Super admin sees appropriate items',\r\n      superAdminItems.length > 0\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Test navigation item access validation\r\n   */\r\n  private testNavigationItemAccess(): void {\r\n    const adminContext = createNavigationFilterContext('admin', [\r\n      'manage_users',\r\n      'manage_roles',\r\n    ]);\r\n\r\n    const canAccessUsers = canAccessNavigationItem(\r\n      '/tenant/users',\r\n      navigationConfig,\r\n      adminContext\r\n    );\r\n    this.recordResult(\r\n      'Item Access: Admin can access User Management',\r\n      canAccessUsers === true\r\n    );\r\n\r\n    const agentContext = createNavigationFilterContext('agent', ['read']);\r\n    const cannotAccessUsers = canAccessNavigationItem(\r\n      '/tenant/users',\r\n      navigationConfig,\r\n      agentContext\r\n    );\r\n    this.recordResult(\r\n      'Item Access: Agent cannot access User Management',\r\n      cannotAccessUsers === false\r\n    );\r\n\r\n    const canAccessDashboard = canAccessNavigationItem(\r\n      '/tenant/dashboard',\r\n      navigationConfig,\r\n      agentContext\r\n    );\r\n    this.recordResult(\r\n      'Item Access: Agent can access Dashboard',\r\n      canAccessDashboard === true\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Record test result\r\n   */\r\n  private recordResult(name: string, passed: boolean, message?: string): void {\r\n    this.results.push({ name, passed, message });\r\n  }\r\n\r\n  /**\r\n   * Print test results\r\n   */\r\n  private printResults(): void {\r\n    console.log('\\nüìä Test Results:\\n');\r\n\r\n    let passed = 0;\r\n    let failed = 0;\r\n\r\n    this.results.forEach((result) => {\r\n      const icon = result.passed ? '‚úÖ' : '‚ùå';\r\n      const status = result.passed ? 'PASS' : 'FAIL';\r\n\r\n      console.log(`${icon} [${status}] ${result.name}`);\r\n\r\n      if (result.message) {\r\n        console.log(`    ${result.message}`);\r\n      }\r\n\r\n      if (result.passed) {\r\n        passed++;\r\n      } else {\r\n        failed++;\r\n      }\r\n    });\r\n\r\n    console.log(`\\nüìà Summary: ${passed} passed, ${failed} failed out of ${this.results.length} tests\\n`);\r\n\r\n    if (failed === 0) {\r\n      console.log('üéâ All tests passed!\\n');\r\n    } else {\r\n      console.log(`‚ö†Ô∏è  ${failed} test(s) failed\\n`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Quick test runner - use this in development\r\n * Add to your app initialization or use in a test file\r\n * \r\n * @example\r\n * if (process.env.NODE_ENV === 'development') {\r\n *   runNavigationFilterTests();\r\n * }\r\n */\r\nexport async function runNavigationFilterTests(): Promise<void> {\r\n  try {\r\n    const testSuite = new NavigationFilterTestSuite();\r\n    const allPassed = await testSuite.runAllTests();\r\n\r\n    if (!allPassed) {\r\n      console.error('Some tests failed!');\r\n    }\r\n  } catch (error) {\r\n    console.error('Test suite error:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Validate navigation configuration\r\n * Checks for common issues in navigation configuration\r\n */\r\nexport function validateNavigationConfig(): Array<{\r\n  severity: 'error' | 'warning' | 'info';\r\n  message: string;\r\n}> {\r\n  const issues: Array<{ severity: 'error' | 'warning' | 'info'; message: string }> = [];\r\n\r\n  // Check for duplicate keys\r\n  const keys = new Set<string>();\r\n  const duplicates = new Set<string>();\r\n\r\n  function checkDuplicates(items: any[]) {\r\n    items.forEach((item) => {\r\n      if (keys.has(item.key)) {\r\n        duplicates.add(item.key);\r\n      }\r\n      keys.add(item.key);\r\n\r\n      if (item.children) {\r\n        checkDuplicates(item.children);\r\n      }\r\n    });\r\n  }\r\n\r\n  checkDuplicates(navigationConfig);\r\n\r\n  if (duplicates.size > 0) {\r\n    issues.push({\r\n      severity: 'error',\r\n      message: `Duplicate navigation keys found: ${Array.from(duplicates).join(', ')}`,\r\n    });\r\n  }\r\n\r\n  // Check for missing permissions\r\n  navigationConfig.forEach((item) => {\r\n    if (item.permission && item.permission.length === 0) {\r\n      issues.push({\r\n        severity: 'warning',\r\n        message: `Navigation item \"${item.label}\" has empty permission`,\r\n      });\r\n    }\r\n  });\r\n\r\n  return issues;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\preventUnicodeEscapes.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2764,2767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2764,2767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3349,3352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3349,3352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\rbacTest.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[268,271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[268,271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[284,287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[284,287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\utils\\sessionManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\tailwind.config.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":348,"column":5,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":348,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\vite.config.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"c:\\Users\\RZ\\source\\repos\\PDS-CRM-Application\\CRMV9_NEWTHEME\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]