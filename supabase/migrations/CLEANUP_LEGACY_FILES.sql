-- ============================================================================
-- LEGACY MIGRATION FILES CLEANUP SCRIPT
-- This script organizes and archives superseded migration files
-- 
-- Date: November 23, 2025
-- Status: Manual Execution Required
-- ============================================================================

-- ============================================================================
-- CLEANUP SUMMARY
-- ============================================================================
-- This script documents which files have been archived and why.
-- 
-- FILES TO ARCHIVE (moved to ./archive/ directory):
-- 
-- Superseded by comprehensive reset:
-- - 20250101000001_init_tenants_and_users.sql
-- - 20250101000002_master_data_companies_products.sql  
-- - 20250101000003_crm_customers_sales_tickets.sql
-- - 20250101000004_contracts.sql
-- - 20250101000005_advanced_product_sales_jobwork.sql
-- - 20250101000006_notifications_and_indexes.sql
-- - 20250101000007_row_level_security.sql
-- - 20250101000008_customer_tags.sql
-- - 20250101000009_fix_rbac_schema.sql
-- - 20250101000010_add_rbac_rls_policies.sql
-- - 20250101000011_fix_rbac_rls_policies_v2.sql
-- - 20250101000012_enable_rls_on_rbac_tables.sql
-- - 20250101000013_fix_sale_items_rls_policies.sql
-- - 20250101000014_add_missing_notification_columns.sql
-- - 20250101000015_extend_notification_type_enum.sql
-- - 20250101000016_fix_notifications_rls_policy.sql
-- - 20250130000018_create_service_contracts_module.sql
-- - 20250131000019_fix_service_contracts_rls_policies.sql
-- - 20250211000001_add_missing_company_columns.sql
-- - 20250211000002_add_missing_product_columns.sql
-- - 20250315000001_create_status_options.sql
-- - 20250315000002_create_reference_data.sql
-- - 20250315000003_enhance_reference_tables.sql
-- - 20250322000021_create_sales_views.sql
-- - 20250322000022_create_crm_views.sql
-- - 20250322000023_create_contract_views.sql
-- - 20250322000024_create_job_works_views.sql
-- - 20250322000025_create_remaining_views.sql
-- - 20250328000026_remove_all_denormalized_fields.sql
-- - 20250328000027_add_performance_indexes.sql
-- - 20250328000028_add_audit_logs_user_columns.sql
-- - 20250329000001_enterprise_schema_normalization.sql
-- 
-- Old super admin migrations (superseded by new schema):
-- - 20250211_super_user_schema.sql
-- - 20250212_add_super_admin_column.sql
-- - 20250213_make_super_users_tenant_independent.sql
-- - 20250216_add_role_consistency_check.sql
-- - 20250217_make_audit_logs_nullable.sql
-- - 20250303_complete_fix_super_user_rls_no_nested_selects.sql
-- - 20250304_add_companies_products_crud_policies.sql
-- - 20250305_fix_super_admin_users_tenants_visibility.sql
-- 
-- November 2025 fixes (superseded by consolidated approach):
-- - 20251116000001_remove_redundant_super_admin_fields.sql
-- - 20251116000002_update_rls_policies_for_role_based_super_admin.sql
-- - 20251116000003_normalize_user_access_schema.sql
-- - 20251116000004_fix_roles_tenant_id_nullable.sql
-- - 20251116000005_fix_user_roles_tenant_id_nullable.sql
-- - 20251116000006_fix_user_roles_rls_infinite_recursion.sql
-- - 20251116000007_fix_users_rls_policies_final.sql
-- - 20251117000001_update_complaints_schema.sql
-- - 20251117000002_add_product_sales_rls_policies.sql
-- - 20251117000003_add_user_security_fields.sql
-- - 20251117000004_add_permissions_category.sql
-- - 20251117000005_add_missing_module_tables.sql
-- - 20251117000006_add_rls_policies_for_new_tables.sql
-- - 20251117000007_create_sales_pipeline_tables.sql
-- - 20251118000001_add_product_hierarchy.sql
-- - 20251118000002_add_deal_payment_revenue_columns.sql
-- - 20251118000003_create_customer_management_tables.sql
-- - 20251118000004_create_opportunities_table.sql
-- - 20251118000005_create_product_categories.sql
-- - 20251119000001_create_suppliers_table.sql
-- - 20251119000002_purchase_orders.sql
-- - 20251119000003_suppliers_and_foreign_keys_fix.sql
-- - 20251119000004_cleanup_suppliers_partial_migration.sql
-- - 20251119000005_add_supplier_foreign_keys_final.sql
-- - 20251120000001_complete_suppliers_purchase_orders_system.sql
-- - 20251120000002_fix_user_roles_admin_policy_recursion.sql
-- - 20251120000003_create_auth_users.sql
-- - 20251120000004_fix_users_rls_policies_recursion.sql
-- - 20251120000005_fix_all_rls_policies_recursion.sql
-- - 20251120000006_fix_remaining_rls_policies.sql
-- - 20251121000001_sync_auth_users_to_public_users.sql
-- - 20251121000002_quick_sync_missing_user.sql
-- 
-- Partial migration files:
-- - 20250101000005_purchase_orders.sql.backup
-- 
-- Files superseded by newer complete setup:
-- - 20251123000001_complete_fresh_start_setup.sql
-- 
-- Manual cleanup scripts:
-- - MANUAL_CLEANUP_SCRIPT.sql
-- 
-- ============================================================================
-- FILES TO KEEP (Essential)
-- ============================================================================
-- 
-- Current active migrations:
-- - 20251122000001_add_audit_logs_rls_policies.sql (RLS policies for audit_logs)
-- - 20251122000002_update_permissions_to_resource_action_format.sql (Permission format fix)
-- - 20251124000001_complete_database_reset.sql (NEW CONSOLIDATED SCRIPT)
-- 
-- ============================================================================
-- MANUAL EXECUTION REQUIRED
-- ============================================================================
-- 
-- Run these commands manually in your terminal:
-- 
-- 1. Create archive directory:
--    mkdir -p supabase/migrations/archive/legacy_migrations
-- 
-- 2. Move superseded files:
--    mv 2025010100000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250211*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250212*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250213*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250216*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250217*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250303*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250304*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250305*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025031500000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025032200002*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025032800002*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20250329000001_enterprise_schema_normalization.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025111600000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025111700000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025111800000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025111900000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025112000000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 2025112100000*.sql supabase/migrations/archive/legacy_migrations/
--    mv 20251123000001_complete_fresh_start_setup.sql supabase/migrations/archive/legacy_migrations/
--    mv MANUAL_CLEANUP_SCRIPT.sql supabase/migrations/archive/legacy_migrations/
-- 
-- 3. Verify remaining files:
--    ls -la supabase/migrations/
-- 
-- Expected remaining files:
-- - 20251122000001_add_audit_logs_rls_policies.sql
-- - 20251122000002_update_permissions_to_resource_action_format.sql
-- - 20251124000001_complete_database_reset.sql
-- - CLEANUP_LEGACY_FILES.sql (this file)
-- - archive/README_LEGACY_MIGRATIONS.md
-- 
-- ============================================================================
-- VERIFICATION QUERY
-- ============================================================================
-- 
-- After cleanup, verify no migration history conflicts:
-- 
-- SELECT version, name, inserted_at 
-- FROM supabase_migrations.schema_migrations 
-- ORDER BY version DESC;
-- 
-- Should show clean state for fresh database resets.
-- 
-- ============================================================================
-- END OF CLEANUP SCRIPT
-- ============================================================================